
# ğŸš© Dart è·¨å¹³å°å¼€å‘
- Dart programming https://www.dartlang.org/
- Dart Language Tour https://www.dartlang.org/guides/language/language-tour
- Flutter Install https://flutter.dev/docs/get-started/install
- Flutterä¸Dart å…¥é—¨ https://www.imooc.com/article/67042
- Visual Studio Code - Flutter https://flutter.dev/docs/development/tools/vs-code
- ä¸ºä»€ä¹ˆè¯´Flutteræ˜¯é©å‘½æ€§çš„ï¼Ÿ https://www.infoq.cn/article/why-is-flutter-revolutionary
- Get Dart SDK https://dart.cn/get-dart
- DartPad çº¿ä¸Šå·¥å…· https://github.com/dart-lang/dart-pad
- Dart Programming Language Specification 5th https://dart.dev/guides/language/specifications/DartLangSpec-v2.10.pdf

DartPad æ˜¯ä¸€ä¸ªå¼€æºçš„åœ¨çº¿ç¼–ç¨‹å·¥å…·ï¼Œhttp://dartpad.cn/ åœ¨ä»»ä½•ç°ä»£åŒ–çš„æµè§ˆå™¨ä¸­ä½“éªŒ Dart ç¼–ç¨‹è¯­è¨€ã€‚

Dart æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å®¢æˆ·ç«¯å¿«é€Ÿå¼€å‘è¯­è¨€ã€‚

- Optimized for UI: å¿«é€Ÿå¼€å‘ç”¨æˆ·ç•Œé¢åº”ç”¨ã€‚
- Productive: äº§å“çº§å¼€å‘ï¼Œçƒ­é‡è½½æ”¯æŒï¼Œäº¤äº’åœ°ä¿®æ”¹ã€‚
- Fast on all platforms: å¤šå¹³å°æ”¯æŒ ARM & x64 æ¶æ„ç§»åŠ¨ç«¯ã€æ¡Œé¢æˆ–åç«¯ï¼Œæˆ–è€…ç¼–è¯‘ç”Ÿæˆ JavaScript Web åº”ç”¨ã€‚

Dart å…·æœ‰æ¨ªè·¨ä¸‰ä¸ªç»´åº¦çš„ç‹¬ç‰¹åŠŸèƒ½ç»„åˆ:

- å¯ç§»æ¤æ€§: é«˜æ•ˆçš„ç¼–è¯‘å™¨å¯é’ˆå¯¹è®¾å¤‡ç”Ÿæˆ x86 å’Œ ARM æœºå™¨ä»£ç ï¼Œå¹¶é’ˆå¯¹ web ç”Ÿæˆä¼˜åŒ–çš„ JavaScriptã€‚åŒæ—¶å…¼å®¹ç§»åŠ¨è®¾å¤‡ã€æ¡Œé¢ PCã€åº”ç”¨åç«¯ç­‰å¤šç§ ç›®æ ‡å¹³å°ã€‚å¤§é‡çš„å¼€å‘åº“å’Œ package æä¾›äº†å¯åœ¨æ‰€æœ‰å¹³å°ä¸Šä½¿ç”¨çš„ä¸€è‡´çš„ APIï¼Œè¿›ä¸€æ­¥é™ä½äº†å¼€å‘è€…åˆ›å»ºçœŸæ­£å¤šå¹³å°åº”ç”¨çš„æˆæœ¬ã€‚
- é«˜ç”Ÿäº§åŠ›: Dart å¹³å°æ”¯æŒçƒ­é‡è½½ï¼Œå› æ­¤å¯åœ¨åŸç”Ÿè®¾å¤‡å’Œ web ä¸Šå®ç°å¿«é€Ÿè¿­ä»£å¼€å‘ã€‚æ­¤å¤–ï¼ŒDart è¿˜æä¾›äº†ä¸°å¯Œçš„ç»“æ„ï¼Œå¦‚ isolates å’Œ async/await ç­‰ï¼Œç”¨ä»¥å¤„ç†å’Œå®ç°å¸¸è§çš„å¹¶å‘å’Œäº‹ä»¶é©±åŠ¨çš„åº”ç”¨æ¨¡å¼ã€‚
- ç¨³å¥: Dart çš„å¥å…¨ç©ºå®‰å…¨ç±»å‹ç³»ç»Ÿå¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­å°±æ•æ‰åˆ°é”™è¯¯ã€‚æ•´ä¸ªå¹³å°æ‹¥æœ‰æå¥½çš„å¯æ‰©å±•æ€§å’Œå¯é æ€§ï¼Œå·²ç»è¢«å¤§é‡ä¸”å¤šæ ·çš„åº”ç”¨åœ¨ç´¯è®¡è¶…è¿‡åå¹´çš„ç”Ÿäº§ç¯å¢ƒä¸­å®æˆ˜æ£€éªŒè¿‡ï¼Œå…¶ä¸­åŒ…æ‹¬ Google çš„ä¸€äº›å…³é”®ä¸šåŠ¡åº”ç”¨ï¼Œå¦‚ Google Ads å’Œ Google Assistant ç­‰ã€‚

Dart è¯­è¨€ 3 ä¸ªè®¾è®¡åŸåˆ™ï¼š

- Everything Is an Object
- Program to an Interface, not an Implementation
- Types in the Service of the Programmer

Dart ç³»ç»Ÿä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼ŒåŒ…æ‹¬å¸ƒå°”å€¼ true å’Œ falseï¼Œä¹ŸåŒ…æ‹¬æ•°å€¼ã€å­—ç¬¦ä¸²ç­‰ç­‰ã€‚

åŸºäºæ¥å£ç¼–ç¨‹ä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š

- ç±»å®šä¹‰å°±æ˜¯æ¥å£ï¼Œå¯ä»¥è¢«å…¶å®ƒç±»å®ç°ï¼Œè€Œä¸ç®¡è¿™ä¸¤ä¸ªç±»æ˜¯å¦å…±äº«å®ç°ï¼Œé™¤æ ¸å¿ƒç±»å‹æœ‰ä¸€äº›ä¾‹å¤–ï¼Œå¦‚æ•°å­—ã€å¸ƒå°”å€¼å’Œå­—ç¬¦ä¸²ã€‚
- Dart æ²¡æœ‰ final æ–¹æ³•ï¼Œå‡ ä¹æ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥è¢« overridingï¼ŒåŒæ ·é™¤äº†å°‘é‡ built-in è¿ç®—ç¬¦ã€‚
- Dart å¯¹è±¡çš„æŠ½è±¡è¡¨è¾¾é€šè¿‡ getter/setter è®¿é—®å™¨æ–¹æ³•å®ç°ç¡®ä¿ç±»å°é—­å†…éƒ¨çŠ¶æ€çš„è®¿é—®ã€‚
- Dart çš„æ„é€ å™¨å…è®¸ç¼“å­˜æˆ–ç”Ÿæˆå­ç±»å®ä¾‹ï¼Œæ‰€ä»¥æ„é€ å™¨å¹¶ä¸ç»‘å®šåˆ°ç‰¹å®šçš„å®ç°ã€‚

Dart æ˜¯ä¸€ç§ç±»å‹å¯é€‰çš„é™æ€ç±»å‹è¯­è¨€ï¼š

- Types are syntactically optional.
- Types have no effect on runtime semantics.

ä»¥ä¸Šä¸¤ä¸ªè¯´çš„æ˜¯å¯ä»¥ä½¿ç”¨ var å…³é”®å­—å®šä¹‰å˜é‡ï¼Œå…·ä½“ç±»å‹ Dart å¯ä»¥è‡ªè¡Œæ¨å¯¼ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ dynamic å…³é”®å­—æˆ– Object ç±»å‹ã€‚è¿™ä¸‰ä¸ªè€…çš„åŒºåˆ«åœ¨äºï¼ŒåŠ¨æ€ç±»å‹ dynamic ä¸è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œæ¨æ–­ï¼Œé€šè¿‡ runtimeType å±æ€§è·å–è¿è¡Œæ—¶ç±»å‹ã€‚è€Œ Object æ˜¯å…·ä½“çš„ç±»å‹ï¼Œå®ƒæ˜¯æ‰€æœ‰å¯¹è±¡çš„åŸºç±»ï¼ŒåŒ…æ‹¬ Function å’Œ Nullï¼Œæ‰€ä»¥ä»»ä½•ç±»å‹ä¹Ÿéƒ½å¯ä»¥èµ‹å€¼ç»™ Objectã€‚

åä¸€ç‚¹è¿œæ¯”å‰ä¸€ç‚¹é‡è¦ï¼Œå®ƒæ˜¯ Dart è®¾è®¡çš„åŸºçŸ³ï¼Œä¸ä¼ ç»Ÿé™æ€ç±»å‹è¯­è¨€ä¸å¤ªç›¸åŒã€‚

é¦–å…ˆï¼ŒDart æ˜¯ä¸€ç§åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œä»»ä½•åŠ¨æ€è¯­è¨€ç¼–å†™çš„ç¨‹åºéƒ½åº”è¯¥èƒ½ç”¨ Dart æ¥è¡¨è¾¾ã€‚ä»£ç ä¸æ–­å‘å±•ï¼Œéšç€æ—¶é—´çš„æ¨ç§»è·å¾—ç±»å‹æ³¨é‡Šï¼Œå¦‚æœç±»å‹æ³¨é‡Šè¦æ›´æ”¹ Dart ç¨‹åºçš„è¡Œä¸ºï¼Œåˆ™å·¥ä½œç¨‹åºå¾ˆå¯èƒ½ä¼šåœ¨å‘å…¶æ·»åŠ ç±»å‹æ³¨é‡Šæ—¶åœæ­¢æ­£å¸¸å·¥ä½œã€‚è¿™ä¼šé˜»ç¢ç±»å‹æ³¨é‡Šçš„ä½¿ç”¨ï¼Œå› ä¸ºç¨‹åºå‘˜ä¼šæ‹…å¿ƒå·¥ä½œä»£ç ä¼šå‡ºç°æ•…éšœã€‚

æ­¤å¤–ï¼ŒDart ç¨‹åºé€šå¸¸ä¼šåŒ…å«é”®å…¥çš„éƒ¨åˆ†å’Œæœªé”®å…¥çš„éƒ¨åˆ†ï¼Œè¿™æ„å‘³ç€ä¸èƒ½å‡è®¾ç±»å‹å®‰å…¨ï¼Œä¹Ÿä¸èƒ½å‡è®¾ç±»å‹æ³¨é‡Šå®é™…ä¸Šæ˜¯çœŸçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…è®¸ç±»å‹æ³¨é‡Šå‡å®šè¯­ä¹‰æ„ä¹‰å¯èƒ½ä¼šé€ æˆæ··ä¹±å’Œä¸ç¨³å®šã€‚

ä½œä¸ºè¿è¡Œæ—¶è¡Œä¸ºä¾èµ–äºç±»å‹çš„è¯­è¨€ç‰¹å¾çš„ä¸€ä¸ªä¾‹å­ï¼Œè¯·è€ƒè™‘åŸºäºç±»å‹çš„æ–¹æ³•é‡è½½ï¼Œé‡è½½æ˜¯é™æ€ç±»å‹çš„é¢å‘å¯¹è±¡è¯­è¨€çš„ä¸€ä¸ªå¸¸è§ç‰¹æ€§ã€‚

åœ¨ç±»å‹çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¹‹é—´æä¾›äº†æœ‰æ•ˆçš„å¹³è¡¡ï¼Œé™æ€ç±»å‹å¯ä»¥æœ‰åŠ©äºæä¾›æ˜“è¯»çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç®€åŒ–ç±»å‹åˆ†æï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¼•å…¥äº†é¢å¤–çš„ç±»å‹æ£€æŸ¥å·¥ä½œã€‚

Dart 2.12 ç°å·²å‘å¸ƒï¼Œå…¶ä¸­åŒ…å«å¥å…¨çš„ Null å®‰å…¨å’Œ Dart FFI çš„ç¨³å®šç‰ˆã€‚Null å®‰å…¨æ˜¯ä¸»æ‰“çš„ä¸€é¡¹ç”Ÿäº§åŠ›å¼ºåŒ–åŠŸèƒ½ï¼Œæ„åœ¨å¸®åŠ©è§„é¿ç©ºå€¼é”™è¯¯ï¼Œä»¥å‰è¿™ç§é”™è¯¯é€šå¸¸å¾ˆéš¾è¢«å‘ç°ã€‚FFI -  foreign function interface åˆ™æ˜¯ä¸€ç§äº’æ“ä½œæœºåˆ¶ï¼Œæ”¯æŒè°ƒç”¨ä»¥ C è¯­è¨€ç¼–å†™çš„æ—¢æœ‰ä»£ç ï¼Œä¾‹å¦‚è°ƒç”¨ Windows Win32 APIã€‚

ä» Flutter 1.21 ç‰ˆæœ¬å¼€å§‹ï¼ŒFlutter SDK ä¼šåŒæ—¶åŒ…å«å®Œæ•´çš„ Dart SDK å› æ­¤å¦‚æœä½ å·²ç»å®‰è£…äº† Flutterï¼Œå¯èƒ½å°±æ— éœ€å†ç‰¹åˆ«ä¸‹è½½ Dart SDK äº†ã€‚

å¤šä¸ª SDK ç‰ˆæœ¬å¯ä»¥é€šè¿‡è„šæœ¬è¿›è¡Œç®¡ç†ï¼Œåœ¨ Windows å¹³å°ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ dvm.bat è¿›è¡Œç‰ˆæœ¬åˆ‡æ¢ï¼Œå‡è®¾ Flutter å®‰è£…åœ¨ c:\flutter ç›®å½•ä¸‹ï¼š

```sh
@echo off
set v0=Dart SDK 2.10.5 + Flutter 1.22.6
set v1=Dart SDK 2.13.3 + Flutter 2.2.2

@REM setlocal

cls
echo Choose a Dart SDK version, ESC to end
echo [1] %v1%
echo [0] %v0%
:loop
for /F %%k in ('PowerShell Write-Host $Host.UI.RawUI.ReadKey(\"NoEcho,IncludeKeyDown\"^).VirtualKeyCode') do set "key=%%k"
rem echo "Key press %key%"
rem set /p="Key press %key%"
if %key% equ 48 goto v0
if %key% equ 49 goto v1
if %key% neq 27 goto loop
goto end

:v0
echo Switch to %v1%
rmdir C:\flutter
mklink /d C:\flutter C:\flutter_1.22.6
goto end

:v1
echo Switch to %v1%
rmdir C:\flutter
mklink /d C:\flutter C:\flutter_2.2.2
goto end

:end
```

å¦‚æœä½ æœ‰ä¸‹è¿°çš„éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹ä¸‹è½½å®‰è£… Dart SDKï¼š

- ä¸éœ€è¦ä½¿ç”¨ Flutterï¼›
- ä½¿ç”¨ Flutter 1.21 ä¹‹å‰çš„ç‰ˆæœ¬ï¼›
- å¸Œæœ›é™ä½ç”µè„‘å­˜å‚¨ç©ºé—´çš„ä½¿ç”¨ï¼Œæ­¤æ¬¡ç”¨ä¾‹å¹¶ä¸éœ€è¦ Flutterï¼Œæ¯”å¦‚ï¼šè®¾ç½® CI æ—¶ï¼Œéœ€è¦ Dart å¹¶ä¸éœ€è¦ Flutterã€‚

ä½¿ç”¨åŒ…ç®¡ç†è½»æ¾åœ°å®‰è£…å’Œæ›´æ–° Dart SDKï¼Œä¹Ÿå¯ä»¥ä»¥ç¼–è¯‘ SDK æºç çš„å½¢å¼å®‰è£…ï¼Œæˆ–è€…ä¸‹è½½ SDK çš„ zip å‹ç¼©æ–‡ä»¶ã€‚

é™¤äº†ä¸‹è½½å®‰è£…ï¼Œè¿˜å¯ä»¥æŒ‰å®˜æ–¹ç½‘ç«™æç¤ºä½¿ç”¨ chocolatey ç®¡ç†å·¥å…·å®‰è£…ï¼Œå®‰è£…ç›®å½•å¦‚ï¼š

    C:\ProgramData\chocolatey\lib

é…ç½®ç¯å¢ƒå˜é‡ï¼Œå›½å†…ç”¨æˆ·éœ€è¦è®¾ç½®å¯ç”¨çš„ PUB ä»“åº“åœ°å€ï¼Œå¦åˆ™ç®¡ç†å·¥å…·ä¸èƒ½æ­£å¸¸è·å–æœåŠ¡å™¨çš„èµ„æºã€‚Pub æ˜¯ Dart å®˜æ–¹çš„åŒ…ç®¡ç†å™¨ï¼Œè·¨å¹³å°çš„å‰ç«¯åº”å¼€å‘æ¡†æ¶ï¼ŒFlutter ä¹ŸåŸºäº Dart å¹¶ä¸”å¯ä»¥ä½¿ç”¨å¤§éƒ¨åˆ† Pub ä¸­çš„åº“ã€‚å¦‚æœå¸Œæœ›é€šè¿‡ TUNA çš„ pub é•œåƒå®‰è£…è½¯ä»¶ï¼Œåªéœ€è¦è®¾ç½® PUB_HOSTED_URL è¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å‘ TUNA å³å¯ã€‚

å¦‚æœä½ åœ¨å›½å†…ä½¿ç”¨ Flutterï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦æ‰¾ä¸€ä¸ªä¸å®˜æ–¹åŒæ­¥çš„å¯ä¿¡çš„é•œåƒç«™ç‚¹ï¼Œå¸®åŠ©ä½ çš„ Flutter å‘½ä»¤è¡Œå·¥å…·åˆ°è¯¥é•œåƒç«™ç‚¹ä¸‹è½½å…¶æ‰€éœ€çš„èµ„æºã€‚
ä½ éœ€è¦ä¸ºæ­¤è®¾ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼šâ€œPUB_HOSTED_URLâ€å’Œâ€œFLUTTER_STORAGE_BASE_URLâ€ï¼Œç„¶åå†è¿è¡Œ Flutter å‘½ä»¤è¡Œå·¥å…·ï¼ŒæŸ¥çœ‹è®¾ç½®æ•™ç¨‹ã€‚

    Flutter ç¤¾åŒº
    FLUTTER_STORAGE_BASE_URL: https://storage.flutter-io.cn
    PUB_HOSTED_URL: https://pub.flutter-io.cn

    ä¸Šæµ·äº¤é€šå¤§å­¦ Linux ç”¨æˆ·ç»„
    FLUTTER_STORAGE_BASE_URL: https://mirrors.sjtug.sjtu.edu.cn
    PUB_HOSTED_URL: https://dart-pub.mirrors.sjtug.sjtu.edu.cn

ä»¥ bash ä¸ºä¾‹ï¼Œä¸´æ—¶ä½¿ç”¨ TUNA çš„é•œåƒæ¥å®‰è£…ä¾èµ–ï¼Œè‹¥å¸Œæœ›é•¿æœŸä½¿ç”¨ TUNA é•œåƒè¯·è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ï¼š

    $ PUB_HOSTED_URL="https://mirrors.tuna.tsinghua.edu.cn/dart-pub/" pub get # pub
    $ PUB_HOSTED_URL="https://mirrors.tuna.tsinghua.edu.cn/dart-pub/" flutter packages get # flutter

    export PUB_HOSTED_URL=https://pub.flutter-io.cn
    export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn
    export PATH= /path/to/flutter/bin:$PATH

    $ echo 'export PUB_HOSTED_URL="https://mirrors.tuna.tsinghua.edu.cn/dart-pub/"' >> ~/.bashrc

æ¨¡å—å®‰è£…ç›®å½•åœ¨ä»¥ä¸‹ä½ç½®ï¼ŒAdministrator æ›¿æ¢å¯¹åº”ç³»ç»Ÿçš„ç”¨æˆ·å

    C:\Users\Administrator\AppData\Roaming\Pub\Cache

å°†ç¯å¢ƒå˜é‡é…ç½®åˆ° vim $HOME/.bash_profile

    # .bash_profile

    # Get the aliases and functions
    if [ -f ~/.bashrc ]; then
            . ~/.bashrc
    fi

    # User specific environment and startup programs

    PATH=$PATH:$HOME/bin

    export PATH

Dart ç‰ˆæœ¬å‡è¿åå‘½ä»¤å˜åŒ–æŒ‡å¯¼ [Dart 2 Migration Guide for Web Apps]

|        Dart 1.x        |                           Dart 2                           |
|------------------------|------------------------------------------------------------|
| Dartium, content shell | Chrome and dartdevc                                        |
| pub build              | webdev build                                               |
| pub serve              | webdev serve                                               |
| pub run angular_test   | pub run build_runner test -- -p chrome. See: Running tests |
| pub transformers       | build package transformers. See: Transforming code         |

åœ¨ Windows ç³»ç»Ÿä¸Š `webdev` å‘½ä»¤ä¸èƒ½ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨æ›¿ä»£å‘½ä»¤ `dart pub global run webdev serve`ã€‚


## âš¡ Keywords
- https://dart.dev/guides/language/language-tour#keywords

Dart æä¾›äº† 63 ä¸ªå…³é”®å­—ï¼Œå…¶ä¸­ interface å·²ç»ç§»é™¤ï¼Œé€šè¿‡ abstract ç±»æˆ–è€… implements ä»ç±»ä¸­éšå¼åœ°è·å¾—æ¥å£ã€‚

    | abstract  2 | else         | import    2 | show    1 |
    | as        2 | enum         | in          | static  2 |
    | assert      | export     2 | interface 2 | super     |
    | async     1 | extends      | is          | switch    |
    | await     3 | extension  2 | late      2 | sync    1 |
    | break       | external   2 | library   2 | this      |
    | case        | factory    2 | mixin     2 | throw     |
    | catch       | false        | new         | true      |
    | class       | final        | null        | try       |
    | const       | finally      | on        1 | typedef 2 |
    | continue    | for          | operator  2 | var       |
    | covariant 2 | Function   2 | part      2 | void      |
    | default     | get        2 | required  2 | while     |
    | deferred  2 | hide       1 | rethrow     | with      |
    | do          | if           | return      | yield   3 |
    | dynamic   2 | implements 2 | set       2 |           |

é¿å…å°†å…³é”®å­—å½“ä½œæ ‡è¯†ç¬¦å·ä½¿ç”¨ï¼Œæ•°å­—æ ‡è®°è¯´æ˜å¦‚ä¸‹ï¼š

- 1 are contextual keywords, which have meaning only in specific places. Theyâ€™re valid identifiers everywhere.
- 2 are built-in identifiers. To simplify the task of porting JavaScript code to Dart, these keywords are valid identifiers in most places, but they canâ€™t be used as class or type names, or as import prefixes.
- 3 are limited reserved words related to asynchrony support. You canâ€™t use await or yield as an identifier in any function body marked with `async`, `async*`, or `sync*`.
- All other words in the table are reserved words, which canâ€™t be identifiers.

ä½¿ç”¨ typedef å£°æ˜ç±»å‹åˆ«åï¼š

    typedef IntList = List<int>;
    IntList il = [1, 2, 3];


## âš¡ Flutter å‰ç«¯æ¡†æ¶
- Using Flutter in China https://flutter.dev/community/china
- Flutter Installation https://flutter.dev/docs/get-started/install/windows
- install the Flutter and Dart plugins https://flutter.dev/docs/get-started/editor
- Visual Studio Code https://flutter.dev/docs/development/tools/vs-code
- Install Android Studio https://developer.android.google.cn/studio/install
- Flutter Version Manager https://fvm.app/docs/getting_started/configuration

å…‹éš† Flutter ä»“åº“å³å¯å®‰è£…ï¼Œç°åœ¨ä»“åº“å·²ç»é›†æˆ Dart SDKï¼Œç›®å½•ä½ç½® bin\cache\dart-sdkï¼š

    git clone -b stable git@github.com:flutter/flutter.git

å®‰è£… Flustter ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼š

```sh
dart pub global activate fvm
fvm install - # Installs version found in project config
fvm install {version} - # Installs specific version
fvm config --cache-path <CACHE_PATH>
```

VS Code ä¸­å®‰è£… [Dart DevTools] æ”¯æŒ Dart è¯­è¨€ï¼Œè¿˜æœ‰ Flutter æ‰©å±•ç”¨æ¥åšè°ƒè¯•ã€‚è¿›å…¥è°ƒè¯•çŠ¶æ€åï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤é¢æ¿æ‰§è¡Œ `Dart: Open DevTools` æ‰“å¼€è°ƒè¯•å™¨ç•Œé¢ï¼Œå¿«æ·é”® `Ctrl` + `Alt` + `D`ã€‚è¿™ä¸ªå·¥å…·ç®€ç›´ä¸è¦å¤ªå¥½äº†ï¼Œå¦‚æœç”¨è¿‡ Vue DevToolsï¼Œé‚£ä¹ˆ Dart DevTools ç»å¯¹æ˜¯æ›´èƒœä¸€ç­¹ã€‚

ç›®å‰ VS Code V1.9.0 è¿˜ä¸æ”¯æŒè‡ªå®šä¹‰ä¿®æ”¹æ’ä»¶çš„å®‰è£…ä½ç½®ï¼Œä½†å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°ä¿®æ”¹ `code.exe --extensions-dir /path/to/plugins`

æä¾›äº”ä¸ªä¸»è¦åŠŸèƒ½è§†å›¾ `Flutter Inspector`ã€ `Timeline View`ã€ `Memory View`ã€ `Debugger`ã€ `Logging View`ã€‚æ¢æµ‹å™¨è§†å›¾æä¾›äº† `Performance Overlay` åŠ¨æ€ç›´æ–¹å›¾æ€§èƒ½ç›‘è§†å™¨ã€ `Debug Paint` å…ƒç´ è¾¹ç•Œæ ‡è®°ã€ `Paint Baselines` åŸºå‡†çº¿æŒ‡ç¤ºã€ `Slow Animations` æ…¢åŠ¨ä½œæ˜¾ç¤ºã€ `Repaint Rainbow` æ¸²æŸ“åŒºå¤šå½©æŒ‡ç¤ºï¼Œè¿˜æœ‰ç»„ä»¶æ ‘çŠ¶å›¾ã€‚æœ€é‡è¦çš„æ˜¯è¦æœ‰çƒ­é‡å¯å’Œçƒ­åŠ è½½ `Hot Restart`ã€ `Hot Reload`ã€‚VS Code å¯ä»¥è¿æ¥çœŸæœºè°ƒè¯•ï¼Œæ”¯æŒçƒ­åŠ è½½ï¼Œå¼ºçƒˆå»ºè®®è¿˜æ˜¯ä½¿ç”¨çœŸæœºè°ƒè¯•ã€‚

é»˜è®¤æƒ…å†µä¸‹ DevTools çš„æ—¥å¿—è§†å›¾ [Using the Logging View] ä¸­æ‰“å°äº†å›æ”¶æœºåˆ¶äº‹ä»¶ Garbage collectã€Flutter æ¡†æ¶äº‹ä»¶ã€é€šè¿‡ `print()` æ‰“å°çš„æ ‡å‡†è¾“å‡º `stdout` å’Œè‡ªå®šä¹‰æ—¥å¿—äº‹ä»¶ä¿¡æ¯ã€‚å¯ä»¥å¼•å…¥ `dart:convert`ã€ `dart:developer` æä¾›çš„ `jsonEncode()` å’Œæ—¥å¿—åŠŸèƒ½ã€‚

    import 'dart:convert';
    import 'dart:developer' as developer;

    stderr.writeln('print me');
    developer.log('log me', name: 'my.app.category', error: jsonEncode(["Some object"]), );
    developer.log('log me 2', name: 'my.other.category');

åœ¨ VS Code ä¸­ä½¿ç”¨å¿«æ·é”® shift + command + p è¿è¡Œå‘½ä»¤ï¼Œ`Flutter: Run Flutter Doctor` éªŒè¯æ“ä½œï¼Œä»¥å¸®åŠ©è§£å†³é…ç½®é—®é¢˜ã€‚

    [flutter] flutter doctor
    Waiting for another flutter command to release the startup lock...
    Doctor summary (to see all details, run flutter doctor -v):
    [âˆš] Flutter (Channel stable, v1.2.1, on Microsoft Windows [Version 10.0.14393], locale zh-CN)
    [X]  - develop for Android devices
        X Unable to locate Android SDK.
          Install Android Studio from: https://developer.android.com/studio/index.html
          On first launch it will assist you in installing the Android SDK components.
          (or visit https://flutter.io/setup/#android-setup for detailed instructions).
          If Android SDK has been installed to a custom location, set ANDROID_HOME to that location.
          You may also want to add it to your PATH environment variable.

    [!] Android Studio (version 3.2)
        X Flutter plugin not installed; this adds Flutter specific functionality.
        X Dart plugin not installed; this adds Dart specific functionality.
    [!] IntelliJ IDEA Ultimate Edition (version 2018.3)
        X Flutter plugin not installed; this adds Flutter specific functionality.
        X Dart plugin not installed; this adds Dart specific functionality.
    [âˆš] VS Code, 64-bit edition (version 1.32.3)
    [!] Connected device
        ! No devices available

    ! Doctor found issues in 4 categories.

æ£€æŸ¥åæç¤ºï¼ŒAndroid toolchain è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºæ²¡è£… Android SDKï¼Œå¦‚æœå®‰è£…äº†è¯·åœ¨ç¯å¢ƒå˜é‡ `ANDROID_HOME` è®¾ç½®å¥½è·¯å¾„ã€‚ Android Studio æˆ– IntelliJ IDEA å®‰è£…å¥½ï¼Œä½†æ˜¯æ²¡æœ‰å®‰è£…ç›¸åº”çš„ `Flutter`ã€`Dart` æ’ä»¶ï¼Œå»å®‰è£…è¿™ä¸¤ä¸ªæ’ä»¶å³å¯ã€‚æ²¡æ£€æµ‹åˆ°è¿æ¥è®¾å¤‡ Connected deviceï¼Œæ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…è™šæ‹Ÿæœºæˆ–æ²¡æœ‰è¿æ¥å¯ä»¥è°ƒè¯•çš„è®¾å¤‡ã€‚éœ€è¦åœ¨ AVD Manager åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºéœ€è¦é…å¥—ä½¿ç”¨ç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚æ˜ åƒæ–‡ä»¶å­˜æ”¾åœ¨ SDK å®‰è£…ç›®å½•ä¸‹çš„ `system-images` å†…ï¼Œé€šè¿‡ä½¿ç”¨ SDK ç®¡ç†å·¥å…·ä¸‹è½½ã€‚å¦‚æœåœ¨å®‰è£…è™šæ‹Ÿæœºåå‡ºç°è™šæ‹Ÿé»‘å±çš„æƒ…å†µï¼Œå¤šåŠæ˜¯ç³»ç»Ÿå…¼å®¹é—®é¢˜ï¼Œå¯ä»¥è¯•è¯•å…¶å®ƒ Android å¹³å°ç‰ˆæœ¬ï¼Œå¦‚æœ¬æœº Window 10 ä½¿ç”¨ Android 6.0(API 23)ï¼Œæ˜ åƒæ–‡ä»¶åªä¸‹è½½é…å¥—çš„ `Intel x86 Atom System Image`ã€‚

å¼€å‘ Android App ç”¨åˆ°äº† Android å¼€å‘å·¥å…·åŒ…éœ€è¦ JDKï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ JAVA_HOMEï¼Œæ³¨æ„ä¸éœ€è¦æŒ‡å®šåˆ° bin ç›®å½•ï¼Œä½¿ç”¨ OpenJDK 1.8.0ï¼Œå¯ä»¥ä½¿ç”¨ Android Studio å®‰è£…åŒ…è‡ªå¸¦çš„ JDKã€‚æé†’ Android licenses çŠ¶æ€æ—¶å¯ä»¥æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š

    flutter doctor --android-licenses

ä½¿ç”¨ Android Studio åšå¼€å‘åªéœ€è¦åœ¨é…ç½®ç•Œé¢ `File` -> `Settings` -> `Plugins` ä¸­å®‰è£… Flutterã€Dart æ’ä»¶ï¼Œé‡å¯åå°±å¯ä»¥å¼€å‘ Flutter ç¨‹åºã€‚å®‰è£…æ’ä»¶åï¼Œé…ç½®ç•Œé¢ä¸­çš„ `Languages & Frameworks` ä¼šå‡ºç° Flutter å’Œ Dart çš„é…ç½®é¡¹ã€‚èœå•ä¸Šä¹Ÿä¼šå‡ºç°æ–°å»º Flutter App æ¨¡æ¿ã€‚

å¦‚æœå¼€å‘æœºå™¨é…ç½®ä¸å¤Ÿï¼Œè¿è¡Œè™šæ‹Ÿæœºä¼šæ¯”è¾ƒæ…¢ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ‰‹æœºè¿›è¡Œè¿æ¥è°ƒè¯•ã€‚éœ€è¦æ‰“å¼€ Android æ‰‹æœºçš„å¼€å‘è€…æ¨¡å¼åŠ USB è°ƒè¯•æ¨¡å¼ï¼Œå¦‚æ‰“å¼€å°ç±³ 8 çš„å¼€å‘è€…æ¨¡å¼ï¼Œ`è®¾ç½®` -> `æˆ‘çš„è®¾å¤‡` -> `å…¨éƒ¨å‚æ•°` è¿ç»­ç‚¹å‡» `MIUIç‰ˆæœ¬` ç›´åˆ°æç¤ºè¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼Œç„¶åå¯ä»¥å» `è®¾ç½®` -> `æ›´å¤šè®¾ç½®` -> `å¼€å‘è€…é€‰é¡¹` ç®¡ç†æ›´å¤šçš„é€‰é¡¹ï¼Œå¦‚æ‰“å¼€ USB è°ƒè¯•ä¸å®‰è£…é€‰é¡¹ã€‚

å¯ä»¥é€šè¿‡å‘½ä»¤é¢æ¿æ‰§è¡Œ `Flutter: New Project` åˆ›å»ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œç›¸åº”å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ `material.AppBar` ç¨‹åºï¼Œç„¶ååœ¨è®¾å¤‡ä¸Šè¿è¡Œï¼š

    flutter create --project-name sample --sample material.AppBar.actions --overwrite ./demo_app
    flutter run [-d chrome]

åœ¨ VS Code å¼€å‘ç¯å¢ƒä¸­ï¼Œç•Œé¢åº•éƒ¨ä¼šå±•ç¤ºè¿æ¥ç”¨äºè°ƒè¯•çš„æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºè®¾å¤‡ã€‚

å¼€å‘ Android åº”ç”¨ï¼Œä¸ä¸€å®šéœ€è¦ Android Studio æˆ– IntelliJ IDEA è¿™æ ·çš„é›†æˆå¼€å‘å·¥å…·ï¼Œä½† Android SDK å’Œ JDK 1.8 æ˜¯å¿…è¦çš„ï¼Œå®‰è£…æ—¶éœ€è¦è®¾ç½®ç›¸åº”ç¯å¢ƒå˜é‡ `JAVA_HOME`ã€ `ANDROID_HOME`ã€‚App éœ€è¦é€šè¿‡ Android SDK æ¥ç¼–è¯‘æ‰“åŒ…ç”Ÿæˆ apkã€‚Android SDK ç›®å½•ç»“æ„ä¸­ï¼Œ`platforms`ã€ `platform-tools`ã€ `tools`ã€ `build-tools` è¿™å‡ ä¸ªç›®å½•æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œ

`platforms` åŒ…å«æ˜¯æ¯ä¸ªå¹³å°çš„SDKçœŸæ­£çš„æ–‡ä»¶ï¼Œå³å¼€å‘å‡ºæ¥çš„ App å°†ä¼šè¿è¡Œåœ¨è¿™é‡ŒæŒ‡å®šç‰ˆæœ¬çš„å¹³å°ä¹‹ä¸Šï¼Œå³ `targetsdkversion`ï¼Œè¿™ä¸ªç‰ˆæœ¬å·æ˜¯æ ¹æ® API Level åˆ’åˆ†çš„ SDK ç‰ˆæœ¬ï¼Œæ¯ä¸€ä¸ª Level éƒ½å¯¹åº”ä¸€ä¸ª Android ç³»ç»Ÿç‰ˆæœ¬ã€‚é¡¹ç›®å¼€å‘æ—¶ä½¿ç”¨çš„ SDK ç‰ˆæœ¬å·ä¸º `compilesdkversion`ï¼Œé¡¹ç›®å¯ä»¥è®¾ç½®ä¸€ä¸ªç›®æ ‡ç‰ˆæœ¬å· `targetsdkversion` ç”¨æ¥ç¡®å®æœŸå¾…è¿è¡Œåœ¨ä»€ä¹ˆç‰ˆæœ¬çš„ Android ç³»ç»Ÿä¸Šï¼Œå› ä¸º Android æä¾›å‘å‰å…¼å®¹ï¼Œéœ€è¦é€šè¿‡ç›®æ ‡ç‰ˆæœ¬å·å’Œæœ€å°ç‰ˆæœ¬å· `minsdkversion` æ¥ç¡®å®šé¡¹ç›®åº”è¯¥ä½¿ç”¨åˆ°å“ªäº›å…¼å®¹ç‰¹æ€§ã€‚

`platform-tools` åŒ…å« Android å¹³å°ç›¸å…³çš„é€šç”¨å·¥å…·ï¼Œæ¯”å¦‚ç®¡ç†æ¨¡æ‹Ÿå™¨å’Œè¿é€šçœŸæœºçš„ä¸‡èƒ½å·¥å…· Android Debug Bridge `adb`ã€ åˆ·æœºå·¥å…· `Fastboot` ç­‰ï¼Œæ—§ç‰ˆæœ¬ SDK ä¸­å’Œ `platforms`ã€`build-tools` ç›®å½•ä¼šæœ‰äº›é‡å¤ã€‚

`tools` åŒ…å«äº† Android çš„å¼€å‘å’Œè°ƒè¯•å·¥å…·ï¼Œæ¯”å¦‚ Dalvik Debug Monitor Service `ddms.jar` è°ƒè¯•æœåŠ¡å·¥å…·ã€‚æ¨¡æ‹Ÿå™¨ SD æ˜ åƒåˆ›å»ºå·¥å…· `mksdcard.exe`ï¼Œè™šæ‹Ÿè°ƒè¯•å™¨ä¸»ç¨‹åº `emulator.exe`ï¼Œä» Android 1.5 å¼€å§‹ï¼Œéœ€è¦è¾“å…¥åˆé€‚çš„å‚æ•°æ‰èƒ½å¯åŠ¨æ¨¡æ‹Ÿå™¨ã€‚TraceView åˆ™æ˜¯ Android å¹³å°é…å¤‡ä¸€ä¸ªå¾ˆå¥½çš„æ€§èƒ½åˆ†æçš„å·¥å…·ã€‚

`build-tools` åŒ…å«å’Œç¼–è¯‘æ‰“åŒ…ç›¸å…³çš„é€šç”¨å·¥å…·ï¼Œå¦‚èµ„æºæ‰“åŒ…å·¥å…· Android Asset Packaging Tool `aapt.exe`ï¼Œå·¥å…·å¯ä»¥æŸ¥çœ‹ã€åˆ›å»ºã€æ›´æ–° ZIP æ ¼å¼çš„æ–‡æ¡£é™„ä»¶å¦‚ zipã€ jarã€ apkã€‚è¿˜æœ‰æ¥å£å®šä¹‰è¯­è¨€ Android Interface Definition Language ç¼–è¯‘å™¨ `aidl.exe`ï¼ŒAIDL æ˜¯ä¸€ç§è¿›ç¨‹é€šä¿¡æ¥å£çš„æè¿°è¯­è¨€ï¼Œé€šè¿‡å¯ä»¥å®šä¹‰è¿›ç¨‹é—´çš„é€šä¿¡æ¥å£ã€‚Dex æ ¼å¼è½¬æ¢å·¥å…· `dx.jar`ï¼ŒAndroid ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ Dalvik è™šæ‹Ÿæœºï¼Œéœ€è¦å°† Java ç¼–è¯‘çš„å­—èŠ‚ç è½¬è¯‘æˆ Dex æ ¼å¼ã€‚`dexdump.exe` å³è¿è¡Œä¸­çš„ Android åº”ç”¨åœ¨å†…å­˜ä¸­çš„æ˜ åƒåˆ†æå·¥å…·ï¼Œé€šè¿‡å®ƒå¯ä»¥æŸ¥çœ‹å‡º dex æ–‡ä»¶çš„æ‰§è¡Œæƒ…å†µï¼Œç²—ç•¥åˆ†æå‡ºåŸå§‹ Java ä»£ç æ˜¯ä»€ä¹ˆæ ·çš„ã€‚

Android SDK æ–‡ä»¶ä¸­ `system-images` ç›®å½•ä¸‹çš„ä»¿çœŸå®‰å“ç³»ç»Ÿé•œåƒç”¨äºæ¨¡æ‹Ÿå™¨ï¼Œå ç”¨ç¡¬ç›˜ç©ºé—´æœ€å¤šï¼Œé€‰æ‹©å½“å‰ç³»ç»Ÿè¿è¡Œçš„æ˜ åƒæ–‡ä»¶å°±å¯ä»¥äº†ï¼Œå¦‚å½“å‰ä¸»æœºæ˜¯ Intel x86 CPUï¼Œåªè¦ä¸‹è½½ `Intel x86 Atom System Image`ã€‚



## âš¡ Flutter Workflows
- Dart SDK https://github.com/dart-lang/sdk
- The Flutter engine https://github.com/flutter/engine
- Introduction to Dart VM https://mrale.ph/dartvm/
- Dartè™šæ‹Ÿæœºè¿è¡ŒåŸç† http://gityuan.com/2019/10/05/dart_vm/
- Flutter è·¨å¹³å°æ¼”è¿›åŠæ¶æ„å¼€ç¯‡ http://gityuan.com/flutter/
- Flutter engine rchitecture https://github.com/flutter/flutter/wiki/The-Engine-architecture
- Flutter architectural overview https://flutter.dev/docs/resources/architectural-overview
- Reverse engineering Flutter apps https://blog.tst.sh/reverse-engineering-flutter-apps-part-1/
- https://dart.cn/tools/dart-compile

Flutter ä¸ Dart æ˜¯ä¼´ç”Ÿçš„ï¼Œä¸ ReactNative æ¯”è¾ƒï¼š

ReactNative

- é‡‡ç”¨ JavaScript å¼€å‘ï¼Œéœ€è¦æŒæ¡ React
- éœ€è¦æ¡¥æ¥ JavaScript åˆ° Nativeï¼Œè½¬åŒ–è¿‡ç¨‹æœ‰æ€§èƒ½è€—æŸ
- è®¿é—®åŸç”Ÿ UIï¼Œé¢‘ç¹æ“ä½œæ˜“å‡ºæ€§èƒ½é—®é¢˜
- æ”¯æŒçº¿ä¸ŠåŠ¨æ€æ€§ï¼Œå¯æœ‰æ•ˆé¿å…é¢‘ç¹æ›´æ–°ç‰ˆæœ¬

Flutter

- é‡‡ç”¨ Dart å¼€å‘ï¼Œå¯ç›´æ¥ç¼–è¯‘æˆ Native ä»£ç 
- è‡ªå¸¦ UI ç»„ä»¶å’Œ Skia æ¸²æŸ“å¼•æ“ï¼Œä»…ä¾èµ–ç³»ç»Ÿæä¾›çš„ Canvasï¼Œæ— æ¡¥æ¥è€—æŸ
- æš‚ä¸æ”¯æŒçº¿ä¸ŠåŠ¨æ€æ€§

Flutter æ¶æ„ä¸»è¦åˆ†æˆ Frameworkã€Engineã€Embedder ä¸‰éƒ¨åˆ†ï¼Œç¤ºæ„å¦‚ä¸‹ï¼š

    =============================================================
    | Framework (Dart)                                          |
    | ========================================================= |
    | |           Material       |        Cupertino           | |
    | ========================================================= |
    | |                       Widgets                         | |
    | ========================================================= |
    | |                      Rendering                        | |
    | ========================================================= |
    | |      Animation   |   Painting   |   Gestures          | |
    | ========================================================= |
    | |                   Foundation                          | |
    =============================================================
    | Engine (C/C++)                                            |
    | ========================================================= |
    | Service Protocol   | Composition      | Platform Channels |
    | ========================================================= |
    | Dart Isolate Setup | Rendering        | System Events     |
    | ========================================================= |
    | Dart VM Management | Frame Scheduling | Asset Resolution  |
    | ========================================================= |
    |                    | Frame Pipelining | Text Layout       |
    =============================================================
    | Embedder (Platform Specific)                              |
    | ========================================================= |
    | Render Sudace Setup | Native Plugins     | Packaging |
    | ========================================================= |
    | Thread Setup        | Event Loop Interop |           |
    =============================================================
    https://blog.tst.sh/content/images/2020/02/framework.png

Flutter çš„ç³»ç»Ÿæ¶æ„åŒ…å«å¤§é‡åŸºäº Material Design é£æ ¼è®¾è®¡çš„èµå¿ƒæ‚¦ç›®ã€å¿«é€Ÿã€å¯å®šåˆ¶ã€å¯æ‰©å±•çš„ Widgetsï¼Œä¸éœ€è¦ä½¿ç”¨ç³»ç»Ÿ UI ç»„ä»¶ï¼ˆæˆ– DOM WebViewsï¼‰ã€‚

Flutter æ¡†æ¶ä¸­å­˜åœ¨ä¸€ä¸ª Rendering piplineï¼Œç”±ç³»ç»Ÿæä¾›çš„å‚ç›´åŒæ­¥ä¿¡å·é©±åŠ¨ï¼Œåœ¨ Android ä¸Šï¼Œè¿™ä¸ªä¿¡å·å°±æ˜¯ Android V-Sync ä¿¡å·ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºç¡¬ä»¶å®šæ—¶ä¸­æ–­ï¼Œå‘¨æœŸæ€§çš„ç¡¬ä»¶ä¸­æ–­ï¼Œé¢‘ç‡ä¸º 60Hzï¼Œå‘¨æœŸä¸º 16msã€‚

æ˜¾ç¤ºå™¨å¹¶ä¸æ˜¯ä¸€æ¬¡æ€§å°†ç”»é¢æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œè€Œæ˜¯ä»å·¦åˆ°å³è¾¹ï¼Œä»ä¸Šåˆ°ä¸‹é€è¡Œæ‰«ææ˜¾ç¤ºï¼Œä¸è¿‡è¿™ä¸€è¿‡ç¨‹å¿«åˆ°äººçœ¼æ— æ³•å¯Ÿè§‰åˆ°å˜åŒ–ï¼Œç°ä»£çš„æ¶²æ™¶å±å¹•å¸¸ç”¨ 60 Hz åˆ·æ–°ç‡åˆ·æ–°ï¼Œè¿™ä¹Ÿè¡¨ç¤º GPU åœ¨ä¸€ç§’å†…ç»˜åˆ¶å±å¹•çš„å¸§æ•°ã€‚é€šå¸¸ï¼Œ12 fps å°±å¯ä»¥è¾¾åˆ°äººçœ¼çš„è§†è§‰æš‚ç•™ç°è±¡å¼•èµ·çš„åŠ¨ç”»æ•ˆåº”ï¼Œä¾‹å¦‚ç”µå½±é‡‡ç”¨ 24 fpsï¼Œåœ¨æ¸¸æˆä¸­éœ€è¦æ›´é«˜çš„ fps å¦‚ 120 æˆ– 150 fps æ‰æœ‰é€¼çœŸçš„æ•ˆæœï¼Œå› ä¸ºæ¸¸æˆå›¾åƒçš„åˆ‡æ¢ä¸­ï¼Œè¾¹ç¼˜æ˜¯æ¸…æ™°ã€‚

åœ¨æ¯ä¸ªä¿¡å·å‘¨æœŸå†…ï¼ŒFlutter ä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œä¸€ç³»åˆ—ç¨‹åºåŠ¨ä½œï¼Œæœ€ç»ˆç”Ÿæˆ Scene é€å¾€åº•å±‚ï¼Œç”± GPU ç»˜åˆ¶åˆ°å±å¹•ä¸Š: 

- åŠ¨ç”»é˜¶æ®µ Animateï¼š å› ä¸ºåŠ¨ç”»ä¼šéšæ¯ä¸ª Vsync ä¿¡å·çš„åˆ°æ¥è€Œæ”¹å˜ Stateï¼Œæ‰€ä»¥åŠ¨ç”»é˜¶æ®µæ˜¯æµæ°´çº¿çš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚
- æ„å»ºé˜¶æ®µ Buildï¼š é‡æ–°æ„å»ºçš„éœ€è¦æ›´æ–°çš„ Widgetï¼Œå³ StatelessWidget.build() æˆ–è€… State.build() è¢«è°ƒç”¨ã€‚
- å¸ƒå±€é˜¶æ®µ Layoutï¼š ç¡®å®šå„ä¸ªæ˜¾ç¤ºå…ƒç´ çš„ä½ç½®ã€å°ºå¯¸ï¼Œå³ RenderObject.performLayout() è¢«è°ƒç”¨ã€‚
- ç»˜åˆ¶é˜¶æ®µ Paintï¼š æ­¤æ—¶ RenderObject.paint() è¢«è°ƒç”¨ã€‚

Flutter App åªæœ‰åœ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™éœ€è¦è§¦å‘æ¸²æŸ“æµæ°´çº¿ï¼ŒApp ä»€ä¹ˆéƒ½ä¸åšçš„æ—¶å€™ä¸éœ€è¦é‡æ–°æ¸²æŸ“é¡µé¢ã€‚æ‰€ä»¥ï¼ŒVsync ä¿¡å·éœ€è¦ App å»è°ƒåº¦ï¼Œæ¯”å¦‚ï¼ŒæŸä¸ªé¡µé¢éœ€è¦å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æœ‰å¯èƒ½ä¼šè°ƒç”¨ State.setState()ï¼Œè¿™ä¸ªè°ƒç”¨æœ€ç»ˆä¼šå‘èµ· Vsync ä¿¡å·çš„è¯·æ±‚ç»™åº•å±‚ã€‚ç„¶ååº•å±‚ä¼šåœ¨ Vsync ä¿¡å·åˆ°æ¥çš„æ—¶å€™é©±åŠ¨æ¸²æŸ“æµæ°´çº¿å¼€å§‹è¿ä½œï¼Œæœ€åæŠŠæ–°çš„é¡µé¢æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚

Dart VM æœ‰å¤šç§æ–¹å¼å»è¿è¡Œ Dart ä»£ç ï¼Œæ¯”å¦‚ï¼š

- JIT æ¨¡å¼è¿è¡Œæºç æˆ–è€… Kernal binaryï¼›
- Snapshot æ–¹å¼è¿è¡Œï¼šAppAOT snapshot å’Œ AppJIT shanpshotï¼›

ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äº VM å°†æºç è½¬æ¢æˆå¯æ‰§è¡Œä»£ç çš„æ—¶æœºå’Œæ–¹å¼ã€‚

åœ¨ Dart ä¸­ï¼Œå®ƒçš„çº¿ç¨‹è¿è¡Œäº Isolateï¼Œå°±æ˜¯è™šæ‹Ÿæœºä¸­çš„ä¸€ä¸ªéš”ç¦»è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥çœ‹ä½œä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹è¿›ç¨‹ã€‚è¿™ä¸ªæ¦‚å¿µæºè‡ª V8 è™šæ‹Ÿæœºï¼Œä¹Ÿç§°ä¸ºä¸ºæ²™ç®±ã€‚

ä»»ä½• Dart ä»£ç éƒ½è¿è¡Œåœ¨ isolate ç¯å¢ƒä¸­çš„ mutator çº¿ç¨‹ï¼Œæ¯ä¸ª isolate å®ä¾‹å…·æœ‰è‡ªå·±çš„å†…å­˜(å †)å’Œçº¿ç¨‹æ§åˆ¶çš„éš”ç¦»è¿è¡Œç¯å¢ƒã€‚é™¤äº†åŒ…å«ä¸€ä¸ª mutator çº¿ç¨‹ï¼Œisolate è¿˜å¯ä»¥æœ‰å¤šä¸ª helper çº¿ç¨‹ï¼Œå®ƒä»¬è´Ÿè´£å¤„ç† Dart å†…éƒ¨ä»»åŠ¡ï¼Œå¦‚åå°è¿è¡Œ GCã€JIT ç­‰ä»»åŠ¡ã€‚

å¤šä¸ª isolate ä¹‹é—´æ— æ³•å…±äº«å†…å­˜ç©ºé—´ï¼Œå› æ­¤ä¹Ÿä¸å­˜åœ¨é”ç«äº‰é—®é¢˜ï¼Œå„è‡ªæœ‰ç‹¬ç«‹çš„ event loopã€‚åªèƒ½é€šè¿‡ Port ä¼ é€’æ¶ˆæ¯ï¼Œç„¶ååœ¨å¦ä¸€ä¸ª isolate ä¸­å¤„ç†ç„¶åå°†ç»“æœä¼ é€’å›æ¥ï¼Œè¿™æ · UI çº¿ç¨‹å°±æœ‰æ›´å¤šä½™åŠ›å¤„ç† pipelineï¼Œè€Œä¸ä¼šè¢«å¡ä½ã€‚

Root isolate è´Ÿè´£ UI æ¸²æŸ“ä»¥åŠç”¨æˆ·äº¤äº’æ“ä½œï¼Œéœ€è¦åŠæ—¶å“åº”ã€‚åŸºäºäº‹ä»¶å¾ªç¯çš„å¼‚æ­¥æ¨¡å‹ä»ç„¶æ˜¯æœ‰å¾ˆå¤§ç¼ºç‚¹çš„ï¼Œå½“ä»»åŠ¡é˜Ÿåˆ—å­˜åœ¨è€—æ—¶æ“ä½œï¼Œä¼šæ‹–æ…¢æ•´ä¸ªäº‹ä»¶å¾ªç¯çš„å¤„ç†ï¼Œç”šè‡³æ˜¯é˜»å¡ï¼Œåˆ™å¿…é¡»åˆ›å»ºæ–°çš„ isolateï¼Œå¦åˆ™ UI æ¸²æŸ“ä¼šè¢«é˜»å¡ã€‚ 

![Dart Isolates](https://mrale.ph/dartvm/images/isolates.png)

Dart 2 VM å¼€å§‹ï¼Œä¸å†æ”¯æŒç›´æ¥è¿è¡Œ Dart ä»£ç ï¼Œè€Œæ˜¯è¿è¡Œ Kernel binaries å³åŒ…å«åºåˆ—åŒ–çš„ Kernel AST çš„ dill æ–‡ä»¶ã€‚ç”± Common front-end (CFE) è´Ÿè´£å°†ä»£ç è½¬è¯‘ä¸º Kernel ASTï¼Œè¿™ä¸ªåŠŸèƒ½ç”±å„ç§ Dart tools å¦‚ VM, dart2js, Dart Dev Compiler æä¾›ã€‚

ä¸ºäº†ä¿æŒç›´æ¥ä»æºä»£ç æ‰§è¡Œ Dart çš„ä¾¿åˆ©æ€§ï¼Œç‹¬ç«‹çš„ Dart å¯æ‰§è¡Œæ–‡ä»¶å¯„ä¸»åœ¨ä¸€ä¸ªåä¸º Kernel service çš„ Helper çº¿ç¨‹ï¼Œå®ƒè´Ÿè´£å°† Dart æºä»£ç ç¼–è¯‘ä¸º Kernel binaryï¼Œç„¶åç”± VM å°†å…¶è¿è¡Œåœ¨ Isolate å®ä¾‹ä¸­ã€‚

![Kernel Service](https://mrale.ph/dartvm/images/kernel-service.png)

è¿™å¹¶ä¸æ˜¯ CFE å’Œ VM è¿è¡Œ Dart ä»£ç çš„å”¯ä¸€æ–¹å¼ï¼Œåœ¨ Flutter æ¡†æ¶ä¸­ï¼Œå°†ç¼–è¯‘å’Œæ‰§è¡Œä»å†…æ ¸å®Œå…¨åˆ†ç¦»ï¼Œå°†å®ƒä»¬æ”¾åœ¨ä¸åŒçš„è®¾å¤‡ä¸Šï¼šç¼–è¯‘å‘ç”Ÿåœ¨å¼€å‘ä¸»æœºä¸Šï¼Œæ‰§è¡Œåœ¨ç›®æ ‡ç§»åŠ¨è®¾å¤‡ä¸Šå¤„ç†ï¼Œç›®æ ‡ç§»åŠ¨è®¾å¤‡æ¥æ”¶ç”± Flutter å·¥å…·å‘é€çš„ Kernel binaryã€‚

![Flutter CFE](https://mrale.ph/dartvm/images/flutter-cfe.png)

    ================      | flutter run --debug  |    =================     =======================
    | Dart sources |  ->  | ==================== | -> | Kernel binary |  -> | Flutter Engine (VM) |
    ================      | Frontend_server(CFE) |    =================     =======================

Dart VM ä¸€æ—¦åŠ è½½å®Œå†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±ä¼šè¢«è§£æå¹¶åˆ›å»ºè¡¨ç¤ºå„ç§ç¨‹åºå®ä½“çš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œè¿™æ˜¯æ‡’æƒ°åœ°å®Œæˆçš„ï¼šé¦–å…ˆåªåŠ è½½æœ‰å…³åº“å’Œç±»çš„åŸºæœ¬ä¿¡æ¯ã€‚å†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶çš„æ¯ä¸ªå®ä½“éƒ½ä¿ç•™ä¸€ä¸ªæŒ‡å‘è¯¥äºŒè¿›åˆ¶æ–‡ä»¶çš„æŒ‡é’ˆï¼Œä»¥ä¾¿ä»¥åå¯ä»¥æ ¹æ®éœ€è¦åŠ è½½æ›´å¤šä¿¡æ¯ã€‚

![Kernel binary loading](https://mrale.ph/dartvm/images/kernel-loading-1.png)
![Kernel binary loading](https://mrale.ph/dartvm/images/kernel-loading-2.png)

Snapshots å°±æ˜¯ Dart VM è¿è¡Œä¸­çš„ç¨‹åºæ˜ åƒï¼Œé€šè¿‡ä¸²è¡ŒåŒ–ä¿å­˜åˆ°å¿«ç…§æ–‡ä»¶ï¼Œç„¶åå†é€šè¿‡åä¸²è¡ŒåŒ–åŠ è½½æ˜ åƒæ–‡ä»¶åˆ°è™šæ‹Ÿæœºï¼Œå¯ä»¥èŠ‚çœé‚£äº›éœ€è¦é‡å¤æ‰§è¡Œåˆæ¶ˆè€—æ—¶é—´çš„æ“ä½œï¼Œå¦‚è„šæœ¬è¿è¡Œç¯å¢ƒä¸­çš„å…¨å±€ç¬¦å·åˆå§‹è®¾ç½®ï¼Œå¯ä»¥å®ç°ç¨‹åºçš„å¿«é€Ÿå¯åŠ¨ã€‚

AppJIT Snapshot çš„å¼•å…¥å¯ä»¥è§£å†³å¤§å‹ Dart åº”ç”¨ç¨‹åºçš„ JIT é¢„çƒ­æ—¶é—´ï¼Œå¦‚ dartanalyzer æˆ– dart2jsã€‚å½“è¿™äº›å·¥å…·ç”¨äºå°é¡¹ç›®æ—¶ï¼Œå®ƒä»¬å®é™…å·¥ä½œä¸Šçš„æ—¶é—´æ¶ˆè€—å’Œ VM èŠ±åœ¨ JIT ç¼–è¯‘è¿™äº›åº”ç”¨ç¨‹åºä¸Šçš„æ—¶é—´ä¸€æ ·å¤šã€‚

åœ¨æ‰§è¡Œ dart å‘½ä»¤æ—¶ï¼Œé€šè¿‡è®¾ç½®å‘½ä»¤è¡Œå‚æ•° --snapshot-kind=app-jit --snapshot=path-to-snapshot å³å¯ä»¥ç”Ÿæˆ AppJIT å¿«ç…§æ–‡ä»¶ï¼š

```sh
# Run from source in JIT mode.
$ dart pkg/compiler/lib/src/dart2js.dart -o hello.js hello.dart
Compiled 7,359,592 characters Dart to 10,620 characters JavaScript in 2.07 seconds
Dart file (hello.dart) compiled to JavaScript: hello.js

# Training run to generate app-jit snapshot
$ dart --snapshot-kind=app-jit --snapshot=dart2js.snapshot \
   pkg/compiler/lib/src/dart2js.dart -o hello.js hello.dart
Compiled 7,359,592 characters Dart to 10,620 characters JavaScript in 2.05 seconds
Dart file (hello.dart) compiled to JavaScript: hello.js

# Run from app-jit snapshot.
$ dart dart2js.snapshot -o hello.js hello.dart
Compiled 7,359,592 characters Dart to 10,620 characters JavaScript in 0.73 seconds
Dart file (hello.dart) compiled to JavaScript: hello.js
```

è€Œ AppAOT Snapshot åˆ™æ˜¯ä¸ºä¸å¯èƒ½è¿›è¡Œ JIT ç¼–è¯‘çš„å¹³å°å¼•å…¥çš„ï¼Œä½†å®ƒä»¬ä¹Ÿå¯ä»¥ç”¨äºå¿«é€Ÿå¯åŠ¨å’Œä¸€è‡´æ€§èƒ½å€¼å¾—æ½œåœ¨å³°å€¼æ€§èƒ½æŸå¤±çš„æƒ…å†µã€‚

AOT ç¼–è¯‘è¿‡ç¨‹ä¼šè¿›è¡Œå…¨å±€é™æ€åˆ†æ TFA - Type flow analysis ä»¥ç¡®å®šåº”ç”¨ç¨‹åºçš„å“ªäº›éƒ¨åˆ†å¯ä»¥ä»å·²çŸ¥çš„å…¥å£ç‚¹è®¿é—®ï¼Œä»¥åŠç±»å‹å¦‚ä½•åœ¨ç¨‹åºä¸­æµåŠ¨ã€‚æ‰€æœ‰è¿™äº›åˆ†æéƒ½æ˜¯ä¿å®ˆçš„ï¼šè¿™æ„å‘³ç€å®ƒä»¬ä¼šåœ¨æ­£ç¡®æ€§æ–¹é¢æœ‰æ‰€å‡ºå…¥ï¼Œè¿™ä¸ JIT å¯èƒ½åœ¨æ€§èƒ½æ–¹é¢æœ‰æ‰€å‡ºå…¥å½¢æˆé²œæ˜å¯¹æ¯”ï¼Œå› ä¸ºå®ƒæ€»æ˜¯å¯ä»¥å»ä¼˜åŒ–ä¸ºæœªä¼˜åŒ–çš„ä»£ç æ¥å®ç°æ­£ç¡®çš„è¡Œä¸ºã€‚

![AppAOT Snapshot](https://mrale.ph/dartvm/images/aot.png)

Flutter ä½¿ç”¨ Dart ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œè‡ªç„¶å’Œ Dart çš„ç¼–è¯‘æ¨¡å¼è„±ç¦»ä¸äº†å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ Dart çš„ç¼–è¯‘æ¨¡å¼ã€‚

- Script: å¼€å‘é˜¶æ®µå¸¸ç”¨çš„ JIT æ¨¡å¼ï¼Œå°±åƒ Node.js é‚£æ ·ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œ Dart æºä»£ç ã€‚
- Script Snapshot: æ­¤æ¨¡å¼è½½å…¥çš„æ˜¯å·²ç» token åŒ–çš„ Dart æºç ï¼Œæå‰åšäº†ç¼–è¯‘æœŸé—´çš„ Lexer æ­¥éª¤ï¼Œä¹Ÿæ˜¯å±äº JIT æ¨¡å¼ã€‚
- Application Snapshot: JIT æ¨¡å¼ï¼ŒDart VM ç›´æ¥è½½å…¥ dump å‡ºçš„ snapshot æ•°æ®ï¼Œç”¨äºåŠ é€Ÿå¯åŠ¨ç¨‹åºã€‚
- AOT: Dart æºä»£ç ä¼šè¢«ç¼–è¯‘æˆæ±‡ç¼–æ–‡ä»¶ï¼Œæ±‡ç¼–å†ç»è¿‡æ±‡ç¼–å™¨ç”Ÿæˆä¸åŒæ¶æ„ä¸‹çš„äºŒè¿›åˆ¶ä»£ç ã€‚

Dart exe å­å‘½ä»¤ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºåªæ˜¯ç”¨å«æœ‰ç±»å‹æ£€æŸ¥å’Œ garbage collection åŠŸèƒ½çš„ Dart Runtime å°è£…ç¨‹åºä»£ç ï¼Œä»¥å®ç° Windows, macOS, Linux è·¨å¹³å°çš„è¿è¡Œèƒ½åŠ›ï¼Œå’Œ Deno ä¸­çš„åšæ³•ç±»ä¼¼ã€‚

è™½ç„¶ Flutter é‡‡ç”¨ Dartï¼Œä½†ç”±äº Android å’Œ iOS å¹³å°å·®å¼‚ï¼ŒFlutter ä¹Ÿè¡ç”Ÿå‡ºäº†éå¸¸ä¸°å¯Œçš„ç¼–è¯‘æ¨¡å¼ã€‚

- Scriptï¼šåŒ Dart Scriptï¼Œè™½ç„¶ Flutter æ”¯æŒï¼Œä½†æš‚æœªçœ‹åˆ°ä½¿ç”¨ï¼Œæ¯•ç«Ÿå½±å“å¯åŠ¨é€Ÿåº¦ï¼›
- Script Snapshotï¼šåŒ Dart Script Snapshot ä¸€è‡´ï¼ŒåŒæ ·æ”¯æŒä½†æœªä½¿ç”¨ï¼ŒFlutter æœ‰å¤§é‡çš„è§†å›¾æ¸²æŸ“é€»è¾‘ï¼Œçº¯ JIT æ¨¡å¼å½±å“æ‰§è¡Œé€Ÿåº¦ï¼›
- Kernel Snapshotï¼šAOT ç¼–è¯‘ï¼ŒDart çš„ bytecode æ¨¡å¼ï¼Œä¹Ÿå« Core Snapshotï¼Œä¸ Application Snapshot ä¸åŒï¼Œæ­¤æ¨¡å¼ä¸åŒºåˆ† CPU æ¶æ„ï¼›
- Core JITï¼šDart çš„ä¸€ç§äºŒè¿›åˆ¶æ¨¡å¼ï¼Œä¹Ÿå« AOTBlobï¼Œå°†æŒ‡ä»¤ä»£ç å’Œ heap æ•°æ®æ‰“åŒ…æˆæ–‡ä»¶ï¼Œç„¶ååœ¨ VM å’Œ isolate å¯åŠ¨æ—¶è½½å…¥ï¼Œç›´æ¥æ ‡è®°å†…å­˜å¯æ‰§è¡Œï¼›
- AOT Assembly: å³ Dart çš„ AOT æ¨¡å¼ã€‚ç›´æ¥ç”Ÿæˆæ±‡ç¼–æºä»£ç æ–‡ä»¶ï¼Œç”±å„å¹³å°è‡ªè¡Œæ±‡ç¼–ã€‚

åœ¨å¼€å‘é˜¶æ®µï¼Œæ”¯æŒ Hot Reload å’Œ Hot Restart åŠŸèƒ½ï¼Œæ–¹ä¾¿ UI å¿«é€Ÿæˆå‹ã€‚åŒæ—¶ï¼Œæ¡†æ¶å±‚ä¹Ÿéœ€è¦æ¯”è¾ƒé«˜çš„æ€§èƒ½æ¥è¿›è¡Œè§†å›¾æ¸²æŸ“å±•ç°ã€‚å› æ­¤å¼€å‘æ¨¡å¼ä¸‹ï¼ŒFlutter ä½¿ç”¨äº† Kernel Snapshot æ¨¡å¼ç¼–è¯‘ã€‚

åœ¨æ‰“åŒ…äº§ç‰©ä¸­ï¼Œä½ å°†å‘ç°å‡ æ ·ä¸œè¥¿ï¼š

- isolate_snapshot_dataï¼šç”¨äºåŠ é€Ÿ isolate å¯åŠ¨ï¼Œä¸šåŠ¡æ— å…³ä»£ç ï¼Œå›ºå®šï¼Œä»…å’Œ flutter engine ç‰ˆæœ¬æœ‰å…³ï¼›
- platform.dillï¼šå’Œ Dart VM ç›¸å…³çš„ kernel ä»£ç ï¼Œä»…å’Œ Dart ç‰ˆæœ¬ä»¥åŠ engine ç¼–è¯‘ç‰ˆæœ¬æœ‰å…³ã€‚å›ºå®šï¼Œä¸šåŠ¡æ— å…³ä»£ç ï¼›
- vm_snapshot_data: ç”¨äºåŠ é€Ÿ Dart VM å¯åŠ¨çš„äº§ç‰©ï¼Œä¸šåŠ¡æ— å…³ä»£ç ï¼Œä»…å’Œ flutter engine ç‰ˆæœ¬æœ‰å…³ï¼›
- kernel_blob.binï¼šä¸šåŠ¡ä»£ç äº§ç‰©

Dart å¼¹æ€§ç¼–è¯‘æŠ€æœ¯æ”¯æŒï¼š

- Dart Native: é’ˆå¯¹å„ç§è®¾ç½®å¼€å‘ (mobile, desktop, server, and more)ï¼ŒåŒ…å« Dart VMï¼Œè‡ªå¸¦ JIT (just-in-time) ç¼–è¯‘å’Œ AOT (ahead-of-time) ç¼–è¯‘ã€‚
- Dart Web: é’ˆå¯¹ Web åº”ç”¨å¼€å‘ï¼ŒåŒ…æ‹¬å¼€å‘æ—¶ç¼–è¯‘å™¨ (dartdevc) å’Œç”Ÿäº§æ—¶ç¼–è¯‘å™¨ (dart2js)ã€‚

é€šè¿‡ Dart FFI -  foreign function interface è°ƒç”¨ C è¯­è¨€ç¼–å†™çš„æ—¢æœ‰ä»£ç åº“ï¼Œä»è€Œå¢å¼ºå¯ç§»æ¤æ€§ï¼Œè¿˜å¯ä»¥é€šè¿‡ç²¾å¿ƒæ‰“ç£¨çš„ C ä»£ç å®Œæˆå¯¹æ€§èƒ½è¦æ±‚æä¸ºä¸¥è‹›çš„ä»»åŠ¡ã€‚ä» Dart 2.12 èµ·ï¼ŒDart FFI -  foreign function interface å·²ç»“æŸ Beta æµ‹è¯•é˜¶æ®µï¼Œç°å·²è¿›å…¥ç¨³å®šçŠ¶æ€ï¼Œå¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€äº›æ–°åŠŸèƒ½ï¼ŒåŒ…æ‹¬åµŒå¥—ç»“æ„å’ŒæŒ‰å€¼ä¼ é€’ç»“æ„ã€‚



## âš¡ HelloWorld
- dart: The Dart command-line tool https://dart.dev/tools/dart-tool
- Web platform https://dart.dev/web
- Bindings for the ReactJS library https://pub.dev/packages/react
- Bindings for the Vue.js library https://pub.dev/packages/vue

Dart æ˜¯é’ˆå¯¹ç°ä»£ Web æµè§ˆå™¨çš„æ–°è¯­è¨€ï¼Œè‰¯å¥½ç»“æ„åŒ–é€‚åˆä»å°å‹åˆ°å¤§å‹çš„ Web åº”ç”¨ã€‚æœ€åˆæ˜¯ç”± Google çš„ Chrome V8 å›¢é˜Ÿæ‰“é€ ï¼Œä¸»è¦æˆå‘˜åŒ…æ‹¬è™šæ‹Ÿæœºå’Œç¼–ç¨‹è¯­è¨€å¤§å¸ˆ Lars Bakã€Gilad Bracha ç­‰äººã€‚

Dart æ˜¯ä¸€ç§å¼€æºçš„ã€é€šç”¨çš„ã€åŸºäºç±»çš„ã€é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå…·æœ‰ C è¯­è¨€é£æ ¼çš„è¯­æ³•ï¼Œç”¨äºæ„å»ºç§»åŠ¨ã€æ¡Œé¢å’Œ Web åº”ç”¨ç¨‹åºã€‚å®ƒæ”¯æŒå„ç§ç¼–ç¨‹æ¦‚å¿µï¼Œå¦‚æ¥å£ã€ç±»ã€é›†åˆã€æ³›å‹ã€æ··åˆå’Œå¯é€‰ç±»å‹ã€‚å®ƒç”±è°·æ­Œå¼€å‘ï¼Œåæ¥è¢« ECMA æ‰¹å‡†ä¸ºæ ‡å‡†ã€‚

Dart æœ¬èº«æ˜¯åŠ¨æ€è¯­è¨€ï¼Œæ˜¯ä¸€ç§ç®€å•ã€ç†Ÿæ‚‰çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼ŒåŸºäºç±»ã€å•ç»§æ‰¿ã€å¤šå®ç°ï¼Œå¯é€‰çš„é™æ€ç±»å‹ï¼Œå•çº¿ç¨‹ï¼Œæ”¯æŒå¼‚æ­¥ï¼ˆFutureï¼‰å’Œå¹¶å‘ï¼ˆIsolateï¼‰ç¼–ç¨‹ã€‚æ”¯æŒåº“ï¼Œæœ‰è‡ªå·±çš„åŒ…ç®¡ç†å·¥å…· Pubã€‚Dart æœ‰è‰¯å¥½çš„å·¥å…·æ”¯æŒï¼ˆDart Editorï¼‰ï¼Œæ”¯æŒè°ƒè¯•ã€é‡æ„ã€ä»£ç è‡ªåŠ¨å®Œæˆã€ä»£ç å¯¼èˆªã€é™æ€ä»£ç åˆ†æï¼ˆæ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯ï¼‰â€¦â€¦

Dart æœ‰è®¸å¤šéå¸¸å¥½è¯­è¨€ç‰¹æ€§ï¼Œæ¯”å¦‚æ–¹æ³•çº§è”è°ƒç”¨ã€å·¥å‚æ„é€ å‡½æ•°ã€å¯é€‰ç±»å‹ã€å­—æ®µä¸æ–¹æ³•ç»Ÿä¸€çš„ getter/setterã€å¯é€‰å‚æ•°ã€æ¥å£å’Œç±»çš„ç»Ÿä¸€ã€æä¾›æ¥å£çš„é»˜è®¤å®ç°ã€æ“ä½œç¬¦é‡è½½ã€Markdownæ³¨é‡Šç­‰ã€‚æ¯”å¦‚æ–¹æ³•çº§è”è°ƒç”¨æ˜¯è¯­è¨€çº§åˆ«çš„æ”¯æŒï¼Œå‡è½»äº†è®¾è®¡è€…å‰æœŸçš„è®¾è®¡è´Ÿæ‹…ã€‚

Dart æœ‰è‡ªå·±åŸç”Ÿçš„è™šæ‹Ÿæœºï¼Œå¯ä»¥ç›´æ¥åœ¨ VM ä¸Šè¿è¡Œï¼Œå¹¶ä¸”æ€§èƒ½é«˜äº JavaScript V8ã€‚é«˜æ€§èƒ½æœ¬èº«å°±æ˜¯ Dart çš„ç›®æ ‡ä¹‹ä¸€ï¼Œä»¥ snapshot çš„æ–¹å¼å¯ä»¥ä½¿åº”ç”¨å¯åŠ¨é€Ÿåº¦æé«˜ 10 å€ï¼ˆä»…é™VMï¼‰ã€‚

åˆ›å»ºä¸€ä¸ª dart ä»£ç æ–‡ä»¶ï¼Œå’Œ C è¯­è¨€ç±»ä¼¼éœ€è¦ä¸€ä¸ª main å‡½æ•°ï¼š

```ts
// void main(){ ... }
// void main()=>{ ... }
void main(List<String> args) {
  print('Hello, World! ${args}');
}
```

å…¥å£å‡½æ•° main æ¥æ”¶ä¸€ä¸ªåˆ—è¡¨æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°ï¼Œå‡½æ•°å¯ä»¥ä½¿ç”¨ç®­å¤´æ ¼å¼ã€‚

ä½¿ç”¨ dart å‘½ä»¤å¯ä»¥ç›´æ¥ç”Ÿæˆå·¥ç¨‹ï¼Œå¯ä»¥æŒ‡å®šæ¨¡æ¿ï¼Œç„¶åé€šè¿‡å‘½ä»¤è¿è¡Œï¼Œæˆ–å°†å…¶ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ–è€…è½¬è¯‘ä¸º JavaScriptï¼š

    dart create demo
    dart run
    dart run demo.dart
    dart run [pkg]:prog

    dart compile js demo.dart
    dart compile exe demo.dart

å°è¯•åˆ›å»ºä¸€ä¸ª Web åº”ç”¨ï¼Œå¹¶ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· webdev è¿è¡Œå®ƒï¼š

    dart pub global activate webdev
    dart create -t web-simple quickstart
    cd quickstart
    webdev serve

å‚è€ƒ Web è„šæœ¬ï¼š

```js
import 'dart:convert';
import 'dart:html';

void main(List<String> args) async {
  var heliodoxa = 'https://cn.bing.com/th?id=OHR.Heliodoxa_ZH-CN9872355419_1920x1080.jpg';
  var img = Element.img();
  img.setAttribute('src', heliodoxa);
  var api = 'https://api.github.com/users/jimboyeah';
  var jn = await HttpRequest.getString(api).then((res) => json.decode(res));
  querySelector('#output')
    ..text = 'Your Dart app is running.'+ jn['bio']
    ..children.add(img);
}
```

Flutter å®˜æ–¹ç½‘ç«™é¡¹ç›®å°±æ˜¯ Dart å·¥ç¨‹ï¼Œå¯ä»¥å…‹éš†ä»£ç ä»“åº“ï¼š

    $ git clone --recurse-submodules https://github.com/flutter/website.git

    $ git submodule update --init --recursive
    $ git pull; git submodule update --init --recursive

å‘½ä»¤å‚è€ƒï¼š

    A command-line utility for Dart development.

    Usage: dart [<vm-flags>] <command|dart-file> [<arguments>]

    Global options:
    -h, --help                 Print this usage information.
    -v, --verbose              Show additional command output.
        --version              Print the Dart SDK version.
        --enable-analytics     Enable anonymous analytics.
        --disable-analytics    Disable anonymous analytics.

    Available commands:
      analyze   Analyze the project's Dart code.
      compile   Compile Dart to various formats.
      create    Create a new project.
      format    Idiomatically format Dart source code.
      pub       Work with packages.
      run       Run a Dart program.
      test      Run tests in this package.


    Usage: dart compile <subcommand> [arguments]
    -h, --help    Print this usage information.

    Available subcommands:
      aot-snapshot   Compile Dart to an AOT snapshot.
      exe            Compile Dart to a self-contained executable.
      jit-snapshot   Compile Dart to a JIT snapshot.
      js             Compile Dart to JavaScript.
      kernel         Compile Dart to a kernel snapshot.


    Usage: dart create [arguments] <directory>
    -h, --help        Print this usage information.
    -t, --template    The project template to use.
                      [console-simple (default), console-full, package-simple, web-simple]
        --[no-]pub    Whether to run 'pub get' after the project has been created.
                      (defaults to on)
        --force       Force project generation, even if the target directory already exists.

    Run "dart help" to see global options.

    Available templates:
      console-simple: A simple command-line application. (default)
        console-full: A command-line application sample.
      package-simple: A starting point for Dart libraries or applications.
          web-simple: A web app that uses only core Dart libraries.


## âš¡ Dart Pub ä¾èµ–ç®¡ç†
- pub package manager https://dart.dev/tools/pub/cmd
- How to use packages https://dart.dev/guides/packages
- Pakcage layout https://dart.dev/tools/pub/package-layout
- Dart doc https://github.com/dart-lang/dartdoc#dartdoc
- Effective Dart: Documentation guide https://dart.dev/guides/language/effective-dart/documentation

Pub is a package manager for Dart or Flutter.

åˆ›å»º dart å·¥ç¨‹åï¼Œé¡¹ç›®é…ç½®æ–‡ä»¶ pubspec.yaml æŒ‡å®šçš„ name å°±æ˜¯åŒ…åã€‚

å’ŒåŒ…ç›¸å…³çš„å‡ ä¸ªå…³é”®å­—æ˜¯ export import library deferred part part-of show hideï¼Œä»¥ä¸‹é€ä¸ªè§£é‡Šå…³é”®å­—çš„ä½¿ç”¨ã€‚

æ ¹æ®åŒ…çš„æ¥æºå±äºæ ¸å¿ƒè¿˜æ˜¯ç¤¾åŒºï¼Œå¼•å…¥åŒ…æ—¶åˆ†åˆ«æŒ‡å®š dart æˆ– package å‰ç¼€ï¼Œé…åˆ show å’Œ hide å¯¼å…¥éƒ¨åˆ†å†…å®¹ã€‚

```js
import 'dart:io' 
import 'package:lib1/libfile.dart' 

import 'package: lib1/lib1.dart' show foo, bar;  
import 'package: lib1/lib1.dart' show foo, bar;  
// Import only foo and bar. 

import 'package: mylib/mylib.dart' hide foo;  
import 'package: mylib/mylib.dart' hide foo;  
// Import all names except foo
```

åˆ›å»ºè‡ªå®šä¹‰åŒ…åªéœ€è¦ä½¿ç”¨ `library` å®šä¹‰ï¼Œç„¶ååœ¨å…¶å®ƒä»£ç æ–‡ä»¶ä¸­é€šè¿‡ `import` å¼•ç”¨ã€‚

å¦å¤–é…åˆ `part` å’Œ `part-of` å®ç°æ‹†åˆ†åº“ï¼Œå°†ä¸€ä¸ªåºå¤§çš„åº“æ‹†åˆ†æˆå„ç§å°åº“ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—åˆ†åˆ«ç”¨äºå¯¼å…¥æ‹†åˆ†åº“ã€å®šä¹‰æ‹†åˆ†åº“ã€‚

ä»¥ä¸‹å‡å®šä¸º library.dart ä»£ç ä¸­çš„åº“å®šä¹‰ï¼Œå¹¶ä¸” part-of-library.dart æ˜¯ä¸€ä¸ªæ‹†åˆ†åº“æ–‡ä»¶ï¼ŒåŒ…å« `part of library_name;` è¿™æ ·çš„å®šä¹‰ã€‚

```ts
library library_name
part 'include/part-of-library.dart'
// library contents go here 
```

ä½¿ç”¨æ—¶ï¼Œé€šè¿‡ `import` å¯¼å…¥ï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨ç›¸å¯¹ç›®å½•çš„æ–¹å¼å¯¼å…¥ï¼š

```ts
// Within the same directory
import 'library_name.dart'

// From a different directory
import 'dir/library_name.dart'
```

å¯¼å…¥å¯¼å‡ºéœ€è¦æ³¨æ„ Diamond Imports é—®é¢˜ï¼Œå‡è®¾ä¸€ä¸ªåº“ `food` åŒ…å« IceCreamCone å®šä¹‰ï¼Œå¹¶è¢«å¦å¤–ä¸¤ä¸ªåº“ `cooking` å’Œ `containers` å¯¼å…¥åå†å¯¼å‡ºï¼Œè€Œ `kitchen` å†å¯¼å…¥å®ƒä»¬æ—¶ï¼Œå°±ä¼šå¾—åˆ°è¿™ä¸¤ä¸ªåº“å¯¼å‡ºçš„ä¸¤ä¸ª IceCreamConeã€‚ä½†è¿™å¹¶ä¸æ˜¯é”™è¯¯ï¼Œå› ä¸ºå®ƒå°±æ˜¯é€šè¿‡ `food` è¿™ä¸ªåº“å¯¼å‡ºçš„ï¼ŒDart åªç»™å‡ºè­¦å‘Šä¿¡æ¯ã€‚

ä½†æ˜¯ï¼Œè€ƒè™‘ä¸€ç§æƒ…å†µï¼Œå‡è®¾ `containers` å®šä¹‰äº†è‡ªå·±çš„ IceCreamConeï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸¤ä¸ªä¸åŒçš„åŒåç±»å‹ã€‚`containers` åº“ä¿æŒäº†å®ƒçš„å…¬å…± API ä¸å˜ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸ä¼šé‡åˆ°ä»»ä½•å›°éš¾ã€‚ä½†æ˜¯ï¼Œæ›´æ”¹ä¼šå¯¼è‡´ä»£ç éæ³•ï¼Œç¼–è¯‘å™¨ç»™å‡ºè­¦å‘Šä¿¡æ¯ã€‚è­¦å‘Šå¾ˆæœ‰ç”¨ï¼Œè¿™æ ·ç¨‹åºå‘˜å°±ä¸ä¼šå¿½è§†æ½œåœ¨çš„åå­—å†²çªï¼Œè¿™æ˜¯é¼“åŠ±çš„æœ€ä½³å®è·µï¼Œå³å§‹ç»ˆé¿å…å«ç³Šä¸æ¸…ã€‚


åœ¨å¼•å…¥çš„åŒ…æ–‡ä»¶åè¿˜å¯ä»¥é€šè¿‡ `as` æŒ‡å®šå‘½åç©ºé—´å‰ç¼€ï¼Œä»¥é˜²æ­¢å’Œå…¶å®ƒæ ‡è¯†å†²çªã€‚

æ”¯æŒå»¶è¿Ÿè½½å…¥åº“ Deferred loading å¯ä»¥è®©åº”ç”¨åœ¨éœ€è¦çš„æ—¶å€™å† loadLibrary() å‡½æ•°æ¥åŠ è½½ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨å»¶è¿ŸåŠ è½½åº“çš„åœºæ™¯ï¼š

- å‡å°‘ APP çš„å¯åŠ¨æ—¶é—´ã€‚
- æ‰§è¡Œ A/B æµ‹è¯•ï¼Œä¾‹å¦‚ å°è¯•å„ç§ç®—æ³•çš„ ä¸åŒå®ç°ã€‚
- åŠ è½½å¾ˆå°‘ä½¿ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¯é€‰çš„å±å¹•å’Œå¯¹è¯æ¡†ã€‚

```js
import 'package:deferred/hello.dart' deferred as hello;

greet() async {
  await hello.loadLibrary();
  hello.printGreeting();
}
```

åœ¨ä¸€ä¸ªåº“ä¸Šä½ å¯ä»¥å¤šæ¬¡è°ƒç”¨ loadLibrary() å‡½æ•°ï¼Œä½†æ˜¯åªæ˜¯è½½å…¥ä¸€æ¬¡ã€‚

ä½¿ç”¨å»¶è¿ŸåŠ è½½åº“çš„æ—¶å€™ï¼Œè¯·æ³¨æ„ä¸€ä¸‹é—®é¢˜ï¼š

- å»¶è¿ŸåŠ è½½åº“çš„å¸¸é‡åªæœ‰åœ¨åº“åŠ è½½å®Œæ¯•çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨ã€‚
- åœ¨å¯¼å…¥æ–‡ä»¶çš„æ—¶å€™æ— æ³•ä½¿ç”¨å»¶è¿Ÿåº“ä¸­çš„ç±»å‹ï¼Œå¯ä»¥è€ƒè™‘æŠŠæ¥å£ç±»å‹ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªåº“ä¸­ï¼Œ è®©ä¸¤ä¸ªåº“éƒ½åˆ†åˆ«å¯¼å…¥è¿™ä¸ªæ¥å£åº“ã€‚
- Dart éšå«çš„æŠŠ loadLibrary() å‡½æ•°å¯¼å…¥åˆ° deferred as æŒ‡å®šçš„å‘½åç©ºé—´ä¸­ï¼Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª Futureã€‚

åœ¨åº“ä¸­å®šä¹‰ç§æœ‰å•å…ƒéœ€è¦ä½¿ç”¨ä»¥ä¸‹åˆ’çº¿ä½œä¸ºæ ‡è¯†ç¬¦å‰ç¼€ï¼Œè¿™æ ·åªæœ‰åœ¨åº“å†…éƒ¨å¯è§ã€‚æ¯ä¸ª Dart app éƒ½æ˜¯ä¸€ä¸ªåº“ï¼Œ å³ä½¿æ²¡æœ‰ä½¿ç”¨ library å‘½ä»¤ä¹Ÿæ˜¯ä¸€ä¸ªåº“ã€‚

    dart create -t package-simple tt
    Creating /flutter/tt using template package-simple...

    .gitignore
    CHANGELOG.md
    README.md
    analysis_options.yaml
    example\tt_example.dart
    lib\tt.dart
    lib\src\tt_base.dart
    pubspec.yaml
    test\tt_test.dart

    Running pub get...
    Resolving dependencies...
    Downloading test 1.15.7...
    Downloading test_core 0.3.11+4...
    Downloading test_api 0.2.18+1...
    Downloading source_map_stack_trace 2.0.0...
    Downloading coverage 0.14.2...
    Downloading boolean_selector 2.0.0...
    Downloading node_preamble 1.4.13...
    Downloading vm_service 4.2.0...
    Changed 51 dependencies!

ä»å‘½ä»¤ä¸­ç”Ÿæˆçš„æ¨¡æ¿ä¹Ÿå¯ä»¥äº†è§£åˆ°ç›®å½•ç»“æ„ï¼Œåº“ä»£ç ä½äº lib ç›®å½•ä¸­ï¼Œåœ¨å…¶ä»–åŒ…ä¸­é€šè¿‡ `import` å¯¼å…¥å°±æ˜¯è®¿é—®è¿™é‡Œé¢çš„ä»£ç ã€‚ åœ¨ lib ç›®å½•ä¸‹å¯ä»¥åˆ›å»ºä»»æ„çš„ç›®å½•ç»“æ„ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æŠŠå®ç°ä»£ç æ”¾åˆ° lib/src ç›®å½•ä¸­ã€‚ä½äº lib/src ä¸‹é¢çš„ä»£ç è¢«è®¤ä¸ºæ˜¯ç§æœ‰çš„ï¼Œå…¶ä»–åŒ…ä¸åº”è¯¥ç›´æ¥å¯¼å…¥ src é‡Œé¢çš„ä»£ç ã€‚è¦åˆ†äº« lib/src ä¸‹çš„ APIï¼Œå¯ä»¥åœ¨ lib ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å¯¼å…¥ lib/src ä¸­çš„ä»£ç ã€‚

ä¾‹å¦‚ï¼Œåº“å¯¹è±¡å¯¼å‡ºå†…å®¹ç¼–å†™åœ¨ tt.dart æ–‡ä»¶ï¼š

```js
/// Support for doing something awesome.
///
/// More dartdocs go here.
library tt;

export 'src/tt_base.dart';

// TODO: Export any libraries intended for clients of this package.
```

æŠŠåº“é¡¹ç›®æäº¤åˆ°ç‰ˆæœ¬åº“ä¸­çš„æ—¶å€™ï¼Œè¿‡æ»¤æ‰ .packages å’Œ pubspec.lock è¿™äº›æ–‡ä»¶ï¼Œä¹Ÿä¸è¦æäº¤ packages ç›®å½•ã€‚

åœ¨ç¤ºèŒƒç›®å½•ä¸­å·²ç»æä¾›äº†ä¸€ä¸ª tt_example.dartï¼Œæ³¨æ„ `import` æŒ‡å®šçš„ tt æ˜¯åˆ›å»ºåº“æ—¶æŒ‡å®šçš„ï¼Œå³ pubspec.yaml é…ç½®çš„ name å±æ€§ã€‚

```js
import 'package:tt/tt.dart';

void main() {
  var awesome = Awesome();
  print('awesome: ${awesome.isAwesome}');
}
```

ç¼–å†™å¥½çš„åº“ï¼Œç»è¿‡å•å…ƒæµ‹è¯•åï¼Œä½¿ç”¨ pub publish å‘½ä»¤å¯ä»¥åœ¨ pub.dev ä¸Šåˆ†äº«ä½ çš„åº“ã€‚

é€šå¸¸ï¼Œä¸€ä¸ªåº“éœ€è¦ç›¸åº”çš„æ–‡æ¡£ï¼ŒDart æ”¯æŒä½¿ç”¨ Markdown æ³¨è§£ç”Ÿæˆæ–‡æ¡£ï¼Œä½¿ç”¨ dartdoc å‘½ä»¤å¯ä»¥ä¸º Library ç”Ÿæˆ API æ–‡æ¡£ï¼Œå®ƒä¼šè§£ææºæ–‡ä»¶ä¸­çš„ /// è¯­æ³•æ ‡æ³¨çš„æ–‡æ¡£æ³¨é‡Šï¼ŒåŒæ—¶ä¼šç”Ÿæˆä¸€ä¸ª index.json ä½œä¸ºå†…å®¹æœç´¢ç´¢å¼•æ–‡ä»¶ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¿€æ´» dartdoc å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œå®ƒç”Ÿæˆæ–‡æ¡£ï¼š

    dart pub global activate dartdoc
    dartdoc

ä¾‹å¦‚ï¼Œä»¥ä¸‹æ³¨è§£ä¼šç”Ÿæˆä¸€ä¸ª JSON æ–‡ä»¶ï¼š

    /// {@category Basics}
    /// {@category Assets, Images, and Icons}
    /// {@subCategory Information displays}
    /// {@image <image alt='' src='/images/catalog-widget-placeholder.png'>}
    class Icon extends StatelessWidget {}

å¯¹åº”çš„ categories.json æ–‡ä»¶å†…å®¹ï¼š

    [{
        "name": "Icon",
        "qualifiedName": "widgets.Icon",
        "href": "widgets/Icon-class.html",
        "type": "class",
        "categories": ["Assets, Images, and Icons", "Basics"],
        "subcategories": ["Information displays"],
        "image": "<image alt='' src='/images/catalog-widget-placeholder.png'>"
    }]

ä»¥ä¸‹ç¤ºèŒƒæ¨¡æ¿å®šä¹‰ä¸å®é…åˆä½¿ç”¨ï¼Œä»¥åŠ Markdown è¯­æ³•ä½¿ç”¨ï¼š

    /// {@template template_name}
    /// {@animation name 100 200 path/to/some/video.mp4}
    /// # Markdown
    /// ```dart
    /// print("Hello part-of...");
    /// ```
    /// - Item 1
    /// - Item 2
    /// ![å®‹ä¼˜ç§€](https://p26.douyinpic.com/img/tos-cn-p-0015/1d60cf46f17f438c9e06fe5c760b7186_1624437711~c5_300x400.jpeg)
    /// {@endtemplate}

    /// Some comment
    /// {@macro template_name}
    /// More comments

åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸­å¯ä»¥é…ç½® dartdoc_options.yaml ä»¥å®ç°å®šåˆ¶éœ€æ±‚ï¼š

```yaml
dartdoc:
  categories:
    "First Category":
      markdown: doc/First.md
      name: Awesome
    "Second Category":
      markdown: doc/Second.md
      name: Great
  categoryOrder: ["First Category", "Second Category"]
  examplePathPrefix: 'subdir/with/examples'
  includeExternal: ['bin/unusually_located_library.dart']
  nodoc: ['lib/sekret/*.dart']
  linkTo:
    url: "https://my.dartdocumentationsite.org/dev/%v%"
  showUndocumentedCategories: true
  ignore:
    - ambiguous-doc-reference
  errors:
    - unresolved-doc-reference
  warnings:
    - tool-error
```

Pub å‘½ä»¤å‚è€ƒï¼š

    Usage: pub <command> [arguments]

    Global options:
    -h, --help             Print this usage information.
        --version          Print pub version.
        --[no-]trace       Print debugging information when an error occurs.
        --verbosity        Control output verbosity.

              [all]        Show all output including internal tracing messages.
              [error]      Show only errors.
              [io]         Also show IO operations.
              [normal]     Show errors, warnings, and user messages.
              [solver]     Show steps during version resolution.
              [warning]    Show only errors and warnings.

    -v, --verbose          Shortcut for "--verbosity=all".

    Available commands:
      cache       Work with the system cache.
      deps        Print package dependencies.
      downgrade   Downgrade the current package's dependencies to oldest versions.
      get         Get the current package's dependencies.
      global      Work with global packages.
      logout      Log out of pub.dartlang.org.
      outdated    Analyze your dependencies to find which ones can be upgraded.
      publish     Publish the current package to pub.dartlang.org.
      run         Run an executable from a package.
      upgrade     Upgrade the current package's dependencies to latest versions.
      uploader    Manage uploaders for a package on pub.dartlang.org.
      version     Print pub version.

## âš¡ Unit Test
- Dart Testing https://dart.dev/guides/testing
- Testing Flutter Apps https://flutter.dev/docs/testing
- https://pub.flutter-io.cn/packages/test
- https://pub.flutter-io.cn/packages/webdriver
- https://api.flutter.dev/flutter/flutter_test/flutter_test-library.html

å•å…ƒæµ‹è¯•æ˜¯ä¸€ç§å¸¸ç”¨çš„æµ‹è¯•æ–¹å¼ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯å°†ä»£ç åˆ’åˆ†ä¸ºæœ€å°å¯æµ‹è¯•ç²’åº¦è¿›è¡Œå•ç‹¬æµ‹è¯•ã€‚

è½¯ä»¶æµ‹è¯•æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€ä¸ªåŸºæœ¬æµç¨‹ï¼ŒåŸºäºå•å…ƒæµ‹è¯•ï¼Œè¿˜è¡ç”Ÿå‡ºæµ‹è¯•é©±åŠ¨å¼€å‘ TDDï¼šTest-Driven Developmentï¼Œå³é€šè¿‡æµ‹è¯•æ¥æŒ‡å¯¼å¼€å‘ã€‚

å¸¸è§çš„æµ‹è¯•æŠ€æœ¯ï¼š

- Unit tests å•å…ƒæµ‹è¯•èšé›†äºæœ€å°å¯æµ‹è¯•ä»£ç ï¼Œå¦‚å‡½æ•°ã€æ–¹æ³•ã€ç±»å¯¹è±¡ç­‰ã€‚
- Component tests ç»„ä»¶æµ‹è¯•é€šå¸¸æ¨¡ä»¿ç”¨æˆ·æ“ä½œæ¥æ£€æŸ¥æ•´ä¸ªç»„ä»¶çš„è¡Œä¸ºã€æ€§èƒ½ã€äº‹ä»¶ã€å¸ƒå±€ç­‰ã€‚
- Integration and end-to-end tests é›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•å…³æ³¨çš„æ˜¯æ•´ä¸ªåº”ç”¨çš„æµ‹è¯•ï¼ŒåŒ…å«åº”ç”¨ç¨‹åºæœ¬èº«å’Œæµ‹è¯•åº”ç”¨ç¨‹åºï¼Œé€šå¸¸åœ¨çœŸå®è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œ Appï¼Œè¿›è¡Œæ€§èƒ½ç­‰æµ‹è¯•ã€‚

å¯¹äº Web åº”ç”¨ï¼Œå¯ä»¥è¿è¡Œäºæµè§ˆå™¨ä¸­ï¼Œå¹¶é€šè¿‡æµ‹è¯•æ¥å£å¯¹åº”ç”¨è¿›è¡Œæµ‹è¯•ã€‚Dart æä¾›äº† package:webdriver æ¥å£é€šè¿‡ WebDriver servers æ¥æ“ä½œæµè§ˆå™¨ã€‚

å¯¹äºå•å…ƒæµ‹è¯•ï¼ŒDart å¹³å°æä¾›äº† package:test å’Œ package:mockito ä¸¤ä¸ªåº“ã€‚

å¯ä»¥ä½¿ç”¨ package:test æ¥ï¼š

- ç¼–å†™å•ä¸ªæˆ–ä¸€ç»„æµ‹è¯•ã€‚
- ä½¿ç”¨ `@TestOn` æ³¨è§£é™åˆ¶æµ‹è¯•åœ¨ç‰¹å®šçš„ç¯å¢ƒä¸­è¿è¡Œã€‚
- åƒç¼–å†™åŒæ­¥æµ‹è¯•ä¸€æ ·ç¼–å†™å¼‚æ­¥æµ‹è¯•ã€‚
- ä½¿ç”¨ `@Tag` æ³¨è§£è¿›è¡Œ Tag æµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰ Tag ä¸ºæŸäº›æµ‹è¯•åˆ›å»ºè‡ªå®šä¹‰é…ç½®ï¼Œ æˆ–è¡¨ç¤ºä¸€äº›æµ‹è¯•å®Œæˆéœ€è¦æ›´å¤šçš„æ—¶é—´ã€‚
- åˆ›å»ºä¸€ä¸ª dart_test.yaml æ–‡ä»¶ï¼Œä»¥è·¨å¤šä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªåŒ…é…ç½® Tag æµ‹è¯•ã€‚

å¥½çš„å•å…ƒæµ‹è¯•åº”å½“åŒ…å«å››ç§ç‰¹æ€§ï¼šæ­£ç¡®ï¼Œæ¸…æ™°ï¼Œå®Œæ•´ï¼Œå¥å£®

- æ­£ç¡®ï¼šå•å…ƒæµ‹è¯•æ˜¯æœ€åŸºç¡€çš„è¦æ±‚ï¼Œå¿…é¡»è¦ä¿è¯æ‰€å†™çš„å‡½æ•°æˆ–è€…ç±»å®ç°çš„åŠŸèƒ½æ˜¯æ­£ç¡®çš„ï¼Œå¦‚æœå®ç°çš„åŠŸèƒ½éƒ½ä¸èƒ½æ»¡è¶³ï¼Œé‚£å°±æ˜¯ç¼ºé™·ï¼
- æ¸…æ™°ï¼šå•å…ƒæµ‹è¯•å¯ä»¥å¸®åŠ©å…¶ä»–å¼€å‘ç†è§£å‡½æ•°æˆ–è€…ç±»çš„å®ç°ï¼Œæ‰€ä»¥è¦æ±‚å•å…ƒæµ‹è¯•ç”¨ä¾‹ç®€æ´ã€æ¸…æ™°ï¼Œéœ€è¦æœ‰è‰¯å¥½çš„å¯è¯»æ€§ã€‚
- å®Œæ•´ï¼šå•å…ƒæµ‹è¯•éœ€è¦è€ƒè™‘è¾“å…¥ä¸è¾“å‡ºç»„åˆçš„å„ç§åœºæ™¯ï¼Œä¿è¯å•å…ƒæµ‹è¯•çš„è¦†ç›–ç‡ã€‚
- å¥å£®ï¼šå¥å£®æ€§æ˜¯æœ€å®¹æ˜“è¢«å¿½ç•¥çš„ä¸€é¡¹ï¼Œå½“è¢«æµ‹è¯•çš„ç±»æˆ–è€…å‡½æ•°è¢«ä¿®æ”¹å†…éƒ¨å®ç°æˆ–è€…æ·»åŠ åŠŸèƒ½æ—¶ï¼Œâ¼€ä¸ªå¥½çš„å•æµ‹åº”è¯¥å®Œå…¨ä¸éœ€è¦è¢«ä¿®æ”¹æˆ–è€…åªæœ‰æå°‘çš„ä¿®æ”¹ã€‚

å•å…ƒæµ‹è¯•çš„ä»£ç ç»“æ„ä¸€èˆ¬åŒ…å«ä¸‰éƒ¨åˆ†ï¼š

- å‡†å¤‡ï¼šå‡†å¤‡éƒ¨åˆ†çš„â½¬çš„æ˜¯å‡†å¤‡å¥½è°ƒâ½¤æ‰€éœ€è¦çš„å¤–éƒ¨ç¯å¢ƒï¼Œå¦‚æ•°æ®ï¼ŒStubï¼ˆæ¡©ä»£ç ï¼‰ï¼ŒMockï¼Œä¸´æ—¶å˜é‡ï¼Œè°ƒâ½¤è¯·æ±‚ï¼Œç¯å¢ƒèƒŒæ™¯å˜é‡ç­‰ç­‰ã€‚
- è°ƒç”¨ï¼šè°ƒâ½¤éƒ¨åˆ†åˆ™æ˜¯å®é™…è°ƒâ½¤éœ€è¦æµ‹è¯•â½…æ³•ï¼Œå³å‡½æ•°æˆ–è€…æµç¨‹æœ¬èº«ã€‚
- æ–­è¨€ï¼šæ–­â¾”éƒ¨åˆ†åˆ¤æ–­è°ƒâ½¤éƒ¨åˆ†çš„è¿”å›ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

å•å…ƒæµ‹è¯•çš„ä¸‰ä¸ªé‡è¦éƒ¨åˆ†ï¼š

- é©±åŠ¨ç¨‹åº Driver ä¹Ÿç§°ä½œé©±åŠ¨æ¨¡å—ï¼Œç”¨ä»¥æ¨¡æ‹Ÿè¢«æµ‹æ¨¡å—çš„ä¸Šçº§æ¨¡å—ï¼Œèƒ½å¤Ÿè°ƒç”¨è¢«æµ‹æ¨¡å—ã€‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œé©±åŠ¨æ¨¡å—æ¥æ”¶æµ‹è¯•æ•°æ®ï¼Œè°ƒç”¨è¢«æµ‹æ¨¡å—å¹¶æŠŠç›¸å…³çš„æ•°æ®ä¼ é€ç»™è¢«æµ‹æ¨¡å—ã€‚
- æ¡©ç¨‹åº Stub ä¹Ÿç§°æ¡©æ¨¡å—ï¼Œç”¨æ¥ä»£æ›¿å…³è”ä»£ç æˆ–è€…æœªå®ç°çš„ä»£ç ï¼Œä¸ºäº†è®©æµ‹è¯•å¯¹è±¡å¯ä»¥æ­£å¸¸çš„æ‰§è¡Œï¼Œå…¶å®ä¸€èˆ¬ä¼šç¡¬ç¼–ç ä¸€äº›è¾“å…¥å’Œè¾“å‡ºï¼Œä¿è¯è¢«æµ‹æ¨¡å—èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚
- æ¨¡æ‹Ÿ Mockï¼Œé™¤äº†ä¿è¯Stubçš„åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜å¯æ·±å…¥çš„æ¨¡æ‹Ÿå¯¹è±¡ä¹‹é—´çš„äº¤äº’æ–¹å¼ï¼Œå¦‚ï¼šè°ƒç”¨äº†å‡ æ¬¡ã€åœ¨æŸç§æƒ…å†µä¸‹æ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸ä»¥åŠæä¾›æ•°æ®æ–­è¨€ã€‚

ä»¥ä¸‹æ˜¯ç¼–å†™å•å…ƒæµ‹è¯•çš„ä¸€èˆ¬æ­¥éª¤ï¼š

- Step 1: Installing the "test" package
- Step 2: Importing the "test" package
- Step 3: Writing Tests
- Step 3: Execute Tests

Dart é›†æˆå•å…ƒæµ‹è¯•åŠŸèƒ½ï¼Œå¦‚ä½•åˆ›å»ºä¸€ä¸ªåº“å·¥ç¨‹ï¼Œåˆ™ä¼šé…ç½®å¥½ä¾èµ–ï¼š

    dart create -t package-simple tt

ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ·»åŠ ä¾èµ–åˆ° pubspec.yaml é…ç½®æ–‡ä»¶ï¼š

    dev_dependencies:
      test: ^1.14.4

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºèŒƒï¼š

```js
import 'package:tt/tt.dart';
import 'package:test/test.dart';

void main() {
  group('A group of tests', () {
    Awesome awesome;

    setUp(() {
      awesome = Awesome();
    });

    test('First Test', () {
      expect(awesome.isAwesome, isTrue);
    });
  });
}
```

æ¯ä¸€ä¸ªæµ‹è¯•è°ƒç”¨ä¸€æ¬¡ test å‡½æ•°ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„æ–­è¨€ï¼Œè¿™äº›æµ‹è¯•å¯ä»¥ä½¿ç”¨ group åŒ…è£…èµ·æ¥ä½œä¸ºä¸€ä¸ªæµ‹è¯•åˆ†ç»„ã€‚

ä½¿ç”¨ dart test å‘½ä»¤æ‰§è¡Œæµ‹è¯•ï¼š

```sh
$ dart test
Precompiling executable...
Precompiled test:test.
00:04 +1: All tests passed
```

## âš¡ Types System
- The Dart type system https://dart.dev/guides/language/type-system
- https://api.dart.dev/stable/2.13.4/dart-core/dart-core-library.html
- The IEEE 754 Format http://mathcenter.oxford.emory.edu/site/cs170/ieee754/
- Numerical Computation Guide https://docs.oracle.com/cd/E19957-01/806-3568/ncgTOC.html
- CIS-77 Introduction to Computer Systems - Bits, Numbers Representation http://www.c-jump.com/CIS77/CPU/Numbers/index.html
- https://api.dart.dev/stable/2.13.4/dart-typed_data/dart-typed_data-library.html
- https://api.flutter.dev/flutter/dart-typed_data/TypedData-class.html

Dart æ˜¯ç±»å‹å®‰å…¨è¯­è¨€ï¼Œå…·æœ‰ static type checkingï¼Œè¿˜æœ‰ runtime checks ä»¥ç¡®ä¿å˜é‡ç±»å‹ç¬¦åˆé™æ€ç±»å‹å®šä¹‰ã€‚å°½ç®¡ç±»å‹æ˜¯å¿…éœ€çš„ï¼Œä½†ç”±äº Dart æ”¯æŒç±»å‹æ¨æ–­ï¼Œæ‰€ä»¥ç±»å‹æ³¨é‡Šæ˜¯å¯é€‰çš„ã€‚

Dart ç³»ç»Ÿä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼ŒåŒ…æ‹¬å¸ƒå°”å€¼ true å’Œ falseï¼Œä¹ŸåŒ…æ‹¬æ•°å€¼ã€å­—ç¬¦ä¸²ç­‰ç­‰ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹å®šä¹‰å±€éƒ¨å˜é‡æ—¶éƒ½ä¸éœ€æŒ‡å®šç±»å‹ï¼ŒDart ä»åˆå§‹åŒ–å‚æ•°ä¸­æ„ŸçŸ¥å…·ä½“ç±»å‹ï¼š

```js
num y = 3; // A num can be double or int.
y = 4.0;
var x = 3; // x is inferred as an int.
x = 4.0;   // âœ— static analysis: error/warning
```

åŸºäºä»¥ä¸Šä¸¤ç§ç±»å‹æ£€æŸ¥æœºåˆ¶ï¼ŒDart æä¾›äº†å¥å…¨çš„ç±»å‹ç³»ç»Ÿ sound type systemï¼Œå³è¡¨è¾¾å¼æ€»æ˜¯è¿”å›ç¡®å®šçš„é™æ€ç±»å‹ï¼Œè€Œä¸æ˜¯å…¶å®ƒæ„å¤–çš„ç±»å‹ã€‚

å¥å…¨ç±»å‹ç³»ç»Ÿçš„ä¼˜ç‚¹ï¼š

- Revealing type-related bugs at compile time.
- More readable code.
- More maintainable code.
- Better ahead of time (AOT) compilation.

Dart æœ‰ 8 ç§å†…ç½®æ•°æ®ç±»å‹ï¼š

- `Boolean`ï¼šå¸ƒå°”ç±»å‹ `bool`ï¼Œæœ‰ä¸¤ä¸ªå€¼ `true` å’Œ `false`ã€‚
- `Number`ï¼šæ•°å­—ç±»å‹ `num`ï¼Œåˆåˆ†ä¸º `int` æ•´å‹ï¼Œ64-bit å–å€¼èŒƒå›´ä¸º -2^63 ~ 2^63 - 1ï¼Œå’Œ `double` 64-bit åŒç²¾åº¦æµ®ç‚¹å‹ã€‚
- `String`ï¼šå­—ç¬¦ä¸²ç±»å‹ï¼Œæ˜¯ UTF-16 ç¼–ç çš„åºåˆ—ï¼Œå¯ç”¨ "", '' è¡¨ç¤ºï¼Œå¯ä½¿ç”¨æ¨¡æ¿è¯­æ³• '${expression}'ï¼Œå½“ expression æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦æ—¶å¯çœç•¥ {}ã€‚ 
- `List`ï¼šç›¸å½“äº Arrayï¼Œä¾‹å¦‚ `var arr = [1, 2, 3]`ã€‚
- `Set`ï¼šè¡¨ç¤ºæ— åºä¸”æ— é‡å¤å…ƒç´ çš„é›†åˆï¼Œä¾‹å¦‚ `var cc = {'china', 'usa', 'russia', 'german'}`ã€‚
- `Map`ï¼šè¡¨ç¤ºä¸€ç»„é”®å€¼å¯¹çš„é›†åˆï¼Œå…¶ä¸­é”®å¿…é¡»å”¯ä¸€ï¼Œé”®å’Œå€¼éƒ½å¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼Œä¾‹å¦‚ `var gifts = { '1st': 'partridge', '2nd': 'turtledoves' };`
- `Runes`ï¼šç”¨æ¥è¡¨ç¤º UTF-32 ç¼–ç å­—ç¬¦å€¼ï¼Œä¾‹å¦‚ `String.fromCharCodes(new Runes('\u2665\u{1f605}\u{1f60e}')); // ğŸ˜…ğŸ˜ğŸ‘»`
- `Symbol`ï¼šDart å¼•å…¥ç¬¦å·ç±»å‹çš„æ„ä¹‰åœ¨äºåœ¨å‹ç¼©ä»£ç åï¼Œä¾ç„¶èƒ½é€šè¿‡æ ‡è¯†ç¬¦çš„ Symbol å»è®¿é—®ç›¸å…³çš„æˆå‘˜ã€‚

è¯´æ˜æ•°å€¼çš„æµ®ç‚¹æ•°è¡¨è¾¾ï¼Œæ€»æ˜¯ç¦»ä¸å¼€ IEE 754 æ ¼å¼è§„èŒƒï¼ŒIEEE 754 è§„å®šäº† 3 ç§è¡¨ç¤ºæµ®ç‚¹æ•°å€¼æ ¼å¼ï¼Œå¯¹åº” C è¯­è¨€çš„ C89 è§„èŒƒçš„ä¸‰ç§æµ®ç‚¹ç±»å‹ï¼Œfloatã€doubleã€long doubleã€‚

åœ¨ Web å¹³å°ï¼ŒJavaScript æ•´å½¢æ•°å€¼ä¹Ÿæ˜¯ 64-bit æµ®ç‚¹è¡¨è¾¾ï¼Œåªæ˜¯æ²¡æœ‰å°æ•°éƒ¨åˆ†ï¼Œæœ‰æ•ˆèŒƒå›´æ˜¯ -2^53 ~ 2^53 - 1ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚

IEEE æµ®ç‚¹æ•°æ ‡å‡†æ˜¯ä»é€»è¾‘ä¸Šç”¨ä¸‰å…ƒç»„ {Sï¼ŒEï¼ŒM} æ¥è¡¨ç¤ºä¸€ä¸ªæ•° V çš„ï¼Œå³ V=(-1)SÃ—MÃ—2^Eã€‚

ç¬¦å·ä½ S (sign bit) å†³å®šæ•°çš„æ­£è´Ÿï¼Œæ˜¯æ­£æ•° S=0ï¼Œæ˜¯è´Ÿæ•° S=1ï¼Œè€Œå¯¹äºæ•°å€¼ 0 çš„ç¬¦å·ä½è§£é‡Šåˆ™ä½œä¸ºç‰¹æ®Šæƒ…å†µå¤„ç†ã€‚

æœ‰æ•ˆæ•°å­—ä½ M (Significand) æ˜¯äºŒè¿›åˆ¶å°æ•°ï¼Œåœ¨å†…å­˜è®°å½•ä¸­ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼ŒäºŒè¿›åˆ¶è¡¨è¾¾çœç•¥å¼€å¤´çš„ 1ï¼Œè¿™æ ·å¯ä»¥å¤šåˆ©ç”¨ä¸€ä¸ª bit æ¥å¢åŠ æœ‰æ•ˆç²¾åº¦ã€‚å®ƒçš„å–å€¼èŒƒå›´ä¸º 1 ~ 2^-Îµï¼Œæˆ–è€…ä¸º 0 ~ 1^-Îµã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºå°¾æ•°ä½ Mantissaã€ç³»æ•°ä½ Coefficientï¼Œç”šè‡³è¿˜è¢«ç§°ä½œâ€œå°æ•°â€ã€‚

æŒ‡æ•°ä½ E (Exponent Bias) æ˜¯ 2 çš„å¹‚ï¼Œå¯èƒ½æ˜¯è´Ÿæ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯¹æµ®ç‚¹æ•°åŠ æƒã€‚

å¯¹äº `double` ç±»å‹ï¼Œå°† 64-bit åˆ†æˆ 1-bit ç¬¦å·ä½ï¼Œ11-bit æŒ‡æ•°ä½ï¼Œ53-bit æœ‰æ•ˆä½ï¼Œå¯ä»¥è¡¨è¾¾ 15 ~ 17 ä¸ªåè¿›åˆ¶æ•°å­—ã€‚

åˆ—è¡¨ç±»å‹ `List` å³æ•°ç»„ç±»å‹ï¼Œåªä¸è¿‡ä¸åƒ C è¯­è¨€çš„æ•°ç»„é‚£æ ·å•çº¯æ˜¯å†…å­˜ä¸­çš„ä¸€å—è¿ç»­ç©ºé—´ï¼Œåˆ—è¡¨ä½œä¸ºå¯¹è±¡ç±»å‹ï¼Œå¯ä»¥ä¿å­˜å„ç§ç±»å‹ä½œä¸ºå…ƒç´ ã€‚

è€Œ `Set` å’Œ `Map` ç›¸å¯¹æ¯”åˆ—è¡¨æ›´å¤æ‚çš„æ•°æ®ç»“æ„ç±»å‹ï¼Œé€šå¸¸é€šè¿‡ Hash å‡½æ•°å’ŒäºŒå‰æ ‘æ¥å®ç°å¿«é€Ÿçš„å…ƒç´ æŸ¥æ‰¾ï¼Œä¸‹çº§æ‰©å±•äº† HashSetã€LinkedHashSet å’Œ HashMapã€LinkedHashMapã€SplayTreeMap ç­‰ä¸“ç”¨çš„ç±»å‹ã€‚

Dart æ‰€æœ‰ built-in ç±»å‹éƒ½æ˜¯ class ç±»å‹ï¼Œæ‰€æœ‰ç±»å‹çš„çˆ¶ç±»éƒ½æ˜¯ `Object`ï¼Œé™¤äº† `Null`ï¼Œæ‰€æœ‰çš„å€¼éƒ½æ˜¯å…¶å®ä¾‹ã€‚

                                        ==========
                                        | Object |
                                        ==========
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        ==========  ==========  ==========  =======  =======  =========  ========  ==========  
        |   num  |  | String |  |  List  |  | Set |  | Map |  | Runes |  | Null |  | Symbol |
        ==========  ==========  ==========  =======  =======  =========  ========  ==========  
       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”
    =======  ========== 
    | int |  | double |
    =======  ========== 

ç¬¦å·å­—é¢é‡ä½¿ç”¨ # å‰ç¼€è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥å®ä¾‹åŒ– Symbolï¼š

```js
assert(Symbol("foo") == #foo);
assert(Symbol("[]=") == #[]=);
assert(Symbol("foo.bar") == #foo.bar);
assert(identical(const Symbol("foo"), #foo));
assert(identical(const Symbol("[]="), #[]=));
assert(identical(const Symbol("foo.bar"), #foo.bar));
```

é™¤äº†åŸºç¡€çš„å†…ç½®ç±»å‹ï¼Œè¿˜æœ‰å…¶å®ƒçš„ä¸€äº›ä¸“ç”¨å¯¹è±¡ç±»å‹ï¼š

- `Future` and `Stream`: Used in asynchrony support.
- `Iterable`: Used in for-in loops and in synchronous generator functions.
- `Never`: Indicates that an expression can never successfully finish evaluating.
- `dynamic`: Indicates that you want to disable static checking. Usually you should use Object or Object? instead.
- `void`: Indicates that a value is never used. Often used as a return type.

`Object`, `Object?`, `Null`, `Never` ç±»å‹åœ¨ç±»çš„ç»§æ‰¿ç»“æ„ä¸­æœ‰ç‰¹æ®Šä½œç”¨ï¼ŒæœåŠ¡äºå¥å…¨çš„ Null å®‰å…¨æ€§ã€‚

å¯ä»¥å°† `Object?` çœ‹ä½œæ˜¯ `Object` å’Œ `Null` ä¸¤ä¸ªç±»å‹çš„ç»„åˆï¼Œå…¶å®ƒ nullable ç±»å‹åŒç†ã€‚è€Œ `Null` ç±»å‹ä¸èƒ½å®ä¾‹åŒ–ï¼Œåªèƒ½é€šè¿‡ `null` å…³é”®å­—æ¥è¡¨è¾¾ã€‚

Dart å¯¹ Binary æ•°æ®çš„å¤„ç†èƒ½åŠ›æ˜¯é€šè¿‡ TypedData åŒ…æä¾›çš„ï¼Œå¦‚ ByteDataã€Int8Listã€Uint8ClampedListã€Uint8List ç­‰ç±»å‹ï¼Œè¿™ç§è®¾è®¡è€ƒè™‘åˆ°äº† JavaScript çš„å…¼å®¹ã€‚

ä»¥ä¸‹æ˜¯é€šè¿‡é™æ€ç±»å‹åˆ†æçš„å‡ ç‚¹è§„åˆ™æç¤ºï¼š

- Use sound return types when overriding methods.
- Use sound parameter types when overriding methods.
- Donâ€™t use a dynamic list as a typed list.

ä¾‹å¦‚ï¼Œä»¥ä¸‹çš„ç±»å‹ç»§æ‰¿å…³ç³»ä¸­ï¼ŒHoneyBadger é‡å†™äº†çˆ¶ç±»çš„ chase æ–¹æ³•ï¼Œå¹¶å°†å‚æ•°å£°æ˜ä¸º Objectï¼Œå³å¯ä»¥å¤„ç†æ¯”çˆ¶ç±»æ–¹æ³•ä¸­æ›´å¹¿æ³›çš„ç±»å‹ï¼š

    class Animal 
    {
      void chase(Animal c){}
      Animal? get parent => null;
    }
    class HoneyBadger extends Animal 
    {
      @override
      void chase(Object a) { }
      @override
      HoneyBadger? get parent => null;
    }

è€Œä¸‹é¢çš„ Cat é‡å†™çˆ¶ç±» chase æ–¹æ³•ï¼Œå‚æ•°ä» Animal æ”¶ç´§åˆ° Mouseï¼Œè¿™æ˜¯ Animal çš„ä¸€ä¸ªå­ç±»ã€‚è¿™æ„å‘³å¯å¤„ç†ç±»å‹æ¯”çˆ¶ç±»æ–¹æ³•æ›´çª„ï¼Œæ­¤ä»£ç ä¸æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œå› ä¸ºå¯ä»¥ç»™ Cat å®ä¾‹çš„ chase æ–¹æ³•ä¼ é€’é³„é±¼å®ä¾‹ï¼š

    class Alligator extends Animal { }
    class Mouse extends Animal { }
    class Cat extends Animal 
    {
      @override
      void chase(Mouse x) { }
    }

    Aniaml a = Cat();
    a.chase(Alligator());

ä¸è¦ç»™ç±»å‹åŒ–çš„å˜é‡æŒ‡å®šåŠ¨æ€ç±»å‹ï¼Œå¦‚ä¸‹ï¼š

```js
List<Cat> foo = <dynamic>[Mouse()]; // Error
List<dynamic> bar = <dynamic>[Mouse(), Cat()]; // OK
```
åœ¨ Dart ä¸­ï¼Œæœªåˆå§‹åŒ–çš„å˜é‡æ‹¥æœ‰ä¸€ä¸ªé»˜è®¤çš„åˆå§‹åŒ–å€¼ `null`ã€‚å³ä¾¿æ•°å­—ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºåœ¨ Dart ä¸­ä¸€åˆ‡çš†ä¸ºå¯¹è±¡ï¼Œæ•°å­—ä¹Ÿä¸ä¾‹å¤–ï¼Œè€Œ `final` å£°æ˜å˜é‡æ—¶å¿…é¡»ç»™å®šä¸€ä¸ªåˆå§‹å€¼ï¼Œé™¤éä½¿ç”¨ `late` å»¶ååˆå§‹åŒ–ï¼Œæˆ–è€…å®šä¹‰ä¸º nullable å˜é‡ã€‚

    var some;  // -> null
    bool flag;  // -> null
    int number;  // -> null
    String str;  // -> null
    Object obj;  // -> null
    final namic;  // Error: must be initialized

Dart 2.12 ç‰ˆæœ¬å°†å¥å…¨çš„ç©ºå€¼å®‰å…¨ Sound null safety ä½œä¸ºä¸€ä¸ªé‡ç‚¹åŠŸèƒ½ï¼Œå¼•å…¥äº† ? å’Œ ! ä¸¤ä¸ªç¬¦å·ï¼Œå˜é‡å¯ä»¥å®šä¹‰ nullability æˆ– non-nullability å±æ€§ã€‚

Null safety principles

- Non-nullable by default. Unless you explicitly tell Dart that a variable can be null, itâ€™s considered non-nullable.
- Incrementally adoptable. You can migrate incrementally, mixing null-safe and non-null-safe code in the same project.
- Fully sound. Dartâ€™s null safety is sound, which enables compiler optimizations, fewer bugs, smaller binaries and faster execution.

æ¯”å¦‚ï¼Œä¸€èˆ¬æ˜¯ä¸å¯ä»¥ç›´æ¥å°† null èµ‹å€¼ç»™ int æ•´å½¢å˜é‡ï¼Œå®ç°è¿™ä¸€éœ€æ±‚å¯ä»¥ä½¿ç”¨ ? å®šä¹‰ä¸ºå¯ç©ºå€¼ç±»å‹ã€‚åŒæ—¶ï¼Œä½œä¸º null-aware è¿ç®—ç¬¦ ? å¯ä»¥ç”¨åœ¨ nullable å˜é‡è¡¨è¾¾å¼ä¸­ç¡®ä¿å…¶ä¸ä¸º `null` æ‰æ‰§è¡Œåç»­çš„ä»£ç ã€‚ å¦å¤–ï¼Œå¦‚æœç¡®å®šå˜é‡ä¸ä¸º nullï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ null assertion operator (!) å‘Šè¯‰ç¼–è¯‘å™¨è·¯è¿‡ç©ºå€¼æ£€æŸ¥ï¼Œå¦‚æœå‡ºç°ç©ºå€¼é‚£ä¹ˆå°±ä¼šåœ¨è¿è¡Œæ—¶è§¦å‘å¼‚å¸¸ï¼š

```js
int? a;
a = null;
print('a is $a.');

// Using null safety:
late final String? notAString;
notAString = DateTime.now().millisecond%2==0? null: 'null';
print(notAString?.length);
print(notAString!.toUpperCase()');
```

æ–°çš„åº•å±‚ç±»å‹ `Never` æ˜¯æ²¡æœ‰ä»»ä½•å€¼çš„ï¼Œè¡¨ç¤ºä¸å¯è§¦åŠçš„ä»£ç ï¼Œæ„å‘³ç€è¿™ä¸ªè¡¨è¾¾å¼æ°¸è¿œæ— æ³•æˆåŠŸçš„æ¨å¯¼å’Œæ‰§è¡Œã€‚å®ƒå¿…é¡»è¦æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€ä¸­æ–­æˆ–è€…ç¡®ä¿è°ƒç”¨å®ƒçš„ä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚

```js
// Using null safety:
Never wrongType(String type, Object value) {
  throw ArgumentError('Expected $type, but was ${value.runtimeType}.');
}
```

ä¸åŒ C++ ä¸ Java ä½¿ç”¨ `public`ã€ `protected`ã€ `private` å…³é”®å­—çº¦æŸè®¿é—®æ§åˆ¶æƒï¼ŒDart ç›´æ¥ä½¿ç”¨ä¸‹åˆ’çº¿å¼€å¤´è¡¨ç¤ºç§æœ‰æˆå‘˜ï¼Œå¦‚ `_screct`ã€‚

Dart ç”¨å…³é”®å­— is æˆ– is! æ¥è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œè¿”å›å¸ƒå°”å€¼ï¼Œ`assert` æ–­è¨€ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒå¿½ç•¥ï¼Œdebug æ¨¡å¼å¼€å¯æœ‰æ•ˆã€‚

    var a = 123;
    print(a is dynamic);  // true
    assert(a is Object);  // true


### ğŸ‘‰ var å˜é‡å®šä¹‰
- https://dart.dev/null-safety/understanding-null-safety#late-final-variables

Dart ä¸ºé™æ€ç±»å‹è¯­è¨€ï¼Œå®šä¹‰å˜é‡éœ€è¦æŒ‡å®šç±»å‹ï¼Œæˆ–è€…ä½¿ç”¨ `var` å®šä¹‰ç”±ç¼–è¯‘å™¨è¿›è¡Œç±»å‹æ¨æ–­ã€‚

Dart ä¹Ÿæ”¯æŒå¼±ç±»å‹ï¼š

- `var` å˜é‡å®šä¹‰ï¼Œå…¶ç±»å‹ç”±åˆå§‹å€¼æ¨å¯¼è€Œæ¥ï¼›
- `dynamic` åŠ¨æ€ä»»æ„ç±»å‹ï¼Œç¼–è¯‘é˜¶æ®µä¸æ£€æŸ¥ç±»å‹ï¼Œè€Œåœ¨è¿è¡Œæ£€æŸ¥ï¼›
- `Object` åŠ¨æ€ä»»æ„ç±»å‹ï¼Œç¼–è¯‘é˜¶æ®µæ£€æŸ¥ç±»å‹ï¼›

è¿™ä¸‰ä¸ªè€…çš„åŒºåˆ«åœ¨äºï¼ŒåŠ¨æ€ç±»å‹ dynamic ä¸è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œæ¨æ–­ï¼Œé€šè¿‡ runtimeType å±æ€§è·å–è¿è¡Œæ—¶ç±»å‹ã€‚è€Œ Object æ˜¯å…·ä½“çš„ç±»å‹ï¼Œå®ƒæ˜¯æ‰€æœ‰å¯¹è±¡çš„åŸºç±»ï¼ŒåŒ…æ‹¬ Function å’Œ Nullï¼Œæ‰€ä»¥ä»»ä½•ç±»å‹ä¹Ÿéƒ½å¯ä»¥èµ‹å€¼ç»™ Objectã€‚

æœªåˆå§‹åŒ–å˜é‡ä¸º nullã€‚

    var name = 'Bob';
    dynamic name = 'Bob';
    String name = 'Bob';

    int lineCount;
    assert(lineCount == null);

ä½¿ç”¨ var å…³é”®è¯è¿›è¡Œå£°æ˜çš„æ—¶å€™ï¼ŒDart ä¼šè‡ªåŠ¨æ¨æ–­å‡º å½“å‰å˜é‡çš„ç±»å‹ï¼Œå¦‚æœåœ¨å˜é‡å£°æ˜çš„æ—¶å€™æ²¡æœ‰è¿›è¡Œèµ‹å€¼ï¼Œé‚£ä¹ˆè¯¥ç±»å‹å°±æ˜¯åŠ¨æ€çš„ã€‚

```ts
var a = 'defalut';     // ok, string
Object b = 'defalut';  // ok, Object
dynamic c = 'defalut'; // ok, anything

a = 123; 
// Error: A value of type 'int' can't be assigned to a variable of type 'String'
// Try changing the type of the variable, or casting the right-hand type to 'String'

b = 123;
c = 123;

// b.foo(); 
// Error: The method 'foo' isn't defined for the class 'Object'.
// Try correcting the name to the name of an existing method, or defining a method 
// named 'foo'.dart(undefined_method)

// c.foo();
// Passed by compiler, crash when run!
```

Dart æ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œä¸ä¼šåƒ JavaScript ä¸€æ ·è¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼š

    bool flag = 1 == '1';
    print(flag);  // -> false

    var fullName = '';
    assert(fullName.isEmpty);

    var hitPoints = 0;
    assert(hitPoints <= 0);

    var unicorn;
    assert(unicorn == null);

    var iMeantToDoThis = 0 / 0;
    assert(iMeantToDoThis.isNaN);



### ğŸ‘‰ Const Static Final
- Const, Static, Final, Oh my! https://news.dartlang.org/2012/06/const-static-final-oh-my.html

`static`ã€ `final`ã€ `const` åœ¨ Dart ä¸­æ„å‘³ç€å®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼š

- `static` ä¿®é¥°æˆå‘˜ï¼Œè¡¨ç¤ºæˆå‘˜åœ¨ç±»æœ¬èº«ä¸Šå¯ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç±»çš„å®ä¾‹ä¸Šã€‚ è¿™å°±æ˜¯å®ƒçš„æ„æ€ï¼Œå¹¶æ²¡æœ‰ç”¨äºå…¶ä»–åœ°æ–¹ã€‚
- `final` ä¿®é¥°åªè¯»å˜é‡ï¼Œè¡¨ç¤ºå•ä¸€èµ‹å€¼ï¼Œä¸€æ—¦èµ‹å€¼ï¼Œå°±ä¸èƒ½æ”¹å˜finalå˜é‡çš„å€¼ã€‚
- `const` ä¿®é¥°å€¼ï¼Œæ„å‘³ç€å¯¹è±¡çš„æ•´ä¸ªæ·±åº¦çŠ¶æ€å¯ä»¥åœ¨ç¼–è¯‘æ—¶å®Œå…¨ç¡®å®šï¼Œè¿è¡Œæ—¶å®Œå…¨ä¸å¯å˜ã€‚å¦‚ `const [1,2,3]`ï¼Œæˆ–æ„é€ å¯¹è±¡æ—¶ä»£æ›¿ `new` å¦‚ `const Point(2,3)`ã€‚

const å¯¹è±¡æœ‰å‡ ä¸ªæœ‰è¶£çš„å±æ€§å’Œé™åˆ¶ï¼Œç¼–è¯‘æœŸå›ºå®šå’Œæ·±å±‚å›ºå®šã€‚`const` å¯¹è±¡æ— æ³•è®¿é—®è¿è¡Œæ—¶éœ€è¦è®¡ç®—çš„ä»»ä½•å†…å®¹ã€‚ `1 + 2` çš„å€¼åœ¨ç¼–è¯‘æœŸå¯ä»¥å›ºå®šï¼Œæ˜¯ä¸€ä¸ªåˆæ³•çš„ `const` è¡¨è¾¾å¼ï¼Œä½† `new DateTime.now()`ä¸æ˜¯ã€‚åŒ…å«é›†åˆçš„ `final` å­—æ®µï¼Œè¯¥é›†åˆä»ç„¶å¯å˜ã€‚ ä¸€ä¸ª `const` é›†åˆä¸­çš„æ‰€æœ‰ä¸œè¥¿ä¹Ÿå¿…é¡»æ˜¯é€’å½’çš„ `const`ã€‚å¯¹äºä»»ä½•ç»™å®šçš„ `const` å€¼ï¼Œæ— è®º `const` è¡¨è¾¾å¼è¢«è®¡ç®—å¤šå°‘æ¬¡ï¼Œéƒ½å°†åˆ›å»ºå¹¶é‡ç”¨å•ä¸ª `const` å¯¹è±¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼š

    getConst() => const [1, 2]; 
    main() { 
      var a = getConst(); 
      var b = getConst(); 
      print(a === b); // true 
    } 

éœ€è¦æŒ‡æ˜çš„æ˜¯ï¼Œå½“ä½ æƒ³å®šä¹‰ä¸€ä¸ªå•ä¸€èµ‹å€¼çš„æˆå‘˜å’Œç±»æœ¬èº«æ—¶ï¼Œä½ å¿…é¡»ä½¿ç”¨ `static` å…³é”®å­—!

å®ƒå’Œ const å…¶å®å¾ˆåƒï¼Œéƒ½æ˜¯å¿…é¡»åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–åéƒ½æ˜¯åªè¯»çš„ï¼Œä¸å¯å˜ã€‚

åŒºåˆ«åœ¨äº const æ¯” final æ›´åŠ ä¸¥æ ¼ã€‚final åªæ˜¯è¦æ±‚å˜é‡åœ¨åˆå§‹åŒ–åå€¼ä¸å˜ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶çŸ¥é“è¿™ä¸ªå˜é‡çš„å€¼ï¼›è€Œ const æ‰€ä¿®é¥°çš„æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å·²ç»çŸ¥é“äº†å®ƒçš„å€¼ã€‚

    // å®šä¹‰å¸¸é‡
    final a = 90;
    static const b = 90;

    final c = new DateTime.now(); // åœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“ä»–çš„å€¼
    static const d = new DateTime.now(); // Const variables must be initialized with a
    // constant value.Try changing the initializer to be a constant 

    final String nickname = 'Bobby';
    const bar = 1000000; // Unit of pressure (dynes/cm2)

    const double atm = 1.01325 * bar; // Standard atmosphere

    var   foo = const [];
    final bar = const [];
    const baz = []; // Equivalent to `const []`


### ğŸ‘‰ String çµæ´»çš„å­—ç¬¦ä¸²è¡¨è¾¾
- https://api.dart.cn/stable/2.13.4/dart-core/String-class.html
- https://api.dart.cn/stable/2.13.4/dart-core/Pattern-class.html
- https://api.dart.dev/stable/2.13.4/dart-core/RegExp-class.html

Dart String ç±»å‹æä¾›äº†æ—¥å¸¸ä¼šç”¨åˆ°çš„å„ç§å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•ï¼Œé€šå¸¸è¿˜å’Œæ­£åˆ™è¡¨è¾¾å¼é…åˆä½¿ç”¨ï¼ŒåŒæ—¶ String æ˜¯ Pattern çš„å­ç±»ã€‚

```js
RegExp exp = RegExp(r"(\w+)");
String str = "Parse my string";
Iterable<RegExpMatch> matches = exp.allMatches(str);
for (Match m in matches) {
  String match = m[0]!;
  print(match);
}
print('banana'.matchAsPrefix('ripe banana', 5)!.groups([0]));
```

å­—ç¬¦ä¸²ç±»å‹å·²ç»å®ç°çš„æ“ä½œç¬¦æœ‰ä»¥ä¸‹ 4 ä¸ªï¼š

- operator * ç”ŸæˆæŒ‡å®šé‡å¤æ¬¡æ•°çš„å­—ç¬¦ä¸²ï¼Œå¦‚ 'O' * 2 å¾—åˆ° 'OO'ï¼›
- operator + è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼›
- operator == åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ä¸€è‡´ï¼›
- operator [] è·å–å­—ç¬¦ä¸²ä¸­ä¸‹æ ‡æŒ‡å®šä½ç½®çš„å­—ç¬¦ï¼›

å¼•å·æ¢è¡Œå­—ç¬¦ä¸²å¯è¿æ¥ï¼Œæˆ– + å·è¿æ¥

    var s1 = 'String '
        'concatenation'
        " works even over line breaks.";
    assert(s1 ==
        'String concatenation works even over '
        'line breaks.');

    var s2 = 'The + operator ' + 'works, as well.';
    assert(s2 == 'The + operator works, as well.');

    
æ–‡æœ¬æ¨¡æ¿ String Template `'''`

    var s1 = '''
    You can create
    multi-line strings like this one.
    ''';

    var s2 = """This is also a
    multi-line string.""";

åŸæ ·å­—ç¬¦ä¸² Raw String `r"abc"`

    var raw = r'In a raw string, not even \n gets special treatment.';

å­—ç¬¦ä¸²æ’å€¼ String interpolation `${expression}`

    String name = 'hello';
    assert('$name string'); // hello string
    assert('${name} string'); // hello string

    var s = 'string interpolation';
    assert('That deserves all caps. ' +
            '${s.toUpperCase()} is very handy!' ==
        'That deserves all caps. ' +
            'STRING INTERPOLATION is very handy!');

    // These work in a const string.
    const aConstNum = 0;
    const aConstBool = true;
    const aConstString = 'a constant string';

    // These do NOT work in a const string.
    var aNum = 0;
    var aBool = true;
    var aString = 'a string';
    const aConstList = [1, 2, 3];

    const validConstString = '$aConstNum $aConstBool $aConstString';
    // const invalidConstString = '$aNum $aBool $aString $aConstList';

å…¶å®ƒå­—ç¬¦ä¸²æ–¹æ³•å‚è€ƒï¼š

    assert(name.length);         // 6 å­—ç¬¦ä¸²é•¿åº¦
    assert(name.isEmpty)         // false åˆ¤æ–­æ˜¯å¦ä¸ºç©º
    assert(name.isNotEmpty)      // true æ˜¯å¦ä¸ä¸ºç©º
    assert(name.substring(0, 2)) // he å­—ç¬¦ä¸²åˆ‡å‰²
    assert(name.substring(3))    // lo ä»æŒ‡å®šindexè‡³æœ«å°¾

    String e = "a,b,,"; 
    List<String> a6 = e.split(",");// ä½¿ç”¨ï¼Œåˆ†å‰²ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„,åŒjs [a,b, , ]

    String f = "a b,c";
    String g = f.splitMapJoin(",",
       onMatch: (Match match) {
         return "a";
       }, 
       onNonMatch: (String nonMatch) {
         return "b";
       });
    assert(g); // a b,c  =>   bab

    // å­—ç¬¦ä¸²åˆ¤æ–­
    String = 'aabbbcccc';
    assert(h.startsWith("aa")); //true startsWithä»¥æŸæŸå¼€å§‹
    assert(h.startsWith("aa", 3)); //false ä»index=3å¼€å§‹åˆ¤æ–­
    assert(h.endsWith("c")); //true endsWith ä»¥xxç»“å°¾
    assert(h.contains("ab")); //true containsæ˜¯å¦åŒ…å«
    assert(h.contains("ac")); //false
    assert(h.contains("ab", 3)); //false ä»index=3å¼€å§‹åˆ¤æ–­

    // å­—ç¬¦ä¸²æ›¿æ¢
    String i = "stringing";
    assert(i.replaceAll("st","cc"));// ccringing æ›¿æ¢å…¨éƒ¨ç¬¦åˆæ¡ä»¶çš„
    assert(i.replaceFirst("ing", "ss"));//strssing åªæ›¿æ¢ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„
    assert(i.replaceFirst("ing", "dd",5));//stringdd ä»index=5å¼€å§‹ æ›¿æ¢ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„
    assert(i.replaceRange(0, 3, "z"));// zinging èŒƒå›´æ›¿æ¢ ä»0-3 å«0ä¸å«3
    assert(i.replaceAllMapped("i", (Match match){//stryngyng ç”¨æ–¹æ³•è¿”å›å€¼æ›¿æ¢æŒ‡å®šçš„å­—ç¬¦ä¸²
      return "y";
    }));
    assert(i.replaceFirstMapped("i", (Match match){
      return "333";
    },5)); //string333ng ä»index=5å¼€å§‹ ç”¨æ–¹æ³•è¿”å›å€¼æ›¿æ¢æŒ‡å®šçš„å­—ç¬¦ä¸²
    
    // å­—ç¬¦ä¸²æŸ¥æ‰¾
    Sting j = 'hello'
    assert(j.indexOf('l')); // 2 ä»å‰å¾€åæ‰¾ è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„index
    assert(j.lastIndexOf('l')); // 3 ä»åå¾€å‰æ‰¾ è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„index
    
    // è½¬æ¢ä¸ºå¤§å°å†™
    Stinrg k = 'aaBBcC'
    assert(k.toLowerCase()); // aabbcc
    assert(k.toUpperCase()); // AABBCC  
    
    // å»é™¤ç©ºæ ¼
    String l = " aab bcc ";
    assert(l.trim()); //aabbcc å»é™¤å·¦å³ç©ºæ ¼
    assert(l.trimLeft()); //aabbcc å»é™¤å·¦è¾¹ç©ºæ ¼
    assert(l.trimRight()); // aabbccå»é™¤å³è¾¹ç©ºæ ¼
    
    // è¡¥é½é•¿åº¦ å‰©ä½™ä½ä½¿ç”¨æŒ‡å®šå­—ç¬¦ä¸²æ›¿æ¢
    String j = "111";
    assert(j.padLeft(6));// 111 å‰©ä½™3ä¸ªä½ é»˜è®¤ä½¿ç”¨""è¡¥é½
    assert(j.padRight(6,"c")); //111ccc å‰©ä½™3ä¸ªä½ æŒ‡å®šä½¿ç”¨"c"
    assert(j.padRight(6,"dd")); //111dddddd å‰©ä½™3ä¸ªä½ æ¯ä¸ªä½æŒ‡å®šä½¿ç”¨"dd" æ›¿æ¢åæ€»é•¿åº¦ä¸æ˜¯6
    assert(j.padLeft(2,"e"));//111 å¦‚æœæŒ‡å®šé•¿åº¦å°äºåŸå­—ç¬¦ä¸²é•¿åº¦ è¿”å›åŸå­—ç¬¦ä¸²

### ğŸ‘‰ Array æ•°ç»„

    var list = [1, 2, 3];
    assert(list.length == 3);
    assert(list[1] == 2);

    list[1] = 1;
    assert(list[1] == 1);

    list.forEach((i) => print(i)); // éå†æ•°ç»„
    list.map(i=>i+1) // [2, 3, 4]
    list.sort((num1, num2) => num1 - num2); // æ’åº
    list.every(i=>i<5) // true ç”¨æ³•åŒä¸Š
    list.reduce((curr, next) => curr + next); // 15 æ•°ç»„ç›¸åŠ çš„æ€»å’Œ

    list.fold(2,(curr, next) => curr + next);// 17 ç”¨æ³•åŒreduceï¼Œæœ‰ä¸€ä¸ªåˆå§‹å€¼
    list.contains(5) // false ç”¨äºåˆ¤æ–­æ•°ç»„æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ 
    list.where((i) => i > 2); // [3] è¿”å›æ•°ç»„ä¸­æ»¡è¶³ç»™å®šæ¡ä»¶çš„å…ƒç´ é›†åˆ

    // firstWhere() è¿”å›æ•°ç»„ä¸­æ»¡è¶³ç»™å®šæ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
    list.firstWhere((i) => i > 2, orElse: () => null); // 3
    // singleWhere() è¿”å›æ•°ç»„ä¸­æ»¡è¶³ç»™å®šæ¡ä»¶çš„å”¯ä¸€ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥æœ‰å¤šä¸ªå…ƒç´ æ»¡è¶³æ¡ä»¶ä¼šæŠ›å‡ºå¼‚å¸¸
    list.singleWhere((i) => i < 2, orElse: () => null);

    List arr = [1, 3, 5, 2, 7, 9];
    arr.take(3).toList() // [1, 3, 5] take(n) ä»æ•°ç»„é‡Œå– n ä¸ªå…ƒç´ 
    arr.skip(4).toList() // [7, 9] skip(n) è·³è¿‡æ•°ç»„ä¸­çš„ n ä¸ªå…ƒç´ 
    arr.take(3).skip(2).take(1).toList() // [5]
    var clonedArr = List.from(list); // [1, 2, 3] from å…‹éš†ä¸€ä¸ªæ•°ç»„
    print(clonedArr);
    var arr1 = [[2, 5], [7], [11, 12]];
    arr1.expand((item) => item).toList(); // [2, 5, 7, 11, 12]
    list.expand((item) => [item * 8]).toList();// [8, 16, 24]

    // å½“å¯¹æ¯ä¸€é¡¹è¿›è¡Œè®¡ç®—æ—¶ç±»ä¼¼äº map() [8, 16, 24]
    list.map((item) => item * 8).toList();
    list.add(10); // [1,2,3,10] å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ 
    list.addAll([15, 21]); // [1,2,3,15,21] å‘æ•°ç»„ä¸­æ·»åŠ å¦ä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´ 


### ğŸ‘‰ Lists Sets Maps é›†åˆç±»å‹
- https://api.dart.dev/stable/2.13.4/dart-core/Map-class.html
- https://api.dart.dev/stable/2.13.4/dart-core/List-class.html
- https://api.dart.dev/stable/2.13.4/dart-core/Set-class.html

é›†åˆç±»å‹æœ‰ `Lists`ã€ `Sets`ã€ `Maps` ä¸‰ç§ï¼Œæ³›å‹å®ç°ï¼Œ`Lists` åƒæ˜¯ JavaScript çš„æ•°ç»„ã€‚

åœ¨ JavaScript ä¸­ `{"a":"b"}` æ˜¯åŒ¿åå¯¹è±¡ JSON è¡¨è¾¾å¼ï¼Œä½†åœ¨ Dart è¿™æ˜¯ Map çš„è¡¨è¾¾å¼ï¼Œç¬¬ä¸€ä¸ª `Key:Value` ç»„åˆå°±æ˜¯ä¸€ä¸ª `MapEntity`ã€‚`Map` å’Œ `Set` çš„è¡¨è¾¾å¾ˆç›¸ä¼¼ï¼Œå¹¶ä¸”ç©ºçš„èŠ±æ‹¬å· `{}` è¡¨ç¤º `Map`ï¼Œ[Dart API - Map]ã€‚`Set` æ˜¯æ— é¡ºåºä¸é‡å¤çš„å…ƒç´ é›†åˆï¼Œæ•°ç»„å…ƒç´ æ˜¯å¯ä»¥é‡å¤çš„ï¼Œ`Map` åˆ™æ˜¯æ— åºçš„é”®å€¼æ˜ å°„å¯¹ï¼Œå®ƒä»¬éƒ½æ˜¯å¯æšä¸¾ç±»å‹ `Iterable`ã€‚

ä½¿ç”¨ç¤ºèŒƒï¼š

```js
// `List` åŸºæœ¬ç”¨æ³•
var list = [1,2,"three",4,5,6];
list.add(7);
print(list.getRange(2,3)); // "three"

// `Map` åŸºæœ¬ç”¨æ³•
var map = <int,String>{1:"abc", 2:"xyz"};
map.addAll({3:'cd', 4:"3D"}); // NO add() for Map
map[5] = "LOV";
print(map[1]);

// `Set` åŸºæœ¬ç”¨æ³•
var halogens = {'fluorine', 'chlorine', 'bromine', 'iodine', 'astatine'};
var elements = <String>{};
elements.add('fluorine');
elements.addAll(halogens);
assert(elements.length == 5);
```

æ¯”è¾ƒä¸€ä¸‹ Set å’Œ Map çš„è¯­æ³•ï¼Œé»˜è®¤ {} ä¼šè§£æä¸º Map å®ä¾‹ï¼Œé™¤éæŒ‡å®š Set ç±»å‹ï¼š

```js
var map = {}; // Creates a map, not a set.
var set1 = <String>{};
Set<String> set2 = {};
```

List å’Œ Map çš„å­—é¢é‡ Literal éƒ½å¯ä»¥æŒ‡å®šç±»å‹å‚æ•°ï¼Œå¢åŠ ç±»å‹å®‰å…¨æ€§ï¼š

```js
var names = <String>['Seth', 'Kathy', 'Lars'];
var pages = <String, String>{
  'index.html': 'Homepage',
  'robots.txt': 'Hints for web robots',
  'humans.txt': 'We are people, not machines'
};
```

å®ƒä»¬ä»¨éƒ½æ˜¯æšä¸¾ç±»å‹ `Iterable`ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ `map()` æ–¹æ³•æ„é€ æ–°å‰¯æœ¬ï¼Œä½† `Map.map()` æœ‰ç‚¹ä¸åŒçš„æ˜¯å®ƒä¼šç«‹å³æ‰§è¡Œï¼Œå¹¶ä¸”éœ€è¦è¿”å› `MapEntry` å…ƒç´ ã€‚

```dart
var map = <int,String>{1:"abc", 2:"xyz"};
var newmap = map.map((int i, String s){
    print("MapEntry {$iï¼š$s}"); // run right away
    return MapEntry(i, s);
});
print("new map "+newmap.toString()); // "new map {1: abc, 2: xyz}"
```

`List.map()` å’Œ `Set.map()` ä¼ å…¥çš„è½¬æ¢å‡½æ•°åˆ™ä¼šåœ¨ä½¿ç”¨æ–°å‰¯æœ¬æ—¶æ‰§è¡Œã€‚

```js
var halogens = {'fluorine', 'chlorine', 'bromine', 'iodine', 'astatine'};
var newset = halogens.map((v){
    // print("sets element $v"); // run before use
    return "[$v]";
});
// print("new set " + newset.toString());
print("new set " + newset.toList().join(",")); // "new set [fluorine],..."

var a = [1,2,3,4,6];
var newlist = a.map((i){
    // print("list element $i"); // run before use
    return i * 2; 
});
print("new list $newlist"); // "new list (2, 4, 6, 8, 12)"
```

å°†æ˜ å°„é›†åˆçš„é”®ã€å€¼è½¬å˜æˆæ•°ç»„ï¼š

```js
var keyset = map.keys;     // Iterable<int>
var valuelist = map.values;// Iterable<String>

print("keyList "+keyset.toList().toString());     // keyList [1, 2]
print("keySet "+keyset.toSet().toString());       // keySet {1, 2}
print("valueList "+valuelist.toList().toString());// valueList [abc, xyz]
print("valueSet "+valuelist.toSet().toString());  // valueSet {abc, xyz}
```

### ğŸ‘‰ DateTime
- https://api.dart.dev/stable/2.13.4/dart-core/DateTime-class.html
- https://api.dart.dev/stable/2.13.4/dart-core/Duration-class.html

DateTimes can represent time values that are at a distance of at most 100,000,000 days from epoch (1970-01-01 UTC): -271821-04-20 to 275760-09-13.

æ—¥æœŸæ—¶é—´ `DateTime`ï¼Œå¯ä»¥è¿”å› Unix Epoch çš„æ¯«ç§’æ•°æˆ–å¾®ç§’æ•° `microsecondsSinceEpoch`ã€ `millisecondsSinceEpoch`ï¼Œå¯ä»¥è¡¨ç¤ºä» epoch (1970-01-01 UTC) å¼€å§‹çš„ 100,000,000 å¤©æ—¶é—´ï¼Œå³ -271821-04-20 - 275760-09-13 èŒƒå›´ã€‚

æ–¹æ³•å‚è€ƒï¼š

```js
add(Duration duration) â†’ DateTime
compareTo(DateTime other) â†’ int ['override']
difference(DateTime other) â†’ Duration
isAfter(DateTime other) â†’ bool
isAtSameMomentAs(DateTime other) â†’ bool
isBefore(DateTime other) â†’ bool
subtract(Duration duration) â†’ DateTime
toIso8601String() â†’ String
toLocal() â†’ DateTime
toString() â†’ String ['override']
toUtc() â†’ DateTime
```

æ—¥æœŸæ—¶é—´é€šå¸¸é…åˆ Duration ç±»å‹ä½¿ç”¨ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ—¶é—´è·¨åº¦ï¼Œä½¿ç”¨ä»¥ä¸‹å±æ€§è®°å½•è¿™ä¸ªè·¨åº¦ï¼š

- inDays
- inHours
- inMicroseconds
- inMilliseconds
- inMinutes
- inSeconds

æ—¥æœŸæ—¶é—´è·¨åº¦å¯ä»¥ä¸°å¯Œçš„ç¬¦å·è¿ç®—ï¼Œå¯ä»¥å°†ä¸€ä¸ª Duration çœ‹ä½œä¸€ä¸ªåŒ…å« microseconds çš„æ•´æ•°çœ‹å¾…ï¼š

- operator `*` ä¸ä¸€ä¸ªç³»æ•°ç›¸ä¹˜ï¼›
- operator `+` å åŠ ä¸€ä¸ªæ—¶é—´è·¨åº¦ï¼›
- operator `-` å‡å»ä¸€ä¸ªæ—¶é—´è·¨åº¦ï¼›
- operator `<` æ¯”è¾ƒå¤§å°ï¼›
- operator `<=`æ¯”è¾ƒå¤§å°ï¼›
- operator `==`æ¯”è¾ƒå¤§å°ï¼›
- operator `>` æ¯”è¾ƒå¤§å°ï¼›
- operator `>=`æ¯”è¾ƒå¤§å°ï¼›
- operator `unary-` å–è´Ÿå€¼ï¼›
- operator `~/` é™¤ä¸€ä¸ªè‡ªç„¶æ•°å¹¶å–æ•´æ•°ï¼›

æ ¼å¼åŒ–å¯ä»¥ä½¿ç”¨ intl åŒ…çš„ `DateFormat`ï¼Œåœ¨ `pubspec.yaml` å·¥ç¨‹é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š

    dependencies:
      intl: ^0.15.8

ç„¶åä½¿ç”¨ `pub get` å®‰è£…ä¾èµ–åŒ…ï¼Œå†å°†åŒ…å¼•å…¥ä»£ç å³å¯ä½¿ç”¨ã€‚

ç¤ºä¾‹ï¼š

```js
import 'package:intl/intl.dart';

var now = DateTime.now(); // 2019-04-05 Friday
String text = new DateFormat('yyyy-MM-dd').format(now);
debugPrint("Date & time... $text ${now.toString()}");
```

æ ¼å¼åŒ–æœ‰è®¸å¤šé€‰é¡¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

|  Skeleton  |          Demo         |           ICU Name          |
|------------|-----------------------|-----------------------------|
| d          | 5                     | DAY                         |
| E          | Fri                   | ABBR_WEEKDAY                |
| EEEE       | Friday                | WEEKDAY                     |
| LLL        | Apr                   | ABBR_STANDALONE_MONTH       |
| LLLL       | April                 | STANDALONE_MONTH            |
| M          | 4                     | NUM_MONTH                   |
| Md         | 4/5                   | NUM_MONTH_DAY               |
| MEd        | Fri, 4/5              | NUM_MONTH_WEEKDAY_DAY       |
| MMM        | Apr                   | ABBR_MONTH                  |
| MMMd       | Apr 5                 | ABBR_MONTH_DAY              |
| MMMEd      | Fri, Apr 5            | ABBR_MONTH_WEEKDAY_DAY      |
| MMMM       | April                 | MONTH                       |
| MMMMd      | April 5               | MONTH_DAY                   |
| MMMMEEEEd  | Friday, April 5       | MONTH_WEEKDAY_DAY           |
| QQQ        | Q2                    | ABBR_QUARTER                |
| QQQQ       | 2nd quarter           | QUARTER                     |
| y          | 2019                  | YEAR                        |
| yM         | 4/2019                | YEAR_NUM_MONTH              |
| yMd        | 4/5/2019              | YEAR_NUM_MONTH_DAY          |
| yMEd       | Fri, 4/5/2019         | YEAR_NUM_MONTH_WEEKDAY_DAY  |
| yMMM       | Apr 2019              | YEAR_ABBR_MONTH             |
| yMMMd      | Apr 5, 2019           | YEAR_ABBR_MONTH_DAY         |
| yMMMEd     | Fri, Apr 5, 2019      | YEAR_ABBR_MONTH_WEEKDAY_DAY |
| yMMMM      | April 2019            | YEAR_MONTH                  |
| yMMMMd     | April 5, 2019         | YEAR_MONTH_DAY              |
| yMMMMEEEEd | Friday, April 5, 2019 | YEAR_MONTH_WEEKDAY_DAY      |
| yQQQ       | Q2 2019               | YEAR_ABBR_QUARTER           |
| yQQQQ      | 2nd quarter 2019      | YEAR_QUARTER                |
| H          | 11                    | HOUR24                      |
| Hm         | 11:54                 | HOUR24_MINUTE               |
| Hms        | 11:54:18              | HOUR24_MINUTE_SECOND        |
| j          | 11 AM                 | HOUR                        |
| jm         | 11:54 AM              | HOUR_MINUTE                 |
| jms        | 11:54:18 AM           | HOUR_MINUTE_SECOND          |
| m          | 54                    | MINUTE                      |
| ms         | 54:18                 | MINUTE_SECOND               |
| s          | 18                    | SECOND                      |



## âš¡ Functions
- https://dart.dev/guides/language/language-tour#functions

å‡½æ•°æ–¹æ³•ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå…·ä½“ç±»å‹æ˜¯ Functionã€‚æ–¹æ³•æ²¡æœ‰æŒ‡å®šè¿”å›å€¼ï¼Œé»˜è®¤ return nullã€‚

Dart ä¸»å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œå‡½æ•°çš„è¿”å›ç±»å‹ã€å‚æ•°ç±»å‹éƒ½å¯ä»¥çœç•¥ï¼š

    void main(List<String> args) {
      print(args); //[]
    }

å‡½æ•°è¿”å›å€¼æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œå³ void è¿”å›å¯¹åº”è¿”å› dynamic ç±»å‹ã€‚å¦‚æœå‡½æ•°ä½“æ²¡æœ‰ return ä¸€ä¸ªå€¼ï¼Œä¼šé»˜è®¤è¿”å› nullã€‚

æ”¯æŒå‘½åå‚æ•°ï¼Œå¦‚æŒ‡å®šéƒ¨åˆ†å‚æ•°å®ä¾‹åŒ–ä¸€ä¸ªæ—¶é—´è·¨åº¦ Duration:

```js
var d = Duration(minutes: 30, seconds:20);
```

åŒ¿åå‡½æ•° Anonymous functions

    (x) {return x;} // and another

ç®­å¤´è¯­æ³•ï¼š =>expr æ˜¯ {return expr;} ç¼©å†™ï¼Œåªæ˜¯ç”¨ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒ¿åæ–¹æ³•ï¼š

    (x) => x; // yet another identity function
    (x, [step = 1]) => x + step; // a closure with an optional parameter
    (a, b) => a + b; // a closure with two required parameters
    twice(x) => x * 2;

å¯é€‰å‚æ•° Optional Parameters ä½¿ç”¨æ–¹æ‹¬å·ï¼Œå¯ä»¥æŒ‡å®šé»˜è®¤å€¼ï¼š

    /// Sets the [bold] and [hidden] flags ...
    void enableFlags({bool bold = false, bool hidden = false}) {...}

    // bold will be true; hidden will be false.
    enableFlags(bold: true);

    // Optional named parameters and default value
    String say(String from, String msg, [String device, String location="SZ"]) {
        var result = '$from says $msg';
        if (device != null) {
            result = '$result with a $device';
        }
        return result +" @$location";
    }
    print(say("JJ","Hi!"));
    print(say({from: "JJ", msg: "Hi!"}));

å¿…é€‰å‚æ•° @required

    const Scrollbar({Key key, @required Widget child})

å‡½æ•°å¯ä»¥ä½œä¸ºå…¶ä»–æ–¹æ³•çš„å‚æ•°è¿›è¡Œä¼ é€’ï¼Œæˆ–è€…ä½œä¸ºå˜é‡ä¸€æ ·ä½¿ç”¨ã€‚

    library function_param;
    
    add(a, b) {
        return a + b;
    }
    executor(operation, x, y) {
        return operation(x, y);
    }
    void main() {
        var result = executor(add, 2, 1);
        print("Result is ${result}");
    }

Named Parameters å‘½åå‚æ•°ä½¿ç”¨èŠ±æ‹¬å·åŒ…æ‹¬ï¼Œå¯ä»¥æŒ‡å®šé»˜è®¤å€¼ï¼Œå‘½åå‚æ•°æ˜¯å¯é€‰å‚æ•°ï¼Œå¿…é€‰åœ¨å…·ä½“å‚æ•°çš„åé¢ï¼š

    optionParams(String name, {int age=30, String gender='å¥³'}) {
      print('name=$name, age=$age, gender=$gender');
    }

å¯ä»¥ä½¿ç”¨é—­åŒ…ï¼Œå¦‚ä¸‹å£°æ˜ä¸€ä¸ªæ— è¿”å›å€¼ç±»å‹ã€æ— å‚æ•°çš„å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªé—­åŒ…å‡½æ•°ï¼š

    closure() { 
        int count = 0;
        printCount()  {
            count += 1;
            print(count);
        }
        return printCount;
    }


## âš¡ Generators
- https://dart.dev/guides/language/language-tour#generators
- https://api.dart.dev/stable/dart-core/Iterable-class.html
- https://api.dart.dev/stable/dart-async/Stream-class.html

ç”Ÿæˆå™¨å³ Generator å‡½æ•°å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€å°±æ˜¯ä¸€ä¸ªé›†åˆçš„å€¼ã€‚

ç”Ÿæˆå™¨å¯ä»¥æä¾›æ•°æ®çš„æ‡’ç”Ÿæˆï¼Œå³åœ¨éœ€è¦çš„æ—¶å€™æ‰ç”Ÿæˆæ•°æ®å¹¶æ´¾å‘ç»™æ•°æ®æ¶ˆè´¹è€…ï¼ŒDart å†…ç½®æ”¯æŒä¸¤ç±»ç”Ÿæˆå™¨ï¼š

- Synchronous generator: Returns an `Iterable` object.
- Asynchronous generator: Returns a `Stream` object.

æ‰€è°“è¿­ä»£å¯¹è±¡å°±æ˜¯å®ç°äº†è¿­ä»£æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ for-in ç»“æ„æšä¸¾é›†åˆä¸­çš„å€¼ã€‚

å½¢å¼ä¸Šï¼ŒGenerator å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„å·®åˆ«åœ¨äºè¿”å›å€¼ç‰¹å¾ï¼š

- `sync*`  è¡¨æ˜æ˜¯ä¸€ä¸ª synchronous generatorï¼Œä½¿ç”¨ `yield` è¯­å¥æ´¾é€å¼‚æ­¥æ•°æ®ï¼›
- `async*` è¡¨æ˜æ˜¯ä¸€ä¸ª asynchronous generatorï¼Œä½¿ç”¨ `yield` è¯­å¥æ´¾é€å¼‚æ­¥æ•°æ®ï¼›

å¦‚æœç”Ÿæˆå™¨éœ€è¦é€’å½’è°ƒç”¨ï¼Œåˆ™é€šè¿‡ `yield*` å¯ä»¥æé«˜æ•ˆç‡ã€‚

```js
Iterable<int> naturalsTo(int n) sync* {
  int k = 0;
  while (k < n) yield k++;
}

Stream<int> asynchronousNaturalsTo(int n) async* {
  int k = 0;
  while (k < n) yield k++;
}

Iterable<int> naturalsDownFrom(int n) sync* {
  if (n > 0) {
    yield n;
    yield* naturalsDownFrom(n - 1);
  }
}
```


## âš¡ Class
- https://dart.dev/guides/language/language-tour#classes

Dart æ˜¯ä¸€ç§é¢å‘å¯¹è±¡è¯­è¨€ï¼ŒåŒ…å«ç±»å’ŒåŸºäº Mixin çš„ç»§æ‰¿ä¸¤éƒ¨åˆ†ã€‚æ¯ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œå¹¶ä¸” Object æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ã€‚åŸºäº Mixin çš„ç»§æ‰¿æŒ‡çš„æ˜¯æ¯ä¸ªç±»(é™¤äº† Object )éƒ½åªæœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œç±»ä½“è¿˜å¯ä»¥åœ¨å¤šä¸ªç±»ç»§æ‰¿ä¸­è¢«é‡ç”¨ã€‚

Dart ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œéƒ½æ˜¯ç±»çš„å®ä¾‹ï¼Œç±»æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæ˜¯ç±»çš„å®ä¾‹ï¼ŒèƒŒåè¿™ä¸ªç±»ç§°ä¸º metaclassã€‚è¿™å¾ˆç»•ï¼Œä½ å¯ä»¥å°†ç±»å½“ä½œå¯¹è±¡çœ‹å¾…ï¼Œä¹Ÿå¯ä»¥å½“ä½œç±»å‹æ¥çœ‹å¾…ï¼Œå–å†³äºæ€æ ·ä½¿ç”¨å®ƒã€‚

å’Œ JavaScript ç±»ä¼¼ï¼ŒDart æ‰€æœ‰å‡½æ•°æ•°ä½œä¸ºä¸€ç§ç±»å‹å¯¹è±¡ï¼Œå®ƒä»¬çš„çˆ¶ç±»æ˜¯ `Function`ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªé™æ€æ–¹æ³• apply å¯ä»¥è°ƒç”¨å‡½æ•°ï¼š

```js
static apply(Function function, List positionalArguments, [Map<Symbol, dynamic> namedArguments] );
```

Dart å¼•å…¥äº†ä¸€ä¸ªçº§è”è¿ç®—ç¬¦å·ï¼Œæ–¹ä¾¿å¯¹è±¡çš„é“¾å¼è¡¨è¾¾ï¼š

```js
'Hello'.length.toString(); // evaluates to â€˜5â€™
'Hello'..length.toString(); // evaluates to â€œHelloâ€
```

Dart çš„ç±»æœ‰å…·ä½“ `Type` ç±»å‹ï¼Œä½†ä¸éœ€è¦æŒ‡å®šå®ƒå±äºä»€ä¹ˆç±»ã€‚

    Type.runtimeType; // Ouch! NoSuchMethodError
    (Type).runtimeType; // works

ä»¥ä¸Šä¸¤è¡Œä»£ç ï¼ŒruntimeType æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½å…·æœ‰çš„å±æ€§ï¼Œè€Œç±»å¯¹è±¡æ²¡æœ‰æ­¤å±æ€§ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç¬¬äºŒç§æ–¹å¼è°ƒç”¨ï¼Œå°† Type å½“ä½œä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯ç±»ã€‚

ä¸Šé¢çš„ `Type` æ˜¯ç§æœ‰ç±»å‹ï¼Œä¸»è¦ç”¨äºåå°„æ¨¡å—ï¼Œæ³¨æ„å®ƒä¸æ˜¯å…³é”®å­—è€Œæ˜¯ç±»å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ›å»ºç±»å‹å¯¹è±¡ï¼š

```js
// 1. By a type literal, a type name occurring as an expression, like
Type type = int;
// 2. or a type variable occurring as an expression, like 
Type type = T;.
// 3. By reading the run-time type of an object, like 
Type type = o.runtimeType;
// 4. Through dart:mirrors.
```
é€šå¸¸ Type ç±»å‹æ˜¯è‡ªèº«çš„å®ä¾‹ï¼Œå¦åˆ™å¯èƒ½æ˜¯æ— æ³•è§£å†³æ— é™å€’é€€çš„é—®é¢˜ã€‚æ¯”å¦‚è¯´ä¸€ä¸ªå¯¹è±¡ aC å±äº C ç±»å‹ï¼Œè€Œ C å±äº Type ç±»å‹ï¼ŒType æ˜¯è‡ªèº«ç±»å‹ã€‚

å¯é åœ°å‘ç°å¯¹è±¡çš„ç±»çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡åå°„ï¼Œå¯¹è±¡ä¹Ÿç¡®å®æ”¯æŒ getter runtimeTypeï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè¿”å›å¯¹è±¡çš„ç±»ï¼Œä½†æ˜¯å­ç±»å¯ä»¥è‡ªç”±é‡å†™å®ƒã€‚

ä½œä¸ºæ‰€æœ‰ç±»å‹çš„çˆ¶ç±»ï¼Œæœ‰å¿…è¦äº†è§£ `Object` çš„å®šä¹‰ï¼š

```js
class Object {
    bool operator == (other)=> identical(this, other);
    external int get hashCode;
    external String toString();
    external noSuchMethod(Invocation im);
    external Type get runtimeType;
}
```

å…¶ä¸­ï¼Œidentical æ˜¯å†…å»ºçš„æ¯”è¾ƒæ–¹æ³•ï¼Œå†…å»ºå…³é”®å­— `external` è¡¨ç¤ºå¯¹åº”çš„æ–¹æ³•åœ¨å…¶å®ƒåœ°æ–¹æä¾›å®ç°ã€‚


ä¸€èˆ¬ç±»å‹å®šä¹‰ï¼Œæ³¨æ„ setter å¹¶æ²¡æœ‰è¿”å›å€¼ï¼Œçœç•¥ voidï¼š

```js
class Point {
  var rho, theta;
  Point(this.rho, this.theta);
  
  double get x => rho * cos(theta);
  set x(newX) {
    rho = sqrt(newX * newX + y * y);
    theta = acos(newX / rho);
  }

  double get y => rho * sin(theta);
  set y(newY) {
    rho = sqrt(x * x + newY * newY);
    theta = asin(newY / rho);
  }

  Point scale(factor) => Point(rho * factor, theta);
  operator +(p) => Point(x + p.x, y + p.y);
  static double distance(p1, p2) {
    var dx = p1.x() - p2.x();
    var dy = p1.y() - p2.y();
    return sqrt(dx * dx + dy * dy);
  }
}
```

é™æ€æ–¹æ³•ä¹Ÿå« Class Methodsï¼Œç›´æ¥é€šè¿‡ç±»è°ƒç”¨ `Point.distance(...)`ï¼Œç±»ä¼¼çš„é™æ€å­—æ®µä¹Ÿå« Class Variablesï¼Œé€šè¿‡ç±»ç¬¦å·è®¿é—®ã€‚å®ä¾‹æ–¹æ³•å’Œå®ä¾‹å˜é‡åˆ™é€šè¿‡å®ä¾‹çš„å˜é‡ç¬¦å·å»è°ƒç”¨åŸŸè®¿é—®ã€‚

å¦å¤–ï¼Œå¸¸é‡å®šä¹‰éœ€è¦èµ‹å€¼ä¸€ä¸ªå¸¸é‡ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ç‰‡æ–­ï¼Œæ³¨æ„å¸¸é‡æ„é€ å™¨çš„è°ƒç”¨ï¼Œç­‰å·å³ä¾§çš„ const å…³é”®å­—ç›¸å½“äº new åœ¨è°ƒç”¨å¸¸é‡æ„é€ å™¨ï¼ŒåŒæ ·å…³é”®å­—å¯ä»¥çœç•¥ï¼š

```js
class Point {
    final x, y;
    const Point(this.x, this.y);
    // â€¦ the usual
}
const origin = const Point(0,0);
```

çœç•¥ new æˆ– const æ‰§è¡Œæ„é€ å™¨å°±åƒè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ç§°ä¸º functorï¼Œå°±æ˜¯ä½¿ä¸€ä¸ªç±»çš„ä½¿ç”¨çœ‹ä¸Šå»åƒä¸€ä¸ªå‡½æ•°ã€‚å…¶å®ç°å°±æ˜¯ç±»ä¸­å®ç°ä¸€ä¸ª operator()ï¼Œè¿™ä¸ªç±»å°±æœ‰äº†ç±»ä¼¼å‡½æ•°çš„è¡Œä¸ºã€‚

æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ª Identity å³èº«ä»½ï¼Œåœ¨ä½¿ç”¨ == æ¯”è¾ƒæ—¶ï¼Œå†…å»ºçš„ identical æ–¹æ³•ä¼šåˆ¤æ–­åŒä¸€ä¸ªå®ä¾‹æ‰æ˜¯ç›¸ç­‰çš„ Equalityã€‚ä¸åŒçš„çš„å®ä¾‹ï¼Œå³ç±»å‹ç›¸åŒï¼Œå­—æ®µè®¾ç½®ç›¸åŒä¹Ÿä¸ç›¸ç­‰ã€‚ä½†æ˜¯ï¼Œé€šè¿‡æ“ä½œç¬¦å·é‡è½½å¯æ”¹å˜ operator == çš„è¡Œä¸ºã€‚

ä¸‹é¢ä»¥å‡ ä¸ªæ–¹é¢çš„å†…å®¹è¿›è¡Œè§£æï¼š

- ç±»ä¸å¯¹è±¡ã€å£°æ˜ã€åˆ›å»ºåŠåŸºæœ¬ç‰¹æ€§
- æ„é€ æ–¹æ³•åŠåˆå§‹åŒ–åˆ—è¡¨
- é™æ€æˆå‘˜åŠå¯¹è±¡æ“ä½œç¬¦çš„ä½¿ç”¨

ç±»ä¸å¯¹è±¡

- ä½¿ç”¨å…³é”®å­— `class` å£°æ˜ä¸€ä¸ªç±»
- ä½¿ç”¨å…³é”®å­— `new` åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œnew å¯çœç•¥
- æ‰€æœ‰å¯¹è±¡éƒ½ç»§æ‰¿äº `Object` ç±»

å±æ€§ä¸æ–¹æ³•

- å±æ€§é»˜è®¤ä¼šç”Ÿæˆ getter å’Œ setter æ–¹æ³•
- å£°æ˜ä¸º `final` çš„å±æ€§åªæœ‰ getter æ–¹æ³•ï¼ˆåªè¯»ï¼‰
- å±æ€§å’Œæ–¹æ³•é€šè¿‡ . æˆå‘˜æ“ä½œç¬¦å·è®¿é—®
- æ–¹æ³•ä¸èƒ½è¢«é‡è½½

ç±»åŠæˆå‘˜çš„å¯è§æ€§

- å¯è§æ€§ä»¥ library ä¸ºå•ä½
- é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Dart æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªåº“
- å‘½åå‰ç¼€ _ è¡¨ç¤ºåº“ã€ç±»ã€æ–¹æ³•çš„ç§æœ‰æ€§
- ä½¿ç”¨ import å¯¼å…¥åº“

åˆå§‹åŒ–åˆ—è¡¨

- åˆå§‹åŒ–åˆ—è¡¨ä¼šåœ¨æ„é€ æ–¹æ³•ä½“æ‰§è¡Œä¹‹å‰æ‰§è¡Œ
- åˆå§‹åŒ–åˆ—è¡¨å†™åœ¨æ–¹æ³•æ‹¬å·åï¼Œå¹¶ä½¿ç”¨å†’å·å¼•å¯¼åˆå§‹åŒ–è¡¨è¾¾å¼
- ä½¿ç”¨é€—å·åˆ†éš”åˆå§‹åŒ–è¡¨è¾¾å¼
- åˆå§‹åŒ–åˆ—è¡¨å¸¸ç”¨äºè®¾ç½® `final` å˜é‡çš„å€¼

é™æ€æˆå‘˜

- ä½¿ç”¨ `static` å…³é”®å­—æ¥å®ç°ç±»çº§åˆ«çš„å˜é‡å’Œå‡½æ•°
- é™æ€æˆå‘˜ä¸èƒ½è®¿é—®éé™æ€æˆå‘˜ï¼Œéé™æ€æˆå‘˜å¯ä»¥è®¿é—®é™æ€æˆå‘˜
- ç±»ä¸­çš„å¸¸é‡éœ€è¦ä½¿ç”¨ `static const` å£°æ˜

ç”±äºæ–¹æ³•ä¸å¯é‡è½½ï¼ŒDart æä¾›å‘½åæ„é€ æ–¹æ³•å®ç°å¤šä¸ªæ„é€ æ–¹æ³•çš„å®šä¹‰ï¼Œè¯­æ³•æ ¼å¼ `class.method(args) {...}`ï¼Œå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­çš„åˆå§‹åŒ–åˆ—è¡¨ä¸­è°ƒç”¨å‘½åæ„é€ æ–¹æ³•ï¼Œå³ Redirecting Constructorsã€‚

æ¯ä¸ªç±»è‡³å°‘æœ‰ä¸€ä¸ªé»˜è®¤çš„æ„é€ å™¨ï¼Œå¯ä»¥çœç•¥ä¸å†™ï¼Œä»¥ä¸‹ä¸‰ç§è¡¨è¾¾æ˜¯ç­‰ä»·çš„ï¼Œé€šè¿‡ `super()` è°ƒç”¨çˆ¶æ„é€ å™¨ï¼š

```js
class Box {
  var contents;
}

class Box {
  var contents;
  Box();
}

class Box {
  var contents;
  Box() {}
}
```

ç¤ºèŒƒï¼š

    void main() {
        var person = Person('æå››', 35);
        // var person = Person.NN('æå››');
        // get attribute via getter
        var who = person.name;
        // update via setter
        person.name = who + 'æ–¹';
        person._taxonomy = 'Primates';
        // person.genus = 'Primates'; // readonly
        person.work();
    }

    class Person {
      String name;
      int age;
      // internally
      String _taxonomy = 'mammals';
      // readonly
      final String genus = 'Homo';
      // constructor with initializer-list
      Person(String name, int age): name = name, age = age {
        // this.name = name;
        // this.age = age;
      }
      // named constructor
      Person.NN(String name) { this.name = name; }

      // methods
      void work() {
          print('$name ${age} is working');
      }
      // void work(int num) { } // can't overload method
    }

ä½¿ç”¨ is å’Œ is! åˆ¤æ–­å­ç±»å‹ï¼š

    print(person is Function);
    print(person is! Function);

çº§è”æ“ä½œç¬¦å· .. è®¿é—®æˆå‘˜åŒæ—¶è¿”å›ç±»å®ä¾‹çš„å¼•ç”¨ï¼š

    var person = new Person();
    person..name = 'å¼ ä¸‰'
          ..age=20
          ..work();

æ¡ä»¶æˆå‘˜è®¿é—®æ“ä½œç¬¦ `?.` è¡¨ç¤ºå¯¹è±¡ä¸ä¸ºç©ºæ‰å¾€ä¸‹æ‰§è¡Œï¼Œè®¿é—®æˆå‘˜å±æ€§ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ person ä¸º null å°±ä¸ä¼šæ‰§è¡Œ work() æ–¹æ³•ã€‚

    person?.work();

ç±»å‹è½¬æ¢ as å¯ä»¥å°†å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ï¼š

    (person as Person).work();

å¦‚æœç±»å®ç°äº† call() æ–¹æ³•å³ä¸º Callable classesï¼Œåˆ™è¯¥ç±»çš„å®ä¾‹å¯¹è±¡å¯ä»¥ä½œä¸ºæ–¹æ³•ä½¿ç”¨ï¼š

    class WannabeFunction {
      String call(String a, String b, String c) => '$a $b $c!';
    }

    var wf = WannabeFunction();
    var out = wf('Hi', 'there,', 'gang');

    void main() => print(out);

å¦‚æœï¼Œæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œè°ƒç”¨æœªå®ç°çš„ç±»æ–¹æ³•å¯ä»¥è§¦å‘ `noSuchMethod` é­”æœ¯æ–¹æ³•ï¼š

- The receiver has the static type `dynamic`.
- The receiver has a static type that defines the unimplemented method (`abstract` is OK), and the `dynamic` type of the receiver has an implemention of `noSuchMethod()` thatâ€™s different from the one in class Object.

å¯¹äº final æˆå‘˜è¿›è¡Œèµ‹å€¼ä¹Ÿä¼šè§¦å‘ `noSuchMethod()` å› ä¸º final æˆå‘˜æ²¡æœ‰ç›¸åº”çš„ setterã€‚
ç¤ºèŒƒï¼š

    class Person {
      missing(int age,String name);

      @override //overriding noSuchMethod
        noSuchMethod(Invocation invocation) => '''
        Got the ${invocation.memberName} with arguments ${invocation.positionalArguments}
        ''';
    }

    main(List<String> args) {
      dynamic person = new Person(); // the receiver person could be var, Person or dynamic
      print(person.missing(20,'shubham')); //calling abstract method
    }

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº `noSuchMethod()` å®ç°çš„ç®€å•ä»£ç†ç±»ï¼š

```js
class Proxy {
  final forwardee;
  Proxy(this.forwardee);
  @override
  void noSuchMethod(inv) { return runMethod(forwardee, inv);}
  void runMethod(forwardee, Invocation inv){
    var im = reflect(forwardee);
    im.delegate(inv);
  }
}
```

## âš¡ Factory Constructors

Dart å¼•å…¥äº†å·¥å‚æ„é€ å‡½æ•°è¿™ä¸€æ¦‚å¿µï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒæ™®é€šçš„æ„é€ å‡½æ•°ï¼Œåªæ˜¯ä½¿ç”¨ `factor` å…³é”®å­—ä¿®é¥°æ„é€ å™¨ï¼Œå®ƒä»¬å¯èƒ½æ²¡æœ‰åˆå§‹å€¼åˆ—è¡¨æˆ–åˆå§‹åŒ–å½¢å¼å‚æ•°ã€‚ç›¸åï¼Œå®ƒä»¬å¿…é¡»æœ‰ä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°ä½“ã€‚å·¥å‚æ–¹æ³•å¯ä»¥ä»ç¼“å­˜ä¸­è¿”å›å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„é€‰æ‹©åˆ†é…ä¸€ä¸ªæ–°å®ä¾‹ã€‚å®ƒç”šè‡³å¯ä»¥åˆ†é…ä¸åŒç±»çš„å®ä¾‹ï¼Œæˆ–è€…åœ¨ç¼“å­˜æˆ–ä»»ä½•å…¶ä»–æ•°æ®ç»“æ„ä¸­æŸ¥æ‰¾å®ƒä»¬ï¼Œåªè¦ç»“æœå¯¹è±¡ç¬¦åˆç±»çš„æ¥å£ã€‚

é€šè¿‡å·¥å‚æ„é€ å™¨ï¼ŒDart è§£å†³äº†ä¼ ç»Ÿæ„é€ å‡½æ•°çš„ä¸€äº›ç»å…¸ç¼ºç‚¹ã€‚

```js
enum ShapeType {
  triangle,
  rectangle
}

abstract class Shape {
  factory Shape(ShapeType type) {
    switch (type) {
      case ShapeType.triangle: return 'Triangle()';
      case ShapeType.rectangle: return 'Rectangle()';
      default: return null;
    }
  }
}
```

æ³¨æ„ factory constructors ä¸èƒ½è®¿é—® this å¼•ç”¨ã€‚

å®˜æ–¹æ–‡æ¡£ä¹Ÿæä¾›äº†ä¸€ä¸ª Logger ç¤ºèŒƒï¼š

```js
class Logger {
  final String name;
  bool mute = false;

  // _cache is library-private, thanks to
  // the _ in front of its name.
  static final Map<String, Logger> _cache =
      <String, Logger>{};

  factory Logger(String name) {
    return _cache.putIfAbsent(
        name, () => Logger._internal(name));
  }

  factory Logger.fromJson(Map<String, Object> json) {
    return Logger(json['name'].toString());
  }

  Logger._internal(this.name);

  void log(String msg) {
    if (!mute) print(msg);
  }
}

var logger = Logger('UI');
logger.log('Button clicked');

var logMap = {'name': 'UI'};
var loggerJson = Logger.fromJson(logMap);
```



## âš¡ Abstract & Interface
- https://dart.dev/guides/language/language-tour#implicit-interfaces
- https://dart.dev/guides/language/language-tour#adding-features-to-a-class-mixins

æŠ½è±¡ç±»

- æŠ½è±¡ç±»ä½¿ç”¨ `abstract` è¡¨ç¤ºï¼Œä¸èƒ½ç›´æ¥è¢«å®ä¾‹åŒ–
- æŠ½è±¡æ–¹æ³•åªå£°æ˜ä¸æä¾›å®ç°ï¼Œä¸èƒ½ç”¨ `abstract` ä¿®é¥°
- æŠ½è±¡ç±»å¯ä»¥æ²¡æœ‰æŠ½è±¡æ–¹æ³•ï¼Œä½†æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»ä¸€å®šå¾—å£°æ˜ä¸ºæŠ½è±¡ç±»

ç¤ºèŒƒï¼š

    void main(List<String> args) {
      var student = new Student();
      student.act();
    }

    abstract class Person {
      void act();
    }

    class Teacher extends Person {
      @override
      void act() {
        print('teacher in class');
      }
    }

    class Student extends Person {
      @override
      void act() {
        print('Student in class');
      }
    }

æ¥å£

- ç±»å’Œæ¥å£æ˜¯ç»Ÿä¸€çš„ï¼Œç±»å°±æ˜¯æ¥å£
- æ¯ä¸ªç±»éƒ½éšå¼çš„å®šä¹‰äº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰å®ä¾‹æˆå‘˜çš„æ¥å£
- å¦‚æœæ˜¯å¤ç”¨å·²æœ‰ç±»çš„å®ç°ï¼Œä½¿ç”¨ `extends` ç»§æ‰¿
- å¦‚æœåªæ˜¯ä½¿ç”¨å·²æœ‰çš„å¤–åœ¨è¡Œä¸ºï¼Œåˆ™ä½¿ç”¨ `implements` å®ç°æ¥å£ï¼Œç±»å¯¹è±¡ä½œä¸ºæ¥å£æ¥ä½¿ç”¨ï¼Œç±»å°±æ˜¯æ¥å£ï¼Œæ‰€æœ‰å±æ€§æ–¹æ³•éƒ½è¦é‡æ–°å®ç°

ç¤ºèŒƒï¼š

    void main(List<String> args) {
      var student = Student();
      student.run();

      var child = Children();
      child.run();
    }

    class Person {
      String name;
      int get age => 18;

      void run() {
        print('person run');
      }
    }

    // abstract class as interface
    abstract class IPerson {
        void run();
    }

    class Children implements IPerson {
      @override
      void run() {
        print('children run');
      }
    }

    // class as interface
    class Student implements Person {
      @override
      String name;

      @override
      int get age => 15;

      @override
      void run() {
        print('student run');
      } 
    }

Mixins

- Mixins æ··å…¥å¯ä»¥ç†è§£ä¸ºå¤šç»§æ‰¿ï¼Œæ˜¯é‡ç”¨ä¸€ä¸ªç±»ä»£ç çš„æ–¹å¼
- Mixins ç±»ä¸èƒ½æ˜¾å¼å£°æ˜æ„é€ æ–¹æ³•
- Mixins ç±»åªèƒ½ç»§æ‰¿è‡ª Object
- ä½¿ç”¨å…³é”®å­— `with` è¿æ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ª Mixins ç±»

ä¸€èˆ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç±»æ²¡æœ‰å®ç°ä»£ç å¯ä»¥çœç•¥èŠ±æ‹¬å·ï¼š

    class D extends A with B, C {}

ç¤ºèŒƒï¼š

    void main(List<String> args) {
      var a = new A();
      a.work();
    }

    class B extends Object {
      void work() {
        print('B.work');
      }
    }

    class C {

    }

    class A with B {

    }

å®šä¹‰ Mixin ç±»åªéœ€è¦å°† class å…³é”®å­—æ”¹ä¸º mixinï¼Œå¹¶ä¸”ä¸è¦å®šä¹‰æ„é€ å‡½æ•°ï¼š

    class Musician {
      // ...
    }
    mixin MusicalPerformer on Musician {
      // ...
    }
    class SingerDancer extends Musician with MusicalPerformer {
      // ...
    }

## âš¡ Operators & overload
- https://dart.dev/guides/language/language-tour#operators

è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š

    |       Description        |                         Operator                         |
    |--------------------------|----------------------------------------------------------|
    | unary postfix            | expr++    expr--    ()    []    .    ?.                  |
    | unary prefix             | -expr    !expr    ~expr    ++expr    --expr   await expr |
    | multiplicative           | *    /    %    ~/                                        |
    | additive                 | +    -                                                   |
    | shift                    | <<    >>    >>>                                          |
    | bitwise AND              | &                                                        |
    | bitwise XOR              | ^                                                        |
    | bitwise OR               | ||                                                       |
    | relational and type test | >=    >    <=    <    as    is    is!                    |
    | equality                 | ==    !=                                                 |
    | logical AND              | &&                                                       |
    | logical OR               |                                                          |
    | if null                  | ??                                                       |
    | conditiona               | l expr1 ? expr2 : expr3                                  |
    | cascade                  | ..    ?..                                                |
    | assignment               | =    *=    /=   +=   -=   &=   ^=   etc.                 |

ç±»ä¼¼ Pythonï¼Œ`i ~/ 2` è¡¨ç¤º i é™¤ä»¥ 2ï¼Œå¹¶ä¸”å‘ä¸‹å–æ•´ã€‚

æ“ä½œç¬¦è¦†å†™éœ€è¦åœ¨ç±»ä¸­å®šä¹‰ï¼Œè¯­æ³•å‚è€ƒï¼š

    return-type operator OP (args...) {
        body
        return
    }

å¦‚æœè¦†å†™ == ï¼Œè¿˜éœ€è¦è¦†å†™å¯¹è±¡çš„ hashCode getter æ–¹æ³•ã€‚

å¯è¦†å†™çš„æ“ä½œç¬¦ï¼š

    <  +  |  []  >  /  ^  []=  <=  /  &    >=  *  <<  ==  -  %  >>

ç¤ºèŒƒè¦†å†™æ“ä½œç¬¦ > ä»¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼Œ[] å®ç°å–å€¼ï¼š

    void main() {
      var p1 = new Person(18);
      var p2 = new Person(22);

      p1 > p2;
      print(p1 > p2);

      print(p1.age);
      print(p1['age']);
      print(p1['aa']);
    }

    class Person {
      
      int age;
      Person(this.age);

      bool operator > (Person p) {
        return this.age > p.age;
      }

      int operator [](String name) {
        if(name == 'age') {
          return this.age;
        }
        return 0;
      }
    }


## âš¡ Generics æ³›å‹

æ³›å‹æ˜¯é™ä½ä»£ç é‡å¤çš„å·¥å…·ï¼Œåœ¨å‰é¢å·²ç»ä½¿ç”¨è¿‡æ³›å‹åˆ—è¡¨ï¼Œä¾‹å¦‚å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼š

    var names = <String>[];
    names.addAll(['Seth', 'Kathy', 'Lars']);
    // names.add(42); 
    // Error: The argument type 'int' can't be assigned to the parameter type 'String'.

åˆ—è¡¨ `List<T>` æ˜¯ä¸€ç§æ³›å‹ç±»å¯¹è±¡ï¼Œå£°æ˜æ—¶æŒ‡å®šæ³›å‹ç±»å‹å‚æ•° T ä¸º Stringï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ—è¡¨å°±åªèƒ½å­˜æ”¾å­—ç¬¦ä¸²å…ƒç´ ï¼Œè€Œä¸å¯ä»¥å­˜æ”¾æ•°å€¼ç±»å‹å…ƒç´ ã€‚å¦‚æœå®šä¹‰ä¸º Object ç±»å‹åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½å¯ä»¥æ˜¯åˆ—è¡¨çš„å…ƒç´ ã€‚

ä»è¿™ä¸€ç‚¹å¯ä»¥çœ‹åˆ°ï¼Œæ³›å‹ä¹Ÿå…·æœ‰æé«˜ç±»å‹å®‰å…¨ç‰¹æ€§ã€‚

Map å’Œ Set ç±»å‹éƒ½æ˜¯æ³›å‹å®ç°ï¼š

    var names = <String>['Seth', 'Kathy', 'Lars', 'Lars'];
    var uniqueNames = <String>{'Seth', 'Kathy', 'Lars'};
    var pagesMap = <String, String>{
      'index.html': 'Homepage',
      'robots.txt': 'Hints for web robots',
      'humans.txt': 'We are people, not machines'
    };
    var views = Map<int, View>();
    var nameSet = Set<String>.from(names);


ä»¥ä¸‹é€šè¿‡ä¸€ä¸ª first å‡½æ•°æ¥è§£ææ³›å‹æ˜¯å¦‚ä½•å®ç°é™ä½ä»£ç é‡å¤çš„ï¼š

    T first<T>(List<T> ts) {
      // Do some initial work or error checking, then...
      T tmp = ts[0];
      // Do some additional checking or processing...
      return tmp;
    }

è¿™ä¸ªå‡½æ•°åªè¿”å›åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå‚æ•°å¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥æ•°å€¼åˆ—è¡¨ï¼Œæ ¹æ®å…·ä½“ç±»å‹ï¼Œç¼–è¯‘ç”Ÿæˆç›¸åº”çš„å‡½æ•°å®ä¾‹ã€‚

å‡½æ•°æˆ–æˆå‘˜æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹ï¼Œå¯ä»¥å¢å¼ºç±»å‹å®‰å…¨æ€§ï¼ŒåŒæ—¶é¿å…ç±»å‹ç›¸å…³ä»£ç çš„ç¡¬ç¼–ç æé«˜ä»£ç ä¹¦å†™æ•ˆç‡ï¼ŒåŠ å¼ºç±»å‹å®‰å…¨å’Œå‡å°‘ç±»å‹è½¬æ¢æ¬¡æ•°æ˜¯èƒ½æ˜¾è‘—æé«˜ç¨‹åºè´¨é‡çš„æŠ€æœ¯ï¼Œæ³›å‹åˆ™æ˜¯æœ€ä¼˜åŒ–å®ç°ï¼Œé€šè¿‡æœ€å°‘æœ€çµæ´»çš„ä»£ç å¢å¼ºç±»å‹å®‰å…¨å’Œå‡å°‘ç±»å‹è½¬æ¢ã€‚é€šè¿‡å¼•å…¥æ³›å‹ `first<T>` å®šä¹‰ï¼Œå¯ä»¥åœ¨å‚æ•°ä¸­ã€è¿”å›ç±»å‹å’Œå±€éƒ¨å˜é‡ä½¿ç”¨æ³›å‹ Tã€‚Dart çš„æ³›å‹åœ¨è¿è¡Œæ—¶ç»‘å®šï¼Œåœ¨è¿è¡Œæ—¶æ‰å¯ä»¥çŸ¥é“ T çš„å…·ä½“ç±»å‹ã€‚

æ³›å‹å®šä¹‰å¯ä»¥å¼•å…¥ç±»å‹èŒƒå›´çº¦æŸï¼Œç”¨ extends å…³é”®å­—æŒ‡å®šçº¦æŸç±»å‹ã€‚

    class Foo<T extends SomeBaseClass> {
      // Implementation goes here...
      String toString() => "Instance of 'Foo<$T>'";
    }

    class Extender extends SomeBaseClass {...}

    var foo = Foo<Extender>();

## âš¡ async & await
- https://dart.dev/guides/language/language-tour#asynchrony-support
- https://dart.dev/codelabs/async-await
- https://api.flutter.dev/flutter/dart-async/Completer-class.html
- flutterå®æˆ˜5ï¼šå¼‚æ­¥asyncã€awaitå’ŒFutureçš„ä½¿ç”¨æŠ€å·§ https://segmentfault.com/a/1190000014396421

ES6 ä¸å¼‚æ­¥ç›¸å…³çš„å°±æ˜¯ `Promise`ã€ `async`ã€ `await`ï¼ŒJavaScript åœ¨å¯èƒ½è€—æ—¶çš„æ“ä½œå¦‚ I/O ä¸­ä½¿ç”¨å¼‚æ­¥å¯ä»¥ç›´è¿”å›ï¼Œåªç•™ä¸‹å›è°ƒå‡½æ•°ç­‰å¾…æ“ä½œå®Œæˆåé€šçŸ¥ï¼Œè€Œå¿…ä¸ç­‰å¾…æ“ä½œå®Œæˆã€‚ä½†æœ‰æ—¶å€™çš„ç¨‹åºæµç¨‹æ˜¯æŒ‰æ¯ä¸ªå¼‚æ­¥ç»“æœæ¥è¿›è¡Œçš„ï¼Œè¿™ç§æƒ…å†µå°±ä¼šéœ€è¦åœ¨å¼‚æ­¥å›è°ƒå‡½æ•°ä¸­è®¾ç½®æ¡ä»¶å¹¶æŒ‰æ¡ä»¶æ‰§è¡Œå…¶å®ƒæ­¥éª¤ï¼Œè¿™å°±äº§ç”Ÿçš„å›è°ƒåµŒå›è°ƒï¼Œå‡½æ•°å†åµŒå‡½æ•°çš„éš¾å ªã€‚è¿™æ—¶å¸Œæœ›å°†å¼‚æ­¥åŒæ­¥åŒ–ï¼Œ`async` å’Œ `await` å…³é”®å­—å°±æ˜¯è¦å®ç°å¼‚æ­¥åŒæ­¥åŒ–ç¼–ç¨‹çš„ï¼Œè®©ä½ å†™å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ä¸€æ ·ç®€æ´ã€‚

```js
let takeTime = (n) => {
    return new Promise((resolve,reject) => {
        n = n+200;
        setTimeout(() => resolve(n), n);
    });
}

let step1 = (n) => {
    console.log(`step1: with ${n}`);
    return takeTime(n);
}

let step2 = (n) => {
    console.log(`step2: with ${n}`);
    return takeTime(n);
}

async function test() {
    console.time("test");
    var delay = 200;
    delay = await step1(delay);
    delay = delay + await step2(delay);
    console.log(`result is ${delay}`);
    console.timeEnd("test");
}
test();
console.log("END");

// step1: with 200
// END
// step2: with 400
// result is 1000
// test: 1010.539ms
```

Dart åˆ™æ˜¯ä½¿ç”¨ `dart:async` æ¨¡å—çš„ `Future`ã€ `async`ã€ `await`ï¼Œä½†æ˜¯åœ¨å‡½æ•°ä½“å‰è€Œè®¾ç½® async å…³é”®å­—ã€‚ Dart å……æ»¡äº†è¿”å› Future æˆ– Stream å¯¹è±¡çš„å‡½æ•°ã€‚

    void main() async { Â·Â·Â· }
    Future<void> main() async { Â·Â·Â· }

Dart ä¹Ÿæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„è¯­è¨€ï¼Œé‡åˆ°æœ‰å»¶è¿Ÿçš„è¿ç®—ï¼Œçº¿ç¨‹ä¸­æŒ‰é¡ºåºæ‰§è¡Œçš„è¿ç®—å°±ä¼šé˜»å¡å¡é¡¿ï¼Œäºæ˜¯é€šå¸¸ç”¨å¼‚æ­¥å¤„ç†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å½“é‡åˆ°æœ‰éœ€è¦å»¶è¿Ÿçš„è¿ç®—ï¼ˆasyncï¼‰æ—¶ï¼Œå°†å…¶æ”¾å…¥åˆ°å»¶è¿Ÿè¿ç®—çš„é˜Ÿåˆ—ï¼ˆawaitï¼‰ä¸­å»ï¼ŒæŠŠä¸éœ€è¦å»¶è¿Ÿè¿ç®—çš„éƒ¨åˆ†å…ˆæ‰§è¡Œæ‰ï¼Œæœ€åå†æ¥å¤„ç†å»¶è¿Ÿè¿ç®—çš„éƒ¨åˆ†ã€‚

æ³›å‹ç±» `Future<T>` å’Œ JavaScript çš„ Promise ç±»æ˜¯ç­‰ä»·çš„ï¼ŒT ç±»å‹è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œç»“æœã€‚å¦‚æœå¼‚æ­¥æ“ä½œä¸éœ€è¦ç»“æœï¼Œåˆ™ç±»å‹ä¸º `Future<void>`ã€‚

Future ä½¿ç”¨ç¤ºèŒƒï¼š

```js
void main() async {
  var myfut1 = Future.value(14);
  print(myfut1); // Instance of 'Future<int>'

  var myfut2 = await Future.value(14);
  print(myfut2); // 14

  Future.delayed(Duration(seconds: 2), () => 14).then((value) => print(value));

  final res = await Future.delayed(Duration(seconds: 2), () => 14);
  print(res);

  // await Future.wait([ futures... ])
}
```

Future è¿˜å¯ä»¥é…åˆ Completer ä½¿ç”¨ï¼Œç›¸å½“äº Promise çš„ resolve å’Œ reject è¿™ä¸¤ä¸ªå‡½æ•°çš„ç±»å¯¹è±¡å®ç°ã€‚ 

```js
import 'dart:async';

Future<String> someFutureResult(){
   final c = new Completer<String>();
   // complete will be called in 3 seconds.
   new Timer(Duration(seconds:3), () => c.complete("2nd"));
   return c.future;
}

main(){
   someFutureResult().then((String result) => print('$result'));
   print("1st");
}
```

ä¾‹å¦‚ä½¿ç”¨ `HttpServer` æ¥åšæœåŠ¡å™¨ï¼Œå…ˆæ¥çœ‹ä¸ä½¿ç”¨ async å’Œ await çš„å†™æ³•ï¼Œ`bind()` æ–¹æ³•è¿”å›äº†ä¸€ä¸ª `Future<HttpServer>`ï¼Œåœ¨è¿™ä¸ª `Future` èº«ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ `then()` æ–¹æ³•ä¼ å…¥å¼‚æ­¥å›è°ƒï¼Œå½“æœåŠ¡å™¨æ‰§è¡Œ `bind()` æˆåŠŸåå†é€šè¿‡å›è°ƒå‡½æ•°æ¥é€šçŸ¥ã€‚æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œå‡ºç°çš„ä¸¤ç‚¹è¯­æ³•ç³–ï¼Œå› ä¸º `write()` è¿™ä¸ªæ–¹æ³•è¿”å› `void` è€Œä¸æ˜¯åŸæœ‰å¯¹è±¡ã€‚ä¸ºäº†å®ç°é“¾å¼æ“ä½œï¼ŒDart æä¾›äº†çº§è¿è¿ç®—ç¬¦ Cascade notation `..` æ“ä½œç¬¦å·å°±åƒæ˜¯ä¸Šçº§ç›®å½•çš„æ„æ€ï¼Œå®ƒå¯ä»¥ç›´æ¥å¼•ç”¨åŸæœ‰å¯¹è±¡è¿›è¡Œé“¾å¼è¡¨è¾¾ä¹¦å†™ï¼Œæœ‰äº†å®ƒç»™å¯¹è±¡å±æ€§èµ‹å€¼ä¹Ÿå¯ä»¥ä½¿ç”¨é“¾å¼è¡¨è¾¾ï¼

    import 'dart:io';

    main() {
        HttpServer.bind(InternetAddress.anyIPv4, 8080)
        .then((httpServer){ 
            print('Web Server Listening ${httpServer.address.host}:${httpServer.port}');
            httpServer.listen((request){
                var res = request.response;
                res.headers.add("content-type", "text/html");
                var page = '''<h1>Hello Dart!</h1>''';
                res..write('''$page
                    <a href="/">Index Page</a> | 
                ''')..close();
            });
        })
        .catchError((res){ print("onError $res"); });
    }

ä½¿ç”¨ async å’Œ await æ¥åŒæ­¥åŒ– `HttpServer.bind()` è¿™ä¸ªæ–¹æ³•ï¼Œå†™æ³•å°±å®Œå…¨æ”¹å˜äº†

    main() async {
        var httpServer = await HttpServer.bind(InternetAddress.loopbackIPv4, 8080);
        print('Web server listening on ${httpServer.address.host}:${httpServer.port}');

        await for(HttpRequest request in httpServer){
            var res = request.response;
            res.headers.add("content-type", "text/html");
            var time = DateTime.now().toString().substring(10);
            switch(request.uri.toString()){

                case "/close":
                res.write('''<h1>Bye!</h1><p>END ${time}</p>''');
                httpServer.close();
                break;
                
                case "/center":
                res.write('''<h1>Hi!</h1><p>Update ${time}</p>''');
                break;

                default:
                res.write('''<h1>Hello Dart!</h1>''');
            }
            res..write('''
                <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
                <a href="/center">Center Page</a> | 
                <a href="/">Index Page</a> | 
                <a href="/close">Close Server!</a>
            ''')..close();
            print("request ${request.requestedUri} ${request.uri}");
        }
    }

è¿˜å¯ä»¥ç»™æœåŠ¡å™¨åŠ å…¥æ–‡ä»¶è¯»å–æœåŠ¡

    Directory directory = await new Directory('logs').create(recursive: true);

    File file = new File('${directory.path}/web.md');
    file.exists().then((isExists){
        file.writeAsString("#info: $isExists", mode: FileMode.append);
    });

ç±»ä¼¼ setTimeout çš„æ“ä½œã€‚

    await new Future.delayed(const Duration(milliseconds: 2000));
    new Future.delayed(const Duration(milliseconds: 2000)).then(() { ... });


## âš¡ Asynchronous Streams
- Asynchronous programming: Streams https://dart.dev/tutorials/language/streams
- https://api.dart.dev/stable/2.13.4/dart-async/Stream-class.html
- https://api.dart.dev/stable/dart-core/Iterable-class.html

Dart æœ‰ single subscription å’Œ broadcast ä¸¤ç±»æµå¯¹è±¡æä¾›å¼‚æ­¥æ•°æ®åºåˆ—ã€‚

å•è®¢é˜…æµåœ¨æ•´ä¸ªæµçš„ç”Ÿå‘½å­˜æ´»æœŸå†…ï¼Œåªå…è®¸å­˜åœ¨ä¸€ä¸ªç›‘å¬è€…ã€‚åœ¨æ²¡æœ‰ç›‘å¬è€…ä¹‹å‰ä¸ä¼šå‘é€æ•°æ®çš„ï¼Œè§£é™¤è®¢é˜…æ—¶ï¼Œä¼šåœæ­¢æ•°æ®çš„å‘é€ï¼Œä½†æ˜¯å¹¶ä¸åº”å½±å“æ•°æ®çš„äº§ç”Ÿã€‚

```js
void main() {
  var stream = Stream.value(2);
  stream.first;
  stream.last;
}
// Unhandled exception:
// Bad state: Stream has already been listened to.
//å› ä¸º first å’Œ last éƒ½è°ƒç”¨äº† listen
```

å¹¿æ’­æµå…è®¸ä»»æ„æ•°é‡çš„è®¢é˜…è€…ï¼Œæ— è®ºæ˜¯å¦è®¢é˜…ï¼Œå®ƒä¼šéšæ—¶å‘é€æ•°æ®ï¼Œå› æ­¤æ™šäºæ•°æ®å‘é€çš„æ—¶æœºçš„è®¢é˜…è€…ä¸ä¼šæ”¶åˆ°è¿‡æ—¶çš„æ•°æ®ã€‚

```js
void main() {
  var count = 0;
  var controller = StreamController();
  var t1;
  t1 = Timer.periodic(Duration(seconds: 1), (value) {
    controller.sink.add(count++);
    if(count>10) t1.cancel();
  });

  var broadcastStream = controller.stream.asBroadcastStream();
  broadcastStream.listen((value) {
    print(value);
  });
  Future.delayed(Duration(seconds: 3), () {
    broadcastStream.listen((value) {
      print('$value second');
    });
  });
}
```

æ•°æ®åºåˆ—å¯ä»¥ç”± yield ç”Ÿæˆå™¨è¿”å›ï¼Œå¹¶é€šè¿‡ `await for` æˆ–è€… listen() è¿™ä¸ª Stream API è¿›è¡Œå¤„ç†ï¼š 

```js
Future<int> sumStream(Stream<int> stream) async {
  var sum = 0;
  try {
    await for (var value in stream) {
      sum += value;
    }
  } catch (e) {
    return -1;
  }
  return sum;
}

Stream<int> countStream(int to) async* {
  for (int i = 1; i <= to; i++) {
    if (i == 4) {
      throw Exception('Intentional exception');
    } else {
      yield i;
    }
  }
}

Future<void> main() async {
  var stream = countStream(10);
  var sum = await sumStream(stream);
  print(sum); // -1
}
```

åœ¨ await for å¾ªç¯ä¸­å¤„ç†çš„æ˜¯æµå¯¹è±¡çš„æ•°æ®äº‹ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šè§¦å‘é”™è¯¯äº‹ä»¶ï¼Œå®ƒä¹Ÿä¼šåƒæ•°æ®äº‹ä»¶ä¸€æ ·æ´¾é€ï¼Œå¯ä»¥é€šè¿‡ try-catch è¿›è¡Œå¤„ç†ã€‚

Stream æä¾›äº†å¤šä¸ªå‘½åæ„é€ å™¨ï¼Œæ ¹æ®æ•°æ®åˆ†ç±»ä½¿ç”¨ï¼š

- `Stream.empty()` Creates an empty broadcast stream.
- `Stream.error(Object error, [StackTrace? stackTrace])` Creates a stream which emits a single error event before completing.
- `Stream.eventTransformed(Stream source, EventSink mapSink(EventSink<T> sink))` Creates a stream where all events of an existing stream are piped through a sink-transformation.
- `Stream.fromFuture(Future<T> future)` Creates a new single-subscription stream from the future.
- `Stream.fromFutures(Iterable<Future<T>> futures)` Create a single-subscription stream from a group of futures.
- `Stream.fromIterable(Iterable<T> elements)` Creates a single-subscription stream that gets its data from elements.
- `Stream.periodic(Duration period, [T computation(int computationCount)?])` Creates a stream that repeatedly emits events at period intervals.
- `Stream.value(T value)` Creates a stream which emits a single data event before completing.

ç¤ºèŒƒï¼Œä½¿ç”¨ Future åœ¨ä¸€ç§’åæ‰“å°æ¶ˆæ¯ â€œ1â€ å’Œ â€œdoneâ€ï¼Œå³å°† future çš„ç»“æœå’Œå®Œæˆäº‹ä»¶å‘å°„å‡ºå»ï¼š

```js
Stream.fromFuture(Future.delayed(Duration(seconds: 1), () {
    return 1;
  })).listen((value) {
    print('${value}');
  }, onError: (obj, str) {
    print('error');
  }, onDone: () {
    print('done');
  });
}
```

ä¸€æ¬¡ æ‰“å° 0-9 å’Œ done äº‹ä»¶ã€‚

```js
void main() {
  var list = List.generate(10, (value) {
    return value;
  });

  Stream.eventTransformed(Stream.fromIterable(list), (eventSink) {
    return MapSink(eventSink);
  }).listen((value) {
    print('${value}');
  }, onError: (obj, str) {
    print('error');
  }, onDone: () {
    print('done');
  });
}

class MapSink implements EventSink<int> {
  EventSink _outputSink;

  MapSink(this._outputSink);

  @override
  void add(int event) {
    _outputSink.add('$event');
  }

  void addError(e, [st]) {
    _outputSink.addError(e, st);
  }

  void close() {
    _outputSink.close();
  }
}
```

æµå¼ç¼–ç¨‹æ”¯æŒèšåˆã€è½¬æ¢ã€è¿‡æ»¤ã€åˆ¤æ–­ç­‰ï¼Œæ–¹æ³•å‚è€ƒï¼š

- `Stream<T> where(bool test(T event))` è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°æµã€‚
- `Stream<M> map <M>(M convert(T event))` å…ƒç´ æ˜ å°„å˜æ¢ååˆ›å»ºä¸€ä¸ªæ–°æµã€‚
- `Stream<T> handleError(Function onError, {bool test(error)})` åˆ›å»ºä¸€ä¸ªæ–°æµï¼Œç”¨äºæ‹¦æˆªæ»¡è¶³testçš„erroräº‹ä»¶ã€‚
- `Stream<M> expand<M>(Iterable<M> convert(T element))` å˜æ¢åŸå…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°æµï¼Œæ³¨æ„æ–°æµçš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæ•°æ®åºåˆ—ã€‚
- `Stream<M> transform<M>(StreamTransformer<T, M> streamTransformer)` æ‰§è¡Œ streamTransformer è½¬æ¢ï¼Œæ³¨æ„è¿™é‡Œè¿”å›çš„è¿˜æ˜¯æ—§æµã€‚
- `Stream<T> take(int count)` è¿”å›ä¸€ä¸ªæ–°çš„æµï¼Œå–æ—§æµçš„å‰ count ä¸ªå…ƒç´ ã€‚
- `Stream<T> skip(int count)` è¿”å›ä»¥æ–°æµï¼Œæ–°æµçš„å…ƒç´ ä»æ—§æµå…ƒç´ çš„ç¬¬ count ä¸ªå¼€å§‹ã€‚
- `Stream<T> distinct([bool equals(T previous, T next)])` æµä¸­å…ƒç´ å»é‡ã€‚

- `Future pipe(StreamConsumer<T> streamConsumer)` è¿”å›ä¸€ä¸ªFutureï¼Œå½“æµè¢«æ¶ˆè´¹ ä¸”è¢«å…³é—­æ—¶ï¼Œfutureä¼šè‡ªåŠ¨è®¡ç®—ã€‚
- `Future<T> reduce(T combine(T previous, T element))` èšåˆæµä¸­å…ƒç´ ï¼Œå¯¹æµä¸­å…ƒç´ è¿­ä»£è°ƒç”¨combineå‡½æ•°ã€‚
- `Future<M> fold<M>(M initialValue, M combine(M previous, T element))` å’Œreduceç›¸ä¼¼ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªåˆå§‹å€¼ã€‚
- `Future<String> join([String separator = ""])` æ‹¼æ¥æµä¸­å…ƒç´ çš„å­—ç¬¦ä¸²å½¢å¼ï¼Œseparatorä¸ºåˆ†éš”ç¬¦ã€‚
- `Future<bool> contains(Object needle)` æ˜¯å¦åŒ…å«needleã€‚
- `Future forEach(void action(T element))` æµä¸­å…ƒç´ è¿­ä»£æ‰§è¡Œactionã€‚
- `Future<bool> every(bool test(T element))` æ£€æŸ¥ æµç§å…ƒç´ æ˜¯å¦ å…¨éƒ½æ»¡è¶³testã€‚
- `Future<bool> any(bool test(T element))` æ£€æŸ¥æµä¸­å…ƒç´  æ˜¯å¦ å­˜åœ¨æ»¡è¶³test çš„å…ƒç´ ã€‚
- `Future<List<T>> toList()` å°†æµä¸­å…ƒç´  æ”¶é›†åˆ° é›†åˆä¸­ã€‚
- `Future<Set<T>> toSet()` å°†æµä¸­å…ƒç´  æ”¶é›†åˆ° Setä¸­ã€‚

ä½¿ç”¨ StreamController ç®¡ç†æµå¯¹è±¡ï¼š

```js
void main() {
  var streamController = StreamController(onListen: () {
    print('listen');
  }, onPause: () {
    print('pause');
  }, onResume: () {
    print('resume');
  }, onCancel: () {
    print('cancel');
  });

  var count = 0;
  Timer.periodic(Duration(seconds: 1), (value) {
    streamController.sink.add(count++);
  });
  
  var subscription = streamController.stream.listen((value) {
    print('${value}');
  }, onError: (obj, str) {
    print('error');
  }, onDone: () {
    print('done');
  }, cancelOnError: true);

  Future.delayed(Duration(seconds: 5),(){
    subscription.pause();
  });

  Future.delayed(Duration(seconds: 10),(){
    subscription.resume();
  });

  Future.delayed(Duration(seconds: 15),(){
    subscription.cancel();
  });
}
```


## âš¡ Metadata & dart:mirrors
- Dart SDK repository https://github.com/dart-lang/sdk
- Reflection in Dart https://dartcn.com/articles/server/reflection-with-mirrors
- dart:mirrors library https://api.dart.dev/stable/dart-mirrors/dart-mirrors-library.html
- The fear of dart:mirrors https://mrale.ph/blog/2017/01/08/the-fear-of-dart-mirrors.html
- Mirrors: Design Principles for Meta-level Facilities of Object-Oriented Programming Languages http://bracha.org/mirrors.pdf
- Symbol class https://api.dart.dev/stable/2.13.4/dart-core/Symbol-class.html
- A fluent API for generating valid Dart source code https://github.com/dart-lang/code_builder

Dart æ”¯æŒå…ƒæ•°æ®ç¼–ç¨‹ï¼Œæ‰€è°“å…ƒæ•°æ®å³ä»£ç ä¸­ä½¿ç”¨ä¸€ä¸ªæ ‡æ³¨å‘ç¼–è¯‘å™¨æä¾›ç›¸å…³ä»£ç çš„é¢å¤–ä¿¡æ¯ï¼Œæ˜¯ç®€åŒ–ç¼–ç¨‹çš„ä¸€ç§æ‰‹æ®µã€‚é€šå¸¸å…ƒæ•°æ®æ ‡æ³¨å‰ç¼€ä¸€ä¸ª @ ç¬¦å·ï¼Œåæ¥ä¸€ä¸ªç¼–è¯‘æœŸå¸¸é‡ï¼Œå¦‚ `@deprecated`ï¼Œæˆ–è€…åæ¥ä¸€ä¸ªå¸¸é‡æ„é€ å™¨çš„è°ƒç”¨ã€‚

æ‰€æœ‰ Dart ä»£ç éƒ½æ”¯æŒçš„ä¸¤ä¸ªå…ƒæ•°æ®æ˜¯æ ‡æ³¨æ˜¯ `@deprecated` å’Œ `@override`ï¼Œåˆ†åˆ«ç”¨æ¥å‘ŠçŸ¥æŸä¸ªåŠŸèƒ½å·²ç»è¿‡æ—¶ã€å‘ŠçŸ¥ç¼–è¯‘åœ¨é‡å†™åŸºç±»å®šä¹‰ã€‚

ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å…ƒæ•°æ®æ ‡æ³¨ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ª `@todo` å®ç°ç¤ºèŒƒï¼š

```js
library todo;

class Todo {
  final String who;
  final String what;

  const Todo(this.who, this.what);
}
```

æ³¨æ„æ„é€ å™¨çš„ const ä¿®é¥°ï¼Œå¸¸é‡åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œè¡¨ç¤ºè¿™ä¸ªç±»åœ¨ç¼–è¯‘å™¨è¢«å®ä¾‹åŒ–ã€‚

ç¤ºèŒƒä½¿ç”¨ `@todo` æ ‡æ³¨ï¼š

```js
import 'todo.dart';

@Todo('seth', 'make this do something')
void doSomething() {
  print('do something');
}
```

Metadata æ ‡æ³¨å¯ä»¥å‡ºç°åœ¨ library, class, typedef, type parameter, constructor, factory, function, field, parameter, æˆ–å˜é‡å£°æ˜ä¹‹å‰ï¼Œä¹Ÿå¯ä»¥åœ¨ `import` or `export` æŒ‡ä»¤å‰é¢ä½¿ç”¨ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡åå°„æŠ€æœ¯æ¥è·å–å…ƒæ•°æ®ã€‚

åå°„æ˜¯ç¨‹åºæ£€æŸ¥æˆ–ä¿®æ”¹è‡ªèº«çš„èƒ½åŠ›ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºç¨‹åºåœ¨è¿è¡Œæ—¶æ”¹å˜è‡ªèº«çš„èƒ½åŠ›å’Œå†…çœ introspection å³ç¨‹åºåœ¨è¿è¡Œæ—¶ç¡®å®šå…¶ç»“æ„çš„èƒ½åŠ›ã€‚

Dart Reflection åŸºäº mirrors çš„æ¦‚å¿µå®ç°ï¼Œç›®å‰ `dart:mirrors` è¿˜æ˜¯å®éªŒæ€§çš„åº“ï¼ŒMirror æ˜¯åå°„ API çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œåœ¨å‘å¸ƒã€éƒ¨ç½²å’Œå®‰å…¨æ–¹é¢å…·æœ‰ä¼˜åŠ¿ã€‚

Basic reflection with support for introspection and dynamic invocation. JIT only (not Flutter).

å°±ç›®å‰è€Œè¨€ï¼ŒDart åªæ”¯æŒå†…çœï¼Œå…¶å®ƒèƒ½åŠ›æ”¯æŒä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•ã€‚

Mirrors ç›®å‰ä¸èƒ½è¿›è¡Œ AOT ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼Œåªèƒ½åœ¨å‘½ä»¤è¡Œåº”ç”¨å’ŒæœåŠ¡ç«¯åº”ç”¨ä¸­å¼•å…¥ï¼Œä¸èƒ½åœ¨ Web åº”ç”¨ä¸­å¼•å…¥ï¼ŒFlutter ä¸­ä¹Ÿä¸èƒ½é€šè¿‡ JIT ä½¿ç”¨ mirrorsï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œåå°„æ“ä½œã€‚

å†…çœæ˜¯è¿è¡Œç¨‹åºå¯ä»¥æ£€æŸ¥å…¶è‡ªèº«ç»“æ„çš„åå°„å­é›†ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªæ‰“å°å‡ºä»»æ„å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜åç§°çš„å‡½æ•°ã€‚

åŠ¨æ€è°ƒç”¨æ˜¯æŒ‡åœ¨ç¼–è¯‘æ—¶ä¸æŒ‰å­—é¢æŒ‡å®šè¯„ä¼°ä»£ç çš„èƒ½åŠ›ï¼Œä¾‹å¦‚è°ƒç”¨ä¸€ä¸ªå…¶åç§°ä½œä¸ºå‚æ•°æä¾›çš„æ–¹æ³•ï¼ˆå› ä¸ºå®ƒåœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾ï¼Œæˆ–è€…ç”±ç”¨æˆ·ä»¥äº¤äº’æ–¹å¼æä¾›ï¼‰ã€‚

Gilad Bracha ä½œä¸º Dart è¯­è¨€è®¾è®¡ä½œè€…ï¼Œä»–åœ¨ The Dart Programming Language ä¸€ä¹¦ä¸­è®¾è®¡è§£é‡Šäº† Mirrors Reflect API çš„è®¾è®¡ã€‚

å¦å¤–ï¼Œåœ¨ Mirrors è®¾è®¡è®ºæ–‡ä¸­ï¼Œæå‡ºäº†é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­åå°„å’Œå…ƒç¼–ç¨‹å·¥å…·çš„ä¸‰ä¸ªè®¾è®¡åŸåˆ™ï¼š

- Encapsulation å°è£…ï¼šå…ƒçº§è®¾æ–½å¿…é¡»å°è£…å®ƒä»¬çš„å®ç°ã€‚
- Stratification åˆ†å±‚ï¼šå…ƒçº§è®¾æ–½å¿…é¡»ä¸åŸºæœ¬çº§åŠŸèƒ½åˆ†å¼€ã€‚
- Ontological correspondence æœ¬ä½“å¯¹åº”ï¼šå…ƒçº§è®¾æ–½çš„æœ¬ä½“åº”ä¸å®ƒä»¬æ‰€æ“ä½œçš„è¯­è¨€çš„æœ¬ä½“ç›¸å¯¹åº”ã€‚

ä¼ ç»Ÿçš„ä¸»æµåå°„å¼æ¶æ„ä¸éµå¾ªè¿™äº›è§„åˆ™ï¼Œç›¸åï¼Œå›´ç»•é•œåƒæ¦‚å¿µæ„å»ºçš„åå°„ API çš„ç‰¹ç‚¹æ˜¯éµå¾ªè¿™ä¸‰ä¸ªåŸåˆ™ã€‚å› æ­¤ï¼ŒåŸºäºé•œåƒçš„ä½“ç³»ç»“æ„åœ¨åˆ†å‘ã€éƒ¨ç½²å’Œé€šç”¨å…ƒç¼–ç¨‹æ–¹é¢å…·æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ã€‚

Mirrors can be made to work on remote code, not just local code, since you don't need the reflected object to be in the same Isolate or VM as the mirror.

å› ä¸º Dart éœ€è¦è€ƒè™‘ JavaScript çš„æ”¯æŒï¼ŒMirrors ä½œä¸ºå¯é€‰çš„æ¨¡å—ï¼Œåœ¨ä¸æ”¯æŒçš„ Web é¡¹ç›®ä¸­å°±å¯ä»¥å¾ˆå¥½åœ°è¿›è¡Œè§£è€¦å¤„ç†ã€‚

å¯¹å¤§å¤šæ•°ç”¨æˆ·ï¼ŒDart çš„åå°„å’Œ Java æ²¡æœ‰å¤ªå¤šçš„å·®åˆ«ï¼Œè¯­æ³•ä¸Šå°±æ˜¯ obj.getClass() å’Œ reflect(obj) çš„å·®åˆ«ï¼Œæœ€é‡è¦çš„æ˜¯ Mirrors Reflect API çš„è®¾è®¡å°†å…¶ä»æ ‡å‡†å¯¹è±¡çš„ API ä¸­è§£è€¦å‡ºæ¥æˆä¸ºç‹¬ç«‹æ¨¡å—ã€‚

```js
// Java:
myObject.getClass().getMethods(); // returns an array

// Dart:
reflect(myObject).type.methods; // returns a map

// Javascript:
var methods = [];
for (var m in myObject) {
  if (typeof m === 'function') {
    methods.push(m);
  }
}
```

å„ç§ä¸åŒçš„ Dart ç±»å‹éƒ½å¯ä»¥è¿›è¡Œåå°„ï¼Œé€šè¿‡åå°„ API è·å–ç›¸åº”çš„å„ç§åå°„ç±»ï¼Œåå°„åŒ…å®ç°äº†å››ä¸ªé¡¶å±‚åå°„å‡½æ•°ï¼Œå…¶ä¸­ reflect æ–¹æ³•è·å–å¯¹è±¡å®ä¾‹çš„åå°„å¯¹è±¡ï¼š

```js
external InstanceMirror reflect(dynamic reflectee);
external ClassMirror reflectClass(Type key);
external TypeMirror reflectType(Type key, [List<Type>? typeArguments]);
external MirrorSystem currentMirrorSystem();

var closureMirror = reflect(main);
var functionTypeMirror = reflectType(main.runtimeType);
print(functionTypeMirror.metadata);

var classMirrorOnClosure = reflectClass(main.runtimeType);
var pg = classMirrorOnClosure.metadata[0].reflectee as pragma;
print(pg.name);
```

åå°„åŒ…çš„ç±»å‹å‚è€ƒï¼Œå…¶ä¸­ `LibraryMirror` å’Œ `ClassMirror` å®ç°äº†å¤šä¸ªæ¥å£ï¼š

    Mirror 
      +-- IsolateMirror 
      +-- DeclarationMirror 
      |    +-- TypeMirror
      |         +-- TypedefMirror
      |    +-- MethodMirror
      |    +-- VariableMirror
      |         +-- ParameterMirror
      +-- ObjectMirror 
      |    +-- InstanceMirror
      |         +-- ClosureMirror
      +-- LibraryDependencyMirror 
      +-- CombinatorMirror 

      +-- DeclarationMirror, ObjectMirror
      |    +-- LibraryMirror
      +-- TypeMirror, ObjectMirror
           +-- ClassMirror
                +-- FunctionTypeMirror

- `Mirror` æŠ½è±¡ç±»ï¼Œåå°„å¯¹è±¡æ¥å£ã€‚
- A `MirrorSystem` is the main interface used to reflect on a set of associated libraries. 
- `Comment` Class used for encoding comments as metadata annotations.
- A `SourceLocation` describes the span of an entity in Dart source code.
- A `ClosureMirror` reflects a closure. 
- `CombinatorMirror` A mirror on a show/hide combinator declared on a library dependency.
- A `DeclarationMirror` reflects some entity declared in a Dart program.
- A `FunctionTypeMirror` represents the type of a function in the Dart language.
- An `IsolateMirror` reflects an isolate.
- `LibraryDependencyMirror` A mirror on an import or export declaration.
- A `MethodMirror` reflects a Dart language function, method, constructor, getter, or setter.
- An `ObjectMirror` is a common superinterface of InstanceMirror, ClassMirror, and LibraryMirror that represents their shared functionality. 
- A `ClassMirror` reflects a Dart language class.
- An `InstanceMirror` reflects an instance of a Dart language object.
- A `LibraryMirror` reflects a Dart language library, providing access to the variables, functions, and classes of the library.
- A `ParameterMirror` reflects a Dart formal parameter declaration.
- `TypedefMirror` A TypedefMirror represents a typedef in a Dart language program.
- A `TypeMirror` reflects a Dart language class, typedef, function type or type variable.
- `TypeVariableMirror` A TypeVariableMirror represents a type parameter of a generic type.
- A `VariableMirror` reflects a Dart language variable declaration.

è¿™äº›åå°„ç±»å‹æ¥å£å¯åˆ†ä¸ºå¤šç§ï¼ŒåŒ…æ‹¬ç±»å‹å£°æ˜åå°„ `DeclarationMirror`ã€å®ä¾‹åå°„ `ObjectMirror`ï¼Œå’Œå…¶å®ƒåå°„åŠŸèƒ½ç±»å‹ã€‚

ä»¥ä¸‹ç¤ºèŒƒå¦‚ä½•é€šè¿‡å£°æ˜åå°„ç±»å‹æ¥è·å–å…ƒæ•°æ®ï¼Œè·å–åˆ°çš„å…ƒæ•°æ®åå°„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªå®ä¾‹åå°„ç±»å‹ `InstanceMirror`ï¼Œé€šè¿‡ reflectee å±æ€§è·å–è¢«åå°„çš„å®ä¾‹å¯¹è±¡ï¼š

```js
import 'dart:mirrors';

@Todo('say', 'this is a class.')
class A{
  @Todo('say', 'this is a field.')
  int a;
  @Todo('say', 'this is a constructor method.')
  A(this.a);
}

class Todo {
  final String act;
  final String what;
  const Todo(this.act, this.what);
}

main(){
  var classMirror = reflectClass(A);
  classMirror.metadata.forEach((metadata) {
    print(metadata.reflectee.act + ' ==> ' + metadata.reflectee.what);
  });
  
  var methodMirror = classMirror.declarations[#A]!;
  var todo = methodMirror.metadata[0].reflectee;
  print('Symbol #A:' + todo.what);

  var variableMirror = classMirror.declarations[#a]!;
  todo = variableMirror.metadata[0].reflectee;
  print('Symbol #a:' + todo.what);
}
```

Dart ä½¿ç”¨ç¬¦å·æ¥ä½œä¸ºåå°„ç±»å‹çš„å­—æ®µï¼Œä»£ç ç‰‡æ–­ä¸­ä½¿ç”¨äº†ç¬¦å·å­—é¢é‡ï¼ŒSymbol("A") å’Œ #A ç­‰ä»·ã€‚

å¦å¤–ï¼Œåˆ©ç”¨ç±»å‹çš„é­”æœ¯æ–¹æ³• noSuchMethod ä¹Ÿå¯ä»¥ä½œä¸º Reflection çš„æ›¿ä»£æ–¹æ³•ã€‚


## âš¡ JSON ç¼–ç 
- Using JSON https://dart.dev/guides/json
- The fear of dart:mirrors https://mrale.ph/blog/2017/01/08/the-fear-of-dart-mirrors.html
- Cryptographic hashing functions for Dart https://pub.flutter-io.cn/packages/crypto

é¡¹ç›®ä¸­ï¼Œåå°æ¥å£å¾€å¾€ä¼šè¿”å›ä¸€äº›ç»“æ„åŒ–æ•°æ®ï¼Œå¦‚ JSONã€XML ç­‰ï¼Œå¯ä»¥é€šè¿‡ dart:convert å†…ç½®çš„è§£ç å™¨ json.decode() æ¥è¿›è¡Œè½¬æ¢ã€‚
 
é€šè¿‡ json.decode() å°† JSON å­—ç¬¦ä¸²è½¬ä¸º List/Map çš„æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œå®ƒæ²¡æœ‰å¤–éƒ¨ä¾èµ–æˆ–å…¶å®ƒçš„è®¾ç½®ï¼Œå¯¹äºå°é¡¹ç›®å¾ˆæ–¹ä¾¿ã€‚ä½†å½“é¡¹ç›®å˜å¤§æ—¶ï¼Œè¿™ç§æ‰‹åŠ¨ç¼–å†™åºåˆ—åŒ–é€»è¾‘å¯èƒ½å˜å¾—éš¾ä»¥ç®¡ç†ä¸”å®¹æ˜“å‡ºé”™ï¼Œ`JSON.decode()` ä»…è¿”å›ä¸€ä¸ª `Map<String, dynamic>`ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ç›´åˆ°è¿è¡Œæ—¶æ‰çŸ¥é“å€¼çš„ç±»å‹ã€‚

é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¤±å»äº†å¤§éƒ¨åˆ†é™æ€ç±»å‹è¯­è¨€ç‰¹æ€§ï¼šç±»å‹å®‰å…¨ã€è‡ªåŠ¨è¡¥å…¨å’Œæœ€é‡è¦çš„ç¼–è¯‘æ—¶å¼‚å¸¸ã€‚

    import 'dart:convert';
    String str='[{"name":"Jack"},{"name":"Rose"}]';

    List items = json.decode(str);
    print(items[0]["name"]);

å°½ç®¡ Dart ä¸­æ“ä½œ JSON æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å’Œ JavaScript è¿˜æœ‰äº›å·®åˆ«ã€‚

Dart æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œæ‰€ä»¥ä¸èƒ½åƒ Javascript é‚£æ ·ç›´æ¥å°† JSON å­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ªç±»å¯¹è±¡ï¼Œè€Œæ˜¯è§£æä¸ºä¸€ä¸ª Map å¯¹è±¡ã€‚

å¯ä»¥é€šè¿‡å®ç° marshaling helpers æ¥è¾…åŠ©å¾—åˆ°ç›®æ ‡ç±»å‹ï¼š

```
Map userData = JSON.decode(str);
console.log("Got user ${userData['name']} from ${userData['city']}");  // OK

class UserData {
  String name;
  String city;

  UserData(this.name, this.city);

  UserDate.fromJson(Map m)
      : this(m['name'], m['city']);
}

UserData userData = new UserDate.fromJson(JSON.decode(str));
console.log("Got user ${userData.name} from ${userData.city}");
```

å¯ä»¥ä½¿ç”¨ç¤¾åŒºæä¾›çš„ crypto åº“æ¥è°ƒç”¨å„ç§ hash å‡½æ•°ï¼š

```js
import 'package:crypto/crypto.dart';
import 'dart:convert'; // for the utf8.encode method

void main() {
  var bytes = utf8.encode("foobar"); // data being hashed

  var digest = sha1.convert(bytes);

  print("Digest as bytes: ${digest.bytes}");
  print("Digest as hex string: $digest");
}
```


## âš¡ Isolate & Concurrency
- https://www.tutorialspoint.com/dart_programming/dart_programming_concurrency.htm
- https://api.dart.dev/stable/2.13.4/dart-isolate/Isolate-class.html
- https://api.flutter.dev/flutter/foundation/compute-constant.html
- https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage

å‰é¢å·²ç»ä»‹ç»è¿‡ isolate æ˜¯ Dart VM ä¸­ä»£ç çš„è¿è¡Œç¯å¢ƒï¼Œæ¯ä¸ª isolate å®ä¾‹å¯ä»¥çœ‹ä½œä¸€ä¸ªè¿›ç¨‹ï¼ŒDart çš„å¹¶å‘ç¼–ç¨‹å°±éœ€è¦å®ƒã€‚

```js
import 'dart:isolate';  
void foo(var message){ 
   print('execution from foo ... the message is :${message}'); 
}  
void main(){ 
   Isolate.spawn(foo,'Hello!!'); 
   Isolate.spawn(foo,'Greetings!!'); 
   Isolate.spawn(foo,'Welcome!!'); 
   
   print('execution from main1'); 
   print('execution from main2'); 
   print('execution from main3'); 
}
```

é€šè¿‡ `spawn` æ–¹æ³•å­µåŒ–è¿›ç¨‹ï¼Œå®ƒçš„å‚æ•°åˆ—è¡¨ä¸­æ¥æ”¶ä¸€ä¸ªå¾…æ‰§è¡Œçš„å‡½æ•°ï¼Œå’Œä¸€ä¸ªä¼ å…¥è¿™ä¸ªå‡½æ•°çš„å‚æ•°å¯¹è±¡ï¼Œå¦‚æœä¸éœ€è¦ä¼ å…¥å‚æ•°å¯ä»¥æŒ‡å®šä¸º `null`ã€‚

```js
external static Future<Isolate> spawn<T>(
    void entryPoint(T message), T message,
    {bool paused = false,
    bool errorsAreFatal = true,
    SendPort? onExit,
    SendPort? onError,
    @Since("2.3") String? debugName});
```

è¿™é‡Œçš„ foo å’Œ main æ‰§è¡Œé¡ºåºæ˜¯è¿˜ç¡®å®šçš„ï¼Œfoo ä¹Ÿå¯èƒ½å› ä¸º main çš„é€€å‡ºè€Œä¸å®Œå…¨æ‰§è¡Œã€‚

Isolates ä¸åŒäºçº¿ç¨‹ï¼Œå®ƒæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ï¼Œæ²¡æœ‰é€”å¾„ä¸å…¶å®ƒ isolates å®ä¾‹å…±äº«ï¼Œåªèƒ½é€šè¿‡ port è¿›è¡Œæ¶ˆæ¯é€šä¿¡ä¼ é€’æ•°æ®ã€‚åˆ›å»ºä¸€ä¸ª ReceivePortï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒå‘é€šè®¯ç«¯å£ï¼Œå¯ä»¥è·å–ä¸€ä¸ª SendPort å®ä¾‹æ¥å‘è¿™ä¸ªç«¯å£å‘é€æ¶ˆæ¯ï¼Œç„¶åé€šè¿‡ listen ç»‘å®šçš„ç›‘å¬å‡½æ•°å¤„ç†æ•°æ®ã€‚

A ReceivePort is a non-broadcast stream. This means that it buffers incoming messages until a listener is registered. Only one listener can receive messages. See Stream.asBroadcastStream for transforming the port to a broadcast stream.


```js
import 'dart:isolate';

main() { // in the main isolate
  ReceivePort r1 = new ReceivePort();
  SendPort s1 = r1.sendPort;
  Isolate.spawnUri(new Uri(path:â€™./otherIsolate.dartâ€™), [], s1);
  r1.listen((data){
    print('Receied: $data');
    r1.close();
  });
}

main(args, SendPort s1) { // in otherIsolate.dart
  ReceivePort r2 = new ReceivePort();
  SendPort s2 = r2.sendPort;
  s1.send(s2);
}
```

Flutter è¿›ä¸€æ­¥å°è£…äº† ReceivePort æä¾›çš„æ›´ç®€æ´ APIï¼Œä½¿ç”¨ compute å‡½æ•°æ¥åˆ›å»ºæ–°çš„ Isolate æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼š

```js

import 'package:flutter/foundation.dart';
import  'dart:io';

create_new_task() async{
  var str = "New Task";
  var result = await compute(doWork, str);
  print(result);
}

String doWork(String value){
  sleep(Duration(seconds:5));
  return "complete:$value";
}
```

compute å‡½æ•°æœ‰ä¸¤ä¸ªå¿…é¡»çš„å‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¾…æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»æ˜¯ä¸€ä¸ªé¡¶çº§å‡½æ•°ï¼Œä¸èƒ½æ˜¯ç±»çš„å®ä¾‹æ–¹æ³•ï¼Œå¯ä»¥æ˜¯ç±»çš„é™æ€æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºåŠ¨æ€çš„æ¶ˆæ¯ç±»å‹ï¼Œå¯ä»¥æ˜¯è¢«è¿è¡Œå‡½æ•°çš„å‚æ•°ã€‚

æ³¨æ„ï¼ŒWeb åº”ç”¨ä¸æ”¯æŒ Isolateï¼Œåªèƒ½åœ¨æœåŠ¡ç«¯ä½¿ç”¨ã€‚


# ğŸš© Core libraries
- A tour of the core libraries https://dart.dev/guides/libraries/library-tour
- https://api.dart.dev/stable/2.13.4/dart-core/dart-core-library.html

Dart æœ‰ä¸€æ‰¹æ ¸å¿ƒåº“æä¾›æœ€åŸºç¡€çš„ç¨‹åºä»»åŠ¡æ”¯æŒï¼Œå¦‚é›†åˆ dart:collectionï¼Œç®—æœ¯ dart:mathï¼Œæ•°æ®ç¼–ç  dart:convert ç­‰ï¼Œè€Œå…¶å®ƒåŠŸèƒ½åº“åˆ™é€šè¿‡ç¤¾åŒºè´¡çŒ®ã€‚

æ ¸å¿ƒåº“åˆ†ä¸ºä¸‰å¤§ç±»ï¼š

- Multi-platform libraries that work on all Dart platforms.

    - `dart:async` Support for asynchronous programming, with classes such as Future and Stream.
    - `dart:collection` Classes and utilities that supplement the collection support in `dart:core`. 
    - `dart:convert` Encoders and decoders for converting between different data representations, including JSON and UTF-8.
    - `dart:core` Built-in types, collections, and other core functionality for every Dart program.
    - `dart:developer` Interaction with developer tools such as the debugger and inspector. JIT and dartdevc only.
    - `dart:math` Mathematical constants and functions, plus a random number generator.
    - `dart:typed_data` Lists that efficiently handle fixed sized data and SIMD numeric types.

- Native platform libraries that work on the Dart native platform (AOT- and JIT-compiled code).

    - `dart:io` File, socket, HTTP, and other I/O support for non-web applications.
    - `dart:isolate` Concurrent programming using isolates: independent workers similar to threads.
    - `dart:mirrors` (`Experimental`) Basic reflection with support for introspection and dynamic invocation. JIT only (not Flutter)

- Web platform libraries that work on the Dart web platform (code compiled to JavaScript).

    - `dart:html` HTML elements and other resources for web-based applications.
    - `dart:indexed_db` Client-side key-value store with support for indexes.
    - `dart:web_audio` High-fidelity audio programming in the browser.
    - `dart:web_gl` 3D programming in the browser.
    - `dart:js` (`DEPRECATED`)Donâ€™t use. Instead, use the js package, as described in JavaScript interoperability.
    - `dart:js_util` APIs to supplement missing functionality in dart:html or the js package.


# ğŸš© FLutter Widgets
- Flutter Gallery https://gallery.flutter.dev/
- Flutter API reference https://api.flutter-io.cn/
- Flutter API reference https://api.flutter.dev/index.html
- Flutter get Started https://flutter.dev/docs/get-started/codelab

Flutter åº”ç”¨ä¸­ï¼Œä¸‡ç‰©çš† widgetï¼Œå³ç›®å‰ä¸»æµçš„ç»„ä»¶åŒ–æ€æƒ³ï¼Œç”±äº UI æ§ä»¶è§£è€¦éœ€è¦ï¼Œæ…¢æ…¢æ¼”å˜å‡ºç»„ä»¶åŒ–çš„æ€æƒ³ã€‚

Flutter æ§ä»¶ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

- StatelessWidget
- StatefulWidget

StatelessWidget ç”¨æ¥å±•ç¤ºé™æ€çš„æ–‡æœ¬æˆ–è€…å›¾ç‰‡ï¼Œå¦‚æœæ§ä»¶éœ€è¦æ ¹æ®å¤–éƒ¨æ•°æ®æˆ–è€…ç”¨æˆ·æ“ä½œæ¥æ”¹å˜çš„è¯ï¼Œå°±éœ€è¦ä½¿ç”¨ StatefulWidgetã€‚

State çš„æ¦‚å¿µä¹Ÿæ˜¯æ¥æºäº Facebook çš„ React æ¡†æ¶ï¼Œä½¿ç”¨è™šæ‹Ÿæ§ä»¶æ ‘å’Œç»„ä»¶å„è‡ªçš„çŠ¶æ€æ¥æ„å»ºç•Œé¢ï¼Œå½“æŸä¸ªæ§ä»¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ç”±æ¡†æ¶è´Ÿè´£å¯¹æ¯”å‰åçŠ¶æ€å·®å¼‚å¹¶ä¸”é‡‡å–æœ€å°ä»£ä»·æ¥æ›´æ–°æ¸²æŸ“ç»“æœã€‚

ä¸€ä¸ª App ç•Œé¢çš„åŸºæœ¬ç»“æ„å¯ä»¥ç”± Scaffold ç±»è¡¨ç¤ºï¼Œå®ƒä¸ºé¡µé¢å®šä¹‰ä»¥ä¸‹åŸºæœ¬å¸ƒå±€ï¼š

- App bar çŠ¶æ€æ¡ï¼Œæä¾›åº”ç”¨çš„å¿«æ·èœå•ã€æ ‡é¢˜ä¿¡æ¯ã€å¯¼èˆªæŒ‰é”®ç­‰ï¼›
- Body å†…å®¹å®¹å™¨ï¼›

ç¤ºèŒƒï¼š

```js
import 'package:flutter/material.dart';

void main() => runApp(MyApp());

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Welcome to Flutter',
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Welcome to Flutter'),
        ),
        body: const Center(
          child: Text('Hello World'),
        ),
      ),
    );
  }
}
```

éƒ¨ä»¶ Widget æ˜¯ Flutter çš„åŸºæœ¬æ¦‚å¿µï¼ŒWidget å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‘çŠ¶é…ç½®ä¿¡æ¯ï¼Œè€ŒçœŸæ­£çš„ UI æ¸²æŸ“æ ‘ç”± Element æ„æˆï¼Œä¸€ä¸ªéƒ¨ä»¶å¯¹è±¡å¯ä»¥å¯¹åº”å¤šä¸ª Element å¯¹è±¡ã€‚ä¸è¿‡ï¼Œç”±äº Element æ˜¯é€šè¿‡ Widget ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´æœ‰å¯¹åº”å…³ç³»ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ï¼Œå¯ä»¥è®¤ä¸º Widget æ ‘å°±æ˜¯æŒ‡ UI æ§ä»¶æ ‘ã€‚

åŠ¨æ€éƒ¨ä»¶ Stateful å’Œé™æ€éƒ¨ä»¶ Statelessï¼Œå‰è€…æŒæœ‰çŠ¶æ€ï¼Œå¯èƒ½åœ¨éƒ¨ä»¶ç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿå˜åŒ–ã€‚åè€…æ˜¯æ²¡æœ‰çŠ¶æ€å˜åŒ–çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„å±æ€§ä¸èƒ½æ”¹å˜ï¼Œæ‰€æœ‰çš„å€¼éƒ½æ˜¯æœ€ç»ˆçš„ã€‚åŠ¨æ€éƒ¨ä»¶å’Œé™æ€çš„æ ¸å¿ƒå†…å®¹æ˜¯ä¸€è‡´çš„ï¼Œå®ƒä»¬éƒ½ä¼šåœ¨æ¯ä¸€å¸§ä¸­è¢«é‡æ„ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼ŒåŠ¨æ€éƒ¨ä»¶æœ‰ä¸€ä¸ª State å¯¹è±¡ï¼Œå®ƒå¯ä»¥ä¸ºåŠ¨æ€éƒ¨ä»¶åœ¨ä¸åŒå¸§ä¹‹é—´å­˜å‚¨æ•°æ®ã€‚

é™æ€éƒ¨ä»¶ StatelessWidget lifecycle å¾ˆç®€å•ï¼Œåªéœ€è¦æ„é€ å™¨å’Œä¸€ä¸ª build æ–¹æ³•ï¼Œå­ç±»æ‰©å±•æ—¶ï¼Œåªè¦è¦†ç›–å®ƒå³å¯ã€‚

åŠ¨æ€éƒ¨ä»¶ StatefulWidget lifecycle å°±å¤æ‚ç‚¹ï¼Œå¢åŠ äº†çŠ¶æ€ç®¡ç†ï¼Œå­ç±»éœ€è¦è¦†ç›– createState æ–¹æ³•ï¼š 

```js
class JournalEdit extends StatefulWidget {
    @override
    _JournalEditState createState() => _JournalEditState();
}
class _JournalEditState extends State<JournalEdit> {
    @override
    Widget build(BuildContext context) {
        return Container();
    }
}
```

åŠ¨æ€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæµç¨‹å¦‚ä¸‹ï¼š

    =========================      ===============================================================
    |     StatefulWidget    |      |                            State                            |
    |===========v===========|      |                  ============v============                  |
    |      Constructor      | ==>  |                  |       initState       |                  |
    |===========v===========|      |                  ============v============                  |
    |      createState      |      |                  | didChangeDependencies |                  |
    =========================      |                  ============v============                  |
                                   |                              v                              |
                                   |                         ===========                         |
                                   |           +===========> |  dirty  | <========+              |
                                   |           |             =====v=====          |              |
                                   |           |             |  build  |          |              |
                                   |  =========^=========    =====v=====    ======^=====         |
                                   |  | didUpdateWidget | <= |  clean  | => | setState |         |
                                   |  ===================    =====v=====    ============         |
                                   |                         | dispose |                         |
                                   |                         ===========                         |
                                   ===============================================================

å„ React æ¡†æ¶ç±»ä¼¼ï¼Œé€šè¿‡ setState æ–¹æ³•æ¥æ ‡è®°çŠ¶æ€å¤„ç† dirty çŠ¶æ€ï¼Œå³éœ€è¦æ›´æ–°ç»˜å›¾ã€‚ä¸åŒçš„æ˜¯ï¼ŒFlutter ä¸­è®¾ç½®çŠ¶æ€ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒä¼šç«‹å³è¢«æ‰§è¡Œï¼Œå¹¶ä¸”ä¸å¯ä»¥ä½¿ç”¨ async æˆ–è¿”å› Future å¯¹è±¡ï¼Œå¦‚ï¼š

    setState(() { _myState = newValue; });

Scaffold æ˜¯ç»æ‰‹æ¶éƒ¨ä»¶ï¼Œå®ç°äº†åŸºæœ¬çš„ Material Design å¸ƒå±€ç»“æ„ã€‚åœ¨ Material è®¾è®¡ä¸­å®šä¹‰çš„å•ä¸ªç•Œé¢ä¸Šçš„å„ç§å¸ƒå±€å…ƒç´ ï¼Œåœ¨ Scaffold ä¸­éƒ½æ”¯æŒï¼Œç»“åˆå¤šéƒ¨ä»¶å¸ƒå±€æˆ–å•å­éƒ¨ä»¶å¸ƒå±€å¯ä»¥å®ç°å„ç§å¸ƒå±€ç»“æ„ï¼Œå•å­éƒ¨ä»¶çš„å¸ƒå±€èƒ½æä¾›ä¸°å¯Œçš„è£…é¥°èƒ½åŠ›å¦‚ `Container`ï¼Œé€šè¿‡ç»™ `Text` åŠ ä¸ªå®¹å™¨è®¾ç½®æ ·å¼å¯¹è±¡ï¼Œå³å¯ä»¥åƒ Web ä¸€æ ·ä¿®é¥°å†…å®¹ã€‚ Scaffold æœ‰ä¸‹é¢å‡ ä¸ªä¸»è¦å±æ€§ï¼š


|ä¸»è¦å±æ€§       |è§£æ                     |
|---------------|--------------------------|
|`appBar`           |æ˜¾ç¤ºåœ¨ç•Œé¢é¡¶éƒ¨çš„ä¸€ä¸ª AppBarã€‚|
|`body`                     |å½“å‰ç•Œé¢æ‰€æ˜¾ç¤ºçš„ä¸»è¦å†…å®¹ Widgetã€‚|
|`floatingActionButton`     |Material è®¾è®¡ä¸­æ‰€å®šä¹‰çš„ FABï¼Œç•Œé¢çš„ä¸»è¦åŠŸèƒ½æŒ‰é’®ã€‚|
|`persistentFooterButtons`  |å›ºå®šåœ¨ä¸‹æ–¹æ˜¾ç¤ºçš„æŒ‰é’®ï¼Œæ¯”å¦‚å¯¹è¯æ¡†ä¸‹æ–¹çš„ç¡®å®šã€å–æ¶ˆæŒ‰é’®ã€‚|
|`drawer`                       |æŠ½å±‰èœå•æ§ä»¶ã€‚|
|`backgroundColor`          |å†…å®¹çš„èƒŒæ™¯é¢œè‰²ï¼Œé»˜è®¤å€¼æ˜¯ ThemeData.scaffoldBackgroundColorã€‚|
|`bottomNavigationBar`      |æ˜¾ç¤ºåœ¨é¡µé¢åº•éƒ¨çš„å¯¼èˆªæ ã€‚|
|`resizeToAvoidBottomPadding`   |ç±»ä¼¼äº Android ä¸­çš„ android:windowSoftInputMode='adjustResize'ï¼Œæ§åˆ¶ç•Œé¢å†…å®¹ body æ˜¯å¦é‡æ–°å¸ƒå±€æ¥é¿å…åº•éƒ¨è¢«è¦†ç›–äº†ï¼Œæ¯”å¦‚å½“é”®ç›˜æ˜¾ç¤ºçš„æ—¶å€™ï¼Œé‡æ–°å¸ƒå±€é¿å…è¢«é”®ç›˜ç›–ä½å†…å®¹ã€‚é»˜è®¤å€¼ä¸º trueã€‚|


|å¸¸ç”¨éƒ¨ä»¶æˆ–å¯¹è±¡  |å­éƒ¨ä»¶æ•°é‡|ç”¨é€”|
|---------------|---------|----|
|`Flex`         |å¯ä»¥å¤šä¸ª|å¼¹æ€§å¸ƒå±€|
|`Row`          |å¯ä»¥å¤šä¸ª|è¡Œç»„ç»‡å¸ƒå±€|
|`Column`       |å¯ä»¥å¤šä¸ª|åˆ—ç»„ç»‡å¸ƒå±€|
|`GridView`     |å¯ä»¥å¤šä¸ª|æ …æ ¼å¸ƒå±€|
|`Stack`        |å¯ä»¥å¤šä¸ª|å †å å¸ƒå±€|
|`IndexedStack` |å¯ä»¥å¤šä¸ª|å †å å¸ƒå±€|
|`Flow`ï¼Œ        |å¯ä»¥å¤šä¸ª|æµå¼å¸ƒå±€|
|`Container`    |å•ç‹¬ä¸€ä¸ª|å®¹å™¨|
|`BoxConstraints`|å•ç‹¬ä¸€ä¸ª|å®¹å™¨|
|`Padding`      |å•ç‹¬ä¸€ä¸ª|å¡«å……å¼|
|`Center`       |å•ç‹¬ä¸€ä¸ª|å±…ä¸­å¼|
|`RichText`     |å¯Œæ–‡æœ¬|æ˜¾ç¤ºæ–‡å­—|
|`TextSpan`     |å¯Œæ–‡æœ¬å…ƒç´ |æ˜¾ç¤ºæ–‡å­—|
|`Text`         |æ™®é€šéƒ¨ä»¶|æ˜¾ç¤ºæ–‡å­—|
|`Image`        |æ™®é€šéƒ¨ä»¶|æ˜¾ç¤ºå›¾åƒ|
|`GestureDetector`      |æ—       |æ‰‹åŠ¿äº¤äº’|


|CSS æ ·å¼æ¨¡æ‹Ÿå¯¹è±¡  |ç”¨é€”|
|---------------|----|
|`TextStyle`    |æ–‡å­—æ ·å¼|
|`FontWeight`   |å­—ä½“æ ·å¼|
|`Alignment`    |å¯¹é½æ ·å¼|
|`Colors`       |é¢œè‰²é¢„ç½®|
|`Icons`        |å›¾æ ‡é¢„ç½®|
|`BoxShape`     |å›¾å½¢æ ·å¼|
|`BoxShadow`    |é˜´å½±æ ·å¼|
|`BoxDecoration`|è£…é¥°æ ·å¼|
|`BorderRadius` |è¾¹æ¡†æ ·å¼|
|`LinearGradient`|æ¸å˜æ ·å¼|

Colors ä¸­å®šä¹‰äº†å¤šç§é¢œè‰²å¸¸é‡ï¼Œå‚è€ƒ HTML å’Œ CSS é¢œè‰²è§„èŒƒä¸­å®šä¹‰äº† 147 ä¸­é¢œè‰²åï¼Œ17 ç§æ ‡å‡†é¢œè‰²åŠ  130 ç§å‘½åé¢œè‰²ã€‚


|å¯æ»šåŠ¨çš„éƒ¨ä»¶         |ç”¨é€”|
|-------------------|----|
|`ListView`         |ä¸€ä¸ªå¯æ»šåŠ¨çš„åˆ—è¡¨|
|`ListTile`         |ä¸€ä¸ªåˆ—è¡¨é¡¹ç›®|
|`NestedScrollView` | ä¸€ä¸ªå¯ä»¥åµŒå¥—å…¶å®ƒå¯æ»šåŠ¨widgetçš„widget|
|`GridView`         | ä¸€ä¸ªå¯æ»šåŠ¨çš„äºŒç»´ç©ºé—´æ•°ç»„|
|`SingleChildScrollView`| æœ‰ä¸€ä¸ªå­widgetçš„å¯æ»šåŠ¨çš„widgetï¼Œå­å†…å®¹è¶…è¿‡çˆ¶å®¹å™¨æ—¶å¯ä»¥æ»šåŠ¨ã€‚|
|`Scrollable`       | å®ç°äº†å¯æ»šåŠ¨widgetçš„äº¤äº’æ¨¡å‹ï¼Œä½†ä¸åŒ…å«UIæ˜¾ç¤ºç›¸å…³çš„é€»è¾‘|
|`Scrollbar`        | ä¸€ä¸ªMaterial Design æ»šåŠ¨æ¡ï¼Œè¡¨ç¤ºå½“å‰æ»šåŠ¨åˆ°äº†ä»€ä¹ˆä½ç½®|
|`CustomScrollView`     | ä¸€ä¸ªä½¿ç”¨sliversåˆ›å»ºè‡ªå®šä¹‰çš„æ»šåŠ¨æ•ˆæœçš„ScrollView|
|`NotificationListener` | ä¸€ä¸ªç”¨æ¥ç›‘å¬æ ‘ä¸Šå†’æ³¡é€šçŸ¥çš„widgetã€‚|
|`ScrollConfiguration`  | æ§åˆ¶å¯æ»šåŠ¨ç»„ä»¶åœ¨å­æ ‘ä¸­çš„è¡¨ç°è¡Œä¸º|
|`RefreshIndicator`     | Material Designä¸‹æ‹‰åˆ·æ–°æŒ‡ç¤ºå™¨ï¼ŒåŒ…è£…ä¸€ä¸ªå¯æ»šåŠ¨widget|


## âš¡ StatefulWidget

å®ç°ä¸€ä¸ªåŠ¨æ€éƒ¨ä»¶è‡³å°‘éœ€è¦ä¸€ä¸ª `StatefulWidget` ç±»å’Œä¸€ä¸ª `State` ç±»ã€‚ `StatefulWidget` ç±»æœ¬èº«æ˜¯ä¸å˜çš„ï¼ŒState ç±»åœ¨éƒ¨ä»¶ç”Ÿå‘½å‘¨æœŸä¸­å§‹ç»ˆå­˜åœ¨ã€‚Widget éƒ½æ˜¯é™æ€çš„ immutableï¼Œè¿™èƒ½æé«˜æ¸²æŸ“æ•ˆç‡ï¼ŒFlutter åœ¨é¡µé¢æ¸²æŸ“ä¸Šé¢çš„æ ¸å¿ƒæ€æƒ³æ˜¯ simple is fastï¼`StatefulWidget` é€šè¿‡è°ƒç”¨ `setState((){})` æ ‡è®°è‡ªèº«ä¸º dirty çŠ¶æ€ï¼Œä»¥ç­‰å¾…ä¸‹ä¸€æ¬¡ç³»ç»Ÿçš„é‡ç»˜æ£€æŸ¥ã€‚åŠ¨æ€éƒ¨ä»¶æ¯”é™æ€éƒ¨ä»¶æ›´åŠ è€—èƒ½ï¼Œæ‰€ä»¥ä¼˜ç§€çš„å¸ƒå±€åº”è¯¥å°½é‡å¤šç”¨é™æ€éƒ¨ä»¶ã€‚

åŠ¨æ€éƒ¨ä»¶æ‹¥æœ‰ä¸€å¥—è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ:

|åç§°           |çŠ¶æ€   |
|---------------|------|
|`initState`        |æ’å…¥æ¸²æŸ“æ ‘æ—¶è°ƒç”¨ï¼Œåªè°ƒç”¨ä¸€æ¬¡|
|`didChangeDependencies`    |stateä¾èµ–çš„å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨|
|`didUpdateWidget`|ç»„ä»¶çŠ¶æ€æ”¹å˜æ—¶å€™è°ƒç”¨ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡|
|`build`            |æ„å»ºWidgetæ—¶è°ƒç”¨|
|`deactivate`       |å½“ç§»é™¤æ¸²æŸ“æ ‘çš„æ—¶å€™è°ƒç”¨|
|`dispose`      |ç»„ä»¶å³å°†é”€æ¯æ—¶è°ƒç”¨|

App ä¹Ÿæœ‰ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸ

|åç§°     |çŠ¶æ€|
|-----------|----|
|`resumed`  |å¯è§å¹¶èƒ½ç›¸åº”ç”¨æˆ·çš„è¾“å…¥|
|`inactive` |å¤„åœ¨å¹¶ä¸æ´»åŠ¨çŠ¶æ€ï¼Œæ— æ³•å¤„ç†ç”¨æˆ·ç›¸åº”|
|`paused`   |ä¸å¯è§å¹¶ä¸èƒ½ç›¸åº”ç”¨æˆ·çš„è¾“å…¥ï¼Œä½†æ˜¯åœ¨åå°ç»§ç»­æ´»åŠ¨ä¸­|

å®˜æ–¹æ–‡æ¡£æ˜¯å†™äº†æœ‰3ç§æ¨¡å¼ï¼šæ§ä»¶è‡ªå·±ç®¡ç†çŠ¶æ€ã€äº¤ç»™çˆ¶æ§ä»¶ç®¡ç†çŠ¶æ€ä»¥åŠæ··åˆç®¡ç†ã€‚ä¸‹é¢ç»“å…¨ english_words æ¥åŒ…è£…ä¸€ä¸ªåŠ¨æ€éƒ¨ä»¶ï¼Œ`GestureDetector` éƒ¨ä»¶ç”¨æ¥å“åº”ç”¨æˆ·è¡Œä¸ºäº‹ä»¶ã€‚

    class RandomWordsState extends State<RandomWords> {
        bool _state = false;
      bool _light = false;

        @override
        Widget build(BuildContext context){

            final wp = new WordPair.random();
        Color color = _light? Colors.brown:Colors.lime;
        TextStyle style = new TextStyle(fontSize: _state? 20:50, color:color);

            return new GestureDetector(
                onTapDown:(detail){
                    print("tap down $_state ${DateTime.now().toString()} ${detail.toString()}");
                    setState(() { _state = true; });
                },
                new Future.delayed(const Duration(milliseconds: 60)).then((t){
                    setState(() { _state = false; });
                });
                onTap: (){
                    print("tap... ${DateTime.now().toString()}");
                },
                onDoubleTap:(){
                    setState(() { _light = !_light; });
                    debugPrint("double tap... $_light ${DateTime.now().microsecondsSinceEpoch}");
                },
                child: new Text(wp.asPascalCase, style:style),
            );
        }
    }

    class RandomWords extends StatefulWidget {
        @override   
        State<StatefulWidget> createState(){
            return new RandomWordsState();
        }
    }

å»æ‰åŸæœ‰ä»£ç è¿™è¡Œ `Text text = new Text(wp.asUpperCase);`ï¼Œ ç›¸åº”ä¿®æ”¹ `child` ä¸º `child: new RandomWords()`ã€‚`StatefulWidget` è¿™ä¸ªç±»ç»§æ‰¿ä¸­åªé‡å†™äº† `cretaeState` æ–¹æ³•ã€‚ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡å“åº”ç‚¹å‡» `onTap` å†å¼¹èµ· `onTapUp` å’ŒåŒå‡»äº‹ä»¶ `onDoubleTap`ï¼Œå¯¹ `State` éƒ¨ä»¶è°ƒç”¨ `setState()` æ¥æ ‡è®°è„æ•°æ®çŠ¶æ€ï¼Œéƒ¨ä»¶ä¼šè¿›è¡Œ UI é‡æ„è¿‡ç¨‹çš„ç­‰å¾…ä¸­ï¼Œåœ¨ä¸‹ä¸€å›è§†å›¾æ¸²æŸ“æ—¶æ‰§è¡Œè§†å›¾é‡æ„ `build`ã€‚æŒ‰ä¸‹ä¼šç¼©å°å­—ä½“ï¼Œå¼¹èµ·å›å¤å¤§å­—ä½“ï¼ŒåŒå‡»æ”¹å˜é¢œè‰²ã€‚åœ¨ä¸€ä¸ªå¿«é€Ÿå®Œæˆçš„ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œ`onTapDown` åˆ° `onTapUp` çš„é—´éš”æ˜¯å¾ˆçŸ­çš„ï¼Œåªæœ‰æœ€åä¸€ä¸ªçŠ¶æ€æ›´æ–°ä½“ç°åœ¨ UI ä¸Šï¼Œå› ä¸º UI é‡æ„æ˜¯æŒ‰å›ºå®šé—´éš”å»åˆ·æ–°çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„ `onTapUp` ä½¿ç”¨äº†ä¸€ä¸ª `Future` æ¥å»¶æ—¶ï¼Œå®ç°ä¸¤ä¸ªçŠ¶æ€çš„ç¡®å®šå¯ä»¥è¡¨ç°åœ¨ UI ä¸Šã€‚


## âš¡ english_words

ä»¥ `english_words` è¿™ä¸ªè½¯ä»¶åŒ…æ¼”ç¤ºï¼Œå¯ä»¥åœ¨ `pub.dev` ä¸Šæ‰¾åˆ°ï¼Œå°† `english_words` æ·»åŠ åˆ°ä¾èµ–é…ç½®æ–‡ä»¶ `pubspec.yaml` æ–‡ä»¶ä¸­

    dependencies:
      flutter:
        sdk: flutter

      # The following adds the Cupertino Icons font to your application.
      # Use with the CupertinoIcons class for iOS style icons.
      cupertino_icons: ^0.1.2
      english_words: ^3.1.3

    dev_dependencies:
      flutter_test:
        sdk: flutter

åœ¨ç»ˆç«¯ä¸­è¿è¡Œå®‰è£…å‘½ä»¤

    flutter packages get

ç„¶ååœ¨ AppBar æ¨¡æ¿å·¥ç¨‹ä»£ç ä¸­ä½¿ç”¨ `import` å¯¼å…¥

    // This sample shows adding an action to an [AppBar] that opens a shopping cart.

    import 'package:flutter/material.dart';
    import 'package:english_words/english_words.dart';

    void main() => runApp(MyApp());

    class MyApp extends StatelessWidget {
        // This widget is the root of your application.
        @override
        Widget build(BuildContext context) {
            return MaterialApp(
                title: 'Flutter Code Sample for material.AppBar.actions',
                theme: ThemeData(
                    primarySwatch: Colors.blue,
                ),
                home: MyStatelessWidget(),
            );
        }
    }

    class MyStatelessWidget extends StatelessWidget {
        MyStatelessWidget({Key key}) : super(key: key);

        @override
        Widget build(BuildContext context) {

            final wp = new WordPair.random();
            Text text = new Text(wp.asUpperCase);

            var icons = <Widget>[];
            for (var i=0; i < 5; i++) {
                icons.add(IconButton( 
                    icon: Icon(Icons.shopping_cart), 
                    tooltip: "Open this #$i", 
                    onPressed: (){ 
                        print("tab #$i"); 
                    }
                ));
            }

            return Scaffold(
                appBar: AppBar(
                    title: Text('Hello World'),
                    actions: icons,
                ),
                body: new Center(
                    child: text,
                ),
            );
        }
    }

## âš¡ Flex
- Flutterç¬¬4å¤©--åŸºç¡€æ§ä»¶(ä¸‹)+Flexå¸ƒå±€è¯¦è§£ https://cloud.tencent.com/developer/article/1379041


## âš¡ äº‹ä»¶å¤„ç†ä¸é€šçŸ¥

Flutter ä¸­çš„æ‰‹åŠ¿ç³»ç»Ÿæœ‰ä¸¤å±‚æ•°æ®ï¼Œç¬¬ä¸€å±‚ä¸ºåŸå§‹è§¦ç‚¹äº‹ä»¶ï¼Œå®ƒæè¿°äº†å±å¹•æ¥æ”¶åˆ°çš„è§¦ç‚¹ Pointer å¦‚è§¦æ‘¸ã€é¼ æ ‡å’Œè§¦æ§ç¬”çš„ä½ç½®å’Œç§»åŠ¨çŠ¶æ€ã€‚ ç¬¬äºŒå±‚ä¸ºæ˜¯ç»è¿‡è§„åˆ™å¤„ç†è¿‡çš„æ‰‹åŠ¿ï¼Œæè¿°ç”±ä»»æ„ä¸ªè§¦ç‚¹åŠä¸åŒåŠ¨ä½œç»„æˆçš„è¯­ä¹‰åŠ¨ä½œï¼Œå¦‚æ‹–åŠ¨ã€ç¼©æ”¾ã€åŒå‡»ã€é•¿æŒ‰ç­‰ã€‚ä¸€æ¬¡å®Œæ•´çš„äº‹ä»¶åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šæ‰‹æŒ‡æŒ‰ä¸‹ã€æ‰‹æŒ‡ç§»åŠ¨ã€å’Œæ‰‹æŒ‡æŠ¬èµ·ï¼Œè€Œæ›´é«˜çº§åˆ«çš„æ‰‹åŠ¿ï¼Œå¦‚ç‚¹å‡»ã€åŒå‡»ã€æ‹–åŠ¨ç­‰éƒ½æ˜¯åŸºäºè¿™äº›åŸå§‹äº‹ä»¶çš„ã€‚

å½“æŒ‡é’ˆæŒ‰ä¸‹æ—¶ï¼ŒFlutter æ‰§è¡Œå‘½ä¸­æµ‹è¯• Hit Test ä»¥ç¡®å®šæ¥è§¦ç‚¹ä½ç½®å¯¹åº”çš„éƒ¨ä»¶ï¼Œåç»­çš„äº‹ä»¶å°†ä¸å‘½ä¸­çš„éƒ¨ä»¶å‘ç”Ÿå…³è”ã€‚äº‹ä»¶ä¼šåœ¨éƒ¨ä»¶æ ‘ä¸­å‘ä¸Šå†’æ³¡ï¼Œè¿™äº›äº‹ä»¶ä¼šä»æœ€å¼€å§‹å‘½ä»¤çš„éƒ¨ä»¶åˆ°æ ¹éƒ¨ä»¶çš„è·¯å¾„ä¸Šé€ä¸ªè½®è¯¢ï¼Œå’Œ Web å¼€å‘ä¸­æµè§ˆå™¨çš„äº‹ä»¶å†’æ³¡æœºåˆ¶ç›¸ä¼¼ï¼Œä½†æ˜¯ Flutter ä¸­æ²¡æœ‰æœºåˆ¶å–æ¶ˆæˆ–åœæ­¢å†’æ³¡è¿‡ç¨‹ï¼Œè€Œæµè§ˆå™¨çš„å†’æ³¡æ˜¯å¯ä»¥åœæ­¢çš„ã€‚

Flutterä¸­å¯ä»¥ä½¿ç”¨Listener widgetæ¥ç›‘å¬åŸå§‹è§¦æ‘¸äº‹ä»¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½æ€§widgetã€‚

    Listener({
      Key key,
      this.onPointerDown, //æ‰‹æŒ‡æŒ‰ä¸‹å›è°ƒ
      this.onPointerMove, //æ‰‹æŒ‡ç§»åŠ¨å›è°ƒ
      this.onPointerUp,//æ‰‹æŒ‡æŠ¬èµ·å›è°ƒ
      this.onPointerCancel,//è§¦æ‘¸äº‹ä»¶å–æ¶ˆå›è°ƒ
      this.behavior = HitTestBehavior.deferToChild, //åœ¨å‘½ä¸­æµ‹è¯•æœŸé—´å¦‚ä½•è¡¨ç°
      Widget child
    })

`GestureDetector` å†…éƒ¨æ˜¯ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª `GestureRecognizer` æ¥è¯†åˆ«å„ç§æ‰‹åŠ¿çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šè¿‡ `Listener` å°†åŸå§‹æŒ‡é’ˆäº‹ä»¶è½¬æ¢ä¸ºè¯­ä¹‰æ‰‹åŠ¿ï¼Œä¸€ç§æ‰‹åŠ¿çš„è¯†åˆ«å™¨å¯¹åº”ä¸€ä¸ª `GestureRecognizer` çš„å­ç±»ã€‚Flutter å®ç°äº†ä¸°å¯Œçš„æ‰‹åŠ¿è¯†åˆ«å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœæœ‰ç‰¹æ®Šæ‰‹åŠ¿éœ€æ±‚åˆ™å¯ä»¥é€šè¿‡ `Listener` æ¥è‡ªå®šä¹‰å®ç°ã€‚

åœ¨ App ä¸­ç»å¸¸ä¼šéœ€è¦ä¸€ä¸ªå¹¿æ’­æœºåˆ¶ï¼Œç”¨ä»¥è·¨è¶Šéƒ¨ä»¶çš„äº‹ä»¶å¤„ç†ï¼Œæ¯”å¦‚é¡µé¢ A ä¼šæ ¹æ®ç”¨æˆ·ç™»å½•çŠ¶æ€æ¥è¿›è¡Œé¡µé¢æ›´æ–°ï¼Œå¦‚æœç›´æ¥åœ¨éƒ¨ä»¶å†…éƒ¨åˆ†ä¼ é€’äº‹ä»¶æ¶ˆæ¯ï¼Œä¼šå¢åŠ éƒ¨ä»¶çš„è€¦åˆåº¦ï¼Œä¸åˆ©äºå¼€å‘ç»´æŠ¤ã€‚åœ¨ Dart ä¸­å®ç°äº‹ä»¶æ€»çº¿æœºåˆ¶ä¾¿ä¼šéå¸¸æœ‰ç”¨ï¼Œäº‹ä»¶æ€»çº¿å®ç°äº†è®¢é˜…è€…æ¨¡å¼ï¼Œè®¢é˜…è€…æ¨¡å¼åŒ…å«å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸¤ç§è§’è‰²ï¼Œå¯ä»¥é€šè¿‡äº‹ä»¶æ€»çº¿æ¥è§¦å‘äº‹ä»¶å’Œç›‘å¬äº‹ä»¶ã€‚A é¡µé¢éœ€è¦ä¾¦å¬ç™»å½•çŠ¶æ€ï¼Œå°±åœ¨äº‹ä»¶æ€»çº¿ä¸Šæ³¨å†Œç›‘å¬å‡½æ•°å³å¯ä»¥ï¼Œè€Œå…¶ç™»å½•éƒ¨ä»¶æ— éœ€æ³¨æ„æœ‰é‚£äº›éƒ¨ä»¶éœ€è¦æ”¶å¬ç™»å½•äº‹ä»¶ã€‚ä¸€ä¸ªäº‹ä»¶æ€»çº¿é€šå¸¸éœ€è¦ä¸‰ä¸ªæ–¹æ³•æ³¨å†Œæ–¹æ³•ã€æ³¨é”€æ–¹æ³•ã€è§¦å‘æ–¹æ³•ï¼Œéƒ¨ä»¶è¦ä¾¦å¬æŒ‡å®šçš„äº‹ä»¶é€šè¿‡æ³¨å†Œæ–¹æ³•ç™»å½•å›è°ƒå‡½æ•°ï¼Œè€Œäº‹ä»¶çš„æä¾›è€…åˆ™é€šè¿‡è§¦å‘æ–¹æ³•æ¥å¹¿æ’­äº‹ä»¶æ•°æ®æºï¼Œäº‹ä»¶æ€»çº¿åˆ™éœ€è¦å®ç°æ•°æ®å¹¿æ’­åœ¨ä¾¦å¬å‡½æ•°ä¸­çš„ä¼ é€’ï¼Œæœ€åä¾¦å¬å‡½æ•°å¯ä»¥é€šè¿‡æ³¨é”€æ–¹æ³•æ¥è§£é™¤ä¾¦å¬ã€‚

å’Œäº‹ä»¶æ€»çº¿ç±»ä¼¼çš„ï¼ŒFlutter æä¾›äº† Notification æœºåˆ¶ï¼Œå¯ä»¥ç»™éƒ¨ä»¶æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹åˆ†å‘é€šçŸ¥ï¼Œé€šçŸ¥ä¼šæ²¿ç€å½“å‰èŠ‚ç‚¹ context å‘ä¸Šä¼ é€’ï¼Œæ‰€æœ‰çˆ¶èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡ `NotificationListener` æ¥ç›‘å¬é€šçŸ¥ï¼Œè¿™ç§ç”±å­å‘çˆ¶çš„ä¼ é€’ä¸ºé€šçŸ¥å†’æ³¡ Notification Bubblingï¼Œè¿™ä¸ªå’Œç”¨æˆ·è§¦æ‘¸äº‹ä»¶å†’æ³¡æ˜¯ç›¸ä¼¼çš„ï¼Œä½†é€šçŸ¥å†’æ³¡å¯ä»¥ä¸­æ­¢ï¼Œæˆ·è§¦æ‘¸äº‹ä»¶ä¸è¡Œã€‚


## âš¡ æ»šåŠ¨åˆ—è¡¨ ListView
- ç²¾è®²Flutterå®˜ç½‘çš„ç¬¬ä¸€ä¸ªä¾‹å­ â€“ Try Enough https://tryenough.com/flutter04
- â¤ï¸ Red Heart Emoji https://emojipedia.org/heavy-black-heart/
â¤ fill heart
ğŸ’› Yellow Heart
ğŸ’š Green Heart
ğŸ’— Growing Heart


åœ¨å‰é¢å­¦ä¹ åˆ°äº‹ä»¶å¤„ç†ã€éƒ¨ä»¶åŠ¨æ€ç®¡ç†ç­‰åŸºç¡€ä¸Šï¼Œè¿™é‡Œå†ç»“åˆ `ListView` ä¸    `ListTile` ç­‰éƒ¨ä»¶å®ç°ä¸€ä¸ªå…·æœ‰æ— é™å…ƒç´ ï¼Œå¯ä»¥ç‚¹å‡»åˆ‡æ¢å–œæ¬¢çŠ¶æ€çš„åˆ—è¡¨ã€‚ä½¿ç”¨ `ListView` æ‰©å±• `RandomWordsState` ç±»ç”Ÿæˆå¹¶æ˜¾ç¤ºå•è¯å¯¹åˆ—è¡¨ã€‚ å½“ç”¨æˆ·æ»šåŠ¨æ—¶ï¼Œ`ListView.itemBuilder()` å›è°ƒå‡½æ•°å°†æ— é™ç”Ÿæˆåˆ—è¡¨æ¡ç›®ï¼Œå‚è€ƒ [ç²¾è®²Flutterå®˜ç½‘çš„ç¬¬ä¸€ä¸ªä¾‹å­ â€“ Try Enough]ã€‚éœ€è¦å®ç° `WordsList` å’Œ `WordsListState`ï¼Œè¿™ä¸ªéƒ¨ä»¶åŠŸèƒ½ï¼š

* ä½¿ç”¨ `ListView.builder()` åˆ›å»ºåˆ—è¡¨
* åœ¨åˆ—è¡¨è¡Œå†…å®¹ç”Ÿæˆå›è°ƒå‡½æ•° `itemBuilder` ä¸­ç»™åˆ—è¡¨å¡«å…… `ListTile` æˆ–éš”è¡Œå‡ºç°çš„åˆ†éš”çº¿ `Divider`
* ç»™ `ListTile` å„å­æ  `leading`ã€ `title`ã€ `subtitle`ã€ `trailing` è¡¥å……ç›¸åº”çš„æ–‡å­—æ ‡é¢˜å›¾æ ‡æŒ‰é’®
* ç»™ `å–œæ¬¢` æŒ‰é’®ç»‘å®š `onPressed` äº‹ä»¶å¤„ç†å™¨ï¼Œå‰ç»“åˆè®°å½•æ•°æ®æ¥ç®¡ç†æ¡ç›®çš„çŠ¶æ€æ ‡è®°ã€‚

è¿™é‡Œé’ˆå¯¹ `leading` è¿™æ ä½¿ç”¨äº† `Container` æ¥å®ç°å‚ç›´å‰§ä¸­ï¼Œå¦‚æœä¸ä¾¿ç”¨å®¹å™¨ï¼Œ`leading` ä¼šå’Œ `title` ç­‰é«˜ä½ç½®ï¼Œç›¸å¯¹æ²¡æœ‰é‚£ä¹ˆç¾è§‚ã€‚è¿˜æœ‰è®¾ç½®äº† `Divider` çš„é«˜åº¦ä¸º 0ï¼Œé¿å…äº†æ¯ä¸€è¡Œç©ºç™½å¤ªå¤šï¼Œæ˜¾å¾—è§†å›¾ç»“æ„æ•£ä¹±ã€‚åœ¨è¡Œå¤„ç†ä¸­å°†æ•°æ® `word` åŠç¼–å· `count` ä¼ åˆ° `buildListTile()` å‡½æ•°æœ‰å¥½å¥½å¤„ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡ä¸äº‹ä»¶å¤„ç†å™¨å½¢æˆçš„é—­åŒ…æ¥ä¿å­˜æ‰€åœ¨è¡ŒåŠå…¶å…³è”çš„æ•°æ® `word`ã€ `count`ã€‚å¦‚æœç›´æ¥åœ¨ `itemBuilder` ä½¿ç”¨åŒ¿åå‡½æ•°æˆ–æ™®é€šå‡½æ•°åˆ™è¦è€ƒè™‘æ•°æ®ä¸æ‰€åœ¨è¡Œçš„å…³è”é—®é¢˜ã€‚

ä¸ºäº†é¿å…åœ¨ç‚¹é€‰å–œæ¬¢æŒ‰é’®æ—¶å°†æ–‡å­—å†…å®¹æ›´æ–°ï¼Œéœ€è¦å°† `RandomWordsState` çš„ `final wp = new WordPair.random();` ç§»åˆ° `build()` å‡½æ•°å¤–éƒ¨ã€‚ä¸»ç¨‹åºåªè¦å°†  `MyStatelessWidget` ç»æ‰‹æ¶çš„ body ä¿®æ”¹ä¸º `new WordsList()` å³å¯ã€‚


    import 'package:flutter/material.dart';
    import 'package:english_words/english_words.dart';

    void main() => runApp(MyApp());

    class MyApp extends StatelessWidget {
        @override
        Widget build(BuildContext context) {
            return MaterialApp(
                title: 'Flutter Code Sample for material.AppBar.actions',
                theme: ThemeData(
                    primarySwatch: Colors.green,
                ),
                home: MyStatelessWidget(),
            );
        }
    }

    class MyStatelessWidget extends StatelessWidget {
        MyStatelessWidget({Key key}) : super(key: key);

        @override
        Widget build(BuildContext context) {

            var icons = <Widget>[];
            icons.add(IconButton( 
                    icon: Icon(Icons.wb_cloudy), 
                    tooltip: "Open this", 
                    onPressed: (){ print("tab this $this"); }
                ));

            return Scaffold(
                appBar: AppBar( title: Text('Hello Dart & Flutter'), actions: icons, ),
                body: new WordsList(),
            );
        }
    }

    class WordsList extends StatefulWidget{
        @override
        State<StatefulWidget> createState() {
        return new WordsListState();
      }
    }

    class WordsListState extends State<WordsList>{

        var _list = <RandomWords>[];
        var _favorite = <int>[]; //new Set<RandomWords>();
        Map<int,RandomWords> current;

        @override
        Widget build(BuildContext ctx){
            return buildList(ctx);
        }
        Widget buildListTile(RandomWords word, int index){

            var has = _favorite.contains(index);
            
            return new ListTile(
                contentPadding: EdgeInsets.all(0),
                // onTap: (){ print("list tile tap.."); },
                leading: new Container(
                    // alignment: new Alignment(-1, 1),
                    margin: EdgeInsets.fromLTRB(8, 8, 0, 0),
                    child:new Text("${index ~/ 2}", style: new TextStyle(fontSize: 24, fontWeight: FontWeight.bold)),
                ),
                title:word,
                subtitle: new Text("â¤ ğŸ’› ğŸ’š ğŸ’—"),
                trailing:new IconButton(
                    color:Colors.lime,
                    tooltip:"favorite ${index ~/ 2}",
                    icon:new Icon(has? Icons.favorite:Icons.favorite_border),
                    onPressed:(){ 
                        setState(() {
                            current = <int, RandomWords>{index:word};
                            has? _favorite.remove(index):_favorite.add(index);
                            print("favorite this... $word $current $has $_favorite");
                        });
                    },
                )
            );

        }

        Widget buildList(BuildContext ctx){
            return new ListView.builder(
                shrinkWrap:true,
                padding: EdgeInsets.fromLTRB(6, 0, 0, 0),
                // itemExtent:64,
                itemBuilder: (BuildContext ctx, int count){
                    if( count.isEven ) return Divider(color: Colors.lime, height:0, indent: 0,);
                    RandomWords word = new RandomWords();
                    _list.add(word);
                    print("build List length ${_list.length} $count");
                    return buildListTile(word, count);
                },
            );

        }
    }

    class RandomWordsState extends State<RandomWords> {
        bool _state = false;
        bool _light = false;
        final wp = new WordPair.random();

        @override
        Widget build(BuildContext context){

            Color color = _light? Colors.lime: _state? Colors.pink:Colors.blueGrey;
            TextStyle style = new TextStyle(fontSize: 24, color:color);

            return new GestureDetector(
                onTapDown:(detail){
                    setState(() { _state = true; });
                },
                onTapUp:(detail){
                    new Future.delayed(const Duration(milliseconds: 60)).then((t){
                        setState(() { _state = false; });
                    });
                },
                onTap: (){
                    print("tap... ${DateTime.now().toString()}");
                },
                onDoubleTap:(){
                    setState(() { _light = !_light; });
                },
                child: new Text(wp.asPascalCase, style:style),
            );
        }
    }

    class RandomWords extends StatefulWidget {
        @override   
        State<StatefulWidget> createState(){
            return new RandomWordsState();
        }
    }


## âš¡ é¡µé¢å¯¼èˆª Navigator

`Navigator` ç»“åˆ `MaterialPageRoute`

