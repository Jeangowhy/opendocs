= AsciiDoctor 2.0.23
// settings:
:page-layout: base
:idprefix:
:idseparator: -
:source-language: ruby
:language: {source-language}
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
// Variables:
:release-version: 2.0.23
:page-component-version: 2.0
// URIs:
:uri-org: https://github.com/asciidoctor
:uri-repo: {uri-org}/asciidoctor
:uri-asciidoctorj: {uri-org}/asciidoctorj
:uri-asciidoctorjs: {uri-org}/asciidoctor.js
:uri-project: https://asciidoctor.org
ifdef::env-site[:uri-project: link:]
:uri-docs: {uri-project}/docs
:uri-news: {uri-project}/news
:uri-manpage: {uri-project}/man/asciidoctor
:uri-issues: {uri-repo}/issues
:uri-contributors: {uri-repo}/graphs/contributors
:uri-rel-file-base: link:
:uri-rel-tree-base: link:
ifdef::env-site[]
:uri-rel-file-base: {uri-repo}/blob/HEAD/
:uri-rel-tree-base: {uri-repo}/tree/HEAD/
endif::[]
:uri-changelog: {uri-rel-file-base}CHANGELOG.adoc
:uri-contribute: {uri-rel-file-base}CONTRIBUTING.adoc
:uri-license: {uri-rel-file-base}LICENSE
:uri-tests: {uri-rel-tree-base}test
:uri-discuss: https://discuss.asciidoctor.org
:uri-chat: https://asciidoctor.zulipchat.com
:uri-rubygem: https://rubygems.org/gems/asciidoctor
:uri-what-is-asciidoc: {uri-docs}/what-is-asciidoc
:uri-user-manual: {uri-docs}/user-manual
:uri-install-docker: https://github.com/asciidoctor/docker-asciidoctor
//:uri-install-doc: {uri-docs}/install-toolchain
:uri-install-osx-doc: {uri-docs}/install-asciidoctor-macosx
:uri-render-doc: {uri-docs}/render-documents
:uri-themes-doc: {uri-docs}/produce-custom-themes-using-asciidoctor-stylesheet-factory
:uri-gitscm-repo: https://github.com/git/git-scm.com
:uri-freesoftware: https://www.gnu.org/philosophy/free-sw.html
:uri-foundation: https://foundation.zurb.com
:uri-tilt: https://github.com/rtomayko/tilt
:uri-ruby: https://ruby-lang.org
// images:
:image-uri-screenshot: https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor/screenshot.png

[source,bash,hightlight]
-------------
while read -r it
do
    if ! [ -f "$it" ]; then echo "Not found: $it"; fi
    echo "// /$it" >> $0
    cat "$it" >> $0
done << EOF
modules/ROOT/pages/features.adoc
modules/ROOT/pages/whats-new.adoc
modules/ROOT/pages/index.adoc
EOF
exit
-------------

// /modules/ROOT/nav-top.adoc
[]
* xref:#ROOT:features.adoc[]

[]
* xref:#ROOT:whats-new.adoc[]
* xref:#ROOT:index.adoc[]

// /modules/install/nav.adoc
* xref:#install:index.adoc[]
** xref:#install:supported-platforms.adoc[]
** xref:#install:ruby-packaging.adoc[]
** xref:#install:linux-packaging.adoc[]
** xref:#install:macos.adoc[]
** xref:#install:windows.adoc[]

// /modules/get-started/nav.adoc
* xref:#get-started:index.adoc[]

// /modules/convert/nav.adoc
* xref:#convert:index.adoc[]
** xref:#convert:available.adoc[]
** xref:#convert:custom.adoc[]
** xref:#convert:templates.adoc[]
** xref:#convert:contexts-ref.adoc[]

// /modules/html-backend/nav.adoc
* xref:#html-backend:index.adoc[]
** Stylesheets
*** xref:#html-backend:default-stylesheet.adoc[]
*** xref:#html-backend:stylesheet-modes.adoc[]
*** xref:#html-backend:custom-stylesheet.adoc[]
*** xref:#html-backend:source-highlighting-stylesheets.adoc[]
** xref:#html-backend:manage-images.adoc[]
** xref:#html-backend:local-font-awesome.adoc[]
** xref:#html-backend:favicon.adoc[]
** xref:#html-backend:verbatim-line-wrap.adoc[]
** xref:#html-backend:skip-front-matter.adoc[]
** xref:#ROOT:docinfo.adoc[]

// /modules/docbook-backend/nav.adoc
* xref:#docbook-backend:index.adoc[]

// /modules/manpage-backend/nav.adoc
* xref:#manpage-backend:index.adoc[]

// /modules/cli/nav.adoc
* xref:#cli:index.adoc[]
** xref:#man1:asciidoctor.adoc[]
** xref:#cli:output-file.adoc[]
** xref:#cli:process-multiple-files.adoc[]
** xref:#cli:io-piping.adoc[]
** xref:#cli:set-safe-mode.adoc[]
** xref:#options[CLI Options]

// /modules/api/nav.adoc
* xref:#api:index.adoc[]
** xref:#api:convert-files.adoc[]
** xref:#api:convert-strings.adoc[]
** xref:#api:generate-html-toc.adoc[]
** xref:#api:set-safe-mode.adoc[]
** xref:#api:sourcemap.adoc[]
** xref:#api:catalog-assets.adoc[]
** xref:#api:find-blocks.adoc[]
** xref:#api:options.adoc[]

// /modules/ROOT/nav-safe-modes.adoc
* xref:#ROOT:safe-modes.adoc[]
** xref:#ROOT:reference-safe-mode.adoc[]

// /modules/tooling/nav.adoc
* xref:#tooling:index.adoc[]

// /modules/syntax-highlighting/nav.adoc
* xref:#syntax-highlighting:index.adoc[]
** xref:#syntax-highlighting:highlightjs.adoc[]
** xref:#syntax-highlighting:rouge.adoc[]
** xref:#syntax-highlighting:coderay.adoc[]
** xref:#syntax-highlighting:pygments.adoc[]
** xref:#syntax-highlighting:custom.adoc[]

// /modules/stem/nav.adoc
* xref:#stem:index.adoc[]
** xref:#stem:mathjax.adoc[]
** xref:#stem:mathematical.adoc[]
** xref:#stem:docbook.adoc[]
** xref:#stem:asciimath-gem.adoc[]

// /modules/extensions/nav.adoc
* xref:#extensions:index.adoc[]
** xref:#extensions:register.adoc[]
** xref:#extensions:logging.adoc[]
** xref:#extensions:preprocessor.adoc[]
** xref:#extensions:tree-processor.adoc[]
** xref:#extensions:postprocessor.adoc[]
** xref:#extensions:docinfo-processor.adoc[]
** xref:#extensions:block-processor.adoc[]
** xref:#extensions:compound-block-processor.adoc[]
** xref:#extensions:block-macro-processor.adoc[]
** xref:#extensions:inline-macro-processor.adoc[]
** xref:#extensions:include-processor.adoc[]

// /modules/ROOT/nav-lang.adoc
* xref:#ROOT:localization-support.adoc[]

// /modules/ROOT/nav-errors.adoc
* xref:#ROOT:errors-and-warnings.adoc[]

// /modules/migrate/nav.adoc
* Migration Guides
** xref:#migrate:upgrade.adoc[]
** xref:#migrate:asciidoc-py.adoc[]
** xref:#migrate:docbook-xml.adoc[]
** xref:#migrate:markdown.adoc[]
** xref:#migrate:confluence-xhtml.adoc[]
** xref:#migrate:ms-word.adoc[]

<<README.adoc>> | <<CHANGELOG.adoc>> | <<reference:syntax.adoc>>


// /docs/antora.yml
= TOC configuration for Antora

[source,yml,hightlight]
------------
name: asciidoctor
title: Asciidoctor
version: '2.0'
asciidoc:
  attributes:
    xrefstyle: short@
    listing-caption: Example@
    release-version: '2.0.23'
    ruby-description: 'ruby 3.3.0 [x86_64-linux]'
    ruby-version: '3.3'
    url-api-gems: https://www.rubydoc.info/gems
    url-ruby: https://www.ruby-lang.org
    url-rubygems: https://rubygems.org/gems
    url-rvm: https://rvm.io
nav:
- modules/ROOT/nav-top.adoc
- modules/install/nav.adoc
- modules/get-started/nav.adoc
- modules/convert/nav.adoc
- modules/html-backend/nav.adoc
- modules/docbook-backend/nav.adoc
- modules/manpage-backend/nav.adoc
- modules/cli/nav.adoc
- modules/api/nav.adoc
- modules/ROOT/nav-safe-modes.adoc
- modules/tooling/nav.adoc
- modules/syntax-highlighting/nav.adoc
- modules/stem/nav.adoc
- modules/extensions/nav.adoc
- modules/ROOT/nav-lang.adoc
- modules/ROOT/nav-errors.adoc
- modules/migrate/nav.adoc
------------

-----------------
modules/cli/pages/options.adoc
modules/html-backend/examples/my-document.adoc
modules/html-backend/examples/wrap.adoc
modules/install/partials/success.adoc
modules/manpage-backend/examples/manpage.adoc
modules/migrate/examples/convert.groovy

modules/syntax-highlighting/examples/always-number-lines.rb
modules/syntax-highlighting/examples/autolink-urls-in-comments.rb
modules/syntax-highlighting/examples/extended-pygments-syntax-highlighter.rb
modules/syntax-highlighting/examples/prism-syntax-highlighter.rb
-----------------

// /README.adoc
[[README.adoc]]
= Asciidoctor
// Dan Allen <https://github.com/mojavelinux[@mojavelinux]>; Sarah White <https://github.com/graphitefriction[@graphitefriction]>
// v2.0.23, 2024-05-17
// settings:
:idprefix:
:idseparator: -
:source-language: ruby
:language: {source-language}
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
// Variables:
:release-version: 2.0.23
// URLs:
:url-org: https://github.com/asciidoctor
:url-repo: {url-org}/asciidoctor
:url-asciidoctorj: {url-org}/asciidoctorj
:url-asciidoctorjs: {url-org}/asciidoctor.js
:url-gradle-plugin: {url-org}/asciidoctor-gradle-plugin
:url-maven-plugin: {url-org}/asciidoctor-maven-plugin
:url-asciidoclet: {url-org}/asciidoclet
:url-project: https://asciidoctor.org
ifdef::env-site[:url-project: link:]
:url-docs: https://docs.asciidoctor.org
:url-news: {url-project}/news
:url-manpage: {url-project}/man/asciidoctor
:url-issues: {url-repo}/issues
:url-contributors: {url-repo}/graphs/contributors
:url-rel-file-base: link:
:url-rel-tree-base: link:
ifdef::env-site,env-yard[]
:url-rel-file-base: {url-repo}/blob/HEAD/
:url-rel-tree-base: {url-repo}/tree/HEAD/
endif::[]
:url-changelog: {url-rel-file-base}CHANGELOG.adoc
:url-contribute: {url-rel-file-base}CONTRIBUTING.adoc
:url-license: {url-rel-file-base}LICENSE
:url-tests: {url-rel-tree-base}test
:url-discuss: https://discuss.asciidoctor.org
:url-chat: https://asciidoctor.zulipchat.com
:url-rubygem: https://rubygems.org/gems/asciidoctor
:url-what-is-asciidoc: {url-docs}/asciidoctor/latest/#relationship-to-asciidoc
:url-install-docker: https://github.com/asciidoctor/docker-asciidoctor
:url-opal: https://opalrb.com
:url-tilt: https://github.com/rtomayko/tilt
:url-ruby: https://www.ruby-lang.org
// images:
:image-url-screenshot: https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor/screenshot.png

{url-project}[Asciidoctor] is a fast, open source, Ruby-based text processor for parsing AsciiDoc(R) into a document model and converting it to output formats such as HTML 5, DocBook 5, manual pages, PDF, EPUB 3, and other formats.

Asciidoctor also has an ecosystem of extensions, converters, build plugins, and tools to help you author and publish content written in {url-what-is-asciidoc}[AsciiDoc].
You can find the documentation for these projects at {url-docs}.

In addition to running on Ruby, Asciidoctor can be executed on a JVM using {url-asciidoctorj}[AsciidoctorJ] or in any JavaScript environment using {url-asciidoctorjs}[Asciidoctor.js].

ifndef::env-site,env-yard[]
This document is also available in the following languages: +
{url-rel-file-base}#README-zh_CN.adoc[汉语]
|
{url-rel-file-base}README-de.adoc[Deutsch]
|
{url-rel-file-base}README-fr.adoc[Français]
|
{url-rel-file-base}README-jp.adoc[日本語]
endif::[]

.Key documentation
[.compact]
* {url-docs}/asciidoctor/latest/[Asciidoctor Documentation]
* {url-docs}/asciidoc/latest/[AsciiDoc Language Documentation]
* {url-docs}/asciidoc/latest/syntax-quick-reference/[AsciiDoc Syntax Quick Reference]

ifdef::status[]
image:https://img.shields.io/gem/v/asciidoctor.svg[Latest Release, link={url-rubygem}]
image:https://img.shields.io/badge/rubydoc.info-{release-version}-blue.svg[library (API) docs,link=https://www.rubydoc.info/gems/asciidoctor/{release-version}]
image:https://github.com/asciidoctor/asciidoctor/workflows/CI/badge.svg[Build Status (GitHub Actions),link={url-repo}/actions]
image:https://img.shields.io/badge/zulip-join_chat-brightgreen.svg[Project Chat (Zulip),link={url-chat}]
endif::[]

== Sponsors

We want to recognize our {url-project}/supporters[sponsors] for their commitment to improving the state of technical documentation by supporting this project.
Thank you sponsors!
Without your generous support, Asciidoctor would not be possible.

You can support this project by becoming a sponsor through https://opencollective.com/asciidoctor[OpenCollective].

== AsciiDoc Processing and Built-in Converters

AsciiDoc is the language. +
Asciidoctor is the processor.

Asciidoctor reads the AsciiDoc source, as shown in the panel on the left in the image below, and converts it to publishable formats, such as HTML 5, as shown rendered in the panel on the right.

image::{image-url-screenshot}[Preview of AsciiDoc source and corresponding rendered HTML]

Asciidoctor provides built-in {url-docs}/asciidoctor/latest/converters/[converters] for three output formats by default: {url-docs}/asciidoctor/latest/html-backend/[HTML 5], {url-docs}/asciidoctor/latest/docbook-backend/[DocBook 5], and {url-docs}/asciidoctor/latest/manpage-backend/[man page] (short for manual page).
Additional converters, such as PDF and EPUB 3, are provided by separate gems.
Asciidoctor also provides an out-of-the-box HTML experience complete with a {url-docs}/asciidoctor/latest/html-backend/default-stylesheet/[default stylesheet] and built-in integrations like Font Awesome (for icons), highlight.js, Rouge, and Pygments (for source highlighting), and MathJax (for STEM processing).

== Asciidoctor Ecosystem

Although Asciidoctor is written in Ruby, it does not mean you need Ruby to use it.
Asciidoctor can be executed on a JVM using {url-docs}/asciidoctorj/latest/[AsciidoctorJ] or in any JavaScript environment (including the browser) using {url-docs}/asciidoctor.js/latest/[Asciidoctor.js].

Installing an Asciidoctor processor is just the beginning of your publishing experience.
Asciidoctor gives you access to a ecosystem of extensions and tools, ranging from add-on converters, to extended syntax, to build plugins, to integrated writing and preview environments:

* {url-docs}/diagram-extension/latest/[Asciidoctor Diagram]
* {url-docs}/maven-tools/latest/[Maven plugin and site module]
* {url-gradle-plugin}[Gradle plugin]
* {url-docs}/asciidoclet/latest/[Asciidoclet]
* {url-docs}/reveal.js-converter/latest/[reveal.js converter]
* {url-docs}/epub3-converter/latest/[EPUB 3 converter]
* https://intellij-asciidoc-plugin.ahus1.de/docs[IntelliJ plugin]
* {url-docs}/asciidoctor/latest/tooling/#web-browser-add-ons-preview-only[web browser extensions]
* {url-org}[and more]

Asciidoctor is the successor to AsciiDoc.py.
If you're using AsciiDoc.py, see {url-docs}/asciidoctor/latest/migrate/asciidoc-py/[Migrate from AsciiDoc.py] to learn how to upgrade to Asciidoctor.

== Requirements

Asciidoctor works on Linux, macOS and Windows and requires one of the following implementations of {url-ruby}[Ruby]:

* CRuby (aka MRI) 2.3 - 3.3
* JRuby 9.1 - 9.4
* TruffleRuby (GraalVM)

[CAUTION]
====
If you're using a non-English Windows environment, you may bump into an `Encoding::UndefinedConversionError` when invoking Asciidoctor.
To solve this issue, we recommend overriding the default external and internal character encodings to `utf-8`.
You can do so by setting the `RUBYOPT` environment variable as follows:

 RUBYOPT="-E utf-8:utf-8"

Once you make this change, all your Unicode headaches should be behind you.

If you're using an IDE like Eclipse, make sure you set the encoding to UTF-8 there as well.
Asciidoctor is optimized to work with UTF-8 as the default encoding.
====

== Installation

Asciidoctor is packaged and distributed to RubyGems.org as a RubyGem (aka gem) named {url-rubygem}[asciidoctor^].
The asciidoctor gem can be installed on all major operating systems using Ruby packaging tools (gem or bundle).
Asciidoctor is also distributed as a Docker image, as a package for numerous Linux distributions, and as a package for macOS (via Homebrew and MacPorts).

=== Linux package managers

The version of Asciidoctor installed by the package manager may not match the latest release of Asciidoctor.
Consult the package repository for your distribution to find out which version is packaged per distribution release.

* https://pkgs.alpinelinux.org/packages?name=asciidoctor[Alpine Linux (asciidoctor)]
* https://www.archlinux.org/packages/?name=asciidoctor[Arch Linux (asciidoctor)]
* https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
* https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (asciidoctor)]
* https://software.opensuse.org/package/rubygem-asciidoctor[OpenSUSE (rubygem-asciidoctor)]
* https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]

If you want to use a version of Asciidoctor that's newer than what is installed by the package manager, see the <<gem-install,gem installation instructions>>.

==== apk (Alpine Linux)

To install the gem on Alpine Linux, open a terminal and type:

 $ sudo apk add asciidoctor

==== pacman (Arch Linux)

To install the gem on Arch-based distributions, open a terminal and type:

 $ sudo pacman -S asciidoctor

==== APT

On Debian and Debian-based distributions such as Ubuntu, use APT to install Asciidoctor.
To install the package, open a terminal and type:

 $ sudo apt-get install -y asciidoctor

==== DNF

On RPM-based Linux distributions, such as Fedora, CentOS, and RHEL, use the DNF package manager to install Asciidoctor.
To install the package, open a terminal and type:

 $ sudo dnf install -y asciidoctor

=== macOS

==== Homebrew

You can use https://brew.sh[Homebrew], the macOS package manager, to install Asciidoctor.
If you don't have Homebrew on your computer, complete the https://brew.sh[installation instructions] first.

Once Homebrew is installed, you're ready to install the `asciidoctor` gem.
Open a terminal and type:

 $ brew install asciidoctor

Homebrew installs the `asciidoctor` gem into an exclusive prefix that's independent of system gems.

==== MacPorts

You can also use https://www.macports.org[MacPorts], another package manager for macOS, to install Asciidoctor.
If you don't have MacPorts on your computer, complete the https://www.macports.org/install.php[installation instructions] first.

Once MacPorts is installed, you're ready to install the `asciidoctor` gem via the https://ports.macports.org/port/asciidoctor/[Asciidoctor port].
Open a terminal and type:

 $ sudo port install asciidoctor

=== Windows

To use Asciidoctor with Windows, you have two options.

==== Chocolatey

When you already use https://chocolatey.org[chocolatey] on your machine, you can use:

[source]
----
choco install ruby
----

Then follow <<gem-install,gem installation instructions>>.

==== Rubyinstaller

Or you use the https://rubyinstaller.org/downloads/[Rubyinstaller], download the package for your Windows Version and after the installation go ahead with <<gem-install,gem installation instructions>>.

[#gem-install]
=== gem install

Before installing Asciidoctor using `gem install`, you should set up https://rvm.io[RVM] (or similar) to install Ruby in your home directory (i.e., user space).
Then, you can safely use the `gem` command to install or update the Asciidoctor gem, or any other gem for that matter.
When using RVM, gems are installed in a location isolated from the system.
(You should never use the gem command to install system-wide gems).

Once you've installed Ruby using RVM, and you have activated it using `rvm use 3.0`, open a terminal and type:

 $ gem install asciidoctor

If you want to install a pre-release version (e.g., a release candidate), use:

 $ gem install asciidoctor --pre

=== Docker

See {url-install-docker}[Installing Asciidoctor using Docker].

=== Bundler

. Create a Gemfile in the root folder of your project (or the current directory)
. Add the `asciidoctor` gem to your Gemfile as follows:
+
[source,subs=attributes+]
----
source 'https://rubygems.org'
gem 'asciidoctor'
# or specify the version explicitly
# gem 'asciidoctor', '{release-version}'
----

. Save the Gemfile
. Open a terminal and install the gem using:

 $ bundle

To upgrade the gem, specify the new version in the Gemfile and run `bundle` again.
Using `bundle update` (without specifying a gem) is *not* recommended as it will also update other gems, which may not be the desired result.

== Upgrade

If you installed Asciidoctor using a package manager, your operating system is probably configured to automatically update packages, in which case you don't need to update the gem manually.

=== apk (Alpine Linux)

To upgrade the gem, use:

 $ sudo apk add -u asciidoctor

=== APT

To upgrade the gem, use:

 $ sudo apt-get upgrade -y asciidoctor

=== DNF

To upgrade the gem, use:

 $ sudo dnf update -y asciidoctor

=== Homebrew (macOS)

To upgrade the gem, use:

 $ brew update
 $ brew upgrade asciidoctor

=== MacPorts (macOS)

To upgrade the gem, use:

 $ sudo port selfupdate
 $ sudo port upgrade asciidoctor

=== gem install

If you previously installed Asciidoctor using the `gem` command, you'll need to manually upgrade Asciidoctor when a new version is released.
You can upgrade the gem by typing:

 $ gem install asciidoctor

When you install a new version of the gem using `gem install`, you end up with multiple versions installed.
Use the following command to remove the old versions:

 $ gem cleanup asciidoctor

== Usage

If the Asciidoctor gem installed successfully, the `asciidoctor` command line interface (CLI) will be available on your PATH.
To verify it's available, run the following in your terminal:

 $ asciidoctor --version

You should see information about the Asciidoctor version and your Ruby environment printed in the terminal.

[.output,subs=attributes+]
....
Asciidoctor {release-version} [https://asciidoctor.org]
Runtime Environment (ruby 3.0.1p64 [x86_64-linux]) (lc:UTF-8 fs:UTF-8 in:UTF-8 ex:UTF-8)
....

=== Command line interface (CLI)

The `asciidoctor` command allows you to invoke Asciidoctor from the command line (i.e., a terminal).

The following command converts the file README.adoc to HTML and saves the result to the file README.html in the same directory.
The name of the generated HTML file is derived from the source file by changing its file extension to `.html`.

 $ asciidoctor README.adoc

You can control the Asciidoctor processor by adding various flags and switches, which you can learn about using:

 $ asciidoctor --help

For instance, to write the file to a different directory, use:

 $ asciidoctor -D output README.adoc

The `asciidoctor` {url-manpage}[man page] provides a complete reference of the command line interface.

Refer to the following resources to learn more about how to use the `asciidoctor` command.

* {url-docs}/asciidoctor/latest/cli/[Process AsciiDoc using the CLI]
* {url-docs}/asciidoctor/latest/cli/options/[CLI options]

=== Ruby API

Asciidoctor also provides an API.
The API is intended for integration with other Ruby software, such as Rails, GitHub, and GitLab, as well as other languages, such as Java (via AsciidoctorJ) and JavaScript (via Asciidoctor.js).

To use Asciidoctor in your application, you first need to require the gem:

[source]
require 'asciidoctor'

You can then convert an AsciiDoc source file to an HTML file using:

[source]
Asciidoctor.convert_file 'README.adoc', to_file: true, safe: :safe

WARNING: When using Asciidoctor via the API, the default safe mode is `:secure`.
In secure mode, several core features are disabled, including the `include` directive.
If you want to enable these features, you'll need to explicitly set the safe mode to `:server` (recommended) or `:safe`.

You can also convert an AsciiDoc string to embeddable HTML (for inserting in an HTML page) using:

[source]
----
content = '_Zen_ in the art of writing https://asciidoctor.org[AsciiDoc].'
Asciidoctor.convert content, safe: :safe
----

If you want the full HTML document, enable the `header_footer` option as follows:

[source]
----
content = '_Zen_ in the art of writing https://asciidoctor.org[AsciiDoc].'
html = Asciidoctor.convert content, header_footer: true, safe: :safe
----

If you need access to the parsed document, you can split the conversion into discrete steps:

[source]
----
content = '_Zen_ in the art of writing https://asciidoctor.org[AsciiDoc].'
document = Asciidoctor.load content, header_footer: true, safe: :safe
puts document.doctitle
html = document.convert
----

Keep in mind that if you don't like the output Asciidoctor produces, _you can change it!_
Asciidoctor supports custom converters that can handle converting from the parsed document to the generated output.

One easy way to customize the output piecemeal is by using the template converter.
The template converter allows you to supply a {url-tilt}[Tilt]-supported template file to handle converting any node in the document.

However you go about it, you _can_ have 100% control over the output.
For more information about how to use the API or to customize the output, see:

* {url-docs}/asciidoctor/latest/api/[Process AsciiDoc using the API]
* {url-docs}/asciidoctor/latest/api/options/[API options]
* {url-docs}/asciidoctor/latest/safe-modes/[Safe modes]

== Contributing

New contributors are always welcome!
If you discover errors or omissions in the source code, documentation, or website content, please don't hesitate to submit an issue or open a pull request with a fix.

Here are some ways *you* can contribute:

* by using prerelease (alpha, beta or preview) versions
* by reporting bugs
* by suggesting new features
* by writing or editing documentation
* by writing code with tests -- _No patch is too small._
** fix typos
** add comments
** clean up inconsistent whitespace
** write tests!
* by refactoring code
* by fixing {url-issues}[issues]
* by reviewing patches

The {url-contribute}[Contributing] guide provides information on how to create, style, and submit issues, feature requests, code, and documentation to Asciidoctor.

== Getting Help

Asciidoctor is developed to help you easily write and publish your content.
But we can't do it without your feedback!
We encourage you to ask questions and discuss any aspects of the project on the discussion list, on Twitter or in the chat room.

Chat (Zulip):: {url-chat}
Discussion list (Nabble):: {url-discuss}
Twitter:: Follow https://twitter.com/asciidoctor[@asciidoctor] or search for the https://twitter.com/search?f=tweets&q=%23asciidoctor[#asciidoctor] hashtag

ifdef::env-github[]
Further information and documentation about Asciidoctor can be found on the project's website.

{url-project}[Home] | {url-news}[News] | {url-docs}[Docs]
endif::[]

The Asciidoctor organization on GitHub hosts the project's source code, issue tracker, and sub-projects.

Source repository (git):: {url-repo}
Issue tracker:: {url-issues}
Asciidoctor organization on GitHub:: {url-org}

== Code of Conduct

The core Asciidoctor project is governed by the https://github.com/asciidoctor/.github/blob/HEAD/CODE-OF-CONDUCT.md[Code of Conduct] for the Asciidoctor community of projects.
By participating, you're agreeing to honor this code.
Let's work together to make this a welcoming, professional, inclusive, and safe environment for everyone.

== Versioning and Release Policy

This project adheres to semantic versioning (*major.minor.patch*).
Typically, patch releases are only made for the current minor release.
However, exceptions are made on a case-by-case basis to address security vulnerabilities and other high-priority issues.

== Copyright and License

Copyright (C) 2012-present Dan Allen, Sarah White, Ryan Waldron, and the individual contributors to Asciidoctor.
Use of this software is granted under the terms of the MIT License.

See the {url-license}[LICENSE] for the full license text.

== Authors

*Asciidoctor* is led by https://github.com/mojavelinux[Dan Allen] and https://github.com/graphitefriction[Sarah White] and has received contributions from {url-contributors}[many individuals] in Asciidoctor's awesome community.
The project was initiated in 2012 by https://github.com/erebor[Ryan Waldron] based on a prototype written by https://github.com/nickh[Nick Hengeveld] for the Git website.

*AsciiDoc.py* was started and maintained by Stuart Rackham from https://github.com/asciidoc-py/asciidoc-py2/blob/HEAD/CHANGELOG.txt[2002 to 2013] and has received contributions from many individuals in the https://github.com/asciidoc-py/asciidoc-py2/graphs/contributors[AsciiDoc.py community].

== Trademarks

AsciiDoc(R) and AsciiDoc Language(TM) are trademarks of the Eclipse Foundation, Inc.

ifndef::env-site[]
== Changelog

ifeval::[{safe-mode-level} < 20]
include::CHANGELOG.adoc[tag=compact,leveloffset=+1]
endif::[]

Refer to the {url-changelog}[CHANGELOG] for a complete list of changes in older releases.
endif::[]

// /README-zh_CN.adoc
[[README-zh_CN.adoc]]
= Asciidoctor [zh_CN]

{uri-project}/[Asciidoctor] 是一个 _快速_ 文本处理器和发布工具链，它可以将 {uri-what-is-asciidoc}[AsciiDoc] 文档转化成 HTML 5、 DocBook 5 以及其他格式。
Asciidoctor 由 Ruby 编写，打包成 RubyGem，然后发布到 {uri-rubygem}[RubyGems.org] 上。
这个 gem 还被包含到几个 Linux 发行版中，其中包括 Fedora、Debian 和 Ubuntu。
Asciidoctor 是开源的，link:{uri-repo}[代码托管在 GitHub]，遵从 {uri-license}[MIT] 协议。

该文档有如下语言的翻译版：

* {uri-rel-file-base}README.adoc[English]
* {uri-rel-file-base}README-fr.adoc[Français]
* {uri-rel-file-base}README-jp.adoc[日本語]

.关键文档
[.compact]
* {uri-docs}/what-is-asciidoc[Asciidoctor 是什么？]
* {uri-docs}/asciidoc-writers-guide[AsciiDoc 写作指南]
* {uri-docs}/asciidoc-syntax-quick-reference[AsciiDoc 语法快速参考]
* {uri-docs}/user-manual[Asciidoctor 用户手册]

ifdef::status[]
image:https://img.shields.io/gem/v/asciidoctor.svg[Latest Release, link={uri-gem}]
image:https://img.shields.io/badge/rubydoc.info-{release-version}-blue.svg[library (API) docs,link=https://www.rubydoc.info/gems/asciidoctor/{release-version}]
image:https://github.com/asciidoctor/asciidoctor/workflows/CI/badge.svg[Build Status (GitHub Actions),link={uri-repo}/actions]
image:https://img.shields.io/badge/zulip-join_chat-brightgreen.svg[Project Chat,link={uri-chat}]
endif::[]

.Ruby 所至， Asciidoctor 相随
****
使用 JRuby 让 Asciidoctor 运行在 Java 虚拟机上。
使用 {uri-asciidoctorj}[AsciidoctorJ] 直接调用 Asciidoctor 的 API 运行在 Java 或者其他 Java 虚拟机中。
基于 AsciidoctorJ 有好多插件可用，这些插件可以将 Asciidoctor 整合到 Apache Maven，Gradle 或 Javadoc 构建中。

Asciidoctor 也可以运行在 JavaScript 上。
我们可以使用 https://opalrb.com[Opal] 将 Ruby 源码编译成 JavaScript 生成 {uri-asciidoctorjs}[Asciidoctor.js] 文件，这是一个全功能版的 Asciidoctor，可以运行在任意的 JavaScript 环境中，比如 Web 浏览器 或 Node.js。
Asciidoctor.js 被用于预览 AsciiDoc，支持 Chrome 扩展，Atom，Brackets 或其他基于 Web 的工具。
****

[#the-big-picture]
== 整体概况

Asciidoctor 以纯文本格式读取内容，见下图左边的面板，并将它转换成 HTML 5 呈现在右侧面板中。
Asciidoctor 将默认的样式表应用到 HTML 5 文档上，提供一个愉快的开箱即用的体验。

image::{image-uri-screenshot}[AsciiDoc 源文预览和相应的 HTML 渲染]

[#asciidoc-processing]
== AsciiDoc Processing

Asciidoctor 会读取并处理用 AsciiDoc 语法写的文件，然后将解析出来的解析树参数交给内置的转化器去生成 HTML 5，DocBook 5 或帮助手册页面输出。
你可以选择使用你自己的转化器或者加载 {uri-tilt}[Tilt] - 支持通过模板来自定义输出或产生附加的格式。

NOTE: Asciidoctor是为了直接替换原 AsciiDoc Python 处理器（`asciidoc.py`）。
Asciidoctor 测试套件含有 {uri-tests}[> 1,600 测试示例] 来确保和 AsciiDoc 语法的兼容性。

除了传统的 AsciiDoc 语法，Asciidoctor 还添加额外的标记和格式设置选项，例如 font-based 图标（例如： `+icon:fire[]+`）和 UI 元素（例如： `+button:[Save]+`）。
Asciidoctor 还提供了一个基于 {uri-foundation}[Foundation] 的现代化的、响应式主题来美化 HTML 5 输出。

[#requirements]
== 要求

Asciidoctor 可以运行在 Linux，OSX (Mac) 和 Windows 系统，但需要安装下面任意一个 {uri-ruby}[Ruby] 环境去实现：

* CRuby (aka MRI) 2.3 - 2.6
* JRuby 9.1 - 9.2
* TruffleRuby (GraalVM)
* Opal (JavaScript)

我们欢迎你来帮助在这些以及其他平台测试 Asciidoctor。

请参考 <<{idprefix}contributing,Contributing>> 来了解如何参与。

[CAUTION]
====
如果在非英语的 Windows 环境，当你去调用 Asciidoctor 时，可能会碰到 `Encoding::UndefinedConversionError` 的错误提示。
为了解决这个问题，我们建议将控制台的编码更改为 UTF-8：

 chcp 65001

一旦你做了这个改变，所有的编码问题，都将迎刃而解。
如果你使用的是像 Eclipse 这样的 IDE 集成开发工具，你也需要确保他被你设置为 UTF-8 编码。
使用 UTF-8 能使 Asciidoctor 在任何地方都能正常工作。
====

[#installation]
== 安装

Asciidoctor 可以通过三种方式安装（a）`gem install` 命令；（b）Bundler打包编译；（c）流行的 Linux 发行版的包管理器

TIP: 使用 Linux 包管理器安装的好处是如果你机器在之前没有安装 Ruby 和 RubyGems 库，当你选择这种方式安装时它们会一并安装上去。
不利的是在 gem 发布之后，这类安装包并不是立即可用。
如果你需要安装最新版，你应该总是优先使用 `gem` 命令安装。

[#a-gem-install]
=== (a) gem 安装

打开一个终端输入如下命令（不含开头的 `$`）：

 $ gem install asciidoctor

如果想安装一个预览版（比如：候选发布版），请使用：

 $ gem install asciidoctor --pre

.升级
[TIP]
====
如果你安装有的是旧版本 Asciidoctor，你可以使用下面的命令来升级：

 $ gem update asciidoctor

如果使用 `gem install` 命令来安装一个新版本的 gem 来代替升级，会安装多个版本。
这种情况，你可以使用下面的 gem 命令来移除旧版本：

 $ gem cleanup asciidoctor
====

[#b-bundler]
=== (b) Bundler

. 在项目的根目录（或者当前路径），创建一个 `Gemfile` 文件；
. 在这个文件中添加 `asciidoctor` gem 如下：
+
[source,subs=attributes+]
----
source 'https://rubygems.org'
gem 'asciidoctor'
# 或者明确指明版本
# gem 'asciidoctor', '{release-version}'
----

. 保存 `Gemfile` 文件
. 打开终端，使用如下命令安装 gem：

 $ bundle

要升级 gem 的话，在 `Gemfile` 文件中，指明新版本，然后再次运行 `bundle` 即可。
*不推荐* 直接使用 `bundle update` 命令，因为它还会升级其他 gem，也许会造成不可预料的结果。

[#c-linux-package-managers]
=== (c) Linux 包管理

[#dnf-fedora-21-or-greater]
==== DNF (Fedora 21 或更高版本)

在 Fedora 21 或更高版本中安装这个 gem，可以使用 dnf。打开终端并输入如下命令：

 $ sudo dnf install -y asciidoctor

升级则使用：

 $ sudo dnf update -y asciidoctor

TIP: 如果你的 Fedora 系统配置的是自动升级包，在这种情况下，不需要你亲自动手升级。

[#apt-get-debian-ubuntu-mint]
==== apt-get (Debian, Ubuntu, Mint)

在 Debian，Ubuntu 或 Mint 中安装这个 gem，请打开终端并输入如下命令：

 $ sudo apt-get install -y asciidoctor

升级则使用：

 $ sudo apt-get upgrade -y asciidoctor

TIP: 如果你的 Debian 或 Ubuntu 系统配置的是自动升级包，在这种情况下，不需要你亲自动手升级。

使用包管理器（ apt-get ）安装的 Asciidoctor 的版本也许不是最新发布版。
请查看发行版的包库，来确定每个发行版是打包的哪个版本。

* https://packages.debian.org/search?keywords=asciidoctor&searchon=names&exact=1&suite=all&section=all[Debian 发行版中的 asciidoctor]
* https://packages.ubuntu.com/search?keywords=asciidoctor&searchon=names&exact=1&suite=all&section=all[Ubuntu 发行版中的 asciidoctor]
* https://community.linuxmint.com/software/view/asciidoctor[Mint 发行版中的 asciidoctor]

[CAUTION]
====
我们建议不要使用 `gem update` 来升级包管理的 gem。
这样做会使系统进入不一致的状态，包管理工具将不再跟踪相关文件（通常安装在 /usr/local 下。）
简单地说，系统的 gem 只能由包管理器进行管理。

如果你想使用一个比包管理器安装的更新版本的 Asciidoctor，你应该使用 https://rvm.io[RVM] 在你的用户家目录（比如：用户空间）下安装 Ruby。
然后，你就可以放心地使用 `gem` 命令来安装或者更新 Asciidoctor gem。
当使用 RVM 时，gem 将被安装到与系统隔离的位置。
====

[#apk-alpine-linux]
==== apk (Alpine Linux)

在 Alpine Linux 中安装这个 gem，请打开终端并输入如下命令：

 $ sudo apk add asciidoctor

升级则使用：

 $ sudo apk add -u asciidoctor

TIP: 如果你的 Alpine Linux 系统配置的是自动升级包，在这种情况下，不需要你亲自动手升级。

[#other-installation-options]
=== 其他安装选项

* {uri-install-docker}[使用 Docker 安装 Asciidoctor ]
* {uri-install-osx-doc}[在 Mac OS X 安装 Asciidoctor ]

[#usage]
== 使用

如果成功安装 Asciidoctor，则在可执行程序路径中，`asciidoctor` 就可用了。
为了验证它的可用性，你可以在终端中执行如下命令：

 $ asciidoctor --version

你应该看到关于 Asciidoctor 和 Ruby 环境信息将打印到你的终端上。

[.output,subs=attributes+]
....
Asciidoctor {release-version} [https://asciidoctor.org]
Runtime Environment (ruby 2.4.1p111 [x86_64-linux]) (lc:UTF-8 fs:UTF-8 in:- ex:UTF-8)
....

Asciidoctor 还提供了一套 API。
这套 API 是为了整合其他的 Ruby 软件，例如 Rails、Sinatra、GitHub，甚至其他语言，比如 Java （通过 {uri-asciidoctorj}[AsciidoctorJ]） 和 JavaScript （通过 {uri-asciidoctorjs}[Asciidoctor.js]）。

[#command-line-interface-cli]
=== 命令行（CLI）

`asciidoctor` 命令可以让你通过命令行（比如：终端）来调用 Asciidoctor。

下面的命令将 README.adoc 文件转化为 HTML，并且保存到同一目录下的 README.html 文件中。
生成的 HTML 文件名源自源文件名，只是将其扩展名改为了 `.html`。

 $ asciidoctor README.adoc

您可以通过添加各种标志和开关控制 Asciidoctor 处理器，通过下面的命令你可以学习它的更多用法：

 $ asciidoctor --help

比如，将文件写入到不同路径里，使用如下命令：

 $ asciidoctor -D output README.adoc

`asciidoctor` {uri-manpage}[帮助页面] 提供了这个命令的完整参考。

点击下面的资源，学习更多关于 `asciidoctor` 命令的用法。

* {uri-render-doc}[如何转化文档？]
* {uri-themes-doc}[如何使用 Asciidoctor 样式工厂来创建自定义主题？]

[#ruby-api]
=== Ruby API

为了在你应用中使用 Asciidoctor，首先需要引入这个 gem：

[source]
require 'asciidoctor'

然后，你可以通过下面的代码将 AsciiDoc 源文件转化成一个 HTML 文件：

[source]
Asciidoctor.convert_file 'README.adoc', to_file: true, safe: :safe

WARNING: 当你通过 API 使用 Asciidoctor 时，默认的安全模式是 `:secure`。
在 secure 模式下，很多核心特性将不可用，包括 `include` 特性。
如果你想启用这些特性，你需要明确设置安全模式为 `:server` （推荐）或 `:safe`。

你也可以将 AsciiDoc 字符串转化为可内嵌的 HTML （为了插入到一个 HTML 页面），用法如下：

[source]
----
content = '_Zen_ in the art of writing https://asciidoctor.org[AsciiDoc].'
Asciidoctor.convert content, safe: :safe
----

如果你想得到完整的 HTML 文档，只需要启用 `header_footer` 选项即可。如下：

[source]
----
content = '_Zen_ in the art of writing https://asciidoctor.org[AsciiDoc].'
html = Asciidoctor.convert content, header_footer: true, safe: :safe
----

如果你想访问已经处理过的文档，可以将转化过程拆分成离散的几步：

[source]
----
content = '_Zen_ in the art of writing https://asciidoctor.org[AsciiDoc].'
document = Asciidoctor.load content, header_footer: true, safe: :safe
puts document.doctitle
html = document.convert
----

请注意：如果你不喜欢 Asciidoctor 输出结果，_你完全可以改变它。_
Asciidoctor 支持自定义转化器，它可以操作从待处理文件到生成文档整个环节。

一个简单的、细微地自定义输出的方式是使用模板转化器。
模板转化器运行你提供一个 {uri-tilt}[Tilt] 模板，这样通过模板文件来操作转化出的文档的每个节点。

这样，你就 _可以_ 百分之百地控制你的输出。
关于更多关于 API 或自定义输出信息，请参考 {uri-user-manual}[用户帮助手册]。

[#contributing]
== 贡献

自由软件的精神鼓励 _每个人_ 来帮助改善这个项目。
如果你在源码、文档或网站内容中发现错误或漏洞，请不要犹豫，提交一个议题或者推送一个修复请求。
随时欢迎新的贡献者！

这里有几种 *你* 可以做出贡献的方式：

* 使用预发布版本（alpha, beta 或 preview）
* 报告 Bug
* 提议新功能
* 编写文档
* 编写规范
* 编写 -- _任何补丁都不小。_
** 修正错别字
** 添加评论
** 清理多余空白
** 编写测试！
* 重构代码
* 修复 {uri-issues}[issues]
* 审查补丁

{uri-contribute}[贡献指南]提供了如何提供贡献，包括如何创建、修饰和提交问题、特性、需求、代码和文档给 Asciidoctor 项目。

[#getting-help]
== 获得帮助

开发 Asciidoctor 项目是未来了帮助你更容易地书写和发布你的内容。
但是，如果没有反馈，我们将寸步难行。
我们鼓励你在讨论组、Twitter或聊天室里，提问为题，讨论项目的方方面面，

聊天 (Zulip):: {uri-chat}
讨论组 (Nabble):: {uri-discuss}
Twitter:: https://twitter.com/search?f=tweets&q=%23asciidoctor[#asciidoctor] 来加入话题 或 https://twitter.com/asciidoctor[@asciidoctor] at并提醒我们

ifdef::env-github[]
Further information and documentation about Asciidoctor can be found on the project's website.

{uri-project}/[Home] | {uri-news}[News] | {uri-docs}[Docs]
endif::[]

Asciidoctor 组织在 GitHub 托管代码、议案跟踪和相关子项目。

代码库 (git):: {uri-repo}
议案跟踪:: {uri-issues}
在 GitHub 的 Asciidoctor 组织:: {uri-org}

[#copyright-and-licensing]
== 版权和协议

Copyright (C) 2012-present Dan Allen, Sarah White, Ryan Waldron, and the individual contributors to Asciidoctor.
这个软件的免费使用是在MIT许可条款授予的。

请看 {uri-license}[版权声明] 文件来获取更多详细信息。

[#authors]
== 作者

*Asciidoctor* 由 https://github.com/mojavelinux[Dan Allen] 和 https://github.com/graphitefriction[Sarah White] 领导，并从 Asciidoctor 社区的 {uri-contributors}[很多其他独立开发者] 上收到了很多贡献。
项目最初由 https://github.com/erebor[Ryan Waldron] 于 2012年基于 https://github.com/nickh[Nick Hengeveld] 的原型创建。

*AsciiDoc* 由 Stuart Rackham 启动，并从 AsciiDoc 社区的其他独立开发者上收到很多贡献。

== Changelog

请看 {uri-changelog}[CHANGELOG]。


[[man1:asciidoctor.adoc]]
= asciidoctor(1)
// Dan Allen; Sarah White
:doctype: manpage
:release-version: 2.0.23
:man manual: Asciidoctor Manual
:man source: Asciidoctor {release-version}
ifdef::backend-manpage[:!author:]

== Name

asciidoctor - converts AsciiDoc source files to HTML, DocBook, and other formats

== Synopsis

*asciidoctor* [_OPTION_]... _FILE_...

== Description

The asciidoctor(1) command converts the AsciiDoc source file(s) _FILE_ to HTML5, DocBook 5, man(ual) page, and other custom output formats.

If _FILE_ is _-_ then the AsciiDoc source is read from standard input.

== Options

// tag::options[]
=== Security Settings

*-B, --base-dir*=_DIR_::
  Base directory containing the document and resources.
  Defaults to the directory containing the source file or, if the source is read from a stream, the working directory.
  When combined with the safe mode setting, can be used to chroot the execution of the program.

*-S, --safe-mode*=_SAFE_MODE_::
  Set safe mode level: _unsafe_, _safe_, _server_, or _secure_.
  Disables potentially dangerous macros in source files, such as `include::[]`.
  If not set, the safe mode level defaults to _unsafe_ when Asciidoctor is invoked using this script.

*--safe*::
  Set safe mode level to _safe_.
  Enables include directives, but prevents access to ancestor paths of source file.
  Provided for compatibility with the asciidoc command.
  If not set, the safe mode level defaults to _unsafe_ when Asciidoctor is invoked using this script.

=== Document Settings

*-a, --attribute*=_ATTRIBUTE_::
  Define, override, or unset a document attribute.
  Command-line attributes take precedence over attributes defined in the source file unless either the name or value ends in _@_.
  No substitutions are applied to the value.
+
_ATTRIBUTE_ is normally formatted as a key-value pair, in the form _NAME=VALUE_.
Alternate forms are _NAME_ (where the _VALUE_ defaults to an empty string), _NAME!_ (unsets the _NAME_ attribute), and _NAME=VALUE@_ (or _NAME@=VALUE_) (where _VALUE_ does not override the _NAME_ attribute if it's already defined in the source document).
A value containing spaces must be enclosed in quotes, in the form _NAME="VALUE WITH SPACES"_.
+
This option may be specified more than once.

*-b, --backend*=_BACKEND_::
  Backend output file format: _html5_, _docbook5_, and _manpage_ are supported out of the box.
  You can also use the backend alias names _html_ (aliased to _html5_) or _docbook_ (aliased to _docbook5_).
  Other values can be passed, but if Asciidoctor cannot resolve the backend to a converter, it will fail.
  Defaults to _html5_.

*-d, --doctype*=_DOCTYPE_::
  Document type: _article_, _book_, _manpage_, or _inline_.
  Sets the root element when using the _docbook_ backend and the style class on the HTML body element when using the _html_ backend.
  The _book_ document type allows multiple level-0 section titles in a single document.
  The _manpage_ document type enables parsing of metadata necessary to produce a man page.
  The _inline_ document type allows the content of a single paragraph to be formatted and returned without wrapping it in a containing element.
  Defaults to _article_.

=== Document Conversion

*-D, --destination-dir*=_DIR_::
  Destination output directory.
  Defaults to the directory containing the source file or, if the source is read from a stream, the working directory.
  If specified, the directory is resolved relative to the working directory.

*-E, --template-engine*=_NAME_::
  Template engine to use for the custom converter templates.
  The gem with the same name as the engine will be loaded automatically.
  This name is also used to build the full path to the custom converter templates.
  If a template engine is not specified, it will be auto-detected based on the file extension of the custom converter templates found.

*-e, --embedded*::
  Output an embeddable document, which excludes the header, the footer, and everything outside the body of the document.
  This option is useful for producing documents that can be inserted into an external template.

*-I, --load-path*=_DIRECTORY_::
  Add the specified directory to the load path, so that _-r_ can load extensions from outside the default Ruby load path.
  This option may be specified more than once.

*-n, --section-numbers*::
  Auto-number section titles.
  Synonym for *--attribute sectnums*.

*-o, --out-file*=_OUT_FILE_::
  Write output to file _OUT_FILE_.
  Defaults to the base name of the input file suffixed with _backend_ extension.
  The file is resolved relative to the working directory.
  If the input is read from standard input or a named pipe (fifo), then the output file defaults to stdout.
  If _OUT_FILE_ is _-_, then the output file is written to standard output.

*-R, --source-dir*=_DIR_::
  Source directory.
  Currently only used if the destination directory is also specified.
  Used to preserve the directory structure of files converted within this directory in the destination directory.
  If specified, the directory is resolved relative to the working directory.

*-r, --require*=_LIBRARY_::
  Require the specified library before executing the processor, using the standard Ruby require.
  This option may be specified more than once.

*-s, --no-header-footer*::
  Output an embeddable document, which excludes the header, the footer, and everything outside the body of the document.
  This option is useful for producing documents that can be inserted into an external template.

*-T, --template-dir*=_DIR_::
  A directory containing custom converter templates that override one or more templates from the built-in set.
  (requires _tilt_ gem)
+
If there is a subfolder that matches the engine name (if specified), that folder is appended to the template directory path.
Similarly, if there is a subfolder in the resulting template directory that matches the name of the backend, that folder is appended to the template directory path.
+
This option may be specified more than once.
Matching templates found in subsequent directories override ones previously discovered.

=== Processing Information

*--failure-level*=_LEVEL_::
  Set the minimum logging level (default: FATAL) that yields a non-zero exit code (i.e., failure).
  If this option is not set, the program exits with a zero exit code even if warnings or errors have been logged.

*-q, --quiet*::
  Silence application log messages and script warnings.

*--trace*::
  Include backtrace information when reporting errors.

*-v, --verbose*::
  Sets log level to DEBUG so application messages logged at INFO or DEBUG level are printed to stderr.

*-w, --warnings*::
  Turn on script warnings (applies to executed code).

*-t, --timings*::
  Print timings report to stderr (time to read, parse, and convert).

=== Program Information

*-h, --help* [_TOPIC_]::
  Print a help message.
  Show the command usage if _TOPIC_ is not specified or recognized.
  Dump the Asciidoctor man page (in troff/groff format) if _TOPIC_ is _manpage_.
  Print an AsciiDoc syntax crib sheet (in AsciiDoc) if _TOPIC_ is _syntax_.

*-V, --version*::
  Print program version number.
+
*-v* can also be used if no source files are specified.
// end::options[]

== Environment

*Asciidoctor* honors the *SOURCE_DATE_EPOCH* environment variable.
If this variable is assigned an integer value, that value is used as the epoch of all input documents and as the local date and time.
See https://reproducible-builds.org/specs/source-date-epoch/ for more information about this environment variable.

== Exit Status

*0*::
  Success.

*1*::
  Failure (syntax or usage error; configuration error; document processing failure; unexpected error).

== Bugs

Refer to the *Asciidoctor* issue tracker at https://github.com/asciidoctor/asciidoctor/issues?q=is%3Aopen.

== Authors

*Asciidoctor* is led and maintained by Dan Allen and Sarah White and has received contributions from many individuals in the Asciidoctor community.
The project was started in 2012 by Ryan Waldron based on a prototype written by Nick Hengeveld for the Git website.
Jason Porter wrote the first implementation of the CLI interface provided by this command.

*AsciiDoc.py* was created by Stuart Rackham and has received contributions from many individuals in the AsciiDoc.py community.

== Resources

*Project website:* https://asciidoctor.org

*Project documentation:* https://docs.asciidoctor.org

*Community chat:* https://chat.asciidoctor.org

*Source repository:* https://github.com/asciidoctor/asciidoctor

*Mailing list archive:* https://discuss.asciidoctor.org

== Copying

Copyright \(C) 2012-present Dan Allen, Sarah White, Ryan Waldron, and the individual contributors to Asciidoctor.
Use of this software is granted under the terms of the MIT License.

// /data/reference/syntax.adoc
[[reference:syntax.adoc]]
= AsciiDoc Syntax
:icons: font
:stem:
:toc: left
:url-docs: https://asciidoctor.org/docs
:url-gem: https://rubygems.org/gems/asciidoctor

A brief reference of the most commonly used AsciiDoc syntax.
You can find the full documentation for the AsciiDoc syntax at {url-docs}.

== Paragraphs

A normal paragraph.
Line breaks are not preserved.
// line comments, which are lines that start with //, are skipped

A blank line separates paragraphs.

[%hardbreaks]
This paragraph is marked with the `hardbreaks` option.
Notice how line breaks are now preserved.

 An indented (literal) paragraph disables text formatting,
 preserves spaces and line breaks, and is displayed in a
 monospaced font.

[sidebar#id.role]
Adding a style, ID, and/or role gives a paragraph (or block) special meaning, like this sidebar.

NOTE: An admonition paragraph, like this note, grabs the reader's attention.

TIP: Convert this document using the `asciidoctor` command to see the output produced from it.

== Text Formatting
:hardbreaks-option:

.Constrained (applied at word boundaries)
*strong importance* (aka bold)
_stress emphasis_ (aka italic)
`monospaced` (aka typewriter text)
"`double`" and '`single`' typographic quotes
+passthrough text+ (substitutions disabled)
`+literal text+` (monospaced with substitutions disabled)
a #mark# to remember (highlighted for notation)

.Unconstrained (applied anywhere)
**C**reate, **R**ead, **U**pdate, and **D**elete (CRUD)
fan__freakin__tastic
``mono``culture
##mark##up your text

.Replacements
A long time ago in a galaxy far, far away...
(C) 1976 Arty Artisan
I believe I shall--no, actually I won't.

.ID and roles for phrases
[.line-through]#delete me#
the [.path]_images_ directory
a [#wibble.term]*wibble* does wobble

.Macros
// where c=specialchars, q=quotes, a=attributes, r=replacements, m=macros, p=post_replacements, etc.
The European icon:flag[role=blue] is blue & contains pass:[************] arranged in a icon:circle-o[role=yellow].
The pass:c[->] operator is often referred to as the stabby lambda.
Since `pass:[++]` has strong priority in AsciiDoc, you can rewrite pass:c,a,r[C++ => C{pp}].
// activate stem support by adding `:stem:` to the document header
stem:[sqrt(4) = 2]

:!hardbreaks-option:
== Attributes

 // define attributes in the document header; must be flush with left margin
 :name: value

You can download and install Asciidoctor {asciidoctor-version} from {url-gem}.
C{pp} is not required, only Ruby.
Use a leading backslash to output a word enclosed in curly braces, like \{name}.

== Links

[%hardbreaks]
https://example.org/page[A webpage]
link:../path/to/file.txt[A local file]
xref:#document.adoc[A sibling document]
mailto:hello@example.org[Email to say hello!]

== Anchors

[[idname,reference text]]
// or written using normal block attributes as `[#idname,reftext=reference text]`
A paragraph (or any block) with an anchor (aka ID) and reftext.

See <<idname>> or <<idname,optional text of internal link>>.

xref:#idname[Jumps to anchor in another document].

This paragraph has a footnote.footnote:[This is the text of the footnote.]

== Lists

=== Unordered

* level 1
** level 2
*** level 3
**** level 4
***** etc.
* back at level 1
+
Attach a block or paragraph to a list item using a list continuation (which you can enclose in an open block).

.Some Authors
[circle]
- Edgar Allan Poe
- Sheri S. Tepper
- Bill Bryson

=== Ordered

. Step 1
. Step 2
.. Step 2a
.. Step 2b
. Step 3

.Remember your Roman numerals?
[upperroman]
. is one
. is two
. is three

=== Checklist

* [x] checked
* [ ] not checked

=== Callout

// enable callout bubbles by adding `:icons: font` to the document header
[,ruby]
----
puts 'Hello, World!' # <1>
----
<1> Prints `Hello, World!` to the console.

=== Description

first term:: description of first term
second term::
description of second term

== Document Structure

=== Header

 // header must be flush with left margin
 = Document Title
 Author Name <author@example.org>
 v1.0, 2019-01-01

=== Sections

 // must be flush with left margin
 = Document Title (Level 0)
 == Level 1
 === Level 2
 ==== Level 3
 ===== Level 4
 ====== Level 5
 == Back at Level 1

=== Includes

 // must be flush with left margin
 include::basics.adoc[]

 // define -a allow-uri-read to allow content to be read from URI
 include::https://example.org/installation.adoc[]

== Blocks

--
open - a general-purpose content wrapper; useful for enclosing content to attach to a list item
--

// recognized types include CAUTION, IMPORTANT, NOTE, TIP, and WARNING
// enable admonition icons by setting `:icons: font` in the document header
[NOTE]
====
admonition - a notice for the reader, ranging in severity from a tip to an alert
====

====
example - a demonstration of the concept being documented
====

.Toggle Me
[%collapsible]
====
collapsible - these details are revealed by clicking the title
====

****
sidebar - auxiliary content that can be read independently of the main content
****

....
literal - an exhibit that features program output
....

----
listing - an exhibit that features program input, source code, or the contents of a file
----

[,language]
----
source - a listing that is embellished with (colorized) syntax highlighting
----

```language
fenced code - a shorthand syntax for the source block
```

[,attribution,citetitle]
____
quote - a quotation or excerpt; attribution with title of source are optional
____

[verse,attribution,citetitle]
____
verse - a literary excerpt, often a poem; attribution with title of source are optional
____

++++
pass - content passed directly to the output document; often raw HTML
++++

// activate stem support by adding `:stem:` to the document header
[stem]
++++
x = y^2
++++

////
comment - content which is not included in the output document
////

== Tables

.Table Attributes
[cols=>1h;2d,width=50%,frame=ends]
|===
| Attribute Name | Values

| options
| header,footer,autowidth

| cols
| colspec[;colspec;...]

| grid
| all \| cols \| rows \| none

| frame
| all \| sides \| ends \| none

| stripes
| all \| even \| odd \| none

| width
| (0%..100%)

| format
| psv {vbar} csv {vbar} dsv
|===

== Multimedia

image::screenshot.png[block image,800,450]

Press image:reload.svg[reload,16,opts=interactive] to reload the page.

video::movie.mp4[width=640,start=60,end=140,options=autoplay]

video::aHjpOzsQ9YI[youtube]

video::300817511[vimeo]

== Breaks

// thematic break (aka horizontal rule)
---

// page break
<<<


// /modules/ROOT/pages/index.adoc
[[ROOT:index.adoc]]
= Asciidoctor Documentation
:navtitle: Introduction
:description: A brief introduction to Asciidoctor, its ecosystem, its relationship to AsciiDoc, and the language platforms on which it runs.

This is the documentation for the Ruby-based AsciiDoc processor named Asciidoctor.
Asciidoctor currently serves as the reference implementation for how to interpret the AsciiDoc language.
If you're looking for the documentation for the AsciiDoc language, see the xref:#asciidoc::index.adoc[AsciiDoc section] of this website.

== What is Asciidoctor?

Asciidoctor is a fast, open source, text processor for parsing AsciiDoc into a document model, then converting it to output formats such as [.nowrap]#HTML 5#, [.nowrap]#DocBook 5#, man(ual) pages, PDF, and [.nowrap]#EPUB 3#.
Asciidoctor is written in the Ruby programming language.

When we use the name "`Asciidoctor`" in this area of the documentation, we're referring to the core Asciidoctor Ruby processor, abbreviated as _Asciidoctor core_ or _Asciidoctor Ruby_.
We add the qualifier "`core`" because Asciidoctor is also the name of the suite of projects that provides runtimes, extensions, and tools for processing AsciiDoc.

To simplify installation, Asciidoctor is packaged as a gem named {url-rubygems}/asciidoctor[asciidoctor^] and published to the gem hosting service located at RubyGems.org.
A https://guides.rubygems.org/what-is-a-gem/[gem^] is a packaged Ruby application or library (in this case, both).
The *asciidoctor* gem can be installed directly from RubyGems.org on all major operating systems using Ruby packaging tools (gem or bundle).
Asciidoctor is also distributed as a Docker image, as a package for numerous Linux distributions, and as a package for macOS (via Homebrew and MacPorts).

Asciidoctor is open source software available under the terms of the MIT license and {url-org}[hosted on GitHub^].

Asciidoctor is the successor to AsciiDoc.py, the legacy Python-based processor for the AsciiDoc language.
If you're using AsciiDoc.py, follow xref:#migrate:asciidoc-py.adoc[] to learn how to upgrade to Asciidoctor.

== Basic usage

Asciidoctor provides two interfaces for processing AsciiDoc documents, a xref:#cli:index.adoc[CLI] named `asciidoctor` and a xref:#api:index.adoc[Ruby API] named `Asciidoctor`.
The following table gives you an idea of how to use these interfaces.

|===
^|CLI ^|API

a|
 $ asciidoctor document.adoc

a|
[,ruby]
----
require 'asciidoctor'
Asciidoctor.convert_file \
  'document.adoc', safe: :safe
----

|See xref:#cli:index.adoc[] to learn more about this interface.
|See xref:#api:index.adoc[] to learn more about this interface.
|===

== Relationship to AsciiDoc

AsciiDoc is the language. +
Asciidoctor is the processor.

You compose documents using the xref:#asciidoc::index.adoc[AsciiDoc language], which is a text-based writing format.
The AsciiDoc language was designed to be unobtrusive and concise to simplify writing and make it more pleasant.
But AsciiDoc itself is not a publishing format.
It's more like a shorthand.
That's where an AsciiDoc processor comes in.

//Asciidoctor reads and parses text written in the AsciiDoc syntax, then feeds the parse tree into a set of built-in templates to produce HTML, PDF, DocBook, man page, and other output formats.
//You have the option of writing your own converter or loading Tilt-supported templates to customize the generated output or produce alternative formats.
//Asciidoctor also offers a responsive theme based on Foundation to style the HTML5 output.

An AsciiDoc processor, such as Asciidoctor, reads the AsciiDoc source and converts it to publishable formats such as HTML 5 or PDF.
It can also convert it to formats which themselves can be processed by a publishing toolchain, such as DocBook.

Since AsciiDoc is not published as is, the processing step provides an opportunity to augment the document by expanding shorthand codes, layering in integrations, and applying a pleasant visual style.
That augmentation is a large part of what Asciidoctor does.

In brief, you give AsciiDoc source to Asciidoctor and it gives you a result you can publish.

== Ecosystem

When we talk about Asciidoctor in this section, we are talking about the core processor and built-in converters.
Asciidoctor also has an ecosystem of extensions, converters, build plugins, and tools to help you author and publish content written in AsciiDoc.
You can find the documentation for these projects elsewhere on this site or in the Asciidoctor organization on GitHub.

== Beyond Ruby

Although Asciidoctor is written in Ruby, it does not mean you need Ruby to use it.
You can also run Asciidoctor using a JVM via AsciidoctorJ or JavaScript via Asciidoctor.js.

=== Java / JVM

Thanks to xref:#asciidoctorj::index.adoc[AsciidoctorJ], Asciidoctor can be used in any program that runs on a Java Virtual Machine (JVM).
Under the covers, AsciidoctorJ uses JRuby to run Asciidoctor, but this is hidden behind a Java API.
AsciidoctorJ even provides an alternate CLI, which means you can get the full Asciidoctor experience with only a Java runtime.
Building atop AsciidoctorJ, there are also plugins that integrate Asciidoctor into Apache Maven, Gradle, or Javadoc builds.

=== JavaScript

Thanks to xref:#asciidoctor.js::index.adoc[Asciidoctor.js], Asciidoctor can also be used in JavaScript.
The Asciidoctor.js project uses Opal to transpile the Ruby source in Asciidoctor to JavaScript.
The result is a fully-functional version of Asciidoctor that works on any JavaScript runtime, such as a modern browser or Node.js.
Asciidoctor.js even provides an alternate CLI, which means you can get the full Asciidoctor experience with only a JavaScript runtime.
Asciidoctor.js is used to power the AsciiDoc language preview extensions for Chrome, Atom, Brackets, and other web-based tooling.

To be accurate, you can run Asciidoctor using Ruby, a JVM, or JavaScript.
This documentation focuses on the Ruby version of Asciidoctor.


// /modules/ROOT/pages/features.adoc
[[ROOT:features.adoc]]
= Features
:description: This page highlights the features of Asciidoctor that make it a great choice for processing and publishing your AsciiDoc content.

{description}

== Readily available with no dependencies

Asciidoctor is written in Ruby, which means it must be run on a Ruby language runtime (including JRuby).
But that's its only requirement.
Asciidoctor is packaged and distributed as a gem named {url-rubygems}/asciidoctor[asciidoctor^] to the package repository at {url-rubygems}[RubyGems.org^].
The gem can be installed on *any operating system* that Ruby supports using Ruby's package management tools (gem or bundle).
Asciidoctor itself has no dependencies.

But what if you aren't familiar with Ruby or, for whatever reason, prefer not to install it?
No problem!
Thanks to xref:#asciidoctorj::index.adoc[AsciidoctorJ] and xref:#asciidoctor.js::index.adoc[Asciidoctor.js], you can run the same exact version of Asciidoctor on a Java Virtual Machine (JVM) or JavaScript runtime, respectively.
That means you don't need a Ruby runtime installed on your machine after all.
AsciidoctorJ uses JRuby internally, whereas Asciidoctor.js relies on a Ruby-like runtime written in JavaScript.

Whether you're working in Ruby, Java, or JavaScript, Asciidoctor is readily available for you to start using.
Only when you get into add-on converters and extensions do you need to install dependencies.

== Quick wins

Asciidoctor provides a nice out-of-the-box xref:#html-backend:index.adoc[HTML experience], complete with a default stylesheet and built-in integrations like Font Awesome (for icons), Highlight.js (for source highlighting), and MathJax (for STEM processing).
When you're just getting into using AsciiDoc for writing, Asciidoctor's HTML output should be sufficient for all of your publishing needs.

The following before and after picture gives you an idea of what to expect:

image::source-vs-output.png[AsciiDoc source vs HTML output]

If you're looking for more advanced output, or you have an existing DocBook toolchain in place, you can instead xref:#docbook-backend:index.adoc[convert to DocBook] and feed the result into that pipeline.
Once you get more familiar with AsciiDoc and Asciidoctor, you can explore customizing the built-in converter using templates or using add-on converters to produce other output formats such as PDF and EPUB 3.
So there is plenty of room to grow.

== Built-in and add-on converters

Asciidoctor provides converters for three output formats by default: xref:#html-backend:index.adoc[HTML 5], xref:#docbook-backend:index.adoc[DocBook 5], and xref:#manpage-backend:index.adoc[man page] (short for manual page).
These converters are designed to cover a majority of users`' needs for basic preview and publishing.

The *HTML* converter provides a result you can publish to the web straight away without any tweaking.
The *DocBook* converter allows you to leverage an existing publishing toolchain or migrate the content to a different authoring format (without the tool needing to know how to parse AsciiDoc).
The *man page* converter drastically lowers the barrier to making system help files.

But it doesn't end there.
The converter interface in Asciidoctor is an extension point.
That means it can be used to create converters for any output format imaginable.
And there's an ecosystem of additional converters already available in the Asciidoctor project.
You can find converters for creating *PDF*, *EPUB 3*, *Reveal.js slides*, and more from AsciiDoc.
Asciidoctor also provides advanced docinfo support for injecting colophon (such as content scripts) into the header and footer of the output file.

A single input format, AsciiDoc, gains you a plethora of output formats.

== Custom converter or templates

While Asciidoctor provides a built-in converter for producing publish-ready HTML, *all the HTML that Asciidoctor generates can be changed.*
There are two ways to modify the HTML that Asciidoctor produces: a custom converter or converter templates.

If you're an experienced programmer, you may lean towards the *custom converter*.
You can extend the built-in HTML converter and override the methods that handle the conversion for any node in the document tree.

If your expertise is more on the technical writing side, you may find the *converter templates* to be more approachable.
The templates can be written in any template language supported by the Tilt template abstraction library, such as ERB, Haml, or Slim.
These templates augment the built-in converter by replacing the processing for a node in the document.
You introduce one template for each type of node for which you want to control conversion.
Templates allow you to apply logic around chunks of HTML (or HTML-like) markup.

Just know that if the HTML that Asciidoctor produces isn't working for you, you can change it.

== Syntax highlighting

If you're writing technical documentation that presents snippets of source code or configuration, you can enhance the display of those source blocks using syntax highlighting (aka source highlighting).
Syntax highlighting is the practice of colorizing (or otherwise emphasizing) keywords and syntax elements in a structured programming or configuration language.
Here's an example to give you an idea:

[,ruby]
----
phrase = "I love AsciiDoc"
puts phrase

# now say it like you mean it
5.times { puts %(#{phrase}!) }
----

Asciidoctor provides adapters for several popular syntax highlighters, including Rouge and Highlight.js.
Aside from installing the library (if necessary), all you need to do is set a document attribute on your document and Asciidoctor will handle the rest.
From there, you can configure the behavior of the syntax highlighter, such as changing the style/theme, enabling line numbers, and block highlighting select lines.

== Multiple interfaces: CLI and API

Asciidoctor offers two interfaces for processing AsciiDoc content: a commandline interface (CLI) and an application programming interface (API).

The *CLI* is designed as a simple tool for non-programmers who want to convert AsciiDoc without having to write a program or for converting content in an automated environment such as CI.
Many of the processing options are accessible from the CLI using option flags.
When you're first starting out with Asciidoctor, you'll most likely interact with it via the CLI.
Although the CLI itself does not require any programming, it can still load extension code that augments processing.

NOTE: If you're migrating from AsciiDoc.py, the `asciidoctor` CLI is a drop-in replacement for the `asciidoc` CLI.

The *API* is designed for programmers who want to take their AsciiDoc processing further.
Like with the CLI, you can use the API to convert documents.
But it's not all about conversion to an output format.
//Alternately, you can load the document just to inspect its contents.
Asciidoctor parses and converts the source document in discrete steps.
This makes conversion optional and gives programs the opportunity to extract, add, or replace content in the document by interacting with the document object model.
//Developers can use the full power of the Ruby programming language to play with the content in the document.
Or you may want to leverage the ability to convert to an embedded document for integrating with other applications, such as a static site generator.
The API also provides an extension SPI that you can use to augment the processor, such as to introduce new syntax, mutate the parsed document before conversion, or tweak the output after conversion.

TIP: The API is written in Ruby, but also accessible from JVM languages or JavaScript when using AsciidoctorJ or Asciidoctor.js, respectively.

Both the CLI and API have the ability to process both AsciiDoc files and AsciiDoc source passed in as a string.

== Impressive performance and strong security

No coverage of Asciidoctor would be complete without mention of its speed.
Asciidoctor is about as fast as any program that runs in Ruby can be.
It can load, parse, and convert a 100K AsciiDoc document in about a tenth of a second (~ 1MB/s).
That's more than 100x as fast as AsciiDoc.py, the original AsciiDoc implementation.

Asciidoctor's speed is good news for developer productivity and good news for server-side applications that need to convert AsciiDoc markup.
It also means that preview tools like the browser extension can present a preview of the AsciiDoc content in HTML in near real time.

Asciidoctor also has the ability to run securely by offering several xref:#safe-modes.adoc[security (aka safe) modes].
By using one of these safe modes, you don't have to worry about the processor accessing sensitive files or even the file system in highly secure environments.
In addition to its performance, these security levels make Asciidoctor well-suited for server-side deployments.

== Access to an ecosystem of extensions and tools

Installing Asciidoctor is just the beginning of your publishing experience.
Asciidoctor gives you access to a {url-org}[healthy ecosystem of extensions and tools^], ranging from add-on converters, to extended syntax, to build plugins, to integrated writing and preview environments.

One popular extension is xref:#diagram-extension::index.adoc[Asciidoctor Diagram].
When loaded, Asciidoctor Diagram allows you to make diagrams from plain text (much like AsciiDoc does for writing).
Asciidoctor Diagram does this by extending the syntax of AsciiDoc to recognize specially marked literal blocks.
It takes the text inside those blocks, passes it through one of the diagramming tools it integrates with, and reinserts the image back into the document as it is being processed.
The result is that the diagram source in the AsciiDoc document becomes an image in the generated output.

Another popular tool is the {url-org}/asciidoctor-browser-extension[browser extension^].
When this extension is installed, you can browse to an AsciiDoc file on your local storage or on the web and the browser will show you the converted HTML *instead of* the AsciiDoc source.
That means you can get the out-of-the-box HTML experience that Asciidoctor provides without even having to run a command or script.
The extension running in the browser does everything for you.

These are just two examples.
There are plenty more possibilities to explore in the ever-growing Asciidoctor ecosystem.
All the components of this ecosystem work together to achieve one goal, to make writing in AsciiDoc a rewarding and productive experience.

// /modules/ROOT/pages/whats-new.adoc
[[ROOT:whats-new.adoc]]
= What's New in {page-component-version}
:doctype: book
:description: The new features, improvements, and bug fixes made in each patch release of the Asciidoctor {page-component-version} release line.
:page-toclevels: 0
:url-releases-asciidoctor: {url-org}/asciidoctor/releases
:url-milestone: {url-org}/asciidoctor/milestone/33?closed=1

{description}
The releases are ordered from newest to oldest.

_**Cumulative issues resolved:** {url-milestone}[2.0.x^]_

== Asciidoctor 2.0.20

_**Release date:** 2023.05.18_

=== Bug Fixes

* Update `release-version` attribute in READMEs and man page during release
* Rebuild man page during release

== Asciidoctor 2.0.19

_**Release date:** 2023.05.17_

=== Improvements

* Return empty string instead of nil if raw or verbatim block has no lines
* Don't uppercase monospace span in section title in manpage output (#4402)
* Simplify processing of implicit link (i.e., autolink) by separating implicit and explicit match
* Generate partintro block consistently (#4450)
* Add Kiswahili translation for built-in labels (PR #4454) (*@bkmgit*)

=== Compliance

* Fix call order so use of an include file with invalid encoding continues to raise error when using Ruby >= 3.2.0
* Fix test assertion for fallback Rouge stylesheet to be compatible with Rouge 4.1 (#4406) (*@tmzullinger*)
* Support `notitle` option on section as alternative to `untitled` to hide title (#4437)
* Add support for Haml 6 to template converter (#4429)

=== Bug Fixes

* Process constrained inline passthrough inside monospace span (#4458)
* Catalog inline ref defined using anchor macro even when resolved reftext is empty
* Use while loop rather than recursion to locate next line to process; prevents stack limit error (#4368)
* Avoid matching numeric character references when searching for # in xref target (#4393)
* Use correct selector to collapse margin on first and last child of sidebar
* Don't allow target of include directive to start with a space (to distinguish it from a dlist item) or to end with a space
* Manify alt text of block image in manpage output (#4401)
* Adjust font size of term in horizontal dlist to match font size of term in regular dlist
* Implicitly attach nested list that starts with block attribute lines to dlist entry (#4268)
* Don't swallow square brackets when processing escaped URL macro
* Treat `uri:classloader:` as an absolute path prefix when running on JRuby (#3929)
* Apply reftext substitutions to value of `mantitle` attribute in DocBook output (#4448)
* Enclose `<reftext>` tag in `<article>` tag in DocBook output for man page (#4452)
* Correctly handle compat role on monospace and constrained passthrough when box attrlist or formatted text is escaped

=== Build / Infrastructure

* Update latest CRuby in CI workflow to 3.2
* Update latest JRuby in CI workflow to 9.4.2.0

== Asciidoctor 2.0.18

_**Release date:** 2022.10.15_

=== Bug Fixes

* Change internal `uriish?` helper to only detect a URI pattern at start of a string; avoids misleading messages (#4357)
* Prevent highlight.js warning when no language is set on source block; don't call `highlightBlock` if `data-lang` attribute is absent (#4263)
* Don't raise error if `Asciidoctor::Extensions.unregister` is called before groups are initialized (#4270)
* If path is included both partially and fully, store it with true value (included fully) in includes table of document catalog
* Reset registry if activate is called on it again (#4256)
* Format source location in exception message when extension code is malformed
* Fix lineno on reader when `skip-front-matter` attribute is set but end of front matter is not found
* Fix `Asciidoctor::Cli::Invoker` constructor when first argument is a hash
* Update default stylesheet to honor marker on unordered list when marker is defined on ancestor unordered list (#4361)

=== Improvements

* Propagate `:to_dir` option to document of AsciiDoc table cell (#4297)
* Force encoding of attribute data passed via CLI to UTF-8 if transcoding fails (#4351) (*@zkaip*)

== Asciidoctor 2.0.17

_**Release date:** 2022.01.05_

=== Bug Fixes

* Don't crash if process method for custom block returns an abstract block with context :compound that isn't of type Block (e.g., a list)
* Ignore return value of process method for custom block or block macro if value matches parent argument
* Remove unnamespaced selectors in Pygments stylesheet
* Normalize output from Pygments to use `linenos` class for inline line numbering and trim space after number; update default stylesheet accordingly
* Change `AbstractBlock#sections?` to return false when called on block that isn't a Section or Document (PR #3591) (*@Mogztter*)
* Hide built-in marker on HTML summary element in Safari when using default stylesheet (#4162)
* Hide outline around HTML summary when activated in Safari (#4162)
* Include primary video in value of playlist attribute when embedding YouTube video (#4156)
* Honor `stripes=none` on nested table (#4165)
* Update default stylesheet to fix spacing around empty list item (#4184)
* Honor `:header_only` option when parsing document with manpage doctype (#4192)
* Use numeric character reference for closing square bracket around alt text of icon
* Process `author` or `authors` document attribute in document header when implicit doctitle is absent (#4206)
* Patch open-uri-cached gem to work with Ruby 3.1 (update: drop patch now that open-uri-cached has been fixed) (#4227)

=== Improvements

* Prevent line numbers on source blocks in HTML output from being selected (applies to pygments and coderay) (#4128)
* Allow hash to be specified for Vimeo video either in video ID or using hash attribute (#4176)
* Remove unnecessary specificity in default stylesheet for styling p element inside list item
* Remove obsolete gist embed styles from default stylesheet
* Allow `--failure-level` to be set to default value, `FATAL`
* Sort levels in help for `--failure-level` option in ascending order
* Invert FR translations for caution & warning admonition labels (#4212) (*@cyChop*)
* Add tests for open-uri-cached integration that's activated by the `cache-uri` attribute
* Don't warn if negated tag is not found in include file (#4230)

=== Build / Infrastructure

* Add Ruby 3.1 to CI matrix

== Asciidoctor 2.0.16

_**Release date:** 2021.08.03_

=== Bug Fixes

* Include all lines outside of specified tagged region when tag filter on include directive is a single negated tag (#4048)
* Only interpret negated wildcard in tag filter on include directive as implicit globstar if it precedes other tags (#4086)
* Change `ifeval` directive to resolve to false if comparison operation cannot be performed (#4046)
* Don't crash if `:to_file` option is passed to `load` or `load_file` and value is not a string (#4055)
* Use automatic link text if ID in shorthand xref is followed by dangling comma (e.g., `+<<idname,>>+`)
* Update default stylesheet to indent blocks attached to list item in checklist (#2550)
* Update default stylesheet to re-enable styling of implicit lead role on first paragraph of preamble inside AsciiDoc table cell
* Update default stylesheet to fix conflict between text decoration and bottom border on abbr[title] element
* Change invalid font family "sans" in default stylesheet to "sans-serif"
* Fix missing automatic reftext for internal xrefs in manpage output (#4110)
* Replace numeric character reference for plus in manpage output (#4059)
* Replace numeric character reference for degree sign in manpage output (#4059)
* Convert apostrophe to the portable `+\*(Aq+` variable instead of the groff-specific escape `\(aq` (#4060) (*@felipec*)
* Document the `-e, --embedded` option flag in the man page, which replaces the outdated `-e, --eruby` option flag

=== Improvements

* Use queue to iterate over lines in reader instead of stack (#4106)
* Uppercase automatic reftext for level-2 section titles in manpage output if reftext matches section title (#4110)
* Show safe modes in strictness order in CLI help (#4065)
* Remove redundant styles from the default stylesheet
* Update font styles for summary element in default stylesheet to match font styles of paragraph (#4114)
* Update default stylesheet to indent content of details element (#4116)
* Update default stylesheet to use custom marker for summary element to make appearance consistent (#4116)
* Add Vietnamese translation of built-in attributes (PR #4066) (*@nguyenhoa93*)
* Add Thai translation of built-in attributes (PR #4113) (*@ammaneena*)

=== Build / Infrastructure

* Import source of default stylesheet into this repository; use PostCSS with cssnano to minify (#4062)
* Use autoprefixer to manage browser prefixes in default stylesheet (#4118)

== Asciidoctor 2.0.15

_**Release date:** 2021.04.27_

=== Bug Fixes

* Don't include trailing period, question mark, or exclamation point in target (URL) of autolink (#3860)
* Don't assign nil value to named attribute mapped to absent positional attribute when parsing attrlist (#4033)
* Remove leading and trailing spaces around role on inline phrase (#4035)
* Ignore empty role on inline phrase defined using legacy syntax and followed by comma (#4035)
* Use xreftext on document as fallback link text in HTML output for inter-document xref that resolves to current document when no link text is provided (#4032)
* Use xreftext on document as fallback link text in HTML output for internal xref with empty fragment when no link text is provided (#4032)
* Use document ID as linkend in DocBook output for internal xref with empty fragment; auto-generating one if necessary (#4032)

=== Improvements

* Format keyboard references in monospace in man page output

=== Build and infrastructure

* Get remaining invoker tests working on JRuby 9.1 for Windows

== Asciidoctor 2.0.14

_**Release date:** 2021.04.19_

=== Bug fixes

* Don't allow AsciiDoc table cell to set document attribute that was unset from the API (exceptions include: compat-mode, toc, showtitle, and notitle) (#4017)
* Ensure default document attributes unset in parent document remain unset in AsciiDoc table cell (#2586)
* Allow `showtitle` and `notitle` to be toggled in AsciiDoc table cell if set in parent document (#4018)
* Ensure mtime of input file honors TZ environment variable on JRuby for Windows (affects value of `docdatetime` attribute) (#3550)
* Honor caption attribute on blocks that support captioned title even if corresponding `*-caption` document attribute (e.g., `example-caption`) is unset (#4023)
* Suppress missing attribute warning when applying substitutions to implicit document title for assignment to intrinsic `doctitle` attribute (#4024)
+
If you want to use an attribute reference in the document title (i.e., level-0 section title), and you also need to reference the `doctitle` attribute somewhere in the document, then any attributes you reference in the document title must be defined before that line (aka follow document order, just like any other attribute entry).
Otherwise, they will remain unresolved in the value of the `doctitle` attribute (though they will still work in the document title itself).

=== Improvements

* Use attribute, if set, as seed value for counter even if not already registered as a counter (#4014)
* Allow subs attribute value on Inline node returned by process method for custom inline macro to be a String (#3938)
* Allow value of `user-home` attribute to be overridden by API or CLI (#3732)

=== Build and infrastructure

* Run tests on JRuby for Windows (#3550)

== Asciidoctor 2.0.13

_**Release date:** 2021.04.10_

=== Bug fixes

* Rollback change for #3470, which added logic to remove leading and trailing empty lines in an AsciiDoc include file; instead skip empty lines before processing document header (#3997)
* Don't allow `counter` and `counter2` attribute directives to override locked attributes (#3939) (*@mogztter*)
* Fix crash when resolving next value in sequence for counter with non-numeric value (#3940)
* Honor list of tags following negated wildcard on include directive (#3932)
* Update default stylesheet to remove the dash in front of cite on nested quote block (#3847)
* Don't mangle formatting macros when uppercasing section titles in man page output (#3892)
* Don't escape hyphen in `manname` in man page output
* Remove extra `.sp` line before content of verse block in man page output
* Fix layout of footnotes in man page output (#3989)
* Fix formatting of footnote text with URL in man page output (#3988)
* Remove redundant trailing space on URL followed by non-adjacent text in man page output (#4004)
* Use `.bp` macro at location of page break in man page output (#3992)

=== Improvements

* Extract method to create lexer and formatter in Rouge adapter (#3953) (*@Oblomov*)
* Add support for pygments.rb 2.x (#3969) (*@slonopotamus*)
* Allow `NullLogger` to be enabled by setting the `:logger` option to a falsy value (#3982)
* Substitute attributes in manpurpose part of NAME section in man page doctype (#4000)
* Output all mannames in name section of HTML output for man page doctype (#3757)

=== Build and infrastructure

* Enable running tests as root (PR #3874) (*@mikemckiernan*)
* Import documentation for processor into Asciidoctor core repository (#3861) (*@graphitefriction*)
* Speed up CI by using Bundler cache (PR #3901) (*@slonopotamus*)
* Run tests against both pygments.rb 1.x and 2.x (#3969) (*@slonopotamus*)

=== Documentation

* Multiple copyedits and typo fixes (PR #3858)(PR #3912)(PR #3913) (*@mogztter*)
* Improve Dutch translation by removing diacritic from first letter of `toc-title` and adding translations for `part` and `section` (PR #3895) (*@jdevreese*)
* Update _attributes-it.adoc_ (PR #3886) (*@ciampix*)
* Correct extension registry errors in _options.adoc_ (PR #3902) (*@djencks*)
* Minor improvements to docs features page (PR #3917) (*@Younes-L*)
* Add Belarusian translation of built-in attributes (PR #3928) (*@morganov*)
* Document the `header_only` option (PR #3934) (*@mogztter*)
* Add a pandoc command using docker and update command on MS Word migration page (PR #3956) (*@dacog*)
* Apply minor typo and flow change to default stylesheet docs (PR #3977) (*@chrisperrault*)
* Update instructions for Migrating from Confluence XHTML (#3994) (*@juliojgd*)

== Asciidoctor 2.0.12

_**Release date:** 2020.11.10_

=== Bug Fixes

* Set `type` and `target` property on unresolved footnote reference and unset `id` property (fixes regression) (#3825)
* Fix crash when inlining an SVG if the explicit width or height value on the image node is not a string (#3829)
* Reset word wrap behavior to normal on tables, then re-enable again for admonition content, horizontal dlist description, and AsciiDoc table cells (#3833)

=== Improvements

* Pass through role to DocBook output for inline image (#3832)

=== Compliance

* Defer use of Ruby >= 2.3 constructs to restore compatibility with Ruby 2.0 until at least next minor release (#3827)
* Don't append the default px unit identifier to the explicit width or height value when inlining an SVG (#3829)

=== Build and infrastructure

* Migrate Linux CI jobs to GitHub Actions (#3837)
* Migrate Windows CI jobs to GitHub Actions (#3839)
* Run CI job on macOS (#3842)

== Asciidoctor 2.0.11

_**Release date:** 2020.11.02_

=== Bug fixes

* Fix infinite loop when callout list with obsolete syntax is found inside list item (#3472)
* Fix infinite loop when xreftext contains a circular reference path in HTML and man page converters (#3543)
* Apply text formatting to table cells in implicit header row when column has the `a` or `l` style (#3760)
* Fix errant reference warning for valid reference when running in compat mode (#3555)
* Initialize backend traits for converter (if not previously initialized) using assigned basebackend; mimics Asciidoctor < 2 behavior (#3341)
* Set `source_location` on preamble block when `sourcemap` option is enabled (#3799)
* Link the `notitle` and `showtitle` attributes so they act as opposites for the same toggle (#3804)
* Pass options to constructor of Rouge lexer instead of `#lex` method; restores compatibility with Rouge >= 3.4 (#3336)
* Don't clobber `cgi-style` options on language when enabling `start_inline` option on the Rouge PHP lexer (#3336)
* Fix parsing of wrapped link and xref text, including when an attrlist signature is detected (#3331)
* Restore deprecated writable number property on `AbstractBlock`
* Always use title as xreftext if target block has an empty caption, regardless of `xrefstyle` value (#3745)
* Allow a bibliography reference to be used inside a footnote (#3325)
* Fix bottom margin collapsing on AsciiDoc table cell (#3370)
* Remove excess hard line break in multi-line AsciiMath blocks (#3407)
* Only strip trailing spaces from lines of AsciiDoc include file (#3436)
* Remove errant optional flag in regexp for menu macro that breaks Asciidoctor.js (#3433)
* Preserve repeating backslashes when generating man page output (#3456)
* Honor percentage width specified on macro of inline SVG (#3464)
* Removing leading and trailing blank lines in AsciiDoc include file to match assumption of parser (#3470)
* Activate extensions when `:extensions` option is set, even if Extensions API is not yet loaded (#3570)
* Don't activate global extensions if `:extensions` option is `false` (#3570)
* Escape ellipsis at start of line in man page output (#3645) (*@jnavila*)
* Don't register footnote with ID if a footnote is already registered with that ID (#3690)
* Honor `start` attribute on ordered list in man page output (#3714)
* Warn instead of crashing if SVG to inline is empty (#3638) (*@mogztter*)
* Compute highlight line ranges on source block relative to value of `start` attribute (#3519) (*@mogztter*)
* Prevent collapsible block from incrementing example number by assigning an empty caption (#3639)
* Use custom init function for highlight.js to select the correct `code` elements (#3761)
* Fix resolved value of `:to_dir` when both `:to_file` and `:to_dir` options are set to absolute paths (#3778)
* Fix crash if value of `stylesheets` attribute contains a folder and the destination directory for the stylesheet does not exist (even when the `:mkdirs` option is set) (#3808)
* Fix crash if value passed by API for `copycss` attribute is not a string (#3592)
* Restore label in front of each bibliography entry in DocBook output that was dropped by fix for #3085 (#3782)
* Apply max width to each top-level container instead of body in HTML output (#3513)
* Don't apply `border-collapse:` separate to HTML for table blocks; fixes double border at boundary of `colspan` and `rowspan` (#3793) (*@ahus1*)
* Don't remove right border on last table cell in row (#2563)
* Rework table borders to leverage border collapsing (apply frame border to table, grid border to cells, and selectively override border on cells to accommodate frame) (#3387)

=== Compliance

* Add support for `muted` option to self-hosted video (#3408)
* Move `<style>` element for convert-time syntax highlighters (coderay, rouge, pygments) into head (#3462)
* Move `<style>` element for client-side syntax highlighters (highlight.js, prettify) into head (#3503)
* Define entry point API methods (`load`, `convert`, `load_file`, `convert_file`) as class methods instead of `module_function` to avoid conflict with `Kernel.load` (#3625)
* Retain attribute order on HTML `code` element for source block to remain consistent with output from Asciidoctor 1.5.x (#3786)
* Correct language code for Korean language file from `kr` to `ko` (#3807) (*@jnavila*)

=== Improvements

* Apply word wrap (i.e., `word-wrap: anywhere`) to body in default stylesheet (#3544)
* Allow `nobreak` and `nowrap` roles to be used on any inline element (#3544)
* Add CSS class to support `pre-wrap` role to preserve leading, trailing, and repeating spaces in phrase (#3815)
* Preserve guard around XML-style callout when icons are not enabled (#3319)
* Use `.fam C` command to switch font family for verbatim blocks to monospaced text in man page output (#3561)
* Remove redundant test for `halign` and `valign` attributes on table cell in DocBook converter
* Allow encoding of include file to be specified using `encoding` attribute (#3248)
* Allow template to be used to override outline by only specifying the outline template (#3491)
* Upgrade MathJax from 2.7.5 to 2.7.9
* Upgrade highlight.js from 9.15.10 to 9.18.3 (note that this increases script size from 48.8 KB to 71.5 KB)
* Skip unused default attribute assignments for embedded document
* Allow a URL macro to have a preceding single or double quote (#3376)
* Add support for erubi template engine; use it in place of erubis in test suite; note the use of erubis is deprecated (#3737)
* Download and embed remote custom stylesheet if `allow-uri-read` is set (#3765)
* Remove direction property from default stylesheet (#3753) (*@abdnh*)
* remove max width setting on content column for print media in default stylesheet (#3802)
* Normalize frame value `topbot` to "ends" in HTML output (consistently use `frame-ends` class) (#3797)
* Add role setter method on `AbstractNode` (#3614)
* Map `chapter-signifier` and `part-signifier` attributes in locale attribute files to replace `chapter-label` and `part-label` (#3817)

=== Build and infrastructure

* Run test suite on TruffleRuby nightly (*@mogztter*, *@erebor*)
* Upgrade TruffleRuby to 20.0.0 (*@mogztter*)
* Trigger upstream builds for AsciidoctorJ on GitHub Actions (*@robertpanzer*)

== Asciidoctor 2.0.10

_**Release date:** 2019.05.31_

=== Bug fixes

* Fix Asciidoctor.convert_file to honor `header_footer: false` option when writing to file (#3316)
* Fix placement of title on excerpt block (#3289)
* Always pass same options to `SyntaxHighlighter#docinfo`, regardless of value of location argument
* Fix signature of `SyntaxHighlighter#docinfo` method (#3300)
* When `icons` is set to `image`, enable image icons, but don't use it as the value of the `icontype` attribute (#3308)

== Asciidoctor 2.0.9

_**Release date:** 2019.04.30_

=== Bug fixes

* Process multiple single-item menu macros in same line (#3279)
* Register images in catalog correctly (#3283)
* Rename `AbstractNode#options` method to `AbstractNode#enabled_options` so it doesn't get shadowed by `Document#options` (#3282)
* Don't fail to convert document if `alt` attribute is not set on block or inline image (typically by an extension)
* Fix lineno of source location on blocks that follow a detached list continuation (#3281)
* Assume inline image type is image if not set (typically by an extension)

== Asciidoctor 2.0.8

_**Release date:** 2019.04.22_

=== Bug fixes

* Restore background color applied to literal blocks by default stylesheet (#3258)
* Use portability constants (`CC_ALL`, `CC_ANY`) in regular expressions defined in built-in converters (DocBook5 and ManPage)
* Use portability constant (`CC_ANY`) in regular expression for custom inline macros
* Use smarter margin collapsing for AsciiDoc table cell content; prevent passthrough content from being cut off (#3256)
* Don't limit footnote ref to ASCII charset; allow any word character in Unicode to be used (#3269)

=== Improvements

* `register_for` methods accept arguments as symbols (#3274)
* Use `Concurrent::Map` instead of `Concurrent::Hash` in template converter
* Use `module_function` keyword to define methods in Helpers
* Move regular expression definitions to separate source file (internal change)

== Asciidoctor 2.0.7

_**Release date:** 2019.04.13_

=== Bug fixes

* Fix crash when resolving ID from text and at least one candidate contains an unresolved xref (#3254)
* Fix compatibility with Rouge 2.0

=== Improvements

* Improve documentation for the `-a` CLI option; explain that `@` modifier can be placed at end of name as alternative to end of value
* Move source for main API entry points (`load`, `load_file`, `convert`, `convert_file`) to separate files (internal change)
* Define main API entry points (`load`, `load_file`, `convert`, `convert_file`) as module functions

== Asciidoctor 2.0.6

_**Release date:** 2019.04.04_

=== Bug fixes

* Assume implicit AsciiDoc extension on inter-document xref macro target with no extension (e.g., `document#`); restores Asciidoctor 1.5.x behavior (#3231)
* Don't fail to load application if call to `Dir.home` fails; use a rescue with fallback values (#3238)
* `Helpers.rootname` should only consider final path segment when dropping file extension

=== Improvements

* Implement `Helpers.extname` as a more efficient and flexible `File.extname` method
* Check for AsciiDoc file extension using `end_with?` instead of resolving the extname and using a lookup

== Asciidoctor 2.0.5

_**Release date:** 2019.04.01_

=== Bug fixes

* Fix crash when source highlighter is Rouge and source language is not set on block (#3223)
* Update CLI and `SyntaxHighlighter` to allow Asciidoctor to load cleanly on Ruby 2.0 - 2.2
* CLI should use `$stdin` instead of `STDIN` to be consistent with the use of `$stdout`
* Mark encoding of `stdio` objects used in CLI as UTF-8 (#3225)
* Make `Asciidoctor::SyntaxHighlighter::Config.register_for` method public as documented

== Asciidoctor 2.0.4

_**Release date:** 2019.03.31_

=== Bug fixes

* Allow Asciidoctor to load cleanly on Ruby 2.0 - 2.2 for distributions that provide support for these older Ruby versions
* Make `Asciidoctor::Converter::Config.register_for` method public as documented
* Remove unused `Asciidoctor::Converter::BackendTraits#derive_backend_traits` private method
* Move `Asciidoctor::Converter::BackendTraits.derive_backend_traits` method to `Asciidoctor::Converter`
* Mark `render` and `render_file` methods as deprecated in API docs

== Asciidoctor 2.0.3

_**Release date:** 2019.03.28_

=== Bug fixes

* Fix crash when attribute list is used on literal monospace phrase (#3216)
* Update use of magic regexp variables to fix compatibility with Opal / Asciidoctor.js (#3214)

== Asciidoctor 2.0.2

_**Release date:** 2019.03.26_

=== Bug fixes

* Apply verbatim substitutions to literal paragraphs attached to list item (#3205)
* Implement `#lines` and `#source` methods on `Table::Cell` based on cell text (#3207)

== Asciidoctor 2.0.1

_**Release date:** 2019.03.25_

=== Bug fixes

* Convert titles of cataloged block and section nodes containing attribute references eagerly to resolve attributes while in scope (#3202)
* Customize MathJax (using a `postfilter` hook) to apply `displaymath` formatting to AsciiMath block (#2498)
* Fix misspelling of deprecated `default_attrs` DSL function (missing trailing "s")
* Remove unused location property (`attr_accessor :location`) on `DocinfoProcessor` class
* Look for deprecated extension option `:pos_attrs` if `:positional_attrs` option is missing (#3199)
* Add detail to load error message if path differs from gem name (#1884)

=== Build and infrastructure

* Bundle .yardopts in RubyGem (#3193)

== Asciidoctor 2.0.0

_**Release date:** 2019.03.22_

=== Enhancements and compliance

* Drop support for Ruby < 2.3 and JRuby < 9.1 and remove workarounds (#2764)
* Drop support for Slim < 3 (#2998)
* Drop the converter for the `docbook45` backend from core; moved to https://github.com/asciidoctor/asciidoctor-docbook45 (#3005)
* Apply substitutions to section and block titles in `normal` substitution order (#1173)
* Make syntax highlighter pluggable; extract all logic into adapter classes (#2106)
* Add syntax highlighter adapter for Rouge (#1040)
* Redesign Converter API based on SyntaxHighlighter API; remap deprecated API to new API to ensure compatibility (#2891)
* Repurpose built-in converters as regular converters (#2891)
* Make registration and resolution of global converters thread-safe (#2891)
* Fold the default converter factory into the Converter module (#2891)
* Add a default implementation for `Converter#convert` in the Base converter (#2891)
* Rename `Converter::BackendInfo` to `Converter::BackendTraits`; map `backend_info` to new `backend_traits` method (#2891)
* Allow built-in converter classes to be resolved using `Converter.for` and instantiated using `Converter.create` (#2891)
* Allow converter factory to be passed using `:converter_factory` API option (#2891)
* Honor `htmlsyntax` if defined on converter (#2891)
* Add `backend_traits_source` keyword argument to `CompositeConverter` constructor (#2891)
* Add support for `start` attribute when using prettify to highlight source blocks with line numbering enabled
* Use `String#encode` to encode String as UTF-8 instead of using `String#force_encoding` (#2764)
* Add `FILE_READ_MODE`, `URI_READ_MODE`, and `FILE_WRITE_MODE` constants to control open mode when reading files and URIs and writing files (#2764)
* Set visibility of private and protected methods (#2764)
* Always run docinfo processor extensions regardless of safe mode (gives control to extension) (#2966)
* Use infinitive verb form for extension DSL method names; map deprecated method names where appropriate
* Add docinfo insertion slot for header location to built-in converters (#1720)
* Add support for the `muted` option on Vimeo videos (allows `autoplay` to work in Chrome) (#3014)
* Use value of `prettify-theme` attribute as is if it starts with http:// or https:// (#3020)
* Allow `icontype` to be set using `icons` attribute (#2953)
* When using a server-side syntax highlighter, highlight content of source block even if source language is not set (#3027)
* Automatically promote a listing block without an explicit style to a source block if `source-language` is set (#1117)
* Remove the 2-character (i.e., `""`) quote block syntax
* Don't allow block role to inherit from document attribute; only look for role in block attributes (#1944)
* Split out functionality of `-w` CLI flag (script warnings) from `-v` CLI flag (verbose logging) (#3030)
* Log possible invalid references at info level (#3030)
* Log dropped lines at info level when `attribute-missing=drop-line` (#2861)
* Honor `attribute-missing` setting when processing include directives and block macros (#2855)
* Log warning when include directive is not resolved due to missing attribute or blank target; always include warning in output document (#2868)
* Use the third argument of `AbstractNode#attr` / `AbstractNode#attr?` to set the name of a fallback attribute to look for on the document (#1934)
* Change default value of third argument to `Abstractnode#attr` / `AbstractNode#attr?` to `nil` so attribute doesn't inherit by default (#3059)
* Look for `table-frame`, `table-grid`, and `table-stripes` attributes on document as fallback for `frame`, `grid`, and `stripes` attributes on table (#3059)
* Add support for hover mode for table stripes (`stripes=hover`) (#3110)
* Always assume the target of a shorthand inter-document xref is a reference to an AsciiDoc document (source-to-source) (#3021)
* If the target of a formal xref macro has a file extension, assume it's a path reference (#3021)
* Never assume target of a formal xref macro is a path reference unless a file extension or fragment is present (#3021)
* Encode characters in URI to comply with RFC-3986
* Implement full support for styled xreftext in man page converter (#3077)
* Allow the `id` and `role` properties to be set on a list item of ordered and unordered lists via the API (#2840)
* Yield processor instance to registration block for document processor if block has non-zero arity (i.e., has parameters)
* Add `Document#parsed?` method to check whether document has been parsed
* Modify `Cell` class to extend from `AbstractBlock` instead of `AbstractNode` (#2963)
* Implement `block?` and `inline?` methods on `Column`, both which return `false` (#2963)
* Drop `verse` table cell style (treat as normal table cell) (#3111)
* Allow negated `subs` to be specified on inline pass macro (#2191)
* Log warning if `footnoteref` macro is found and compat mode is not enabled (#3114)
* Log info message if inline macro processor returns a String value (#3176)
* Apply `subs` to `Inline` node returned by inline macro processor if `subs` attribute is specified (#3178)
* Add `create_inline_pass` helper method to base extension processor class (#3178)
* Log debug message instead of warning if block style is unknown (#3092)
* Allow backend to delegate to a registered backend using the syntax `synthetic:delegate` when using custom templates (e.g., `slides:html`) (#891)
* `AbstractBlock#find_by` looks inside AsciiDoc table cells if `traverse_documents` selector option is `true` (#3101)
* `AbstractBlock#find_by` finds table cells, which can be selected using the `:table_cell` context in the selector (#2524)
* Allow ampersand to be used in email address (#2553)
* Propagate ID assigned to inline passthrough (#2912)
* Rename control keywords in `find_by` to better align with the standard `NodeFilter` terminology
* Stop `find_by` iteration if filter block returns `:stop` directive
* Rename `header_footer` option to standalone (while still honoring `header_footer` for backwards compatibility) (#1444)
* Replace anchors and xrefs before footnotes (replace footnotes last in macros substitution group)
* Apply substitution for custom inline macro before all other macros
* Only promote index terms automatically (A, B, C becomes A > B > C + B > C + C) if `indexterm-promotion` option is set on document (#1487)
* Add support for `see` and `see-also` on index terms; parse attributes on `indexterm` macros if text contains `=` (#2047)
* Drop `:indexterms` table from document catalog (in preparation for solution to #450 in a 2.x release)
* Load additional languages for highlight.js as defined in the comma-separated `highlightjs-languages` attribute (#3036)
* Log warning if conditional expression in `ifeval` directive is invalid (#3161)
* Drop lines that contain an invalid preprocessor directive (#3161)
* Rename `AbstractBlock#find_by` directives; use `:prune` in place of `:skip_children` and `:reject` in place of `:skip`
* Convert example block into details/summary tag set if `collapsible` option is set; open by default if `open` option is set (#1699)
* Substitute replacements in author values used in document header (#2441)
* Require space after semicolon that separates multiple authors (#2441)
* Catalog inline anchors at start of callout list items (#2818) (*@owenh000*)
* Add `parse_attributes` helper method to base extension `Processor` class (#2134)

=== Improvements

* Propagate document ID to DocBook output (#3011)
* Always store section numeral as string; compute Roman numeral for part at assignment time (@vmj)
* Refactor code to use modern Hash syntax
* Define `LIB_DIR` constant; rename *_PATH constants to *_DIR constants to be consistent with RubyGems terminology (#2764)
* Only define `ROOT_DIR` if not already defined (for compatibility with Asciidoctor.js)
* Move custom docinfo content in footer below built-in docinfo content in footer in HTML converter (#3017)
* Read and write files using File methods instead of IO methods (#2995)
* Value comparison in `AbstractNode#attr?` is only performed if expected value is truthy
* Align default CodeRay style with style for other syntax highlighters (#2106)
* Ensure `linenos` class is added to `linenos` column when source highlighter is `pygments` and `pygments-css=style`
* Disable table stripes by default (#3110)
* Rename CSS class of Pygments line numbering table to `linenotable` (to align with Rouge) (#1040)
* Remove unused `Converter#convert_with_options` method (#2891)
* Add `-e`, `--embedded` CLI flag as alias for `-s`, -`-no-header-footer` (require long option to specify eRuby implementation) (#1444)
* Don't store the `options` attribute on the block once the options are parsed (#3051)
* Add an `options` method on `AbstractNode` to retrieve the set of option names (#3051)
* Pass `:input_mtime` option to `Document` constructor; let `Document` constructor assign docdate/time/year attributes (#3029)
* Never mutate strings; add a `frozen_string_literal: true` magic comment to top of all Ruby source files (#3054)
* Always use `docdate` and `doctime` to compute `docyear` and `docdatetime` (#3064)
* Rename `PreprocessorReader#exceeded_max_depth?` to `PreprocessorReader#exceeds_max_depth?` and return `nil` if includes are disabled
* Stop populating `:ids` table in document catalog (#3084)
* Always use `:refs` table in document catalog to look for registered IDs (#3084)
* Don't compute and store reference text in document catalog (#3084)
* Populate reference text table lazily for resolving ID by reference text (#3084)
* Don't store fallback reference text on `:bibref` node (#3085)
* Call `AbstractNode#reftext` instead of `AbstractNode#text` to retrieve reference text for `bibref` node (#3085)
* Only map unparsed attrlist of inline macro to target when format is short
* Add clearer exception message when source data is binary or has invalid encoding (#2884)
* Rename context for table cell and table column to `:table_cell` and `:table_column`, respectively
* Rename `hardbreaks` document attribute to `hardbreaks-option`; retain `hardbreaks` as a deprecated alias (#3123)
* Extend TLD for implicit email addresses to 5 characters (#3154)
* Truncate with precision (instead of rounding) when computing absolute width for columns in DocBook output (#3131)
* Drop legacy LaTeX math delimiters (e.g, `$..$`) if present (#1339)
* Use proper terminology in warning message about mismatched preprocessor directive (#3165)
* Rename low-level extension attribute name `:pos_attrs` to `:positional_attrs`
* Mark `default_attrs` extension DSL method deprecated in favor of `default_attributes`
* Upgrade MathJax to 2.7.5

=== Bug fixes

* Fix crash caused by inline passthrough macro with the macros `sub` clearing the remaining passthrough placeholders (#3089)
* Fix crash if `ifeval` directive is missing expression (#3164)
* Prevent relative `leveloffset` from making section level negative and causing hang (#3152)
* Don't fail to parse Markdown-style quote block that only contains attribution line (#2989)
* Enforce rule that Setext section title must have at least one alphanumeric character; fixes problem with block nested inside quote block (#3060)
* Apply header substitutions to `doctitle` value when assigning it back to the `doctitle` document attribute (#3106)
* Don't fail if value of `pygments-style` attribute is not recognized; gracefully fallback to default style (#2106)
* Do not alter the `$LOAD_PATH` (#2764)
* Fix crash if stem block is empty (#3118)
* Remove conditional comment for IE in output of built-in HTML converter; fixes sidebar table of contents (#2983)
* Fix styling of source blocks with `linenums` enabled when using prettify as syntax highlighter (#640)
* Update default stylesheet to support prettify themes (#3020)
* Remove hard-coded color values on source blocks in default stylesheet (#3020)
* Add fallback if relative path cannot be computed because the paths are located on different drives (#2944)
* Ignore explicit section level style (#1852)
* Don't eat space before callout number in source block if `line-comment` attribute is empty (#3121)
* Check if type is defined in a way that's compatible with autoload
* Fix invalid check for DSL in extension class (previously always returned true)
* Scope constant lookups (#2764)
* Use byteslice instead of slice to remove BOM from string (#2764)
* Don't fail if value of `-a` CLI option is empty string or equals sign (#2997)
* Allow failure level of CLI to be set to `info`
* `Reader#push_include` should not fail if data is nil
* Fix deprecated ERB trim mode that was causing warning (#3006)
* Move time anchor after query string on Vimeo video to avoid dropping options
* Allow color for generic text, line numbers, and line number border to inherit from Pygments style (#2106)
* Enforce and report relative include depth properly (`depth=0` rather than `depth=1` disables nested includes)
* Allow `outfilesuffix` to be soft set from API (#2640)
* Don't split paragraphs in table cell at line that resolves to blank if adjacent to other non-blank lines (#2963)
* Initialize the level to `WARN` when instantiating the `NullLogger`
* `next_adjacent_block` should not fail when called on dlist item (#3133)
* Don't suppress browser styles for summary tag; add pointer cursor and panel margin bottom (#3155)
* Only consider TLDs in email address that have ASCII alpha characters
* Allow underscore in domain of email address

=== Build and infrastructure

* Clear `SOURCE_DATE_EPOCH` env var when testing timezones (PR #2969) (*@aerostitch*)
* Remove compat folder (removes the AsciiDoc.py config file that provides pseudo-compliance with Asciidoctor and a stylesheet for an old Font Awesome migration)
* Add Ruby 2.6.0 to build matrix
* Stop running CI job on unsupported versions of Ruby
* Exclude test suite, build script, and Gemfile from gem (#3044)
* Split build tasks out into individual files

////
=== Sections and book parts

Hide the titles of special sections, such as the dedication, with `untitled` (DocBook backend only).

Number all sections, including special sections, with `:sectnums: all`.

Number book parts with `:partnums:`.
////

// /modules/install/pages/index.adoc
[[install:index.adoc]]
= Install and Update

To simplify installation, Asciidoctor is packaged as a gem and published to the gem hosting service at {url-rubygems}/asciidoctor[RubyGems.org^].
Asciidoctor is also distributed as a managed package for popular Linux distributions and macOS.

TIP: In addition to running on Ruby, Asciidoctor can be executed on a JVM using xref:#asciidoctorj::index.adoc[AsciidoctorJ] or in any JavaScript environment (including the browser) using xref:#asciidoctor.js::index.adoc[Asciidoctor.js].

== Installation methods

Asciidoctor can be installed using:

* Bundler,
* the package manager for popular Linux distributions,
* Homebrew or MacPorts for macOS,
* the `gem install` command (recommended for Windows users), or
* the Asciidoctor Docker image

IMPORTANT: To update or uninstall Asciidoctor, you should use the same method you used to install it.

Bundler is the preferred method of installation as it keeps the gems scoped to your project or workspace.
However, this method of installation does not make the `asciidoctor` command available globally in your terminal.
That's when a package manager is more appropriate.

The benefit of using your operating system's package manager to install the gem is that it adds the `asciidoctor` command to your PATH and it handles installing Ruby and the RubyGems library if those packages are not already installed on your machine.
On the other hand, if you're familiar with Docker, using the Asciidoctor Docker image may give you the best isolation from your system.

// /modules/install/pages/supported-platforms.adoc
[[install:supported-platforms.adoc]]
= Supported Platforms and System Requirements
:navtitle: Supported Platforms
:ge: &#8805;

Asciidoctor operates on Linux, macOS, and Windows and requires one of the supported Ruby implementations listed in the next section.

Our general policy is to align Asciidoctor's support of a platform version with the upstream project's lifecycle schedule for that version.
When a platform version reaches the end of active support by its maintainers or its end of life--which ever comes first--Asciidoctor no longer supports it.

== Ruby runtimes

Asciidoctor requires one of the following implementations of {url-ruby}[Ruby^].

[%autowidth]
|===
|Supported Runtime |Supported Versions

|Ruby
|{ge} 2.3

|JRuby
|{ge} 9.1

|TruffleRuby
|{ge} 20.2
|===

== Operating systems

[%autowidth]
|===
|Supported OS |Supported Versions

|Ubuntu
|{ge} 18.04 LTS

|Fedora
|{ge} 36

|macOS
|{ge} macOS 11 (Big Sur)

|Microsoft
|{ge} Windows 10 +
Windows Server 2019
|===

While the community tests Asciidoctor on a variety of Linux distributions, it's only officially tested on Ubuntu and Fedora.

== System encoding

Asciidoctor assumes you're using UTF-8 encoding.
To minimize encoding problems, make sure the default encoding of your system is set to UTF-8.

If you're using a non-English Windows environment, you may bump into an `Encoding::UndefinedConversionError` when invoking Asciidoctor.
To solve this issue, we recommend overriding the default external and internal character encodings to `utf-8`.
You can do so by setting the `RUBYOPT` environment variable as follows:

 RUBYOPT="-E utf-8:utf-8"

Once you make this change, all your Unicode headaches should be behind you.

If you're using an IDE like Eclipse, make sure you set the encoding to UTF-8 there as well.
Asciidoctor is optimized to work with UTF-8 as the default encoding.

[[ruby-packaging.adoc]]
{empty}

// /modules/install/pages/ruby-packaging.adoc
[[install:ruby-packaging.adoc]]
= Install Using Ruby Packaging

Using Ruby packaging entails making use of commands provided by Ruby (`gem` and `bundle`) to install gems.
A gem is a packaged Ruby application or library, often retrieved from {url-rubygems}[RubyGems.org^].

The benefit of using Ruby packaging to install Asciidoctor is that it's universal.
Provided you have configured Ruby correctly, Ruby packaging works the same way across all Ruby runtimes and operating systems.
This page explains how to use Ruby packaging to install Asciidoctor from the *asciidoctor* gem.

WARNING: Unless you're running in a container (Docker, podman, OCI), _never_ install gems using `gem install` as the root user.
Doing so will almost certainly interfere with, and possibly corrupt, the Ruby installation on your system.
We strongly advise you to use <<Bundler>> to manage your gems within a project (or an RVM gemset to scope the install to your user/home directory).
The `gem install` instructions are provided for when you're running in a container or when your using RVM (ideally with a gemset).

== Configure Ruby packaging

If you're using Linux, the best way to ensure Ruby is configured to use Ruby packaging is to install Ruby using a Ruby version manager.
We recommend that you set up {url-rvm}[RVM^] and use it to install Ruby in your home directory (i.e., user space).
Once that is done, you can safely use the `gem` or `bundle` commands to install or update the Asciidoctor gem, or any other gem for that matter.
When using Ruby managed by RVM, gems are installed in a location isolated from the system (so you don't need root/administrator access).

If you're using Windows, you can install Ruby using Chocolatey or the RubyInstaller.
You will not be able to use RVM if you are using Windows.

If you're using macOS, you can install Asciidoctor directly using Homebrew, though using RVM is also an option.

[#gem-install]
== gem install

Once you've installed Ruby (and have activated it using `rvm use {ruby-version}` if you're using RVM), open a terminal and type:

 $ gem install asciidoctor

include::partial$success.adoc[]

[#pre-release]
=== Install a prerelease version

To install a prerelease version of Asciidoctor (e.g., a release candidate), include the `--pre` option when running the `gem install` command:

 $ gem install asciidoctor --pre

The `--pre` option will select the prerelease version of Asciidoctor instead of the latest stable version.
Note that it's possible that the prerelease version is older than the latest stable version if no recent prerelease version is available.

== Bundler

Bundler creates a virtual environment that scopes the installation of gems to the current project.
Here's how you can use it to install and run Asciidoctor.

. Create a Gemfile in the root folder of your project (or the current directory):

 $ bundle init

. Add the `asciidoctor` gem to the bottom of your Gemfile as follows:
+
[,ruby,subs=attributes+]
----
gem 'asciidoctor'
# or specify the version explicitly
# gem 'asciidoctor', '{release-version}'
----

. Save the Gemfile
. Open a terminal and install the gem using:

 $ bundle

To upgrade the gem, specify the new version in the Gemfile and run `bundle` again.
Using `bundle update` (without specifying a gem) is *not* recommended as it will also update other gems, which may not be the desired result.

IMPORTANT: Once you install using Bundler, you must run any executables provided by the gems (e.g., `asciidoctor`) from the directory where [.path]_Gemfile_ is located and also prefix the executable name with `bundle exec` (e.g., `bundle exec asciidoctor`).
The `bundle exec` prefix tells Ruby to use the gems defined in the [.path]_Gemfile_.

If you want to understand more about Bundler and `bundle exec` and when to use them, see the article https://www.ombulabs.com/blog/ruby/learning/understanding-bundler.html[Understanding Bundler^].

[#gem-update]
== Upgrade using gem update

[CAUTION]
====
You're advised against using the `gem update` command to update a gem managed by the package manager.
Doing so puts the system into an inconsistent state as the package manager can no longer track the files (which get installed under [.path]_/usr/local_).
Simply put, system gems should only be updated by the package manager.

If you want to use a version of Asciidoctor that is newer than what is installed by the package manager, you should use {url-rvm}[RVM^] to install Ruby in your home directory (i.e., user space).
Then, you can safely use the `gem` command to install or update the Asciidoctor gem.
When using RVM, gems are installed in a location isolated from the system.
====

You can upgrade Asciidoctor using the gem `update` command:

 $ gem update asciidoctor

[TIP]
====
If you accidentally use `gem install` instead of `gem update`, then you'll end up with both versions installed.
To remove the older version, use the following `gem` command:

 $ gem cleanup asciidoctor
====

[#gem-uninstall]
== Uninstall using gem uninstall

You can uninstall Asciidoctor using the gem `uninstall` command:

 $ gem uninstall -x asciidoctor

The `-x` option silences the confirmation to remove the `asciidoctor` executable, instead removing it automatically.
In other words, it enables a complete uninstall.

If you have multiple versions of Asciidoctor installed, you will be prompted to specify which version you want to uninstall.

[.output]
....
Select gem to uninstall:
 1. asciidoctor-2.0.15
 2. asciidoctor-2.0.16
 3. All versions
>
....

You can uninstall a specific version, or all versions.
Type one of the numbers at the prompt (`>`) and press kbd:[Enter].

// /modules/install/pages/linux-packaging.adoc
[[install:linux-packaging.adoc]]
= Install Using Linux Packaging
:url-alpine: https://pkgs.alpinelinux.org/packages?name=asciidoctor
:url-arch: https://www.archlinux.org/packages/?name=asciidoctor
:url-debian: https://packages.debian.org/sid/asciidoctor
:url-fedora: https://packages.fedoraproject.org/pkgs/rubygem-asciidoctor/rubygem-asciidoctor/
:url-suse: https://software.opensuse.org/package/rubygem-asciidoctor
:url-ubuntu: https://packages.ubuntu.com/search?keywords=asciidoctor

The benefit of using your operating system's package manager to install the gem is that it handles installing Ruby and the RubyGems library if those packages are not already installed on your machine.

== Package versions

The version of Asciidoctor installed by the package manager may not match the latest release of Asciidoctor.
Consult the package repository for your distribution to find out which version is packaged per distribution release.

* {url-alpine}[Alpine Linux (asciidoctor)^]
* {url-arch}[Arch Linux (asciidoctor)^]
* {url-debian}[Debian (asciidoctor)^]
* {url-fedora}[Fedora (asciidoctor)^]
* {url-suse}[openSUSE (rubygem-asciidoctor)^]
* {url-ubuntu}[Ubuntu (asciidoctor)^]

If you want to use a version of Asciidoctor that is newer than what is available via your package manager, see xref:#ruby-packaging.adoc[].

== APT

On Debian and Debian-based distributions such as Ubuntu, use APT to install Asciidoctor.
To install the package, open a terminal and type:

 $ sudo apt-get install -y asciidoctor

include::partial$success.adoc[]

== DNF

On RPM-based Linux distributions, such as Fedora, CentOS, and RHEL, use the DNF package manager to install Asciidoctor.
To install the package, open a terminal and type:

 $ sudo dnf install -y asciidoctor

include::partial$success.adoc[]

[#apk]
== apk (Alpine Linux)

To install the gem on Alpine Linux, open a terminal and type:

 $ sudo apk add asciidoctor

include::partial$success.adoc[]

[#pacman]
== pacman (Arch Linux)

To install the gem on Arch Linux-based distributions, open a terminal and type:

 $ sudo pacman -S asciidoctor

include::partial$success.adoc[]

[#upgrade]
== Upgrade on Linux

Some Linux distributions may not have the latest stable version of Asciidoctor packaged immediately after a release of a new gem.
If you need to upgrade to the latest version immediately, use xref:#ruby-packaging.adoc[gem install] instead of the package manager.

TIP: Your Linux system may be configured to automatically update packages, in which case the latest Asciidoctor package will be installed as soon as it becomes available.
No further action is required by you.

[#upgrade-apt]
=== APT

On Debian and Debian-based distributions, update the Asciidoctor package using:

 $ sudo apt-get upgrade -y asciidoctor

[#upgrade-dnf]
=== DNF

On Fedora and other RPM-based distributions, you can update the package using:

 $ sudo dnf update -y asciidoctor

[#upgrade-apk]
=== apk (Alpine Linux)

On Alpine Linux, update the Asciidoctor package using:

 $ sudo apk add -u asciidoctor

[#uninstall]
== Uninstall on Linux

To uninstall (i.e., remove) Asciidoctor using Linux packaging, you request your package manager to remove the Asciidoctor package.
The package manager will take care of removing all the necessary application files.

[#uninstall-apt]
=== APT

On Debian and Debian-based distributions, uninstall the Asciidoctor package using:

 $ sudo apt-get remove -y asciidoctor

[#uninstall-dnf]
=== DNF

On Fedora and other RPM-based distributions, you can uninstall the package using:

 $ sudo dnf remove -y asciidoctor

[#uninstall-apk]
=== apk (Alpine Linux)

On Alpine Linux, uninstall the Asciidoctor package using:

 $ sudo apk del asciidoctor

// /modules/install/pages/macos.adoc
[[install:macos.adoc]]
= Install on macOS
:url-homebrew: https://brew.sh
:url-macports: https://www.macports.org
:url-install-macports: https://www.macports.org/install.php
:url-asciidoctor-port: https://ports.macports.org/port/asciidoctor/

== Homebrew

=== Install

You can use {url-homebrew}[Homebrew^], the macOS package manager, to install Asciidoctor.
If you don't have Homebrew on your computer, complete the {url-homebrew}[installation instructions^] first.

Once Homebrew is installed, you're ready to install the `asciidoctor` gem.
Open a terminal and type:

 $ brew install asciidoctor

Homebrew installs the `asciidoctor` gem into an exclusive prefix that's independent of system gems.

include::partial$success.adoc[]

=== Upgrade

To upgrade the gem, open a terminal and type:

 $ brew update
 $ brew upgrade asciidoctor

=== Uninstall

To uninstall the gem, open a terminal and type:

 $ brew uninstall asciidoctor

== MacPorts

You can also use {url-macports}[MacPorts^], another package manager for macOS, to install Asciidoctor.
If you don't have MacPorts on your computer, complete the {url-install-macports}[installation instructions^] first.

Once MacPorts is installed, you're ready to install the `asciidoctor` gem via the {url-asciidoctor-port}[Asciidoctor port^].
Open a terminal and type:

 $ sudo port install asciidoctor

include::partial$success.adoc[]

=== Upgrade

To upgrade the gem, open a terminal and type:

 $ sudo port selfupdate
 $ sudo port upgrade asciidoctor

=== Uninstall

To uninstall the gem, open a terminal and type:

 $ sudo port uninstall asciidoctor

// /modules/install/pages/windows.adoc
[[install:windows.adoc]]
= Install on Windows

To install Asciidoctor on Windows, you can use Chocolatey or RubyInstaller.

== Chocolatey

When you already use https://chocolatey.org[Chocolatey^] on your machine, you can use:

 C:\> choco install ruby

Then follow the xref:#gem-install[gem installation instructions].

== RubyInstaller

Or you use the https://rubyinstaller.org/downloads/[RubyInstaller^], download the package for your Windows Version and after the installation, then follow the xref:#gem-install[gem installation instructions].

// /modules/get-started/pages/index.adoc
[[get-started:index.adoc]]
= Convert Your First AsciiDoc File
:navtitle: Convert Your First File

Assumptions:

* [x] You've installed Asciidoctor.
* [x] You've confirmed that the Asciidoctor command line interface (CLI) is available on your PATH.

On this page, you'll learn how to run Asciidoctor on an AsciiDoc document and convert it to HTML.

== Generate HTML using the default converter

Let's generate HTML 5 using Asciidoctor's default converter and stylesheet from an AsciiDoc document.

. To follow along with the steps below, copy the contents of <<ex-my-doc>> into a new plain text file or use your own AsciiDoc document.
+
.my-document.adoc
[#ex-my-doc,asciidoc]
----
include::html-backend:example$my-document.adoc[tags=title;body]
----

. Make sure to save the file with the _.adoc_ file extension.
. Open a terminal and switch (`cd`) into the directory where your AsciiDoc document is saved.
+
 $ cd directory-name

. Call Asciidoctor with the `asciidoctor` command, followed by file name of the AsciiDoc document.
Since HTML 5 is Asciidoctor's default output, we don't need to specify a converter.
+
--
 $ asciidoctor my-document.adoc

As long as the document didn't contain any syntax errors, you won't see any messages printed to your terminal.
--

. Type `ls` to list the files in the directory.
+
--
 $ ls
 my-document.adoc  my-document.html

You should see a new file named [.path]_my-document.html_.
Asciidoctor derives the name of the output file from the name of the input document.
--

. Open [.path]_my-document.html_ in your web browser.
The converted document should look like the example below.
+
--
image::html-backend:my-document.png[]

The document's text, titles, and link is styled by the default Asciidoctor stylesheet, which is embedded in the HTML output.
As a result, you could save [.path]_my-document.html_ to any computer and it will look the same.
--

TIP: Most of the examples in the general documentation use the CLI, but there are usually corresponding API examples under xref:#api:index.adoc[].

// /modules/convert/pages/index.adoc
[[convert:index.adoc]]
= Converters
:page-aliases: ROOT:converters.adoc

After Asciidoctor parses an AsciiDoc document, it uses a converter to generate the output format of your choice, such as HTML, DocBook, or PDF.
Asciidoctor includes a handful of xref:#built-in[built-in converters].
The Asciidoctor project provides xref:#add-on[additional converters] that you can add on, which are distributed separately.
You also have the option to xref:#custom.adoc[create your own converter] or to use one published by a third party.

When working with converters, it's important to understand the distinction between a converter and a backend.
This page explains that difference while also providing more background on how converters function.

== What is a converter?

A converter takes AsciiDoc and transforms it into a different format.
More specifically, it processes each node (i.e., block or inline element) in a parsed AsciiDoc document in document order and returns a converted fragment, which the processor combines to create the output document.
Each converter produces a specific output format, such as HTML or DocBook XML.

Asciidoctor provides several built-in converters and a facility for adding additional converters.

In addition to generating traditional articles and books from AsciiDoc documents, you can also use Asciidoctor to create HTML-based slide decks, static websites, and documentation sites.
When using these add-on converters, you may need to include some additional structure rules to a document.
However, nothing in this structure restricts you from being able to publish the content as a normal document, too.

== What is a backend?

Each converter is correlated with an output format using a backend identifier.
From the user's perspective, the backend represents the desired output format.
A converter will register itself with a backend identifier to claim that it produces that output format.
For example, the backend identifier for the built-in HTML 5 converter is `html5`.
Thus, from the processor's perspective, the backend is the value it uses to identify which converter to use.

NOTE: The term `backend` is often used interchangeably with the name of a converter.
For example, you might hear "`the html5 backend`" when someone is talking about the HTML 5 converter.
However, there's an important distinction between these terms.

A xref:#custom.adoc[custom converter] can either introduce or reclaim a backend identifier.
Since it's possible for a converter to reclaim a backend identifier, we can't say that a backend universally equates to a given converter.
Rather, the backend identifier informs the processor which converter to select to handle the requested backend based on what's currently registered.

The user selects which converter to use to convert a document by specifying the `backend` document attribute, `-b` (`--backend`) command line option, or `backend` API option (e.g., `--backend=docbook5`).
The `html5` and `docbook5` backends can be referred to using the aliases `html` and `docbook`, respectively.

In summary, a converter is a software component that handles the conversion from a parsed AsciiDoc document to a publishable output format.
The backend represents the user's intent to transform the AsciiDoc document to a given format (e.g., `html5` for HTML 5).
That backend also serves as an identifier that tells the processor which converter to use.
More than one converter can bind to (i.e., stake claim to) the same backend in order to provide the user with alternatives for generating a given output format.
For example, the backend `pdf` could be satisfied by Asciidoctor PDF, but it may also be mapped to a different implementation.
The last converter that registers itself with a backend wins.

[[available.adoc]]
{empty}

// /modules/convert/pages/available.adoc
[[convert:available.adoc]]
= Available Converters

This page lists the converters, along with their associated backends and output formats, which are either built into Asciidoctor or distributed separately by the Asciidoctor project.
There are additional "`unofficial`" converters for Asciidoctor which are not listed on this page.

[#built-in]
== Built-in converters

These built-in converters are bundled with Asciidoctor.

xref:#html-backend:index.adoc[HTML]::
The HTML 5 converter (backend: `html` or `html5`) generates HTML 5 styled with CSS3.
This is the converter Asciidoctor uses by default.

xref:#xhtml[XHTML]::
The XHTML variant of the HTML 5 converter.
To use the XHTML converter, assign `xhtml` or `xhtml5` to the `backend` option.

xref:#docbook-backend:index.adoc[DocBook]::
The DocBook 5.0 converter generates DocBook 5.0 XML.
To use the DocBook converter, assign `docbook` or `docbook5` to the `backend` option.

xref:#manpage-backend:index.adoc[Man page]::
The man page converter generates manual pages for software used on Unix and Unix-like operating systems.
To use the man page converter, assign `manpage` to the `backend` option.

[#add-on]
== Add-on converters

You can use add-on converters, which plug into Asciidoctor by adding the appropriate library to the runtime path (e.g., `-r asciidoctor-pdf`).

PDF::
The PDF converter (backend: `pdf`) generates a portable document format.
Requires the https://rubygems.org/gems/asciidoctor-pdf[asciidoctor-pdf^] gem.

EPUB3::
The EPUB3 converter (backend: `epub3`) generates a distribution and interchange format standard for digital publications and documents.
Requires the https://rubygems.org/gems/asciidoctor-epub3[asciidoctor-epub3^] gem.

Reveal.js::
The Reveal.js converter generates a Reveal.js presentation from an AsciiDoc document.
Requires https://github.com/asciidoctor/asciidoctor-reveal.js[Asciidoctor Reveal.js^].

Bespoke::
The Bespoke converter generates a Bespoke presentation from an AsciiDoc document.
Requires https://github.com/asciidoctor/asciidoctor-bespoke[Asciidoctor Bespoke^].

////
LaTeX::
The LaTeX, a document preparation system for high-quality typesetting.
Requires the https://rubygems.org/gems/asciidoctor-latex[asciidoctor-latex^] gem.

mallard::
Mallard 1.0 XML.
Requires the https://github.com/asciidoctor/asciidoctor-mallard[asciidoctor-mallard^] gem (not yet released).

=== Static site generators

* Jekyll
* Middleman
* Antora
////

// TODO describe the role of template converters (e.g., asciidoctor-backends)

////
Pulled directly from the user manual - need to decide where this information goes and how it should be presented.

== PDFs

Conversion from AsciiDoc to PDF is made possible by a number of tools.

{uri-asciidoctor-pdf}[Asciidoctor PDF]::
A native PDF converter for Asciidoctor (converts directly from AsciiDoc to PDF using Prawn).
+
Instructions for installing and using Asciidoctor PDF are documented in the project's {uri-asciidoctor-pdf-readme}[README].
The tool provides built-in theming via a YAML configuration file, which is documented in the {uri-asciidoctor-pdf-theming-guide}[theming guide].
+
TIP: Asciidoctor PDF is the preferred tool for converting to PDF and is fully supported by the Asciidoctor community.

a2x::
A DocBook toolchain frontend provided by that AsciiDoc.py project.
+
To use this tool, you should first convert to DocBook using Asciidoctor, then convert the DocBook to PDF using a2x.
a2x accepts a DocBook file as input and can convert it to a PDF using either Apache FOP or dblatex.
Instructions for using a2x are documented in the project's {uri-a2x-manpage}[man page].

{fopub-ref}[asciidoctor-fopub]::
A DocBook toolchain frontend similar to a2x, but which only requires Java to be installed on your machine.
+
Instructions for using asciidoctor-fopub are documented in the project's {fopub-doc-ref}[README].
To alter the look and feel of the PDF, it's necessary to pass XSL parameters or modify the XSLT.
More information about customization can be found in http://www.sagehill.net/docbookxsl/[DocBook XSL: The Complete Guide].
////

[[custom.adoc]]
{empty}

// /modules/convert/pages/custom.adoc
[[convert:custom.adoc]]
= Custom Converter
:apidoc-root: {url-api-gems}/asciidoctor/{release-version}/Asciidoctor
:apidoc-block: {apidoc-root}/Block
:apidoc-converter: {apidoc-root}/Converter
:apidoc-converter-base: {apidoc-converter}/Base
:apidoc-converter-for: {apidoc-converter}/Factory#for-instance_method

Asciidoctor supports custom converters.
If you want to produce an output format that's not supported by a built-in converter or any of the available converters in the ecosystem, you can create and use your own converter.
You may also decide to create a custom converter to customize the output of a supported output format or to take an entirely different approach.
A custom converter gives you that ability, offering a more formal alternative to xref:#templates.adoc[converter templates].

TIP: In addition to Asciidoctor's {url-org}/asciidoctor/tree/main/lib/asciidoctor/converter[built-in converters], there are numerous custom converters you can use as a reference, including {url-org}/asciidoctor-epub3[Asciidoctor EPUB3], {url-org}/asciidoctor-pdf[Asciidoctor PDF], {url-org}/asciidoctor-reveal.js[Asciidoctor reveal.js], {url-org}/asciidoctor-fb2[Asciidoctor FB2], and {url-org}/asciidoctor-docbook45[Asciidoctor DocBook 4.5].

On this page, you'll learn how to create a custom converter in Ruby, register it, then make use of it.
After a brief overview, we'll begin by extending and replacing a registered converter.
Then we'll move on to making a new converter from scratch.

== Overview

The converter in Asciidoctor is a specialized extension point.
Even Asciidoctor's built-in converters use this facility.
That means, in addition to being able to introduce a new converter, you can replace any of the existing ones.
Since Asciidoctor is written in the Ruby programming language, you write custom converters in Ruby as well.

TIP: You can also write a converter in Java using AsciidoctorJ or in JavaScript using Asciidoctor.js.
The advantage of writing the converter in Ruby is that you can use the same code regardless of which Asciidoctor runtime you choose.
That's the best strategy if you plan to share the converter with the community.

When creating a custom converter, you can either write one from scratch or you can extend a built-in converter.
You can then register that converter with a xref:#available.adoc[known backend] to replace the previously registered converter, or you can register it with a new backend to create a new output target.
If you don't want to register the converter with a backend, you can pass the converter class or instance to the API using the `:converter` option.

.Producing non-SGML output formats
****
An important point to keep in mind is that converters (and, in general, AsciiDoc processors like Asciidoctor) are biased towards creating SGML output (e.g., XML and HTML).
This means that when producing other output formats, you'll need to decode XML character references and employ techniques that preserve the expected behavior of the processor.
One such technique is to use temporary XML tags around boundaries of inline elements such as formatted text so the processor can still recognize those boundaries when performing inline substitutions.
The https://github.com/asciidoctor/asciidoctor/blob/HEAD/lib/asciidoctor/converter/manpage.rb[built-in man page converter] provides a good example of these techniques.
****

Unless a converter instance is passed to the processor, the converter is instantiated each time an AsciiDoc document is processed.
A converter in Asciidoctor is not designed to be reused from one conversion to the next and is therefore stateless.

Implementing a custom converter consists of the following steps:

. Write a Ruby class that includes the {apidoc-converter}[`Asciidoctor::Converter`] module or extends a class that does.
. Implement a callback method to convert the nodes (i.e., block or inline elements) in the parsed document to the target output format.
. Optionally register the converter with one or more backend names.
. Require (i.e., load) the Ruby file containing the converter class.
. Activate the converter by setting the backend on the document if the converter is registered with a backend, otherwise passing the converter class or instance to the API using the `:converter` option

To get our feet wet, let's start by extending and replacing a registered converter.

== Extend and replace a registered converter

The best way to get started developing converters is to extend a registered converter and play around with changing its behavior.

To create a custom converter, you define a Ruby class in a Ruby source file that you pass to Asciidoctor when you run it.
To get started, create a file named [.path]_my-html5-converter.rb_ and open it.
The Ruby code in this file will run in the context of Asciidoctor, so you don't need to add a require statement to use the Ruby APIs from Asciidoctor.

To extend a registered converter, you first need to get a reference to it.
That's the purpose of the {apidoc-converter-for}[`Asciidoctor::Converter.for`] method.
This method will resolve the class of the converter that's currently registered for a backend.
If we're looking for the converter for the `html5` backend (i.e., the HTML 5 converter), we pass in the string `html5`.

[,ruby]
----
Asciidoctor::Converter.for 'html5'
# => Asciidoctor::Converter::Html5Converter
----

Next, we want to extend this class.
To extend a class in Ruby, you declare the class, then use the `<` operator to indicate the class from which to extend.

[,ruby]
----
class MyHtml5Converter < (Asciidoctor::Converter.for 'html5')
end
----

Congratulations!
You've created your first custom converter.
But wait, it's not yet registered, which means it isn't going to be used.
Let's fix that.

To register the converter class, you need to declare the backend you want it to be mapped to.
In order to customize the HTML that Asciidoctor produces, you declare the backend as `html5` using the `register_for` method.
In doing so, this registers the custom converter over the built-in converter, effectively replacing it.

[,ruby]
----
class MyHtml5Converter < (Asciidoctor::Converter.for 'html5')
  register_for 'html5'
end
----

Although we haven't changed any of the behavior, this converter can be used...almost.
The final step is to tell Asciidoctor to load this file when it starts.
You can do that by passing the file's path to the `-r` CLI option as follows.

 $ asciidoctor -r ./my-html5-converter.rb doc.adoc

When Asciidoctor starts, it will tell Ruby to evaluate the Ruby source file.
When it does, Ruby will define the `MyHtml5Converter` class.
While defining the class, it will call the `register_for` method, which will register the class with the `html5` backend (replacing the built-in converter).
This means Asciidoctor is now using your custom converter.

Now that you've configured Asciidoctor to use your custom converter, it's time to get it to do something different.
Let's say that you want to simplify the HTML that the built-in converter produces for a paragraph down to a single `<p>` element.
A custom converter is exactly the tool you need to accomplish this goal.

In this case, we'll be overriding the `convert_paragraph` method.
When extending a built-in converter (or any converter that extends {apidoc-converter-base}[`Asciidoctor::Converter::Base`]), the name of the convert method for a node (i.e., block or inline element) in the parsed document model is the context of the node (e.g., `paragraph`) prefixed with `convert_`.
That's how we arrive at the method name `convert_paragraph` for a paragraph.
You can find a list of all such methods in xref:#contexts-ref.adoc[].

The converter method accepts the node as the first parameter.
For blocks, the node is an instance of {apidoc-block}[`Asciidoctor::Block`].

Let's add the `convert_paragraph` method to our custom converter to provide a custom implementation.

[,ruby]
----
class MyHtml5Converter < (Asciidoctor::Converter.for 'html5')
  register_for 'html5'

  def convert_paragraph node
    logger.warn 'Converting a paragraph...' <1>
    super
  end
end
----
<1> The base converter automatically includes the Logging module, which gives your converter access to Asciidoctor's logger.

So far, all we've done is print an intent to convert a paragraph, then delegate back to the super method (i.e., the original implementation).
If you run Asciidoctor as before:

 $ asciidoctor -r ./my-html5-converter.rb doc.adoc

you should now see the following message in your terminal window:

....
asciidoctor: WARNING: Converting a paragraph...
....

Showing how to delegate to the super method is important as it demonstrates that you can still use the built-in logic in certain cases (or even decorate the HTML it produces).
But let's replace it with our own logic instead.

[,ruby]
----
class MyHtml5Converter < (Asciidoctor::Converter.for 'html5')
  register_for 'html5'

  def convert_paragraph node
    %(<p>#{node.content}</p>)
  end
end
----

If you run Asciidoctor as before, you should now see that paragraphs are converted to a simple `<p>` element.

[,html]
----
<p>Content of paragraph.</p>
----

But we're missing some things, such as the ID, the role, and the title.
Let's fill in those gaps.

[,ruby]
----
class MyHtml5Converter < (Asciidoctor::Converter.for 'html5')
  register_for 'html5'

  def convert_paragraph node
    attributes = []
    attributes << %( id="#{node.id}") if node.id
    attributes << %( class="#{node.role}") if node.role
    title = node.title? ? %(<span class="title">#{node.title}</span> ) : ''
    %(<p#{attributes.join}>#{title}#{node.content}</p>)
  end
end
----

Assuming the paragraph has an ID, role, and title, here's the output this converter will produce:

[,html]
----
<p id="intro" class="summary"><span class="title">What is a wolpertinger?</span> A wolpertinger is a ravenous beast.</p>
----

You've not only created your first custom converter, but you're well on your way to customizing the HTML that Asciidoctor produces to suit your own needs!

Now that you've successfully extended and replaced a registered converter, let's look at how to create a converter from scratch.

== Create and register a new converter

Instead of modifying the behavior of a built-in converter, you can create a converter from scratch for a new or existing backend.
Let's create a new converter that converts (some) AsciiDoc to DITA.
Here's the AsciiDoc sample we're aiming to convert.

[,asciidoc]
----
= Document Title

== Section Title

This is the *main* content.
----

Once again, you'll begin by creating a Ruby source file, this time naming it [.path]_dita-converter.rb_.
We'll start by mixing in the {apidoc-converter}[`Asciidoctor::Converter`] module, which turns the class into a converter class.
You'll quickly learn, however, that this is tedious and that extending the base converter is an easier route.

Let's set up our converter and map it to the backend named `dita`.

[,ruby]
----
class DitaConverter
  include Asciidoctor::Converter
  register_for 'dita'
end
----

By default, a converter will assume it produces a file with the `.html` extension.
Since we intend to create a DITA file, we'll need to call the `outfilesuffix` in the constructor to change that to `.dita`.

[,ruby]
----
class DitaConverter
  include Asciidoctor::Converter
  register_for 'dita'

  def initialize *args
    super
    outfilesuffix '.dita'
  end
end
----

Now let's implement the required `convert` method so the converter can start receiving the nodes to convert.
We'll only process the main structural nodes to start, then pass through the raw output for the remaining nodes (to finish later).

[,ruby]
----
class DitaConverter
  include Asciidoctor::Converter
  register_for 'dita'

  def initialize *args
    super
    outfilesuffix '.dita'
  end

  def convert node, transform = node.node_name, opts = nil <1>
    case transform <2>
    when 'document'
      <<~EOS.chomp
      <!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
      <topic>
      <title>#{node.doctitle}</title>
      <body>
      #{node.content} <3>
      </body>
      </topic>
      EOS
    when 'section'
      <<~EOS.chomp
      <section id="#{node.id}">
      <title>#{node.title}</title>
      #{node.content} <3>
      </section>
      EOS
    when 'paragraph'
      %(<p>#{node.content}</p>)
    else
      (transform.start_with? 'inline_') ? node.text : node.content
    end
  end
end
----
<1> The `node_name` method returns the node's context as a string.
<2> The `transform` parameter is only set in special cases, such as for an embedded document.
<3> Calling `node.content` on a block continues the traversal of the document structure from that node.

IMPORTANT: The `#content` method controls whether a block is traversed, not the processor.
Thus, when converting a block element, the converter should invoke the `#content` method on the node (e.g., `node.content`).
This method call is what continues the document traversal from that node and returns the converted subtree.
When the method is called, Asciidoctor visits each child node in document order and passes it to the `convert` method of the converter to be converted.
The return values are then joined.
If you don't call this method, the child nodes will be skipped.

As you can see, having to write a switch statement to handle each type of node is more clumsy than the discrete methods we were writing when extending a built-in converter.
If we change the definition of our converter class to extend {apidoc-converter-base}[`Asciidoctor::Converter::Base`], Asciidoctor will handle this dispatching for us.
One noticeable difference is that we now either have to provide a handler for every xref:#contexts-ref.adoc[convertible context], or implement a `method_missing` method as a catch all.
Here's how that looks:

.dita-converter.rb
[,ruby]
----
class DitaConverter < Asciidoctor::Converter::Base
  register_for 'dita'

  def initialize *args
    super
    outfilesuffix '.dita'
  end

  def convert_document node
    <<~EOS.chomp
    <!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
    <topic>
    <title>#{node.doctitle}</title>
    <body>
    #{node.content}
    </body>
    </topic>
    EOS
  end

  def convert_section node
    <<~EOS.chomp
    <section id="#{node.id}">
    <title>#{node.title}</title>
    #{node.content}
    </section>
    EOS
  end

  def convert_paragraph node
    %(<p>#{node.content}</p>)
  end

  def convert_inline_quoted node
    node.type == :strong ? %(<b>#{node.text}</b>) : node.text
  end
end
----

You can now use this converter to convert the sample AsciiDoc document to DITA.
To do so, pass the converter to the `-r` CLI option and set the backend to `dita` using the `b` CLI option.

 $ asciidoctor -r ./dita-converter.rb -b dita doc.adoc

Here's an example of the output you will get, which is automatically written to the [.path]_doc.dita_ file.

.doc.dita
[,xml]
----
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic>
<title>Document Title</title>
<body>
<section id="_section_title">
<title>Section Title</title>
<p>This is the <b>main</b> content.</p>
</section>
</body>
</topic>
----

NOTE: If the value of the `:to_file` option passed to Asciidoctor's convert API responds to the `write` method (e.g., an IO object), Asciidoctor will ensure the output has a trailing newline character.
Otherwise, it's up to the converter to decide whether to append a trailing newline character to the output.

If you don't register the converter with a backend, you can pass the converter class (or instance) using the `:converter` option of the xref:#api:index.adoc[Asciidoctor API], as shown in the following code snippet:

[,ruby]
----
require 'asciidoctor'
require_relative 'dita-converter.rb'

Asciidoctor.convert_file 'doc.adoc', safe: :safe, backend: 'dita', converter: DitaConverter
----

To write a fully-functional converter, you'll need to provide a convert method for all convertible contexts (or provide a fallback for contexts the converter does not handle).

== Convert to text only

You may want to extract the text from an AsciiDoc document without any markup.
Since there's no single definition of what "plain text" is, this is a perfect opportunity to use a custom converter.

Begin by defining a `TextConverter` that is registered with the `text` backend, as follows:

.text-converter.rb
[,ruby]
----
class TextConverter
  include Asciidoctor::Converter
  register_for 'text'
  def initialize *args
    super
    outfilesuffix '.txt'
  end
  def convert node, transform = node.node_name, opts = nil
    case transform
    when 'document', 'section'
      [node.title, node.content].join %(\n\n)
    when 'paragraph'
      (node.content.tr ?\n, ' ') << ?\n
    else
      (transform.start_with? 'inline_') ? node.text : node.content
    end
  end
end
----

You can now use this converter to convert the sample AsciiDoc document to text.
To do so, pass the converter to the `-r` CLI option and set the backend to `text` using the `b` CLI option.

 $ asciidoctor -r ./text-converter.rb -b text doc.adoc

Here's an example of the output you will get, which is automatically written to the [.path]_doc.txt_ file.

.doc.txt
[,xml]
----
Document Title

Section Title

This is the main content.
----

If you need to retain some text notations, you can add them back while the document is converted, where necessary.

[[templates.adoc]]
{empty}

// /modules/convert/pages/templates.adoc
[[convert:templates.adoc]]
= Converter Templates
:page-aliases: api:load-templates.adoc
:apidoc-root: {url-api-gems}/asciidoctor/{release-version}/Asciidoctor
:apidoc-abstract-node: {apidoc-root}/AbstractNode
:apidoc-block: {apidoc-root}/Block
:url-pry: http://pry.github.io
:url-slim: https://slim-template.github.io
:url-tilt: https://github.com/rtomayko/tilt
:!listing-caption:

All output produced by Asciidoctor is customizable.
One way to customize the output is to use a xref:#custom.adoc[custom converter].
Converter templates offer a simpler way.

The built-in converters, and others that have the `supports_templates` trait enabled, allow you to replace the convert handler for any convertible context with a template.
The goal of this mechanism is to make it easier to customize the output of a converter (e.g., HTML) without having to develop, register, and use a custom converter.
In other words, you can customize the output of a converter à la carte without having to write code (aside from what's in the template).

This page explains how the converter template mechanism works in Asciidoctor and how you can make use of it to customize the output of a converter that supports it.

== What is a template?

A template is a type of source file that's focused on producing output.
When we use the term [.term]_template_ in this context, we're specifically referring to the source file for a Ruby template engine.

You can think of template as source code in which the output text forms the primary structure and the programming logic is weaved in between.
If you come from a programming background, it's as though the program logic and strings are flipped.

When you write a template, you begin with static text.
Then you intersperse logic around regions of that text.
This logic allows you to either conditionally select text or repeat it based on information provided by a backing data model.
The syntax of that interspersed logic is the template language.

The most common template engine in Ruby is ERB because it's built into the language.
Here's an example of an ERB template that outputs a paragraph element using the content provided by the backing data model:

.paragraph.html.erb
[,erb]
----
<p><%= content %></p>
----

Some template languages, such as Slim and Haml, are more structured.
Here's the previous example written in Slim:

.paragraph.html.slim
[,slim]
----
p =content
----

and in Haml:

.paragraph.html.haml
[,haml]
----
%p =content
----

Notice there are no angled brackets in these templates.
That's because Slim and Haml assume that the start of each statement is the name of an XML element (Haml requires a leading `%`).
The equals sign tells Slim and Haml to evaluate the Ruby expression that follows and insert the result into the output.
In this case, the template is reading the variable `content`, technically a property of the backing data model.
Slim and Haml use indentation to infer nesting in the HTML structure (much like in YAML).

At runtime, the template engine transforms the template into runnable code and invokes it.
We refer to this operation as invoking the template.
Effectively, this operation invokes the logic and expands variable references in the template to produce the resolved output.

Now that you're familiar with the basic concept of a template, let's look at how templates are used in Asciidoctor.

== Templates in Asciidoctor

Templates are used in Asciidoctor to customize the output generated by a converter (as long as the converter has the `supports_templates` trait enabled).
We refer to these as converter templates.
Converter templates work in conjunction with the converter over which they are applied.

You can reuse the same set of templates you develop for Asciidoctor with AsciidoctorJ, making the templates portable between the two runtimes.
Asciidoctor.js provides its own xref:#asciidoctor.js:extend:converter/template-converter.adoc[template converter], which means you have to develop a different set of templates if you're using Asciidoctor.js.

There are three keys points to understand about using converter templates in Asciidoctor:

* How Asciidoctor selects the template engine to use.
* What backing data model Asciidoctor passes to the template.
* The available template names.

Let's study templates through the lens of Asciidoctor, then explore common APIs, helpers, and debugging.

=== Template engine selection

Asciidoctor uses https://github.com/rtomayko/tilt[Tilt^] to load and invoke templates.
Tilt is a generic interface to multiple Ruby template engines and is provided by the required *tilt* gem.

You can compose templates in any template language that's supported by Tilt.
If you use a template engine that requires additional libraries (i.e., gems), you must install them first.
For example, to use templates written in Haml, you must install the *haml* gem.

Tilt examines the file extension of the template, matches it to a registered and available template engine, and passes the template to the engine to be invoked.
If the file extension is not recognized, or the template engine is not installed, this process will fail.

A template has a double file extension (e.g., `.html.haml`).
The outer file extension is the file extension of the template.
In other words, it identifies the template language.
The inner file extension is the file extension of the output file.
In other words, it identifies the output format.

Let's assume you have a template named [.path]_paragraph.html.haml_.
The _.haml_ file extension tells Tilt to delegate to Haml.
The remaining part of the filename (e.g., [.path]_paragraph.html_) would be used as the output file.
However, in Asciidoctor, the result of the template isn't output to a file.
Instead, it is combined with the rest of the output of the converter.
But the file extension should still match the file extension of the output file that Asciidoctor produces.

You can find a list of template engines that Tilt supports, along with any required libraries, in the {url-tilt}#readme[Tilt README^].
The most popular template engines for this purpose are {url-slim}[Slim^], Haml, and ERB.
We strongly recommend using Slim.
ERB is also a solid choice since it's built into the Ruby language and thus doesn't have any dependencies.
You're encouraged to read the documentation for the template engine of your choice to understand how to use that particular template language.

=== Available template names

When we talk about the name of a template, we're talking about the basename of the template minus the double file extension.
For example, the name of the template [.path]_paragraph.html.slim_ is _paragraph_.
This name is significant because it maps 1-to-1 with the xref:#contexts-ref.adoc[convertible contexts] in Asciidoctor (excluding the leading colon).
The convertible contexts are roughly the nodes in the parsed AsciiDoc document.

If the name of a template matches the name of a convertible context, Asciidoctor will use that template to produce the output for any node with that context when the convert method is called on that node.
You can create a template for as many or as few contexts as you like.
If Asciidoctor is unable to locate a template for a convertible context, it will fall back to using the handler provided by the converter.
By using templates, you can customize some or all of the output produced by a converter.

NOTE: Recall that templates can only be used if supported by the converter.
All built-in converters in Asciidoctor support the use of templates to customize the converter.

The outer template is either named document or embedded, depending on whether or not the document is being converted in standalone mode.
Asciidoctor doesn't walk the document tree itself and invoke the corresponding templates.
Rather, it's up to the template to trigger the other templates by invoking the `content` method on block nodes.
So, if you replace the document or embedded template, and don't invoke the `content` method, that explains why no other templates get called.

Let's look at the backend data model to understand the logic that can be used in a template.

=== Backing data model

The backing data model for a template in Asciidoctor is always the node being converted (specifically an {apidoc-abstract-node}[`AbstractNode`]).
(A node in the Asciidoctor document model is similar to an XML DOM node).
For example, when writing a template for a paragraph, the backing data model is an instance of {apidoc-block}[`Block`] with the context `:paragraph`.

You can access the node itself using the `self` keyword.

[,slim]
----
- puts self
----

In a Slim template, a line that starts with `-` executes a Ruby statement.
An expression that starts with `=` (either at the start of the line or following a tag name) invokes a method and inserts the return value into the template.

Within the template, you can access all the instance variables and methods of the node using the name of that member, just as you would inside a method call (e.g., `@id` or `title`).
(You can think of the template as a method call on the node object).
When referencing an accessor method, the name of the member is synonymous with a template variable.

CAUTION: Accessing instance variables of the node from the template (e.g., `@id`) is generally discouraged as it tightly couples your template to the internal model.
It's better to stick with using public accessors and methods.

To access the converted content of the node, you use the template variable `content`.

[,slim]
----
p =content
----

The syntax `=content` invokes the `content` accessor method on the node and inserts the result into the template.

You can access the document for all nodes from the template using the `document` property.
The document is most commonly used for looking up document attributes, as shown here:

[,slim]
----
p lang=(document.attr 'lang') =content
----

You can also use the document object to lookup other nodes in the document using `Document#find_by`.

Let's look at a complete example of a paragraph template that mimics the output of the built-in HTML converter.

.paragraph.html.slim
[,slim]
----
div id=id class=['paragraph', role]
  - if title?
    .title =title
  p =content
----

Assuming id is "hello", title is "Hello, World!", role is nil, and content is "Your first template!", this template will produce the following HTML:

[,html]
----
<div id="hello" class="paragraph">
  <div class="title">Hello, World!</div>
  <p>Your first template!</p>
</div>
----

This template uses the `id`, `role`, `title`, and `content` properties, as well as the `title?` method.
You may notice that Slim infers some logic for you.
If the role is not set, it will drop that entry from the array, join the remaining entries on a space, and output the class attribute.
If the `id` property were nil instead of "hello", the template will not output the id attribute.

To help you understand what properties and methods are available on a node, you can print them using the following expression:

[,slim]
----
- pp (public_methods - Object.instance_methods).reject {|it| it.end_with? '=' }
----

All properties are reported as methods, which is why this statement uses `public_methods`.

You can inspect all the attributes available on the current node and current document as follows:

[,slim]
----
- pp attributes
- pp document.attributes
----

To discover more about these properties and methods, and what they return, refer to the {apidoc-abstract-node}[API docs].
Also refer to <<Debugging>> to learn more about how to inspect the backing data model.

=== Common APIs

Each node shares a common set of properties, such as id, role, attributes, context, its parent node, and the document node.
Block and inline nodes have additional properties that are specific to their purpose.
For example, a block node has a `content` property to access its converted content, a list node has an `items` property to access the list items, and an inline node has a `text` property to access the converted text.

Each template has access to any API in the document model that is accessible from the node being converted.
The following table provides a list of the APIs you'll likely use most often.

[cols="1,2m,1"]
|===
|Name |Example (Slim) |Description

|document
|- if document.attr 'icons', 'font'
|A reference to the current document (and all of its nodes).

|content
|=content
|Converts the children of this block node (if any) and returns the result.

|items
|- items.each do \|item\|
|Provides access to the items in a list node.
Note that the list template must process its own items.

|text
|=text
|Returns the converted text of this inline node.

|target
|=target
|Returns the converted target of this inline node, if applicable (e.g., anchor, image).

|id
|div id=id
|The id assigned to the block or nil if no id is assigned.

|role
|div class=role
|A convenience method that returns the role attribute for the block, or nil if the block does not have a role.

|role?
|if role? 'lead'
|A convenience method to check whether the block has the role attribute.

|attr
|div class=(attr 'toc-class', 'toc')
|Retrieves the value of the specified attribute on the element, using the name as a key.
If the name is written as a symbol, it will be automatically converted to a string before lookup.
The second argument is a fallback value if the attribute is not set.

|attr?
|- if attr? 'icons'
|Checks whether the specified attribute exists on the element, using the name as the key.
If the name is written as a symbol, it will be automatically converted to a string before lookup.
If the second argument is provided (a match), it additionally checks whether the attribute value matches the specified value.

|style
|- if style == 'source'
|Retrieves the style (qualifier) for a block node.
If the block does not have a style, nil is returned.

|title
|=title
|Retrieves the title of the block with normal substitutions (escape XML, render links, etc) applied.

|title?
|- if title?
|Checks whether a title has been assigned to this block.
This method does not have side effects (e.g., checks for existence only, does not apply substitutions)

|captioned_title
|=captioned_title
|Retrieves the title of the block with caption and normal substitutions (escape XML, render links, etc) applied.

|option?
|video autoplay=(option? 'autoplay')
|A convenience method to check whether the specified option attribute (e.g., autoplay-option) is present.

|type
|- if type == :xref
|Returns the node variant for inline nodes that have variants (e.g., anchor, quoted, etc).

|image_uri
|img src=(image_uri attr 'target')
|Converts the path into an image URI (reference or embedded data) to be used in an HTML img element.
Applies security restrictions, cleans path and can embed image data if :data-uri: attribute is enabled on document.
Always use this method when dealing with image references.
Relative image paths are resolved relative to document directory unless overridden using :imagesdir:

|icon_uri
|img src=(icon_uri attr 'target')
|Same as image_uri except it specifically works with icons.
By default, it will look in the subdirectory images/icons, unless overridden using :iconsdir:

|media_uri
|audio src=(media_uri attr 'target')
|Similar to image_uri, except it does not support embedding the data into the document.
Intended for video and audio paths.

|normalize_web_path
|link href=(normalize_web_path attr 'stylesheet')
|Joins the path to the relative_root and normalizes parent and self references. Access to parent directories may be restricted based on safe mode setting.
|===

=== Helpers

As previously stated, the backing data model for a template primarily consists of the properties and methods of the node being converted.
Helpers provided by the template engine are also available as top-level functions in the template.
Refer to the documentation for the template engine for details.

If you find yourself putting a lot of logic in the template, you may want to extract that logic into custom helper functions.
When using Haml or Slim, you can define these helper functions in the file [.path]_helper.rb_ located in the same folder as the templates.
These helper functions can simplify reoccurring elements that appear across multiple templates.

The helper file must define the Ruby module `Haml::Helpers` or `Slim::Helpers`, depending on which template engine your templates target.
Every method defined in that module becomes a top-level function in the template.
The method is effectively mixed into the node, so the `self` reference in the function is the node itself.

TIP: Helpers provided by the template engine are also available as top-level functions.
For example, Haml provides the `html_tag` helper for creating an HTML element dynamically.
Refer to the documentation for the template engine for details.

Let's assume that we're creating a template for sections, and we want to output the section title with the section number, but only if automatic section numbering is enabled.
We can create a helper function for this purpose:

.helpers.rb
[,ruby]
----
module Slim::Helpers
  def section_title
    if caption
      captioned_title
    elsif numbered && level <= (document.attr :sectnumlevels, 3).to_i
      if level < 2 && document.doctype == 'book'
        case sectname
        when 'chapter'
          %(#{(signifier = document.attr 'chapter-signifier') ? signifier.to_s + ' ' : ''}#{sectnum} #{title})
        when 'part'
          %(#{(signifier = document.attr 'part-signifier') ? signifier.to_s + ' ' : ''}#{sectnum nil, ':'} #{title})
        else
          %(#{sectnum} #{title})
        end
      else
        %(#{sectnum} #{title})
      end
    else
      title
    end
  end
end
----

You can now use this helper in your section template as follows:

.section.html.slim
[,slim]
----
*{ tag: %(h#{level + 1}) } =section_title <1>
=content <2>
----
<1> We're leveraging a special syntax in Slim to create the HTML heading element dynamically.
<2> It's necessary to invoke the `content` method to convert the child nodes of a node that contains other nodes.

If you prefer your helpers to be pure functions, you can pass in the node as the first argument and only use that reference to access properties of the backing data model.

.helpers.rb using pure functions
[,ruby]
----
module Slim::Helpers
  def section_title node = self
    if node.caption
      node.captioned_title
    elsif node.numbered && node.level <= (node.document.attr :sectnumlevels, 3).to_i
      ...
    else
      node.title
    end
  end
end
----

Which style you use to write your helpers is up to you.
But if you find that you need to reuse a function for different scenarios, you might find the investment in pure functions to be worthwhile.

=== Debugging

There are two approaches to debug a template by exploring the backing model:

* print messages and return values to STDOUT using `puts` or `pp`
* jump into the context of the template using an interactive debugger

==== Print debugging information

To print the current node in string form to STDOUT, you can use the following statement in your template:

[,slim]
----
- puts self
----

You can print structured information about the current node using `pp`:

[,slim]
----
- pp self
----

However, since a node has circular references, that output can be extremely verbose.
You might find it more useful to print more specific information.

You can see what attributes are available on the current node and document using these statements:

[,slim]
----
- pp attributes
- pp document.attributes
----

You can see what properties and methods are available on a node using the following expression:

[,slim]
----
- pp (public_methods - Object.instance_methods).reject {|it| it.end_with? '=' }
----

Using print statements, you have to update the template and rerun Asciidoctor each time you want to further your inspection.
A more efficient approach is to use an interactive debugger.

==== Use an interactive debugger

{url-pry}[Pry] is a powerful debugger for Ruby that features syntax highlighting, tab-completion, and documentation and source code browsing.
You can use it to interactively discover the object hierarchy of the backing model available to an Asciidoctor template.

To use Pry, you first need to install it, either using `gem install`:

 $ gem install pry

or by adding it to your [.path]_Gemfile_ and running `bundle`.

In order to be dropped into the debugger at a specific point in a template, add the following two lines to the template you want to inspect:

.paragraph.html.slim
[,slim]
----
- require 'pry'
- binding.pry
----

When you run Asciidoctor, it will pause in the template and give you an interactive console.

[.output]
....
From: /path/to/templates/html5/paragraph.html.slim:7 self.__tilt_800:

    1: - require 'pry'
 => 2: - binding.pry

[1] pry(#<Asciidoctor::Block>)>
....

From there, you can inspect the objects in the backend model.

[.output]
 [1] pry(#<Asciidoctor::Block>)> attributes

You can also query Asciidoctor's API documentation:

[.output]
 [1] pry(#<Asciidoctor::Block>)> ? find_by

Type exit to leave the interactive console:

[.output]
 [1] pry(#<Asciidoctor::Block>)> exit

To learn more about what you can do with Pry, we recommend watching the http://vimeo.com/26391171[introductory screencast^].
Refer to the https://github.com/pry/pry/wiki[Pry wiki^] for details about how to use it.

== How to use templates

Now that you know what templates are and how to make them, let's look at how to use them in Asciidoctor.

=== Organize your templates

You should group templates for a specific backend together in a single folder.
In that folder, each template file should be named using the pattern `<context><output-ext><template-ext>`, where `context` is the name of a xref:#contexts-ref.adoc[convertible context], `output-ext` is the file extension of the output file, and `template-ext` is the file extension for the template language (e.g., [.path]_paragraph.html.slim_).
Those are the only requirement you have to follow in order for Asciidoctor to discover and load your templates.

If you're creating templates for multiple backends, you may decide to further group your templates in folders named after the backend (and perhaps even an additional folder for the template language, not shown here).

[listing]
----
📒 templates <1>
  📂 html5 <2>
    📄 paragraph.html.slim <3>
----
<1> The folder containing the templates for various backends.
<2> The folder containing the templates for the html5 backend.
<3> The converter template for paragraphs.

If you're only targeting a single backend, you can simply name the folder [.path]_templates_.

[listing]
----
📒 templates
  📄 paragraph.html.slim
----

Recall that the backend is a moniker for the expected output format, and in turn, the converter that produces it.

=== Install the template engine

To use converter templates, you must always install the *tilt* gem.
If you're using a template engine that has one or more required libraries, you must first install those libraries.
Once the library is installed, Asciidoctor will use Tilt to load it on demand.

TIP: If you write your templates in ERB, no additional libraries are required.

Let's assume you're writing your templates in Slim (which the template engine we most recommend).
You will need both the *tilt* and *slim* gems installed.

If you're using Bundler, you install gems first by declaring them in [.path]_Gemfile_.

.Gemfile
[,ruby]
----
gem 'tilt'
gem 'slim'
----

Then, you install the gems using Bundler:

 $ bundle

If you're not using Bundler, and you have configured Ruby to install gems in your user/home directory, then you can use the `gem` command instead:

 $ gem install tilt slim

Either way, the *tilt* and *slim* gems must be available on the load path when running Asciidoctor in order to use templates written in the Slim template language.

=== Apply your templates

Instructing Asciidoctor to apply your templates is the easiest part.
You only need to tell Asciidoctor where the templates are located and which template engine you're using.
(Technically, you don't need to specify the template engine.
But, by doing so, it makes the scan more efficient and deterministic.)

If you're using the CLI, you specify the template directory using the `-T` option (longhand: `--template-dir`) and the template engine using the `-E` option (longhand: `--template-engine`).

 $ asciidoctor -T /path/to/templates -E slim doc.adoc

If you're using the API, you specify the template directory (or directories) using the `:template_dirs` option and the template engine using the `:template_engine` option.

[,ruby]
----
Asciidoctor.convert_file 'doc.adoc', safe: :safe,
  template_dirs: ['/path/to/templates'], template_engine: 'slim'
----

Notice that we didn't specify the segment [.path]_html5_ in the path where the templates are located.
That's because Asciidoctor automatically looks for a folder that matches the backend name when scanning for templates (e.g., [.path]_/path/to/templates/html5_).
However, you can include the segment for the backend in the path if you prefer.

=== Use multiple template directories

You can distribute templates for a single backend across multiple directories.
For example, you may have a set of common templates for all projects (e.g., [.path]_/path/to/common-templates_) and a set of specialized templates that supplement and/or override those templates for a particular project (e.g., [.path]_/path/to/specialized-templates_).

To load templates from multiple directories when using the CLI, you can pass each directory to Asciidoctor by specifying the `-T` option multiple times:

 $ asciidoctor -T /path/to/common-templates -T /path/to/specialized-templates -E slim doc.adoc

When using the API, you add all the template directories to the array value of the `:template_dirs` option:

[,ruby]
----
Asciidoctor.convert_file 'doc.adoc', safe: :safe,
  template_dirs: ['/path/to/common-templates', '/path/to/specialized-templates'], template_engine: 'slim'
----

In both cases, if the same template is found in more than one location, the template discovered in the directory listed later in the list will be used.

== Tutorial: Your first converter template

This section provides a tutorial you can follow to quickly learn how to write and use your first converter template.
In this tutorial, you'll create a converter template to customize the HTML produced by the built-in HTML converter for unordered lists.
You'll compose the template in the Slim template language.
You'll then observe the result of this customization by using the template when converting the AsciiDoc document to HTML with Asciidoctor.

=== Add and install required gems

You first need to install the required libraries (i.e., gems) for the template engine.
Since you'll be using Slim, you need to install the *slim* gem.
You also need to install the *tilt* gem, which provides Tilt, the generic interface for Ruby template engines that Asciidoctor uses to load and invoke templates.
Although not required, Asciidoctor will prompt you to also install the *concurrent-ruby* gem to properly implement the template cache.

The preferred way of installing a gem is to add it to the [.path]_Gemfile_ in your project.

.Gemfile
[,ruby]
----
source 'https://rubygems.org'

gem 'asciidoctor'
# ...any other gems you are using
gem 'tilt'
gem 'slim'
gem 'concurrent-ruby'
----

Run Bundler to install the gems into your project.

 $ bundle

If you're not using Bundler, and you have configured Ruby to install gems in your user/home directory, then you can use the `gem` command instead:

 $ gem install tilt slim concurrent-ruby

Now that you've installed Tilt and the Slim template engine, you can get started writing templates.

=== Create templates folder

Next, create a new folder named [.path]_templates_ to store your templates.
We also recommend creating a nested folder named [.path]_html5_ to organize the templates by backend.

 $ mkdir -p templates/html5

You can further organize templates into folders by engine, though that's not required.

=== Compose a template

Let's compose the template to customize the HTML for unordered lists.
Since the context for unordered lists is `:ulist` (see xref:#contexts-ref.adoc[]), you'll name the template [.path]_ulist.html.slim_.

.ulist.html.slim
[,slim]
----
- if title?
  figure.list.unordered id=id
    figcaption=title
    ul class=[style, role]
      - items.each do |_item|
        li
          span.primary=_item.text
          - if _item.blocks?
            =_item.content
- else
  ul id=id class=[style, role]
    - items.each do |_item|
      li
        span.primary=_item.text
        - if _item.blocks?
          =_item.content
----

=== Apply the templates

The final step is to use the templates when you invoke Asciidoctor.
Create an AsciiDoc file named [.path]_doc.adoc_ that contains an unordered list.

.doc.adoc
[,asciidoc]
----
* cats
* dogs
* birds
----

You can now instruct Asciidoctor to convert this list using your template by passing the directory containing the templates using the `-T` option and the name of the template engine using the `-E` option.
If you used Bundler to install gems, run Asciidoctor as follows:

 $ bundle exec asciidoctor -T templates -E slim doc.adoc

Otherwise, you can drop the `bundle exec` prefix:

 $ asciidoctor -T templates -E slim doc.adoc

Now that you've created your first converter template, you're well on your way to customizing the HTML that Asciidoctor produces to suit your own needs!

=== A quick review

Here's a quick review for how to start using templates written in Slim to customize the output of the built-in HTML 5 converter.

. Install the `tilt`, `slim`, and `concurrent-ruby` gems using `bundle` or `gem install`.
. Create a folder named [.path]_templates/html5_ to store the templates.
. Create a template named [.path]_paragraph.html.slim_ in that folder.
. Populate the template with your own template logic.
Here's a simple example:
+
.paragraph.html.slim
[,slim]
----
p id=id role=role =content
----

. Load the templates using the -T flag from the CLI:

 $ bundle exec asciidoctor -T path/to/templates -E slim doc.adoc
+
or

 $ asciidoctor -T path/to/templates -E slim doc.adoc

TIP: When invoking Asciidoctor via the API, you load the templates by passing the path to the `:templates` option.

We hope you'll agree that using templates makes it easy to customize the output that Asciidoctor produces.

[[contexts-ref.adoc]]
{empty}

// /modules/convert/pages/contexts-ref.adoc
[[convert:contexts-ref.adoc]]
= Convertible Contexts

When Asciidoctor converts a document, it delegates to the converter to convert each node (block or inline element) in the document as it visits each node in document order (though it's the `#content` method on a block that continues the traversal of its child nodes).
Asciidoctor then combines the result of all those calls to produce the output document.

To convert a node, Asciidoctor calls the `convert` method on the converter and passes in the node.
In some cases, it also passes in an extra transform value (e.g., `embedded`) to differentiate between different uses cases for a node of the same context.
When Asciidoctor is using a converter that extends `Asciidoctor::Converter::Base`, the converter will delegate the call to a method whose name starts with `convert_` and is followed by the context of the node (e.g., `convert_paragraph`).

The following table lists the contexts for all the built-in nodes that Asciidoctor converts, along when the name of the method the base converter will look for.
Extensions can introduce additional contexts.

.The built-in contexts of nodes that are converted by the converter
|===
|Context           |Convert method on base converter

|:admonition       |convert_admonition
|:audio            |convert_audio
|:colist           |convert_colist
|:dlist            |convert_dlist
|:document         |convert_document
|:embedded         |convert_embedded
|:example          |convert_example
|:floating_title   |convert_floating_title
|:image            |convert_image
|:inline_anchor    |convert_inline_anchor
|:inline_break     |convert_inline_break
|:inline_button    |convert_inline_button
|:inline_callout   |convert_inline_callout
|:inline_footnote  |convert_inline_footnote
|:inline_image     |convert_inline_image
|:inline_indexterm |convert_inline_indexterm
|:inline_kbd       |convert_inline_kbd
|:inline_menu      |convert_inline_menu
|:inline_quoted    |convert_inline_quoted
|:listing          |convert_listing
|:literal          |convert_literal
|:olist            |convert_olist
|:open             |convert_open
|:outline          |convert_outline
|:page_break       |convert_page_break
|:paragraph        |convert_paragraph
|:preamble         |convert_preamble
|:quote            |convert_quote
|:section          |convert_section
|:sidebar          |convert_sidebar
|:stem             |convert_stem
|:table            |convert_table
|:thematic_break   |convert_thematic_break
|:toc              |convert_toc
|:ulist            |convert_ulist
|:verse            |convert_verse
|:video            |convert_video
|===

The converter is not called to handle nodes with the `:list_item` or `:table_cell` contexts.
Instead, it's up to the converter to access these nodes from the parent node and convert them directly.

When a method to convert a block is called, the inline markup has not yet been parsed.
That parsing and subsequent conversion happens when the `#content` method is called on the node.
This is also what triggers the processor to visit the child nodes of that block.

Some methods for converting blocks have to handle the specialized behavior as indicated by the style.
For example, the `convert_listing` method also handles source blocks (listing blocks with the source style).
And `convert_dlist` handles qanda lists (dlist blocks with the qanda style).

`:embedded` is not a true context, but rather a transform of the `:document` context.
It's convert method is called instead of the one for `:document` when the document is loaded in embedded mode (i.e., the `:standalone` option on the processor is `false`).

// /modules/html-backend/pages/index.adoc
[[html-backend:index.adoc]]
= Generate HTML from AsciiDoc
:navtitle: Generate HTML

Asciidoctor's default output format is HTML (specifically HTML 5).
That means when you run Asciidoctor without any parameters, it will produce HTML.
This page explains how to use Asciidoctor to convert AsciiDoc to HTML.

== Backend and converter

Asciidoctor's built-in HTML converter is registered for the `html` and `html5` backends.
The HTML converter generates HTML 5 that's styled with CSS3.
It may include JavaScript to support additional integrations, such as client-side syntax highlighting.

[horizontal]
Backend names:: `html`, `html5`
Converter class:: `Asciidoctor::Converter::Html5Converter`
Output format:: HTML
Output file extension:: .html

WARNING: A standalone HTML document generated by the built-in HTML converter loads web fonts from Google Fonts, which are then referenced by the default stylesheet.
The xref:#default-stylesheet.adoc[default stylesheet] makes use of web fonts to ensure the document renders consistently across platforms.
Concerns have been raised that Google Fonts do not comply with GDPR.
If this presents a problem, you can xref:#disable-or-modify-the-web-fonts[opt out of the use of Google Fonts].
When this is done, the default stylesheet reverts to using generic font families (e.g., sans-serif), which are mapped to system fonts by your browser.
The consequence is that the appearance of the document will be different and system dependent due to a reliance on system fonts.

If the backend name is prefixed with `x` (e.g., `xhtml`), the converter will <<xhtml,generate XHTML>>, the XML variant of HTML.

== Generate HTML

In this section, we'll create a sample document, then process and convert it with Asciidoctor's built-in HTML converter.

=== Create and save an AsciiDoc document

. To follow along with the steps below, use your own AsciiDoc file or copy the contents of <<ex-my-doc>> into a new plaintext file.
+
.my-document.adoc
[#ex-my-doc,asciidoc]
----
include::example$my-document.adoc[tags=title;body]
----

. Make sure to save the file with the _.adoc_ file extension.

=== Convert an AsciiDoc document to HTML

To convert [.path]_my-document.adoc_ to HTML from the command line:

. Open a terminal.
. Switch to the directory that contains the [.path]_my-document.adoc_ document
. Call the Asciidoctor processor with the `asciidoctor` command, followed by the name of the document.
+
--
 $ asciidoctor my-document.adoc

Remember, Asciidoctor's default converter is html5, so it isn't necessary to specify it with the `-b` command.
--

. You won't see any messages printed to the console.
Type `ls` to view the files in the directory or navigate to the directory in a file manager.
You should see a new file named [.path]_my-document.html_.
+
--
 $ ls
 my-document.adoc  my-document.html

Asciidoctor derives the name of the output document from the name of the input document.
--

. Open [.path]_my-document.html_ in your web browser.
Your document should look like the image below.
+
--
image::my-document.png[]

The document's text, titles, and link are styled by the default Asciidoctor stylesheet, which is embedded in the HTML output.
As a result, you could save [.path]_my-document.html_ to any computer and it will look the same.
--

. If you want to preview the HTML in the terminal, you can use this command instead:

 $ asciidoctor my-document.adoc -o - | w3m - -T text/html

[#xhtml]
== Generate XHTML

[horizontal]
Backend names:: `xhtml`, `xhtml5`
Converter class:: `Asciidoctor::Converter::Html5Converter`
Output format:: XML variant of HTML
Output file extension:: .html

.Produce XHTML using the xhtml5 backend option
 $ asciidoctor -b xhtml5 my-document.adoc

To produce XHTML instead of HTML when using converter templates, set the `htmlsyntax` attribute to `xml` in addition to the backend option:

.Produce XHTML using custom templates
 $ asciidoctor -T /path/to/templates -b slides -a htmlsyntax=xml my-document.adoc

.Black Box Decoded: XHTML and htmlsyntax
****
XHTML output is a special mode of the built-in HTML5 converter.
It is activated by prefixing the backend value with `x` (e.g., `xhtml` or `xhtml5`).
This hint implicitly assigns the `htmlsyntax` attribute to the value `xml`, which normally has the value `html`.

For all other converters, the `htmlsyntax` attribute is not set explicitly.
If you want a converter template that's written in Slim or Haml to output XHTML instead of the default HTML, you need to set the `htmlsyntax` attribute to `xml` explicitly.
Asciidoctor will pass on this preference to the Slim or Haml template engine by setting the `:format` option to `:html5`.
****

[[default-stylesheet.adoc]]
{empty}

// /modules/html-backend/pages/default-stylesheet.adoc
[[html-backend:default-stylesheet.adoc]]
= Default Stylesheet
:url-default-stylesheet: https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@{page-component-version}/data/stylesheets/asciidoctor-default.css
:url-default-stylesheet-source: https://github.com/asciidoctor/asciidoctor/blob/v{page-component-version}.x/src/stylesheets/asciidoctor.css

When you use the HTML converter to generate a standalone HTML document, Asciidoctor includes a default stylesheet to ensure the HTML looks presentable right out of the box.
This feature gets you up and running quickly by giving you a result you can preview or publish without having to do any additional work.

This page covers why the default is necessary, how to apply it, and how to build on it so you don't have to create a stylesheet from scratch.

NOTE: The default stylesheet that Asciidoctor provides is just that, _a default_.
If you prefer a different style, you can customize it, extend it, or replace it with an entirely different one.
When replacing the default stylesheet, it's important to understand that it does provide support for numerous features in AsciiDoc, as covered in the next section.
You'll need to include these required styles when developing your own stylesheet if you want these features to continue to work.

// TODO: we probably need a page to defines what styles any stylesheet must provide to be fully compatible with AsciiDoc
== Why provide a default?

Asciidoctor includes a default stylesheet to provide a nice out-of-the-box experience when generating HTML from AsciiDoc.
But there's more to it.
There are elements of AsciiDoc that require stylesheet support.

One example is to honor *built-in roles*, such as `text-center`.
In order for a role to take effect, it needs a companion CSS class in the stylesheet.
To satisfy the expectations of a built-in role, a stylesheet is required.

You may have noticed the floating anchors next to section titles when you hover over them.
Although the HTML to make them is there, it's the stylesheet that brings them to life.

Another example is to implement *list marker styles*.
AsciiDoc allows you to specify the marker for a list using a block style (e.g., `loweralpha`).
However, HTML does not apply these markers by default.
Rather, it's something that the stylesheet provides.

The default stylesheet also applies *borders and shading to table cells* to support all combinations of the frame, grid, and stripes attributes.

Yet another example is the *TOC position*.
To position the TOC on the left or right requires help from the stylesheet to change the layout of the page so the TOC appears as a sidebar.
It's the stylesheet that handles that task.

In order for the AsciiDoc experience to be complete when generating HTML, a stylesheet is required.
The default stylesheet not only completes this experience, but also serves as a reference for the styles a custom stylesheet must provide.

=== Web fonts

The default stylesheet ensures that the same fonts are selected across all platforms.

By default, the browser relies on system fonts.
But system fonts vary widely by platform, so users end up getting a very different experience.
That's where web fonts come in.

When the default stylesheet is used, the converter adds additional HTML to load open source fonts from Google Fonts.
The default stylesheet, in turn, specifies a preference for these fonts.

The web fonts used by the default stylesheet are as follows:

Noto Serif:: body text (default)
Open Sans:: headings
Droid Sans Mono:: monospaced phrases and verbatim blocks

Loading and preferring these web fonts ensures everyone sees the same result.

== Usage

When generating HTML, there's nothing special you need to do to apply the default stylesheet.
Asciidoctor automatically embeds the default stylesheet into the `<head>` of the generated HTML when you run the `asciidoctor` command.

 $ asciidoctor document.adoc

Since no stylesheet is specified, Asciidoctor uses the default stylesheet (which is located at [.path]_data/stylesheets/asciidoctor.css_ inside the installed gem).

When you view the generated HTML file, [.path]_document.html_, you'll see styled HTML, as shown here:

image::default-stylesheet.png[]

If you want Asciidoctor to generate HTML that links to the default stylesheet instead of embedding it in the HTML, you can instruct it to do so by setting the `linkcss` and `copycss` attributes as follows:

 $ asciidoctor -a linkcss -a copycss document.adoc

When using the API, Asciidoctor already links to the stylesheet by default instead of embedding it (due to the default safe mode).
However, Asciidoctor does not copy the stylesheet to the output directory.
You would have to put it there yourself.
Otherwise, the browser will not be able to find the stylesheet.

To solve this problem, set the safe mode to server or lower (e.g., server, safe, or unsafe) and Asciidoctor will embed the default stylesheet, like when using the `asciidoctor` command.

[,ruby]
----
require 'asciidoctor'

Asciidoctor.convert_file 'document.adoc', safe: :safe
----

== Disable or modify the web fonts

When the default stylesheet is used, the converter adds a `<link>` element specialized by the attribute `rel="stylesheet"` to load web fonts from Google Fonts.
You can disable this link by unsetting the `webfonts` document attribute from the CLI, API, or document header.

 $ asciidoctor -a webfonts! document.adoc

With the web fonts absent, the browser will drop back to the fallback system fonts specified in the stylesheet.
But this also provides an opportunity to use <<customize-docinfo,docinfo>> to load the web fonts from a different source.

Rather than disabling the link, you can also use the `webfonts` attribute to change which fonts are loaded.
When set, the value of the `webfonts` attribute is used as the value of the `family` query string parameter in the font-loader URL.

Let's say you want to use Ubuntu Mono instead of Droid Sans Mono for monospaced text.
You would set the `webfonts` attribute as follows:

 $ asciidoctor \
 -a webfonts="Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CUbuntu+Mono:400" \
 document.adoc

In this case, you would still need to use <<customize-docinfo,docinfo>> to instruct the stylesheet to use the new font.

== Customize the default stylesheet

What if the default stylesheet is not exactly to your liking, but you don't want to go off and create a custom stylesheet from scratch?
Can you customize it?
Indeed, you can.

There are at least two ways to customize the default stylesheet.
One way is to add auxiliary styles using docinfo.
Another way is to create a custom stylesheet, but import the default stylesheet as a starting point.

[#customize-docinfo]
=== Auxiliary styles with docinfo

Adding auxiliary styles is a great use case for xref:#ROOT:docinfo.adoc[docinfo].
The docinfo feature in AsciiDoc allows you to inject auxiliary content from a file into various places in the HTML output.
In this case, we're interested in the "head" position, which injects content at the bottom of the `<head>` element.

Let's say you want to change the color of headings (and other heading-like titles) to match the color of paragraph text.
Start by creating a file named [.path]_docinfo.html_ (head is the default location) and populate it with a `<style>` element with the necessary styles.

.docinfo.html
[,html]
----
<style>
h1, h2, h3, h4, h5, h6, #toctitle,
.sidebarblock > .content > .title {
  color: rgba(0, 0, 0, 0.8);
}
</style>
----

Now tell Asciidoctor to look for and load the docinfo file using the `docinfo` attribute:

 $ asciidoctor -a docinfo=shared document.adoc

The `<style>` element in your docinfo file will be inserted directly below the default stylesheet in the generated HTML.

[#customize-targets]
=== Make more elements addressable from CSS

If you want to style specific elements in your content, you need to make them addressable from CSS.
In other words, it must be possible to target them using a CSS selector.
There are two mechanisms in AsciiDoc that enable you to do this:

id:: You can add an ID to almost any element in AsciiDoc using the xref:#asciidoc:attributes:ids.adoc[ID attribute].
The ID attribute in AsciiDoc translates to the `id` attribute in HTML.
You can then target that element (and only that element) from CSS in order to modify its style using the syntax `#<id>`, where `<id>` is the value you specify.
Each ID can only be used once in a document.

role:: You can add a role to almost any element in AsciiDoc using the xref:#asciidoc:attributes:role.adoc[role attribute].
The role attribute in AsciiDoc translates to the `class` attribute in HTML.
You can then target that element (and any other elements that share the same role) from CSS in order to modify its style using the syntax `.<role>`, where `<role>` is the value you specify.
A role can be used many times in the document.
You can even target different elements that share the same role individually in the stylesheet by adding the element name (e.g., `span.appname`) or additional roles (e.g., `.varname.global`).

For any ID or role you introduce, you must provide custom styles for it in order for it to have any visual effect.

[#customize-extend]
=== Extend the default stylesheet

Instead of writing a custom stylesheet from scratch, you can import the default stylesheet and add overrides for any styles you want to change (leveraging the cascading nature of CSS).
This is also a good way to use the default stylesheet, but load web fonts from a different CDN.

Let's again change the color of headings (and other heading-like titles) to match the color of paragraph text.
Start by creating a stylesheet named [.path]_my-asciidoctor.css_.
Next, add an `@import` declaration to import the default stylesheet.
We use a CDN here to pull the default stylesheet directly out of the repository, but you can put it anywhere the browser can access it.
Then, add another `@import` declaration to import the web fonts the default stylesheet uses (which are not imported by the default stylesheet).
Finally, add your overrides below those `@import` directives.
Here's how that looks altogether.

[,css,subs=attributes+]
----
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "{url-default-stylesheet}";

h1, h2, h3, h4, h5, h6, #toctitle,
.sidebarblock > .content > .title {
  color: rgba(0, 0, 0, 0.8);
}
----

Now tell Asciidoctor to use your custom stylesheet instead of the default one:

 $ asciidoctor -a stylesheet=my-asciidoctor.css document.adoc

Asciidoctor will now embed the contents of your custom stylesheet instead of the default one.
However, Asciidoctor will not embed the contents of the default stylesheet.
Instead, the browser will fetch it from the location specified by the `@import` directive.
You can avoid this network call by putting the default stylesheet in the same directory as your custom stylesheet and linking to it using `@import "asciidoctor.css"`.

To obtain the compiled default stylesheet, you can either {url-default-stylesheet}[download it^] from the source repository, or you can use the following `asciidoctor` command (or equivalent) to write it to the current directory:

 $ echo | asciidoctor -o $TMPDIR/out.html -a linkcss -a copycss - && cp $TMPDIR/asciidoctor.css .

Alternately, you can use this script to write the default stylesheet to the working directory:

[,ruby]
----
require 'asciidoctor'

Asciidoctor::Stylesheets.instance.write_primary_stylesheet '.'
----

You can also download the {url-default-stylesheet-source}[source of the default stylesheet^] if you want to use it as a starting point for developing a custom stylesheet.

To learn more about how to apply a custom stylesheet, see xref:#custom-stylesheet.adoc[].

== Are there different themes?

The default stylesheet does not provide different themes.
You may be interested in trying the themes provided by the https://github.com/darshandsoni/asciidoctor-skins[Asciidoctor Skins^] project.
These stylesheets take the approach of loading the default stylesheet (from a CDN), then overlaying additional styles to produce a variety of themes.
You also have the option of downloading the {url-default-stylesheet-source}[source of the default stylesheet^] and customizing it to suit your needs.

CAUTION: The Asciidoctor Skins project is hosted outside of the Asciidoctor organization.
As such, it's not guaranteed to be compatible with the latest Asciidoctor release.
If there are problems with the stylesheets it provides, please report it to that project.

To learn how to apply a custom stylesheet, see xref:#custom-stylesheet.adoc[].

[[stylesheet-modes.adoc]]
{empty}

// /modules/html-backend/pages/stylesheet-modes.adoc
[[html-backend:stylesheet-modes.adoc]]
= Stylesheet Modes

//When applying a stylesheet to the generated HTML, you can configure the HTML converter to either embed the CSS directly into the HTML or link to the stylesheet file.
The HTML converter can be configured to embed the CSS of the stylesheet directly into the HTML, link to the stylesheet file, or disable it entirely.
These modes are available regardless of whether you're using the xref:#default-stylesheet.adoc[default stylesheet] or a xref:#custom-stylesheet.adoc[custom stylesheet].
This page covers the document attributes that control how the stylesheet is applied.

IMPORTANT: The HTML converter will only apply a stylesheet when generating a standalone HTML document.
That's because the stylesheet goes inside the HTML `<head>` element, and the converter only generates that element for standalone output.

[#embed]
== Embed the stylesheet

When the xref:#ROOT:safe-modes.adoc[safe mode] is server or lower, the default behavior of the HTML converter is to read the stylesheet file, enclose its contents in a `<style>` element, and embed it directly into the `<head>` element of the generated HTML.
This default makes the HTML more portable since you don't lose the stylesheet if you move the file.

However, if the safe mode is secure, the converter will <<link,link to the stylesheet file>> instead.
If you see a link to the stylesheet file in the generated HTML where you expect the stylesheet to be embedded, check your safe mode setting.

The same two rules apply regardless of whether you're using the default stylesheet or a custom stylesheet.

[#link]
== Link to the stylesheet

You already know that the HTML converter will link to the stylesheet when the safe mode is secure.
However, it's possible to enable this behavior independent of the safe mode.
This can be beneficial if you're converting numerous AsciiDoc documents to HTML and want them all to share the same stylesheet.
It can also make inspecting the HTML a little simpler.

If the `linkcss` document attribute is set, the converter will link to the stylesheet instead of embedding it.
To link to the stylesheet, the converter uses a `<link>` element specialized by the `rel="stylesheet"` attribute.
The `href` attribute will reference the stylesheet using a relative path.

The `linkcss` document attribute must be set by the end of the header to be effective.
One way to do that is to set the attribute in the document header:

.linkcss attribute set in document header
[,asciidoc]
----
include::example$my-document.adoc[tag=title]
:linkcss:
include::example$my-document.adoc[tag=body]
----

You can also set `linkcss` using the API or CLI (shown here):

 $ asciidoctor -a linkcss my-document.adoc

In either case, if you inspect the `<head>` element in the output file [.path]_my-document.html_, you'll see that the HTML links to the stylesheet.

.my-document.html
[,html]
----
<link rel="stylesheet" href="./asciidoctor.css">
----

Since we didn't specify a stylesheet, the converter links to the default stylesheet.
But where is this stylesheet located?
Let's find out.

[#copy]
== Copy the stylesheet to the output directory

If you're linking to a stylesheet file, the stylesheet file has to be available at the referenced path so the browser can access it.
For simple cases, Asciidoctor takes care of this for you.

If the safe mode is server or lower, and the `linkcss` document attribute is set, Asciidoctor will copy the stylesheet to the output directory so the HTML can link to it.
When using the default stylesheet, Asciidoctor writes the CSS to the file [.path]_asciidoctor.css_ in the output directory.
If you specify a custom stylesheet, Asciidoctor will copy that file instead, retaining the name of the file.
This utility works even if you specify an xref:#cli:output-file.adoc[output file in a different directory] from the source file.

.A shared responsibility
****
While the converter handles the task of embedding or linking to the stylesheet file, it's the processor itself (not the converter) that handles copying the stylesheet.
****

If the safe mode is secure, Asciidoctor will not copy the stylesheet file and, thus, the link to it will be broken (unless, of course, you copy the file separately).

Let's revisit the previous example:

 $ asciidoctor -a linkcss my-document.adoc

After running this command, the stylesheet file [.path]_asciidoctor.css_ is copied to the same directory as the generated HTML file [.path]_my-document.html_.
Type `ls` to view the files in the directory.
You should see a file named [.path]_asciidoctor.css_.

 $ ls
 asciidoctor.css  my-document.adoc  my-document.html

When you view the HTML file in your browser, you should observe that the default stylesheet is applied.

=== To copy or not to copy

Whether Asciidoctor copies the stylesheet to the output directory is controlled by the `copycss` document attribute.
The `copycss` attribute is set by default unless the safe mode is secure.

To prevent Asciidoctor from copying the stylesheet independent of safe mode, unset the `copycss` document attribute.

The `copycss` document attribute must be unset by the end of the header to be effective.
One way to do that is to unset the attribute in the document header:

.copycss attribute unset in document header
[,asciidoc]
----
include::example$my-document.adoc[tag=title]
:linkcss:
:!copycss:
include::example$my-document.adoc[tag=body]
----

You can also unset `copycss` using the API or CLI (shown here):

 $ asciidoctor -a linkcss -a copycss! my-document.adoc

In either case, if you inspect the output directory, you will see that the stylesheet file [.path]_asciidoctor.css_ is missing (unless it was already there).

We'll see the `copycss` attribute come up again on the xref:#custom-stylesheet.adoc[custom stylesheet page] as a means of xref:#copy-link-split[overriding the location of the stylesheet to copy].

[#disable]
== Disable the stylesheet

The stylesheet is effectively disabled when generating embedded HTML, since the embedded HTML does not include the `<head>` element.
If you don't want the converter to include a stylesheet in the standalone HTML, unset the `stylesheet` attribute using the CLI.

 $ asciidoctor -a stylesheet! my-document.adoc

The reason you have to unset the `stylesheet` attribute is because it is set by default (to an empty value).
When the `stylesheet` attribute is set, but empty, the HTML converter uses the default stylesheet.
By unsetting this attribute, we're telling the converter not to use a stylesheet at all.

When you view the generated HTML file, [.path]_my-document.html_, you'll see bare HTML without any styles applied, as shown here:

image::no-stylesheet.png[]

NOTE: When the `stylesheet` attribute is unset, the `linkcss` and `copycss` attributes are ignored.

Now that you have a clean slate, let's learn how to apply a custom stylesheet of your very own.

[[custom-stylesheet.adoc]]
{empty}

// /modules/html-backend/pages/custom-stylesheet.adoc
[[html-backend:custom-stylesheet.adoc]]
= Apply a Custom Stylesheet

So far we've talked about different ways of using the default stylesheet.
In place of the default stylesheet, you can instruct Asciidoctor to use a custom stylesheet of your choosing.
On this page, you'll learn how to apply a custom stylesheet and, if necessary, how to get Asciidoctor to copy and link to that stylesheet into the correct location.
You'll also learn about some of the limitations of this feature when processing multiple documents.

== Specify the custom stylesheet

Asciidoctor looks for the stylesheet file specified by the `stylesheet` document attribute.
If the value of this attribute is empty (the default), Asciidoctor uses the default stylesheet.
Otherwise, Asciidoctor assumes the value is the path of a custom stylesheet file relative to the source document.
All the same behavior described in xref:#stylesheet-modes.adoc[] still applies, except Asciidoctor uses the specified stylesheet instead of the default stylesheet.

To begin, you must create a stylesheet file.
For now, create this file adjacent to your AsciiDoc document.
To keep it simple, we'll just define a basic stylesheet that changes all text to red.
Create the file [.path]_my-stylesheet.css_ the directory with your AsciiDoc source files and populate it with the following contents:

.my-stylesheet.css
[,css]
----
body {
  color: #ff0000;
}
----

Now let's use the `stylesheet` attribute to apply it.

The `stylesheet` document attribute must be set by the end of the header to be effective.
One way to do that is to set the attribute in the document header:

.stylesheet attribute set in document header
[,asciidoc]
----
include::example$my-document.adoc[tag=title]
:stylesheet: my-stylesheet.css
include::example$my-document.adoc[tag=body]
----

You can also set `stylesheet` using the API or CLI (shown here):

 $ asciidoctor -a stylesheet=my-stylesheet.css my-document.adoc

When you view the generated HTML file [.path]_my-document.html_ in your browser, you'll see that all the text is red.

TIP: If you want to create a custom stylesheet by extending the default stylesheet, see xref:#customize-extend[Extend the default stylesheet].

As with the default stylesheet, you can set the `linkcss` document attribute and Asciidoctor will link to your stylesheet instead.
(Note that it doesn't copy it in this case since it's already in the same folder as the output file).

 $ asciidoctor -a stylesheet=my-stylesheet.css -a linkcss my-document.adoc

You may not want to keep your stylesheet in the same directory as your AsciiDoc documents.
Let's see how to tell Asciidoctor to look for it elsewhere.

== Configure the styles directory

When your stylesheet is in a directory below your AsciiDoc document, you need to tell Asciidoctor where to look to find the stylesheet.
There are two equivalent ways to do so:

* Specify the name of the stylesheet file using the `stylesheet` attribute and the directory where it's located using the `stylesdir` attribute
* Include the directory where the stylesheet is located in the value of the `stylesheet` attribute (instead of using the `stylesdir` attribute)

The value of the `stylesdir` attribute can end with a trailing directory separator (`/`), but it's not required.

If the `linkcss` attribute is not set, the styles directory can be either relative or absolute.
The situation gets trickier when `linkcss` is set, which we'll <<stylesdir-and-linkcss,get to later>>.

Let's assume you want to put your stylesheet in the [.path]_my-styles_ folder relative to your AsciiDoc document(s).
Go ahead and create that folder and move your custom stylesheet into it for this example.
Now we need to tell Asciidoctor where it's located using `stylesdir`.

The `stylesdir` document attribute must be set by the end of the header to be effective.
One way to do that is to set the attribute in the document header:

.stylesdir attribute set in document header
[,asciidoc]
----
include::example$my-document.adoc[tag=title]
:stylesheet: my-stylesheet.css
:stylesdir: my-styles
include::example$my-document.adoc[tag=body]
----

You can also set `stylesdir` using the API or CLI (shown here):

 $ asciidoctor -a stylesdir=my-styles -a stylesheet=my-stylesheet.css my-document.adoc

Asciidoctor now looks for the stylesheet file [.path]_my-styles/my-stylesheet.css_ relative to the AsciiDoc document and embeds it into the HTML.

You can achieve the same result by including the directory in the value of the `stylesheet` attribute:

 $ asciidoctor -a stylesheet=my-styles/my-stylesheet.css my-document.adoc

If you set the value of `stylesdir` to an absolute directory, then Asciidoctor would still locate the stylesheet and embed it into the HTML.
But this can create problems if you've configured the converter to link to the stylesheet instead.
Let's look at those problem and ways to work through them.

[#stylesdir-and-linkcss]
== Styles directory and linkcss

Using `stylesdir` gets tricky when you're linking to the stylesheet instead of embedding it.
That's because we're now dealing with two different paths.
One is the path where the stylesheet is located on disk (either absolute or relative to the document).
The other is the path the browser uses to access the stylesheet.

First, it's important to understand that Asciidoctor mirrors the `stylesdir` path in the link reference.
Let's use the previous example to demonstrate.
If you invoke Asciidoctor as follows:

 $ asciidoctor -a stylesdir=my-styles -a stylesheet=my-stylesheet.css -a linkcss my-document.adoc

Then when you inspect the HTML, you will see:

[,html]
----
<link rel="stylesheet" href="my-styles/asciidoctor.css">
----

Notice how the value of `stylesdir` ([.path]_my-styles_) is included in the referenced path.
Asciidoctor will also preserve this directory if it needs to copy the stylesheet file.

There are certain situations where this isn't going to work (at least not when publishing the file to the public internet).
Let's consider one such case.
We'll specify the location of `stylesdir` as an absolute path and generate the output file into a separate output directory.

 $ asciidoctor -a stylesdir=`pwd`/my-styles -a stylesheet=my-stylesheet.css -a linkcss -D public my-document.adoc

Asciidoctor generates the HTML file into the [.path]_public_ folder, but it does not copy the stylesheet.
Furthermore, it uses an absolute path in the link to the stylesheet:

[,html]
----
<link rel="stylesheet" href="/path/to/documents/my-styles/asciidoctor.css">
----

What we want is for Asciidoctor to copy the stylesheet to the output directory and link to it using a relative path.

A similar problem comes up if you want to control the styles directory and stylesheet file referenced by the HTML independently of the location where they are taken.

In brief, we need to be able to decouple the path where the stylesheet is read from the location where the stylesheet is published and referenced.
That's where the `copycss` attribute comes back into play.

[#copy-link-split]
== Copy from one place, link to another

For complex combinations that involve `stylesdir`, `linkcss`, and an explicit output directory, the meaning of `stylesdir` is too overloaded and needs to be reconciled.
We can turn to the `copycss` attribute to clear this situation up.

NOTE: This situation is unique to when `linkcss` is set.
It's not a problem when the converter embeds the stylesheet since there is no secondary reference involved.

The `copycss` attribute can accept a non-empty value.
Asciidoctor uses this value as an override for where to look for the stylesheet to read.
The converter, on the other hand, does not use this value.
That means we can use `stylesdir` and `stylesheet` to assemble the path relative to the output directory where Asciidoctor should write and link to the stylesheet independent of the location where it reads the file.

Let's revisit the broken scenario from the previous section and use `copycss` to reconcile the problem:

 $ asciidoctor -a stylesdir=css -a stylesheet=default.css \
 -a copycss=$PWD/my-styles/my-stylesheet.css -a linkcss -D public my-document.adoc

Asciidoctor copies the stylesheet from the absolute path specified by the `copycss` attribute to the path [.path]_public/css/default.css_ and links to it using the path [.path]_css/default.css_.
Notice that we changed the name of the folder and stylesheet file in the output.
That demonstrates that we have decoupled the path where the stylesheet is read from the location where the stylesheet is published and referenced.

TIP: When running on JRuby, you can point `copycss` to a classloader URI to load a stylesheet from a JAR file (e.g., `uri:classloader:/css/styles.css`).
However, the HTML cannot link to that location.
Therefore, you must use the `stylesheet` attribute (and optionally the `stylesdir`) to specify a filename or relative path where Asciidoctor will write the stylesheet.
The HTML will then be able to link to that destination.

== Styles directory and nested documents when linking

When xref:#cli:process-multiple-files.adoc[invoking Asciidoctor on a nested set of documents], it's currently not possible to specify a single relative path for the `stylesdir` attribute that works for all of the documents.
This is because the relative depth of the stylesheet's location differs for the documents in the subdirectories.
One way to solve this problem is to maintain the path to `stylesdir` in each document.

Let's say you have three AsciiDoc documents saved in the following directory structure:

....
/my-documents
  a.adoc
  b.adoc
  /my-nested-documents
    c.adoc
  /my-styles
....

For [.path]_a.adoc_ and [.path]_b.adoc_, set `stylesdir` to:

[,asciidoc]
----
:stylesdir: my-styles
----

For [.path]_c.adoc_, set `stylesdir` to:

[,asciidoc]
----
:stylesdir: ../my-styles
----

If you're serving your documents from a web server, you can solve this problem by providing an absolute path to the stylesheet.
You can also try to use the `copycss` per document to control where Asciidoctor looks for the stylesheet independent of where Asciidoctor copies it and the converter configured the HTML to reference it.

// /modules/html-backend/pages/source-highlighting-stylesheets.adoc
[[html-backend:source-highlighting-stylesheets.adoc]]
= Embed a CodeRay or Pygments Stylesheet

Asciidoctor can embed the stylesheet for the CodeRay or Pygments syntax highlighters.

== Requirements

First, make sure the appropriate library is installed on your system.
See xref:#syntax-highlighting:rouge.adoc[], xref:#syntax-highlighting:coderay.adoc[], or xref:#syntax-highlighting:pygments.adoc[] for installation instructions.
Next, set the xref:#asciidoc:verbatim:source-highlighter.adoc[source-highlighter attribute] and assign it the value that corresponds to the library you installed.

[#coderay]
== CodeRay

If the `source-highlighter` attribute is `coderay` and the `coderay-css` attribute is `class`, the CodeRay stylesheet is:

* _embedded_ by default
* _copied_ to the file [.path]_asciidoctor-coderay.css_ inside the `stylesdir` folder within the output directory if `linkcss` is set

[#pygments]
== Pygments

If the `source-highlighter` attribute is `pygments` and the `pygments-css` attribute is `class`, the Pygments stylesheet is:

* _embedded_ by default
* _copied_ to the file [.path]_asciidoctor-pygments.css_ inside the `stylesdir` folder within the output directory if `linkcss` is set

// /modules/html-backend/pages/manage-images.adoc
[[html-backend:manage-images.adoc]]
= Manage Images

Images are not embedded in the HTML output by default.
If you have image references in your document, you'll have to save the image files in the same directory as your converted document.

== Embed images with the data-uri attribute

As an alternative, you can embed the images directly into the document by setting the `data-uri` document attribute.

.data-uri attribute set in document header
[,asciidoc]
----
include::example$my-document.adoc[tag=title]
:imagesdir: my-images
:data-uri:
include::example$my-document.adoc[tags=body;image]
----

You can also set `data-uri` using the API or CLI (shown here):

 $ asciidoctor -a data-uri my-document.adoc

When you view the HTML file in your browser, you should see the image displayed in the page.

image::my-document-with-data-uri.png[]

== allow-uri-read attribute

If the target of one or more images in the document is a URI, you must also set the `allow-uri-read` attribute securely and run Asciidoctor in `SECURE` mode or less.

 $ asciidoctor -a data-uri -a allow-uri-read my-document.adoc

The same is true when converting the document to PDF using Asciidoctor PDF, regardless of whether the `data-uri` attribute is set since this behavior is implicit.

// /modules/html-backend/pages/local-font-awesome.adoc
[[html-backend:local-font-awesome.adoc]]
= Use Local Font Awesome

When font-based icons are enabled, the HTML converter configures the HTML document to retrieve the Font Awesome assets (CSS and fonts) from a CDN.
This default behavior provides a convenience for users who want the visual enhancement of font-based icons without having to do any extra steps.
There are valid concerns with linking directly to a CDN, especially one that's outside your organization.
Asciidoctor provides a way to point to a local copy of Font Awesome instead.

In this guide, we'll assume that you've already enabled font-based icons on your document (i.e., set the `icons` attribute in your document to the value `font`).

== Prepare the Font Awesome assets

The first thing you'll need to do is download a copy of https://fontawesome.com/v4/get-started/[Font Awesome].
The HTML converter currently integrates with Font Awesome 4, so make sure you're using that version.

Extract the zip file and arrange the Font Awesome assets into the location of the output file (i.e., the HTML file generated by Asciidoctor) as follows:

....
css/font-awesome.css
fonts/fontawesome-webfont.eot
fonts/fontawesome-webfont.svg
fonts/fontawesome-webfont.ttf
fonts/fontawesome-webfont.woff
fonts/fontawesome-webfont.woff2
....

It's important that these files are located in the same directory as the output file.
If that's the same directory where the AsciiDoc file is located, then you're already set.

== Switch to your local Font Awesome assets

Now that you've set up Font Awesome locally, you'll need to instruct Asciidoctor to use it instead of the one from the CDN.
The key attribute that controls this behavior is `iconfont-remote`.
But default, this attribute is set.
If you unset this attribute (e.g., `-a iconfont-remote!`), Asciidoctor will look for the Font Awesome stylesheet in the `stylesdir`.
We'll assume that you're setting the `stylesdir` attribute to the value `css`.
If you have a custom stylesheet, it should be located in that folder as well.

Here's what the call looks like with these attributes configured:

 $ asciidoctor -a stylesdir=css -a iconfont-remote! doc.adoc

This will configure the HTML to reference Font Awesome as follows:

[,html]
----
<link rel="stylesheet" href="css/font-awesome.css">
----

WARNING: The Font Awesome stylesheet assumes the fonts are located in a directory named [.path]_fonts_ adjacent to the directory containing the stylesheet (i.e., [.path]_../fonts_).
Therefore, if you don't set the `stylesdir` attribute, and you move [.path]_font-awesome.css_ to the directory containing the output file, the Font Awesome stylesheet will look in the wrong location for the fonts and the icons won't work.
To fix the problem, you can edit [.path]_font-awesome.css_ and adjust the path to the fonts (e.g., change the prefix to [.path]_fonts_ instead of [.path]_../fonts_).

If you rename the Font Awesome stylesheet to something other than [.path]_font-awesome.css_, you can tell the HTML converter which basename to use by setting the `iconfont-name` attribute.
Let's assume that you have set up your Font Awesome assets as follows:

....
css/fa.css
fonts/fontawesome-webfont.eot
fonts/fontawesome-webfont.svg
fonts/fontawesome-webfont.ttf
fonts/fontawesome-webfont.woff
fonts/fontawesome-webfont.woff2
....

You then pass the modified basename of the stylesheet using the following call:

 $ asciidoctor -a stylesdir=css -a iconfont-remote! -a iconfont-name=fa doc.adoc

If you want to change the name of the fonts directory, or you want to configure the Font Awesome stylesheet to only attempt to load one of the fonts, you'll need to modify the stylesheet directly.

TIP: You can use these same attributes to integrate a different icon font library, though it must work in the same way as Font Awesome.

// /modules/html-backend/pages/favicon.adoc
[[html-backend:favicon.adoc]]
= Add a Favicon

When using Asciidoctor to generate a standalone HTML document (i.e., the `standalone` option is `true`), you can instruct the processor to include a link to a favicon by setting the favicon attribute in the document header.

[,asciidoc]
----
= Document Title
:favicon:
----

By default, the processor will add a link reference of type "icon" that refers to a file named _favicon.ico_ (relative to the HTML document):

[,html]
----
<link rel="icon" type="image/x-icon" href="favicon.ico">
----

This reference gets added inside the HTML `<head>` element (which explains why this feature is not available when generating an embeddable HTML document).

To modify the name or location of the icon file, simply assign a value to the favicon attribute:

[,asciidoc]
----
= Document Title
:favicon: ./images/favicon/favicon.png
----

This will now produce the following HTML element:

[,html]
----
<link rel="icon" type="image/png" href="./images/favicon/favicon.png">
----

Notice the mimetype is automatically set based on the file extension of the image.

The value of the `iconsdir` attribute is not prepended to the favicon path as it is with icons in the content.
If you want this directory to be included in the favicon path, you must reference it explicitly:

[,asciidoc]
----
:favicon: {iconsdir}/favicon.png
----

TIP: If you're converting a set of AsciiDoc files in multiple directories for the purpose of making a website, and the favicon is located in a shared location, you'll likely want to use a forward slash (`/`) at the beginning of the favicon path.

If you're looking for more control over how the favicon is declared, you should use a xref:#head[head docinfo file].
Keep in mind that if you add an icon link in a head docinfo file and also set the favicon attribute, you'll end up with two icon links in the generated HTML document.

// /modules/html-backend/pages/verbatim-line-wrap.adoc
[[html-backend:verbatim-line-wrap.adoc]]
= Verbatim Block Line Wrapping

The default Asciidoctor stylesheet wraps long lines in verbatim blocks by applying the CSS `white-space: pre-wrap` and `word-wrap: break-word`.
The lines are wrapped at word boundaries, similar to how most text editors wrap lines.
This prevents horizontal scrolling which some users considered a greater readability problem than line wrapping.

However, this behavior is configurable because there are times when you don't want the lines in listing and literal blocks to wrap.

== Prevent line wrapping

There are two ways to prevent lines from wrapping so that horizontal scrolling is used instead:

* `nowrap` block option
* unset the `prewrap` document attribute (on by default)

You can use the `nowrap` option on literal or listing blocks to prevent lines from being wrapped in the HTML.

.Listing block with nowrap option syntax
[source,asciidoc]
....
include::example$wrap.adoc[tag=nowrap]
....

When the nowrap option is used, the `nowrap` class is added to the `<pre>` element.
This class changes the CSS to `white-space: pre` and `word-wrap: normal`.

.Result: Listing block with nowrap option applied
include::example$wrap.adoc[tag=nowrap]

To prevent lines from wrapping globally, unset the `prewrap` attribute on the document.

.Disable prewrap globally (thus, enabling nowrap)
[,asciidoc]
----
:prewrap!:
----

When the prewrap attribute is unset, the `nowrap` class is added to any `<pre>` elements.

Now, you can use the line wrapping strategy that works best for you and your readers.

// /modules/html-backend/pages/skip-front-matter.adoc
[[html-backend:skip-front-matter.adoc]]
= Skip Front Matter

== Front matter for static site generators

Many static site generators (i.e., Jekyll, Middleman) rely on [.term]*front matter* added to the top of the document to determine how to convert the content.
Front matter typically starts on the first line of a file and is bounded by block delimiters (e.g., `+---+`).

Here's an example of a document that contains front matter:

[,asciidoc]
----
---  <.>
layout: default <.>
---  <.>
= Document Title

content
----
<.> Front matter opening delimiter
<.> Front matter data
<.> Front matter closing delimiter

The static site generator removes these lines before passing the document to the AsciiDoc processor to be converted.
Outside of the tool, however, these extra lines can throw off the processor.

== skip-front-matter attribute

If the `skip-front-matter` attribute is set via the API or CLI (e.g., `-a skip-front-matter`), Asciidoctor will recognize the front matter and consume it before parsing the document.
Asciidoctor stores the content it extracts in the `front-matter` attribute to make it available for integrations.
Asciidoctor also removes front matter when reading xref:#asciidoc:directives:include.adoc[include files].

// /modules/ROOT/pages/docinfo.adoc
[[ROOT:docinfo.adoc]]
= Docinfo Files
:page-location: asciidoc:docinfo:index.adoc

Relocated to xref:#{page-location}[].

// /modules/docbook-backend/pages/index.adoc
[[docbook-backend:index.adoc]]
= Generate DocBook from AsciiDoc
:navtitle: Generate DocBook
:url-docbook45: https://github.com/asciidoctor/asciidoctor-docbook45
:url-yelp: https://wiki.gnome.org/action/show/Apps/Yelp

Asciidoctor can produce the DocBook 5 XML output format from an AsciiDoc document.
Although DocBook XML is not a publishable format, it can be used to tie into an existing publishing toolchain that processes DocBook.
This page explains how to use Asciidoctor to convert AsciiDoc to DocBook.

== Backend and converter

Asciidoctor's built-in DocBook converter is registered for the `docbook` and `docbook5` backends.
The DocBook converter generates XML that adheres to the DocBook XML schema.
There's a corresponding DocBook tag for each AsciiDoc element.

[horizontal]
Backend names:: `docbook`, `docbook5`
Converter class:: `Asciidoctor::Converter::DocBook5Converter`
Output format:: XML
Output file extension:: .xml

== Generate DocBook

. To follow along with the steps below, use your own AsciiDoc file or copy the contents of <<ex-my-doc>> into a new plain text file.
+
.my-document.adoc
[#ex-my-doc,asciidoc]
----
include::html-backend:example$my-document.adoc[tags=title;body]
----

. Make sure to save the file with the _.adoc_ file extension.

. To convert the [.path]_my-document.adoc_ document to DocBook 5.0 format, call the processor with the backend flag set to `docbook`.

 $ asciidoctor -b docbook my-document.adoc

. A new XML document, named [.path]_my-document.xml_, will now be present in the current directory.
+
--
 $ ls
 my-document.adoc  my-document.xml

Here's a snippet of the XML generated by the DocBook converter.

.XML generated from AsciiDoc
[,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<?asciidoc-toc?>
<?asciidoc-numbered?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
<info>
<title>The Dangers of Wolpertingers</title>
<date>2020-12-08</date>
</info>
<simpara>Don&#8217;t worry about gumberoos or splintercats.
Something far more fearsome plagues the days, nights, and inbetweens.
Wolpertingers.</simpara>
<section xml:id="_origins">
<title>Origins</title>
<simpara>Wolpertingers are <link xl:href="https://en.wikipedia.org/wiki/Wolpertinger">ravenous beasts</link>.</simpara>
</section>
</article>
----
--

. On Linux, you can view the DocBook file with {url-yelp}[Yelp^].
+
 $ yelp my-document.xml

The DocBook converter produces output that is compliant to the DocBook 5.0 specification.

A summary of the differences are as follows:

* XSD declarations are used on the document root instead of a DTD
* `<info>` elements for document info instead of `<articleinfo>` and `<bookinfo>`
* elements that hold the author's name are wrapped in a `<personname>` element
* the id for an element is defined using an `xml:id` attribute
* `<link>` is used for links instead of `<ulink>`
* the URL for a link is defined using the `xl:href` attribute

If you're using the Asciidoctor API, you can generate a DocBook document directly from your application.

.Generate DocBook output from the API
[,ruby]
----
Asciidoctor.convert_file 'my-document.adoc', backend: 'docbook'
----

If you need to output DocBook 4.5, you may find the community-supported {url-docbook45}[DocBook 4.5 Converter^] useful.

== Convert DocBook to PDF

Although the Asciidoctor project provides xref:#pdf-converter::index.adoc[Asciidoctor PDF] for performing direct AsciiDoc to PDF conversion, you may opt instead to convert to PDF via DocBook.
The DocBook to PDF conversion is handled by the DocBook toolchain.

The DocBook toolchain can prove to be a challenge to set up.
This section provides several suggestions for how to use the DocBook toolchain, though this list is by no means exhaustive.
If you already have a working DocBook toolchain, then these instructions are not for you.

=== xmlto

If you're using a Linux distribution, the *xmlto* package might be an option for you.
https://pagure.io/xmlto[xmlto] is a simple shell script for converting XML files to various formats using the DocBook toolchain.
Among those formats supported is DocBook as an input format and PDF as an output format.

To install xmlto, look for the package by the same name and use your package manager to install it (e.g., `dnf install xmlto fop` or `apt-get install xmlto fop`).
Once you have installed the package, you can use it to generate PDF from DocBook with Apache FOP as follows:

 $ xmlto --skip-validation --with-fop pdf doc.xml

If you're using an RPM-based Linux distribution, you may be able to use the dblatex backend to generate the PDF instead:

 $ xmlto --skip-validation pdf doc.xml

The AsciiDoc processor adds several XML processing instructions to support features not provided by DocBook, such as a thematic break and a page break.
When using the Apache FOP backend, you need to provide an XSL stylesheet fragment that modifies the default XSL stylesheet to support these processing instructions.
You can also use this stylesheet as an opportunity to customize the PDF that Apache FOP produces.

Here's an example of an XSL stylesheet fragment to get you started:

.custom.xsl
[,xml]
----
<?xml version="1.0"?>
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:fo="http://www.w3.org/1999/XSL/Format">
  <xsl:param name="hyphenate">false</xsl:param>
  <xsl:param name="runinhead.default.title.end.punct"/>
  <xsl:param name="generate.toc">
    <xsl:choose>
      <xsl:when test="/processing-instruction('asciidoc-toc')">
article toc,title
book toc,title,figure,table,example,equation
      </xsl:when>
      <xsl:otherwise>
article nop
book nop
      </xsl:otherwise>
    </xsl:choose>
  </xsl:param>
  <xsl:param name="section.autolabel">
    <xsl:choose>
      <xsl:when test="/processing-instruction('asciidoc-numbered')">1</xsl:when>
      <xsl:otherwise>0</xsl:otherwise>
    </xsl:choose>
  </xsl:param>
  <xsl:template match="processing-instruction('asciidoc-br')">
    <fo:block/>
  </xsl:template>
  <xsl:template match="processing-instruction('asciidoc-hr')">
    <fo:block space-after="1em">
      <fo:leader leader-pattern="rule" rule-thickness="0.5pt" rule-style="solid" leader-length.minimum="100%"/>
    </fo:block>
  </xsl:template>
  <xsl:template match="processing-instruction('asciidoc-pagebreak')">
     <fo:block break-after='page'/>
  </xsl:template>
</xsl:stylesheet>
----

Pass this stylesheet to xmlto as follows:

 $ xmlto --skip-validation --with-fop -m custom.xsl pdf doc.xml

To get more ideas of how to customize the stylesheet, refer to XSL stylesheet from the https://github.com/asciidoctor/asciidoctor-fopub/blob/main/src/dist/docbook-xsl/fo-pdf.xsl[fopub] project.

=== fopub

A similar alternative to xmlto is https://github.com/asciidoctor/asciidoctor-fopub[fopub].
fopub uses Java and the Gradle build tool to wrap the DocBook toolchain.
The only prerequisite to perform the DocBook to PDF conversion using fopub is a Java Development Kit (JDK), which provides the Java runtime.

WARNING: Please note that the fopub project is archived.
However, it still may prove useful.

To get fopub, you must clone the repository.
Once you have done so, you can run the `fopub` script in that repository to convert a DocBook file to PDF.

 $ ./fopub README.xml

The benefit of fopub is that it's preconfigured to convert DocBook with AsciiDoc processing instructions.
The stylesheet it provides also smooths out some of the rough edges of the visual styling provided by the DocBook toolchain.
However, the project is no longer actively maintained, so keep that in mind when deciding whether to use it.
As an alternative, you may give https://github.com/aanno/db-toolchain[db-toolchain], which positions itself as a successor to fopub (albeit more complex).

=== Maven plugins

If you are using Maven to build your docs, then you might consider using either the docbkx plugin to generate PDF from DocBook.
You can find an example projects in the Asciidoctor Maven example repository:

* https://github.com/asciidoctor/asciidoctor-maven-examples/tree/main/docbook-pipeline-docbkx-example[docbkx]

The typical way to use these plugins is in a processing pipeline starting with the xref:#maven-tools::index.adoc[Asciidoctor Maven plugin].
The Asciidoctor Maven plugin uses Asciidoctor to generate the DocBook file(s).

// /modules/manpage-backend/pages/index.adoc
[[manpage-backend:index.adoc]]
= Generate Manual Pages from AsciiDoc
:navtitle: Generate Manual Pages
:url-man-page: https://en.wikipedia.org/wiki/Man_page
:url-man-7: https://man7.org/linux/man-pages/man7/roff.7.html
:url-docbook-refmisc: https://tdg.docbook.org/tdg/5.0/refmiscinfo.html
:url-asciidoctor-1-raw: https://raw.githubusercontent.com/asciidoctor/asciidoctor/v{release-version}/man/asciidoctor.adoc
:url-git-man: https://github.com/git/git/tree/master/Documentation

The AsciiDoc language defines a doctype named `manpage` for composing manual pages (man pages) in AsciiDoc.
Asciidoctor provides a converter for converting this AsciiDoc structure into a groff-formatted man page.
This page introduces **man**ual pages, examines the AsciiDoc structure of a man page, and shows how to convert an AsciiDoc document to groff-formatted man page and other formats using Asciidoctor.

== What's a manual page?

A {url-man-page}[manual page^], abbreviated as [.term]_man page_, is a form of software documentation that typically accompanies software on Unix-like operating systems.
Its formalized structure allows the `man` command to present the man page as a formatted document in a terminal pager, such as `less`.

The benefit of composing a man page in AsciiDoc is that you can convert it to multiple formats, including HTML and PDF.
That makes the source of the man page reusable.

[#doctype]
== manpage doctype

The `manpage` doctype declares that the AsciiDoc structure serves as the source of a man page and conforms to the man page structure.
Note the absence of the space in the doctype value.

By declaring the `manpage` doctype, the AsciiDoc processor expects the document to conform to the following structure.

Document Header::
In a man page, the document header is mandatory.
The doctitle consists of the program name followed by the volume number in round brackets (e.g., `progname(1)`).
The doctitle must not contain spaces.
The volume number is a single digit optionally followed by a single character.

Document Attributes::
There are several built-in document attributes that impact how the source is parsed and converted when the `manpage` doctype is in use.
Refer to the <<document-attributes>> section.

The NAME Section::
The first section is mandatory, must be titled "`Name`" (or "`NAME`"), and must contain a single paragraph (usually a single line) consisting of a list of one or more comma-separated command name(s) separated from the command's purpose by a dash character (e.g., `progname - does stuff` or `name1, name2 - does stuff`).
The dash must have at least one space character on either side.
If multiple names are given, Asciidoctor will generate alias files for the secondary names that point to the primary name.

The SYNOPSIS Section::
The second section is recommended and, if present, must be titled "`Synopsis`" (or "`SYNOPSIS`").

Subsequent sections are optional, but typical sections include "`Description`", "`Options`", "`Bugs`", "`See Also`", "`Copyright`", and "`Author`".
You can write the section titles in all uppercase, but it's better to let the man page converter handle that for you.
See <<generate>> for details.

TIP: Since the structure required by the `manpage` doctype is standard AsciiDoc, you can opt to declare the `manpage` doctype at runtime.
When the `doctype` attribute is not set, Asciidoctor will parse the document as an article and not give it any special treatment.

Here's an example man page composed in AsciiDoc for the `eve` command.
Observe that it declares the `manpage` doctype and conforms to the described structure.

.progname.adoc
[,asciidoc]
----
include::example$manpage.adoc[]
----

Although the source document is named [.path]_progname.adoc_, you can name the file whatever you like.
The output filename is determined by the `manname` and `manvolnum` attributes implicitly defined by the doctitle.
In this example, the output filename is [.path]_eve.1_.

== Backend and converter

Asciidoctor provides a built-in converter to generate {url-man-7}[groff-formatted^] man pages for AsciiDoc documents that declare the `manpage` doctype and conform to it.
Asciidoctor's own man page (i.e., `man asciidoctor`) is generated using this converter from {url-asciidoctor-1-raw}[this AsciiDoc source].

The man page converter is bound to the `manpage` backend (not to be confused with the `manpage` doctype).
Note the absence of the space in the backend value.

[horizontal]
Backend name:: `manpage`
Converter class:: `Asciidoctor::Converter::ManpageConverter`
Output format:: groff
Output file extension:: .\{manvolnum} (e.g., .1)

[#generate]
== Generate a man page

First, ensure your source document conforms to the <<doctype,manpage doctype structure>> and the `doctype` attribute is set to the value `manpage`.
Then, to activate the man page converter, you must assign `manpage` to the `backend` option.
Doing so will instruct the processor to use the man page converter to convert the document.

For the purpose of this example, we'll assue that the doctitle in [.path]_progname.adoc_ is `progname(1)`, where `progname` is the name of the command and `1` is the volume number.
Based on this information, the man page converter will set the output file name to [.path]_progname.1_.

To generate a man page, run:

 $ asciidoctor -b manpage progname.adoc

You can then view the resulting man page using the `man` command:

 $ man ./progname.1

When converting to the man page format, Asciidoctor uppercases the titles of all level-0 and level-1 sections.
This transformation is applied to conform to the widely adopted convention used by most man pages found on *nix systems.
By applying this transform in the converter, it saves you from having to type section titles in all uppercase in the source document.
It also makes the document portable to other output formats since this style is only needed for the man page output.
If the titles are uppercased in the source, that casing ends up getting used in all output formats.

CAUTION: Prior to Ruby 2.4, Ruby could only uppercase Latin letters.
If you're using Ruby 2.4 or greater, Asciidoctor will uppercase any letter in the title that's recognized by the Unicode specification as having an uppercase equivalent, which extends beyond Latin letters.

Recall that you're not limited to using the man page converter to convert an AsciiDoc document that uses the `manpage` doctype.
You can just as well convert it to HTML, as shown here.

 $ asciidoctor progname.adoc

The structure of the source document is still enforced, but the output document will look like the output of any other AsciiDoc document.

== Repurpose a man page

You may have a man page that you want to repurpose for documenting equivalent commands (but not aliases).
You can do so by supplying an alternate man title, name, and/or purpose when converting the document.

If you want to change `mantitle` and `manvolnum` attributes, you must override the `doctitle` attribute when invoking Asciidoctor.

 $ asciidoctor -b manpage -a doctitle="othername(7)" progname.adoc

This command sets the `mantitle` to "`othername`", the `manvolnum` to "`7`", and generates the file [.path]_progname.7_.
However, the `mantitle` is only used in the hidden info section at the top of the man page.
What you probably want to do is change the `manname` too, which is the name used in the header, the Name section, and the output filename.

One way to change the `manname` is to set both the `manname` and `manpurpose` attributes when calling Asciidoctor.
But first, you need to hide the default Name section in this case so you don't end up with two Name sections.

[,asciidoc]
----
\ifndef::manname,manpurpose[]
== Name

progname - description of progname
\endif::[]
----

Now, you can replace the information in the Name section when calling Asciidoctor:

 $ asciidoctor -b manpage \
   -a doctitle="othername(7)" \
   -a manname=othername \
   -a manpurpose="description of othername" \
   progname.adoc

This command generates the file [.path]_othername.7_.

If you only want to override the `manname` attribute and not the `manpurpose` attribute, reconfigure the Name section as shown in the next example.

[,asciidoc]
----
\ifndef::manname[:manname: progname]

== Name

{manname} - description of progname
----

Now, you can override the `manname` attribute without having to override the `manpurpose` attribute.

 $ asciidoctor -b manpage \
   -a doctitle="othername(7)" \
   -a manname=othername \
   progname.adoc

It's important to remember that Asciidoctor derives the `manname` and `manpurpose` attributes from the Name section by default.
That's why it's not enough just to override the attributes when calling Asciidoctor.

However, if you want to make a well-formed man page from a document that doesn't have a Name section, you can effectively insert one by setting the `manname` and `manpurpose` attributes from the CLI:

 $ asciidoctor -b manpage \
   -a doctitle="README(1)" \
   -a doctype=manpage \
   -a manname=README \
   -a manpurpose="Information about this project" \
   README.adoc

You can now view the README as a man page using the `man` command:

 man ./README.1

Just remember that a well-formed man page requires both a name and a purpose.

== Convert the man page to PostScript / PDF

Once you have created a man page, you can convert it to PostScript using the `man` command.

Let's assume that the output file produced by the Asciidoctor man page converter is `progname.1`, where `progname` is the name of the command and `1` is the volume number.
You can convert `progname.1` to PostScript and redirect the output to `progname.ps` using the following `man` command:

 $ man -t ./progname.1 > progname.ps

Alternately, you can redirect the output of the `man` command to `ps2pdf` to further convert it to PDF:

 $ man -t ./progname.1 | ps2pdf - progname.pdf

Let's now convert the example from earlier to PDF in this way:

 $ man -t ./eve.1 | ps2pdf - eve.pdf

Using the same sequence of commands, you can convert Asciidoctor's own man page to PDF:

 $ asciidoctor -h manpage | man -t -l - | ps2pdf - asciidoctor.pdf

In this case, the `-l -` reads the man page content generated by the help mode of the `asciidoctor` command.

Keep in mind that the files in this section are not generated using Asciidoctor.
If you want to generate PDF files directly from Asciidoctor, you may be interested in checking out https://github.com/asciidoctor/asciidoctor-pdf[Asciidoctor PDF^].
Another approach is to convert the AsciiDoc document to DocBook using the built-in DocBook converter (e.g., `-b docbook`), then convert that document to PDF using the DocBook toolchain.

[#document-attributes]
== Document attributes

Several built-in document attributes only affect the `manpage` doctype and output.
These attributes (or the attributes from which they are derived) must be set in the document header.

.Built-in document attributes for man pages
[%autowidth]
|===
|Attribute |Description |Value (as parsed from example above)

|`mantitle`
|Can be set by overriding the `doctitle` attribute.
Must include both the man page name and volume number.
|ASCIIDOCTOR(1)

|`manvolnum`
|Can be set by overriding the `doctitle` attribute.
Must include both the man page name and volume number.
|ASCIIDOCTOR(1)

|`manname`
|Alternative way to set the command name.
Only used if `manpurpose` is also set.
|asciidoctor

|`manpurpose`
|Alternative way to set the command purpose.
|converts AsciiDoc source files

|`man-linkstyle`
|Style the links in the man page output.
A valid link format sequence.
// Needs a reference to this.
|[.pre-wrap]#blue R < >#

|`mansource`
|The source to which the man page pertains.
When producing DocBook, it becomes a DocBook {url-docbook-refmisc}[refmiscinfo^] attribute and appears in the footer.
|Asciidoctor

|`manversion`
|The version of the man page.
Defaults to revnumber if not specified.
When producing DocBook, it becomes a DocBook {url-docbook-refmisc}[refmiscinfo^] attribute and appears in the footer.
Not used by Asciidoctor.
|{release-version}

|`manmanual`
|Manual name.
When producing DocBook, it becomes a DocBook {url-docbook-refmisc}[refmiscinfo^] attribute and appears in the footer.
|Asciidoctor Manual
|===

== See also

Refer to the {url-asciidoctor-1-raw}[AsciiDoc source of the Asciidoctor man page^] to see a complete example.
The man page for Asciidoctor is produced using the man page converter.
The {url-git-man}[man pages for git] are also produced from AsciiDoc documents, so you can use those as another example to follow.

// /modules/cli/pages/index.adoc
[[cli:index.adoc]]
= Process AsciiDoc Using the CLI

////
command-line-usage.adoc
Command line usage quick start for Asciidoctor
included in the install-toolchain and user-manual documents
////

When the Asciidoctor gem is installed successfully, the Asciidoctor command line interface (CLI) named `asciidoctor` will be available on your PATH.

== Version and runtime

To confirm that the CLI is available, execute the following command in your terminal application:

 $ asciidoctor --version

If this command completes successfully, information about Asciidoctor and the runtime environment will be printed to the standard output of your terminal:

[subs=attributes+]
 Asciidoctor {release-version} [https://asciidoctor.org]
 Runtime Environment ({ruby-description}) (lc:UTF-8 fs:UTF-8 in:UTF-8 ex:UTF-8)

The runtime environment information varies based on the version of Ruby you're using and the encoding settings of your operating system.

== Convert an AsciiDoc file

To invoke Asciidoctor from the CLI and convert an `.adoc` file, execute:

 $ asciidoctor <asciidoc-file>

This will use the built-in defaults for options and create a new file in the same directory as the input file, with the same base name, but with the `.html` extension.

xref:#options[CLI Options] describes the available options and parameters for the Asciidoctor CLI.

== Help topics

The `--help` option provides self-describing documentation for the `asciidoctor` command, grouped by topic.
If you don't specify a topic, the `--help` option prints the usage statement for the `asciidoctor` command:

 $ asciidoctor --help

You can generate the full documentation (i.e., man page) for the `asciidoctor` command by passing the `manpage` topic to the `--help` option.
You can pipe that output to the `man` pager to view it:

 $ asciidoctor --help manpage | man -l -

You can also find the man page for the `asciidoctor` command rendered as HTML in this documentation, which you can view in a browser instead.
See xref:#man1/asciidoctor.adoc[asciidoctor(1)].

You can print an AsciiDoc syntax crib sheet by passing the `syntax` topic to the `--help` option.

 $ asciidoctor --help syntax

The crib sheet itself is composed in AsciiDoc.
You can convert it to HTML by piping the output back into the `asciidoctor` command.

 $ asciidoctor --help syntax | asciidoctor -o syntax.html -

Navigate to the [.path]_syntax.html_ file in your browser to see what the examples in the crib sheet look like when converted to HTML.

// /modules/cli/pages/output-file.adoc
[[cli:output-file.adoc]]
= Specify an Output File
// Included in user-manual: Specifying an output file

By default, the Asciidoctor CLI writes the converted output file to the same directory as the input file.
If an output file is not specified, the name of the output file is derived from the input file by replacing its file extension with the file extension that matches the output format (e.g., replacing .adoc with .html).

You can instruct the Asciidoctor CLI to write content to a different output file (or directory).
There are several circumstances when you'll want to specify a different output file:

* You want to write the output file to a different name, perhaps to append a qualifier such as a version string.
* You want to write the output file to a different directory.
* You are piping content to the CLI, but want to write the output to a file (in this case, an output file is required).

CAUTION: If you specify the output file as a relative path, it will be resolved relative to the current working directory instead of the directory of the input file (i.e., specifying the output file implicitly sets the output directory too).

To specify the output file, you'll use the `-o` option.
For example, let's say we want to convert [.path]_mydoc.adoc_ and write the output to a filename that includes the current date.
You'd use:

 $ asciidoctor -o mydoc-$(date +%Y-%m-%d).html mydoc.adoc

We could write it to another folder as well by prefixing the output file with a folder name:

 $ asciidoctor -o build/mydoc-$(date +%Y-%m-%d).html mydoc.adoc

If you only want to specify the output directory, but let the filename be defaulted, use the `-D` option:

 $ asciidoctor -D build mydoc.adoc

The `-D` option can also be used when processing multiple input files:

 $ asciidoctor -D build *.adoc

If you are piping content to the CLI, the default is to write the output to STDOUT.
If you want to write the output to a file in this case, you have to specify one:

 $ cat mydoc.adoc | asciidoctor -o build/mydoc-$(date +%Y-%m-%d).html -

See xref:#io-piping.adoc[] to learn more.

// /modules/cli/pages/process-multiple-files.adoc
[[cli:process-multiple-files.adoc]]
= Process Multiple Source Files

The Asciidoctor CLI can convert multiple files in a single invocation.
If you pass multiple source filenames or a filename pattern to the CLI, Asciidoctor will convert each file in turn.

Let's assume there exist two AsciiDoc files in the current directory, [.path]_a.adoc_ and [.path]_b.adoc_.
You can pass both files to Asciidoctor using a single command, as follows:

 $ asciidoctor a.adoc b.adoc

Asciidoctor will convert both files, transforming [.path]_a.adoc_ to [.path]_a.html_ and [.path]_b.adoc_ to [.path]_b.html_.

To save some typing, you can use the glob operator (`+*+`) to match all AsciiDoc files in the current directory using a single argument:

 $ asciidoctor *.adoc

Your shell will automatically expand the pattern and interpret the command exactly as you had typed it above:

 $ asciidoctor a.adoc b.adoc

You can pass all AsciiDoc files inside direct subfolders using the glob operator (`+*+`) in place of the directory name:

 $ asciidoctor */*.adoc

To match all files in the current directory and direct subfolders, combine both glob patterns:

 $ asciidoctor *.adoc */*.adoc

Since the globs in this command rely on shell expansion, the command is not portable across platforms.
To make it portable, you can allow the Asciidoctor CLI to expand the globs.
To do so, instruct the shell to not expand the glob by quoting the pattern, as shown here:

 $ asciidoctor '*.adoc' '*/*.adoc'

This time, the arguments `+*.adoc+` and `+*/*.adoc+` are passed directly to Asciidoctor instead of being expanded.
Asciidoctor handles the glob matching in a manner that is portable across platforms.

But it gets better.
The glob handling in Asciidoctor (which matches the rules of file globbing in Ruby) is likely more powerful than what your shell offers.
For example, you can match AsciiDoc files in the current folder and in folders of any depth using the double glob operator (`+**+`).

 $ asciidoctor '**/*.adoc'

Most shells do not honor this double glob pattern.

In conclusion, when specifying a glob pattern, we always recommend enclosing the argument in quotes.

[[io-piping.adoc]]
{empty}

// /modules/cli/pages/io-piping.adoc
[[cli:io-piping.adoc]]
= Pipe Content Through the CLI

In addition to converting files, the Asciidoctor CLI can read content from standard input (STDIN) and/or write content to standard output (STDOUT).
This feature is called piping.

Using the `-` flag, you can pipe content to the `asciidoctor` command.
This flag tells Asciidoctor read the source from standard input (STDIN).
For example:

 $ echo 'content' | asciidoctor -

NOTE: Any variation of STDIN will work.

This command is effectively the same as:

 $ echo 'content' | asciidoctor -o - -

When reading source from STDIN, Asciidoctor doesn't have a reference to an input file.
Therefore, it sends the converted text to standard output (STDOUT) by default.

If, instead, you want to write the full document to an output file, you specify it using the `-o` flag.
For example, the following command writes a standalone HTML document to [.path]_output.html_ instead of STDOUT:

 $ echo 'content' | asciidoctor -o output.html -

When you pipe content to the `asciidoctor` command, it no longer has a concept of where the document is located.
Therefore, relative references such as includes may not work as expected.
To resolve this problem, you should specify an absolute base directory using the `-B` option:

 $ echo 'content' | asciidoctor -B /path/to/basedir -o output.html -

Alternately, you can set an artificial document directory by passing an absolute path to the `docdir` attribute:

 $ echo 'content' | asciidoctor -a docdir=/path/to/docdir -o output.html -

Try both approaches to determine which one suits your needs better.

When piping source from STDIN to STDOUT through the `asciidoctor` command, you often just want the converted body (i.e., embeddable HTML).
To produce that variant, add the `-e` flag, short for `--embedded` (previously the `-s` flag):

 $ echo 'content' | asciidoctor -e -

Or perhaps you want to include the doctitle as well:

 $ echo -e '= Document Title\n\ncontent' | asciidoctor -e -a showtitle -

// /modules/cli/pages/set-safe-mode.adoc
[[cli:set-safe-mode.adoc]]
= Set the Safe Mode Using the CLI
:navtitle: Set Safe Mode

When Asciidoctor is invoked via the CLI, the xref:#ROOT:safe-modes.adoc[safe mode] is set to `UNSAFE` by default.

== Assign safe mode level

You can change the security level by executing one of the following commands:

`-S`, `--safe-mode=SAFE_MODE`::
Sets the safe mode level of the document according to the assigned level (`UNSAFE`, `SAFE`, `SERVER`, `SECURE`).

`--safe`, `asciidoctor-safe`::
Sets the safe mode level to `SAFE`.
Provided for compatibility with the python AsciiDoc `safe` command.

////
-B, --base-dir=DIR
Base directory containing the document and resources. Defaults to the directory containing the source file, or the working directory if the source is read from a stream. Can be used as a way to chroot the execution of the program.
////

You can also set the xref:#api:set-safe-mode.adoc[safe mode from the API] and xref:#ROOT:reference-safe-mode.adoc[enable or disable content based on the current safe mode].

// /modules/api/pages/index.adoc
[[api:index.adoc]]
= Process AsciiDoc Using the API
:url-api: {url-api-gems}/asciidoctor/{release-version}

Asciidoctor provides a {url-api}[Ruby API^] named `Asciidoctor` for parsing, analyzing, and converting AsciiDoc content.
This API is intended for use in applications, scripts, integrations with other Ruby software, such as Rails, GitHub, and GitLab, and by other languages, such as Java (via xref:#asciidoctorj::index.adoc[AsciidoctorJ]) and JavaScript (via xref:#asciidoctor.js::index.adoc[Asciidoctor.js]).

This page examines the purpose of the API and how it can be used, shows how to get started with it, introduces its primary entry points, and links to where you can find more information to start putting it into practice.

[#when-to-use]
== When to use the API

If all you need to do is convert an AsciiDoc file to a publishable format such as HTML, then the xref:#cli:index.adoc[`asciidoctor`] CLI should suit your needs.
Here's an example showing how to convert an AsciiDoc document to HTML using the CLI:

 $ asciidoctor -d book -n -a toc=left -a source-highlighter=highlight.js document.adoc

Here's the same example showing how to convert the document to HTML using the API:

[,ruby]
----
require 'asciidoctor'

Asciidoctor.convert_file 'document.adoc', doctype: :book, safe: :unsafe,
  attributes: { 'toc' => 'left', 'sectnums' => '', 'source-highlighter' => 'highlight.js' }
----

IMPORTANT: When passing attributes using the Hash format, the attribute name *must* be specified as a String, not a Symbol.
In other words, `toc: 'left'` is not recognized as an attribute entry (since `toc:` creates a Symbol key).
It must be specified as `'toc' \=> 'left'`, as shown in the previous example.

This API call can be abbreviated by declaring the document attributes using shorthand form:

[,ruby]
----
require 'asciidoctor'

Asciidoctor.convert_file 'document.adoc', doctype: :book, safe: :unsafe,
  attributes: 'toc=left sectnums source-highlighter=highlight.js'
----

In contrast to the CLI, the API enables you to break down the processing into smaller steps.
By doing so, you can capture the result of a single step, analyze the parsed document, interface with the document model in an extension, or just gain more control over the processing in general.

When using the API, we talk about two main steps:

load:: In this step, the AsciiDoc content is parsed into a document object model.
This model represents an in-memory hierarchy of the AsciiDoc content as a tree of Ruby objects.
These objects represent the elements in the AsciiDoc document, down to the block level, along with any metadata, such as document and block attributes.

convert:: In this step, the previously prepared document object model is converted into the specified output format using a converter.
In coordination with the converter, the processor passes each node in the document object model to the converter to be converted.
The result is then combined and either returned or written to a file, depending on the options passed to the API.

You can use the API to perform these two steps together (like the CLI) using `convert` and `convert_file`, or separately using `load` and `load_file` followed by calling `#convert` on the document object.
The API can load and convert AsciiDoc files (`load_file` and `convert_file`) or strings (`load` and `convert`).
The <<API entrypoints>> section introduces these methods in more detail.

The API is the main way to interface with Asciidoctor in an application or integration library.
By using the API, you avoid having to invoke Asciidoctor using a subprocess.
You'll find that it also gives you a lot more control over the processing than what the CLI affords.
The API is also a useful tool in scripts, where you may need to dive deeper into the document model beyond where extensions allow you to go.
It is also instrumental in the development of extensions.

Let's learn how to get started with the API by requiring the Asciidoctor library.

[#require]
== Start with `require`

To get started with the Asciidoctor API, you first need to xref:#install:index.adoc[install the gem].
The gem provides both the CLI and the API.
In fact, the CLI uses the API to handle AsciiDoc conversion.

Whereas with the CLI, you interact with Asciidoctor using the `asciidoctor` command, when using the API, you interact with Asciidoctor using methods on the `Asciidoctor` module.

In order to make the `Asciidoctor` module available in a Ruby script or application, you must require the `asciidoctor` gem using Ruby's `require` function:

[,ruby]
----
require 'asciidoctor'
----

This one statement makes all of the {url-api}[public APIs in Asciidoctor^] available to your Ruby code.
For example, we can check which version of Asciidoctor was required by Ruby using the following statement:

[,ruby,subs=attributes+]
----
puts Asciidoctor::VERSION
# => {release-version}
----

If the `require` statement fails, check to make sure that you have the gem installed (and available on the GEM_PATH).

[#entrypoints]
== API entrypoints

The CLI is primarily intended for converting AsciiDoc.
While the API can do that as well, it can do so much more.
Instead of just converting AsciiDoc, the API allows you to load the AsciiDoc into a document model.
From there, you can either convert the document model to an output format, or you can pause to analyze or modify its structure.

There are four main entrypoints in the Asciidoctor API:

`Asciidoctor.load`:: parses the AsciiDoc source (down to the block level) into an `Asciidoctor::Document` object
`Asciidoctor.load_file`:: parses the contents of the AsciiDoc source file (down to the block level) into an `Asciidoctor::Document` object
`Asciidoctor.convert`:: parses and converts the AsciiDoc source to the output format determined by the specified backend
`Asciidoctor.convert_file`:: parses and converts the contents of the AsciiDoc source file to the output format determined by the specified backend

If you're processing a file, you'd typically use a method that ends with `_file`.
Otherwise, you'd use its complement, which accepts a String, an array of Strings, or an IO object.

By default, the output of the convert methods follows the input.
If you convert a String, the method will output a String.
If you convert a file, the method will output to a file.
However, these defaults can be changed using the options (e.g., `:to_file`).

When calling Asciidoctor using the API, you can access xref:#options.adoc[additional options that control processing] which are not available when using the CLI.
For example, you can pass in extensions, parse only the header, enable the sourcemap, or catalog assets.

In addition to the main entrypoints, the API also provides a mechanism to register and develop extensions.
To learn more about extensions, see xref:#extensions:index.adoc[].

== Next steps

* xref:#api:convert-files.adoc[Load and convert AsciiDoc from a file]
* xref:#api:convert-strings.adoc[Load and convert AsciiDoc from a string]
* xref:#embedded-output[Generating embedded vs standalone output]
* xref:#convert-inline-markup-only[Convert inline markup only]
* xref:#api:generate-html-toc.adoc[Generate an HTML TOC]
* xref:#load-templates.adoc[Load custom templates]
* xref:#extensions:index.adoc[Create extensions]
* xref:#options.adoc[API options]
* {url-api}[Ruby API docs^]

// /modules/api/pages/convert-files.adoc
[[api:convert-files.adoc]]
= Load and Convert Files Using the API
:navtitle: Load and Convert Files

This page explains how to load and convert AsciiDoc files using the API.

== Load an AsciiDoc file

When you load AsciiDoc using the API, you're telling Asciidoctor to parse the document (down to the block level) and return an `Asciidoctor::Document` object.
This object contains the full block structure of the AsciiDoc document.

CAUTION: Loading a document currently does not parse the inline content.
That processing is deferred until the parsed document is converted.

Let's assume we're working with the following AsciiDoc document:

._document.adoc_
[,asciidoc]
----
= Document Title

The main content.
----

To parse this source file into an `Asciidoctor::Document` object, use the following API call:

[,ruby]
----
doc = Asciidoctor.load_file 'document.adoc', safe: :safe
----

Using the object assigned to the `doc` variable, you can get information about the document, such as the document title.

[,ruby]
----
puts doc.doctitle
# => "Document Title"
----

You can also inspect all the document attributes:

[,ruby]
----
pp doc.attributes
----

Going deeper, you can find blocks in the document, such as all the paragraph blocks, using the `find_by` method:

[,ruby]
----
puts doc.find_by context: :paragraph
# => #<Asciidoctor::Block@1001 {context: :paragraph, content_model: :simple, style: nil, lines: 1}>
----

However, if you're only interested in converting the AsciiDoc source when using the API, then it's better to use the `convert_file` entrypoint.

== Convert an AsciiDoc file

When you convert AsciiDoc using the API, you're telling Asciidoctor to parse and convert the document to the output format determined by the specified backend.
If you don't specify a backend, like with the CLI, Asciidoctor will produce HTML.

Let's again assume we're working with the following AsciiDoc document:

._document.adoc_
[,asciidoc]
----
= Document Title

The main content.
----

To convert this source file to HTML5, use the following API call:

[,ruby]
----
Asciidoctor.convert_file 'document.adoc', safe: :safe
----

The command will output HTML to the file [.path]_my-sample.html_ in the same directory.
If you want Asciidoctor to output to a different file, you can specify it using the `:to_file` option:

[,ruby]
----
Asciidoctor.convert_file 'document.adoc', safe: :safe, to_file: 'out.html'
----

You can convert the file to DocBook by setting the `:backend` option to `'docbook'`:

[,ruby]
----
Asciidoctor.convert_file 'document.adoc', safe: :safe, backend: 'docbook'
----

In this case, Asciidoctor will output DocBook to the file [.path]_my-sample.xml_ in the same directory.
As before, you can use the `:to_file` option to control the output file.

[,ruby]
----
Asciidoctor.convert_file 'document.adoc', safe: :safe, backend: 'docbook', to_file: 'out.html'
----

That covers the basics of loading and converting AsciiDoc using the API.

// /modules/api/pages/convert-strings.adoc
[[api:convert-strings.adoc]]
= Load and Convert Strings Using the API
:navtitle: Load and Convert Strings

This page explains how to load and convert AsciiDoc strings using the API.
A string is the bare AsciiDoc content (often the contents of a file).

== Load an AsciiDoc string

To parse an AsciiDoc string into a document object model, use:

[,ruby]
----
doc = Asciidoctor.load '*This* is Asciidoctor.'
----

You can also read AsciiDoc from a file and pass it to the `load` method:

[,ruby]
----
asciidoc = File.read 'document.adoc', mode: 'r:utf-8'
doc = Asciidoctor.load asciidoc, safe: :safe
----

Once you have loaded the document, you can convert it by calling the convert method:

[,ruby]
-----
doc.convert
-----

However, if you're only interested in converting the AsciiDoc source when using the API, then it's better to use a convert entrypoint.

== Convert an AsciiDoc string

To convert the AsciiDoc string directly to HTML, use:

[,ruby]
----
puts Asciidoctor.convert '*This* is Asciidoctor.'
----

Here's the output you will see:

[,html]
----
<div class="paragraph">
<p><strong>This</strong> is Asciidoctor.</p>
</div>
----

You can also read AsciiDoc from a file and pass it to the `convert` method:

[,ruby]
----
asciidoc = File.read 'document.adoc', mode: 'r:utf-8'
html = Asciidoctor.convert asciidoc, safe: :safe
----

When converting a string, Asciidoctor _does not_ output a standalone document by default.
Instead, it generates embedded output.
Let's learn why that is and how to control it.

== Embedded output

When you pass an AsciiDoc string to `Asciidoctor.convert` to convert it to a backend format, such as HTML, the `:standalone` option is `false` by default.
That means this method only returns the converted content.
This content does not include the frame around that content (i.e., the header and footer) that's included in a standalone document.
In other words, it makes an _embedded_ document.
This default was chosen to make Asciidoctor consistent with other lightweight markup processors like Markdown.

Here's what's included in an embedded document:

* The document title if the `showtitle` attribute is set
* The table of contents if the `toc` attribute is set and the value is not `preamble`
* The converted document body
* The footnotes unless the `nofootnotes` attribute is set

The author and revision information is never shown in an embedded document.
If you need to display that information, you can use attribute references such as `\{author}` and `\{revnumber}`.

The embedded document is intended to be included in a template, such as one provided by a static site generator.
That template is responsible for providing the styles and library integrations needed for the content to render properly.

== Standalone output

You can still generate a standalone document when converting a string.
To convert from an AsciiDoc string to a standalone output document, you need to explicitly set the `:standalone` option to `true`.

[,ruby]
----
puts Asciidoctor.convert '*This* is Asciidoctor.', standalone: true
----

Now you'll get a complete HTML file.
The standalone output provides the framing around the content, which includes the styling and all the library integrations the content needs to properly render (e.g., the default stylesheet, MathJax, etc.).
If you don't set the `:standalone` option to `true`, you only get the embedded document (i.e., body content).

When the input or output is a file, the `:standalone` option is enabled by default.
Thus, to instruct Asciidoctor to write standalone HTML to a file from an AsciiDoc string, the `:to_file` option is mandatory. 

[,ruby]
----
Asciidoctor.convert '*This* is Asciidoctor.', to_file: 'out.html'
----

If you want to generate embedded output when starting with a file, set the `:standalone` option to `false`.
However, most of the time you'll want to generate a standalone document when converting a file (which is why it's default).

When converting a string, the TOC is only included by default when using the `:standalone` option as shown above (whether it's enabled implicitly or explicitly).
However, you can force it to be included without the header and footer by setting the `toc` attribute with a value of `macro` and using the `toc::[]` macro in the string itself.

== Convert inline markup only

If you only want the inline markup to be returned, set the `:doctype` option to `'inline'`:

[,ruby]
----
puts Asciidoctor.convert '*This* is Asciidoctor.', doctype: 'inline'
----

In this mode, Asciidoctor will only process the first block (e.g., paragraph) in the document and ignore the rest.

== Convert to DocBook

You can produce DocBook 5.0 by setting the `:backend` option to `'docbook'`.
Since embedded DocBook isn't that useful, we also enable the standalone document (i.e., header and footer) by setting the `:standalone` option to `true`.

[,ruby]
----
puts Asciidoctor.convert '*This* is Asciidoctor.', standalone: true, backend: 'docbook'
----

// /modules/api/pages/generate-html-toc.adoc
[[api:generate-html-toc.adoc]]
= Generate an HTML TOC

Asciidoctor's HTML5 converter has a built-in method for generating an HTML TOC.
This TOC generator can also be used as a general purpose API.
This logic is available via the `convert_outline` method (which is the convert method for the `outline` node) on the HTML5 converter.

== Usage

The `convert_outline` method accepts a Document object and an optional Hash of options and it returns HTML.
It can be resolved and invoked as a general purpose method using the following snippet of code:

[,ruby]
----
document = Asciidoctor.load_file 'document-with-sections.adoc', safe: :safe
html_toc = (Asciidoctor::Converter.create 'html5').convert_outline document
puts html_toc
----

Here's an example of what this method produces:

[.output,html]
----
<ul class="sectlevel1">
<li><a href="#_section_a">Section A</a></li>
<li><a href="#_section_b">Section B</a>
<ul class="sectlevel2">
<li><a href="#_subsection">Subsection</a></li>
</ul>
</li>
<li><a href="#_section_c">Section C</a></li>
</ul>
----

You can also access the `convert_outline` method on the converter instance by way of the Document API:

[,ruby]
----
document = Asciidoctor.load_file 'document-with-sections.adoc', safe: :safe
html_toc = document.converter.convert_outline document
----

If you're using a composite converter, you can use the generic `convert` method to ensure the call is run through the converter chain.
To do so, invoke the `convert` method and pass in the Document object and the node name `outline`.
This, in turn, will call `convert_outline` on the converter in the chain that responds to this method.

[,ruby]
----
document = Asciidoctor.load_file 'document-with-sections.adoc', safe: :safe
html_doc = document.converter.convert document, 'outline'
----

You can also use this method inside any converter template (e.g., Slim, Haml, or ERB) to generate and embed a TOC:

[,ruby]
----
= converter.convert document, 'outline'
----

== Options

The `convert_outline` method accepts the following options:

sectnumlevels:: the number of section levels to number (defaults to the value of the `sectnumlevels` attribute.
toclevels:: the depth of the TOC (defaults to the value of the `toclevels` attribute)

Here's an example of how you can generate an HTML TOC with the depth limited to 1 for the previously loaded document:

[,ruby]
----
html_toc = document.converter.convert_outline document, toclevels: 1
----

// /modules/api/pages/set-safe-mode.adoc
[[api:set-safe-mode.adoc]]
= Set the Safe Mode Using the API
:navtitle: Set Safe Mode

When using Asciidoctor via the API, the default xref:#ROOT:safe-modes.adoc[safe mode] is `SECURE`.
You can change the safe mode using the `:safe` API option.

== Set :safe option

The safe mode can be controlled from the API using the `:safe` option.
The `:safe` option is accepted by all xref:#entrypoints[entrypoint methods] (e.g., `Asciidoctor#convert_file`).

The `:safe` option accepts the safe mode as a string:

[,ruby]
----
Asciidoctor.convert_file 'doc.adoc', safe: 'server'
----

as a symbol (preferred):

[,ruby]
----
Asciidoctor.convert_file 'doc.adoc', safe: :server
----

as an integer:

[,ruby]
----
Asciidoctor.convert_file 'doc.adoc', safe: 10
----

You can also set the xref:#cli:set-safe-mode.adoc[safe mode from the CLI] and xref:#ROOT:reference-safe-mode.adoc[enable or disable content based on the current safe mode].

// /modules/api/pages/sourcemap.adoc
[[api:sourcemap.adoc]]
= Map Source Location of Blocks
:navtitle: Enable the Sourcemap

Since Asciidoctor's primary focus is on converting documents efficiently, it does not attempt to track the source location of blocks when parsing by default.
However, such information can be useful for extracting information from the source document, improving error messages, and for use in extensions.
Therefore, Asciidoctor provides a flag to map the source location of blocks, known as the sourcemap.
This page examples how to enable the sourcemap and how to make use of the information it provides.

== What does the sourcemap provide?

The sourcemap provides line and file information for all blocks in the parsed document.
Specifically, it provides information about the start of each block.
The start of the block does not include any block metadata (block anchor and block attributes) above the block.

The sourcemap only works for blocks.
It does not track the source location for inline elements, such as formatted text or an inline image, or for attribute entries.

The sourcemap information is available on the `source_location` property of the block.
When the sourcemap is enabled, the value of this property is a `Cursor` object.
The `Cursor` object contains the following properties:

[horizontal]
file:: the absolute filename of the source file where the block starts (if input is a string, the value is `nil`)
dir:: the absolute directory of the source file where the block starts (if input is a string, the value is the base dir)
lineno:: the line number in the source file where the block starts (after any empty or block metadata lines)
path:: the relative path (starting from docdir) of the source file where the block starts (if input is a string, the value is `<stdin>`)

The `lineno` and `file` properties can be accessed as properties with the same name on the block itself.

IMPORTANT: The sourcemap is not perfect.
There are certain edge cases, such as when the block is split across multiple files or the block starts and ends on the last line of an include file, when the sourcemap may report the wrong file or line information.
If you're writing a processor that relies on the sourcemap, it's a good idea to verify that the line at the cursor is the one you expect to find, then adjust accordingly.

== Enable using :sourcemap option

The sourcemap feature can be controlled from the API using the `:sourcemap` option.
The value of this option is a boolean.
If the value is `false` (default), the sourcemap is not enabled.
If the value is `true`, the sourcemap is enabled.
The `:sourcemap` option is accepted by all xref:#entrypoints[entrypoint methods] (e.g., Asciidoctor#load_file).

Here's an example of how to enable the sourcemap using the API:

[,ruby]
----
doc = Asciidoctor.load_file 'doc.adoc', safe: :safe, sourcemap: true
----

== Enable from extension

You can enable the sourcemap using an Asciidoctor preprocessor extension.
This technique is useful if your extension needs access to the source location of blocks, but you don't want to require users to pass an additional option to Asciidoctor.

[,ruby]
----
Asciidoctor::Document.prepend (Module.new do
  attr_writer :sourcemap
end) unless Asciidoctor::Document.method_defined? :sourcemap=

# A preprocessor that enables the sourcemap feature if not already enabled via the API.
Asciidoctor::Extensions.register do
  preprocessor do
    process do |doc, reader|
      doc.sourcemap = true
      nil
    end
  end
end
----

Now that the sourcemap is enabled, your extension can access the source location of the block elements in the parsed document.

== Use the sourcemap

When the sourcemap is enabled, the parser will store source information on the `source_location` property on each block in the parsed document.
Let's look at an example.

Start by creating the following AsciiDoc file named [.path]_doc.adoc_.

.doc.adoc
[,asciidoc]
----
= Document Title

== Section

Paragraph.

Another paragraph.
----

Now, load this file using Asciidoctor with the `:sourcemap` option enabled:

[,ruby]
----
doc = Asciidoctor.load_file 'doc.adoc', safe: :safe, sourcemap: true
----

Let's find the first paragraph in the document and inspect its source location:

[,ruby]
----
first_paragraph = (doc.find_by context: :paragraph)[0]
puts first_paragraph.source_location
----

You'll see output similar to what's shown below:

[.output]
....
doc.adoc: line 5
....

What you're seeing here is the string value of the cursor.
There's more information to see if you replace `puts` with `pp`:

[.output]
....
#<Asciidoctor::Reader::Cursor
 @dir="/path/to/docdir",
 @file="/path/to/docdir/doc.adoc",
 @lineno=5,
 @path="doc.adoc">
....

Since file and lineno are the most useful properties, they can be accessed directly from the block:

[,ruby]
----
puts first_paragraph.file
puts first_paragraph.lineno
----

If you move the source of the section to an include file, as shown here:

.doc.adoc
[,asciidoc]
----
= Document Title

\include::partials/section.adoc[]
----

then the source location will follow the paragraph into that file:

[.output]
....
#<Asciidoctor::Reader::Cursor
 @dir="/path/to/docdir/partials",
 @file="/path/to/docdir/partials/section.adoc",
 @lineno=3,
 @path="partials/section.adoc">
....

If the block has metadata lines, those lines are skipped when reporting the start location of the block.
For example, let's assume the paragraph is defined as follows:

[,asciidoc]
----
[#p1]
Paragraph.
----

The lineno of the paragraph in the source location is now one greater than before:

[.output]
....
#<Asciidoctor::Reader::Cursor
 @dir="/path/to/docdir/partials",
 @file="/path/to/docdir/partials/section.adoc",
 @lineno=4,
 @path="partials/section.adoc">
....

If you're writing a custom converter, the source location is not available for inline elements.
However, you can access the source location of the parent element (e.g., `node.parent.source_location`), which should at least get you close to the location of the element.

// /modules/api/pages/catalog-assets.adoc
[[api:catalog-assets.adoc]]
= Catalog Assets

Since Asciidoctor's primary focus is on converting documents efficiently, it does not attempt to store information about all assets it comes across while processing the document.
However, such information can be useful for analyzing the document or for use in extensions.
Therefore, Asciidoctor provides a flag to catalog certain additional assets.
This page explains how to enable this catalog and how to access it.

== What assets are cataloged?

The asset catalog provides a table of select assets grouped by type that are discovered while processing the document.
This table is stored on the `catalog` property of the document model.

When this feature is enabled, the processor catalogs the following assets:

* links (but not xrefs) (key: `:links`)
* block or inline images (key: `:images`)

The processor always cataloged the following assets, regardless of this setting:

* block or inline anchors (key: `:refs`)
* footnotes (key: `:footnotes`)

Generally speaking, inline elements are not cataloged until conversion.
Therefore, they're only available after the document has been converted, not after it has been loaded.
However, inline anchors are an exception.

Inline anchors in paragraphs and list items are cataloged when the document is parsed.
However, the scan for inline anchors happens before inline passthroughs are processed.
Therefore, to escape an inline anchor, you must use a backslash instead of an inline passthrough.

== Set :catalog_assets option

Whether the processor catalogs assets (specifically links and images) is controlled from the API using the `:catalog_assets` option.
The value of this option is a boolean.
If the value is `false` (default), assets are not cataloged.
If the value is `true`, assets are cataloged.
The `:catalog_assets` option is accepted by all xref:#entrypoints[entrypoint methods] (e.g., Asciidoctor#load_file).

Here's an example of how to catalog assets when using the API:

[,ruby]
----
doc = Asciidoctor.convert_file 'doc.adoc', safe: :safe, catalog_assets: true
----

Notice that we've used the `convert_file` method instead of the `load_file` method.
This ensures that inline assets are included in the catalog as well.

If you need to enable the `:catalog_assets` option when using the CLI, you'll need to require the following extension:

.enable-catalog-assets-preprocessor.rb
[,ruby]
----
Asciidoctor::Extensions.register do
  preprocessor do
    process do |doc, reader|
      doc.instance_variable_set :@options, ((doc.instance_variable_get :@options).merge catalog_assets: true)
      nil
    end
  end
end
----

Now that you've configured the processor to catalog assets, you can access them from the document object.
Let's explore it.

== Use the asset catalog

Assets which have been cataloged are available from the `catalog` property on the document model (i.e., the parsed document).
The catalog is a Ruby hash.
The keys are the asset families (e.g., `:links`, `:images`, etc).
The value of each key is an array of assets.
The asset object varies by family.

Let's look at an example of how to access links, images, and refs from the asset catalog.

=== :links

Start by creating the following AsciiDoc file named [.path]_doc.adoc_.

.doc.adoc
[,asciidoc]
----
You can learn about Asciidoctor at https://docs.asciidoctor.org.
The Asciidoctor source repo is hosted on https://github.com[GitHub].

image::screenshot.png[]

If you see image:green-check.png[], it means the job was successful.
----

Now, convert this file using Asciidoctor with the `:catalog_assets` option enabled:

[,ruby]
----
doc = Asciidoctor.convert_file 'doc.adoc', safe: :safe, catalog_assets: true
----

Let's see what links the processor found:

[,ruby]
----
links = doc.catalog[:links]
puts "Found #{links.size} links:"
puts links
----

You'll see the following output:

[.output]
....
Found 2 links:
https://docs.asciidoctor.org
https://github.com
....

The value of the `:links` key is an array of unique URLs found in the document.
The entry does not include the link text, only the URL itself.

=== :images

Let's add some images to the document.

.doc.adoc
[,asciidoc]
----
//...

image::screenshot.png[]

If you see image:green-check.png[], it means the job was successful.
----

Now, convert this file using Asciidoctor with the `:catalog_assets` option enabled:

[,ruby]
----
doc = Asciidoctor.convert_file 'doc.adoc', safe: :safe, catalog_assets: true
----

Let's see what images the processor found:

[,ruby]
----
images = doc.catalog[:images]
puts "Found #{images.size} images:"
puts images
----

You'll see the following output:

[.output]
....
Found 2 images:
screenshot.png
green-check.png
....

The value of the `:images` key is an array of images (by occurrence) found in the document.
While it looks like the value of each entry is a relative path string, there's actually more information there.

Each entry in the `:images` collection is an ImageReference object.
This object appears as a relative path string when printed (which explains the observed behavior).
An ImageReference contains the following properties:

target:: The image path relative to the value of imagesdir.
imagesdir:: The value of the imagesdir attribute at the time the image was processed.

Let's assume the images are located in the [.path]_images_ folder, and we have set the `imagesdir` attribute on the document accordingly.

.doc.adoc
[,asciidoc]
----
= Document Title
:imagesdir: images

//...

image::screenshot.png[]

If you see image:green-check.png[], it means the job was successful.
----

You can print the full location to the images as follows:

[,ruby]
----
images = doc.catalog[:images]
puts "Found #{images.size} images:"
docdir = doc.attr 'docdir'
puts images.map {|image| File.join docdir, image.imagesdir.to_s, image.target }
----

In the output, the image references will be shown as absolute paths.

=== :refs

In addition to images and links, you can also access all targetable references (i.e., elements that have an ID).
First, let's add some referenceable elements to our document.

[,asciidoc]
----
= Document Title

== Quickstart

You can learn about Asciidoctor at https://docs.asciidoctor.org.
The Asciidoctor source repo is hosted on https://github.com[GitHub].

.Screenshot
[#screenshot]
image::screenshot.png[]

== CI

If you see image:green-check.png[], it means the job was successful.
----

Let's see what references the processor found:

[,ruby]
----
refs = doc.catalog[:refs]
puts "Found #{refs.size} references:"
puts refs.keys
----

You'll see the following output:

[.output]
....
Found 3 references:
_quickstart
screenshot
_ci
....

The value of the `:refs` key is a map of unique references found in the document.
The key names are the unique IDs.
The values are the element nodes to which these IDs are bound.
The API for the node depends on the type of element.
The most common property is the reftext of the node.

[,ruby]
----
refs = doc.catalog[:refs]
puts "Found #{refs.size} references:"
puts refs.map {|id, node| %(#{node.context}: #{id} => #{node.xreftext || "[#{id}]"}) }
----

Now you'll see the following output:

[.output]
....
Found 3 references:
section: _quickstart => Quickstart
image: screenshot => Screenshot
section: _ci => CI
....

An idea of something you can do with the refs table is validate deep xrefs across documents.

// /modules/api/pages/find-blocks.adoc
[[api:find-blocks.adoc]]
= Find Blocks

Once the document has been loaded (or partially loaded), you can traverse the document to find block nodes.
There are two ways to look for block nodes.
One way is to start walking down the tree starting from the Document object.
All blocks can be reached from the Document object.
However, a much quicker way to find blocks is to use the `find_by` method, which does the walking for you.
We'll start there, then look at how to use the custom traversal approach.

== find_by

Every block node (a parsed block), including the Document object, provides the {url-api-gems}/asciidoctor/{release-version}/Asciidoctor/AbstractBlock#find_by-instance_method[find_by] method.
The purpose of this method is to help you quickly find descendant blocks.
Since some blocks have different models, this method can help you navigate the document without having to worry about those nuances.

IMPORTANT: The `find_by` method only finds block nodes.
It does not find inline nodes.

If you want to look for any block in the parsed document, call the `find_by` method on the Document object.
Otherwise, you can look for blocks in a specific area of the document by calling it on the relevant ancestor of those blocks.

The return value of this method is a flat array of blocks in document order which were matched.
The relationship between those blocks is only preserved by way of their own model.
If no blocks are matched, the method returns an empty array.

=== All blocks

If not called with any arguments, the `find_by` method will return all blocks starting from the block on which it was called.
If called on the Document object, it will return all blocks in the document (except for blocks in AsciiDoc table cells), including the document itself.
Here's an example:

[,ruby]
----
require 'asciidoctor'

doc = Asciidoctor.load_file 'input.adoc', safe: :safe
puts doc.find_by
----

Here's an example of how to find all the blocks in the first section:

[,ruby]
----
doc.sections.first.find_by
----

Notice that the `find_by` method always returns the block that you start with as the first result (assuming it also matches the provided selector, covered later).
If you want to exclude that block, slice it off from the results:

[,ruby]
----
puts doc.find_by.slice 1..-1
----

If youre just looking for the first result, you can pluck it from the result array:

[,ruby]
----
puts doc.find_by.first
----

By default, and for backwards compatibility, the `find_by` method does not traverse into AsciiDoc table cells.
If you want it to look in these cells for blocks, set the `:traverse_documents` key on the selector Hash to true.

[,ruby]
----
all_blocks = doc.find_by traverse_documents: true
----

The next section will look at how to filter the blocks that are returned.

=== Filter blocks

When using the `find_by` method, you're probably looking for specific blocks.
The method accepts an optional selector (a Hash) and an optional block filter (a Ruby proc).
The method will walk the entire tree (including in AsciiDoc table cells if `:traverse_documents` is `true`) to find blocks.
By default, it will descend into a block which does not match, though this behavior can be controlled using the block filter.

The simplest way to match blocks is to use the selector.
The selector is a Hash that accepts four predefined symbol keys:

:context:: A single block xref:#convert:contexts-ref.adoc[context] (i.e., block name), such as `:paragraph`.
:style:: A single block style, such as `source`.
:id:: An ID.
:role:: A single role.

If an `:id` is specified, the method will never return more than one block since an ID is, by natural, globally unique.
Here's an example of how to find a block by ID using the `:id` selector:

[,ruby]
----
match = (doc.find_by id: 'prerequisites').first
----

Now let's assume we want to match all listing blocks that are source blocks.
We can do so by combining the `:context` and `:style` selectors:

[,ruby]
----
some_source_blocks = doc.find_by context: :listing, style: 'source'
----

Since literal blocks can also be source blocks, if we want all source blocks, we'd need to leave off the `:context` selector:

[,ruby]
----
all_source_blocks = doc.find_by style: 'source'
----

If we want all blocks marked with a specific role, we can find them using the `:role` selector:

[,ruby]
----
blocks_with_role = doc.find_by role: 'try-it'
----

The selector Hash is intentionally simple to make it easy to find blocks.
If the blocks you're looking for cannot be described using that selector, then you'll want to use a block filter instead.

A block filter is a Ruby proc that runs on each block visited.
It accepts the candidate block as the sole argument (i.e., the candidate block is yielded to the proc).
If the proc returns true, then the candidate is considered matched.

Here's an example of using the block filter to find all top-level sections:

[,ruby]
----
top_level_sections = doc.find_by {|block| block.context == :section && block.level == 1 }
----

We can make this slightly more efficient by combining it with a selector:

[,ruby]
----
top_level_sections = doc.find_by(context: :section) {|section| section.level == 1 }
----

If a Ruby block is given, it's applied as a supplemental filter to the selector.
In other words, the candidate block must match the selector and the filter.

=== Control the traversal

The benefit of the block filter is that it also allows you to control the traversal.
The filter method can return any of the following keywords:

true::
:accept::
The block is accepted and the traversal continues.

false::
:skip::
The block is skipped but its children are traversed.

:reject::
The block is rejected and its children are not traversed.

:prune::
The block is accepted, but its descendants are not traversed.

Here's an efficient way to match all sidebars that are not contained within another block.

[,ruby]
----
top_level_sidebars = doc.find_by do |block|
  if block == block.document
    :skip
  elsif block.context == :sidebar
    :prune
  else
    :reject
  end
end
----

The filter has to return `:skip` instead of `:reject` for the document object or else no blocks will be traversed.

If you combine the selector and the block filter, you will have less control over which nodes are traversed.
Therefore, if you're going to be using the block filter to control the traversal, it's best to do all logic in that filter.

== Custom traversal

Another way to find blocks is to traverse the tree explicitly.
Starting at the document object, you can access its children by calling the `blocks` method.

[,ruby]
----
doc.blocks.each do |block|
  puts block
end
----

CAUTION: Not all blocks have the same model.
For example, each item in a description list is an array of two nodes.
And tables have a very different model from other blocks.
These differences are important to be aware of when traversing the document model.

If the block or blocks you're looking for are close at hand or in a known location, it may be more efficient to use a custom traversal.
However, if you aren't sure where the block is located in the document tree, you'd be much better off using the `find_by` method to locate it.

[[options.adoc]]
{empty}

// /modules/api/pages/options.adoc
[[api:options.adoc]]
= API Options

[cols="~,~,15%,15%"]
|===
|Name |Description |Default value |Allowed values

|`:attributes`
|Sets document attributes, which override equivalently-named attributes defined in the document unless soft set.
No substitutions are applied to the value of these attributes.
In the Hash format, the name *must* be a String, not a Symbol (e.g., `name: 'value'` is *invalid*).
In this format, a `nil` value hard unsets the attribute and a `false` value soft unsets the attribute.
|_not set_
a|xref:#asciidoc:attributes:document-attributes.adoc[Document attributes] in the following formats:

*Hash* +
`{ 'name' \=> 'value' }`

*Array* +
`[ 'name=value' ]`

*String* (space separated) +
`'name=value'`

|`:backend`
|Selects converter to use.
|`html5`
|`html5`, `docbook5`, `manpage`, or a backend mapped to an available converter

|`:base_dir`
|Sets the base (aka working) directory containing the document and resources.
|Directory of the source file, or the working directory if the source is read from a stream.
|file path

|`:catalog_assets`
|If `true`, the parser captures images and links in the reference table.
(Normally only IDs, footnotes and indexterms are included).
The reference table is available via the `references` property on the `document` AST object.
//NOTE: This is still a primitive and experimental feature.
//It is intended for early adopters to address special use cases.
_(Experimental)._
|`false`
|_Boolean_

|`:converter`
|Specifies a user-supplied converter class or instance, used in place of the converter that is automatically resolved from the `backend` value.
|_not set_
|`Asciidoctor::Converter` class or instance

|`:doctype`
|Sets the document type.
|`article`
|`article`, `book`, `manpage`, `inline`

|`:eruby`
|Specifies the eRuby implementation to use for executing the converter templates written in ERB.
|`erb`
|`erb`, `erubis`

|`:extensions`
|A Ruby block that registers (and possibly defines) xref:#extensions:register.adoc[Asciidoctor extensions] for this instance of the processor.
|_not set_
|A Ruby block that conforms to the Asciidoctor extensions API (the same code that would be passed to the `Extensions.register` method).

|`:extension_registry`
|Overrides the extensions registry instance.
Instead of providing a Ruby block containing extensions to register, this option lets you replace the extension registry itself, giving you complete control over how extensions are registered for this processor.
|_not set_
|`Extensions::Registry` instance

|`:logger`
|Shorthand to assign a new value to the global `LoggerManager.logger`.
This is persistent change, so you either have to reset the value afterwards or pass the option each time you call the API.
If value is falsy, it assigns a null logger, effectively turning off logging.
|_not set_
|`Logger` instance

|`:parse_header_only`
|If `true`, the parser stops after reading the header.
|`false`
|_Boolean_

|`:standalone`
|If `true`, generates a standalone output document (which includes the shell around the body content, such as the header and footer).
When converting to a file, the default value is `true`.
Otherwise, the default value is `false`.
The deprecated alias for this option is `:header_footer`.
The default value for this option is opposite of the default value for the CLI.
|_Varies_
|_Boolean_

|`:mkdirs`
|If `true`, the processor creates the necessary output directories if they don't yet exist.
|`false`
|_Boolean_

|`:parse`
|If `true`, the source is parsed eagerly (i.e., as soon as the source is passed to the `load` or `load_file` API).
If `false`, parsing is deferred until the `parse` method is explicitly invoked.
|`true`
|_Boolean_

|`:safe`
|Sets the xref:#ROOT:safe-modes.adoc[safe mode].
|`:secure`
|`:unsafe`, `:safe`, `:server`, `:secure`

|`:sourcemap`
|Tracks the file and line number for each parsed block.
Useful for tooling applications where the association between the converted output and the source file is important.
|`false`
|_Boolean_

|`:template_cache`
|Enables the built-in cache used by the template converter when reading the source of template files.
Only relevant if `:template_dirs` is specified.
|`true`
|_Boolean_

//|`:template_dir`
//|Specifies a directory of Tilt-compatible templates to be used instead of the default built-in templates.
//*Deprecated. Use `:template_dirs` instead.*
//|_not set_
//|file path

|`:template_dirs`
|Array of directories containing Tilt-compatible converter templates to be used instead of the default built-in templates.
|_not set_
|Array of file paths

|`:template_engine`
|Template engine to use for the custom converter templates.
The gem with the same name as the engine will be loaded automatically.
This name is also used to build the full path to the custom converter templates.
|_auto_ +
(Set based on the file extension of the custom converter templates found).
|Template engine name (e.g., `slim`, `haml`, `erb`, etc.)

|`:template_engine_options`
|Low-level options passed directly to the template engine.
//(You can see an example in the Bespoke.js converter at https://github.com/asciidoctor/asciidoctor-bespoke/blob/v1.0.0.alpha.1/lib/asciidoctor-bespoke/converter.rb#L24-L28).
|_not set_
|Nested Hash of options with the template engine name as the top-level key and the option name as the second-level key.

|`:timings`
|Capture time taken to read, parse, and convert document.
*Internal use only.*
|_not set_
|`Asciidoctor::Timings` instance

|`:to_file`
|Name of the output file to write, or `true` to use the default output file (`docname` + `outfilesuffix`).
|_not set_
|`true`, file path

|`:to_dir`
|Destination directory for output file(s), relative to `base_dir`.
|Directory containing source file, or working directory if source is read from a stream.
|File path
|===

[[safe-modes.adoc]]
{empty}

// /modules/ROOT/pages/safe-modes.adoc
[[ROOT:safe-modes.adoc]]
= Safe Modes

Asciidoctor provides security levels that control the read and write access of attributes, include directives, macros, and scripts while a document is processing.
Each level includes the restrictions enabled in the prior security level.

.Security assumptions
[#security-assumptions]
****
Asciidoctor's safe modes are primarily focused on what the processor is permitted to do.
The safe modes do not provide a comprehensive security framework.
In particular, there's no safe mode that restricts the kind of content the author can pass through to the output document.
In other words, the safe mode setting does not provide a way to sanitize the output.

Asciidoctor performs sensible escaping to allow an author to safely input text, but does not limit the content that can be included in the output using passthrough blocks or custom substitutions.
The reason for this policy is that we assume the document will be passed through a sanitizer if the HTML must be embedded directly into a web page, precisely what GitHub and GitLab do.
This postprocessing (which could be done using a postprocessor extension) is better handled by a separate tool since
there are many permutations to consider and only a separate tool would know which restrictions to apply for a given situation.
****

The safe mode can be set from the xref:#cli:set-safe-mode.adoc[CLI] and the xref:#api:set-safe-mode.adoc[API].
You can also xref:#reference-safe-mode.adoc[enable or disable content based on the current safe mode].

[#unsafe]
== UNSAFE

The `UNSAFE` safe mode level disables any security features enforced by Asciidoctor.
Ruby is still subject to its own restrictions.

*This is the default safe mode for the CLI.*
Its integer value is `0`.

[#safe]
== SAFE

The `SAFE` safe mode level prevents access to files which reside outside of the parent directory of the source file.
Include directives (`+include::[]+`) are enabled, but paths to include files must be within the parent directory.
This mode allows assets (such as the stylesheet) to be embedded in the document.

Its integer value is `1`.

[#server]
== SERVER

The `SERVER` safe mode level disallows the document from setting attributes that would affect conversion of the document.
This level trims `docfile` to its relative path and prevents the document from:

* setting `source-highlighter`, `doctype`, `docinfo` and `backend`
* seeing `docdir` (as it can reveal information about the host filesystem)

It allows `icons` and `linkcss`.

Its integer value is `10`.

[#secure]
== SECURE

The `SECURE` safe mode level disallows the document from attempting to read files from the file system and including their contents into the document.
Additionally, it:

* disables icons
* disables include directives (`+include::[]+`)
* data can not be retrieved from URIs
* prevents access to stylesheets and JavaScript files
* sets the backend to `html5`
* disables `docinfo` files
* disables `data-uri`
* disables interactive (`opts=interactive`) and inline (`opts=inline`) modes for SVGs
* disables `docdir` and `docfile` (as these can reveal information about the host filesystem)
* disables source highlighting

xref:#extensions:index.adoc[Asciidoctor extensions] may still embed content into the document depending whether they honor the safe mode setting.

*This is the default safe mode for the API.*
Its integer value is `20`.

TIP: GitHub processes AsciiDoc files using the `SECURE` mode.

////
|===

|{empty} |Unsafe |Safe |Server |Secure

|URI access
|system access
|base directory access
|docdir
|docfile
|docinfo
|backend
|doctype
|source-highlighter
|macros
|include
|data-uri
|linkcss
|icons

|===
////

[[reference-safe-mode.adoc]]
{empty}

// /modules/ROOT/pages/reference-safe-mode.adoc
[[ROOT:reference-safe-mode.adoc]]
= Safe Mode Specific Content
// anchor: set-safe-attrs

Asciidoctor provides access to the current safe mode through built-in attributes.
You can use these attributes to enable or disable content based on the current safe mode of the processor.

== Referencing safe modes

The xref:#safe-modes.adoc[safe mode] can be referenced by one of the following document attributes:

* The value of the `safe-mode-name` attribute (e.g., unsafe, safe, etc.)
* The value of the `safe-mode-level` attribute (e.g., 0, 10, etc.)
* The presence of the `safe-mode-<name>` attribute, where `<name>` is the safe mode name.

The attributes in the next example define replacement text for features that are disabled in high security environments:

[,asciidoc]
----
\ifdef::safe-mode-secure[]
Link to chapters instead of including them.
\endif::safe-mode-secure[]
----

This feature is particularly handy for displaying content on GitHub, where the safe mode is set to its most restrictive setting, xref:#secure[SECURE].

You can set the xref:#cli:set-safe-mode.adoc[safe mode from the CLI] and the xref:#api:set-safe-mode.adoc[API].

////
Allow the include directive to import a file from a URI.

Example:

 include::https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor/README.adoc[]

To be secure by default, the allow-uri-read attribute must be set in the API or CLI (not document) for this feature to be enabled. It's also completely disabled if the safe mode is SECURE or greater.
Since this is a potentially dangerous feature, it’s disabled if the safe mode is SECURE or greater. Assuming the safe mode is less than SECURE, you must also set the allow-uri-read attribute to permit Asciidoctor to read content from a URI.

I decided the following defaults for the standalone option make the most sense:

true if using the cli (use -s to disable, consistent with asciidoc)
false if using the API, unless converting directly to a file, in which case true is the default
The basic logic is that if you are writing to a file, you probably want to create a standalone document. If you are converting to a string, then you probably want an embedded document. Of course, you can always set it explicitly, this is just a default setting.

The reason I think the standalone default is important is because we don't want people switching from Markdown to AsciiDoc and be totally taken by surprise when they start getting a full HTML document. On the other hand, if you are converting to a file (or using the cli), then it makes a lot of sense to write a standalone document. To me, it just feels natural now.
////

// /modules/tooling/pages/index.adoc
[[tooling:index.adoc]]
= AsciiDoc Tooling
:experimental:
:url-chrome-extension: https://chrome.google.com/webstore/detail/asciidoctorjs-live-previe/iaalpfgpbocpdfblpnhhgllgbdbchmia
:url-edge-addon: https://microsoftedge.microsoft.com/addons/detail/asciidoctorjs-live-previ/pefkelkanablhjdekgdahplkccnbdggd
:url-firefox-addon: https://addons.mozilla.org/en/firefox/addon/asciidoctorjs-live-preview
:url-opera-extension: https://addons.opera.com/en/extensions/details/asciidoctorjs-live-preview/
:url-asciidocfx: https://www.asciidocfx.com
:url-asciidocfx-docs: https://www.asciidocfx.com/#truehow-to-install-asciidocfx
:url-eclipse-marketplace: https://marketplace.eclipse.org/content/asciidoctor-editor
:url-eclipse-plugin-github: https://github.com/de-jcup/eclipse-asciidoctor-editor
:url-intellij-plugin-quickstart: https://intellij-asciidoc-plugin.ahus1.de/docs/users-guide/quick-start.html
:url-intellij-plugin-features: https://intellij-asciidoc-plugin.ahus1.de/docs/users-guide/features.html
:url-scite: https://www.scintilla.org/SciTE.html

Since AsciiDoc syntax is just plain text, you can write an AsciiDoc document using any text editor.
You don't need complex word processing programs like Microsoft Word or Google Docs.
In fact, you shouldn't use these programs because they add cruft to your document that you can't see that makes conversion tedious.

Here's an overview of the different ways to preview and edit your AsciiDoc documents.

== Hosted git repositories

Many popular git repository hosts, including https://github.com/[GitHub], https://about.gitlab.com/[GitLab], and https://codeberg.org/[Codeberg], support editing and previewing AsciiDoc files.
In order to activate this support, the file must have a supported AsciiDoc extension, such as `.adoc`.

When you view an AsciiDoc file on these sites, you will see an HTML preview of the AsciiDoc content.
This preview is powered by Asciidoctor.
The HTML that's rendered is the embedded output produced by the built-in HTML converter.
This means it won't look like a standalone HTML document generated by Asciidoctor.
Rather, the HTML is styled to match the theme of the hosting service and sanitized, so it does not impact the rendering of the page.
This means that certain features may not be available.

GitHub and GitLab apply syntax highlighting to source blocks.
Both services also add floating anchor links next to section titles.
You can deep link to a specific section or to another anchor by adding a fragment identifier to the URL.

The AsciiDoc preview on GitLab currently supports more AsciiDoc features than on GitHub.
On GitLab, you can find support for include directives, admonition icons, diagrams, and STEM expressions.
GitHub, on the other hand, provides a table of contents browser, whereas on GitLab you must add a TOC explicitly using the `toc` attribute.

On GitHub, if you want to see the source of an AsciiDoc file instead of the preview, click the btn:[Code] button or append `?plain=1` to the end of the URL.

If you enter edit mode by clicking the btn:[Edit file] button on either GitHub or GitLab, you can modify the source of the AsciiDoc file and see a preview of the modified source before you commit your changes.
GitLab even allows you to edit multiple files in a single commit using its Web IDE.

== Web browser add-ons (preview only)

To preview an AsciiDoc document in a web browser, install the {url-chrome-extension}[Chrome extension^], the {url-edge-addon}[Edge add-on^], the {url-firefox-addon}[Firefox add-on^], or the {url-opera-extension}[Opera extension^] (all produced from the same code base).
Then you can see the AsciiDoc file rendered as HTML just by visiting it.

== IDEs and text editors

The following IDEs and text editors support the AsciiDoc syntax and most provide document preview rendering with Asciidoctor.

=== AsciiDocFX

{url-asciidocfx}[AsciiDoc FX^] is an editor and terminal emulator written with JavaFX 8.
See its documentation for {url-asciidocfx-docs}[download and installation instructions^].

=== Atom

[IMPORTANT]
====
The Atom editor's official site has announced that Atom is being sunset at the end of 2022.

See https://github.blog/2022-06-08-sunsetting-atom/[Sunsetting Atom]
====

Install https://atom.io/[Atom^].
Then from the Atom editor menus, navigate to menu:Atom[Preferences].
From there, open the menu:Packages[] tab and install:

https://atom.io/packages/asciidoc-preview[AsciiDoc Preview^] :: enables live preview
https://atom.io/packages/language-asciidoc[AsciiDoc Language^] :: enables syntax highlighting (AsciiDoc language support)
https://atom.io/packages/asciidoc-image-helper[AsciiDoc Image Helper^] :: provides the ability to paste images from the clipboard
https://atom.io/packages/autocomplete-asciidoc[AsciiDoc Autocomplete^] :: automatically completes AsciiDoc language items
https://atom.io/packages/asciidoc-assistant[AsciiDoc Assistant^] :: Installs useful components to Atom for editing AsciiDoc files (including the above packages)

=== Brackets

Install http://brackets.io/[Brackets^].
Then from the Brackets file menu, open the extension manager.
Browse available extensions and install `AsciiDoc Preview`.

More information:

* https://github.com/asciidoctor/brackets-asciidoc-preview[AsciiDoc Preview for Brackets^]

=== Eclipse

Install the open source plugin `Asciidoctor Editor` from the {url-eclipse-marketplace}[Eclipse Marketplace^] or visit the
{url-eclipse-plugin-github}[project repository^].

=== IntelliJ IDEA

The community AsciiDoc plugin adds support to edit AsciiDoc files in the IDE with syntax highlighting, auto-completion and a live preview.
It includes support for Antora and Spring REST Docs and creates PDFs using Asciidoctor PDF.

It works with the free community editions as well as with the paid editions of IntelliJ IDEA, CLion, PhpStorm, RubyMine, Android Studio etc.

{url-intellij-plugin-quickstart}[Install the AsciiDoc plugin^] or {url-intellij-plugin-features}[learn more about its features^].

=== SciTE

Install {url-scite}[SciTE^] 5.2.3 or later.
To enable the AsciiDoc lexer, follow these steps:

. Edit the user properties file and remove `asciidoc` from the list in `imports.exclude`.
. Restart SciTE.
. SciTE will automatically apply AsciiDoc syntax highlighting to files ending in `.adoc` and `.asciidoc`.

SciTE does not provide document preview rendering like other editors listed on this page.

=== Visual Studio Code

Visual Studio Code provides rich language support for AsciiDoc and a live preview as you type.

. Install https://code.visualstudio.com/[Visual Studio Code^].
. Launch Visual Studio Code and open the Quick Open dialog by pressing kbd:[Ctrl,P].
. Type the following command to locate and install the AsciiDoc extension (by João Pinto):
+
 ext install asciidoctor.asciidoctor-vscode

More information:

* https://marketplace.visualstudio.com/items?itemName=asciidoctor.asciidoctor-vscode[AsciiDoc extension for Visual Studio Code^]

// /modules/syntax-highlighting/pages/index.adoc
[[syntax-highlighting:index.adoc]]
= Syntax Highlighting

AsciiDoc defines a style of listing block known as a xref:#asciidoc:verbatim:source-blocks.adoc[source block] for adding source code snippets intended to be colorized by a syntax highlighter to a document.
Here's a simple example of a source block:

[source,asciidoc]
....
[source,ruby]
----
puts "Hello, World!"
----
....

If a language is specified on a listing block, the source style is implied.
Therefore, it can be excluded in this case.

[source,asciidoc]
....
[,ruby]
----
puts "Hello, World!"
----
....

Here's how we expect it to appear:

[,ruby]
----
puts "Hello, World!"
----

It's up to an AsciiDoc processor such as Asciidoctor to apply the syntax highlighting to this source block, a process referred to as xref:#asciidoc:verbatim:source-highlighter.adoc[source highlighting].
Asciidoctor provides adapters that integrate with several popular syntax highlighter libraries to perform this task.
It also provides an interface for implementing a custom syntax highlighter adapter.

== Syntax highlighter types

Asciidoctor supports two types of syntax highlighters: client-side and build-time.
Let's explore each type and how they work.

A [.term]*client-side syntax highlighter* performs syntax highlighting in the browser as the page is loading.
Asciidoctor does not invoke the syntax highlighter itself.
Instead, it focuses on adding the assets to the generated HTML so the browser can load the syntax highlighter and run it.
For this type of syntax highlighter, Asciidoctor passes the contents of the source block through to the output as is.
It also adds metadata to the element so that the syntax highlighter knows to highlight it and which language it is.
Unfortunately, Asciidoctor does not process callout numbers in the source block in this case, so they may cause the syntax highlighter to get tripped up.

A [.term]*build-time syntax highlighter* performs syntax highlighting during AsciiDoc conversion.
Asciidoctor does invoke the syntax highlighter in this case.
It also takes care of hiding the callout numbers from the syntax highlighter, ensuring they are put back in the proper place afterwards.
What Asciidoctor emits into the output is the result produced by the syntax highlighter, which are the tokens enclosed in `<span>` elements to apply color and other formatting (either inline or via CSS classes).
These syntax highlighters tend to support more features because Asciidoctor has greater control over the process.

=== Client-side vs build-time

There are benefits and drawbacks of each type.
The benefit of a client-side syntax highlighter is that does not require installing any additional libraries.
It also makes conversion faster and makes it produce smaller output since the syntax highlighting is deferred until page load.
The main drawback is that callouts in the source block can be mangled by the syntax highlighter or confuse it.
The benefits of a build-time syntax highlighter are that you have more control over syntax highlighting and can enable additional features such as line numbers and line highlighting.
The main drawback is that it requires installing an extra library, it slows down conversion, and causes the output to be larger.

You should try each syntax highlighter and find the one that works best for you.

== Built-in syntax highlighter adapters

[%autowidth]
|===
|Type |Syntax Highlighter |Required Gem |Compatible Converters

h|Client-side

|Highlight.js
|_n/a_
|HTML, Reveal.js

.3+h|Build-time

|CodeRay
|coderay (>= 1.1)
|HTML, PDF, EPUB3, Reveal.js

|Pygments
|pygments.rb (>= 1.2)
|HTML, PDF, EPUB3, Reveal.js

|Rouge
|rouge (>= 2)
|HTML, PDF, EPUB3, Reveal.js
|===

Asciidoctor does not apply syntax highlighting when generating DocBook.
The assumption is that this is a task the DocBook toolchain can handle.
The DocBook converter generates a `<programlisting>` element for the source block and passes through the source language as specified in the AsciiDoc.
It's then up to the DocBook toolchain to apply syntax highlighting to the contents of that tag.

You can explore these integrations in depth on the xref:#highlightjs.adoc[], xref:#rouge.adoc[], xref:#pygments.adoc[], and xref:#coderay.adoc[] pages.

You can also create your own integration by making a xref:#custom.adoc[].

== Custom subs on source blocks

You should not mix syntax highlighting with AsciiDoc text formatting (i.e., the `quotes` and `macros` substitutions).
In many converters, these two operations are mutually exclusive.

.Improper use of custom substitutions on a source block
[source,asciidoc]
....
[,java,subs=+quotes]
----
interface OrderRepository extends CrudRepository<Order,Long> {

  *List<Order>* findByCategory(String category);

  Order findById(long id);
}
----
....

The additional markup introduced by AsciiDoc text formatting may confuse the syntax highlighter and lead to unexpected results.
While it may work in some syntax highlighters in the HTML backend (which perhaps know how to work around the formatting tags), it will most certainly fail when converting to other formats such as PDF.

If you're going to customize the substitutions on a source block using the `subs` attribute, you should limit those substitutions to attribute replacements (`attributes`).

.Valid use of custom substitutions on a source block
[source,asciidoc]
....
[,java,subs=attributes+]
----
interface {model}Repository extends CrudRepository<{model},Long> {

  {model} findById(long id);
}
----
....

If you still need to emphasize certain tokens in the block of code, you should do so by creating a custom lexer or formatter for the syntax highlighting library that understands these additional semantics and perhaps even hints.
In other words, work through the syntax highlighter so it's added during the highlighting process, giving the syntax highlighter full knowledge as to what's going on.
Another option is to use a xref:#custom.adoc[custom syntax highlighter adapter].

Before trying to get the syntax highlighter to recognize new tokens, make sure it doesn't already recognize them.
If it does, it may just be a matter of customizing the syntax highlighter theme to apply different formatting to those tokens.

[[highlightjs.adoc]]
{empty}

// /modules/syntax-highlighting/pages/highlightjs.adoc
[[syntax-highlighting:highlightjs.adoc]]
= Highlight.js
:url-highlightjs: https://highlightjs.org/
:url-highlightjs-lang: https://highlightjs.org/download/
:url-highlightjs-cdn: https://cdnjs.com/libraries/highlight.js

{url-highlightjs}[Highlight.js^] is a popular client-side syntax highlighter that supports a broad range of {url-highlightjs-lang}[languages^].

== Activate highlight.js

To activate highlight.js, add the following attribute entry to the header of your AsciiDoc file:

[,asciidoc]
----
:source-highlighter: highlight.js
----

By default, Asciidoctor will link to the highlight.js library and stylesheet hosted on {url-highlightjs-cdn}[cdnjs^].
The version of the highlight.js library Asciidoctor loads from the CDN only includes support for languages in the common language bundle (apache, bash, coffeescript, cpp, cs, css, diff, http, ini, java, javascript, json, makefile, markdown, nginx, objectivec, perl, php, properties, python, ruby, shell, sql, xml, and yaml).

== Change the theme

The theme controls the colors that are used for the tokens (keywords, strings, methods, etc.) in the highlighted code.
By default, highlight.js is configured to use the github theme.
You can change the theme used by highlight.js by setting the `highlightjs-theme` attribute.

[,asciidoc]
----
:source-highlighter: highlight.js
:highlightjs-theme: monokai
----

The theme is loaded from the CDN, so any theme supported by the version of highlight.js that Asciidoctor uses is supported.
Refer to https://cdnjs.com/libraries/highlight.js/9.18.3 for a list of themes (filter by *Asset Type: Styling*).
The value of the `highlightjs-theme` attribute is the basename of the file minus the _.min.css_ file extension.

== Load support for additional languages

To load additional languages supported by highlight.js, list them in the value of the `highlightjs-languages` document attribute.
Separate each language by a comma followed by an optional space.

The common highlight.js bundle does not include support for Rust and Swift.
Let's set the `highlightjs-languages` attribute so the HTML converter loads support for them into the HTML page.

[,asciidoc]
----
:source-highlighter: highlight.js
:highlightjs-languages: rust, swift
----

The `highlightjs-languages` attribute only applies when generating a standalone HTML document (i.e., backend: html, standalone: true).
It does not work when generating embedded HTML, which is used by site generator integrations such as Antora.

== Use a custom highlight.js library

If you'd rather use a personal copy of highlight.js instead of the one hosted on the CDN, follow these steps:

. Create your custom bundle on the {url-highlightjs-lang}[download page^].
. Download and unpack the zip into a folder called [.path]_highlight_ adjacent to your AsciiDoc file (or in the output directory, if different)
. Rename [.path]_highlight/highlight.pack.js_ to [.path]_highlight/highlight.min.js_
. Rename [.path]_highlight/styles/github.css_ to [.path]_highlight/styles/github.min.css_
** Replace `github` with the name of the `highlightjs-theme` you are using, if different.
. Add the attribute entry `:highlightjsdir: highlight` to the header of your AsciiDoc file.
** Alternatively, you can pass the `-a highlightjsdir=highlight` flag when invoking the Asciidoctor CLI.

The output file will use your personal copy of the highlight.js library and stylesheet instead of the one hosted on cdnjs.

[[rouge.adoc]]
{empty}

// /modules/syntax-highlighting/pages/rouge.adoc
[[syntax-highlighting:rouge.adoc]]
= Rouge
:url-rouge: http://rouge.jneen.net
:url-rouge-gem: https://rubygems.org/gems/rouge
:url-rouge-repo: https://github.com/rouge-ruby/rouge/tree/HEAD/lib/rouge/themes

{url-rouge}[Rouge^] is an extendable code highlighter written in Ruby that supports a vast array of languages.

== Install Rouge

To use Rouge with Asciidoctor, you need the {url-rouge-gem}[rouge gem^].
You can use one of the following methods to install Rouge.

Install using `gem` (all systems)::
+
 $ gem install rouge

Install using `apt-get` (Debian-based systems)::
+
 $ sudo apt-get install ruby-rouge

Install using `dnf` (Fedora-based systems)::
+
 $ sudo dnf install rubygem-rouge

Install using `pacman` (Arch Linux-based systems)::
+
 $ sudo pacman -S ruby-rouge

== Assign rouge to source-highlighter

Once you've installed the gem, assign the `rouge` value to the `source-highlighter` attribute in the document header to activate it.

[,asciidoc]
----
:source-highlighter: rouge
----

== Rouge attributes

You can further customize the source block output with additional Rouge attributes.

rouge-css::
Controls what method is used for applying CSS to the tokens.
Can be `class` or `style`.
Default: `class`.

[.line-through]#rouge-linenums-mode# (not currently implemented, see https://github.com/asciidoctor/asciidoctor/issues/3641[#3641])::
Controls how line numbers are laid out.
Can be `table` or `inline`.
If line wrapping is enabled on preformatted blocks (i.e., `prewrap`), and you want to use line numbering on source blocks, you must set the value of this attribute to `inline` in order for the numbers to line up properly with their target lines.
Default: `table`.

rouge-style::
Controls the color theme used to for highlighting.
You can find the list of themes in the {url-rouge-repo}[Rouge code repository^].

Typically, you set these attributes using the CLI or API (e.g., `-a source-highlighter=rouge -a rouge-style=colorful`) so you don't have to define them in each document.
However, you can define them per document as shown in the following example.

.Activating the Rouge syntax highlighter and applying a different style
[source,asciidoc]
....
:source-highlighter: rouge
:rouge-style: monokai

[,ruby]
----
puts "Hello, Rouge!"
----
....

You can enable line numbering using the linenums option on the block.

.Customizing a source block with Rouge line numbers
[source,asciidoc]
....
:source-highlighter: rouge

[%linenums,ruby]
----
ORDERED_LIST_KEYWORDS = {
  'loweralpha' => 'a',
  'lowerroman' => 'i',
  'upperalpha' => 'A',
  'upperroman' => 'I'
   #'lowergreek' => 'a'
   #'arabic'     => '1'
   #'decimal'    => '1'
}
----
....

It's also possible to enable linenums for all source blocks by setting the `source-linenums-option` attribute on the document.

[[coderay.adoc]]
{empty}

// /modules/syntax-highlighting/pages/coderay.adoc
[[syntax-highlighting:coderay.adoc]]
= CodeRay
:url-coderay: http://coderay.rubychan.de/
:url-coderay-gem: https://rubygems.org/gems/coderay

{url-coderay}[CodeRay^] is an encoding-aware, syntax highlighter that supports the languages listed below.

[%autowidth,cols="4*",grid=none,frame=none]
|===
| C
| C++
| Clojure
| CSS

| Delphi
| diff
| ERB
| Go

| Groovy
| HAML
| HTML
| Java

| JavaScript
| JSON
| Lua
| PHP

| Python
| Ruby
| Sass
| SQL

| Taskpaper
| XML
| YAML
|
|===

== Install CodeRay

To use CodeRay with Asciidoctor, you need the {url-coderay-gem}[coderay gem^].
You can use one of the following methods to install CodeRay.

Install using gem (all systems)::
+
 $ gem install coderay

Install using apt-get (Debian-based systems)::
+
 $ sudo apt-get install ruby-coderay

Install using dnf (Fedora-based systems)::
+
 $ sudo dnf install rubygem-coderay

== Activate CodeRay

Once you've installed the gem, assign the `coderay` value to the `source-highlighter` attribute in the document header to activate it.

[,asciidoc]
----
:source-highlighter: coderay
----

== CodeRay attributes

You can further customize the source block output with additional CodeRay attributes.

coderay-css::
Controls what method is used for applying CSS to the tokens.
Can be `class` or `style`.
Default: `class`.

coderay-linenums-mode::
Controls how line numbers are laid out.
Can be `table` or `inline`.
If line wrapping is enabled on preformatted blocks (i.e., `prewrap`), and you want to use line numbering on source blocks, you must set the value of this attribute to `inline` in order for the numbers to line up properly with their target lines.
Default: `table`.

.Customizing a source block with CodeRay line numbers
[source,asciidoc]
....
:source-highlighter: coderay
:coderay-linenums-mode: inline

[%linenums,ruby]
----
ORDERED_LIST_KEYWORDS = {
  'loweralpha' => 'a',
  'lowerroman' => 'i',
  'upperalpha' => 'A',
  'upperroman' => 'I'
   #'lowergreek' => 'a'
   #'arabic'     => '1'
   #'decimal'    => '1'
}
----
....

See the xref:#coderay[CodeRay stylesheet section] to learn about the `coderay-css` attribute.

////
Note: I'm not getting this to work. Need to come back and do some quality assurance.
////

[[pygments.adoc]]
{empty}

// /modules/syntax-highlighting/pages/pygments.adoc
[[syntax-highlighting:pygments.adoc]]
= Pygments
:url-pygments: https://pygments.org
:url-pygments-lang: https://pygments.org/languages/
:url-python: https://www.python.org
:url-pygments-gem: https://rubygems.org/gems/pygments.rb

{url-pygments}[Pygments^] is a popular syntax highlighter that supports a broad range of {url-pygments-lang}[programming and template languages^].

== Install Pygments

In order to use Pygments with Asciidoctor, you need {url-python}[Python] and the {url-pygments-gem}[pygments.rb gem^].
The pygments.rb gem manages calls to Pygments, which is an external program that runs using Python.

TIP: You do not need to install Pygments itself.
It comes bundled with the pygments.rb gem.

IMPORTANT: You must have Python installed to use pygments.rb.

The version of Python required depends on which pygments.rb release you're using:

* pygments.rb 1.x requires Python 2.
Check that you have a `python2` (Linux), `python` (macOS), or `py -2` (Windows) executable on your PATH.
(On macOS, verify that the `python` executable uses Python 2 by running `python -V`).
* pygments.rb 2.x requires Python 3.
Check that you have a `python3` (Linux/macOS) or `py -3` (Windows) executable on your PATH.

.Installing Python and the pygments.rb gem via the CLI (cross platform)
[,console]
----
$ "`\which apt-get || \which dnf || \which yum || \which brew`" install python # <.>
$ gem install pygments.rb # <.>
----
<.> Install Python using your package manager
<.> Install the pygments.rb gem

== Activate Pygments

Once you've installed these libraries, assign `pygments` to the `source-highlighter` attribute in your document's header.

[,asciidoc]
----
:source-highlighter: pygments
----

== Pygments attributes

You can further customize the source block output with additional Pygments attributes.

pygments-style::
Sets the name of the color theme Pygments uses.
To see the list of available style names, see <<listing-pygments-style-names>>.
Default: `pastie`.

pygments-css::
Controls what method is used for applying CSS to the tokens.
Can be `class` (CSS classes) or `style` (inline styles).
See the xref:#pygments[Pygments stylesheet section] to learn more about how the value `class` is handled.
Default: `class`.

pygments-linenums-mode::
Controls how line numbers are arranged when line numbers are enabled on the source block.
Can be `table` or `inline`.
If line wrapping is enabled on preformatted blocks (i.e., `prewrap`), and you want to use line numbering on source blocks, you must set the value of this attribute to `inline` in order for the numbers to line up properly with their target lines.
Default: `table`.

.Customizing a source block with Pygments attributes
[source,asciidoc]
....
:source-highlighter: pygments
:pygments-style: manni
:pygments-linenums-mode: inline

[%linenums,ruby]
----
ORDERED_LIST_KEYWORDS = {
  'loweralpha' => 'a',
  'lowerroman' => 'i',
  'upperalpha' => 'A',
  'upperroman' => 'I'
   #'lowergreek' => 'a'
   #'arabic'     => '1'
   #'decimal'    => '1'
}
----
....

////
.Result: Source block using inline line numbers and the manni theme
====
image::custom-pygments.png[Line numbers and a custom Pygments theme for a source block.]
====
////

[#listing-pygments-style-names]
=== Available Pygments style names

To list the available Pygments styles, run the following command in a terminal:

 $ $(dirname $(gem which pygments.rb))/../vendor/pygments-main/pygmentize -L styles

The pygments.rb gem uses a bundled version of Pygments (often ahead of the latest release).
This command ensures that you are invoking the `pygmentize` command from the Pygments used by that gem.

[#pygments-timeout]
== Pygments timeout (pygments.rb 1.x only)

If you're using pygments.rb 1.x, you may need to adjust the timeout.
This configuration step is not necessary if you're using pygments.rb 2.x with Python 3.

Since Pygments is an external program, the call to that command in pygments.rb 1.x is managed by a timeout to safeguard against a hanging process.
By default, this timeout is 8 seconds.
If you discover that the call is failing to complete within this timeout period, you can increase the timeout (in seconds) by setting the `MENTOS_TIMEOUT` environment variable.

 export MENTOS_TIMEOUT=30

Now the call to Pygments (via pygments.rb 1.x) will be allocated up to 30 seconds to complete.

== Use a custom Pygments installation

If you already have Pygments installed on your system, you want to use your own fork, or you want to customize how Pygments is configured, you can get Asciidoctor to use a custom version of Pygments instead of the one bundled with the pygments.rb gem.

First, install your own version of Pygments.
You can do this, for instance, by cloning the upstream Pygments repository:

 $ hg clone https://bitbucket.org/birkenfeld/pygments-main pygments

Find the directory that contains the file [.path]_pygmentize_ or the [.path]_Makefile_.
That's your Pygments installation path.
Make note of it.

Next, create a script to run _before_ invoking Asciidoctor for the first time.
Let's call it [.path]_pygments_init.rb_.
Populate the script with the following content:

.pygments_init.rb
[,ruby]
----
require 'pygments'

# use a custom Pygments installation (directory that contains pygmentize)
Pygments.start '/path/to/pygments'

# example of registering a missing or additional lexer
#Pygments::Lexer.create name: 'Turtle', aliases: ['turtle'],
#    filenames: ['*.ttl'], mimetypes: ['text/turtle', 'application/x-turtle']
----

TIP: You could enhance this script to read the Pygments installation path from an environment variable (or configuration file).

Now just require this script before your invoke Asciidoctor the first time.
When using the `asciidoctor` command, pass the script using the `-r` flag:

 $ asciidoctor -r ./pygments_init.rb document.adoc

When using the Asciidoctor API, require the script using `require` or `require_relative`:

[,ruby]
----
require 'asciidoctor'
require_relative './pygments_init.rb'

Asciidoctor.convert_file 'document.adoc', safe: :safe
----

Now Asciidoctor is using your custom installation of Pygments instead of the one bundled with the pygments.rb gem.

Alternately, you can xref:#extend[extend the adapter for Pygments] and put this logic inside that adapter.

[[custom.adoc]]
{empty}

// /modules/syntax-highlighting/pages/custom.adoc
[[syntax-highlighting:custom.adoc]]
= Custom Syntax Highlighter Adapter
:navtitle: Custom Adapter
:apidoc-base: {url-api-gems}/asciidoctor/{release-version}/Asciidoctor
:apidoc-syntax-highlighter: {apidoc-base}/SyntaxHighlighter
:apidoc-syntax-highlighter-base: {apidoc-syntax-highlighter}/Base
:apidoc-syntax-highlighter-for: {apidoc-syntax-highlighter}/Factory#for-instance_method

You can integrate additional syntax highlighters into Asciidoctor by implementing and registering a syntax highlighter adapter.
You can either write a new adapter from scratch or you can extend and even replace one of the built-in adapters.

[#new]
== Create a new adapter

To implement a new adapter, you must create a class that extends the {apidoc-syntax-highlighter-base}[Asciidoctor::SyntaxHighlighter::Base] class, register the adapter for a value of the `source-highlighter` attribute, and implement the required methods.
Which methods are required depends on whether the adapter is for a client-side (runs in the browser) or build-time (runs when the document is converted) syntax highlighter.

Here's an example of how to write and register a syntax highlighter adapter for the Prism.js syntax highlighting library.
Prism.js is a client-side syntax highlighter, meaning it runs in the browser.
That means the adapter only has to implement methods that pertain to client-side syntax highlighting, which include `format`, `docinfo?`, and `docinfo`.

.Syntax highlighter adapter for Prism.js
[,ruby]
----
include::example$prism-syntax-highlighter.rb[]
----

Save this code to a file named [.path]_prism-syntax-highlighter.rb_.
Then, require this file when invoking Asciidoctor and set `source-highlighter=prism` to activate it:

 $ asciidoctor -r ./prism-syntax-highlighter -a source-highlighter=prism document.adoc

You can also define an adapter for a syntax highlighter that runs during conversion.
We'll look at doing that while also extending a built-in adapter.

[#extend]
== Extend an existing adapter

Instead of creating a new adapter, you can customize a built-in adapter by extending it, overriding its behavior, and optionally replacing it.

To extend an adapter, you need to look up a reference to the built-in adapter by name using the {apidoc-syntax-highlighter-for}[Asciidoctor::SyntaxHighlighter.for] method, create a class that extends it, register the adapter with a unique name (or the same name, if you want to replace it), and override any methods that provide the behavior you want to modify.

Here's the basic template for customizing an existing adapter:

[,ruby]
----
class CustomAdapter < (Asciidoctor::SyntaxHighlighter.for 'rouge')
  register_for 'rouge'

  # override methods go here
end
----

Let's look at some examples of how to customize a built-in adapter.

=== docinfo

Let's override the adapter for Pygments to prevent it from adding a stylesheet to the HTML (presumably because the styles will be provided by a different stylesheet).

.Extended syntax highlighter adapter for Pygments
[,ruby]
----
include::example$extended-pygments-syntax-highlighter.rb[]
----

Save this code to a file named [.path]_extended-pygments-syntax-highlighter.rb_.
Then, require this file when invoking Asciidoctor, setting `source-highlighter=pygments` to activate it, as you would normally do:

 $ asciidoctor -r ./extended-pygments-syntax-highlighter.rb -a source-highlighter=pygments document.adoc

If, instead, you wanted to modify the built-in adapter to honor the location of a custom stylesheet specified by the `pygments-stylesheet` attribute, you can do so by extending the adapter and overriding the `docinfo` method.

[,ruby]
----
include::example$pygments-syntax-highlighter-with-custom-stylesheet.rb[]
----

If you want to decorate built-in behavior, you can invoke the `super` method anywhere inside the method to delegate to the behavior provided by the built-in adapter.

=== highlight

Let's say you always want lines to be numbered, regardless of the setting in the document.
You can do so by overriding the `highlight` method, setting the `:number_lines` key on the `opts` argument, then delegating back to the built-in adapter using `super`.

[,ruby]
----
include::example$always-number-lines.rb[]
----

=== create_formatter (Rouge)

When using Rouge as the syntax highlighter, you can customize the formatter by overriding the `create_formatter` method.
This allows you to add custom logic for handling certain tokens in the source language.

Let's assume that you want to look for bare URLs in code comments and translate them into links (i.e., autolinks), just like in AsciiDoc.
You can do that by weaving extra logic into the formatter that looks for tokens in the `Comment` category and applies a substitution to the value.

[,ruby]
----
include::example$autolink-urls-in-comments.rb[]
----

Since the formatter has access to all the tokens in the code identified by the syntax highlighter, this technique opens up a lot of possibilities.
For example, you could look for the `Type` token in the `Keyword` category in Java code and create a link to the API docs.
The `lang` argument to the `create_formatter` method lets you know the source language (e.g., `java`) to which the tokens belong.

To study the logic you may be interesting in overriding, browse the code for the https://github.com/asciidoctor/asciidoctor/tree/{page-origin-refname}/lib/asciidoctor/syntax_highlighter[built-in syntax highlighter adapters].

// /modules/stem/pages/index.adoc
[[stem:index.adoc]]
= STEM Processing

AsciiDoc defines syntax elements for adding xref:#asciidoc:stem:stem.adoc[science, technology, engineering, and math (STEM) expressions] to an AsciiDoc document.
Much like AsciiDoc itself, this STEM notation allows the graphical notation that scientists, mathematicians, and engineers use to describe equations, formulas, etc. be expressed in a plain text format.
It's up to the converter to interpret and transform the source of these expressions into a displayable format.
That's where STEM processing comes in.

On this page, we look at how STEM expressions are handled when converting AsciiDoc and survey the integrations Asciidoctor offers to process them for various output formats.

== How it works

When a converter comes across a STEM node in an AsciiDoc document, it passes the source of the expression to a STEM processing library, such as MathJax.
That library either displays the rendered expression itself (e.g., MathJax), turns it into an image the converter can link to or embed in the output file (e.g., Asciidoctor Mathematical), or translates it into another format that something further down the pipeline can process (e.g., AsciiMath).

The STEM integrations are activated when the xref:#asciidoc:stem:stem.adoc[stem document attribute] is set on the document and, if required, the relevant library is installed.

== STEM integrations

[%autowidth]
|===
|Library Name |Supported Versions |Backends |Loaded By

|MathJax
|2.7.9
|html
|client

|Asciidoctor Mathematical
|0.3.5
|any
|processor

|AsciiMath (Ruby)
|1.0.x or 2.0.x
|docbook
|processor
|===

You can explore these integrations in depth on the xref:#mathjax.adoc[], xref:#mathematical.adoc[], and xref:#asciimath-gem.adoc[] pages.

If you're planning to convert to DocBook to leverage the DocBook toolchain, be sure to consider xref:#docbook.adoc[] when deciding which STEM notation to use in your AsciiDoc document.

// /modules/stem/pages/mathjax.adoc
[[stem:mathjax.adoc]]
// TODO: document how to change eqnums
= MathJax and HTML
:url-mathjax: https://www.mathjax.org
:url-asciimath: https://docs.mathjax.org/en/latest/input/asciimath.html
:url-latexmath: https://docs.mathjax.org/en/latest/input/tex/index.html
:stem:

{url-mathjax}[MathJax^] is a JavaScript library for displaying interactive LaTeX, AsciiMath, and MathML expressions in the browser.
The Asciidoctor HTML converter integrates with MathJax to provide STEM processing for {url-asciimath}[AsciiMath^] and {url-latexmath}[TeX and LaTeX^] notation used in an AsciiDoc document.
This integration offers simple, out-of-the-box support for STEM content when converting to HTML.

== How it works

If you convert your document to HTML using the HTML converter, and the `stem` document attribute is set on your document, the HTML will be configured to automatically load MathJax into the page from a CDN.
There's nothing you have to install.
Specifically, it loads the MathJax bundle that includes support for both TeX and AsciiMath, as shown here:

[,html]
----
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
----

After the page loads, MathJax scans for expressions inside special delimiters and transforms them into a displayable format.
You may notice a brief flash of the expression in source form while this is happening.

Here's an example of a STEM expression written in AsciiMath and rendered by MathJax.

[stem]
++++
e = sum_(n=0)^oo 1 / n!
++++

If you right click on the rendered expression, you'll notice its interactive.
One of the options even allows you to view the original AsciiMath input.

== Custom delimiters

The delimiters that the HTML converter places around the expressions to tell MathJax what to process are not the same as the ones MathJax looks for by default.
These custom delimiters were chosen to avoid conflicts with other syntax in the AsciiDoc language.

The converter configures MathJax to look for the custom delimiters it emits.
If you look at the HTML source, you'll see a text/x-mathjax-config stanza that defines them, as well as some other settings.

== Alternatives

The MathJax integration is currently only designed for HTML output.
When converting to other backend formats, additional libraries are needed.
A good alternative is xref:#mathematical.adoc[].

[[mathematical.adoc]]
{empty}

// /modules/stem/pages/mathematical.adoc
[[stem:mathematical.adoc]]
= Asciidoctor Mathematical
:url-asciidoctor-mathematical: https://github.com/asciidoctor/asciidoctor-mathematical
:url-asciidoctor-docker: https://github.com/asciidoctor/docker-asciidoctor

{url-asciidoctor-mathematical}[Asciidoctor Mathematical] is an Asciidoctor extension that provides an alternate solution for converting STEM expressions in an AsciiDoc document into a displayable format.
It has the benefit of working across all converters.

The library is called Asciidoctor Mathematical because it relies on the Mathematical library to parse and transform (aka render) LaTeX expressions.
It also uses the AsciiMath library to convert AsciiMath notation to LaTeX so Mathematical can process it.

This page explains how Asciidoctor Mathematical works, how to install it and activate it, and where to go to learn more information about it.

== How it works

The library works by visiting each STEM node in the parsed document and converting it to an image, effectively replacing the STEM node with an image node.
This takes the burden of transforming the STEM expressions off of the converter.
All the converter sees are image nodes that reference the generated images.

Upon visiting each STEM node, the extension first extracts the expression source.
If the expression is written in AsciiMath, the extension uses the AsciiMath library to convert that expression to LaTeX.
The extension then passes the expression to Mathematical to render it as an image.
The image is sized automatically to accommodate the rendered expression and, if necessary, resized to fit within the line.
Once the image is generated, the extension replaces the STEM node in the parsed document with an image node that references the generated image.

When the extension finishes processing all the STEM nodes, it unsets the `stem` attribute on the document to indicate no further STEM processing should be performed on the document.

== Benefits and drawbacks

Since Asciidoctor Mathematical replaces all STEM nodes with image nodes, it serves as an all-purpose solution for STEM processing.
All converters know how do deal with image nodes.
The extension can be used with the built-in converters as well as add-on converters such as PDF and EPUB3.

The main drawback of Asciidoctor Mathematical when compared to MathJax is that you don't have a lot of control over the size and resolution of the images it generates.
It also lacks the interactivity with the expression that MathJax provides.
So when you're converting to HTML, MathJax is going to give you a better result.

Another drawback when compared to MathJax is that it requires installing an extra library, and that library can be difficult to install.
Nonetheless, if you need it and you're up for the challenge, that's where we're headed next.

== Install

Asciidoctor Mathematical is distributed as a gem named https://rubygems.org/gems/asciidoctor-mathematical[asciidoctor-mathematical^].
You can install it using the Ruby packaging tools (gem or bundle).

 $ gem install asciidoctor-mathematical

However, you may run into difficulty installing this gem.
Asciidoctor Mathematical depends on Mathematical, which is a native gem.
In other words, Mathematical must be recompiled during installation, which requires access to build tools and native development libraries on the host system.
//Furthermore, this compilation currently only works on Linux and on macOS with Xcode.
Furthermore, this compilation currently only works on Linux.
You cannot install this gem on Windows.
Please refer to the {url-asciidoctor-mathematical}/#installation[installation section] in the Asciidoctor Mathematical documentation to learn which system tools and development libraries you need in order to install it.

If you run into problems installing this gem, or need to use it on Windows, consider using the {url-asciidoctor-docker}[Asciidoctor Docker container].
The Asciidoctor Docker container launches with the asciidoctor-mathematical gem preinstalled.

== Activate

//To activate the Asciidoctor Mathematical extension, you must require the gem when invoking Asciidoctor:
Once Asciidoctor Mathematical is installed, you can activate the extension when invoking Asciidoctor using the `-r` flag:

 $ asciidoctor -r asciidoctor-mathematical stem-sample.adoc

If you're invoking Asciidoctor via the API, you must require the gem before invoking Asciidoctor:

[,ruby]
----
require 'asciidoctor-mathematical'

Asciidoctor.convert_file 'stem-sample.adoc', safe: :safe
----

When the extension is activated, it will automatically find STEM nodes in the parsed document and replace them with images.

== Improve image resolution

To get the best quality output and maximize speed of conversion, you should configure Asciidoctor Mathematical to generate SVG files.
You control this setting using the `mathematical-format` AsciiDoc attribute as follows:

 $ asciidoctor -r asciidoctor-mathematical -a mathematical-format=svg stem-sample.adoc

The extension will now generate SVG images instead of PNG images.

== More info

To learn more about how to use this extension and the options it provides, see the {url-asciidoctor-mathematical}[project's README].

[[docbook.adoc]]
{empty}

// /modules/stem/pages/docbook.adoc
[[stem:docbook.adoc]]
= STEM Support in the DocBook Toolchain
:url-jeuclid-fop: http://jeuclid.sourceforge.net/jeuclid-fop/index.html

The DocBook toolchain has some support for STEM processing, though it varies depending on which DocBook pipeline you're using and which integrations you have enabled.
Since the DocBook toolchain is most often used to generate PDF output, let's look at how STEM processing is supported in the two pipelines for PDF generation: dblatex and fop.

dblatex::
If you're using the dblatex pipeline to produce PDF, the DocBook toolchain provides built-in processing for LaTeX and MathML notation.
If you write your STEM expressions using the latexmath notation, you're all set.
But that only gets us half way.
What if you write STEM expressions in AsciiMath?
The pipeline does not understand AsciiMath, but it does understand MathML.
And that's something the DocBook converter can produce.
If you have the AsciiMath gem installed, the DocBook converter will translate AsciiMath to MathML.
That means when you're using this pipeline, you can write STEM expressions in both the AsciiMath and LaTeX notations.

fop::
If you're using the fop pipeline, the STEM support provided by the DocBook toolchain is more spotty.
This pipeline does not support LaTeX notation at all, and there's no library that integrations with Asciidoctor like AsciiMath to convert LaTeX notation to MathML.
So you cannot write STEM expressions in LaTeX when using this pipeline.
If that's important to you, consider using the dblatex pipeline instead.
There's still a path for writing STEM expressions in AsciiMath.
If you're running the DocBook toolchain using Java, you can configure the JEuclid integration (by activating the {url-jeuclid-fop}[JEuclid FOP plugin^]) to get MathML support.
That means we can turn again to the AsciiMath gem when converting to DocBook.
The DocBook converter integrates with the AsciiMath gem, if available, to convert the AsciiMath notation to MathML, which the fop pipeline can understand.

While neither DocBook pipeline understands AsciiMath, we can leverage the AsciiMath gem to feed it something it does understand, MathML.
Let's explore the xref:#asciimath-gem.adoc[AsciiMath gem] in more detail.

// /modules/stem/pages/asciimath-gem.adoc
[[stem:asciimath-gem.adoc]]
// add note about warning when asciimath gem is not available
= AsciiMath Gem
:url-asciimath-repo: https://github.com/asciidoctor/AsciiMath
:stem:

The DocBook toolchain has some support for STEM processing, though it varies depending on which DocBook pipeline you're using and which integrations you have enabled.
But there's one thing we know for sure.
The DocBook toolchain does not understand AsciiMath.
That's where the {url-rubygems}/asciimath[AsciiMath gem^] comes in.

== AsciiMath and DocBook

The AsciiMath gem translates AsciiMath expressions to MathML, which is something the DocBook toolchain is capable of processing.
When the AsciiMath gem is available, the DocBook converter uses it to convert STEM expressions written in AsciiMath notation to MathML and embeds the MathML into the generated DocBook.
Processing the MathML into a displayable format is left up to the DocBook toolchain.

[#install]
== Install

To enable AsciiMath to MathML translation when converting to DocBook, you first need to install the asciimath gem:

 $ gem install asciimath

== Usage

It's not necessary to require the `asciimath` gem explicitly.
As long as the AsciiMath gem is available, the DocBook converter will automatically load and use it to translate AsciiMath notation to MathML.

If the gem is not available, and there's at least one AsciiMath expression in the document, you will see the following message when converting to DocBook:

....
asciidoctor: WARNING: optional gem 'asciimath' is not available. Functionality disabled.
....

The functionality referenced here is the translation from AsciiMath to MathML.
If you see this message, refer back to <<Install>>.

Assuming you have it installed, let's look at an example.

First, activate STEM support in AsciiDoc by setting the `stem` document attribute.
This attribute must be set by the end of the document header.

.Activate STEM support by setting the stem document attribute
[,asciidoc]
----
= Document Title
:stem:

stem:[sqrt(4)] is the square root of 4, which is 2.
----

Now let's convert this document to DocBook using the DocBook converter:

 $ asciidoctor -b docbook asciimath-sample.adoc

The DocBook converter will emit the following XML into the generated document:

[,xml]
----
<inlineequation><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msqrt><mml:mn>4</mml:mn></mml:msqrt></mml:math></inlineequation>
----

It's now up to the DocBook toolchain to convert the MathML embedded in the DocBook into a displayable format.
Here's the result you should see:

====
stem:[sqrt(4)] is the square root of 4, which is 2.
====

// /modules/extensions/pages/index.adoc
[[extensions:index.adoc]]
= Extensions
:url-ext-lab: https://github.com/asciidoctor/asciidoctor-extensions-lab

Extensions are central to the success of AsciiDoc because they open up the language to new use cases.
Asciidoctor provides an {url-api-gems}/asciidoctor/{release-version}/Asciidoctor/Extensions[extension API^] that offers a superset of extension points.
As a result, extensions in Asciidoctor are easy to write, powerful, and simple to distribute.

Asciidoctor also allows extensions to be written using the full power of a programming language (whether it be Ruby, Java, Groovy or JavaScript).
You don't have to shave yaks to get the functionality you want, and you can distribute the extension using de facto standard packaging mechanisms like gems or JARs.

== Available extension points

Asciidoctor provides the following extension points:

Preprocessor::
Processes the raw source lines before they are passed to the parser.
See xref:#preprocessor.adoc[].

Tree processor::
Processes the [.class]#Asciidoctor::Document# (AST) once parsing is complete.
See xref:#tree-processor.adoc[].

Postprocessor::
Processes the output after the document has been converted, but before it's written to disk.
See xref:#postprocessor.adoc[].

Docinfo Processor::
Adds additional content to the header or footer regions of the generated document.
See xref:#docinfo-processor.adoc[].

Block processor::
Processes a block of content marked with a custom block style (i.e., `[custom]`). (similar to an AsciiDoc filter)
See xref:#block-processor.adoc[].

Compound block processor::
Register a custom block named `collapsible` that transforms a listing block into a compound block.
See xref:#compound-block-processor.adoc[].

Block macro processor::
Registers a custom block macro and processes it (e.g., `gist::12345[]`).
See xref:#block-macro-processor.adoc[].

Inline macro processor::
Registers a custom inline macro and processes it (e.g., `btn:[Save]`).
See xref:#inline-macro-processor.adoc[].

Include processor::
Processes the `include::<filename>[]` directive.
See xref:#include-processor.adoc[].

There are additional extension examples in the {url-ext-lab}[Asciidoctor extensions lab^].

// /modules/extensions/pages/register.adoc
[[extensions:register.adoc]]
= Register Extensions

== Register one or more extensions

These extensions are registered per document using a callback that feels like a DSL:

[,ruby]
----
Asciidoctor::Extensions.register do
  preprocessor FrontMatterPreprocessor
  tree_processor ShellSessionTreeProcessor
  postprocessor CopyrightFooterPostprocessor
  docinfo_processor TrackingCodeDocinfoProcessor if @document.basebackend? 'html'
  block ShoutBlock
  block_macro GistBlockMacro if @document.basebackend? 'html'
  inline_macro ManInlineMacro
  include_processor UriIncludeProcessor
end
----

CAUTION: Extension classes must be defined outside of the register block.
Once an extension class is registered, it is frozen, preventing further modification.
If you define an extension class inside the register block, it will result in an error on subsequent invocations.

You can register more than one processor of each type, though you can only have one processor per custom block or macro.
Each registered class is instantiated when the [.class]#Asciidoctor::Document# is created.

// /modules/extensions/pages/logging.adoc
[[extensions:logging.adoc]]
= Log from an Extension

If a problem occurs while an extension is running, you probably want to communicate that information to the user.
The extension should only throw an error (i.e., raise an exception) if the problem is so severe that no additional processing should be done.
Otherwise, we recommend that extensions report the problem as a log message at an appropriate severity level.
You can use Asciidoctor's logger to log messages.

When Asciidoctor processes a document, it creates a https://ruby-doc.org/3.2.2/stdlibs/logger/Logger.html[Logger^] instance scoped to that document.
You can access that logger in your extension to log messages.
This page describes how to do that.

== Mix in the Logger

To access the instance of Asciidoctor's Logger, you must include the `Asciidoctor::Logging` module into your extension.
In doing so, it will provide access to the static `logger` method, which will retrieve the instance from the `LoggerManager`.

TIP: The logger can also be accessed using the `logger` method on the document object.
If you're writing an extension that has access to the document object, this may be a simpler approach.

If you're writing a class-based extension, you can include the `Logging` module using the `include` keyword.

[,ruby]
----
class CustomBlock < Asciidoctor::Extensions::BlockProcessor
  include Asciidoctor::Logging

  # ...
end

Asciidoctor::Extensions.register do
  block CustomBlock, :custom
end
----

If you're writing an extension purely using the DSL, the processor class is created dynamically.
Therefore, you need to mix in the `Logging` module by referencing the `include` method on that class instead.

[,ruby]
----
Asciidoctor::Extensions.register do
  block :custom do
    singleton_class.include Asciidoctor::Logging

    # ...
  end
end
----

[TIP]
====
As mentioned above, you can access the logger from the `logger` method on the document object that's passed to the extension's process method.
For example:

[,ruby]
----
Asciidoctor::Extensions.register do
  block :custom do
    process do |doc, reader, attrs|
      puts doc.logger

      # ...
    end
  end
end
----
====

In order to log a message, pass the message string to one of the severity methods (e.g., `error`, `warn`, `info`, etc) on the logger instance returned by the `logger` method.
Here's an example of how to log a warning message in the process method.

[,ruby]
----
def process doc, reader, attrs
  logger.warn 'We are logging!'

  # ...
end
----

Here's what Asciidoctor will print to the log:

[.output]
....
asciidoctor: WARN: We are logging!
....

Refer to the documentation for https://ruby-doc.org/3.2.2/stdlibs/logger/Logger.html[Logger^] to learn about the available methods.

Here's a complete example to show where these additions are used in context:

[,ruby]
----
Asciidoctor::Extensions.register do
  block :custom do
    singleton_class.include Asciidoctor::Logging

    on_context :paragraph
    process do |parent, reader, attrs|
      logger.warn 'We are logging!'
      create_paragraph parent, reader.lines, attrs
    end
  end
end
----

Keep in mind that the message will only be displayed if its severity level is enabled by the user.
By default, error and warn(ing) messages will be displayed.

You should refrain from using the `fatal` method unless the extension is in the process of throwing an error.

== Add context to the message

If you pass a string to the log method, Asciidoctor will only print the severity level and the message.
That means the user won't know what AsciiDoc source the message refers to nor that the message is coming from an extension.
Therefore, you'll probably want to provide more detail.
Let's begin by including the extension name in the message.

=== Add the extension name

First, when logging a message, you should prefix that message with the name of the extension.

[,ruby]
----
logger.warn '(custom-block-extension) Something is out of sorts.'
----

That will print the message as follows:

[.output]
....
asciidoctor: WARN: (custom-block-extension) Something is out of sorts.
....

Alternately, you can move your extension name so that it immediately follows the program name (i.e., `asciidoctor`).

[,ruby]
----
logger.log ::Logger::WARN, 'hi', %(#{logger.progname} (custom-block-extension))
----

That will print the message as follows:

[.output]
....
asciidoctor (custom-block-extension): WARN: Something is out of sorts.
....

Another way to get the same output is to use the form that accepts the message as a block.

[,ruby]
----
logger.warn(%(#{logger.progname} (custom-block-extension))) { 'Something is out of sorts.' }
----

The block form is useful in other ways.
If the computation of the message is expensive, the block form defers evaluation of the message until (and thus if) it is logged.

Now the reader knows that the message is coming from an extension, but not the location of the AsciiDoc source the extension is processing.
Let's look at how to do that.

=== Add the source location

In addition to the `logger` method, Asciidoctor's `Logging` module also adds a helper named `message_with_context` that generates a message object that bundles source information with the string message.

For block and block macro extensions, you probably want to reference the location where the block is found, which you can retrieve using the `parent.document.reader.cursor_at_mark` method call.
For a tree processor extension, you can retrieve the source location from the `source_location` method on the block.
For most other extensions, you likely want to reference the current cursor, which is accessible from `parent.document.reader.cursor` or (`doc.reader` for extensions that only provide access to the document object).

Here's an example that replaces the message with an object that includes the source location:

[,ruby]
----
logger.warn %(#{logger.progname} (custom-block-extension)) do
  message_with_context 'Something is out of sorts.', source_location: parent.document.reader.cursor_at_mark
end
----

Here's an example of what Asciidoctor will print:

[.output]
....
asciidoctor (custom-block-extension): WARNING: test.adoc: line 4: Something is out of sorts.
....

In a tree processor extension, you can get the source location from any block if the sourcemap is enabled.
If it's not enabled, the code will degrade gracefully by logging the message without the source location.

[,ruby]
----
Asciidoctor::Extensions.register do
  tree_processor do |doc|
    singleton_class.include Asciidoctor::Logging
    doc.find_by context: :paragraph do |paragraph|
      logger.warn %(#{logger.progname} (custom-tree-processor)) do
        message_with_context 'Found paragraph.', source_location: paragraph.source_location
      end
    end
    nil
  end
end
----

Source location tracking in Asciidoctor is not perfect, so you may need to retrieve the cursor and adjust it slightly to align it with the line you want to reference in the message.

Refer to {url-api-gems}/asciidoctor/{release-version}/Asciidoctor/Reader#cursor-instance_method[Reader#cursor^] for a list of cursor methods.

[[preprocessor.adoc]]
{empty}

// /modules/extensions/pages/preprocessor.adoc
[[extensions:preprocessor.adoc]]
= Preprocessor Extension
:navtitle: Preprocessor

The {url-api-gems}/asciidoctor/{release-version}/Asciidoctor/Extensions/Preprocessor[Preprocessor^] extension runs prior to the AsciiDoc source being parsed.
Specifically, it runs after the Document instance has been created and its PreprocessorReader has been initialized to start reading the lines of the source document.

[WARNING]
====
If the preprocessor extension reads lines from the reader, it will cause side effects.
One of these side effects is that document attributes in the header may not be interpreted correctly.
Another is that it may interfere with line number tracking.
If the extension adds or removes lines, the parser could produce misleading line number information.
Thus, interacting with the reader in a preprocessor extension should be avoided, if possible.

A preprocessor extension can still be used to modify options on the Document object, in which case there's no side effect.
It can also be safely used as an event listener, perhaps to run other code.
It may also be possible to avoid side effects by reading lines above the actual AsciiDoc document, as is shown in the example on this page.
It's safe to do so because these lines are not interpreted as AsciiDoc.
====

Prior to invoking the preprocessor extension, Asciidoctor splits the source text of the primary document into lines and xref:#asciidoc::normalization.adoc[normalizes them].
It then creates an instance of PreprocessorReader from these lines.

Asciidoctor then passes the Document and PreprocessorReader instances to the `Asciidoctor::Extensions::Processor#process` method of the extension.
If the extension reads lines from reader, those lines will first be preprocessed by Asciidoctor's internal preprocessor.
The extension can modify the Reader and either return the same Reader (or falsy, which is equivalent) or a new Reader instance to replace it.
However, as stated above, be careful when reading lines from the original PreprocessorReader instance as it can have side effets.

== Preprocessor Extension Example

Purpose::
Skim off front matter from the top of the document that gets used by site generators like Jekyll.

=== sample-with-front-matter.adoc

[source,asciidoc]
....
tags: [announcement, website]
---
= Document Title

content

[subs=+attributes]
.Captured front matter
----
---
{front-matter}
---
----
....

=== FrontMatterPreprocessor

[,ruby]
----
class FrontMatterPreprocessor < Asciidoctor::Extensions::Preprocessor
  def process document, reader
    lines = reader.lines # get raw lines
    return reader if lines.empty?
    front_matter = []
    if lines.first.chomp == '---'
      original_lines = lines.dup
      lines.shift
      while !lines.empty? && lines.first.chomp != '---'
        front_matter << lines.shift
      end

      if (first = lines.first).nil? || first.chomp != '---'
        lines = original_lines
      else
        lines.shift
        document.attributes['front-matter'] = front_matter.join.chomp
        # advance the reader by the number of lines taken
        (front_matter.length + 2).times { reader.advance }
      end
    end
    reader
  end
end
----

=== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  preprocessor FrontMatterPreprocessor
end

Asciidoctor.convert_file 'sample-with-front-matter.adoc', safe: :safe
----

[[tree-processor.adoc]]
{empty}

// /modules/extensions/pages/tree-processor.adoc
[[extensions:tree-processor.adoc]]
= Tree Processor Extension
:navtitle: Tree Processor

A {url-api-gems}/asciidoctor/{release-version}/Asciidoctor/Extensions/TreeProcessor[TreeProcessor^] extension is run on the Document instance after the blocks in the source have been parsed into a document structure, as represented by the Document object and its child AbstractNode objects (e.g., Section, Block, List, ListItem).

Asciidoctor invokes the `Processor#process` method on an instance of each registered TreeProcessor extension.

IMPORTANT: A TreeProcessor extension is run before any inline markup is interpreted.
At the time the process method on the TreeProcessor extension is invoked, the block nodes in the document have unprocessed, unconverted text.
Conversion of inline markup is done when the document is being converted.
Thus, it's possible for the TreeProcessor extension to replace the source text on the nodes, but it must consider the fact that the text is still going to be parsed (according to the content model of the block).

== Tree Processor Extension Example

Purpose::
Detect literal blocks that contain shell commands, strip the prompt character and style the command using CSS in such a way that the prompt character cannot be selected (as seen on help.github.com).

=== sample-with-shell-session.adoc

[,asciidoc]
----
 $ echo "Hello, World!"
 > Hello, World!

 $ gem install asciidoctor
----

=== ShellSessionTreeProcessor

[,ruby]
----
class ShellSessionTreeProcessor < Asciidoctor::Extensions::TreeProcessor
  LF = ?\n

  def process document
    (document.find_by(context: :literal) {|candidate| candidate.lines[0].start_with? '$ ', '> ' }).each do |block|
      (children = block.parent.blocks)[children.index block] = convert_to_terminal_listing block
    end
    nil
  end

  def convert_to_terminal_listing block
    attrs = block.attributes
    attrs['role'] = 'terminal'
    prompt_attr = (attrs.key? 'prompt') ? %( data-prompt="#{block.sub_specialchars attrs['prompt']}") : nil
    lines = (block.content.split LF).map do |line|
      if line.start_with? '$ '
        %(<span class="command"#{prompt_attr}>#{line[2..-1]}</span>)
      elsif line.start_with? '&gt; '
        %(<span class="output">#{line[5..-1]}</span>)
        #%(<span class="output"><span class="comment-prefix"># </span>#{line[5..-1]}</span>)
      else
        line
      end
    end
    create_listing_block block.parent, lines * LF, attrs, subs: nil
  end
end
----

=== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  tree_processor ShellSessionTreeProcessor
end

Asciidoctor.convert_file 'sample-with-shell-session.adoc', safe: :safe
----

[[postprocessor.adoc]]
{empty}

// /modules/extensions/pages/postprocessor.adoc
[[extensions:postprocessor.adoc]]
= Postprocessor Extension Example
:navtitle: Postprocessor

Purpose::
Insert copyright text in the footer.

== CopyrightFooterPostprocessor

[,ruby]
----
class CopyrightFooterPostprocessor < Asciidoctor::Extensions::Postprocessor
  def process document, output
    content = (document.attr 'copyright') || 'Copyright Acme, Inc.'
    if document.basebackend? 'html'
      replacement = %(<div id="footer-text">\\1<br>\n#{content}\n</div>)
      output = output.sub(/<div id="footer-text">(.*?)<\/div>/m, replacement)
    elsif document.basebackend? 'docbook'
      replacement = %(<simpara>#{content}</simpara>\n\\1)
      output = output.sub(/(<\/(?:article|book)>)/, replacement)
    end
    output
  end
end
----

== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  postprocessor CopyrightFooterPostprocessor
end

Asciidoctor.convert_file 'sample-with-copyright-footer.adoc', safe: :safe
----

[[docinfo-processor.adoc]]
{empty}

// /modules/extensions/pages/docinfo-processor.adoc
[[extensions:docinfo-processor.adoc]]
= Docinfo Processor Extension Example
:navtitle: Docinfo Processor

Purpose::
Appends the Google Analytics tracking code to the bottom of an HTML document.

== GoogleAnalyticsDocinfoProcessor

[,ruby]
----
class GoogleAnalyticsDocinfoProcessor < Asciidoctor::Extensions::DocinfoProcessor
  use_dsl
  at_location :footer
  def process document
    return unless (ga_account_id = document.attr 'google-analytics-account')
    %(<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','#{ga_account_id}','auto');
ga('send','pageview');
</script>)
  end
end
----

== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  docinfo_processor GoogleAnalyticsDocinfoProcessor
end

Asciidoctor.convert_file 'sample.adoc', safe: :safe, attributes: 'google-analytics-account=UA-ABCXYZ123'
----

[[block-processor.adoc]]
{empty}

// /modules/extensions/pages/block-processor.adoc
[[extensions:block-processor.adoc]]
= Block Processor Extension Example
:navtitle: Block Processor

Purpose::
Register a custom block style named `shout` that uppercases all the words and converts periods to exclamation points.

== sample-with-shout-block.adoc

[,asciidoc]
----
[shout]
The time is now. Get a move on.
----

== ShoutBlock

[,ruby]
----
class ShoutBlock < Asciidoctor::Extensions::BlockProcessor
  PeriodRx = /\.(?= |$)/

  use_dsl

  named :shout
  on_context :paragraph
  name_positional_attributes 'vol'
  parse_content_as :simple

  def process parent, reader, attrs
    volume = ((attrs.delete 'vol') || 1).to_i
    create_paragraph parent, (reader.lines.map {|l| l.upcase.gsub PeriodRx, '!' * volume }), attrs
  end
end
----

== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  block ShoutBlock
end

Asciidoctor.convert_file 'sample-with-shout-block.adoc', safe: :safe
----

[[compound-block-processor.adoc]]
{empty}

// /modules/extensions/pages/compound-block-processor.adoc
[[extensions:compound-block-processor.adoc]]
= Compound Block Processor Example
:navtitle: Compound Block Processor

Purpose::
Register a custom block named `collapsible` that transforms a listing block into a compound block composed of the following:

* an example block with the collapsible option enabled
* the original listing block
* the listing block is promoted to a source block if a language is specified using the second positional attribute.

.sample-with-collapsible-block.adoc
[source,asciidoc]
....
.Show JSON
[collapsible,json]
----
{
   "foo": "bar"
}
----
....

.collapsible-block.rb
[,ruby]
----
class CollapsibleBlock < Asciidoctor::Extensions::BlockProcessor
  enable_dsl
  on_context :listing
  positional_attributes 'language'

  def process parent, reader, attrs
    lang = attrs.delete 'language'
    attrs['title'] ||= 'Show Listing'
    example = create_example_block parent, [], attrs, content_model: :compound
    example.set_option 'collapsible'
    listing = create_listing_block example, reader.readlines, nil
    if lang
      listing.style = 'source'
      listing.set_attr 'language', lang
      listing.commit_subs
    end
    example << listing
    example
  end
end

Asciidoctor::Extensions.register do
  block CollapsibleBlock, :collapsible
end
----

.Usage
 $ asciidoctor -r ./collapsible-block.rb sample-with-collapsible-block.adoc

NOTE: This extension mimics the builtin `collapsible` option on the example block, but consolidates it to a single block.
The purpose of this extension is to show how to assemble a compound block in an extension.

[[block-macro-processor.adoc]]
{empty}

// /modules/extensions/pages/block-macro-processor.adoc
[[extensions:block-macro-processor.adoc]]
= Block Macro Processor Extension Example
:navtitle: Block Macro Processor

Purpose::
Create a block macro named `gist` for embedding a gist.

== sample-with-gist-macro.adoc

[,asciidoc]
----
.My Gist
gist::123456[]
----

== GistBlockMacro

[,ruby]
----
class GistBlockMacro < Asciidoctor::Extensions::BlockMacroProcessor
  use_dsl

  named :gist

  def process parent, target, attrs
    title_html = (attrs.has_key? 'title') ?
        %(<div class="title">#{attrs['title']}</div>\n) : nil

    html = %(<div class="openblock gist">
#{title_html}<div class="content">
<script src="https://gist.github.com/#{target}.js"></script>
</div>
</div>)

    create_pass_block parent, html, attrs, subs: nil
  end
end
----

== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  block_macro GistBlockMacro if document.basebackend? 'html'
end

Asciidoctor.convert_file 'sample-with-gist.adoc', safe: :safe
----

[[inline-macro-processor.adoc]]
{empty}

// /modules/extensions/pages/inline-macro-processor.adoc
[[extensions:inline-macro-processor.adoc]]
= Inline Macro Processor Extension Example
:navtitle: Inline Macro Processor

Purpose::
Create an inline macro named `man` that links to another man page.

== sample-with-man-link.adoc

[,asciidoc]
----
See man:gittutorial[7] to get started.
----

== ManpageInlineMacro

[,ruby]
----
class ManInlineMacro < Asciidoctor::Extensions::InlineMacroProcessor
  use_dsl

  named :man
  name_positional_attributes 'volnum'

  def process parent, target, attrs
    doc = parent.document
    text = manname = target
    suffix = (volnum = attrs['volnum']) ? %((#{volnum})) : ''
    if doc.basebackend? 'html'
      target = %(#{manname}#{doc.outfilesuffix})
      doc.register :links, target
      node = create_anchor parent, text, type: :link, target: target
    elsif doc.backend == 'manpage' 
      node = create_inline parent, :quoted, manname, type: :strong
    else
      node = create_inline parent, :quoted, manname
    end
    create_inline parent, :quoted, %(#{node.convert}#{suffix})
  end
end
----

== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  inline_macro ManInlineMacro
end

Asciidoctor.convert_file 'sample-with-man-link.adoc', safe: :safe
----

== Tips & Techniques

=== Apply substitutions

By the time an inline macro is processed, most substitutions have already been applied (since macros is one of the last substitutions).
In order to get the processor to apply substitutions to the text of the Inline node returned by the extension, you must specify those extensions on the node instance itself.

You can specify substitutions to apply to the text of the node using the `subs` attribute.
This attribute accepts a symbol, an array of symbols, or a comma-separated string.

Let's say that we want normal substitutions to be applied to the text.
Here's how that can be done:

[,ruby]
----
create_inline_pass parent, '*https://example.org[Learn more]*',
  attributes: { 'subs' => :normal }
----

This inline passthrough node will produce a link that has link text with strong emphasis (i.e., bold).

You can also specify the substitutions as a string, which is parsed just like the value of the subs attribute on a block.

[,ruby]
----
create_inline_pass parent, '*https://example.org[Learn more]*',
  attributes: { 'subs' => 'quotes,macros' }
----

You can specify whichever substitutions you want applied, and in what order.

Instead of creating an inline passthrough node, you can also create a span of formatted text with additional substitutions applied.

[,ruby]
----
create_inline parent, :quoted, 'https://asciidoctor.org is _awesome_!',
  attributes: { 'subs' => :quotes }
----

The `:quoted` primary type represents a span of formatted text.
In this case, we don't need to apply the `macros` substitution since links have not yet been converted.

[[include-processor.adoc]]
{empty}

// /modules/extensions/pages/include-processor.adoc
[[extensions:include-processor.adoc]]
= Include Processor Extension Example
:navtitle: Include Processor

Purpose::
Include a file from a URI.

TIP: Asciidoctor supports including content from a URI out of the box if you set the `allow-uri-read` attribute (not available if the safe mode is `secure`).

== sample-with-uri-include.adoc

[source,asciidoc]
....
:source-highlighter: coderay

.Gemfile
[,ruby]
----
\include::https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor/Gemfile[]
----
....

== UriIncludeProcessor

[,ruby]
----
class UriIncludeProcessor < Asciidoctor::Extensions::IncludeProcessor
  def handles? target
    target.start_with? 'https://', 'https://'
  end

  def process doc, reader, target, attributes
    content = (::OpenURI.open_uri target).readlines
    reader.push_include content, target, target, 1, attributes
    reader
  end
end
----

== Usage

[,ruby]
----
Asciidoctor::Extensions.register do
  include_processor UriIncludeProcessor
end

Asciidoctor.convert_file 'sample-with-uri-include.adoc', safe: :safe
----

// /modules/ROOT/pages/localization-support.adoc
[[ROOT:localization-support.adoc]]
= Localization Support
:keywords: translations, labels, l10n, internationalization, i18n
:url-docbook-i8n: http://www.sagehill.net/docbookxsl/Localizations.html
:url-lang-attributes: {url-org}/asciidoctor/blob/{page-origin-refname}/data/locale/attributes.adoc

Asciidoctor is not restricted to working with English-only content.
Asciidoctor can process the full range of the UTF-8 character set.
That means you can write your document in any language, save the file with UTF-8 encoding, and expect Asciidoctor to convert the text properly.

Furthermore, you can customize the built-in labels (e.g., "`Appendix`") to match the language in which you are writing.
This process is known as localization (l10n).
The built-in labels used in the output generated by Asciidoctor are English by default.
These labels can be modified by changing the value of the <<label-attributes,corresponding attributes>>.

There are some caveats to know about:

* Currently, the official HTML and PDF converters only fully support left-to-right (and top-to-bottom) reading.
Support for right-to-left (RTL) is being considered.
See {url-org}/asciidoctor/issues/1601[issue #1601^] for details.
In the interim, you can leverage the DocBook toolchain to get right-to-left support.
* Attributes that store dates and times (e.g., `docdatetime`) are always formatted like `2019-01-04 19:26:06 -0600`.
* Application messages (i.e., log messages) are always in English.
* Asciidoctor does not support the language conf files used by AsciiDoc.py.
However, Asciidoctor does provide {url-lang-attributes}[a translation file^] that can be used for a similar purpose.

[#customizing-labels]
== Translating built-in labels

When converting to DocBook, you can rely on the DocBook toolchain to translate (most) built-in labels.
To activate this feature, set the `lang` attribute to a valid country code (which defaults to `en` for English).
For example:

 $ asciidoctor -a lang=es -b docbook article.adoc

The list of supported languages, as well as additional language considerations for DocBook, are described in {url-docbook-i8n}[DocBook XSL: The Complete Guide^].

The `lang` attribute _does not_ enable automatic translation of built-in labels when converting directly to HTML or PDF.
It's merely a hint to configure the DocBook toolchain.
If you're not using the DocBook toolchain for publishing, you must translate each built-in label yourself.
One way is to set the following attributes in the document header or by passing the attributes via the API or CLI:

.Attributes that control built-in labels
[#label-attributes,cols="~,~,30%"]
|===
|Attribute |Default English Value |Notes

|`appendix-caption`
|Appendix
|

|`appendix-refsig`
|Appendix
|Used when referencing an appendix.

|`caution-caption`
|Caution
|

|`chapter-signifier`
|Chapter
|Only applies when `doctype` is `book`.

|`chapter-refsig`
|Chapter
|Used when referencing a chapter.

|`example-caption`
|Example
|

|`figure-caption`
|Figure
|

|`important-caption`
|Important
|

|`last-update-label`
|Last updated
|

|`listing-caption`
|_not set_
|By default, listing blocks do not have captions.
Specify `listing-caption` to turn on captions for listing blocks.

|`manname-title`
|NAME
|Only applies when `doctype` is `manpage`.

|`note-caption`
|Note
|

|`part-signifier`
|Part
|

|`part-refsig`
|Part
|Used when referencing a part.

|`preface-title`
|_not set_
|Only applies when `doctype` is `book`.

|`section-refsig`
|Section
|Used when referencing a section.

|`table-caption`
|Table
|

|`tip-caption`
|Tip
|

|`toc-title`
|Table of Contents
|

|`untitled-label`
|Untitled
|

|`version-label`
|Version
|

|`warning-caption`
|Warning
|
|===

If you plan to support multiple languages, you'll want to define the attributes for each language inside a xref:#asciidoc:directives:conditionals.adoc[conditional preprocessor directive].
For example:

[,asciidoc]
----
\ifeval::["{lang}" == "de"]
:caution-caption: Achtung
...
\endif::[]
----

Of course, you're probably hoping this has already been done for you.
Indeed, it has!

You can find an {url-lang-attributes}[AsciiDoc file^] in the Asciidoctor repository that provides translations of these attributes for most major languages.
Thus far, the built-in labels have been translated into the following languages: Arabic, Belarusian, Bulgarian, Catalan, Czech, Danish, Dutch, German, Spanish, Persian (Farsi), Finnish, French, Hungarian, Bahasa Indonesian, Italian, Japanese, Korean, Norwegian Bokmål, Norwegian Nynorsk, Polish, Portuguese, Brazilian Portuguese, Romanian, Russian, Serbian Cyrillic, Serbian Latin, Swedish, Turkish, Ukrainian, Vietnamese, Simplified Chinese, and Traditional Chinese.
The translations are defined using AsciiDoc attribute entries inside conditional preprocessor blocks, just as suggested above.

To use this file to translate the built-in labels according the value of the `lang` attribute (just like the DocBook toolchain does), follow these steps:

. Download the AsciiDoc file {url-lang-attributes}[attributes.adoc^] from the Asciidoctor repository.
. Put the file in the folder [.path]_locale_ relative to your document.
. Add the following line to the header of your AsciiDoc document:
+
[,asciidoc]
----
\include::locale/attributes.adoc[]
----

. Set the language using the `lang` attribute.
This attribute must be set before the include directive gets processed.
For example:

 -a lang=es

The built-in labels will now be translated automatically based on the value of the `lang` attribute.

There's an ongoing discussion about how to make language support even simpler ({url-org}/asciidoctor/issues/1129[issue #1129^]).
Input is welcome.

== Translation

Asciidoctor (or DocBook) currently does not support translation of content out of the box.
There's a proposal to integrate gettext (https://discuss.asciidoctor.org/Professional-providers-translating-Asciidoc-tt2692.html#none[discussion^]), and suggestions are welcome.

// /modules/ROOT/pages/errors-and-warnings.adoc
[[ROOT:errors-and-warnings.adoc]]
= Errors and Warnings

All application messages (i.e., debug, info, warning, error, or fatal) emitted by Asciidoctor are written to the logger.
By default, only warning, error, and fatal messages are logged.
When using the CLI, the logger routes messages to the console via stderr (i.e., standard error).

== Notification types

DEBUG::
Debug messages provide insight into what the software is doing and can be useful for tracking down problems or unexpected behavior.
Currently, Asciidoctor does not log any messages at this level.
However, extensions may do so.

<<info,INFO>>::
Info messages do not stop conversion, but they indicate possible problems, and the output may not be what you were expecting.

<<warning,WARN>> (WARNING)::
Warnings do not stop conversion, but they indicate likely problems, and the output probably won't be what you were expecting.
In the CLI output, Asciidoctor labels these messages as `WARNING` rather than `WARN`.

<<error,ERROR>>::
Errors do not stop conversion, but the output document will almost certainly be wrong.

<<fatal,FATAL>> (FAILED)::
Failures are fatal; no output document will be produced.
If the `--trace` CLI option is specified, the message may be accompanied by a stacktrace.
In the CLI output, Asciidoctor labels these messages as `FAILED` rather than `FATAL`.

The messages listed in the following sections may contain some of the following representative placeholders:

<docname>::
Represents the basename of the source file being processed (e.g., `sample.adoc`).

<file>::
Represents a path to the input file or other referenced file.

<uri>::
Represents a URI (i.e., URL) being referenced.

<x> or <y>::
Placeholders for other contextual information in the message.

[#debug]
== Debug messages

[cols=2*]
|===
|Message |Troubleshooting

|unknown style for <y> block: <x>
|The processor could not find an extension registered for the <y> block with the custom style <x>.
It's not required to register an extension for a custom block, so this message is merely informational.
If the extension is not registered, the processor will fall back to the default semantics of the block.
The block will be rendered as though the custom style is not present.

|unknown name for block macro: <x>
|The processor could not find an extension registered for the block macro named <x>.
It's not required to register an extension for a custom block macro, so this message is merely informational.
If the extension is not registered, the processor will leave the block macro unprocessed (treat it as paragraph text).

|unknown style for paragraph: <x>
|The processor could not find an extension registered for the paragraph with the custom style <x>.
It's not required to register an extension for a custom paragraph, so this message is merely informational.
If the extension is not registered, the processor will fall back to the default semantics of the paragraph.
The paragraph will be rendered as though the custom style is not present.
|===

[#info]
== Info messages

[cols=2*]
|===
|Message |Troubleshooting

|possible invalid reference: <x>
|The processor could not validate the internal reference named <x>.
This message doesn't definitively indicate a missing reference.
Rather, it indicates the reference (i.e., anchor) is not in a location where the reference can be validated.
|===

[#warning]
== Warning messages

[cols=2*]
|===
|Message |Troubleshooting

|abstract block cannot be used in a document without a title when doctype is book. Excluding block content.
|Invalid book document structure.

|cannot retrieve contents of <x> at URI: <uri> (allow-uri-read attribute not enabled)
|Reading from a URI is only allowed if the allow-uri-read attribute is set from the CLI or API.

|could not retrieve contents of <x> at URI: <uri>
|Web address not found.

|could not retrieve image data from URI: <uri>
|Web address not found.
Only occurs with `allow-uri-read` and `data-uri`.
Check the URI.

|dropping line containing reference to missing attribute: <x>
|An attribute cannot be resolved and the `attribute-missing` attribute is set to `drop-line`.

|file does not exist or cannot be read: <file>
|You specified a stylesheet (`-a stylesheet=<file>`) but <file> does not exist or is not readable.

|gem 'concurrent-ruby' is not installed. This gem is recommended when registering custom converters.
|You have registered a custom converter, and you have not installed the concurrent-ruby gem.

|gem 'concurrent-ruby' is not installed. This gem is recommended when using custom backend templates.
|You are using custom templates (`-T <template_dir>`), but you have not installed the concurrent-ruby gem.

|image to embed not found or not readable: <file>
|You used `:data-uri:` but the file could not be found.

|include file not readable: <file>
|You do not have permission to access the file.

|input path <file> is a <x>, not a file
|The path is not a file (perhaps it is a socket or a block device).

|optional gem 'asciimath' is not installed. Functionality disabled.
|asciimath is a required library when converting AsciiMath expressions in AsciiDoc to DocBook.

|optional gem 'rouge' is not installed. Functionality disabled.
|Rouge is used for source code highlighting when `source-highlighter` is set to `rouge`.

|skipping reference to missing attribute: <x>
|An attribute cannot be resolved and the `attribute-missing` attribute is set to `skip`.

|tables must have at least one body row
|

|tag '<x>' not found in include file: <file>
|You tried to include by tagged region, but the included document does not have that tag.

|<docname>: id assigned to <type> already in use: <id>
|<id> is a duplicate ID, meaning it has already been assigned to a node of <type> (e.g., section, block, anchor).
If you don't see the problem in <docname>, check that the duplicate ID isn't coming from a file which is being included.

|<docname> callout list item index: expected <x> got <y>
|Callouts are expected to be in numerical order, just like any ordered list.

|<docname> include <x> not readable: <y>
|If <y> is a file, do you have read permissions for it?
If it is a URI and `-a allow-uri-read` is set, does it exist?

|<docname> include file not found: <file>
|Probably a typo or missing file.
If not, make sure you understand the search process.

|<docname> invalid empty <x> detected in style attribute
|The first positional attribute in the block attributes could not be parsed.

|<docname> invalid style for <x> block: <y>
|You have added a custom style to a block, but you haven't registered a custom block extension to handle it.

|<docname> invalid style for paragraph: <x>
|You have a line `[<name-of-style>]` before a paragraph, but `name-of-style` isn't a recognized built-in style.

|<docname> list item index: expected <x>, got <y>
|You gave explicit numbers on an ordered list, but they were not sequential.
Asciidoctor renumbers them for you, and gives this warning.

|<docname> multiple ids detected in style attribute
|Multiple IDs cannot be specified in the block style (e.g., `[#cat#dog]`).

|<docname> no callouts refer to list item <x>
|The callout is missing or not recognized.
In source listings, is the callout the last thing on the line?

|<docname> section title out of sequence
|Invalid document structure.
Check section levels.
|===

[#error]
== Error messages

[cols=2*]
|===
|Message |Troubleshooting

|input file <file> missing or cannot be read
|Check that the file exists and that the filename is not misspelled.

|include file has illegal reference to ancestor of jail; recovering automatically
|The safe mode is restricting access to an include file outside of the base directory.

|input file and output file cannot be the same: <file>
|Choose a different output directory or filename.

|partintro block can only be used when doctype is book and it\'s a child of a part section. Excluding block content.
|Invalid book document structure.

|unmatched macro: endif::<x>[]
|`endif::[]` with no unclosed preceding `ifdef::<x>[]`.

|<docname> dropping cell because it exceeds specified number of columns
// The extra cells are dropped, but this message is not produced ???
|

|<docname> illegal block content outside of partintro block
|Invalid book document structure.

|<docname> invalid part, must have at least one section (e.g., chapter, appendix, etc.)
|Invalid book document structure.

|<docname> malformed manpage title
|Document does not conform to the structure required by the declared manpage doctype.

|<docname> malformed name section body
|Document does not conform to the structure required by the declared manpage doctype.

|<docname> maximum include depth of 64 exceeded
|Does your file include itself, directly or indirectly?

|<docname> mismatched macro: endif::<x>[], expected endif::<y>[]
|ifdef/endif blocks must be strictly nested.

|<docname> name section expected
|Document does not conform to the structure required by the declared manpage doctype.

|<docname> name section title must be at level 1
|Document does not conform to the structure required by the declared manpage doctype.

|<docname> only book doctypes can contain level 0 sections
|Illegal use of a level-0 section when doctype is not book.

|<docname> table missing leading separator, recovering automatically
|Check for missing cell separator characters at the start of the line.
|===

[#fatal]
== Fatal messages

[cols=2*]
|===
|Message |Troubleshooting

|missing converter for backend '<x>'. Processing aborted.
|You used -b with an invalid or missing backend.

//|Failed to load AsciiDoc document - undefined method `convert' for nil:NilClass
//|

|'tilt' could not be loaded
|You must have the tilt gem installed (`gem install tilt`) to use custom templates.
|===

////
API only

|ERROR
|IOError, %(target directory does not exist: #{to_dir})
|API, the mkdirs option is not set, and the target directory does not already exist.
////

// /modules/migrate/pages/upgrade.adoc
[[migrate:upgrade.adoc]]
= Upgrade from Asciidoctor 1.5.x to 2.0

IMPORTANT: This page if for users upgrading from a previous version of Asciidoctor to the latest stable version of Asciidoctor.
If your migrating from AsciiDoc.py, see xref:#asciidoc-py.adoc[].

When you upgrade Asciidoctor you may also need to update some of the syntax and attributes in your AsciiDoc documents.
Major version releases can include new AsciiDoc syntax capabilities as well as syntax changes that make it more consistent.

== Updated and deprecated features

The syntax, attributes, and commands listed below have been updated or deprecated.
In most cases, they've been replaced with a new feature that provides improved functionality.

=== Inline formatting

[cols="~,~,~,~"]
|===
|Feature |Deprecated |New |Notes

|_italic text_
|pass:['italic text']
|pass:[_italic text_]
|Allowed with `compat-mode`.
See xref:#asciidoc:text:italic.adoc[].

|`monospace text`
|pass:[+monospace text+]
|pass:[`monospace text`]
|Allowed with `compat-mode`.
See xref:#asciidoc:text:monospace.adoc[].

|`+literal monospace text+`
|pass:[`literal monospace text`]
|pass:[`+literal monospace text+`]
|Allowed with `compat-mode`.
See xref:#literal-monospace[Literal monospace].

|Curved "`double quotes`"
|pass:[``double quotes'']
|pass:["`double quotes`"], editor keybinding, or Unicode character in numeric character reference form
|See xref:#asciidoc:text:quotation-marks-and-apostrophes.adoc[].

|Curved '`single quotes`'
|pass:[`single quotes']
|pass:['`single quotes`'], editor keybinding, or Unicode character in numeric character reference form
|See xref:#asciidoc:text:quotation-marks-and-apostrophes.adoc[].
|===

=== Table of contents

[cols="~,~,~,~"]
|===
|Feature |Deprecated |New |Notes

|Scrollable, left margin TOC
|`toc2`
|`+:toc: left+`
|See xref:#asciidoc:toc:position.adoc[].

|TOC location
|`toc-placement` and `toc-position`
|`+:toc: <value>+`
|See xref:#asciidoc:toc:position.adoc[].

|User-specified TOC location
|`+:toc-placement: manual+`
|`+:toc: macro+`
|See xref:#asciidoc:toc:position.adoc[].
|===

=== Document header

[cols="~,~,~,~"]
|===
|Feature |Deprecated |New |Notes

|Two-line style (setext) document title
|`Title` +
`+=====+`
|`={nbsp}Title`
|Asciidoctor accepts the two-line heading style to set the document title.
But, by using it, `compat-mode` is implicitly set.
To use the new syntax, use `= Title` or explicitly unset `compat-mode`.
See xref:#asciidoc:document:title.adoc[].
|===

=== API

[cols="~,~,~"]
|===
|Feature |Deprecated |New

|Render class method
|`+.render(input, options = {}) ⇒ Object+`
|`+.convert(input, options = {}) ⇒ Object+`
|===

== New features

Visit xref:#ROOT:whats-new.adoc[] for a complete list of new Asciidoctor features.

////
== Proposed changes for future versions

[cols="15,20,20,5,20"]
|===
|Feature |Deprecated |New |As of Version |Notes

|Delimited open block
|pass:[--] +
open block content +
pass:[--]
|New syntax will allow for nested delimited open blocks
|2.0
|

|Set backend
|Set the backend from a document
|Backends can only be set in the CLI, environment, and API
|2.0
|

|Link attributes
|Set `linkattrs` to use link attribute syntax
|`linkattrs` is set implicitly so link attributes are available automatically
|2.0
|

|UI macros
|Set `experimental` to use the UI macros
|UI macros are available automatically
|2.0
|

|Document roles
|Roles are inherited; roles don't wrap the document
|Roles aren't inherited; roles wrap the document
|2.0
|
|===
////

////
== Compatibility mode

When it isn't feasibly to update your documents prior to upgrading Asciidoctor, you can run Asciidoctor in compatibility mode.
Compatibility mode is activated by setting the `compat-mode` attribute and allows Asciidoctor to accept and apply the deprecated syntax and/or behavior.
However, *not all deprecated syntax or behavior is available under the compatibility mode*.
////

[[asciidoc-py.adoc]]
{empty}

// /modules/migrate/pages/asciidoc-py.adoc
[[migrate:asciidoc-py.adoc]]
= Migrate from AsciiDoc.py
:url-writing-tests: https://github.com/asciidoctor/asciidoctor/blob/HEAD/CONTRIBUTING.adoc#writing-and-executing-tests
:url-doctest: {url-org}/asciidoctor-doctest
:url-asciidoctor-1: {url-project}/man/asciidoctor
:description: This page covers the differences between Asciidoctor and the legacy Python-based AsciiDoc processor, AsciiDoc.py, and provides guidance for migrating your content and processor settings from AsciiDoc.py to Asciidoctor.

AsciiDoc.py is the original and legacy Python-based processor for the AsciiDoc language.
It has been superseded by Asciidoctor.
If you're currently using AsciiDoc.py to convert your AsciiDoc documents and are ready to switch to Asciidoctor, you'll need to migrate your legacy AsciiDoc content to the official AsciiDoc syntax defined and supported by Asciidoctor.
In doing so, you'll also benefit from the enhancements that have been added to the AsciiDoc language since Asciidoctor took over development of the language.
This page covers those differences and how to migrate.

NOTE: This documentation specifically covers migration from AsciiDoc.py 8.6.

== Processor call

The Asciidoctor processor is a drop-in replacement for AsciiDoc.py.
You can replace the call to AsciiDoc.py (`asciidoc`) with the equivalent call to Asciidoctor (`asciidoctor`).

 $ asciidoctor document.adoc

If your document makes heavy use of the legacy AsciiDoc syntax supported by AsciiDoc.py, you may have better luck enabling compat mode:

 $ asciidoctor -a compat-mode document.adoc

However, compat mode is strictly a migration aid.
You should only use it as an interim measure while you're migrating your content.
It's not something you want to rely on long term and is considered deprecated.

== Default HTML backend

AsciiDoc.py used XHTML 1.1 as its default output.
Asciidoctor's default output is HTML 5 (i.e., `backend=html5`) and the `html` backend maps to `html5`.

== Themes

AsciiDoc.py provided a theming mechanism that encapsulated CSS, JavaScript, and images.
The `--theme` option activated one of these themes, which was resolved from your home directory.
In Asciidoctor, you control the theme using CSS stylesheets, which you specify using `-a stylesheet=<stylesheet>`.

If you require more advanced theming, you can inject additional resources using a xref:#ROOT:docinfo.adoc[docinfo file] or a xref:#extensions:postprocessor.adoc[postprocessor extension].

[#migrate-stylesheet]
=== Default HTML stylesheet

The Asciidoctor and AsciiDoc.py stylesheets look quite different, but they're mostly interchangeable since the underlying HTML structure of the two processors is nearly identical.

If you prefer the AsciiDoc.py stylesheet, you can use it by copying it from the AsciiDoc.py [.path]_stylesheets_ directory and instructing Asciidoctor to apply it using:

 $ asciidoctor -a stylesheet=asciidoc.css document.adoc

Keep in mind that the default stylesheet in Asciidoctor is just that, a default.
If you don't like its appearance, you can customize it.

IMPORTANT: Unlike AsciiDoc.py, Asciidoctor loads some resources from a CDN.
It's possible to configure Asciidoctor to load all resources from local files.
For instance, you can unset the `webfonts` attribute so that the generated HTML does not use fonts from Google Fonts.
There are similar attributes to control how additional resources are resolved.

== Updated and deprecated AsciiDoc syntax

As the steward of the AsciiDoc language, Asciidoctor reworked some of the AsciiDoc syntax originally introduced by AsciiDoc.py in an effort to make it more consistent, easier to learn, and, in some cases, more concise.
This section outlines those improvements to the modern AsciiDoc syntax and how it differs from the legacy AsciiDoc recognized by AsciiDoc.py.

*If a feature or attribute isn't mentioned in the following tables, then it works in Asciidoctor just like it worked in AsciiDoc.py.*

=== Inline formatting

[cols="~,~,~,~"]
|===
|Feature |AsciiDoc.py |Asciidoctor |Notes

|_italic text_
|pass:['italic text'] or pass:[_italic text_]
|pass:[_italic text_]
|See xref:#asciidoc:text:italic.adoc[]. +
Reverts to AsciiDoc.py syntax when `compat-mode` is enabled.

|`monospace text`
|pass:[+monospace text+]
|pass:[`monospace text`] or pass:[[x-\]+monospace text+]
|See xref:#asciidoc:text:monospace.adoc[]. +
Reverts to AsciiDoc.py syntax when `compat-mode` is enabled.

|`literal monospace text`
|pass:[`literal monospace text`]
|pass:[`+literal monospace text+`] or pass:[[x-\]`literal monospace text`]
|See xref:#literal-monospace[Literal monospace]. +
Reverts to AsciiDoc.py syntax when `compat-mode` is enabled.

|Curved "`double quotes`"
|pass:[``double quotes'']
|pass:["`double quotes`"]
|See xref:#asciidoc:text:quotation-marks-and-apostrophes.adoc[]. +
Reverts to AsciiDoc.py syntax when `compat-mode` is enabled.

|Curved '`single quotes`'
|pass:[`single quotes']
|pass:['`single quotes`']
|See xref:#asciidoc:text:quotation-marks-and-apostrophes.adoc[]. +
Reverts to AsciiDoc.py syntax when `compat-mode` is enabled.

|Inline role(s)
|pass:[[role\]#text#] or pass:[[role1 role2\]#text#]
|pass:[[.role\]#text#] or pass:[[.role1.role2\]#text#]
|See xref:#asciidoc:text:text-span-built-in-roles.adoc[]. +
While Asciidoctor still recognizes the bare, space-separated syntax for inline roles, the shorthand-style with the leading dot is preferred.

|Font size roles
|`big`, `small`
|user-specified role (e.g., `+[.details]+`) with corresponding CSS rules provided by stylesheet
|See xref:#asciidoc:text:custom-inline-styles.adoc[]. +
The default stylesheet in Asciidoctor still provides CSS for these built-in roles, but they are considered deprecated.

|Color roles
|`aqua`, `aqua-background`, etc.
|user-specified role `+[.brand-primary]+` with corresponding CSS rules provided by stylesheet
|See xref:#asciidoc:text:custom-inline-styles.adoc[]. +
The default stylesheet in Asciidoctor still provides CSS for these built-in roles, but they are considered deprecated.
|===

=== Table of contents

[cols="~,~,~,~"]
|===
|Feature |AsciiDoc.py |Asciidoctor |Notes

|Scrollable, left margin TOC
|`toc2`
|`+:toc: left+`
|See xref:#asciidoc:toc:position.adoc[].

|TOC location
|`toc-placement` and `toc-position`
|`+:toc: <value>+`
|See xref:#asciidoc:toc:position.adoc[].

|User-specified TOC location
|`+:toc-placement: manual+`
|`+:toc: macro+`
|See xref:#asciidoc:toc:position.adoc[].
|===

=== Document and section titles

[cols="~,~,30%,~"]
|===
|Feature |AsciiDoc.py |Asciidoctor |Notes

|Two-line style (setext) document title
|`Title` +
`+=====+`
|`= Title`
|See xref:#asciidoc:document:title.adoc[]. +
When Asciidoctor detects the two-line style document title, it switches to compat mode by implicitly setting `compat-mode`.
To revert this behavior, explicitly unset `compat-mode`.

|Underlined section titles
|Underline length must match title length +/- 2 characters.
|`== Level 1 title` +
`=== Level 2 title` +
`==== Level 3 title` +
`===== Level 4 title`
|See xref:#asciidoc:sections:titles-and-levels.adoc[].

|Section numbers
|`numbered`
|`sectnums`
|See xref:#asciidoc:sections:numbers.adoc[].
|===

Asciidoctor is more careful when deriving automatic IDs for sections from the section title to avoid generating obscure IDs.

* Asciidoctor removes any start and end HTML/XML tags, whereas AsciiDoc.py does not.
* Asciidoctor removes any character references (e.g., `\&copy;`), whereas AsciiDoc.py does not (see next rule).
* Asciidoctor removes any invalid characters (e.g., `$`), whereas AsciiDoc.py replaces these characters with the value of the `idseparator` attribute.
* Asciidoctor automatically generates IDs for discrete headings, whereas AsciiDoc.py does not.

To ensure your IDs have maximum portability, it's best to define them explicitly if the section title contains special characters or formatting.

=== Tables

[cols="~,~,~,~"]
|===
|Feature |AsciiDoc.py |Asciidoctor |Notes

|Table cell
|`a{vbar}` or `asciidoc{vbar}`
|`a{vbar}` only
|See xref:#asciidoc:tables:add-cells-and-rows.adoc[].

|Table cell separator
|A Python regular expression.
|One or more literal characters or `\t` for tab.
|See xref:#asciidoc:tables:add-cells-and-rows.adoc[], xref:#asciidoc:tables:data-format.adoc[], and xref:#custom-delimiters[custom separators].

|Horizontal and vertical alignment for tables cells
|`halign`, `valign`
|Column and cell specifiers
|See xref:#asciidoc:tables:align-by-column.adoc[] and xref:#asciidoc:tables:align-by-cell.adoc[].

|Make tables full page width in DocBook
|`options="pgwide"`
|_not implemented_
|
|===

=== Blocks

[cols="~,~,~,~"]
|===
|Feature |AsciiDoc.py |Asciidoctor |Notes

|Block delimiters
|Delimiter lines do not have to match in length.
|The length of start and end delimiter lines must match exactly.
|See xref:#asciidoc:blocks:delimited.adoc[].

|Default substitutions for passthrough blocks
|Applies attributes and macros substitutions to passthrough blocks
|Does not apply any substitutions to passthrough blocks
|Add `[subs="attributes,macros"]` above block to restore behavior.
|===

=== Substitutions

[cols="~,~,~,~"]
|===
|Feature |AsciiDoc.py |Asciidoctor |Notes

|Substitute `+`
|`replacements2`
|`post_replacements`
|See xref:#asciidoc:subs:post-replacements.adoc[].

|Suppress inline substitutions and retain block indents when importing large blocks of plain text
|`plaintext`
|_not implemented_
|Close equivalent is a xref:#asciidoc:pass:pass-block.adoc[passthrough block] or a listing block with xref:#the-indent-attribute[the indent attribute].
|===

=== Mathematical expressions

AsciiDoc.py and Asciidoctor can convert embedded LaTeX and AsciiMath expressions (e.g., `pass:[asciimath:[expression]]`, `pass:[latexmath:[expression]]`, etc.).
In Asciidoctor, activate STEM support first using the xref:#asciidoc:stem:stem.adoc[stem attribute].

=== Miscellaneous

[cols="~,~,~,30%"]
|===
|Feature |AsciiDoc.py |Asciidoctor |Notes

|`+ifeval::[ ]+`
|Evaluates any Python expression.
|Evaluates simple logical expressions testing the value of attributes.
|See xref:#asciidoc:directives:ifeval.adoc[].

|Provide name of current document
|`infile`
|_not implemented_
|

|Provide directory of current document
|`indir`
|_not implemented_
|

|Apply special formatting to named text
|`specialwords`
|_not implemented_
|

|Replace tabs with spaces in all text, using a default tab size of 8
|`tabsize` (in-document and include directive)
|in-document only
|Asciidoctor only replaces tabs with spaces in verbatim blocks, and the attribute has no default.
In other words, tabs are not expanded in verbatim content blocks unless this attribute is set on the block or the document.
For all other text, Asciidoctor tabs are fixed at 4 spaces by the CSS.
See xref:#asciidoc:directives:include-with-indent.adoc[normalize block indentation].
|===

=== docinfo attributes

`docinfo` attribute values were introduced into AsciiDoc by Asciidoctor 1.5.5 to replace the less descriptive `docinfo1` and `docinfo2` attributes.
Here are the equivalents of the old attributes using the new values:

* `:docinfo:` = `:docinfo: private`
* `:docinfo1:` = `:docinfo: shared`
* `:docinfo2:` = `:docinfo: shared,private`

=== showcomments

In AsciiDoc.py, single line comments could be turned into DocBook `<remark>` elements using `showcomments`.
This feature isn't implemented in Asciidoctor, but you can send remarks to the output, using an extension, or ifdef directives and passthrough blocks like the example shown below.

[,asciidoc]
----
\ifdef::showcomments+basebackend-docbook[]
++++
<remark>Your comment here</remark>
++++
\endif::[]
----

== Compatibility mode

We want to continue to evolve and refine the AsciiDoc syntax, but we also recognize that compatibility is very important.
That's why Asciidoctor provides a compatibility mode (aka compat mode) with AsciiDoc.py (as well as some inline transitional syntax).

Compat mode will help you either stay with or transition away from the legacy AsciiDoc syntax recognized by AsciiDoc.py to the modern AsciiDoc syntax recognized by Asciidoctor.
This mode should only be used as a tool to assist with migration, not as a long-term strategy.

If you can't migrate right now, you can activate compat mode by setting the `compat-mode` document attribute in the document header or by passing it to the processor:

 $ asciidoctor -a compat-mode document.adoc

You can also enable compat mode implicitly by beginning the document with a setext-style (i.e., two-line) document title:

[,asciidoc]
----
Compat Mode
===========

\ifdef::compat-mode[Compat mode is on!]
----

If you prefer the setext-style document title, but don't want compat mode to be enabled, you must unset the `compat-mode` attribute explicitly.

[,asciidoc]
----
Not Compat Mode
===============
:!compat-mode:

\ifndef::compat-mode[Compat mode is not on.]
----

When compat mode is enabled, Asciidoctor adapts some of its behavior and its interpretation of AsciiDoc to more closely align with AsciiDoc.py.
The most noticeable difference is that backticks now only indicate monospace text as opposed to literal monospace.
Literal monospace is signified using a compound markup that combines an inline passthrough with monospace formatting.

[cols=3*,width=75%]
|===
| Feature | Source | Result

| Monospace
| pass:[`1...10`]
| `1...10`

| Literal monospace
| pass:[`+1...10+`]
| `+1...10+`

| Italic
| pass:['text']
| _text_
|===

To learn more about the adaptations that are activated by compat mode, refer to <<inline-formatting,inline formatting>>.

If you've written content to be processed with AsciiDoc.py, and you aren't yet ready to migrate, or need to ease into that migration, Asciidoctor's compatibility mode will help ensure that your existing content will continue to work (to the extent possible).

== Configuration files

Asciidoctor does not use [.path]_.conf_ files or filters, so `--conf-file`, `--dump-conf`, and `--filter` are not applicable.
Instead, Asciidoctor provides an xref:#extensions:register.adoc[extension API] that replaces the configuration-based extension and filter mechanisms in AsciiDoc.py.

=== Localization

AsciiDoc.py has built-in [.path]_.conf_ files that translated built-in labels.
In Asciidoctor, you must define the translations for these labels explicitly.
See xref:#ROOT:localization-support.adoc[] for details.

[#migrate-extensions]
== AsciiDoc.py extensions

The extension mechanism is completely different in Asciidoctor, but most of the standard extensions have been re-implemented, so they should work with minor changes.

[cols="~,~"]
|===
|AsciiDoc.py |Asciidoctor

|`source`
a|
* You can choose from a number of xref:#built-in-values[source highlighters].
* Source highlighter values are built-in.
* `src_numbered`, `src_tab`, `args` are not implemented directly, but check the highlighter you are using for what features it has and how to configure them.

|music
|Not implemented.

|`[latex]` block macro
|Use a xref:#block[stem block].

|`graphviz`
|Use xref:#diagram-extension::index.adoc[Asciidoctor Diagram].
|===

=== Custom extensions

AsciiDoc.py custom extensions are Python commands, so they don't work with Asciidoctor.
Depending on the Asciidoctor processor you choose, you can re-write your xref:#extensions:index.adoc[extensions in Ruby, Java, or JavaScript].

== Extract text

AsciiDoc.py provides a frontend to the DocBook toolchain named a2x.py.
This script can produce various output formats from an AsciiDoc document.
One of those formats is text (aka "`plain text`").
In order to extract the text, the DocBook toolchain first converts the AsciiDoc to HTML, then extracts the text from that document using lynx.

There are numerous approaches to extracting text from AsciiDoc in Asciidoctor.
One way is to write an Asciidoctor converter mapped to the `text` backend that xref:#convert-to-text-only[converts AsciiDoc to text only].
Another approach is to convert the AsciiDoc to HTML, then extract text from the HTML output document using a text-based browser, just like the DocBook toolchain does.

Before continuing, it's worth noting that there's no universal definition of "`plain text`".
It all depends on what information you are trying to extract.
That's why you won't find a text backend provided by Asciidoctor core.
Let's consider what tools are available.

As an alternative to lynx, the text-based browser w3m does a nice job of extracting text from an HTML document.
For example:

 $ w3m -dump -cols 120 doc.html > doc.txt

You can set the number of columns so lines aren't hard wrapped at a fixed line width.
The upper bounds for this value is MAX_INT (2147483647).
You can retrieve that value dynamically using Perl.

 $ w3m -dump -cols $(perl -MPOSIX -e 'print INT_MAX') doc.html > doc.txt

It doesn't seem possible to configure w3m to preserve markup that indicates headings.
However, the text-based browser `elinks` offers this behavior by default through indentation.

 $ elinks -dump 1 -no-references -no-numbering -dump-width 50000 doc.html > doc.txt

Yet another option is the https://www.npmjs.com/package/html-to-text[html-to-text^] module for Node.js, which parses HTML and returns beautiful text.

If you want to extract the text during AsciiDoc conversion, you can do so using an Asciidoctor postprocessor extension.

[,ruby]
----
require 'open3'

Asciidoctor::Extensions.register do
  postprocessor do
    process do |doc, output|
      outfile = (doc.attr 'outfile').sub %r/\.\S+$/, '.txt'
      Open3.popen2 'elinks -dump 1 -no-references -no-numbering' do |is, os|
        is.print output
        is.close
        File.write outfile, os.read
      end
      output
    end
  end
end
----

This extension will write a file with a .txt extension adjacent to the document written by the converter.

== Doctest

AsciiDoc.py `--doctest` ran its unit tests.
See the {url-writing-tests}[contributing guide^] to learn how to run the Asciidoctor unit tests.
Asciidoctor also has a {url-doctest}[doctest tool^] which you can use when creating custom HTML or XML-based converters.

== Help topics

In both AsciiDoc.py and Asciidoctor, the `--help` CLI option shows the command usage by default.
It can also show a syntax crib sheet using `--help syntax` or the man page using `--help manpage`.

In AsciiDoc.py, the `--help manpage` option emits a plaintext version of the man page.
Asciidoctor, on the other hand, outputs the formatted man page so you can use it with a man pager.
To view it, you need to pipe the result to the `man` command as follows:

 $ asciidoctor --help manpage | man /dev/stdin

or

 $ asciidoctor --help manpage | man -l -

If you want to view the plaintext version with Asciidoctor, you can route the output through the `col` command as follows:

 $ asciidoctor --help manpage | man -l - | col -bx

Alternately, you can view the man page for Asciidoctor online at {url-asciidoctor-1}[asciidoctor(1)].

////
This content needs to be move to the specific subject docs pages if applicable

== Features Introduced by Asciidoctor

=== New Syntax

Asciidoctor has shorthand for id, role, style and options.
The following longhand syntax in AsciiDoc.py:

[,asciidoc]
----
[[id]]
[style,role="role",options="option1,option2"]
----

can be written using the shorthand supported by Asciidoctor:

[,asciidoc]
----
[style#id.role%option1%option2]
----

The longhand forms still work, but you should use the new forms for future compatibility, convenience and readability.

=== Enhancements

There are lots of new features and improvements Asciidoctor.
These are some of the more interesting ones when migrating:

* xref:#directives:include-lines-and-tags.adoc[Partial includes]
* xref:#attributes:safe-modes.adoc[Additional safe modes]
* xref:#macros:icons.adoc[Icon-based fonts and inline icons]
* xref:#diagram-extension::index.adoc[Asciidoctor Diagram]

A detailed list of the improvements is shown in #Differences between Asciidoctor and AsciiDoc.py#.

This is the compat mode summary which needs a page.

These changes are not backward-compatible, but if you set the `compat-mode` attribute, Asciidoctor will accept the AsciiDoc.py syntax.
For the long term, you should update to the Asciidoctor syntax.
Consult the {uri-migrate}[Migration Guide] to get the full details and learn how to migrate smoothly.
////

// /modules/migrate/pages/docbook-xml.adoc
[[migrate:docbook-xml.adoc]]
= Migrate from DocBook XML to Asciidoctor
:navtitle: Migrate from DocBook XML
:url-docbookrx: https://github.com/asciidoctor/docbookrx

A task Asciidoctor excels at is converting AsciiDoc source into valid and well-formed DocBook XML content.
But what if you're in the position where you need to go the other way, to migrate your legacy DocBook XML content to AsciiDoc?
The prescription (℞) you need to get rid of your DocBook pains could be {url-docbookrx}[DocBookRx^].

== DocBookRx

DocBookRx is an early version of a DocBook to AsciiDoc converter written in Ruby.
This converter is far from perfect at the moment, but it improves with each document it converts.

The plan is to evolve it into a robust library for performing this conversion in a reliable way.
You can read more about this initiative in the {url-docbookrx}#readme[README^].

The best thing about this tool is all the active users who are putting it through its paces.
The more advanced the DocBook XML this tool tackles, and the more feedback we receive, the better the tool will become.
Use it today to escape from XML hell!

== From doxygen

Doxygen can generate documentation in various output formats.
One of those formats is (DocBook) XML.
That means there's a pathway from doxygen to AsciiDoc by way of DocBookRx.

To enable this feature (off by default), set the `GENERATE_DOCBOOK` tag to `YES` in the Doxygen configuration file.
When enabled, Doxygen will generate XML files that capture the structure of the code including all documentation.

To begin the migration, first run the doxygen command to generate the DocBook XML output.
Then run DocBookRx on the XML files to generate AsciiDoc files.
You can now use Asciidoctor to convert the AsciiDoc files to a consumable output format such as HTML.

Note that some post processing of the generated AsciiDoc may be necessary.

// /modules/migrate/pages/markdown.adoc
[[migrate:markdown.adoc]]
= Migrate from Markdown to Asciidoctor
:navtitle: Migrate from Markdown

Asciidoctor recognizes some Markdown syntax, thus allowing you to migrate from Markdown to AsciiDoc gradually.
See xref:#markdown-compatibility[Markdown compatibility] to learn what syntax is shared.
The syntax you must change is listed in the table under the xref:#comparison-by-example[Comparison by example section].

You can use https://github.com/asciidoctor/kramdown-asciidoc[Kramdown AsciiDoc^] to automate the migration from Markdown to AsciiDoc.

// /modules/migrate/pages/confluence-xhtml.adoc
[[migrate:confluence-xhtml.adoc]]
= Migrate from Confluence XHTML to Asciidoctor
:navtitle: Migrate from Confluence XHTML
:url-pandoc: https://pandoc.org

You can convert Atlassian Confluence XHTML pages to Asciidoctor using this Groovy script.

The script calls {url-pandoc}[Pandoc^] to convert single or multiple HTML files exported from Confluence to AsciiDoc files.
You'll need Pandoc installed before running this script.
If you have trouble running this script, you can use the Pandoc command referenced inside the script to convert XHTML files to AsciiDoc manually.

.convert.groovy
[,groovy]
----
include::example$convert.groovy[]
----

This script was created by Cédric Champeau (https://gist.github.com/melix[melix^]).
You can find the source of this script hosted at this https://gist.github.com/melix/6020336[gist^].

The script is designed to be run locally on HTML files or directories containing HTML files exported from Confluence.

== Usage

. Save the script contents to a `convert.groovy` file in a working directory.
. Make the file executable according to your specific OS requirements.
. Create an `html` directory for input files and an `asciidoc` directory for output files, both inside the working directory.
. Place individual files, or a directory containing files, into the aforementioned `html` directory.
. Run `groovy convert` to convert the files contained inside the `html` directory.
. Look for the generated output file in the `asciidoc` directory and confirm it meets your requirements.

// /modules/migrate/pages/ms-word.adoc
[[migrate:ms-word.adoc]]
= Migrate from MS Word to Asciidoctor
:navtitle: Migrate from MS Word
:description: This page presents various tools and strategies for migrating from MS Word to AsciiDoc.
:url-pandoc: https://pandoc.org
:url-google-asciidoc: https://workspace.google.com/marketplace/app/asciidoc_processor/1023004302050
:url-google-asciidoc-source:  https://github.com/ggrossetie/asciidoc-googledocs-addon/

== Pandoc

{url-pandoc}[Pandoc^] is a Swiss army knife for converting one markup format to another.
It does an admirable job converting simple docx files to AsciiDoc.

NOTE: Generally, we don't like to recommend pandoc because it doesn't create AsciiDoc the way we prefer.
However, in this case, it's a good choice.

To perform the conversion from MS Word docx to AsciiDoc, you need to perform the following command:

.pandoc < 2.11.2
 
 $ pandoc -f docx -t asciidoctor --wrap=none --atx-headers \
   --extract-media=extracted-media -o output.adoc
 
.pandoc (2.11.2 or newer)
 
 $ pandoc input.docx -f docx -t asciidoc --wrap=none --markdown-headings=atx \
   --extract-media=extracted-media -o output.adoc

.pandoc (2.11.2 or newer) and docker

If you use docker you can also use the latest version of pandoc with docker without installing it:

 $ docker run --rm --volume "$PWD:/data" --user `id -u`:`id -g` pandoc/core input.docx -f docx \
   -t asciidoc --wrap=none --markdown-headings=atx --extract-media=extracted-media -o output.adoc

Then, edit the output file to tidy it up.

The conversions you can expect are shown in the following table (tested using MS Word 2010 and 2013 + Pandoc 2.0 and 2.5 (Windows)):

.Pandoc MS Word to AsciiDoc conversions
|===
|MS Word Feature |Conversion

|Headings (using MS Word Heading styles 1-5)
|Yes

|Tables
|Yes. +
Merged cells are unmerged.
Column widths are ignored.

|Unordered and ordered lists
|Yes

|Footnotes
|Yes

|Figure and table captions
|Normal paragraph

|Other MS Word styled paragraphs
|Normal paragraph

|Embedded images
|Yes

|Character formatting (bold, underline and italic)
|Yes

|URL links
|No.
See <<remove-refs,how to remove hyperlinks>> to fix it.

|Email links
|Yes

|Document automation (fields, auto-generated figure and table numbers)
|Ignored

|Internal references (e.g., "`See Figure 3`")
|Plain text

|Drawing canvas
|Ignored

|Text boxes
|Ignored

|Linked (not embedded) images
|Ignored

|Vector graphics (MS Word "`insert shape`")
|Ignored
|===

== Optimizing for Pandoc

The basic usage documented above is fine for one-off imports.
If you have a lot to do, it's worthwhile cleaning the input document first, and automating the post-conversion tidy up.

. Clean up the MS Word document:
// Title pages are usually easier to recreate manually
** Remove non-essential material (title pages, headers and footers, table of contents etc.); it is usually easiest to copy just the body text into a new blank document
// Technically not necessary as pandoc ignores them by default, but it simplifies the document, which is a good thing in principle
** Switch off tracking and accept all changes
// Important - pandoc recognizes the style name to define headings
** Ensure you have used Heading styles for headings
//** Remove automatic heading numbering (this limitation may be removed in the next release of pandoc)
// So you can turn them back into captions just with a .
** Ensure table titles are immediately *above* their table
// So you can turn them back into captions just with a .
** Ensure figure titles are immediately *above* their figure
// linked images are ignored (according to my testing)
** Ensure images are inserted as embedded files, not as links
// canvases are ignored (according to my testing)
** Remove canvases and put any images they contained into the main flow as paragraph images (this limitation may be removed in the next release of pandoc)
// results of SEQ formulas are ignored (MS Word inserts them to generate figure and table numbers)
** [[remove-refs]]Remove hyperlinks and replace all internal references and auto-generated sequence numbers with their literal values (kbd:[Ctrl+A], kbd:[Ctrl+Shift+F9])
// No - this will turn manually applied list formatting back to plain text. Fine if you have used a list style though.
// * Remove all non style-based formatting (kbd:[Ctrl+A], kbd:[Ctrl+space], kbd:[Ctrl+Q])
// text boxes are ignored (according to my testing)
** Remove text boxes and put their text into the main flow
// Back to plain text.
// Not sure about this - they don't show properly in PSPad, but look fine when converted to HTML.
** Replace special characters: smart quotes with simple quotes, non-breaking hyphens with normal hyphens.
** Remove all character formatting (kbd:[Ctrl+A], kbd:[Ctrl+B], kbd:[Ctrl+B], kbd:[Ctrl+I], kbd:[Ctrl+I], kbd:[Ctrl+U], kbd:[Ctrl+U])
// pandoc just treats them as plain text as passes them through.
** Optional: insert ids and cross references using AsciiDoc notation
(You might find it easier doing it now rather than in the AsciiDoc document later.)
// Not sure if it is significant, but pandoc seems to be designed against this spec, rather than the normal docx.
** Save as "`Strict Open XML document (docx)``"
. Convert using pandoc as shown above.
. Check that the output document looks OK, and that all images have been extracted.
+
[NOTE]
====
If for some reason pandoc is not extracting images, you can always extract them by using unzip tool.
Docx is just a zip file with a docx file extension.
Embedded images are located in [.path]_word/media_ directory.

 $ unzip input.docx -d input-docx
   ls input-docx/word/media/

====

. Fix up the output, preferably with an editor that can do regular expressions:
// tocs and cross refs introduce dozens of these. They are just noise.
** Delete automatic ids (those beginning with underscores)
// Style issue - pandoc seems to extend the line to cover the longest row
** Replace long table delimiters with short ones.
// Style issue
** Insert line-breaks to get to 1 sentence per paragraph.
// can do this with a regexp, but is depends on exactly what format you used for them
** Re-insert images and turn caption paragraphs back into Asciidoctor captions.
// can do this with a regexp, but is depends on exactly what format you used for them
** Replace the hard cross references with AsciiDoc references.
// checked vertical merge, assume h merge same
** Fix tables: merged cells will have unmerged, column widths need putting back.
. Try to convert it, and fix any errors that come up.
// pandoc supposedly only uses UTF-8, and the xml file is windows encoded, but I haven't found any problems so far.
// You definitely do get encoding errors if you go via HTML.

The following are POSIX shell one-liners to automate some of these steps (adjust the regexps to match your particular document):

* Delete automatically inserted ids

 $ perl -W -pe  's!\[\[_.*]]!!g' -i output.adoc

* Shorten table delimiters

 $ perl -W -pe  's!\|==*!|====!g' -i output.adoc

* 1 sentence per line.
Be careful not to match lists.
It will get confused by abbreviations, but there is no way around that.

 $ perl -W -pe 's!(\w\w+)\.\s+(\w)!$1.\n$2!g' -i output.adoc

* Replace figure captions with id and title

 $ perl -W -pe 's!^Figure (\d+)\s?(.*)![[fig-$1]]\n.$2\n!g' -i output.adoc

* Replace references to figures with AsciiDoc xref

 $ perl -W -pe 's!Figure (\d+)!<<fig-$1>>!g' -i output.adoc

== Google Docs

Google Docs can already upload and edit MS Word docx files.
Using the {url-google-asciidoc}[AsciiDoc Processor add-on^] by https://github.com/ggrossetie[Guillaume Grossetie^], you can copy and paste part or all of the document from Google Docs as AsciiDoc text.
The features that it can handle seem to be substantially fewer than pandoc but expect further development.
The source for the add-on can be found in {url-google-asciidoc-source}[its repository^].

== Plain text

This method is only useful for very small files or if the other methods are not available.

* It keeps the text, and _fixes_ fields like auto-numbered lists and cross references.
* It loses tables (converted to plain paragraphs), images, symbols, form fields, and text boxes.

In MS Word, use "Save as > Plain text", then when the File Conversion dialog appears, set:

* Other encoding: UTF-8
* Do not insert line breaks
* Allow character substitution

Save the file then apply AsciiDoc markup manually.

Experiment with the encoding.
Try UTF-8 first, but if you get problems you can always revert to US-ASCII.

[[options.adoc]]
{empty}

// /modules/cli/pages/options.adoc
[[cli:options.adoc]]
= CLI Options

See xref:#options[`asciidoctor` options].


// /modules/html-backend/examples/my-document.adoc
= Examples my-document.adoc

// tag::title[]
== The Dangers of Wolpertingers
:url-wolpertinger: https://en.wikipedia.org/wiki/Wolpertinger
// end::title[]
// tag::body[]

Don't worry about gumberoos or splintercats.
Something far more fearsome plagues the days, nights, and inbetweens.
Wolpertingers.

== Origins

Wolpertingers are {url-wolpertinger}[ravenous beasts].
// end::body[]
// tag::image[]
[.left.text-center]
image:wolpertinger.jpg[Wolpertinger,100,,link="https://commons.wikimedia.org/wiki/File:Wolpertinger.jpg"]
They may look cute and cuddly, but don't be fooled.
// end::image[]

// /modules/html-backend/examples/wrap.adoc
= Examples wrap.adoc

// tag::nowrap[]
[%nowrap,java]
----
public class ApplicationConfigurationProvider extends HttpConfigurationProvider
{
   @Override
   public Configuration getConfiguration(ServletContext context)
   {
      return ConfigurationBuilder.begin()
               .addRule()
               .when(Direction.isInbound().and(Path.matches("/{path}")))
               .perform(Log.message(Level.INFO, "Client requested path: {path}"))
               .where("path").matches(".*");
   }
}
----
// end::nowrap[]

// /modules/install/partials/success.adoc
= install/partials/success.adoc

If the gem installed successfully, Asciidoctor's xref:#cli:index.adoc[command line interface (CLI)] will be available on your PATH.
To confirm that Asciidoctor is available, execute:

 $ asciidoctor --version

You should see information about the Asciidoctor version and your Ruby environment printed in the terminal.

[.output,subs=attributes+]
....
Asciidoctor {release-version} [https://asciidoctor.org]
Runtime Environment ({ruby-description}) (lc:UTF-8 fs:UTF-8 in:- ex:UTF-8)
....

// /modules/manpage-backend/examples/manpage.adoc
= Examples manpage.adoc

== eve(1)
// Andrew Stanton
// v1.0.0
:doctype: manpage
:manmanual: EVE
:mansource: EVE
:man-linkstyle: pass:[blue R < >]

== Name

eve - analyzes an image to determine if it's a picture of a life form

== Synopsis

*eve* [_OPTION_]... _FILE_...

== Options

*-o, --out-file*=_OUT_FILE_::
  Write result to file _OUT_FILE_.

*-c, --capture*::
  Capture specimen if it's a picture of a life form.

== Exit status

*0*::
  Success.
  Image is a picture of a life form.

*1*::
  Failure.
  Image is not a picture of a life form.

== Resources

*Project web site:* https://eve.example.org

== Copying

Copyright (C) 2008 {author}. +
Free use of this software is granted under the terms of the MIT License.

// /modules/migrate/examples/convert.groovy
= Examples convert.groovy

[source,groovy]
---------------
// This script is provided by melix.
// The source can be found at https://gist.github.com/melix/6020336

@Grab('net.sourceforge.htmlcleaner:htmlcleaner:2.4')
import org.htmlcleaner.*

def src = new File('html').toPath()
def dst = new File('asciidoc').toPath()

def cleaner = new HtmlCleaner()
def props = cleaner.properties
props.translateSpecialEntities = false
def serializer = new SimpleHtmlSerializer(props)

src.toFile().eachFileRecurse { f ->
    def relative = src.relativize(f.toPath())
    def target = dst.resolve(relative)
    if (f.isDirectory()) {
        target.toFile().mkdir()
    } else if (f.name.endsWith('.html')) {
        def tmpHtml = File.createTempFile('clean', 'html')
        println "Converting $relative"
        def result = cleaner.clean(f)
        result.traverse({ tagNode, htmlNode ->
                tagNode?.attributes?.remove 'class'
                if ('td' == tagNode?.name || 'th'==tagNode?.name) {
                    tagNode.name='td'
                    String txt = tagNode.text
                    tagNode.removeAllChildren()
                    tagNode.insertChild(0, new ContentNode(txt))
                }

            true
        } as TagNodeVisitor)
        serializer.writeToFile(
                result, tmpHtml.absolutePath, "utf-8"
        )
        "pandoc -f html-native_divs -t asciidoctor $tmpHtml --wrap=none -o ${target}.adoc".execute().waitFor()
        tmpHtml.delete()
    }/* else {
        "cp html/$relative $target".execute()
    }*/
}
---------------

// /modules/syntax-highlighting/examples/always-number-lines.rb
= Examples always-number-lines.rb

[source,rb]
-----------
def highlight node, source, lang, opts
  opts[:number_lines] = true
  super
end
-----------

// /modules/syntax-highlighting/examples/autolink-urls-in-comments.rb
= Examples autolink-urls-in-comments.rb

[source,rb]
-----------
class ExtendedRougeSyntaxHighlighter < (Asciidoctor::SyntaxHighlighter.for 'rouge')
  register_for 'rouge'

  def create_formatter node, source, lang, opts
    formatter = super
    formatter.singleton_class.prepend (Module.new do
      def safe_span tok, safe_val
        if tok.token_chain[0].matches? ::Rouge::Token::Tokens::Comment
          safe_val = safe_val.gsub(/https?:\/\/\S+/, '<a href="\&">\&</a>')
        end
        super
      end
    end)
    formatter
  end
end
-----------

// /modules/syntax-highlighting/examples/extended-pygments-syntax-highlighter.rb
= Examples extended-pygments-syntax-highlighter.rb

[source,rb]
-----------
class ExtendedPygmentsSyntaxHighlighter < (Asciidoctor::SyntaxHighlighter.for 'pygments')
  register_for 'pygments'

  def docinfo? location
    false
  end
end
-----------

// /modules/syntax-highlighting/examples/prism-syntax-highlighter.rb
= Examples prism-syntax-highlighter.rb

[source,rb]
-----------
class PrismSyntaxHighlighter < Asciidoctor::SyntaxHighlighter::Base
  register_for 'prism'

  def format node, lang, opts
    opts[:transform] = proc do |pre, code|
      code['class'] = %(language-#{lang}) if lang
    end
    super
  end

  def docinfo? location
    location == :footer
  end

  def docinfo location, doc, opts
    base_url = doc.attr 'prismdir', %(#{opts[:cdn_base_url]}/prism/1.15.0)
    slash = opts[:self_closing_tag_slash]
    unless (theme_name = doc.attr 'prism-style', 'prism') == 'prism'
      theme_name = %(prism-#{theme_name})
    end
    %(<link rel="stylesheet" href="#{base_url}/themes/#{theme_name}.min.css"#{slash}>
<script src="#{base_url}/prism.min.js"></script>
<script src="#{base_url}/components/prism-ruby.min.js"></script>)
  end
end
-----------


// /CHANGELOG.adoc
[[CHANGELOG.adoc]]
= Asciidoctor Changelog
:url-asciidoctor: https://asciidoctor.org
:url-asciidoc: https://docs.asciidoctor.org/asciidoc/latest/
:url-repo: https://github.com/asciidoctor/asciidoctor
:icons: font
:star: icon:star[role=red]
ifndef::icons[]
:star: &#9733;
endif::[]

{url-asciidoctor}[Asciidoctor] is a _fast_, open source text processor and publishing toolchain for converting {url-asciidoc}[AsciiDoc] content into HTML 5, DocBook 5, and other formats.

This document provides a high-level view of the changes introduced in Asciidoctor by release.
For an even more detailed look at what has changed, refer to the {url-repo}/commits/[commit history] on GitHub.

This project utilizes semantic versioning.

// tag::compact[]
== Unreleased

Improvements::

  * Ignore `SOURCE_DATE_EPOCH` environment variable if value is empty instead of exiting with non-zero exit code (#4631)

Bug Fixes::

  * Don't push conditional onto stack if conditional preprocessor directive is invalid when skipping lines (#4603)
  * Only style code tag as block element when inside pre in listing block; not inside verse block (#4610)

== 2.0.23 (2024-05-17) - @mojavelinux

Compliance::

  * Encode spaces in mailto links as %20, in accordance with RFC 3986, instead of + (#4576)

Improvements::

  * Log error when an incomplete row is detected at the end of a table (#4573)

Bug Fixes::

  * Don't leave behind empty line inside skipped preprocessor conditional (#4580)
  * Don't duplicate block attribute line above detached block that breaks a dlist; fixes duplicate role on detached block (#4565)
  * Don't crash when parsing xref shorthand if target starts with URL protocol and text is offset by space (#4570)
  * Only drop current row if colspan of last cell exceeds specified number of columns (#4587)
  * Drop last row if colspan of last cell in table exceeds specified number of columns (#4587)
  * Preserve repeating spaces in verbatim content in manpage output (#3583)

=== Details

{url-repo}/releases/tag/v2.0.23[git tag] | {url-repo}/compare/v2.0.22\...v2.0.23[full diff]
// end::compact[]

== 2.0.22 (2024-03-08) - @mojavelinux

Improvements::

  * Set `cloaked-context` attribute on source block when context is not `:listing` (#4556)

Compliance::

  * Remove use of base64 library to prevent warning in Ruby >= 3.3 (#4561)

=== Details

{url-repo}/releases/tag/v2.0.22[git tag] | {url-repo}/compare/v2.0.21\...v2.0.22[full diff]

== 2.0.21 (2024-02-20) - @mojavelinux

Compliance::

  * Turn off system-dependent newline conversion when writing files; don't convert line feeds to system-dependent newline (#4550)
  * Support logger in Ruby 3.3 by instantiating super class (#4493) (*@mtasaka*)
  * Add support for `scaledwidth` and `scale` attributes on inline image macro in DocBook output (#4552)
  * Update latest Ruby to 3.3 in CI workflows

Improvements::

  * Change title to doctitle in warning message about use of abstract to make subject more clear
  * Modify default stylesheet to add text decoration to active footnote number link in footnotes list (#4530) (@Larhzu)

Bug Fixes::

  * Nested dlist attached using list continuation should not consume detached paragraph (#3535)
  * Don't break nested dlist with attached block if offset from parent list by empty line (#3693)
  * Preserve paragraph breaks in normal table cell in manpage output (#4481)
  * Style cells in head row as bold in manpage output (#4490)
  * Escape spaces in include target (using inline passthrough) when generating link from include directive (#4461)
  * Move abstract inside info tag in DocBook output (#3602)
  * Honor secondary and tertiary terms on `indexterm` macro when primary term is quoted and contains an equals sign (#3652)
  * Remove extra border below doctitle when sidebar toc is collapsed into main content area (#4523)
  * Treat bare URL enclosed in angle brackets as unconstrained syntax; only match until closing angled bracket (#4468)
  * Allow URL enclosed in angled brackets syntax to be escaped using backslash (#4468)

=== Details

{url-repo}/releases/tag/v2.0.21[git tag] | {url-repo}/compare/v2.0.20\...v2.0.21[full diff]

== 2.0.20 (2023-05-18) - @mojavelinux

Bug Fixes::

   * Update `release-version` attribute in READMEs and man page during release
   * Rebuild man page during release

=== Details

{url-repo}/releases/tag/v2.0.20[git tag] | {url-repo}/compare/v2.0.19\...v2.0.20[full diff]

== 2.0.19 (2023-05-17) - @mojavelinux

Improvements::

  * Return empty string instead of nil if raw or verbatim block has no lines
  * Don't uppercase monospace span in section title in manpage output (#4402)
  * Simplify processing of implicit link (i.e., autolink) by separating implicit and explicit match
  * Generate partintro block consistently (#4450)
  * Add Kiswahili translation for built-in labels (PR #4454) (*@bkmgit*)

Compliance::

  * Fix call order so use of an include file with invalid encoding continues to raise error when using Ruby >= 3.2.0
  * Fix test assertion for fallback Rouge stylesheet to be compatible with Rouge 4.1 (#4406) (*@tmzullinger*)
  * Support `notitle` option on section as alternative to `untitled` to hide title (#4437)
  * Add support for Haml 6 to template converter (#4429)

Bug Fixes::

  * Process constrained inline passthrough inside monospace span (#4458)
  * Catalog inline ref defined using anchor macro even when resolved reftext is empty
  * Use while loop rather than recursion to locate next line to process; prevents stack limit error (#4368)
  * Avoid matching numeric character references when searching for # in xref target (#4393)
  * Use correct selector to collapse margin on first and last child of sidebar
  * Don't allow target of include directive to start with a space (to distinguish it from a dlist item) or to end with a space
  * Manify alt text of block image in manpage output (#4401)
  * Adjust font size of term in horizontal dlist to match font size of term in regular dlist
  * Implicitly attach nested list that starts with block attribute lines to dlist entry (#4268)
  * Don't swallow square brackets when processing escaped URL macro
  * Treat `uri:classloader:` as an absolute path prefix when running on JRuby (#3929)
  * Apply reftext substitutions to value of `mantitle` attribute in DocBook output (#4448)
  * Enclose `<reftext>` tag in `<article>` tag in DocBook output for man page (#4452)
  * Correctly handle compat role on monospace and constrained passthrough when box attrlist or formatted text is escaped

Build / Infrastructure::

  * Update latest CRuby in CI workflow to 3.2
  * Update latest JRuby in CI workflow to 9.4.2.0

=== Details

{url-repo}/releases/tag/v2.0.19[git tag] | {url-repo}/compare/v2.0.18\...v2.0.19[full diff]

== 2.0.18 (2022-10-15) - @mojavelinux

Improvements::

  * Propagate `:to_dir` option to document of AsciiDoc table cell (#4297)
  * Force encoding of attribute data passed via CLI to UTF-8 if transcoding fails (#4351) (*@zkaip*)
  * Add include role to link macro that replaces include directive when include is not enabled

Bug Fixes::

  * Change internal `uriish?` helper to only detect a URI pattern at start of a string; avoids misleading messages (#4357)
  * Prevent highlight.js warning when no language is set on source block; don't call `highlightBlock` if `data-lang` attribute is absent (#4263)
  * Don't raise error if `Asciidoctor::Extensions.unregister` is called before groups are initialized (#4270)
  * If path is included both partially and fully, store it with true value (included fully) in includes table of document catalog
  * Reset registry if activate is called on it again (#4256)
  * Format source location in exception message when extension code is malformed
  * Fix lineno on reader when `skip-front-matter` attribute is set but end of front matter is not found
  * Fix `Asciidoctor::Cli::Invoker` constructor when first argument is a hash
  * Update default stylesheet to honor marker on unordered list when marker is defined on ancestor unordered list (#4361)

=== Details

{url-repo}/releases/tag/v2.0.18[git tag] | {url-repo}/compare/v2.0.17\...v2.0.18[full diff]

== 2.0.17 (2022-01-05) - @mojavelinux

Bug Fixes::

  * Don't crash if process method for custom block returns an abstract block with context `:compound` that isn't of type `Block` (e.g., a list)
  * Ignore return value of process method for custom block or block macro if value matches parent argument
  * Remove unnamespaced selectors in Pygments stylesheet
  * Normalize output from Pygments to use `linenos` class for inline line numbering and trim space after number; update default stylesheet accordingly
  * Change `AbstractBlock#sections?` to return false when called on block that isn't a Section or Document (PR #3591) *@mogztter*
  * Hide built-in marker on HTML summary element in Safari when using default stylesheet (#4162)
  * Hide outline around HTML summary when activated in Safari (#4162)
  * Include primary video in value of `playlist` attribute when embedding YouTube video (#4156)
  * Honor `stripes=none` on nested table (#4165)
  * Update default stylesheet to fix spacing around empty list item (#4184)
  * Honor `:header_only` option when parsing document with manpage doctype (#4192)
  * Use numeric character reference for closing square bracket around alt text of icon
  * Process `author` or `authors` document attribute in document header when implicit doctitle is absent (#4206)
  * Patch open-uri-cached gem to work with Ruby 3.1 (update: drop patch now that open-uri-cached has been fixed) (#4227)

Improvements::

  * Prevent line numbers on source blocks in HTML output from being selected (applies to pygments and coderay) (#4128)
  * Allow hash to be specified for Vimeo video either in video ID or using `hash` attribute (#4176)
  * Remove unnecessary specificity in default stylesheet for styling p element inside list item
  * Remove obsolete gist embed styles from default stylesheet
  * Allow `--failure-level` to be set to default value, `FATAL`
  * Sort levels in help for `--failure-level` option in ascending order
  * Invert FR translations for caution & warning admonition labels (#4212) (*@cyChop*)
  * Add tests for open-uri-cached integration that is activated by the `cache-uri` attribute
  * Don't warn if negated tag is not found in include file (#4230)

Documentation::

  * Document how to extend an existing converter or create a new converter (#4136)
  * Document the syntax topic of the `--help` CLI option (#4175)
  * Document how to uninstall the Asciidoctor gem (#4154)
  * Document how to enable and use the sourcemap (the `:sourcemap` option)
  * Document how to catalog additional assets (the `:catalog_assets` option)

== 2.0.16 (2021-08-03) - @mojavelinux

Bug Fixes::

  * Include all lines outside of specified tagged region when tag filter on include directive is a single negated tag (#4048)
  * Only interpret negated wildcard in tag filter on include directive as implicit globstar if it precedes other tags (#4086)
  * Change ifeval directive to resolve to false if comparison operation cannot be performed (#4046)
  * Don't crash if `:to_file` option is passed to `load` or `load_file` and value is not a string (#4055)
  * Use automatic link text if ID in shorthand xref is followed by dangling comma (e.g., `+<<idname,>>+`)
  * Update default stylesheet to indent blocks attached to list item in checklist (#2550)
  * Update default stylesheet to re-enable styling of implicit lead role on first paragraph of preamble inside AsciiDoc table cell
  * Update default stylesheet to fix conflict between text decoration and bottom border on abbr[title] element
  * Change invalid font family "sans" in default stylesheet to "sans-serif"
  * Fix missing automatic reftext for internal xrefs in manpage output (#4110)
  * Replace numeric character reference for plus in manpage output (#4059)
  * Replace numeric character reference for degree sign in manpage output (#4059)
  * Convert apostrophe to the portable `+\*(Aq+` variable instead of the groff-specific escape `\(aq` (#4060) (*@felipec*)
  * Document the `-e, --embedded` option flag in the man page, which replaces the outdated `-e, --eruby` option flag

Improvements::

  * Use queue to iterate over lines in reader instead of stack (#4106)
  * Uppercase automatic reftext for level-2 section titles in manpage output if reftext matches section title (#4110)
  * Show safe modes in strictness order in CLI help (#4065)
  * Remove redundant styles from the default stylesheet
  * Update font styles for summary element in default stylesheet to match font styles of paragraph (#4114)
  * Update default stylesheet to indent content of details element (#4116)
  * Update default stylesheet to use custom marker for summary element to make appearance consistent (#4116)
  * Add Vietnamese translation of built-in attributes (PR #4066) (*@nguyenhoa93*)
  * Add Thai translation of built-in attributes (PR #4113) (*@ammaneena*)

Build / Infrastructure::

  * Import source of default stylesheet into this repository; use PostCSS with cssnano to minify (#4062)
  * Use autoprefixer to manage browser prefixes in default stylesheet (#4118)

== 2.0.15 (2021-04-27) - @mojavelinux

Bug Fixes::

  * Don't include trailing period, question mark, or exclamation point in target (URL) of autolink (#3860)
  * Don't assign nil value to named attribute mapped to absent positional attribute when parsing attrlist (#4033)
  * Remove leading and trailing spaces around role on inline phrase (#4035)
  * Ignore empty role on inline phrase defined using legacy syntax and followed by comma (#4035)
  * Use xreftext on document as fallback link text in HTML output for inter-document xref that resolves to current document when no link text is provided (#4032)
  * Use xreftext on document as fallback link text in HTML output for internal xref with empty fragment when no link text is provided (#4032)
  * Use document ID as linkend in DocBook output for internal xref with empty fragment; auto-generating one if necessary (#4032)

Improvements::

  * Format keyboard references in monospace in manpage output

Build / Infrastructure::

  * Get remaining invoker tests working on JRuby 9.1 for Windows

== 2.0.14 (2021-04-19) - @mojavelinux

Bug Fixes::

  * Don't allow AsciiDoc table cell to set document attribute that was unset from the API (exceptions include: `compat-mode`, `toc`, `showtitle`, and `notitle`) (#4017)
  * Ensure default document attributes unset in parent document remain unset in AsciiDoc table cell (#2586)
  * Allow the `showtitle` / `notitle` attribute to be toggled in an AsciiDoc table cell if set or unset in parent document (#4018)
  * Ensure mtime of input file honors TZ environment variable on JRuby for Windows (affects value of `docdatetime` attribute) (#3550)
  * Honor caption attribute on blocks that support captioned title even if corresponding `*-caption` document attribute (e.g., `example-caption`) is not set (#4023)
  * Suppress missing attribute warning when applying substitutions to implicit document title for assignment to intrinsic `doctitle` attribute (#4024)
  * Increment counter (but not the corresponding attribute) if attribute is locked (#4013)

Improvements::

  * Use attribute, if set, as seed value for counter even if not already registered as a counter (#4014)
  * Allow subs attribute value on Inline node returned by process method for custom inline macro to be a String (#3938)
  * Allow value of `user-home` attribute to be overridden by API or CLI (#3732)

Build / Infrastructure::

  * Run tests on JRuby for Windows (#3550)

== 2.0.13 (2021-04-10) - @mojavelinux

Bug Fixes::

  * Rollback change for #3470, which added logic to remove leading and trailing empty lines in an AsciiDoc include file; instead skip empty lines before processing document header (#3997)
  * Don't allow `counter` and `counter2` attribute directives to override locked attributes (#3939) (*@mogztter*)
  * Fix crash when resolving next value in sequence for counter with non-numeric value (#3940)
  * Honor list of tags following negated wildcard on include directive (#3932)
  * Update default stylesheet to remove dash in front of cite on nested quote block (#3847)
  * Don't mangle formatting macros when uppercasing section titles in man page output (#3892)
  * Don't escape hyphen in `manname` in man page output
  * Remove extra `.sp` line before content of verse block in man page output
  * Fix layout of footnotes in man page output (#3989)
  * Fix formatting of footnote text with URL in man page output (#3988)
  * Remove redundant trailing space on URL followed by non-adjacent text in man page output (#4004)
  * Use `.bp` macro at location of page break in man page output (#3992)

Improvements::

  * Extract method to create lexer and formatter in Rouge adapter (#3953) (*@Oblomov*)
  * Add support for pygments.rb 2.x (#3969) (*@slonopotamus*)
  * Allow `NullLogger` to be enabled by setting the `:logger` option to a falsy value (#3982)
  * Substitute attributes in manpurpose part of NAME section in manpage doctype (#4000)
  * Output all mannames in name section of HTML output for manpage doctype (#3757)

Build / Infrastructure::

  * Enable running tests as root (PR #3874) (*@mikemckiernan*)
  * Run tests against both pygments.rb 1.x and 2.x (#3969) (*@slonopotamus*)
  * Speed up CI by using Bundler cache (PR #3901) (*@slonopotamus*)

Documentation::

  * Import documentation for processor into this repository (#3861) (*@graphitefriction*)
  * Add Belarusian translation of built-in attributes (PR #3928) (*@morganov*)

== 2.0.12 (2020-11-10) - @mojavelinux

Bug Fixes::

  * Set type and target property on unresolved footnote reference and unset id property (fixes regression) (#3825)
  * Fix crash when inlining an SVG if the explicit width or height value on the image node is not a string (#3829)
  * Reset word wrap behavior to normal on tables, then re-enable again for admonition content, horizontal dlist description, and AsciiDoc table cells (#3833)

Improvements::

  * Pass through role to DocBook output for inline image (#3832)

Compliance::

  * Defer use of Ruby >= 2.3 constructs to restore compatibility with Ruby 2.0 until at least next minor release (#3827)
  * Don't append the default px unit identifier to the explicit width or height value when inlining an SVG (#3829)

Build / Infrastructure::

  * Migrate Linux CI jobs to GitHub Actions (#3837)
  * Migrate Windows CI jobs to GitHub Actions (#3839)
  * Run CI job on macOS (#3842)

== 2.0.11 (2020-11-02) - @mojavelinux

Bug Fixes::

  * Fix infinite loop when callout list with obsolete syntax is found inside list item (#3472)
  * Fix infinite loop when xreftext contains a circular reference path in HTML and manpage converters (#3543)
  * Apply text formatting to table cells in implicit header row when column has the "a" or "l" style (#3760)
  * Fix errant reference warning for valid reference when running in compat mode (#3555)
  * Initialize backend traits for converter (if not previously initialized) using assigned basebackend; mimics Asciidoctor < 2 behavior (#3341)
  * Set source_location on preamble block when sourcemap option is enabled (#3799)
  * Link the notitle and showtitle attributes so they act as opposites for the same toggle (#3804)
  * Pass options to constructor of Rouge lexer instead of #lex method; restores compatibility with Rouge >= 3.4 (#3336)
  * Don't clobber cgi-style options on language when enabling start_inline option on the Rouge PHP lexer (#3336)
  * Fix parsing of wrapped link and xref text, including when an attrlist signature is detected (#3331)
  * Restore deprecated writable number property on AbstractBlock
  * Always use title as xreftext if target block has an empty caption, regardless of xrefstyle value (#3745)
  * Allow a bibliography reference to be used inside a footnote (#3325)
  * Fix bottom margin collapsing on AsciiDoc table cell (#3370)
  * Remove excess hard line break in multi-line AsciiMath blocks (#3407)
  * Only strip trailing spaces from lines of AsciiDoc include file (#3436)
  * Remove errant optional flag in regexp for menu macro that breaks Asciidoctor.js (#3433)
  * Preserve repeating backslashes when generating manpage output (#3456)
  * Honor percentage width specified on macro of inline SVG (#3464)
  * Removing leading and trailing blank lines in AsciiDoc include file to match assumption of parser (#3470)
  * Activate extensions when :extensions option is set even if Extensions API is not yet loaded (#3570)
  * Don't activate global extensions if :extensions option is false (#3570)
  * Escape ellipsis at start of line in manpage output (#3645) (*@jnavila*)
  * Don't register footnote with ID if a footnote is already registered with that ID (#3690)
  * Honor start attribute on ordered list in manpage output (#3714)
  * Warn instead of crashing if SVG to inline is empty (#3638) (*@mogztter*)
  * Compute highlight line ranges on source block relative to value of start attribute (#3519) (*@mogztter*)
  * Prevent collapsible block from incrementing example number by assigning an empty caption (#3639)
  * Use custom init function for highlight.js to select the correct `code` elements (#3761)
  * Fix resolved value of :to_dir when both :to_file and :to_dir options are set to absolute paths (#3778)
  * Fix crash if value of `stylesheets` attribute contains a folder and the destination directory for the stylesheet does not exist (even when the `:mkdirs` option is set) (#3808)
  * Fix crash if value passed by API for `copycss` attribute is not a string (#3592)
  * Restore label in front of each bibliography entry in DocBook output that was dropped by fix for #3085 (#3782)
  * Apply max width to each top-level container instead of body in HTML output (#3513)
  * Don't apply border-collapse: separate to HTML for table blocks; fixes double border at boundary of colspan/rowspan (#3793) (*@ahus1*)
  * Don't remove right border on last table cell in row (#2563)
  * Rework table borders to leverage border collapsing (apply frame border to table, grid border to cells, and selectively override border on cells to accommodate frame) (#3387)

Compliance::

  * Account for empty positional attribute when parsing attrlist (#3813)
  * Add support for muted option to self-hosted video (#3408)
  * Move style tag for convert-time syntax highlighters (coderay, rouge, pygments) into head (#3462)
  * Move style tag for client-side syntax highlighters (highlight.js, prettify) into head (#3503)
  * Define entry point API methods (load, convert, load_file, convert_file) as class methods instead of module_function to avoid conflict with Kernel.load (#3625)
  * Retain attribute order on HTML code tag for source block to remain consistent with output from 1.5.x (#3786)
  * Correct language code for Korean language file from kr to ko (#3807) (*@jnavila*)

Improvements::

  * Apply word wrap (i.e., `word-wrap: anywhere`) to body in default stylesheet (#3544)
  * Allow `nobreak` and `nowrap` roles to be used on any inline element (#3544)
  * Add CSS class to support pre-wrap role to preserve leading, trailing, and repeating spaces in phrase (#3815)
  * Preserve guard around XML-style callout when icons are not enabled (#3319)
  * Use `.fam C` command to switch font family for verbatim blocks to monospaced text in manpage output (#3561)
  * Remove redundant test for halign and valign attributes on table cell in DocBook converter
  * Allow encoding of include file to be specified using encoding attribute (#3248)
  * Allow template to be used to override outline by only specifying the outline template (#3491)
  * Upgrade MathJax from 2.7.5 to 2.7.9
  * Upgrade highlight.js from 9.15.10 to 9.18.3 (note that this increases script size from 48.8 KB to 71.5 KB)
  * Skip unused default attribute assignments for embedded document
  * Allow a URL macro to have a preceding single or double quote (#3376)
  * Add support for erubi template engine; use it in place of erubis in test suite; note the use of erubis is deprecated (#3737)
  * Download and embed remote custom stylesheet if allow-uri-read is set (#3765)
  * Remove direction property from default stylesheet (#3753) (*@abdnh*)
  * remove max width setting on content column for print media in default stylesheet (#3802)
  * Normalize frame value "topbot" to "ends" in HTML output (consistently use frame-ends class) (#3797)
  * Add role setter method on AbstractNode (#3614)
  * Map chapter-signifier and part-signifier attributes in locale attribute files to replace chapter-label and part-label (#3817)

Build / Infrastructure::

  * Run test suite on TruffleRuby nightly (*@mogztter*, *@erebor*)
  * Upgrade TruffleRuby to 20.0.0 (*@mogztter*)
  * Trigger upstream builds for AsciidoctorJ on Github Actions (*@robertpanzer*)

== 2.0.10 (2019-05-31) - @mojavelinux

Bug Fixes::

  * fix Asciidoctor.convert_file to honor `header_footer: false` option when writing to file (#3316)
  * fix placement of title on excerpt block (#3289)
  * always pass same options to SyntaxHighlighter#docinfo, regardless of value of location argument
  * fix signature of SyntaxHighlighter#docinfo method (#3300)
  * when `icons` is set to `image`, enable image icons, but don't use it as the value of the `icontype` attribute (#3308)

== 2.0.9 (2019-04-30) - @mojavelinux

Bug Fixes::

  * process multiple single-item menu macros in same line (#3279)
  * register images in catalog correctly (#3283)
  * rename AbstractNode#options method to AbstractNode#enabled_options so it doesn't get shadowed by Document#options (#3282)
  * don't fail to convert document if alt attribute is not set on block or inline image (typically by an extension)
  * fix lineno of source location on blocks that follow a detached list continuation (#3281)
  * assume inline image type is "image" if not set (typically by an extension)

== 2.0.8 (2019-04-22) - @mojavelinux

Bug Fixes::

  * restore background color applied to literal blocks by default stylesheet (#3258)
  * use portability constants (CC_ALL, CC_ANY) in regular expressions defined in built-in converters (DocBook5 and ManPage)
  * use portability constant (CC_ANY) in regular expression for custom inline macros
  * use smarter margin collapsing for AsciiDoc table cell content; prevent passthrough content from being cut off (#3256)
  * don't limit footnote ref to ASCII charset; allow any word character in Unicode to be used (#3269)

Improvements::

  * register_for methods accept arguments as symbols (#3274)
  * use Concurrent::Map instead of Concurrent::Hash in template converter
  * use module_function keyword to define methods in Helpers
  * move regular expression definitions to separate source file (internal change)

== 2.0.7 (2019-04-13) - @mojavelinux

Bug Fixes::

  * fix crash when resolving ID from text and at least one candidate contains an unresolved xref (#3254)
  * fix compatibility with Rouge 2.0

Improvements::

  * improve documentation for the `-a` CLI option; explain that `@` modifier can be placed at end of name as alternative to end of value
  * move source for main API entry points (load, load_file, convert, convert_file) to separate files (internal change)
  * define main API entry points (load, load_file, convert, convert_file) as module functions

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 2.0.6 (2019-04-04) - @mojavelinux

Bug Fixes::

  * assume implicit AsciiDoc extension on inter-document xref macro target with no extension (e.g., `document#`); restores 1.5.x behavior (#3231)
  * don't fail to load application if call to Dir.home fails; use a rescue with fallback values (#3238)
  * Helpers.rootname should only consider final path segment when dropping file extension

Improvements::

  * implement Helpers.extname as a more efficient and flexible File.extname method
  * check for AsciiDoc file extension using end_with? instead of resolving the extname and using a lookup

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 2.0.5 (2019-04-01) - @mojavelinux

Bug Fixes::

  * fix crash when source highlighter is Rouge and source language is not set on block (#3223)
  * update CLI and SyntaxHighlighter to allow Asciidoctor to load cleanly on Ruby 2.0 - 2.2
  * CLI should use $stdin instead of STDIN to be consistent with the use of $stdout
  * mark encoding of stdio objects used in CLI as UTF-8 (#3225)
  * make Asciidoctor::SyntaxHighlighter::Config.register_for method public as documented

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 2.0.4 (2019-03-31) - @mojavelinux

Bug Fixes::

  * allow Asciidoctor to load cleanly on Ruby 2.0 - 2.2 for distributions that provide support for these older Ruby versions
  * make Asciidoctor::Converter::Config.register_for method public as documented
  * remove unused Asciidoctor::Converter::BackendTraits#derive_backend_traits private method
  * move Asciidoctor::Converter::BackendTraits.derive_backend_traits method to Asciidoctor::Converter
  * mark render and render_file methods as deprecated in API docs

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 2.0.3 (2019-03-28) - @mojavelinux

Bug Fixes::

  * fix crash when attrlist is used on literal monospace phrase (#3216)
  * update use of magic regexp variables to fix compatibility with Opal / Asciidoctor.js (#3214)

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 2.0.2 (2019-03-26) - @mojavelinux

Bug Fixes::

  * apply verbatim substitutions to literal paragraphs attached to list item (#3205)
  * implement #lines and #source methods on Table::Cell based on cell text (#3207)

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 2.0.1 (2019-03-25) - @mojavelinux

Bug Fixes::

  * convert titles of cataloged block and section nodes containing attribute references eagerly to resolve attributes while in scope (#3202)
  * customize MathJax (using a postfilter hook) to apply displaymath formatting to AsciiMath block (#2498)
  * fix misspelling of deprecated default_attrs DSL function (missing trailing "s")
  * remove unused location property (attr_accessor :location) on DocinfoProcessor class
  * look for deprecated extension option :pos_attrs if :positional_attrs option is missing (#3199)
  * add detail to load error message if path differs from gem name (#1884)

Build / Infrastructure::

  * bundle .yardopts in RubyGem (#3193)

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 2.0.0 (2019-03-22) - @mojavelinux

Enhancements / Compliance::

  * drop support for Ruby < 2.3 and JRuby < 9.1 and remove workarounds (#2764)
  * drop support for Slim < 3 (#2998)
  * drop the converter for the docbook45 backend from core; moved to https://github.com/asciidoctor/asciidoctor-docbook45 (#3005)
  * apply substitutions to section and block titles in normal substitution order (#1173)
  * make syntax highlighter pluggable; extract all logic into adapter classes (#2106)
  * add syntax highlighter adapter for Rouge (#1040)
  * redesign Converter API based on SyntaxHighlighter API; remap deprecated API to new API to ensure compatibility (#2891)
  * repurpose built-in converters as regular converters (#2891)
  * make registration and resolution of global converters thread-safe (#2891)
  * fold the default converter factory into the Converter module (#2891)
  * add a default implementation for Converter#convert in the Base converter (#2891)
  * rename Converter::BackendInfo to Converter::BackendTraits; map backend_info to new backend_traits method (#2891)
  * allow built-in converter classes to be resolved using Converter#for and instantiated using Converter#create (#2891)
  * allow converter factory to be passed using :converter_factory API option (#2891)
  * honor htmlsyntax if defined on converter (#2891)
  * add backend_traits_source keyword argument to CompositeConverter constructor (#2891)
  * add support for start attribute when using prettify to highlight source blocks with line numbering enabled
  * use String#encode to encode String as UTF-8 instead of using String#force_encoding (#2764)
  * add FILE_READ_MODE, URI_READ_MODE, and FILE_WRITE_MODE constants to control open mode when reading files and URIs and writing files (#2764)
  * set visibility of private and protected methods (#2764)
  * always run docinfo processor extensions regardless of safe mode (gives control to extension) (#2966)
  * use infinitive verb form for extension DSL method names; map deprecated method names where appropriate
  * add docinfo insertion slot for header location to built-in converters (#1720)
  * add support for the `muted` option on vimeo videos (allows autoplay to work in Chrome) (#3014)
  * use value of prettify-theme attribute as is if it starts with http:// or https:// (#3020)
  * allow icontype to be set using icons attribute (#2953)
  * when using a server-side syntax highlighter, highlight content of source block even if source language is not set (#3027)
  * automatically promote a listing block without an explicit style to a source block if language is set (#1117)
  * remove the 2-character (i.e., `""`) quote block syntax
  * don't allow block role to inherit from document attribute; only look for role in block attributes (#1944)
  * split out functionality of -w CLI flag (script warnings) from -v CLI flag (verbose logging) (#3030)
  * log possible invalid references at info level (#3030)
  * log dropped lines at info level when attribute-missing=drop-line (#2861)
  * honor attribute-missing setting when processing include directives and block macros (#2855)
  * log warning when include directive is not resolved due to missing attribute or blank target; always include warning in output document (#2868)
  * use the third argument of AbstractNode#attr / AbstractNode#attr? to set the name of a fallback attribute to look for on the document (#1934)
  * change default value of third argument to Abstractnode#attr / AbstractNode#attr? to nil so attribute doesn't inherit by default (#3059)
  * look for table-frame, table-grid, and table-stripes attributes on document as fallback for frame, grid, and stripes attributes on table (#3059)
  * add support for hover mode for table stripes (stripes=hover) (#3110)
  * always assume the target of a shorthand inter-document xref is a reference to an AsciiDoc document (source-to-source) (#3021)
  * if the target of a formal xref macro has a file extension, assume it's a path reference (#3021)
  * never assume target of a formal xref macro is a path reference unless a file extension or fragment is present (#3021)
  * encode characters in URI to comply with RFC-3986
  * implement full support for styled xreftext in manpage converter (#3077)
  * allow the ID and role properties to be set on a list item of ordered and unordered lists via the API (#2840)
  * yield processor instance to registration block for document processor if block has non-zero arity (i.e., has parameters)
  * add Document#parsed? method to check whether document has been parsed
  * modify Cell class to extend from AbstractBlock instead of AbstractNode (#2963)
  * implement block? and inline? methods on Column, both which return false (#2963)
  * drop verse table cell style (treat as normal table cell) (#3111)
  * allow negated subs to be specified on inline pass macro (#2191)
  * log warning if footnoteref macro is found and compat mode is not enabled (#3114)
  * log info message if inline macro processor returns a String value (#3176)
  * apply subs to Inline node returned by inline macro processor if subs attribute is specified (#3178)
  * add create_inline_pass helper method to base extension processor class (#3178)
  * log debug message instead of warning if block style is unknown (#3092)
  * allow backend to delegate to a registered backend using the syntax synthetic:delegate when using custom templates (e.g., slides:html) (#891)
  * AbstractBlock#find_by looks inside AsciiDoc table cells if traverse_documents selector option is true (#3101)
  * AbstractBlock#find_by finds table cells, which can be selected using the :table_cell context in the selector (#2524)
  * allow ampersand to be used in e-mail address (#2553)
  * propagate ID assigned to inline passthrough (#2912)
  * rename control keywords in find_by to better align with the standard NodeFilter terminology
  * stop find_by iteration if filter block returns :stop directive
  * rename header_footer option to standalone (while still honoring header_footer for backwards compatibility) (#1444)
  * replace anchors and xrefs before footnotes (replace footnotes last in macros substitution group)
  * apply substitution for custom inline macro before all other macros
  * only promote index terms automatically (A, B, C becomes A > B > C + B > C + C) if indexterm-promotion option is set on document (#1487)
  * add support for see and see-also on index terms; parse attributes on indexterm macros if text contains `=` (#2047)
  * drop :indexterms table from document catalog (in preparation for solution to #450 in a 2.x release)
  * load additional languages for highlight.js as defined in the comma-separated highlightjs-languages attribute (#3036)
  * log warning if conditional expression in ifeval directive is invalid (#3161)
  * drop lines that contain an invalid preprocessor directive (#3161)
  * rename AbstractBlock#find_by directives; use :prune in place of :skip_children and :reject in place of :skip
  * convert example block into details/summary tag set if collapsible option is set; open by default if open option is set (#1699)
  * substitute replacements in author values used in document header (#2441)
  * require space after semi-colon that separates multiple authors (#2441)
  * catalog inline anchors at start of callout list items (#2818) (*@owenh000*)
  * add parse_attributes helper method to base extension Processor class (#2134)
  * require at least one character in the term position of a description list (#2766)

Improvements::

  * propagate document ID to DocBook output (#3011)
  * always store section numeral as string; compute roman numeral for part at assignment time (@vmj)
  * refactor code to use modern Hash syntax
  * define LIB_DIR constant; rename *_PATH constants to *_DIR constants to be consistent with RubyGems terminology (#2764)
  * only define ROOT_DIR if not already defined (for compatibility with Asciidoctor.js)
  * move custom docinfo content in footer below built-in docinfo content in footer in HTML converter (#3017)
  * read and write files using File methods instead of IO methods (#2995)
  * value comparison in AbstractNode#attr? is only performed if expected value is truthy
  * align default CodeRay style with style for other syntax highlighters (#2106)
  * ensure linenos class is added to linenos column when source highlighter is pygments and pygments-css=style
  * disable table stripes by default (#3110)
  * rename CSS class of Pygments line numbering table to linenotable (to align with Rouge) (#1040)
  * remove unused Converter#convert_with_options method (#2891)
  * add -e, --embedded CLI flag as alias for -s, --no-header-footer (require long option to specify eRuby impl) (#1444)
  * don't store the options attribute on the block once the options are parsed (#3051)
  * add an options method on AbstractNode to retrieve the set of option names (#3051)
  * pass :input_mtime option to Document constructor; let Document constructor assign docdate/time/year attributes (#3029)
  * never mutate strings; add a `frozen_string_literal: true` magic comment to top of all Ruby source files (#3054)
  * always use docdate and doctime to compute docyear and docdatetime (#3064)
  * rename PreprocessorReader#exceeded_max_depth? to PreprocessorReader#exceeds_max_depth? and return nil if includes are disabled
  * stop populating :ids table in document catalog (#3084)
  * always use :refs table in document catalog to look for registered IDs (#3084)
  * don't compute and store reference text in document catalog (#3084)
  * populate reference text table lazily for resolving ID by reference text (#3084)
  * don't store fallback reference text on :bibref node (#3085)
  * call AbstractNode#reftext instead of AbstractNode#text to retrieve reference text for bibref node (#3085)
  * only map unparsed attrlist of inline macro to target when format is short
  * add clearer exception message when source data is binary or has invalid encoding (#2884)
  * rename context for table cell and table column to :table_cell and :table_column, respectively
  * rename hardbreaks document attribute to hardbreaks-option; retain hardbreaks as a deprecated alias (#3123)
  * extend TLD for implicit e-mail addresses to 5 characters (#3154)
  * truncate with precision (instead of rounding) when computing absolute width for columns in DocBook output (#3131)
  * drop legacy LaTeX math delimiters (e.g, `$..$`) if present (#1339)
  * use proper terminology in warning message about mismatched preprocessor directive (#3165)
  * rename low-level extension attribute name :pos_attrs to :positional_attrs
  * mark default_attrs extension DSL method deprecated in favor of default_attributes
  * upgrade MathJax to 2.7.5

Bug Fixes::

  * fix crash caused by inline passthrough macro with the macros sub clearing the remaining passthrough placeholders (#3089)
  * fix crash if ifeval directive is missing expression (#3164)
  * prevent relative leveloffset from making section level negative and causing hang (#3152)
  * don't fail to parse Markdown-style quote block that only contains attribution line (#2989)
  * enforce rule that Setext section title must have at least one alphanumeric character; fixes problem w/ block nested inside quote block (#3060)
  * apply header subs to doctitle value when assigning it back to the doctitle document attribute (#3106)
  * don't fail if value of pygments-style attribute is not recognized; gracefully fallback to default style (#2106)
  * do not alter the $LOAD_PATH (#2764)
  * fix crash if stem block is empty (#3118)
  * remove conditional comment for IE in output of built-in HTML converter; fixes sidebar table of contents (#2983)
  * fix styling of source blocks with linenums enabled when using prettify as syntax highlighter (#640)
  * update default stylesheet to support prettify themes (#3020)
  * remove hard-coded color values on source blocks in default stylesheet (#3020)
  * add fallback if relative path cannot be computed because the paths are located on different drives (#2944)
  * ignore explicit section level style (#1852)
  * don't eat space before callout number in source block if line-comment attribute is empty (#3121)
  * check if type is defined in a way that's compatible with autoload
  * fix invalid check for DSL in extension class (previously always returned true)
  * scope constant lookups (#2764)
  * use byteslice instead of slice to remove BOM from string (#2764)
  * don't fail if value of -a CLI option is empty string or equals sign (#2997)
  * allow failure level of CLI to be set to info
  * Reader#push_include should not fail if data is nil
  * fix deprecated ERB trim mode that was causing warning (#3006)
  * move time anchor after query string on vimeo video to avoid dropping options
  * allow color for generic text, line numbers, and line number border to inherit from Pygments style (#2106)
  * enforce and report relative include depth properly (depth=0 rather than depth=1 disables nested includes)
  * allow outfilesuffix to be soft set from API (#2640)
  * don't split paragraphs in table cell at line that resolves to blank if adjacent to other non-blank lines (#2963)
  * initialize the level to WARN when instantiating the NullLogger
  * next_adjacent_block should not fail when called on dlist item (#3133)
  * don't suppress browser styles for summary tag; add pointer cursor and panel margin bottom (#3155)
  * only consider TLDs in e-mail address that have ASCII alpha characters
  * allow underscore in domain of e-mail address

Build / Infrastructure::

  * clear SOURCE_DATE_EPOCH env var when testing timezones (PR #2969) (*@aerostitch*)
  * remove compat folder (removes the AsciiDoc.py config file that provides pseudo-compliance with Asciidoctor and a stylesheet for an old Font Awesome migration)
  * add Ruby 2.6.0 to build matrix
  * stop running CI job on unsupported versions of Ruby
  * exclude test suite, build script, and Gemfile from gem (#3044)
  * split build tasks out into individual files

Also see https://github.com/asciidoctor/asciidoctor/milestone/33?closed=1[issues resolved in 2.0.x] (cumulative).

== 1.5.8 (2018-10-28) - @mojavelinux

Enhancements::

  * if set, add value of part-signifier and chapter-signifier attributes to part and chapter titles (#2738)
  * allow position (float) and alignment (align) to be set on video block (#2425)
  * substitute attribute references in attrlist of include directive (#2761)
  * add Document#set_header_attribute method for adding method directly to document header during parsing (#2820)
  * add helper method to extension processor classes to create lists and list items
  * allow ordered and unordered lists to be nested to an arbitrary / unlimited depth (#2854)
  * add `prefer` DSL method to extension registry and document processor to flag extension as preferred (#2848)
  * allow manname and manpurpose to be set using document attributes; don't look for NAME section in this case (#2810)
  * substitute attribute references in target of custom block macro (honoring attribute-missing setting) (#2839)
  * interpret `<.>` as an auto-numbered callout in verbatim blocks and callout lists (#2871)
  * require marker for items in callout list to have circumfix brackets (e.g., `<1>` instead of `1>`) (#2871)
  * preserve comment guard in front of callout number in verbatim block if icons is not enabled (#1360)
  * add more conventional styles to quote block when it has the excerpt role (#2092)
  * colspecs can be separated by semi-colon instead of comma (#2798)
  * change AbstractBlock#find_by to respond to StopIteration exception; stop traversal after matching ID (#2900)
  * change AbstractBlock#find_by to honor return values :skip and :skip_children from filter block to skip node and its descendants or just its descendants, respectively (#2067)
  * add API to retrieve authors as array; use API in converters (#1042) (*@mogztter*)
  * add support for start attribute on source block to set starting line number when converting to DocBook (#2915)
  * track imagesdir for image on node and in catalog (#2779)
  * allow starting line number to be set using start attribute when highighting source block with Pygments or CodeRay (#1742)
  * add intrinsic attribute named `pp` that effectively resolves to `++` (#2807)
  * upgrade highlight.js to 9.13.1

Bug Fixes::

  * don't hang on description list item that begins with /// (#2888)
  * don't crash when using AsciiDoc table cell style on column in CSV table (#2817)
  * show friendly error if CSV data for table contains unclosed quote (#2878) (*@zelivans*)
  * don't crash when attribute entry continuation is used on last line of file (#2880) (*@zelivans*)
  * treat empty/missing value of named block attribute followed by other attributes (e.g., caption=,cols=2*) as empty string
  * AbstractNode#set_option does nothing if option is already set (PR #2778)
  * allow revnumber to be an attribute reference in revision info line (#2785)
  * use ::File.open instead of ::IO.binread in Reader for Asciidoctor.js compatibility
  * add fallback for timezone when setting doctime
  * preserve UNC path that begins with a double backslash (Windows) (#2869)
  * fix formatting of quote block (indentation) in manpage output (#2792)
  * catalog inline anchors in ordered list items (#2812)
  * detect closing tag on last line with no trailing newline (#2830)
  * process `!name@` attribute syntax property; follow-up to #642
  * change document extension processor DSL methods to return registered extension instance instead of array of instances
  * use fallback value for manname-title to prevent crash in manpage converter
  * consolidate inner whitespace in prose in manpage output (#2890)
  * only apply subs to node attribute value if enclosed in single quotes (#2905)
  * don't hide URI scheme if target of link macro is a bare URI scheme
  * fix crash when child section of part is out of sequence and section numbering is enabled (#2931)
  * fix crash when restoring passthroughs if passthrough role is enclosed in single quotes (#2882, #2883)
  * don't eagerly apply subs to inline attributes in general
  * make sure encoding of output file is UTF-8
  * prevent warning about invalid `:asciidoc` option when using custom templates with Slim 4 (#2928)
  * use Pathname#relative_path_from to compute relative path to file outside of base directory (#2108)

Improvements::

  * change trailing delimiter on part number to colon (:) (#2738)
  * interpret open line range as infinite (#2914)
  * rename number property on AbstractBlock to numeral, but keep number as deprecated alias
  * use CSS class instead of hard-coded inline float style on tables and images (#2753)
  * use CSS class instead of hard-coded inline text-align style on block images (#2753)
  * allow hyphen to be used custom block macro name as long as it's not the first character (#2620)
  * use shorthands %F and %T instead of %Y-%m-%d and %H:%M:%S to format time
  * read file in binary mode whenever contents are being normalized
  * use .drop(0) to duplicate arrays (roughly 1.5x as fast as .dup)
  * only recognize a bullet glyph which is non-repeating as an unordered list marker
  * rename SyntaxDsl module to SyntaxProcessorDsl (internal)
  * fail if name given to block macro contains illegal characters
  * normalize all whitespace in value of manpurpose attribute
  * make space before callout number after custom line comment character optional
  * parse attrlist on inline passthrough as a shorthand attribute syntax or literal role (#2910)
  * add support for range syntax (.. delimiter) to highlight attribute on source block (#2918)
  * add support for unbounded range to highlight attribute on source block (#2918)
  * automatically assign title and caption on image block if title is set on custom block source (#2926)
  * use OS independent timezone (UTC or time offset) in doctime and localtime attributes (#2770)
  * report correct line number for inline anchor with id already in use (#2769)
  * generate manpage even if input is non-conforming or malformed (#1639)
  * allow authorinitials for single author to be overridden (#669)

Documentation::

  * translate README into German (#2829) (*@jwehmschulte*)
  * sync French translation of README (*@mogztter*)
  * add Swedish translation of built-in attributes (PR #2930) (*@jonasbjork*)

Build / Infrastructure::

  * replace thread_safe with concurrent-ruby (PR #2822) (*@junaruga*)

== 1.5.7.1 (2018-05-10) - @mojavelinux

Bug Fixes::

  * fix regression where block attributes where being inherited by sibling blocks in a complex list item (#2771)
  * don't apply lead styling to first paragraph in nested document (AsciiDoc table cell) if role is present (#2624)

Build / Infrastructure::

  * drop obsolete logic in rake build (*@aerostitch*)
  * allow lib dir to be overridden for tests using an environment variable (PR #2758) (*@aerostitch*)
  * load asciidoctor/version from LOAD_PATH in gemspec if not found locally (PR #2760) (*@aerostitch*)

== 1.5.7 (2018-05-02) - @mojavelinux

Enhancements::

  * BREAKING: drop XML tags, character refs, and non-word characters (except hyphen, dot, and space) when auto-generating section IDs (#794)
   ** hyphen, dot, and space are replaced with value of idseparator, if set; otherwise, spaces are dropped
  * BREAKING: disable inter-document xrefs in compat mode (#2740)
  * BREAKING: automatically parse attributes in link macro if equals is present, ignoring linkattrs (except in compat mode) (#2059)
  * pass non-AsciiDoc file extensions in target of xref through unprocessed (#2740)
  * process any known AsciiDoc file extension in target of shorthand inter-document xref if hash is also present (e.g., `<<target.asciidoc#,text>>`) (#2740)
  * only allow .adoc to be used in target of formal xref macro to create an inter-document xref (with or without a hash) (#2740)
  * allow attribute names to contain any word character defined by Unicode (#2376, PR #2393)
  * do not recognize attribute entry line if name contains a colon (PR #2377)
  * route all processor messages through a logger instead of using Kernel#warn (#44, PR #2660)
  * add MemoryLogger for capturing messages sent to logger into memory (#44, PR #2660)
  * add NullLogger to prevent messages from being logged (#44, PR #2660)
  * log message containing source location / cursor as an object; provides more context (#44, PR #2660)
  * pass cursor for include file to `:include_location` key in message context (PR #2729)
  * add `:logger` option to API to set logger instance (#44, PR #2660)
  * add `--failure-level=LEVEL` option to CLI to force non-zero exit code if specified logging level is reached (#2003, PR #2674)
  * parse text of xref macro as attributes if attribute signature found (equal sign) (#2381)
  * allow xrefstyle to be specified per xref by assigning the xrefstyle attribute on the xref macro (#2365)
  * recognize target with .adoc extension in xref macro as an inter-document xref
  * resolve nested includes in remote documents relative to URI (#2506, PR #2511)
  * allow `relfilesuffix` attribute to control file extension used for inter-document xrefs (#1273)
  * support `!name@` (preferred), `!name=@`, `name!@`, and `name!=@` syntax to soft unset attribute from API or CLI (#642, PR #2649)
  * allow modifier to be placed at end of name to soft set an attribute (e.g., `icons@=font`) (#642, PR #2649)
  * interpret `false` attribute value defined using API as a soft unset (#642, PR #2649)
  * number parts if `partnums` attribute is set (#2298)
  * allow footnote macro to define or reference footnote reference (footnoteref macro now deprecated) (#2347, PR #2362)
  * allow custom converter to be used with custom templates; converter must declare that it supports templates (#2619)
  * add syntax help topic to CLI (`-h syntax`) (#1573)
  * allow manpage path for manpage help topic to be specified using ASCIIDOCTOR_MANPAGE_PATH environment variable (PR #2653) (*@aerostitch*)
  * if manpage cannot be found in default path inside gem, use `man -w asciidoctor` to resolve installed path (PR #2653)
  * uncompress contents of manpage for manpage help topic if path ends with .gz (PR #2653) (*@aerostitch*)
  * define source and manual refmiscinfo entries in manpage output if manual and source attributes are defined (PR #2636) (*@tiwai*)
  * add syntax for adding hard line breaks in block AsciiMath equations (#2497, PR #2579) (*@dimztimz*)
  * add positioning option to sectanchors attribute (sectanchors=before or sectanchors=after) (#2485, PR #2486)
  * allow table striping to be configured using stripes attribute (even, odd, all, or none) or stripes roles on table (#1365, PR #2588)
  * recognize `ends` as an alias to `topbot` for configuring the table frame
  * add rel=nofollow property to links (text or image) when nofollow option is set (#2605, PR #2692)
  * populate Document#source_location when sourcemap option is enabled (#2478, PR #2488)
  * populate source_location property on list items when sourcemap option is set on document (PR #2069) (*@mogztter*)
  * populate Table::Cell#source_location when sourcemap option is enabled (#2705)
  * allow local include to be flagged as optional by setting optional option (#2389, PR #2413)
  * allow block title to begin with a period (#2358, PR #2359)
  * catalog inline anchor at start of list items in ordered and unordered lists, description list terms, and table cells (#2257)
  * register document in catalog if id is set; assign reftext to document attributes if specified in a block attribute line (#2301, PR #2428)
  * allow automatic width to be applied to individual columns in a table using the special value `~` (#1844)
  * use the quote element in DocBook converter to represent smart quotes (#2272, PR #2356) (@bk2204)
  * parse and pass all manpage names to output (i.e., shadow man pages) (#1811, #2543, PR #2414)
  * parse credit line of shorthand quote block as block attributes; apply normal subs to credit line in shorthand quote blocks (#1667, PR #2452)
  * populate copyright element in DocBook output from value of copyright attribute (#2728)
  * preserve directories if source dir and destination dir are set (#1394, PR #2421)
  * allow linkcss to be unset from API or CLI when safe mode is secure
  * convert quote to epigraph element in DocBook output if block has epigraph role (#1195, PR #2664) (*@bk2204*)
  * number special sections in addition to regular sections when sectnums=all (#661, PR #2463)
  * upgrade to Font Awesome 4.7.0 (#2569)
  * upgrade to MathJax 4.7.4

Bug Fixes::

  * set `:to_dir` option value correctly when output file is specified (#2382)
  * preserve leading indentation in contents of AsciiDoc table cell if contents starts with a newline (#2712)
  * the shorthand syntax on the style to set block attributes (id, roles, options) no longer resets block style (#2174)
  * match include tags anywhere on line as long as offset by word boundary on left and space or newline on right (#2369, PR #2683)
  * warn if an include tag specified in the include directive is unclosed in the included file (#2361, PR #2696)
  * use correct parse mode when parsing blocks attached to list item (#1926)
  * fix typo in gemspec that removed README and CONTRIBUTING files from the generated gem (PR #2650) (*@aerostitch*)
  * preserve id, role, title, and reftext on open block when converting to DocBook; wrap in `<para>` or `<formalpara>` (#2276)
  * don't turn bare URI scheme (no host) into a link (#2609, PR #2611)
  * don't convert inter-document xref to internal anchor unless entire target file is included into current file (#2200)
  * fix em dash replacement in manpage converter (#2604, PR #2607)
  * don't output e-mail address twice when replacing bare e-mail address in manpage output (#2654, PR #2665)
  * use alternate macro for monospaced text in manpage output to not conflict w/ AsciiDoc macros (#2751)
  * enforce that absolute start path passed to PathResolver#system_path is inside of jail path (#2642, PR #2644)
  * fix behavior of PathResolver#descends_from? when base path equals / (#2642, PR #2644)
  * automatically recover if start path passed to PathResolver#system_path is outside of jail path (#2642, PR #2644)
  * re-enable left justification after invoking tmac URL macro (#2400, PR #2409)
  * don't report warning about same level 0 section multiple times (#2572)
  * record timings when calling convert and write on Document (#2574, PR #2575)
  * duplicate header attributes when restoring; allows header attributes to be restored an arbitrary number of times (#2567, PR #2570)
  * propagate `:catalog_assets` option to nested document (#2564, PR #2565)
  * preserve newlines in quoted CSV data (#2041)
  * allow opening quote around quoted CSV field to be on a line by itself
  * output table footer after body rows (#2556, PR #2566) (*@PauloFrancaLacerda*)
  * move @page outside of @media print in default stylesheet (#2531, PR #2532)
  * don't throw exception if text of dd node is nil (#2529, PR #2530)
  * don't double escape ampersand in manpage output (#2525) (*@dimztimz*)
  * fix crash when author_1 attribute is assigned directly (#2481, PR #2487)
  * fix CSS for highlighted source block inside colist (#2474, PR #2490)
  * don't append file extension to data uri of admonition icon (#2465, PR #2466)
  * fix race condition in Helpers.mkdir_p (#2457, PR #2458)
  * correctly process nested passthrough inside unconstrained monospaced (#2442, PR #2443)
  * add test to ensure ampersand in author line is not double escaped (#2439, PR #2440)
  * prevent footnote ID from clashing with auto-generated footnote IDs (#2019)
  * fix alignment of icons in footnote (#2415, PR #2416)
  * add graceful fallback if pygments.rb fails to return a value (#2341, PR #2342)
  * escape specialchars in source if pygments fails to highlight (#2341)
  * do not recognize attribute entry line if name contains colon (PR #2377)
  * allow flow indexterm to be enclosed in round brackets (#2363, PR #2364)
  * set outfilesuffix to match file extension of output file (#2258, PR #2367)
  * add block title to dlist in manpage output (#1611, PR #2434)
  * scale text to 80% in print styles (#1484, PR #2576)
  * fix alignment of abstract title when using default stylesheet (PR #2732)
  * only set nowrap style on table caption for auto-width table (#2392)
  * output non-breaking space for man manual if absent in DocBook output (PR #2636)
  * don't crash if stem type is not recognized (instead, fallback to asciimath)

Improvements / Refactoring::

  * BREAKING: rename table spread role to stretch (#2589, PR #2591)
  * use cursor marks to track lines more accurately; record cursor at the start of each block, list item, or table cell (PR #2701, PR #2547) (*@seikichi*)
  * log a warning message if an unterminated delimited block is detected (#1133, PR #2612)
  * log a warning when nested section is found inside special section that doesn't support nested sections (#2433, PR #2672)
  * read files in binary mode to disable automatic endline coercion (then explicitly coerce to UTF-8) (PR #2583, PR #2694)
  * resolve / expand parent references in start path passed to PathResolver#system_path (#2642, PR #2644)
  * update PathResolver#expand_path to resolve parent references (#2642, PR #2644)
  * allow start path passed to PathResolver#system_path to be outside jail if target brings resolved path back inside jail (#2642, PR #2644)
  * don't run File.expand_path on Dir.pwd (assume Dir.pwd is absolute) (#2642, PR #2644)
  * posixify working_dir passed to PathResolver constructor if absolute (#2642, PR #2644)
  * optimize detection for footnote* and indexterm* macros (#2347, PR #2362)
  * log a warning if a footnote reference cannot be resolved (#2669)
  * set logger level to DEBUG when verbose is enabled
  * coerce value of `:template_dirs` option to an Array (PR #2621)
  * make block roles specified using shorthand syntax additive (#2174)
  * allow paragraph to masquerade as open block (PR #2412)
  * move callouts into document catalog (PR #2394)
  * document ID defined in block attribute line takes precedence over ID defined inside document title line
  * don't look for link and window attributes on document when resolving these attributes for an image
  * skip line comments in name section of manpage (#2584, PR #2585)
  * always activate extension registry passed to processor (PR #2379)
  * skip extension registry activation if no groups are registered (PR #2373)
  * don't apply lead styling to first paragraph if role is present (#2624, PR #2625)
  * raise clearer exception when extension class cannot be resolved (#2622, PR #2623)
  * add methods to read results from timings (#2578, PR #2580)
  * collapse bottom margin of last block in AsciiDoc table cell (#2568, PR #2593)
  * set authorcount to 0 if there are no authors (#2519, PR #2520)
  * validate fragment of inter-document xref that resolves to current doc (#2448, PR #2449)
  * put id attribute on tag around phrase instead of preceding anchor (#2445, PR #2446)
  * add .plist extension to XML circumfix comment family (#2430, PR #2431) (*@akosma*)
  * alias Document#title method to no args Document#doctitle method (#2429, PR #2432)
  * upgrade missing or unreadable include file to an error (#2424, PR #2426)
  * add compliance setting to disable natural cross references (#2405, PR #2460)
  * make hash in inter-document xref target optional if target has extension (#2404, PR #2406)
  * add CSS class to part that matches role (#2401, PR #2402)
  * add fit-content class to auto-width table (#2392)
  * automatically assign parent reference when adding node to parent (#2398, PR #2403)
  * leave inline anchor in section title as is if section has ID (#2243, PR #2427)
  * align and improve error message about invalid use of partintro between HTML5 and DocBook converters
  * rephrase warning when level 0 sections are found and the doctype is not book
  * report correct line number when duplicate bibliography anchor is found
  * only warn if thread_safe gem is missing when using built-in template cache
  * rename enumerate_section to assign_numeral; update API docs
  * drop deprecated compact option from CLI; remove from manpage
  * use more robust mechanism for lazy loading the asciimath gem
  * use consistent phrase to indicate the processor is automatically recovering from a problem
  * change Reader#skip_comment_lines to not return skipped lines
  * add styles to default stylesheet for display on Kindle (kf8) devices (PR #2475)
  * purge render method from test suite (except to verify alias)

Documentation::

  * translate 'section-refsig' for German language (PR #2633) (*@ahus1*)
  * synchronize French README with English version (PR #2637) (*@flashcode*)

Build / Infrastructure::

  * create an official logo for the project (#48) (*@mmajko*)
  * update Ruby versions in appveyor build matrix (PR #2388) (*@miltador*)
  * add mailinglist, changelog, source, and issues URI to gem spec
  * allow blocks and substitutions tests to be run directly
  * asciidoctor formula now available for Homebrew (*@zmwangx*)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]
  * https://pkgs.alpinelinux.org/packages?name=asciidoctor[Alpine Linux (asciidoctor)]
  * https://software.opensuse.org/package/rubygem-asciidoctor[OpenSUSE (rubygem-asciidoctor)]

== 1.5.6.2 (2018-03-20) - @mojavelinux

Bug Fixes::

  * fix match for multiple xref macros w/ implicit text in same line (#2450)
  * PathResolver#root? returns true for absolute URL in browser env (#2595)

Improvements / Refactoring::

  * resolve include target correctly in browser (xmlhttprequest IO module) (#2599, #2602)
  * extract method to resolve include path (allowing Asciidoctor.js to override) (#2610)
  * don't expand docdir value passed to API (#2518)
  * check mandatory attributes when creating an image block (#2349, PR #2355) (*@mogztter*)
  * drop is_ prefix from boolean methods in PathResolver (PR #2587)
  * change Reader#replace_next_line to return true
  * organize methods in AbstractNode

Build / Infrastructure::

  * clean up dependencies
  * add Ruby 2.5.0 to CI build matrix (PR #2528)
  * update nokogiri to 1.8.0 for ruby >= 2.1 (PR #2380) (*@miltador*)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]
  * https://pkgs.alpinelinux.org/packages?name=asciidoctor[Alpine Linux (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.6.2[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.6.2[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.6.1...v1.5.6.2[full diff]

== 1.5.6.1 (2017-07-23) - @mojavelinux

Enhancements::

  * Don't include title of special section in DocBook output if untitled option is set (e.g., dedication%untitled)

Bug Fixes::

  * continue to read blocks inside a delimited block after content is skipped (PR #2318)
  * don't create an empty paragraph for skipped content inside a delimited block (PR #2319)
  * allow the subs argument of Substitutors#apply_subs to be nil
  * coerce group name to symbol when registering extension (#2324)
  * eagerly substitute attributes in target of inline image macro (#2330)
  * don't warn if source stylesheet can't be read but destination already exists (#2323)
  * track include path correctly if path is absolute and outside of base directory (#2107)
  * preprocess second line of setext section title (PR #2321)
  * preprocess second line of setext discrete heading (PR #2332)
  * return filename as relative path if filename doesn't share common root with base directory (#2107)

Improvements / Refactoring::

  * change default text for inter-document xref (PR #2316)
  * add additional tests to test behavior of Reader#peek_lines
  * parse revision info line correctly that only has version and remark; add missing test for scenario
  * rename AtxSectionRx constant to AtxSectionTitleRx for consistency with SetextSectionTitleRx constant
  * use terms "atx" and "setext" to refer to section title syntax (PR #2334)
  * rename HybridLayoutBreakRx constant to ExtLayoutBreakRx
  * change terminology from "floating title" to "discrete heading"
  * consolidate skip blank lines and check for end of reader (PR #2325)
  * have Reader#skip_blank_lines report end of file (PR #2325)
  * don't mix return type of Parser.build_block method (PR #2328)
  * don't track eof state in reader (PR #2320)
  * use shift instead of advance to consume line when return value isn't needed (PR #2322)
  * replace terminology "floating title" with "discrete heading"
  * remove unnecessary nil_or_empty? checks in substitutor
  * leverage built-in assert / refute methods in test suite

Build / Infrastructure::

  * config Travis CI job to release gem (PR #2333)
  * add SHA1 hash to message used for triggered builds
  * trigger build of AsciidoctorJ on every change to core
  * trigger build of Asciidoctor Diagram on every change to core

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]
  * https://pkgs.alpinelinux.org/packages?name=asciidoctor[Alpine Linux (asciidoctor)]
  * https://software.opensuse.org/package/rubygem-asciidoctor[OpenSUSE (rubygem-asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.6.1[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.6.1[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.6\...v1.5.6.1[full diff]

== 1.5.6 (2017-07-12) - @mojavelinux

Enhancements::

  * use custom cross reference text if xrefstyle attribute is set (full, short, basic) (#858, #1132)
  * store referenceable nodes under refs key in document catalog (PR #2220)
  * apply reftext substitutions (specialchars, quotes, replacements) to value returned by reftext method (PR #2220)
  * add xreftext method to AbstractBlock, Section, and Inline to produce formatted text for xref (PR #2220)
  * introduce attributes chapter-refsig, section-refsig, and appendix-refsig to set reference signifier for chapter, section, and appendix, respectively (PR #2220)
  * add rel="noopener" to links that target _blank or when noopener option is set (#2071)
  * add option to exclude tags when including a file (#1516)
  * add meta for shortcut icon if favicon attribute is set (#1574)
  * allow use of linenums option to enable line numbers on a source block (#1981)
  * allow extension groups to be unregistered individually (#1701)
  * catalog bibliography anchors and capture reftext (#560, #1562)
  * automatically add bibliography style to unordered list in bibliography section (#1924)
  * disable startinline option when highlighting PHP if mixed option is set on source block (PR #2015) (*@ricpelo*)
  * configure Slim to resolve includes in specified template dirs (#2214)
  * dump manpage when -h manpage flag is passed to CLI (#2302)
  * add resolves_attributes method to DSL for macros (#2122)
  * invoke convert on result of custom inline macro if value is an inline node (#2132)
  * resolve attributes for custom short inline macros if requested (#1797)
  * add convenience method to create section from extension; use same initialization logic as parser (#1957)
  * add handles? method to DSL for IncludeProcessor (#2119)
  * pass through preload attribute to video tag (#2046)
  * add start and end times for audio element (#1930)
  * set localyear and docyear attributes (#1372)
  * pass cloaked context to block extension via cloaked-context attribute (#1606)
  * add support for covers in DocBook 5 converter (#1939)
  * accept named pipe (fifo) as the input file (#1948)
  * add AbstractBlock#next_adjacent_block helper method
  * rename Document#references to catalog; alias references to catalog (PR #2237)
  * rename extensions_registry option to extension_registry
  * rename Extensions.build_registry method to create
  * autoload extensions source file when Asciidoctor::Extensions is referenced (PR #2114, PR #2312)
  * apply default_attrs to custom inline macro (PR #2127)
  * allow tab separator for table to be specified using \t (#2073)
  * add Cell#text= method

Improvements::

  * significant improvements to performance, especially in parser and substitutors
  * process include directive inside text of short form preprocessor conditional (#2146)
  * add support for include tags in languages that only support only circumfix comments (#1729)
  * allow spaces in target of block image; target must start and end with non-space (#1943)
  * add warning in verbose mode if xref is not found (#2268) (*@fapdash*)
  * add warning if duplicate ID is detected (#2244)
  * validate that output file will not overwrite input file (#1956)
  * include docfile in warning when stylesheet cannot be read (#2089)
  * warn if doctype=inline is used and block has unexpected content model (#1890)
  * set built-in docfilesuffix attribute (#1673)
  * make sourcemap field on Document read/write (#1916)
  * allow target of xref to begin with attribute reference (#2007)
  * allow target of xref to be expressed with leading # (#1546)
  * allow kbd and btn macros to wrap across multiple lines (#2249)
  * allow menu macro to span multiple lines; unescape escaped closing bracket
  * make menu macro less greedy
  * allow ampersand to be used as the first character of the first segment of a menu (#2171)
  * enclose menu caret in HTML tag (#2165)
  * use black text for menu reference; tighten word spacing (#2148)
  * fix parsing of keys in kbd macro (PR #2222)
  * add support for the window option for the link on a block image (#2172)
  * set correct level for special sections in parser (#1261)
  * always set numbered property on appendix to true
  * store number for formal block on node (#2208)
  * set sectname of header section to header (#1996)
  * add the remove_attr method to AbstractNode (#2227)
  * use empty string as default value for set_attr method (#1967)
  * make start argument to system_path optional (#1965)
  * allow API to control subs applied to ListItem text (#2035)
  * allow text of ListItem to be assigned (in an extension) (#2033)
  * make generate_id method on section a static method (#1929)
  * validate name of custom inline macro; cache inline macro rx (#2136)
  * align number in conum list to top by default (#1999)
  * fix CSS positioning of interactive checkbox (#1840)
  * fix indentation of list items when markers are disabled (none, no-bullet, unnumbered, unstyled) (PR #2286)
  * instruct icon to inherit cursor if inside a link
  * close all files opened internally (#1897)
  * be more precise about splitting kbd characters (#1660)
  * rename limit method on String to limit_bytesize (#1889)
  * leverage Ruby's match? method to speed up non-capturing regexps (PR #1938)
  * preserve inline break in manpages (*@letheed*)
  * check for presence of SOURCE_DATE_EPOCH instead of value; fail if value is malformed
  * add Rows#by_section method to return table sections (#2219)
  * cache which template engines have been loaded to avoid unnecessary processing
  * rename assign_index method to enumerate_section (PR #2242)
  * don't process double quotes in xref macro (PR #2241)
  * optimize attr and attr? methods (PR #2232)
  * use IO.write instead of File.open w/ block; backport for Opal
  * backport IO.binread to Ruby 1.8.7 to avoid runtime check
  * cache backend and doctype values on document
  * allow normalize option to be set on PreprocessorReader; change default to false
  * move regular expression constants for Opal to Asciidoctor.js build (PR #2070)
  * add missing comma in warning message for callout list item out of sequence
  * combine start_with? / end_with? checks into a single method call
  * rename UriTerminator constant to UriTerminatorRx
  * promote subs to top-level constants; freeze arrays
  * rename PASS_SUBS constant to NONE_SUBS
  * rename EOL constant to LF (retain EOL as alias)
  * rename macro regexp constants so name follows type (e.g., InlineImageMacroRx)

Compliance::

  * retain block content in items of callout list when converting to HTML and man page (#1478)
  * only substitute specialchars for content in literal table cells (#1912)
  * fix operator logic for ifndef directive with multiple attributes to align with behavior of AsciiDoc.py; when attributes are separated by commas, content is only included if none of the attributes listed are set; when attributes are separated by pluses, content is included if at least one of the attributes is not set (#1983)
  * only recognize uniform underline for setext section title (#2083)
  * don't match headings with mixed leading characters (#2074)
  * fix layout break from matching lines it shouldn't
  * fix behavior of attribute substitution in docinfo content (PR #2296)
  * encode spaces in URI (PR #2274)
  * treat empty string as a valid block title
  * preprocess lines of a simple block (#1923)
  * don't drop trailing blank lines when splitting source into lines (PR #2045)
  * only drop known AsciiDoc extensions from the inter-document xref path (#2217)
  * don't number special sections or special subsections by default (#2234)
  * assign sectname based on name of manuscript element (#2206)
  * honor leveloffset when resolving implicit doctitle (#2140)
  * permit leading, trailing, and repeat operators in target of preprocessor conditional (PR #2279)
  * don't match link macro in block form (i.e., has two colons after prefix) (#2202)
  * do not match bibliography anchor that begins with digit (#2247)
  * use [ \t] (or \s) instead of \p{Blank} to match spaces (#2204)
  * allow named entity to have trailing digits (e.g., there4) (#2144)
  * only assign style to image alt text if alt text is not specified
  * substitute replacements in non-generated alt text of block image (PR #2285)
  * keep track of whether alt text is auto-generated by assigning default-alt attribute (PR #2287)
  * suppress info element in docbook output if noheader attribute is set (#2155)
  * preserve leading indentation in literal and verse table cells (#2037)
  * preserve whitespace in literal and verse table cells (#2029)
  * set doctype-related attributes in AsciiDoc table cell (#2159)
  * fix comparison logic when preprocessing first line of AsciiDoc table cell
  * set filetype to man when backend is manpage (#2055)
  * respect image scaling in DocBook converter (#1059)
  * share counters between AsciiDoc table cells and main document (#1942)
  * generate ID for floating title from converted title (#2016)
  * split "treeprocessor" into two words; add aliases for compatibility (PR #2179)
  * allow trailing hyphen in attribute name used in attribute reference
  * allow escaped closing bracket in text of xref macro
  * process pass inline macro with empty text; invert extract logic
  * drop support for reftext document attribute (must be specified on node)
  * fix compliance with Haml >= 5 (load Haml eagerly; remove ugly option)
  * don't match inline image macro if target contains endline or leading or trailing spaces
  * assign id instead of target on ref/bibref node (PR #2307)
  * remove regexp hacks for Opal (#2110)
  * drop outdated quoting exceptions for Opal (PR #2081)

Bug Fixes::

  * don't allow table borders to cascade to nested tables (#2151)
  * escape special characters in reftext of anchor (#1694)
  * sanitize content of authors meta tag in HTML output (#2112)
  * use correct line number in warning for invalid callout item reference (#2275)
  * fix stray marks added when unescaping unconstrained passthroughs (PR #2079)
  * don't confuse escaped quotes in CSV data as enclosing quotes (#2008)
  * don't activate implicit header if cell in first line of table contains a blank line (#1284, #644)
  * allow compat-mode in AsciiDoc table cell to inherit from parent document (#2153)
  * manify all normal table cell content (head, body, foot) in manpage output
  * add missing newline after table caption in manpage output (#2253)
  * correctly format block title on video in manpage output
  * don't crash if substitution list resolves to nil (#2183)
  * fail with informative message if converter cannot be resolved (#2161)
  * fix regression of not matching short form of custom block macro
  * encode double quotes in image alt text when used in an attribute (#2061)
  * encode double quote and strip XML tags in value of xreflabel attribute in DocBook converter (PR #2220)
  * fix typo in base64 data (PR #2094) (*@mogztter*)
  * permit pass macro to surround a multi-line attribute value with hard line breaks (#2211)
  * fix sequential inline anchor macros with empty reftext (#1689)
  * don't mangle compound names when document has multiple authors (#663)
  * don't drop last line of verbatim block if it contains only a callout number (#2043)
  * prevent leading & trailing round brackets from getting caught in indexterm (#1581)
  * remove cached title when title is set on block (#2022)
  * remove max-width on the callout number icon (#1895)
  * eagerly add hljs class for highlight.js (#2221)
  * fix SOURCE_DATE_EPOCH lookup in Opal
  * fix paths with file URI scheme are inevitably absolute (PR #1925) (*@mogztter*)
  * only resolve file URLs when JavaScript IO module is xmlhttprequest (PR #1898) (*@mogztter*)
  * fix formatting of video title in manpage converter
  * don't increment line number if peek_lines overruns buffer (fixes some cases when line number is off)
  * freeze extension processor instance, not class
  * fix numbering bug in reindex_sections
  * handle cases when there are no lines for include directive to select

Documentation::

  * enable admonition icons in README when displayed on GitHub
  * add German translation of chapter-label (PR #1920) (*@fapdash*)
  * add Ukrainian translation of built-in attributes (PR #1955) (*@hedrok*)
  * add Norwegian Nynorsk translation; updated Norwegian Bokmål translation of built-in attributes (PR #2142) (*@huftis*)
  * add Polish translation of built-in attributes (PR #2131) (*@ldziedziul*)
  * add Romanian translation of built-in attributes (PR #2125) (*@vitaliel*)
  * fix Japanese translation of built-in attributes (PR #2116) (*@haradats*)
  * add Bahasa Indonesia translation of built-in labels (*@triyanwn*)

Build / Infrastructure::

  * upgrade highlight.js to 9.12.0 (#1652)
  * include entire test suite in gem (PR #1952) (*@voxik*)
  * upgrade Slim development dependency to 3.0.x (PR #1953) (*@voxik*)
  * upgrade Haml development dependency to 5.0.x
  * upgrade Nokogiri to 1.6.x (except on Ruby 1.8) (PR #1213)
  * add Ruby 2.4 to CI test matrix (PR #1980)
  * upgrade cucumber and JRuby in CI build (PR #2005)
  * fix reference to documentation in attributes.adoc (PR #1901) (*@stonio*)
  * trap and verify all warnings when tests are run with warnings enabled
  * set default task in build to test:all
  * configure run-tests.sh script to run all tests
  * configure feature tests to only show progress
  * configure Slim in feature tests to use html as format instead of deprecated html5
  * lock version of yard to fix invalid byte sequence in Ruby 1.9.3
  * modify rake build to trigger dependent builds (specifically, Asciidoctor.js) (PR #2305) (*@mogztter*)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]
  * https://pkgs.alpinelinux.org/packages?name=asciidoctor[Alpine Linux (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.6[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.6[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.5\...v1.5.6[full diff]

== 1.5.5 (2016-10-05) - @mojavelinux

Enhancements::

  * Add preference to limit the maximum size of an attribute value (#1861)
  * Honor SOURCE_DATE_EPOCH environment variable to accommodate reproducible builds (#1721) (*@JojoBoulix*)
  * Add reversed attribute to ordered list if reversed option is enabled (#1830)
  * Add support for additional docinfo locations (e.g., :header)
  * Configure default stylesheet to break monospace word if exceeds length of line using `word-wrap: break-word`; add `nobreak` and `nowrap` roles to prevent breaks (#1814)
  * Introduce translation file for built-in labels (*@ciampix*)
  * Provide translations for built-in labels (*@JmyL* - kr, *@ciampix* - it, *@ivannov* - bg, *@maxandersen* - da, *@radcortez* - pt, *@eddumelendez* - es, *@leathersole* - jp, *@aslakknutsen* - no, *@shahryareiv* - fa, *@AlexanderZobkov* - ru, *@dongwq* - zh, *@rmpestano* - pt_BR, *@ncomet* - fr, *@lgvz* - fi, *@patoi* - hu, *@BojanStipic* - sr, *@fwilhe* - de, *@rahmanusta* - tr, *@abelsromero* - ca, *@aboullaite* - ar, *@roelvs* - nl)
  * Translate README to Chinese (*@diguage*)
  * Translate README to Japanese (*@Mizuho32*)

Improvements::

  * Style nested emphasized phrases properly when using default stylesheet (#1691)
  * Honor explicit table width even when autowidth option is set (#1843)
  * Only explicit noheader option on table should disable implicit table header (#1849)
  * Support docbook orient="land" attribute on tables (#1815)
  * Add alias named list to retrieve parent List of ListItem
  * Update push_include method to support chaining (#1836)
  * Enable font smoothing on Firefox on OSX (#1837)
  * Support combined use of sectanchors and sectlinks in HTML5 output (#1806)
  * fix API docs for find_by
  * Upgrade to Font Awesome 4.6.3 (#1723) (*@allenan*, *@mogztter*)
  * README: add install instructions for Alpine Linux
  * README: Switch yum commands to dnf in README
  * README: Mention Mint as a Debian distro that packages Asciidoctor
  * README: Add caution advising against using gem update to update a system-managed gem (*@oddhack*)
  * README: sync French version with English version (*@flashcode*)
  * Add missing endline after title element when converting open block to HTML
  * Move list_marker_keyword method from AbstractNode to AbstractBlock
  * Rename definition list to description list internally

Compliance::

  * Support 6-digit decimal char refs, 5-digit hexadecimal char refs (#1824)
  * Compatibility fixes for Opal
  * Check for number using Integer instead of Fixnum class for compatibility with Ruby 2.4

Bug Fixes::
  * Use method_defined? instead of respond_to? to check if method is already defined when patching (#1838)
  * Fix invalid conditional in HTML5 converter when handling of SVG
  * Processor#parse_content helper no longer shares attribute list between blocks (#1651)
  * Fix infinite loop if unordered list marker is immediately followed by a dot (#1679)
  * Don't break SVG source when cleaning if svg start tag name is immediately followed by endline (#1676)
  * Prevent template converter from crashing if .rb file found in template directory (#1827)
  * Fix crash when generating section ID when both idprefix & idseparator are blank (#1821)
  * Use stronger CSS rule for general text color in Pygments stylesheet (#1802)
  * Don't duplicate forward slash for path relative to root (#1822)

Infrastructure::

  * Build gem properly in the absence of a git workspace, make compatible with JRuby (#1779)
  * Run tests in CI using latest versions of Ruby, including Ruby 2.3 (*@ferdinandrosario*)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]
  * https://pkgs.alpinelinux.org/packages?name=asciidoctor[Alpine Linux (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.5[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.5[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.4\...v1.5.5[full diff]

== 1.5.4 (2016-01-03) - @mojavelinux

Enhancements::

  * translate README into French (#1630) (*@anthonny*, *@mogztter*, *@gscheibel*, *@mgreau*)
  * allow linkstyle in manpage output to be configured (#1610)

Improvements::

  * upgrade to MathJax 2.6.0 and disable loading messages
  * upgrade to Font Awesome 4.5.0
  * disable toc if document has no sections (#1633)
  * convert inline asciimath to MathML (using asciimath gem) in DocBook converter (#1622)
  * add attribute to control build reproducibility (#1453) (*@bk2204*)
  * recognize \file:/// as a file root in Opal browser env (#1561)
  * honor icon attribute on admonition block when font-based icons are enabled (#1593) (*@robertpanzer*)
  * resolve custom icon relative to iconsdir; add file extension if absent (#1634)
  * allow asciidoctor cli to resolve library path when invoked without leading ./

Compliance::

  * allow special section to be nested at any depth (#1591)
  * ensure colpcwidth values add up to 100%; increase precision of values to 4 decimal places (#1647)
  * ignore blank cols attribute on table (#1647)
  * support shorthand syntax for block attributes on document title (#1650)

Bug Fixes::

  * don't include default toc in AsciiDoc table cell; don't pass toc location attributes to nested document (#1582)
  * guard against nil dlist list item in find_by (#1618)
  * don't swallow trailing line when include file is not readable (#1602)
  * change xlink namespace to xl in DocBook 5 output to prevent parse error (#1597)
  * make callouts globally unique within document, including AsciiDoc table cells (#1626)
  * initialize Slim-related attributes regardless of when Slim was loaded (#1576) (*@terceiro*)
  * differentiate literal backslash from escape sequence in manpage output (#1604) (*@ds26gte*)
  * don't mistake line beginning with \. for troff macro in manpage output (#1589) (*@ds26gte*)
  * escape leading dots so user content doesn't trigger troff macros in manpage output (#1631) (*@ds26gte*)
  * use \c after .URL macro to remove extraneous space in manpage output (#1590) (*@ds26gte*)
  * fix missing endline after .URL macro in manpage output (#1613)
  * properly handle spacing around .URL/.MTO macro in manpage output (#1641) (*@ds26gte*)
  * don't swallow doctitle attribute followed by block title (#1587)
  * change strategy for splitting names of author; fixes bug in Opal/Asciidoctor.js
  * don't fail if library is loaded more than once

Infrastructure::

  * remove trailing newlines in project source code
  * update contributing guidelines
  * explicitly test ifeval scenario raised in issue #1585
  * remove backreference substitution hack for Opal/Asciidoctor.js
  * fix assignment of default Hash value for Opal/Asciidoctor.js
  * add JRuby 9.0.4.0 and Ruby 2.3.0 to the Travis CI build matrix

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.4[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.4[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.3\...v1.5.4[full diff]

== 1.5.3 (2015-10-31) - @mojavelinux

Enhancements::

  * add support for interactive & inline SVGs (#1301, #1224)
  * add built-in manpage backend (#651) (*@davidgamba*)
  * create Mallard backend; asciidoctor/asciidoctor-mallard (#425) (*@bk2204*)
  * add AsciiMath to MathML converter to support AsciiMath in DocBook converter (#954) (*@pepijnve*)
  * allow text of selected lines to be highlighted in source block by Pygments or CodeRay (#1429)
  * use value of `docinfo` attribute to control docinfo behavior (#1510)
  * add `docinfosubs` attribute to control which substitutions are performed on docinfo files (#405) (*@mogztter*)
  * drop ability to specify multiple attributes with a single `-a` flag when using the CLI (#405) (*@mogztter*)
  * make subtitle separator chars for document title configurable (#1350) (*@rmannibucau*)
  * make XrefInlineRx regexp more permissive (Mathieu Boespflug) (#844)

Improvements::

  * load JavaScript and CSS at bottom of HTML document (#1238) (*@mogztter*)
  * list available backends in help text (#1271) (*@plaindocs*)
  * properly expand tabs in literal text (#1170, #841)
  * add `source-indent` as document attribute (#1169) (*@mogztter*)
  * upgrade MathJax to 2.5.3 (#1329)
  * upgrade Font Awesome to 4.4.0 (#1465) (*@mogztter*)
  * upgrade highlight.js to 8.6 (now 8.9.1) (#1390)
  * don't abort if syntax highlighter isn't available (#1253)
  * insert docinfo footer below footer div (#1503)
  * insert toc at default location in embeddable HTML (#1443)
  * replace _ and - in generated alt text for inline images
  * restore attributes to header attributes after parse (#1255)
  * allow docdate and doctime to be overridden (#1495)
  * add CSS class `.center` for center block alignment (#1456)
  * recognize U+2022 (bullet) as alternative marker for unordered lists (#1177) (*@mogztter*)
  * allow videos to work for local files by prepending asset-uri-scheme (Chris) (#1320)
  * always assign playlist param when loop option is enabled for YouTube video
  * parse isolated version in revision line (#790) (*@bk2204*)
  * autoload Tilt when template converter is instantiated (#1313)
  * don't overwrite existing id entry in references table (#1256)
  * use outfilesuffix attribute defined in header when resolving outfile (#1412)
  * make AsciiDoc safe mode option on Slim engine match document (#1347)
  * honor htmlsyntax attribute when backend is html/html5 (#1530)
  * tighten spacing of wrapped lines in TOC (#1542)
  * tune padding around table cells in horizontal dlist (#1418)
  * load Droid Sans Mono 700 in default stylesheet
  * set line height of table cells used for syntax highlighting
  * set font-family of kbd; refine styling (#1423)
  * extract condition into `quote_lines?` method (*@mogztter*)
  * extract inline code into `read_paragraph` method (*@mogztter*)
  * parent of block in ListItem should be ListItem (#1359)
  * add helper methods to List and ListItem (#1551)
  * add method `AbstractNode#add_role` and `AbstractNode#remove_role` (#1366) (*@robertpanzer*)
  * introduce helper methods for sniffing URIs (#1422)
  * add helper to calculate basename without file extension
  * document `-I` and `-r` options in the manual page (*@bk2204*)
  * fix `+--help+` output text for `-I` (*@bk2204*)
  * don't require open-uri-cached if already loaded
  * do not attempt to scan pattern of non-existent directory in template converter
  * prevent CodeRay from bolding every 10th line number

Compliance::

  * use `<sup>` for footnote reference in text instead of `<span>` (#1523)
  * fix alignment of wrapped text in footnote (#1524)
  * include full stop after footnote number in embeddable HTML
  * show manpage title & name section in embeddable HTML (#1179)
  * resolve missing attribute in ifeval to empty string (#1387)
  * support unbreakable & breakable options on table (rockyallen) (#1140)

Bug Fixes::

  * don't truncate exception stack in `Asciidoctor.load` (#1248)
  * don't fail to save cause of Java exception (#1458) (*@robertpanzer*)
  * fix precision error in timings report (#1342)
  * resolve regexp for inline macro lazily (#1336)
  * block argument to `find_by` should filter results (#1393)
  * strip comment lines in indented text of dlist item (#1537)
  * preserve escaped delimiter at end of line in a table (#1306)
  * correctly calculate colnames for implicit columns (#1556)
  * don't crash if colspan exceeds colspec (#1460)
  * account for empty records in colspec (#1375)
  * ignore empty cols attribute on table
  * use `.inspect` to print MathJax delimiters (again) (#1198)
  * use while loop instead of begin/while loop to address bug in Asciidoctor.js (#1408)
  * force encoding of attribute values passed from cli (#1191)
  * don't copy css if stylesheet or stylesdir is a URI (#1400)
  * fix invalid color value in default CodeRay theme
  * built-in writer no longer fails if output is nil (#1544)
  * custom template engine options should take precedence
  * fallback to require with a non-relative path to support Debian package (*@mogztter*)
  * pass opts to recursive invocations of `PathResolver#system_path`
  * fix and test external links in docbook backend
  * use format symbol `:html` instead of `:html5` for Slim to fix warnings
  * fix documentation for inline_macro and block_macro (Andrea Bedini)
  * fix grammar in warning messages regarding thread_safe gem

Infrastructure::

  * migrate opal_ext from core to Asciidoctor.js (#1517)
  * add Ruby 2.2 to CI build; only specify minor Ruby versions
  * enable containerized builds on Travis CI
  * add config to run CI build on AppVeyor
  * exclude benchmark folder from gem (#1522)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.3[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.3[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.2\...v1.5.3[full diff]

== 1.5.2 (2014-11-27) - @mojavelinux

Enhancements::

  * add docinfo extension (#1162) (*@mogztter*)
  * allow docinfo to be in separate directory from content, specified by `docinfodir` attribute (#511) (*@mogztter*)
  * enable TeX equation auto-numbering if `eqnums` attribute is set (#1110) (*@jxxcarlson*)

Improvements::

  * recognize `--` as valid line comment for callout numbers; make line comment configurable (#1068)
  * upgrade highlight.js to version 8.4 (#1216)
  * upgrade Font Awesome to version 4.2.0 (#1201) (*@clojens*)
  * define JAVASCRIPT_PLATFORM constant to simplify conditional logic in the JavaScript environment (#897)
  * provide access to destination directory, outfile and outdir via Document object (#1203)
  * print encoding information in version report produced by `asciidoctor -v` (#1210)
  * add intrinsic attribute named `cpp` that effectively resolves to `C++` (#1208)
  * preserve URI targets passed to `stylesheet` and related attributes (#1192)
  * allow numeric characters in block attribute name (#1103)
  * support custom YouTube playlists (#1105)
  * make start number for unique id generation configurable (#1148)
  * normalize and force UTF-8 encoding of docinfo content (#831)
  * allow subs and default_subs to be specified in Block constructor (#749)
  * enhance error message when reading binary input files (#1158) (*@mogztter*)
  * add `append` method as alias to `<<` method on AbstractBlock (#1085)
  * assign value of `preface-title` as title of preface node (#1090)
  * fix spacing around checkbox in checklist (#1138)
  * automatically load Slim's include plugin when using slim templates (#1151) (*@jirutka*)
  * mixin Slim helpers into execution scope of slim templates (#1143) (*@jirutka*)
  * improve DocBook output for manpage doctype (#1134, #1142) (*@bk2204*)

Compliance::

  * substitute attribute entry value in attributes defined outside of header (#1130)
  * allow empty cell to appear at end of table row (#1106)
  * only produce one row for table in CSV or DSV format with a single cell (#1180)

Bug Fixes::

  * add explicit to_s call to generate delimiter settings for MathJax config (#1198)
  * fix includes that reference absolute Windows paths (#1144)
  * apply DSL to extension block in a way compatible with Opal

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.2[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.2[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.1\...v1.5.2[full diff]

== 1.5.1 (2014-09-29) - @mojavelinux

Bug Fixes::

  * recognize tag directives inside comments within XML files for including tagged regions
  * restore passthroughs inside footnotes when more than one footnote appears on the same line
  * -S flag in cli recognizes safe mode name as lowercase string
  * do not match # in character reference when looking for marked text
  * add namespace to lang attribute in DocBook 5 backend
  * restore missing space before conum on last line of listing when highlighting with Pygments
  * place conums on correct lines when line numbers are enabled when highlighting with Pygments
  * don't expand mailto links in print styles

Improvements::

  * implement File.read in Node (JavaScript) environment
  * assign sectnumlevels and toclevels values to maxdepth attribute on AsciiDoc processing instructions in DocBook output
  * add test for usage of image block macro with data URI
  * use badges from shields.io in README

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?q=milestone%3Av1.5.1[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.1[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v1.5.0\...v1.5.1[full diff]

== 1.5.0 (2014-08-12) - @mojavelinux

Performance::

  * 10% increase in speed compared to 0.1.4
  * rewrite built-in converters in Ruby instead of ERB

Enhancements::

  * {star} introduce new curved quote syntax (pass:["`double quotes`"], pass:['`single quotes`']) if compat-mode attribute not set (#1046)
  * {star} add single curved quote replacement for pass:[`'] (#715)
  * {star} use backtick (`) for monospaced text if compat-mode attribute not set (#714, #718)
  * {star} use single and double plus (pass:[+], pass:[++]) for inline passthrough if compat-mode attribute not set (#714, #718)
  * {star} disable single quotes as formatting marks for emphasized text if compat-mode attribute not set (#717)
  * {star} enable compat-mode by default if document has atx-style doctitle
  * {star} output phrase surrounded by # as marked text (i.e., <mark>) (#225)
  * {star} add MathJax integration and corresponding blocks and macros (#492, #760)
  * {star} switch to open source fonts (Open Sans, Noto Serif and Droid Sans Mono) in default stylesheet, major refinements to theme (#879)
  * {star} embed remote images when data-uri and allow-uri-read attributes are set (#612)
  * {star} support leveloffset on include directive and honor relative leveloffset values (#530)
  * {star} switch default docbook backend to docbook5 (#554) (*@bk2204*)
  * {star} added hide-uri-scheme attribute to hide uri scheme in automatic links (#800)
  * {star} allow substitutions to be incrementally added & removed (#522)
  * {star} add compatibility with Opal, add shim compat library, use compatibility regexp, require libraries properly (#679, #836, #846) (*@mogztter*)
  * {star} output XHTML when backend is xhtml or xhtml5 (#494)
  * {star} add shorthand subs and specialchars as an alias for specialcharacters (#579)
  * {star} deprecate toc2 attribute in favor of position and placement values on toc attribute (e.g., toc=left) (#706)
  * {star} add source map (file and line number) information to blocks (#861)
  * {star} write to file by default if input is file (#907)
  * {star} add -r and -I flags from ruby command to asciidoctor command for loading additional libraries (#574)
  * support backslash (\) as line continuation character in the value of an attribute entry (#1022)
  * disable subs on pass block by default (#737)
  * add basic support for resolving xref target from reftext (#589)
  * add time range anchor to video element (#886)
  * match implicit URLs that use the file scheme (#853)
  * added sectnumlevels to control depth of section numbering (#549)
  * add hardbreaks option to block (#630)
  * substitute attribute references in manname
  * warn on reference to missing attribute if attribute-missing is "warn"
  * only enable toc macro if toc is enabled and toc-placement attribute has the value macro (#706)
  * add sectnums attribute as alternative alias to numbered attribute (#684)

Improvements::

  * {star} don't select lines that contain a tag directive when including tagged lines, make tag regexp more strict (#1027)
  * {star} use https scheme for assets by default
  * {star} upgrade to Font Awesome 4.1 (#752) (*@mogztter*)
  * {star} improve print styles, add print styles for book doctype (#997, #952) (*@leif81*)
  * {star} add proper grid and frame styles for tables (#569) (*@leif81*)
  * {star} use glyphs for checkboxes when not using font icons (#878)
  * {star} prefer source-language attribute over language attribute for defining default source language (#888)
  * {star} pass document as first argument to process method on Preprocessor
  * don't parse link attributes when linkattrs is set unless text contains equal sign
  * detect bare links, mark with bare class; don't repeat URL of bare link in print styles
  * allow Treeprocessor#process method to replace tree (#1035)
  * add AbstractNode#find_by method to locate nodes in tree (#862)
  * add API for parsing title and subtitle (#1000)
  * add use_fallback option to doctitle, document method
  * constrain subscript & superscript markup (#564, #936)
  * match cell specs when cell separator is customized (#985)
  * use stylesheet to set default table width (#975)
  * display nested elements correctly in toc (#967) (*@kenfinnigan*)
  * add support for id attribute on links (#935) (*@mogztter*)
  * add support for title attribute on links (*@aslakknutsen*)
  * add -t flag to cli to control output of timing information (#909) (*@mogztter*)
  * rewrite converter API (#778)
  * rewrite extensions to support extension instances for AsciidoctorJ (#804)
  * integrate thread_safe gem (#638)
  * allow inline macro extensions that define a custom regexp to be matched (#792)
  * make Reader#push_include work with default file, path and dir (#743) (*@bk2204*)
  * honor custom outfilesuffix and introduce relfileprefix (#801)
  * add author and copyright to meta in HTML5 backend (#838)
  * output attribution in front of citetitle for quote and verse blocks
  * recognize float style with shorthand syntax outside block (#818)
  * honor background color in syntax highlighting themes (#813)
  * print runtime environment in version output, support -v as version flag (#785)
  * unwrap preamble if standalone (#533)
  * drop leading & trailing blank lines in verbatim & raw content (#724)
  * remove trailing newlines from source data (#727)
  * add flag to cli to suppress warnings (#557)
  * emit warning if tag(s) not found in include file (#639)
  * use <th> element for vertical table headers instead of header class (#738) (*@davidgamba*)
  * share select references between AsciiDoc-style cell & main document (#729)
  * number chapters sequentially, always (#685)
  * add vbar attribute, make brvbar resolve properly (#643)
  * add implicit user-home attribute that resolves to user's home directory (#629)
  * enable sidebar toc for small screens (#628)
  * add square brackets around button in HTML output (#631)
  * make language hover text work for all languages in listing block
  * set background color on toc2 to cover scrolling content (*@neher*)
  * make document parsing a discrete step, make Reader accessible as property on Document
  * allow custom converter to set backend info such as outfilesuffix and htmlsyntax
  * report an informative error message when a converter cannot be resolved (*@mogztter*)
  * add conum class to b element when icons are disabled, make conum CSS selector more specific
  * expose Document object to extension point IncludeProcessor (*@aslakknutsen*)
  * style audioblock title, simplify rules for block titles
  * alias :name_attributes to :positional_attributes in extension DSL
  * upgrade to highlight.js 7.4 (and later 8.0) (#756) (*@mogztter*)

Compliance::

  * only include xmlns in docbook45 backend if xmlns attribute is specified (#929)
  * add xmlns attribute for xhtml output (*@bk2204*)
  * warn if table without a body is converted to DocBook (#961)
  * wrap <para> around admonition inside example block in DocBook 4.5 (#931)
  * use <informalfigure> if block image doesn't have a title (#927)
  * fix invalid docbook when adding role to formatted text (#956)
  * move all compliance flags to Compliance module (#624)
  * add compliance setting to control use of shorthand property syntax (#789)
  * wrap top-level content inside preamble in DocBook backend when doctype is book (#971)
  * escape special chars in image alt text (#972)
  * set starting number in ordered list for docbook (#925) (*@megathaum*)
  * match word characters in regular expressions as defined by Unicode (#892)
  * put source language class names on child code element of pre element (#921)
  * ignore case of attribute in conditional directives (#903)
  * allow attribute entry to reset / reseed counter (#870)
  * allow doctype to be set in AsciiDoc table cell (#863)
  * match URL macro following entity (#819) (*@jmbruel*)
  * handle BOM when normalizing source (#824)
  * don't output revhistory if revdate is not set (#802)
  * perform normal subs on verse content (#799)
  * automatically wrap part intro content in partintro block, emit warning if part is invalid (#768)
  * force encoding of docinfo content to UTF-8 (#773)
  * add scaling & alignment attributes to block image in DocBook backend (#763)
  * add support for \anchor:<id>[<reftext>] macro (#531)
  * substitute anchor and xref macros in footnotes (#676)
  * remove all string mutation operations for compatibility with Opal (#735)
  * honor reftext defined in embedded section title anchor (#697)
  * allow spaces in reftext defined in block anchor (#695)
  * use reftext of section or block in text of xref link (#693)
  * number sections in appendix using appendix number (#683)
  * unescape escaped square closing bracket in footnote text (#677)
  * support quoted index terms that may contain commas (#597)
  * don't assign role attribute if quoted text has no roles (#647)
  * disallow quoted values in block and inline anchors
  * add % to scaledwidth if no units given
  * ignore block attribute with unquoted value None
  * preserve entity references with 5 digits

Bug Fixes::

  * resolve relative paths relative to base_dir in unsafe mode (#690)
  * properly handle nested passthroughs (#1034)
  * don't clobber outfilesuffix attribute if locked (#1024)
  * correctly calculate columns if colspan used in first row of table (#924)
  * pass theme to Pygments when pygments-css=style (#919)
  * fallback to text lexer when using pygments for source highlighting (#987)
  * only make special section if style is specified (#917)
  * an unresolved footnote ref should not crash processor (#876)
  * rescue failure to resolve ::Dir.home (#896)
  * recognize Windows UNC path as absolute and preserve it (#806)
  * adjust file glob to account for backslash in Windows paths (#805)
  * don't match e-mail address inside URL (#866)
  * test include directive resolves file with space in name (#798)
  * return nil from Reader#push_include and Reader#pop_include methods (#745)
  * fixed broken passthroughs caused by source highlighting (#720)
  * copy custom stylesheet if linkcss is set (#300)
  * honor list continuations for indented, nested list items (#664)
  * fix syntax errors in converters (*@jljouannic*)
  * fix iconfont-remote setting
  * fix syntax error (target -> node.target) in Docbook 5 converter (*@jf647*)
  * output and style HTML for toc macro correctly

Infrastructure::

  * add Ruby 2.1 to list of supported platforms
  * re-enable rbx in Travis build
  * switch tests to minitest (*@ktdreyer*)
  * update RPM for Fedora Rawhide (*@ktdreyer*)
  * refactor unit tests so they work in RubyMine (*@cmoulliard*)
  * add preliminary benchmark files to repository (#1021)
  * clean out old fixtures from test suite (#960)
  * add initial Cucumber test infrastructure (#731)
  * use gem tasks from Bundler in Rakefile (#654)
  * build gemspec files using git ls-tree (#653)
  * use in-process web server for URI tests
  * update manpage to reflect updates in 1.5.0
  * rework README (#651) (*@mogztter*)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?milestone=8&state=closed[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v1.5.0[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v0.1.4\...v1.5.0[full diff]

== 0.1.4 (2013-09-05) - @mojavelinux

Performance::

  * 15% increase in speed compared to 0.1.3

Enhancements::

  * updated xref inline macro to support inter-document references (#417)
  * added extension API for document processing (#79)
  * added include directive processor extension (#100)
  * added id and role shorthand for formatted (quoted) text (#517)
  * added shorthand syntax for specifying block options (#481)
  * added support for checklists in unordered list (#200)
  * added support for inline style for unordered lists (#620)
  * added DocBook 5 backend (#411)
  * added docinfo option for footer (#486)
  * added Pygments as source highlighter option (pygments) (#538)
  * added icon inline macro (#529)
  * recognize implicit table header row (#387)
  * uri can be used in inline image (#470)
  * add float attribute to inline image (#616)
  * allow role to be specified on text enclosed in backticks (#419)
  * added XML comment-style callouts for use in XML listings (#582)
  * made callout bullets non-selectable in HTML output (#478)
  * pre-wrap literal blocks, added nowrap option to listing blocks (#303)
  * skip (retain) missing attribute references by default (#523)
  * added attribute-missing attribute to control how a missing attribute is handled (#495)
  * added attribute-undefined attribute to control how an undefined attribute is handled (#495)
  * permit !name syntax for undefining attribute (#498)
  * ignore front matter used by static site generators if skip-front-matter attribute is set (#502)
  * sanitize contents of HTML title element in html5 backend (#504)
  * support toc position for toc2 (#467)
  * cli accepts multiple files as input (#227) (*@lordofthejars*)
  * added Markdown-style horizontal rules and pass Markdown tests (#455)
  * added float clearing classes (.clearfix, .float-group) (#602)
  * don't disable syntax highlighting when explicit subs is used on listing block
  * asciidoctor package now available in Debian Sid and Ubuntu Saucy (#216) (*@avtobiff*)

Compliance::

  * embed CSS by default, copy stylesheet when linkcss is set unless copycss! is set (#428)
  * refactor reader to track include stack (#572)
  * made include directive resolve relative to current file (#572)
  * track include stack to enforce maximum depth (#581)
  * fixed greedy comment blocks and paragraphs (#546)
  * enable toc and numbered by default in DocBook backend (#540)
  * ignore comment lines when matching labeled list item (#524)
  * correctly parse footnotes that contain a URL (#506)
  * parse manpage metadata, output manpage-specific HTML, set docname and outfilesuffix (#488, #489)
  * recognize preprocessor directives on first line of AsciiDoc table cell (#453)
  * include directive can retrieve data from uri if allow-uri-read attribute is set (#445)
  * support escaping attribute list that precedes formatted (quoted) text (#421)
  * made improvements to list processing (#472, #469, #364)
  * support percentage for column widths (#465)
  * substitute attributes in docinfo files (#403)
  * numbering no longer increments on unnumbered sections (#393)
  * fixed false detection of list item with hyphen marker
  * skip include directives when processing comment blocks
  * added xmlns to root element in docbook45 backend, set noxmlns attribute to disable
  * added a Compliance module to control compliance-related behavior
  * added linkattrs feature to AsciiDoc.py compatibility file (#441)
  * added level-5 heading to AsciiDoc.py compatibility file (#388)
  * added new XML-based callouts to AsciiDoc.py compatibility file
  * added absolute and uri image target matching to AsciiDoc.py compatibility file
  * added float attribute on inline image macro to AsciiDoc.py compatibility file
  * removed linkcss in AsciiDoc.py compatibility file
  * fixed fenced code entry in AsciiDoc.py compatibility file

Bug Fixes::

  * lowercase attribute names passed to API (#508)
  * numbered can still be toggled even when enabled in API (#393)
  * allow JRuby Map as attributes (#396)
  * don't attempt to highlight callouts when using CodeRay and Pygments (#534)
  * correctly calculate line length in Ruby 1.8 (#167)
  * write to specified outfile even when input is stdin (#500)
  * only split quote attribution on first comma in Markdown blockquotes (#389)
  * don't attempt to print render times when doc is not rendered
  * don't recognize line with four backticks as a fenced code block (#611)

Improvements::

  * upgraded Font Awesome to 3.2.1 (#451)
  * improved the built-in CodeRay theme to match Asciidoctor styles
  * link to CodeRay stylesheet if linkcss is set (#381)
  * style the video block (title & margin) (#590)
  * added Groovy, Clojure, Python and YAML to floating language hint
  * only process callouts for blocks in which callouts are found
  * added content_model to AbstractBlock, rename buffer to lines
  * use Untitled as document title in rendered output if document has no title
  * rename include-depth attribute to max-include-depth, set 64 as default value (#591)
  * the tag attribute can be used on the include directive to identify a single tagged region
  * output multiple authors in HTML backend (#399)
  * allow multiple template directories to be specified, document in usage and manpage (#437)
  * added option to cli to specify template engine (#406)
  * added support for external video hosting services in video block macro (#587) (*@xcoulon*)
  * strip leading separator(s) on section id if idprefix is blank (#551)
  * customized styling of toc placed inside body content (#507)
  * consolidate toc attribute so toc with or without toc-position can make sidebar toc (#618)
  * properly style floating images (inline & block) (#460)
  * add float attribute to inline images (#616)
  * use ul list for TOC in HTML5 backend (#431)
  * support multiple terms per labeled list item in model (#532)
  * added role?, has_role?, option? and roles methods to AbstractNode (#423, 474)
  * added captioned_title method to AbstractBlock
  * honor showtitle attribute as alternate to notitle! (#457)
  * strip leading indent from literal paragraph blocks assigned the style normal
  * only process lines in AsciiDoc files
  * emit message that tilt gem is required to use custom backends if missing (#433)
  * use attributes for version and last updated messages in footer (#596)
  * added a basic template cache (#438)
  * include line info in several of the warnings (for lists and tables)
  * print warning/error messages using warn (#556)
  * lines are not preprocessed when peeking ahead for section underline
  * introduced Cursor object to track line info
  * fixed table valign classes, no underline on image link
  * removed dependency on pending library, lock Nokogiri version to 1.5.10
  * removed require rubygems line in asciidoctor.rb, add to cli if RUBY_VERSION < 1.9
  * added tests for custom backends
  * added test that shorthand doesn't clobber explicit options (#481)
  * removed unnecessary monospace class from literal and listing blocks

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]
  * https://packages.debian.org/sid/asciidoctor[Debian (asciidoctor)]
  * https://packages.ubuntu.com/search?keywords=asciidoctor[Ubuntu (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?milestone=7&state=closed[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v0.1.4[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v0.1.3\...v0.1.4[full diff]

== 0.1.3 (2013-05-30) - @mojavelinux

Performance::

  * 10% increase in speed compared to 0.1.2

Enhancements::

  * added support for inline rendering by setting doctype to inline (#328)
  * added support for using font-based icons (#115)
  * honor haml/slim/jade-style shorthand for id and role attributes (#313)
  * support Markdown-style headings as section titles (#373)
  * support Markdown-style quote blocks
  * added section level 5 (maps to h6 element in the html5 backend) (#334)
  * added btn inline macro (#259)
  * added menu inline menu to identify a menu selection (#173) (*@bleathem*)
  * added kbd inline macro to identify a key or key combination (#172) (*@bleathem*)
  * support alternative quote forms (#196)
  * added indent attribute to verbatim blocks (#365)
  * added prettify source-highlighter (#202)
  * link section titles (#122)
  * introduce shorthand syntax for table format (#350)
  * parse attributes in link when use-link-attrs attribute is set (#214)
  * support preamble toc-placement (#295)
  * exclude attribute div if quote has no attribution (#309)
  * support attributes passed to API as string or string array (#289)
  * allow safe mode to be set using string, symbol or int in API (#290)
  * make level 0 section titles more prominent in TOC (#369)

Compliance::

  * ~ 99.5% compliance with AsciiDoc.py
  * drop line if target of include directive is blank (#376)
  * resolve attribute references in target of include directive (#367)
  * added irc scheme to link detection (#314)
  * toc should honor numbered attribute (#341)
  * added toc2 layout to default stylesheet (#285)
  * consecutive terms in labeled list share same entry (#315)
  * support set:name:value attribute syntax (#228)
  * block title not allowed above document title (#175)
  * assign caption even if no title (#321)
  * horizontal dlist layout in docbook backend (#298)
  * set doctitle attribute (#337)
  * allow any backend to be specified in cli (#320) (*@lightguard*)
  * support for abstract and partintro (#297)

Bug Fixes::

  * fixed file path resolution on Windows (#330)
  * fixed bad variable name that was causing crash, add test for it (#335)
  * set proper encoding on input data (#308)
  * don't leak doctitle into nested document (#382)
  * handle author(s) defined using attributes (#301)

Improvements::

  * added tests for all special sections (#80)
  * added test for attributes defined as string or string array (#291) (*@lightguard*)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]
  * https://apps.fedoraproject.org/packages/rubygem-asciidoctor[Fedora (rubygem-asciidoctor)]

https://asciidoctor.org/news/2013/05/31/asciidoctor-0-1-3-released[release notes] |
https://github.com/asciidoctor/asciidoctor/issues?milestone=4&state=closed[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v0.1.3[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v0.1.2\...v0.1.3[full diff]

== 0.1.2 (2013-04-25) - @mojavelinux

Performance::

  * 28% increase in speed compared to 0.1.1, 32% increase compared to 0.1.0

Enhancements::

  * new website at https://asciidoctor.org
  * added a default stylesheet (#76)
  * added viewport meta tag for mobile browsers (#238)
  * set attributes based on safe mode (#244)
  * added admonition name as style class (#265)
  * removed hardcoded CSS, no one likes hardcoded CSS (#165)
  * support multiple authors in document header (#223)
  * include footnotes block in embedded document (#206)
  * allow comma delimiter in include attribute values (#226)
  * support including tagged lines (#226)
  * added line selection to include directive (#226)
  * Asciidoctor#render APIs return Document when document is written to file

Compliance::

  * added compatibility file to make AsciiDoc.py behave like Asciidoctor (#257)
  * restore alpha-based xml entities (#211)
  * implement video and audio block macros (#155)
  * implement toc block macro (#269)
  * correctly handle multi-part books (#222)
  * complete masquerade functionality for blocks & paragraphs (#187)
  * support explicit subs on blocks (#220)
  * use code element instead of tt (#260)
  * honor toc2 attribute (#221)
  * implement leveloffset feature (#212)
  * include docinfo files in header when safe mode < SERVER (#116)
  * support email links and mailto inline macros (#213)
  * question must be wrapped in simpara (#231)
  * allow round bracket in link (#218)

Bug Fixes::

  * trailing comma shouldn't be included in link (#280)
  * warn if file in include directive doesn't exist (#262)
  * negative case for inline ifndef should only affect current line (#241)
  * don't compact nested documents (#217)
  * nest revision info inside revision element (#236)

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]

https://asciidoctor.org/news/2013/04/25/asciidoctor-0-1-2-released[release notes] |
https://github.com/asciidoctor/asciidoctor/issues?milestone=3&state=closed[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v0.1.2[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v0.1.1\...v0.1.2[full diff]

== 0.1.1 (2013-02-26) - @erebor

Performance::

  * 15% increase in speed compared to 0.1.0

Enhancements::

  * migrated repository to asciidoctor organization on GitHub (#77)
  * include document title when header/footer disabled and notitle attribute is unset (#103)
  * honor GitHub-flavored Markdown fenced code blocks (#118)
  * added :doctype and :backend keys to options hash in API (#163)
  * added :to_dir option to the Asciidoctor#render API
  * added option :header_only to stop parsing after reading the header
  * preliminary line number tracking
  * auto-select backend sub-folder containing custom templates
  * rubygem-asciidoctor package now available in Fedora (#92)

Compliance::

  * refactor reader, process attribute entries and conditional blocks while parsing (#143)
  * support limited value comparison functionality of ifeval (#83)
  * added support for multiple attributes in ifdef and ifndef directives
  * don't attempt to embed image with uri reference when data-uri is set (#157)
  * accommodate trailing dot in author name (#156)
  * don't hardcode language attribute in html backend (#185)
  * removed language from DocBook root node (#188)
  * fixed revinfo line swallowing attribute entry
  * auto-generate caption for listing blocks if listing-caption attribute is set
  * support nested includes
  * support literal and listing paragraphs
  * support em dash shorthand at the end of a line
  * added ftp support to link inline macro
  * added support for the page break block macro

Bug Fixes::

  * pass through image with uri reference when data-uri is set (#157)
  * print message for failed arg (#152)
  * normalize whitespace at the end of lines (improved)
  * properly load custom templates and required libraries

Improvements::

  * parse document header in distinct parsing step
  * moved hardcoded english captions to attributes

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?milestone=1&state=closed[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v0.1.1[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v0.1.0\...v0.1.1[full diff]

== 0.1.0 (2013-02-04) - @erebor

Enhancements::

  * introduced Asciidoctor API (Asciidoctor#load and Asciidoctor#render methods) (#34)
  * added SERVER safe mode level (minimum recommended security for serverside usage) (#93)
  * added the asciidoctor commandline interface (cli)
  * added asciidoctor-safe command, enables safe mode by default
  * added man page for the asciidoctor command
  * use blockquote tag for quote block content (#124)
  * added hardbreaks option to preserve line breaks in paragraph text (#119)
  * :header_footer option defaults to false when using the API, unless rendering to file
  * added idseparator attribute to customized separator used in generated section ids
  * do not number special sections (differs from AsciiDoc.py)

Compliance::

  * use callout icons if icons are enabled, unless safe mode is SECURE
  * added support for name=value@ attribute syntax passed via cli (#97)
  * attr refs no longer case sensitive (#109)
  * fixed several cases of incorrect list handling
  * don't allow links to consume newlines or surrounding angled brackets
  * recognize single quote in author name
  * support horizontal labeled list style
  * added support for the d cell style
  * added support for bibliography anchors
  * added support for special sections (e.g., appendix)
  * added support for index term inline macros
  * added support for footnote and footnoteref inline macros
  * added auto-generated numbered captions for figures, tables and examples
  * added counter inline macros
  * added support for floating (discrete) section titles

Bug Fixes::

  * fixed UTF-8 encoding issue by adding magic encoding line to ERB templates (#144)
  * resolved Windows compatibility issues
  * clean CRLF from end of lines (#125)
  * enabled warnings when running tests, fixed warnings (#69)

Improvements::

  * renamed iconstype attribute to icontype

Distribution Packages::

  * https://rubygems.org/gems/asciidoctor[RubyGem (asciidoctor)]

https://github.com/asciidoctor/asciidoctor/issues?milestone=12&state=closed[issues resolved] |
https://github.com/asciidoctor/asciidoctor/releases/tag/v0.1.0[git tag] |
https://github.com/asciidoctor/asciidoctor/compare/v0.0.9\...v0.1.0[full diff]

== Older releases (pre-0.0.1)

For information about older releases, refer to the https://github.com/asciidoctor/asciidoctor/tags[commit history] on GitHub.

