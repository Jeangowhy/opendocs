# 中州韻輸入法引擎 | Rime Input Method Engine

### 擊出中文之韻 | Just rime with it

中州韻輸入法引擎，思想用鍵盤表達也行。

Rime Input Method Engine - riming with your keystrokes.

### 也來瞧瞧

何以聰明的輸入法 [[懂我心意|MoodCollection]]

### 也來試試

最新一代 Rime 輸入法搶鲜 [下載](http://rime.github.io/download)，立即擊響中文之韻！

[Download](http://rime.github.io/download) the latest release, and happy riming with your keystrokes now!

### 也來設計

Rime 輸入方案貴在原創，把輸入法變成理想的模樣！

[[Rime with input schemata|RimeWithSchemata]], and innovate!

### 也來寫代碼

合力打造功能更完備、擴展更容易的開源輸入法框架！

[[Rime with the code|RimeWithTheCode]], and contribute!

### 純粹地喜歡？

不要錯過[[《說明書》|UserGuide]]、[[《定製指南》|CustomizationGuide]]等介紹使用技巧的文檔；

歡迎常來 [Rime 主站](http://rime.github.io/discuss) 參與討論；

您可以通過 [捐贈](http://rime.github.io/donate)，支持開發者爲 Rime 投入更大的努力。


# 認識 La Rime

## 自序

做這項目是發自對輸入法創新的興趣，爲實驗新的輸入法而打造一款易於定製的智能輸入軟件。
實現好用的方言拼音輸入，也是開發這款軟件主要的目標。

乃定名爲：*中州韻輸入法引擎 / Rime Input Method Engine*

取意歷史上通行的中州韻，願寫就一部彙集音韻學智慧的輸入法經典之作。

項目網站設在 http://rime.github.io/

感謝 Github. 感謝 Pages.

創造應用價值是一方面，更要堅持對好技術的追求，希望能寫出靈動而易於擴展的代碼，使其成爲一款個性十足的開源輸入法。

### 歷史

2009年底，佛振按這一思路，借助強大的IBus輸入法框架和Python腳本語言，快速開發出「中州韻」的原型。
2010年，將這一算法引擎由Linux移植到Windows平臺。
幾大方言社區的輸入法愛好者創作了粵語、吳語、中古音輸入方案，竟做到了用曾經夢想的方式打字。

如今有許多朋友關注並樂於幫忙完善這一軟件。俺打盤接受同學們的建議用C++來寫一部正式版。

### 概念

相對於最初的實驗品，概念沒有多大變化。佛振重新來歸納。

組成這個軟件系統的對象，我給他粗略分成三類：
邏輯對象、數據對象、交互對象。

邏輯對象，各自表達解決輸入法中某類問題的算法，以及描述輸入法的工作流程。

咱假定，從不同種類的輸入法中，可歸納出幾種類型的實現機制，即通用於一類輸入法的算法和數據結構。

*輸入法引擎／engine* 佛振把他解讀爲用來實現輸入功能的程序，是這些算法及相關數據結構的總和。

輸入法典型的工作流程，大致如此：
 * 獲取並解釋按鍵動作，每個按鍵包含鍵值、按鍵的狀態等信息
 * 生成、分析按鍵序列，形成編碼串；某些按鍵並非直接產生編碼字符，而有時組成輸入串的文字不是按鍵所對應的字符本身
 * 查字典，取得輸入碼對應的同碼字詞列表；合併、排序……
 * 有時，根據策略需要進一步組詞造句
 * 可能會對結果做出場前的修飾處理，如繁簡轉換等
 * 至此，完成了從輸入碼到文字的翻譯，結果是一組將在輸入法介面展現的候選文字
 * 用戶確認，文字上屏，完成了一次輸入

將這一流程中純粹的邏輯部份用程序寫出來，就是我所形容的輸入引擎。

其中不包括：
 * 實現編碼到文字轉換的字典數據，許多方家稱「碼表」
 * 經過操作系統與設備和輸入目的程序交互的組件
 * 展現輸入法信息的介面
 * 配置工具

輸入法中的數據對象，有輸入引擎處理用戶輸入動作所得的動態數據，又有預先配置到輸入法中的輸入方案。

若要講，輸入引擎是跨輸入法的通用程序，*輸入方案／schema* 即是那差異的部份。
輸入法引擎配置了不同的輸入方案，便是用戶視角下、統一框架內的不同輸入法。
輸入方案按一定的規格撰寫，用戶可於需要時導入到軟件，這便是本項目軟件開發者與輸入方案創作者分工、協作的方式。

輸入方案包含：
 * 配置信息，控制着輸入引擎的行爲
 * 字典（碼表），定義了編碼與候選文字的對應關係

爲了足夠靈活而能支持廣泛的輸入法類型，在輸入方案中，利用 *拼寫運算／spelling algebra* 機制在輸入碼與字典編碼之間建立一組映射，以此將個別方案中的特殊檢索方式統一到通用的算法。

交互對象，承擔與用戶交換信息的功能。不同於輸入引擎、輸入方案的跨平臺特點，交互對象的實現是系統相關的。
具體地有，輸入法框架通過操作系統與輸入設備、輸入目標程序通信；輸入法介面顯示輸入法的狀態和輸入內容。

### 項目構成

於是整個工程又可分爲若干子項目：

 * librime－輸入法引擎

 * ibus-rime－Linux發行版

 * weasel／小狼毫－Windows發行版

 * squirrel／鼠鬚管－Mac發行版

 * plum／東風破－配置管理器及輸入方案倉庫

 * essay／八股文－預設詞典及語言模型

### 開發計劃

偉大雄圖，還是分期來完成吧。

初創期，完成軟件架構和基礎功能。

第一期，要把用戶體驗做到一款正式產品的標準。
 * 易用性：操作方式簡明，有文檔，有配置工具
 * 性能和穩定性：適應主流配置＋日常應用場景
 * 輸入效果：優於傳統的碼表輸入法平臺，達到開源輸入法的平均水平

第二期，兼容更多系統平臺。可以嘗試一些創新的設計，形成開發者暨輸入方案創作者社羣。

第三期，添加網絡功能，持續優化輸入效果；建立輸入法創作平臺。

計劃於 *八月初八* 發表1.0版。即完成初創期，進入第一期的初級階段。

萬事開頭難，雖然實驗版的經驗可做參考，讓這項目高速運轉起來，仍需要大的智慧。

有同學索要文檔，卻真的沒有。千頭萬緒，未及梳理，暫且概說一番，也可意會創作此軟件的思路。

是爲之序。

> La Rime 架構設計解讀

# 概念解讀

## 框架

輸入法工作於需要輸入文本的程序中，後者就叫他做輸入法的「客戶程序」吧。

如果輸入法同時在不同的程序中工作，每個客戶程序裏的輸入內容都是不同的。
所以需要爲每個客戶維護輸入法狀態，術語稱輸入法「上下文／Context」。

邏輯複雜的輸入法，常常有個獨立的程序來做運算，便於集中管理詞庫等資源。
Rime稱其爲「服務／Service」，形式爲一個無介面表現的後臺程序／Backend。

於是輸入法的「前端／Frontend」，即輸入法在客戶程序中的那部份，可依託於後臺的服務來運作，自身只需關注與操作系統交互，以及將消息向服務轉發。

Rime的Frontend/Backend模型，依照ibus、IMK等輸入法框架來設計：Frontend不含輸入邏輯，甚至不負責繪製輸入法介面。因此會比較容易適配現有的輸入法框架，不需要自己寫很多代碼。

在服務中，會爲每一個客戶建立一個輸入法「會話／Session」。從功能上講，會話是將一系列按鍵消息變（Convert）爲文字的問（Request）答（Response）過程。

技術上講，會話會負責搞定輸入法前端與服務之間的跨進程通信，同時在服務端爲前端所代表的客戶分配必要的資源。這資源主要是指一部有狀態的、懂得所有輸入轉換邏輯的輸入法引擎「Engine」。

現在所寫的Rime庫，不做那框架部份，專注於輸入引擎的實現。
名字也叫「中州韻輸入法引擎／RIME」嘛。

這部份定義的代碼是 [rime/librime](https://github.com/rime/librime)，under C++ namespace `rime`。
拋開實際的輸入法框架，俺先寫個控制臺程序 `RimeConsole` 來模擬輸入，觀察Engine的輸出，以驗證其功能是否符合設計。

## 引擎

輸入法的轉換邏輯自然是比較複雜，需要許多元件協同工作。要協同工作，比得組裝到一起，外面再加個殼。通常的機器都是如此，有外殼做封裝，看不到內部的元件，通過有限的幾處機關來操作，用起來比較省心。

Engine 對象，便是 Session 需要直接操作的介面。
除此之外，Rime庫還對外提供若干用於輸入輸出的數據對象。
包括他所持有的代表輸入法狀態的「上下文／Context」對象、
描述一份「輸入方案／Schema」的配置對象、
代表輸入按鍵的 `KeyEvent` 對象等。

開發者對 Engine 的期望，一是將來可不斷通過添加內部組件的方式增益其所不能，二是有能力動態地調整組件的調度，以在會話中切換到不同的輸入方式。

爲了避免知道得太多，這引擎的內部構造必須精巧，他存在的意義在於接合內部的各種組件、並對外提供可靠的接口：Engine所表達的邏輯僅限於此。

標準化Engine內部的「組件／Component」，明確與關鍵組件之間的對接方式，就可以滿足可擴展、可配置這兩點期望。

# 設計與實現

## 組件

爲有好的擴展能力，定義一個接口來表示具有某種能力的一類組件；
爲了達到可在運行時動態配置的目的，採取抽象工廠的設計模式。

`boost::factory`要求較高版本的Boost庫，所以我還是用了自家釀造的一套設施來做組件的包裝。

原則是，Rime中完成特定功能的對象，若只有一種實現方法，就寫個C++類／class；若有多種實現方法，就寫個「Rime類」／`rime::Class`。示意：
```
class Processor : public Class<Processor, Engine*> {
 public:
  Processor(Engine *engine) : engine_(engine) {}
  virtual ~Processor() {}
  // Processor的功能是處理按鍵消息
  virtual bool ProcessKeyEvent(const KeyEvent &ke);
 private:
  Engine *engine_;
};
```

然後，大家就可以寫各式Processor的實現啦……
當然，還要把每一種實現註冊爲具名的「組件」。
```
class ToUpperCase : public Processor {
 public:
  ToUpperCase(Engine *engine);
  virtual bool ProcessKeyEvent(const KeyEvent &ke) {
    char ch = ke.ToAscii();
    if (islower(ch)) {
      engine_->CommitChar(ch - 'a' + 'A');
      return true;
    }
    return false;
  }
};

void RegisterRimeComponents() {
  Registry.instance().Register("upper", new Component<ToUpperCase>);
  // 註冊各種組件到Registry...
}
```

用法：
```
void UsingAProcessor() {
  // Class<>模板提供了簡便的方法，按名稱取得組件
  // Class<T>::Require() 從Registry中取得T::Component的指針
  // 而Component<T>繼承自T::Component，並實現了其中的純虛函數Create()
  Processor::Component* component = Processor::Require("upper");
  // 利用組件生成所需的對象
  KeyEvent key;   // 輸入
  Engine engine;  // 上屏文字由此輸出
  Processor* processor = component->Create(&engine);
  bool taken = processor->ProcessKeyEvent(key);
  delete processor;
}
```
實際的代碼中，會將這個例子改造成Engine持有Processor對象，並轉發輸入按鍵給Processor。

## 框架級組件和基礎組件

以Engine的視角，可以把各種組件分爲框架級組件和基礎組件。前者會由Engine創建並直接調用，故需要爲每一類組件定義明確的接口。後者作爲實現具體功能的積木，由框架級組件的實現類使用。

### 框架級組件

目前設計中規劃了三類框架級組件：

  * Processor，處理按鍵，編輯輸入串
  * Segmentor，解釋輸入串「是什麼」，將輸入串分段，標記輸入內容的可能類型
  * Translator，翻譯一段輸入，給出一組備選結果

對於每一類組件，Engine將根據Schema中的配置，創建若干實例，並按一定規則調度，從而將複雜的輸入法邏輯分解到組件的各種實現裏，按輸入方案的需求組合。

當Engine接到前端傳來的按鍵消息，會順次調用一組Processor的ProcessKeyEvent()方法。
在這方法裏，每個Processor可決定是接受並處理該按鍵，放棄該按鍵還給系統做默認處理，還是留給其他的Processor來決定。

Processor的處理結果表現爲對Context的修改。當某個Processor修改了Context的編碼串時，Engine獲得信號通知，開始切分和翻譯的流程。

首先按次序由各Segmentor嘗試對編碼串分段。通過N個回合，將編碼串分爲N個編碼段。每一回合中，各Segmentor給出從編碼串指定位置開始可識別的最長編碼序列，及對應的編碼類型標籤。回合中最長的分段將被採納，將該編碼段的始末位置及一組編碼類型標籤記入Context中的分段信息。優先級較高的Segmentor也可以中止當前回合從而跳過優先級較低的Segmentor。

接下來，對每一個編碼段，調用各Translator做翻譯。Translator可憑藉編碼類型標籤來判斷本Translator能否完成該編碼段的翻譯。

每個Translator針對一個編碼段的翻譯結果爲Translation對象，是用來取得一組候選結果的迭代器。同一編碼段由不同Translator給出的Translations，存入Menu對象。爲了在有大量候選結果的情況下保持效率，Menu僅在需要時，譬如向後翻頁時，才會從Translation中取得一定數目的候選結果。
Translation有和其他Translation比較的方法，用於根據下一個候選結果的內容、或某種預定的策略來決定候選結果的排序。

Context中的Composition，匯總了分段信息、使用者在各代碼段對應的Menu中所選結果等信息。經過使用者手動確認結果、且未發生編輯動作的編碼段，將不再做重新分段的處理。

### 基礎組件

TODO(lotem): 補完文檔

基礎組件：

  * Dictionary, 詞典，由編碼序列檢索候選結果
  * UserDictionary, 動態的用戶詞典
  * Prism, 音節拼寫至詞典編碼的映射
  * Algebra, 拼寫運算規則
  * Syllablifier, 音節切分算法

# 說明書

目錄

- [說明書](#說明書)
  - [專題](#專題)
  - [第三方文檔](#第三方文檔)
  - [使用方案選單](#使用方案選單)
  - [輸入法設定](#輸入法設定)
  - [打字入門](#打字入門)
    - [選字與換頁](#選字與換頁)
    - [令輸入碼直接上屏](#令輸入碼直接上屏)
    - [使用編輯鍵](#使用編輯鍵)
    - [刪除誤上屏的錯詞](#刪除誤上屏的錯詞)
    - [Emacs 風格的編輯鍵](#emacs-風格的編輯鍵)
    - [輸入標點符號](#輸入標點符號)
    - [中西文切換](#中西文切換)
    - [繁簡字切換](#繁簡字切換)
  - [部分輸入方案的用法](#部分輸入方案的用法)
    - [朙月拼音](#朙月拼音)
    - [語句流](#語句流)
    - [雙拼](#雙拼)
    - [宮保拼音](#宮保拼音)
    - [地球拼音](#地球拼音)
    - [注音](#注音)
    - [倉頡](#倉頡)
    - [速成](#速成)
    - [五筆](#五筆)
    - [粵拼](#粵拼)
    - [吳語](#吳語)
  - [用戶詞典管理](#用戶詞典管理)
    - [命令行工具](#命令行工具)
    - [備份及合併詞典快照](#備份及合併詞典快照)
    - [導出及導入文本碼表](#導出及導入文本碼表)
    - [導入其他來源的碼表](#導入其他來源的碼表)
    - [同步用戶資料](#同步用戶資料)
      - [設定同步位置](#設定同步位置)


## 專題

  * [[認識 La Rime|Introduction]]
  * [[下載與安裝|Downloads]]
  * [[定製指南|CustomizationGuide]]（初階）
  * [[輸入方案設計書|RimeWithSchemata]]（中階）
  * [[程序開發|RimeWithTheCode]]（高階）

## 第三方文檔

  * [鼠鬚管試玩心得](http://bbs.weiphone.com/read-htm-tid-5108521.html)／lionhoho
  * [致第一次安裝 RIME 的你](https://github.com/halfmoonvic/Rime)／半月湾C
  * [「鼠须管」配置方案分享](https://www.v2ex.com/t/303479)、[
「鼠须管」的调教笔记](https://scomper.me/gtd/-shu-xu-guan-de-diao-jiao-bi-ji)／scomper
  * [鼠须管输入法 傻瓜版配置 - 基于 rime_pro 增强包](https://segmentfault.com/a/1190000005754706)／changsj

## 使用方案選單

下載、安裝完成後，試試：

切換到 Rime 輸入法，按 `F4` 鍵或組合鍵 `` Ctrl+` `` 喚出輸入方案選單（`` ` `` 鍵常見於 `1` 的左方）。這裏有 Rime 輸入法最常用的選項。

您可立即從方案選單切換到已經啓用的輸入方案。

另見：從 [Rime 輸入方案倉庫](https://github.com/rime/plum) 獲取輸入方案

如果需要啓用其他已安裝的方案，或自定義方案，請——

## 輸入法設定

——參閱[[《定製指南》|CustomizationGuide]]，從中瞭解如何自定義方案選單、每頁候選個數等全局選項；修改界面外觀；以及調整輸入方案的工作方式如指定選字、換頁的按鍵、標點符號映射等。

目前僅【小狼毫】配有一組簡單的設定面板，包含輸入方案選單設定、界面風格設定、用戶詞典管理。其他發行版可通過修改配置文件後重新部署的方式來定製。

## 打字入門

以下操作多數是可定製的，此說明書以默認配置爲準。

### 選字與換頁

使用 ↑↓鍵 定位高亮的候選字，以空格鍵確認。

在【語句流】風格的輸入方案裏，以空格鍵確認後，字詞並不立即上屏，而是在輸入了句末的標點（，。？！等）或按下回車鍵（`Return`）時整個句子上屏。

通常，按數字鍵可選擇序號爲該數字的候選；但某些輸入方案會以其他按鍵代替數字鍵，如【注音】以大寫字母選字。

除了可用標準的 `Page Up`、`Page Down` 換頁之外，大多數輸入方案裏還設置了以下幾組等效的換頁鍵：
  * `Shift+Tab`、`Tab`
  * 符號鍵 `- =`
  * 符號鍵 `, .`

### 令輸入碼直接上屏

輸入編碼後，如果不需要候選字而是希望輸入碼對應的鍵盤字符直接上屏，可使用回車鍵（`Return`）。

注意：【語句流】輸入方案不適用。在【語句流】模式下，先按左Shift鍵切換爲西文編碼，再按回車鍵確認。

若要輸出經過變換的輸入碼，如帶聲調的地球拼音、注音符號、倉頡字母等，請在輸入編碼後按 `Shift`+回車鍵 或 `Control`+回車鍵。

### 使用編輯鍵

使用 ←→鍵 定位光標插入點「‸」（或顯示爲「›」），編輯輸入碼。
也可用來縮短後選詞所對應輸入碼的範圍、確認詞句的一部分。

`Home`、`End` 鍵 快速跳至句首、句末。

`BackSpace`、`Delete` 鍵 分別刪除光標前、後的編碼字符。注意在蘋果鍵盤上前者標註爲 `Delete`，後者通常是組合鍵 `Fn+Delete`。

`Escape` 鍵 清空未完成的輸入。

### 刪除誤上屏的錯詞

不慎上屏了錯誤的詞組，再打同樣的編碼時，那錯詞出現在候選欄，令有潔癖的同學十分不爽。這時候可以：

先把選字光標（用上、下鍵）移到要刪除的用戶詞組上，再按下 `Shift+Delete` 或 `Control+Delete`（蘋果鍵盤用 `Shift+Fn+Delete`）。

只能夠從用戶詞典中刪除詞組。用於碼表中原有的詞組時，只會取消其調頻效果。

### Emacs 風格的編輯鍵

註：Windows 版本 Alt 組合鍵不可用。

  * ↑：`Control+p`
  * ↓：`Control+n`
  * ←：`Control+b`
  * →：`Control+f`
  * 上頁：`Alt+v`
  * 下頁：`Control+v`
  * 句首：`Control+a`
  * 句末：`Control+e`
  * 回退：`Control+h`
  * 刪除：`Control+d`
  * 清空：`Control+g`
  * 刪詞：`Control+k`

### 輸入標點符號

按鍵到標點符號的映射有三種形式：
  * 按鍵對應惟一的符號，按鍵後直接輸出該符號，如「，」
  * 按鍵對應一組配對的符號，符號交替出現，如「“”」
  * 按鍵對應多種符號，按鍵後展現選單。此時可按空格鍵或回車鍵確認高亮的符號，反復按該鍵則選中下一種符號。

每一款輸入方案，都可以定義兩套符號表，用「方案選單」裏的「半角↔全角」選項往復切換。

科技文體慣用西文標點，可進入「方案選單」、選擇「，。→，．」切換至西文標點。
西文標點也支持半角、全角兩種形式。但不支持自定義，所有標點直接輸出。

### 中西文切換

打開「方案選單」，使用選項「中文↔西文」可在兩種轉換狀態間往復切換。

此外，默認可用左右 `Shift` 鍵快速切換。

在輸入了部分編碼的情況下，左 `Shift` 將這些編碼臨時轉還爲西文。編輯臨時轉換的西文並以回車鍵上屏後，自動回復中文狀態。

在輸入了部分編碼的情況下，右 `Shift` 將上屏當前的候選字，並進入西文模式。

以上可總結爲：左 `Shift` 切換輸入法光標左面的編碼內容，右 `Shift` 切換光標右面即將輸入的內容。

注意：Mac 系統上的鼠鬚管不能區分左、右 `Shift` ，因此左、右 `Shift` 鍵的作用一樣。

### 繁簡字切換

Rime 輸入法詞庫多以傳統漢字編排。

因爲有 OpenCC 提供準確而高效的繁→簡轉換功能，大多數輸入方案都可以從「方案選單」裏選擇「漢字↔汉字」的選項來啓用或停用繁簡轉換。

碼表爲簡化字的方案如【五筆】、【袖珍簡化字拼音】等，不提供這個選項。

## 部分輸入方案的用法

### 朙月拼音

與時下流行的拼音輸入法相近。默認安裝後將使用此方案。
其詞典包含 Rime 內置的【八股文】繁體詞庫。設有繁簡轉換的開關。

敲 \` 鍵開始用 `hspnz` 輸入五筆畫（橫豎撇捺折），反查五筆編碼。需要安裝【五筆畫】以啓用反查。

以下有若干輸入方案衍生自朙月拼音，如【語句流】、各式雙拼、【宮保拼音】。還有不少方案使用朙月拼音作反查碼。

[[《定製指南》|CustomizationGuide]]提供了[[模糊音|CustomizationGuide#模糊音]]定製方法及代碼模板。

### 語句流

揉合了語句輸入的按鍵習慣，以及詞組輸入逐詞確認的操作節奏。

句中空格鍵的運用，既起到明確詞邊界、彌補長句轉換精度不足的作用，又很好地模仿了西文以空格斷詞的慣用法。

配合 Mac、IBus 版本內嵌預編輯文字的特性，體驗更佳。

### 雙拼

基於【朙月拼音】製作了幾種流行的雙拼方案：自然碼、MSPY、智能ABC、小鶴雙拼、拼音加加等。

雙拼與【朙月拼音】、語句流輸入方案共用一份碼表和用戶詞典。

實現雙拼的關鍵，是用 Rime 的[[「拼寫運算」|SpellingAlgebra]]技術建立雙拼輸入碼到全拼的映射表，從而對接朙月拼音詞典。在[[《輸入方案設計書》|RimeWithSchemata]]中有一個完整的代碼示例。

### 宮保拼音

仍是基於【朙月拼音】，採用源自西方速錄技術的多鍵並擊方式，雙手共七指操作鍵盤，一擊輸入一個拼音音節。

宮保拼音 / Combo Pinyin 自從2007年創製以來，經歷十數次修訂，孜孜以求一套直觀易用，並且兼顧PC鍵盤上操作舒適度的鍵位佈局。

[[宮保拼音專題介紹|ComboPinyin]]

### 地球拼音

支持標註聲調的拼音輸入法。

以形似的符號  `- / < \` 附加在拼音音節的末尾，分別表示陰平、陽平、上聲、去聲。輕聲不標。

爲按鍵方便故，也可使用 `; / , >` 來標註。

聲調、韻母在輸入常用短語時可以省略，而成爲簡拼。因此本方案既兼容了無聲調拼音輸入法的打字習慣，又可在輸入生僻字詞時通過輸入聲調篩選出同音同調者。

因爲對應相同的音系，【地球拼音】與【注音】共享詞典，卻不與【朙月拼音】相通。

### 注音

注音符號輸入法。使用最廣泛的「大千式」鍵盤排佈。

但其操作層面不同於傳統的注音輸入法，而是採取「無模式」的設計，與 Rime 裏的其他輸入方案達成統一。
所謂「無模式」，是指輸入注音碼，會即時顯示出候選字，而不似傳統的注音輸入法需要另行呼出選字窗口。

Rime【注音】輸入方案，允許省略聲調（包含作爲第一聲的空格鍵）以及某些音節（非零聲母且聲母不能自成音節者）的韻母部分。
當省略聲調時，可連續輸入後一個音節，或間以隔音符號「 ' 」表明前一音節結束。

此外，【注音】採用了語句流的按鍵習慣，以回車鍵確認上屏；在輸入了聲調的音節後，以空格鍵選定高亮的字詞。

爲了在輸入注音碼的同時展現候選字，候選的序號改爲大寫字母ABCDE等，以避開定義爲注音符號的數字鍵。
要選用當頁第二個候選字，可按↓鍵、再按空格鍵選定第二字，又可按下 `Shift+B` 鍵直接選取。

一些標點符號由於所在按鍵用作輸入注音符號的原因而有所調整：
  * 逗號， `Shift+,`
  * 句號。 `Shift+.`
  * 分號； `Shift+;`
  * ／號  `Shift+/`
  * 減號  `Shift+-`
規則很簡單：符號鍵被注音字母佔用時，加打上檔鍵 Shift 從符號列表中選取。

### 倉頡

第五代倉頡輸入法。

默認，通過倉頡碼檢出的候選字限制在「通用字符集」，排除了 Unicode CJKV 擴展區漢字。

需要輸入大量古字、生僻字的專業用戶，請在「方案選單」中切換一次形如「通用 → 增廣」的字符集過濾開關，即可輸入七萬餘簡繁漢字。

註：您的系統可能需要安裝專門的字體方可正確顯示漢字全集。參考[[《定製指南》|CustomizationGuide]]爲 Rime 輸入法設定用於顯示候選文字的字體。

以拼音輸入單字、常用詞組，可反查倉頡碼。需要安裝【朙月拼音】以啓用反查。倉頡碼與拼音重碼時，倉頡碼查到的候選字優先。
亦可按引導鍵 ` 進入拼音反查。

看到候選字一旁有「陰陽魚 ☯」記號？

`:-D` 這表示，該候選詞組並不存在於碼表中，而是通過「混元編碼器」產生、或由已知字碼自動組合而成的結果。您需要確認一下這是否恰是你想要的詞。
Rime 的後續版本將不斷改進算法，在輸入碼未命中碼表時，推測出更有意義的文字，越來越「懂我心意」。

### 速成

取倉頡首尾二碼，簡單快速地連續輸入詞、句，且支持倉頡全碼、速成碼混合輸入。編碼雖是基於字形，智能組詞、調頻等特性與拼音輸入法別無二致。

### 五筆

五筆字型86版。簡化字優先，兼收繁體字。包含小規模的詞庫。

敲 z 鍵開始轉爲簡體拼音字詞輸入，反查五筆編碼。需要安裝【袖珍簡化字拼音】以啓用反查。

另有【五筆·拼音】混合輸入的方案。在這款方案裏，可直接以五筆或拼音碼輸入字、詞而無須轉換。輸入拼音碼時，若候選字、詞編入了五筆碼表，則在候選字一旁提示其五筆碼。

### 粵拼

以[「香港語言學學會粵語拼音方案（粵拼）」](http://www.lshk.org/)輸入廣府話。

敲引導鍵 ` 之後，開始輸入漢語拼音（普通話）反查粵拼。需要安裝【朙月拼音】以啓用反查。

輸入不完整的粵拼編碼、或當拼寫錯誤被自動糾正時，候選字、詞加註完整的粵拼編碼提示。
（注意：由於碼表並未全部經過人工校對，程序自動注音的結果可能使提示中多音字的標註出現錯誤！請不要把輸入法的提示當作標準學習而受誤導！）

### 吳語

以[「吳語拉丁式注音法」](http://input.foruto.com/wu/method.html)輸入上海話、蘇州話。

敲引導鍵 ` 之後，開始輸入漢語拼音（普通話）反查吳語拼寫。需要安裝【朙月拼音】以啓用反查。

《定製指南》提供了模糊音定製方法及模板。

## 用戶詞典管理

從【小狼毫】開始菜單或托盤圖標的右鍵菜單中打開「用戶詞典管理」介面。

左側列表爲已使用的用戶詞典，以詞典名表示，如 `luna_pinyin` 。
注意詞典與輸入方案可能是一對多的關係。

### 命令行工具

【中州韻】和【鼠鬚管】暫無圖形工具，可取得 librime 編譯產出的工具程序 `bin/rime_dict_manager` 通過命令行方式實現以下功能。

執行 `rime_dict_manager` 之前需要關閉正在使用的輸入法，釋放以獨佔方式打開的詞典文件。

請，將工作目錄設爲「Rime 用戶資料夾」。在此執行 `rime_dict_manager` 查看所支持的參數及命令格式；加上參數 `--list` 查看用戶詞典列表。

### 備份及合併詞典快照

Rime 輸入法在使用中會在一定時間自動將用戶詞典備份爲快照文件 `*.userdb.txt` 。
也可使用管理工具，備份指定的用戶詞典到快照文件。

備份到快照中的打字習慣，可回復到新建立的或其他系統上的用戶詞典。

執行合併詞典快照操作，只須選定要合併的 `.userdb.txt` 文件，因爲快照中已記錄了所屬詞典的名稱。

你不必擔心來自快照的詞條已存在於用戶詞典的情況；詞頻更新爲二者的較大值，其他參數亦會按照合理的算法疊加。

### 導出及導入文本碼表

將用戶詞典導出爲文本碼表，便於直接閱讀，或批量添加詞條到 `*.dict.yaml` 。

導出的文本格式與 Rime 靜態碼表的格式相同：以製表符（Tab）分隔的三列，分別是文字、編碼、使用頻次。其中，編碼是碼表中定義的完全形式，多個音節間以空格。

如此導出的文本碼表，可反向導入到指定的用戶詞典。但是，文本碼表所含信息不如快照全面，因此爲了不損失輸入效果，請儘量使用 *合入快照* 的方式轉移用戶資料。

由於文本碼表用戶可以編輯，導入時無法檢查碼表內容是否與選定的詞典相匹配，請 **當心** 莫要導入到錯誤的詞典中去了。

### 導入其他來源的碼表

推薦的作法是，將碼表導入到固態詞典，而非用戶詞典。

請參考以下兩個示例：

https://gist.github.com/lotem/5443073

https://github.com/rime-aca/dictionaries

特別地，如果要用新碼表的內容完全取代原有的 `luna_pinyin` 詞典，則無須以上步驟：
將編寫好的新詞典命名爲 `luna_pinyin.dict.yaml` 放置於 Rime 的「用戶文件夾」，重新部署即可。

---

如果你認定要將碼表導入已存在的用戶詞典，則要注意：
  * 碼表文件的格式是否 Rime 所要求的 UTF-8 (no BOM) 編碼
  * 文本行是否爲製表符分隔，至少有文字、編碼兩列，及一列可選的頻次
  * 文字的字形（繁、簡字）是否與源碼表一致
  * 編碼的形式是否源碼表中定義的標準形式

第一點，有一臺專業的文本編輯器就控制住啦。比如VIM裏面用命令

    :set fenc=utf8 nobomb ff=unix

轉換、保存文件就中啦。

第二點，如果來源文件的資料格式不同，就需要藉助 regex 批量替換的操作，或寫腳本來完成轉換。

只有詞條、沒有編碼？請重新考慮先時我提出的建議。因爲，製作固態詞典，可以利用【八股文】，以及自動編碼器。

第三點，如果字形與目標詞典不一致，推薦用 [OpenCC](https://github.com/BYVoid/OpenCC) 完成碼表的繁、簡轉換。

第四點，凡是編碼爲源碼表中未出現過的形式，如通過「拼寫運算」實現的簡拼、異拼，又如編碼中的拼寫錯誤，都將導致該條記錄成爲用戶詞典中的無效數據，因爲無法通過正常的輸入檢索到。

### 同步用戶資料

藉助移動存儲設備，或在線存儲服務如Dropbox，在多臺電腦及不同系統之間同步用戶詞典和用戶設定。

#### 設定同步位置

默認地，詞典快照備份到 RIME用戶文件夾\sync\UUID 這個地方。如果你要用 Dropbox 或 U盤在不同機器/系統之間同步用戶詞典，則需要設定同步的目標文件夾，如 `D:\Dropbox\RimeSync` 。

直接編輯用戶文件夾下的 `installation.yaml` ，添加：

    sync_dir: 'D:\Dropbox\RimeSync'

又如 Mac 上添加：

    sync_dir: '/Users/fred/Dropbox/RimeSync'

又如使用 USB 存儲來同步：（[真實案例](https://gist.github.com/4483504)）

    sync_dir: '/Volumes/USBDRIVE/RimeSync'

默認地，每套 Rime 會隨機生成一個 UUID 作爲標識。不同 installation ID 可區分來自不同機器/系統的用戶詞典。

與安裝在其他系統上的 Rime 同步後，同步文件夾呈如下佈局：

    D:\Dropbox\RimeSync\id-xxx\luna_pinyin.userdb.txt
    D:\Dropbox\RimeSync\id-xxx\terra_pinyin.userdb.txt
    D:\Dropbox\RimeSync\id-xxx\installation.yaml
    D:\Dropbox\RimeSync\id-xxx\default.custom.yaml
    D:\Dropbox\RimeSync\id-xxx\weasel.custom.yaml

    D:\Dropbox\RimeSync\id-yyy\terra_pinyin.userdb.txt
    D:\Dropbox\RimeSync\id-yyy\installation.yaml
    D:\Dropbox\RimeSync\id-yyy\default.custom.yaml
    D:\Dropbox\RimeSync\id-yyy\squirrel.custom.yaml

    D:\Dropbox\RimeSync\id-zzz\luna_pinyin.userdb.txt
    D:\Dropbox\RimeSync\id-zzz\installation.yaml
    D:\Dropbox\RimeSync\id-zzz\alternative.yaml
    D:\Dropbox\RimeSync\id-zzz\luna_pinyin.custom.yaml

同步時，依次將各子文件夾中的詞典快照合併到用戶詞典，最後爲合併後的用戶詞典生成一份新的快照文件。
另外，還會把用戶文件夾中非自動生成的 YAML 文件及 .txt 文件單向 **備份** 到同步文件夾。

有些特別講究命名的用家，不喜隨機生成的 UUID，可編輯 `installation.yaml` ，取一個有意義的 ID，如：

    installation_id: 'fred-win7-desktop'

又如：

    installation_id: 'fred-macbook'

當心！因爲 Rime 要以這個 ID 爲名創建文件夾，因此 ID 不得包含（所有涉及同步的文件系統）文件名中非法的字符；建議不要用中文，只用小寫字母、數字、橫線和下劃線。

# 用家如是說

## 囧丁乙

佛振：我很抱歉，發明了 Rime 這個玩具，讓所有試圖調教他的玩家（包括佛振）忙得不亦樂乎。

起先是 BYVoid 神牛在博客裏寫到：
> 「[真可謂神級輸入法！](http://www.byvoid.com/blog/recommend-rime/)」

痛心。極盡誇張的謬讚，誤導不明真相的玩家紛紛效法修煉此道。

哪知神牛本是傳說中的人物，凡間又有幾許人懂得其中種種套路？
這「好玩具」，到玩家手裏還可以繼續好玩嘛？

## 玩家點評

[爱范儿（www.ifanr.com）](http://www.ifanr.com/156409)：
> 「这真是一个让你有惊喜的软件」

就讓我來無恥地偷拍微博玩家們「驚！喜？」的表情吧——

> 博瑀是只喵：鼠须管，极客的输入法！

> ![](https://github.com/rime/home/raw/master/images/user-quotes/squirrel-in-azure.jpg)

> 那只呆头鹅：「小狼毫输入法」，真不错。我是冲着方括号选的这款神级输入法。给大家推荐。

> ![](https://github.com/rime/home/raw/master/images/user-quotes/weasel-in-lost-temple.jpg)

> 明意呀：yes 我太聪明了！鼠须管设置成简体，按control + ` 这三个就可以设置了

> 风中摇曳的骚年：鼠鬚管的配置界面太抽象……額

> linsensong：嘿嘿，设置好了，现在是简体中文鼠须管了。感觉不错，这不是一个输入法，这是一个框架。oh yeah.

> 艾情无极限：这段时间「鼠须管」使用起来愈发熟练

> 郭宇：「鼠须管」输入法输入引号的这个体验很赞~ 「」

> ![](https://github.com/rime/home/raw/master/images/user-quotes/rime-users-quotes.jpg)

> SuQin：鼠须管输入法真好用啊真好用。。。

> 张克炎Kyan：最大的感受是：「终于不用为防止输入法死机而慢点打字了！」
> > 佛振：`- -||`

> VALkao：我覺得我先暫時用着這麼暢快的鼠鬚管，然後坐等它正式版然後期待那個GUI設置界面吧，我就不折騰GEEK風格的自定義了~~~
> > Patrick_Deng：三个月了，这设置界面还没做出来。。。

> 王中王kingofwang：最近MAC下新出的输入法“鼠须管”很火，今天看了一下，原来是跨平台的输入法框架，只是在Window下叫“小狼毫”了，连五笔都支持整句输入了，还真流畅得有些不习惯呢[偷笑]

> ![](https://github.com/rime/home/raw/master/images/user-quotes/rime-wubi-user.jpg)

> 携隐：自从更新了输入法，我写日记的频率和长度都顿时大幅提升。。。之前因为※※※※※的烂中文输入，已经越写越少了。所以说一个小小但却贴心的消费者技术应用意义多么重大，多么让人感激涕零啊！

> pete：难道我这人说话的内容跟一般人有很大区别吗？用鼠须管打字还是要选来选去的，完全没体会到一气呵成的感觉
> > 佛振:-D

> Penner：经过深度体验，可以放心删掉※※输入法了，鼠须管输入法的强大完全超出了我的想象！Mac 系统下终于有了一款好用到让人有些感动的拼音输入法，等的我好辛苦。

> 秒睡先森：鼠须管非要有个缺点的话,就是词库还是比较缺乏的.需要用户自己使用一段时间以后才能变得好用.

> 毛睿-梵烟阁：不是我執意和繁體過不去，只是兩點：1. 中古漢語和繁體和所謂「正體」都不是一回事；2. 現行所謂的繁體輸入法1）要麼輸入速度太慢（注音輸入法）2）要麼簡轉繁太菜。不過這一切都不再是問題，這鼠鬚管輸入法還真贊啊嘿！

> LeonGao：鼠鬚管，小狼毫，嘖嘖，這名字取的真是到位 :)

> 咸蛋猫熊：啥叫2b文艺青年。就是连电脑上的中文输入法都叫鼠须管。。

> huihui-huihui：回复@費子覺:[嘻嘻]开始以为是日本人起的名字呢，后来查了一下居然是一种老鼠须子做的笔（已失传已失传）[奥特曼] //@費子覺:鼠须管？这是一个活人能理解的名字吗？鼠标必须得管理？ //@huihui-huihui:转发微博

> Mr-Sunshine_：刚刚在威锋看到一款mac的输入法，很突然的叫做‘鼠须管’，诶妈呀，这字儿好像是打错了，但事实上没有额。。。

> ![](https://github.com/rime/home/raw/master/images/user-quotes/rime-users-uncertainty.jpg)

### 「封铀」試玩心得

[lionhoho 分享試玩心得](http://bbs.weiphone.com/read-htm-tid-5108521.html)：
> 「名字很怪异，楼主刚看到的时候以为是爱称？或者特殊拼写（如封铀）？搜索后发现这软件真叫鼠须管……」

> 「死心吧。。。。输入法没有设置界面，点击后居然是打开一个目录。。。。一堆文件。。。。」

[lily_nox：《鼠须管 配色方案设置》](http://bbs.weiphone.com/read-htm-tid-5112036.html)
> ——「搜狗和qq都可以实现啊，为什么一定要纠结于一个配置如此复杂的输入法呢？寻找DIY的乐趣吗？......」

> ——「用这个以前一直只用系统自带，从不用第三方输入法。。。
> 可是。。。“鼠须管”这个名字突然击中了我。。。
> 不知道为什么在我的逻辑里敢起这么奇葩的名字东西肯定是过得去的。。。OTZ 」

### 星際玩家點評

钢盅郭子答知乎問「[鼠鬚管輸入法好在哪裏？](http://www.zhihu.com/question/20432175/answer/15156773)」：

> ……另外，「小狼毫」居然还提供了令人倍感亲切的设定：

> ![](https://github.com/rime/home/raw/master/images/user-quotes/rime-starcraft-player.jpg)

### 十三叔點評

<http://www.douban.com/note/233072574/>

> 「不要被教程吓到。」
>
> 「附上官方定制指南，熟读之后真是想怎么来就怎么来啊！」
>
> 适宜人群：
>
>   * 对※※※※之类※※输入法极不放心的
>   * 受够了常常网页第一次输入卡顿的
>   * 钟爱繁体字的（下面有介绍它的繁体之功能非其他输入法可比）
>   * 觉得输入法理应如此小巧快捷，占资源少的
>
> 不适人群：
>
>   * 怕麻烦的
>   * 只要能用即可，对定制顺手工具无需求的
>   * 见字多就没耐心，根本就没看到本条的

## 當心！關「鍵」時刻用錯輸入法 恐惹禍事

> 曼城76人：爲什麼不用小狼毫輸入法，自動復旦毫無壓力。//@松汤美术馆: 複習 復旦大學 要學會用繁體輸入法組詞。//@-古代汉语-: 不会写繁体，最好老老实实写简体，不然丢脸丢大了。//@吴启雷:這個復，總錯，老錯，電腦一打字，必然錯。

> @永秉FDU：作为复旦的学生，无数次地将母校名字写错，这种错误是无法原谅的。尤其是在复旦正门口的海报栏里犯这种错误，就好比在你母亲脸上抹黑。强烈建议@复旦大学 将正确书写本校校名列入新生入学教育的必修内容，或者至少告知新生：不会使用繁体字索性就不要用。

> ![](https://github.com/rime/home/raw/master/images/user-quotes/rime-users-story.jpg)

註：[復旦大學](http://zh.wikipedia.org/wiki/%E5%A4%8D%E6%97%A6%E5%A4%A7%E5%AD%A6) 是中國最著名的大學之一。復旦的校名取自《尚書大傳》「日月光華，旦復旦兮」一句，以每天都充滿希望的日出，寄寓着興學救國的宏大理想。引用此故事的用意是讓更多同學熟悉校名的正確寫法： *复旦／復旦*

## 正體漢字 QQ 羣

> 笠＊：我用這個輸入法輸出的志没有言旁哦。用哪個輸入法能輸正體字比較准確呢

> 攴：準確

> 攴：小狼毫

> 古＊：小狼毫到目前爲止是最正的

> 攴： :-)

> 笠＊：是一種輸入法嗎？

> 攴：是一種生活方式

## 中州韻 QQ 羣

> P - 溝渠拼音：新的一天开始了 又可以用心爱的rime写字了

> Super - 五笔：好吧，自从用了Rime，确实又激发了我打字的欲望，哈:D

## Quotes from a foreign user learning Chinese

> It (Squirrel) makes a big difference on my MacBook. All the input methods I've used were... slow, but this is not.

> Wow... Great! This (terra_pinyin) is really helpful.

## 推文裏的故事

佛振最喜歡的故事，其實是——

無意間發現自己參與的作品出現在普通人的生活裏，成爲他人故事的一部分。身爲作者怎能不爲此感動一下下呢：

> 乌白：麦塔帮我装鼠须管突然转过来亲我，问他：「为什么亲我？」「这样下载会显得慢一点。」

> 路人甲：啥是鼠须管?

> 乌白：一个很麻烦（很）麻烦的中文输入法~

> 路人乙：太精确了！！！

> 乌白:P

## 微博故事

@Mega现充：
见鬼了，梦见在《西部世界》的钢琴前弹法红黑，五线谱下面是我最近填的词，但它在自动删改，发现是rime中州韵输入法在改句型，改完之后，路人甲走过来自称是游戏脚本家，然后把我刚改好的词放进了《钦定曲谱》……给我激动醒了…… ​​​​

@天二庄主：
最新的小狼毫输入法用着是真舒服，除了个别时候不够“智能”，整句输入前后文联想等功能比较低端，需要自己一点一点慢慢养词库养属于自己的语言模型外，出字频率，响应速度，功能配置，可订制性……我靠啊，虽然说我已经过了遇上啥都得鼓捣鼓捣那个岁数了，但是这个小狼毫依旧让我爱不释手啊……[允悲] ​

> La Rime 心情集

# 心情集

  * 中州韻輸入法，思想用鍵盤表達

  * 特倫斯大學輸入法專業者

  * 佛振編程思想 :D
      * 技巧加蠻力
      * 慢工出細活
      * 創造藝術和美
      * 登峰造極之作

  * Rime 終極目標：將輸入法建立在字理、音理、直覺和最樸素的邏輯之上

  * 擊出中文之韻
      * 東風破早梅，向暖一枝開
      * 聰明的輸入法懂我心意
      * 我無法門，信手便是法門
      * 我有　特別的　輸入技巧

  * 有詩為證

        讀書未成萬卷功
        下筆竟似有神通
        鍵盤乃可傳心意
        信手探入法門中

        式恕堂少主題中州韻輸入法引擎
        庚寅年臘月十九日

  * 鴰鴰

        鴰鴰鴰鴰鴰，鴰鴰鴰鴰！
        週末又唱起這首歌。
        寫代碼，排解BUG好幾顆。
        有沒有人獎勵我 :-)

  * 倉頡轉世賦
    [播放»](http://v.youku.com/v_show/id_XMzg0ODE0ODY0.html )

        倉頡公轉世　巧匠出河陰
        修此中州韻　豈言是凡品
        且大道至簡　亦玄奧高深
        運用之妙法　但存乎一心

        縱情漁獵字海詞林
        會不會某天穿越古今
        口中言語是華夏正音
        怎教我肯將主流放任

        苦執一念　終不得瀟灑
        難於講明了心裏真話
        寄情編碼　用千萬次敲打
        學會思想在鍵盤上表達

  * 吾本兔斯基

        法天法地　揮毫氣吞萬里
        神明附體　潑墨書寫傳奇
        亦幻亦真　聖心降臨吾身
        中州字韻　譜成八股雄文

  * 鼠鬚管

        鼠鬚管
        爲物雖微情不淺
        新詩醉墨時一揮
        別後寄我無辭遠
        　　——歐陽修

  * ☯ 混元編碼器

        混元生兩儀　成就編碼神器
        四象運衡璣　鍵界所當披靡

  * 又有

        揮毫擊鍵　殊途同歸　文字精妙　機巧生輝
        書法程式　不蹈陳規　今音古韻　演繹類推
        寄思中土　心懷主義　迭代寒暑　打造神器
        代碼不羈　指令犀利　開彼源兮　斯流永繼

        佛振題中州韻輸入法
        甲午年五月二十日

  * 詩云

        寒暑易節適飛
        雪輕撥機巧在
        暖齋神工妙術
        仙界有凡間幾
        曾降全才

        居戎氏庚子歲末
        鼠鬚管更新有感

  * 宮保拼音並擊術

        宮保拼音並擊術　節奏明快又直觀
        一擊一個中文字　能分平翹與尖團
        標準設備廣兼容　六鍵無衝七指禪
        速記千宗歸簡易　音韻萬變列琴盤

  * 一個人開發

        一個人開發一個項目？¹
        好處都有啥
        談一點體會吧

        方寸皆要親耕
        利於深度思考
        爲免麻煩到自己
        凡事總得認真些
        事先當然把
        能省力的方法想周全
        美稱全局優化推演
        排除外部干擾能

        往後愈發無困難
        熟練運用技術力
        只管執行計劃
        還不必做解釋
        事情簡單辦
        輕鬆愉快哉

        我曾獨孤做項目
        我根本沒有用戶
        大家讀了ＫＣＰ的評測文²
        風風關注過來
        起初我是拒絕的
        但是分享一下
        又不少啥
        工作節奏也是隨意的嘛
        或一週一更新多多分享
        或四年一更新穩穩當當
        毫無壓力

        經過我也知道
        代碼早晚會鏽
        更新是啞的　是不能持續的
        獨立做過一個項目後
        已然內心足夠強大
        心態好
        那些都不成問題

        用戶不能罵我

    - 1、本文首發於 [一个人开发一个项目是一种怎样的体验？ - 居戎氏的回答 - 知乎](https://www.zhihu.com/question/283349146/answer/451162371)
    - 2、ＫＣＰ的評測文：[推薦一個神級輸入法——Rime](https://byvoid.com/blog/recommend-rime/)


# Rime\build\luna_pinyin.schema.yaml 配置参考

```yaml
__build_info:
  rime_version: 1.11.2
  timestamps:
    default: 1728048115
    default.custom: 1743068037
    grammar: 0
    key_bindings: 1728048115
    key_bindings.custom: 0
    luna_pinyin.custom: 0
    luna_pinyin.schema: 1728048116
    pinyin: 1728048116
    pinyin.custom: 0
    punctuation: 1728048115
    punctuation.custom: 0
    symbols: 1743068589
    symbols.custom: 0
custom_phrase:
  db_class: stabledb
  dictionary: ""
  enable_completion: false
  enable_sentence: false
  initial_quality: 1
  user_dict: custom_phrase
engine:
  filters:
    - simplifier
    - uniquifier
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - "table_translator@custom_phrase"
    - reverse_lookup_translator
    - script_translator
key_binder:
  bindings:
    - {accept: "Control+p", send: Up, when: composing}
    - {accept: "Control+n", send: Down, when: composing}
    - {accept: "Control+b", send: Left, when: composing}
    - {accept: "Control+f", send: Right, when: composing}
    - {accept: "Control+a", send: Home, when: composing}
    - {accept: "Control+e", send: End, when: composing}
    - {accept: "Control+d", send: Delete, when: composing}
    - {accept: "Control+k", send: "Shift+Delete", when: composing}
    - {accept: "Control+h", send: BackSpace, when: composing}
    - {accept: "Control+g", send: Escape, when: composing}
    - {accept: "Control+bracketleft", send: Escape, when: composing}
    - {accept: "Control+y", send: Page_Up, when: composing}
    - {accept: "Alt+v", send: Page_Up, when: composing}
    - {accept: "Control+v", send: Page_Down, when: composing}
    - {accept: ISO_Left_Tab, send: "Shift+Left", when: composing}
    - {accept: "Shift+Tab", send: "Shift+Left", when: composing}
    - {accept: Tab, send: "Shift+Right", when: composing}
    - {accept: minus, send: Page_Up, when: has_menu}
    - {accept: equal, send: Page_Down, when: has_menu}
    - {accept: comma, send: Page_Up, when: paging}
    - {accept: period, send: Page_Down, when: has_menu}
    - {accept: "Control+Shift+1", select: .next, when: always}
    - {accept: "Control+Shift+2", toggle: ascii_mode, when: always}
    - {accept: "Control+Shift+3", toggle: full_shape, when: always}
    - {accept: "Control+Shift+4", toggle: simplification, when: always}
    - {accept: "Control+Shift+5", toggle: extended_charset, when: always}
    - {accept: "Control+Shift+exclam", select: .next, when: always}
    - {accept: "Control+Shift+at", toggle: ascii_mode, when: always}
    - {accept: "Control+Shift+numbersign", toggle: full_shape, when: always}
    - {accept: "Control+Shift+dollar", toggle: simplification, when: always}
    - {accept: "Control+Shift+percent", toggle: extended_charset, when: always}
  import_preset: default
menu:
  page_size: 9
punctuator:
  full_shape:
    " ": {commit: "　"}
    "!": {commit: "！"}
    "\"": {pair: ["“", "”"]}
    "#": ["＃", "⌘"]
    "$": ["￥", "$", "€", "£", "¥", "¢", "¤", "₩"]
    "%": ["％", "°", "℃"]
    "&": "＆"
    "'": {pair: ["‘", "’"]}
    "(": "（"
    ")": "）"
    "*": ["＊", "·", "・", "×", "※", "❂"]
    "+": "＋"
    ",": {commit: "，"}
    "-": "－"
    .: {commit: "。"}
    "/": ["／", "÷"]
    ":": {commit: "："}
    ";": {commit: "；"}
    "<": ["《", "〈", "«", "‹", "⟨"]
    "=": ["＝", "々", "〃"]
    ">": ["》", "〉", "»", "›", "⟩"]
    "?": {commit: "？"}
    "@": ["＠", "☯"]
    "[": ["「", "【", "〔", "［", "〚", "〘"]
    "\\": ["、", "＼"]
    "]": ["」", "】", "〕", "］", "〛", "〙"]
    "^": {commit: "……"}
    _: "——"
    "`": "｀"
    "{": ["『", "〖", "｛"]
    "|": ["·", "｜", "§", "¦"]
    "}": ["』", "〗", "｝"]
    "~": "～"
  half_shape:
    "!": {commit: "！"}
    "\"": {pair: ["“", "”"]}
    "#": ["#", "№"]
    "$": ["￥", "$", "€", "£", "¥", "¢", "¤", "₩"]
    "%": ["%", "％", "°", "℃", "‰", "‱", "℉", "℅", "℆", "℀", "℁", "⅍"]
    "&": "&"
    "'": {pair: ["‘", "’"]}
    "(": "（"
    ")": "）"
    "*": ["*", "＊", "·", "・", "×", "※", "❂", "⁂", "☮", "☯", "☣"]
    "+": "+"
    ",": {commit: "，"}
    "-": "-"
    .: {commit: "。"}
    "/": ["、", "､", "/", "／", "÷"]
    ":": {commit: "："}
    ";": {commit: "；"}
    "<": ["《", "〈", "«", "‹", "⟨", "˂", "˱"]
    "=": ["=", "々", "〃"]
    ">": ["》", "〉", "»", "›", "⟩", "˃", "˲"]
    "?": {commit: "？"}
    "@": ["@", "©", "®", "℗"]
    "[": ["「", "【", "〔", "［", "〚", "〘"]
    "\\": ["、", "\\", "＼"]
    "]": ["」", "】", "〕", "］", "〛", "〙"]
    "^": {commit: "……"}
    _: "——"
    "`": ["`", "‵", "‶", "‷", "′", "″", "‴", "⁗"]
    "{": ["『", "〖", "｛"]
    "|": ["·", "・", "|", "｜", "§", "¦", "‖", "︴"]
    "}": ["』", "〗", "｝"]
    "~": ["~", "～", "˜", "˷", "ⸯ", "≈", "≋", "≃", "≅", "≇", "∽", "⋍", "≌", "﹏", "﹋", "﹌", "︴"]
  import_preset: symbols
  symbols:
    " /gz": ["甲子", "乙丑 ", "丙寅", "丁卯", "戊辰", "己巳", "庚午", "辛未", "壬申", "癸酉", "甲戌", "乙亥", "丙子", "丁丑", "戊寅", "己卯", "庚辰", "辛巳", "壬午", "癸未", "甲申", "乙酉", "丙戌", "丁亥", "戊子", "己丑", "庚寅", "辛卯", "壬辰", "癸巳", "甲午", "乙未", "丙申", "丁酉", "戊戌", "己亥", "庚子", "辛丑", "壬寅", "癸卯", "甲辰", "乙巳", "丙午", "丁未", "戊申", "己酉", "庚戌", "辛亥", "壬子", "癸丑", "甲寅", "乙卯", "丙辰", "丁巳", "戊午", "己未", "庚申", "辛酉", "壬戌", "癸亥"]
    "/0": ["〇", "零", "₀", "⁰", "⓪", "⓿", "０"]
    "/1": ["一", "壹", "₁", "¹", "Ⅰ", "ⅰ", "①", "➀", "❶", "➊", "⓵", "⑴", "⒈", "１", "㊀", "㈠", "弌", "壱", "幺", "㆒"]
    "/10": ["十", "拾", "₁₀", "¹⁰", "Ⅹ", "ⅹ", "⑩", "➉", "❿", "➓", "⓾", "⑽", "⒑", "１０", "㊉", "㈩", "什"]
    "/2": ["二", "貳", "₂", "²", "Ⅱ", "ⅱ", "②", "➁", "❷", "➋", "⓶", "⑵", "⒉", "２", "㊁", "㈡", "弍", "弐", "貮", "㒃", "㒳", "兩", "倆", "㆓"]
    "/3": ["三", "叄", "₃", "³", "Ⅲ", "ⅲ", "③", "➂", "❸", "➌", "⓷", "⑶", "⒊", "３", "㊂", "㈢", "參", "参", "叁", "弎", "仨", "㆔"]
    "/4": ["四", "肆", "₄", "⁴", "Ⅳ", "ⅳ", "④", "➃", "❹", "➍", "⓸", "⑷", "⒋", "４", "㊃", "㈣", "亖"]
    "/5": ["五", "伍", "₅", "⁵", "Ⅴ", "ⅴ", "⑤", "➄", "❺", "➎", "⓹", "⑸", "⒌", "５", "㊄", "㈤", "㐅", "㠪", "𠄡"]
    "/6": ["六", "陸", "₆", "⁶", "Ⅵ", "ⅵ", "⑥", "➅", "❻", "➏", "⓺", "⑹", "⒍", "６", "㊅", "㈥", "ↅ"]
    "/7": ["七", "柒", "₇", "⁷", "Ⅶ", "ⅶ", "⑦", "➆", "❼", "➐", "⓻", "⑺", "⒎", "７", "㊆", "㈦", "漆"]
    "/8": ["八", "捌", "₈", "⁸", "Ⅷ", "ⅷ", "⑧", "➇", "❽", "➑", "⓼", "⑻", "⒏", "８", "㊇", "㈧"]
    "/9": ["九", "玖", "₉", "⁹", "Ⅸ", "ⅸ", "⑨", "➈", "❾", "➒", "⓽", "⑼", "⒐", "９", "㊈", "㈨"]
    "/A": ["Ā", "Á", "Ǎ", "À", "Ȁ", "Â", "Ă", "Ȃ", "Ȧ", "Ä", "Å", "Ã", "ᴀ", "ᴬ", "Ⱥ", "Ả", "Ą", "Ạ", "Ḁ", "Ấ", "Ầ", "Ẫ", "Ẩ", "Ắ", "Ằ", "Ẵ", "Ẳ", "Ǡ", "Ǟ", "Ǻ", "Ậ", "Ặ", "Ɐ", "Ɑ", "Ɒ"]
    "/AA": ["Ꜳ"]
    "/AE": ["Æ", "Ǣ", "Ǽ", "ᴭ", "ᴁ"]
    "/AO": ["Ꜵ"]
    "/AU": ["Ꜷ"]
    "/AV": ["Ꜹ", "Ꜻ"]
    "/AY": ["Ꜽ"]
    "/B": ["Ḃ", "Ḅ", "ʙ", "ᴃ", "ᴮ", "ᴯ", "Ƀ", "Ƃ", "Ḇ", "Ɓ", "Ꞗ"]
    "/C": ["Ç", "Ć", "Č", "Ĉ", "Ċ", "ᴄ", "Ȼ", "Ꞓ", "Ƈ", "Ḉ", "Ꜿ"]
    "/D": ["Ď", "Ḋ", "ᴅ", "ᴆ", "ᴰ", "Đ", "Ƌ", "Ḑ", "Ḓ", "Ḏ", "Ḍ", "Ɖ", "Ɗ", "Ð", "Ǳ", "ǲ", "Ǆ", "ǅ"]
    "/E": ["Ē", "É", "Ě", "È", "Ȅ", "Ê", "Ĕ", "Ȇ", "Ė", "Ë", "Ẽ", "ᴇ", "ᴱ", "Ɇ", "Ẻ", "Ȩ", "Ę", "Ḙ", "Ẹ", "Ḛ", "Ḗ", "Ḕ", "Ế", "Ề", "Ễ", "Ể", "Ḝ", "Ệ", "Ə", "Ɛ", "Ɜ", "Ǝ", "ⱻ", "ᴲ", "Ȝ"]
    "/F": ["Ḟ", "ꜰ", "Ƒ", "Ꞙ", "ꟻ"]
    "/G": ["Ḡ", "Ǵ", "Ǧ", "Ĝ", "Ğ", "Ġ", "ʛ", "ᴳ", "Ǥ", "Ꞡ", "Ģ", "Ɠ", "Ɡ", "Ɣ"]
    "/H": ["Ĥ", "Ȟ", "Ḣ", "Ḧ", "ʜ", "ᴴ", "Ħ", "Ɦ", "Ꜧ", "Ḩ", "Ḫ", "Ḥ", "Ⱨ", "Ɥ", "Ⱶ"]
    "/HV": ["Ƕ"]
    "/I": ["Ī", "Í", "Ǐ", "Ì", "Ȉ", "Î", "Ĭ", "Ȋ", "Ï", "Ĩ", "İ", "ɪ", "ᴵ", "ᶦ", "Ɨ", "ᵻ", "ᶧ", "Ỉ", "Į", "Ị", "Ḭ", "Ḯ", "ꟾ", "Ɩ"]
    "/IJ": ["Ĳ"]
    "/J": ["Ĵ", "ᴊ", "ᴶ", "Ɉ", "Ʝ"]
    "/K": ["Ḱ", "Ǩ", "ᴋ", "ᴷ", "Ꝁ", "Ꝃ", "Ꞣ", "Ꝅ", "Ķ", "Ḵ", "Ḳ", "Ƙ", "Ⱪ", "Ʞ"]
    "/L": ["Ĺ", "ʟ", "ᶫ", "Ƚ", "Ꝉ", "Ł", "ᴌ", "Ⱡ", "Ɫ", "Ɬ", "Ľ", "Ļ", "Ḻ", "Ḽ", "Ḷ", "Ŀ", "Ꝇ"]
    "/LL": ["Ỻ"]
    "/M": ["Ḿ", "Ṁ", "ᴍ", "ᴹ", "Ṃ", "Ɱ", "Ɯ", "ꟽ", "ꟿ"]
    "/N": ["Ń", "Ň", "Ǹ", "Ṅ", "Ñ", "ɴ", "ᴺ", "ᴻ", "ᶰ", "Ɲ", "Ƞ", "Ŋ", "Ņ", "Ṉ", "Ṋ", "Ṇ", "Ꞑ"]
    "/NJ": ["Ǌ"]
    "/Nj": ["ǋ"]
    "/O": ["Ō", "Ó", "Ő", "Ǒ", "Ò", "Ô", "Ŏ", "Ȯ", "Ö", "Õ", "ᴏ", "ᴼ", "Ɔ", "ᴐ", "Ø", "Ǫ", "Ọ", "Ơ", "Ɵ", "Ꝋ", "Ꝍ", "Ṓ", "Ṑ", "Ố", "Ồ", "Ỗ", "Ổ", "Ȱ", "Ȫ", "Ȭ", "Ṍ", "Ṏ", "Ộ", "Ǭ", "Ǿ", "Ớ", "Ờ", "Ỡ", "Ở", "Ợ"]
    "/OE": ["Œ", "ɶ"]
    "/OI": ["Ƣ"]
    "/OO": ["Ꝏ"]
    "/OU": ["Ȣ", "ᴽ"]
    "/P": ["Ṕ", "Ṗ", "ᴘ", "ᴾ", "Ᵽ", "Ꝑ", "Ƥ", "Ꝓ", "Ꝕ", "ꟼ"]
    "/Q": ["Ɋ", "Ꝗ", "Ꝙ"]
    "/R": ["Ŕ", "Ř", "Ȑ", "Ȓ", "Ṙ", "ʀ", "ᴙ", "ᴿ", "Ʀ", "ꭆ", "Ɍ", "Ꞧ", "Ŗ", "Ṟ", "Ṛ", "Ṝ", "Ɽ", "ꝶ", "ʶ", "ʁ", "Ꝛ", "Ꝝ"]
    "/Rx": ["℞"]
    "/S": ["Ś", "Ŝ", "Š", "Ṡ", "ꜱ", "Ꞩ", "Ş", "Ṣ", "Ș", "Ṥ", "Ṧ", "Ṩ", "Ʃ", "ẞ"]
    "/T": ["Ť", "Ṫ", "ᴛ", "ᵀ", "Ʈ", "Þ", "Ꝥ", "Ꝧ", "Ŧ", "Ⱦ", "Ţ", "Ṯ", "Ṱ", "Ṭ", "Ț", "Ƭ", "Ʇ"]
    "/TZ": ["Ꜩ"]
    "/U": ["Ū", "Ú", "Ű", "Ǔ", "Ù", "Ȕ", "Û", "Ŭ", "Ȗ", "Ü", "Ǖ", "Ǘ", "Ǚ", "Ǜ", "Ů", "Ũ", "ᴜ", "ᵁ", "ᶸ", "Ʉ", "Ủ", "Ų", "Ṷ", "Ụ", "Ṳ", "Ṵ", "Ư", "Ʊ", "Ṻ", "Ṹ", "Ứ", "Ừ", "Ữ", "Ử", "Ự"]
    "/V": ["Ü", "Ǖ", "Ǘ", "Ǚ", "Ǜ", "Ṽ", "ᴠ", "ⱽ", "Ṿ", "Ꝟ", "Ʋ", "Ỽ", "Ʌ"]
    "/VY": ["Ꝡ"]
    "/W": ["Ẃ", "Ẁ", "Ŵ", "Ẇ", "Ẅ", "W̊", "ᴡ", "ᵂ", "Ẉ", "Ƿ", "Ⱳ"]
    "/X": ["Ẋ", "Ẍ"]
    "/Y": ["Ȳ", "Ý", "Ỳ", "Ŷ", "Ẏ", "Ÿ", "Ỹ", "ʏ", "Ɏ", "Ỷ", "Ỵ", "Ƴ", "Ỿ"]
    "/Z": ["Ź", "Ž", "Ẑ", "Ż", "ᴢ", "Ƶ", "Ẕ", "Ẓ", "Ȥ", "Ⱬ", "Ʒ", "ᴣ", "Ǯ", "Ƹ", "Ɀ", "Ꝣ"]
    "/a": ["ā", "á", "ǎ", "à", "ȁ", "â", "ă", "ȃ", "ȧ", "ä", "å", "ã", "ₐ", "ᵃ", "ª", "ⱥ", "ꬰ", "ả", "ą", "ạ", "ḁ", "ẚ", "ấ", "ầ", "ẫ", "ẩ", "ắ", "ằ", "ẵ", "ẳ", "ǡ", "ǟ", "ǻ", "ậ", "ặ", "ᶏ", "ɐ", "ᵄ", "ɑ", "ᵅ", "ᶐ", "ɒ", "ᶛ"]
    "/aa": ["ꜳ"]
    "/ae": ["æ", "ǣ", "ǽ", "ᵆ", "ᴂ"]
    "/ao": ["ꜵ"]
    "/au": ["ꜷ"]
    "/av": ["ꜹ", "ꜻ"]
    "/ay": ["ꜽ"]
    "/b": ["ḃ", "ḅ", "ᵇ", "ƀ", "ƃ", "ḇ", "ɓ", "ᵬ", "ᶀ", "ꞗ"]
    "/bd": ["、", "。", "「", "」", "『", "』", "【", "】", "〈", "〉", "《", "》", "⟨", "⟩", "₋", "⁻", "―", "˗", "ˉ", "＿", "﹍", "﹎", "．", "¡", "‼", "⁉", "¿", "؟", "⁈", "⁇", "､", "｡", "〃", "〄", "々", "〆", "〇", "〒", "〓", "〔", "〕", "〖", "〗", "〘", "〙", "〚", "〛", "〜", "〝", "〞", "〟", "〠", "〰", "〱", "〲", "〳", "〴", "〵", "〶", "〷", "〻", "〼", "〽"]
    "/bdz": ["﹅", "﹆", "﹁", "﹂", "﹃", "﹄", "︙", "︱", "︻", "︼", "︗", "︘", "︵", "︶", "︷", "︸", "︹", "︺", "︿", "﹀", "︽", "︾", "︰", "︲", "︳", "︴", "﹉", "﹊", "﹋", "﹌", "﹍", "﹎", "﹏", "﹇", "﹈", "︐", "︑", "︒", "︔", "︕", "︖"]
    "/bg": ["☰", "☱", "☲", "☳", "☴", "☵", "☶", "☷"]
    "/bgm": ["乾", "兌", "離", "震", "巽", "坎", "艮", "坤"]
    "/bh": ["㇀", "㇁", "㇂", "㇃", "㇄", "㇅", "㇆", "㇇", "㇈", "㇉", "㇊", "㇋", "㇌", "㇍", "㇎", "㇏", "㇐", "㇑", "㇒", "㇓", "㇔", "㇕", "㇖", "㇗", "㇘", "㇙", "㇚", "㇛", "㇜", "㇝", "㇞", "㇟", "㇠", "㇡", "㇢", "㇣"]
    "/bq": ["☻", "☺", "☹"]
    "/c": ["ç", "ć", "č", "ĉ", "ċ", "ᶜ", "ȼ", "ꞓ", "ƈ", "ḉ", "ꞔ", "ɕ", "ᶝ", "ꜿ"]
    "/d": ["ď", "ḋ", "ᵈ", "đ", "ƌ", "ᵭ", "ḑ", "ḓ", "ḏ", "ḍ", "ɖ", "ɗ", "ᶑ", "ᶁ", "ð", "ᶞ", "ꝱ", "ʤ", "ʣ", "ʥ", "ȡ", "ƍ", "ǳ", "ǆ", "ẟ"]
    "/db": ["ȸ"]
    "/dn": ["❖", "⌘", "⌃", "⌥", "⎇", "⇧", "⇪", "␣", "⇥", "⇤", "↩", "⌅", "⌤", "⌫", "⌦", "⌧", "⎋", "⌨", "◁", "⌀", "⌖", "⌗", "⏏", "↖", "↘", "⇞", "⇟", "⌚", "⏰", "⏱", "⏲", "⏳", "⌛", "⌜", "⌝", "⌞", "⌟", "⍑", "⏩", "⏪", "⏫", "⏬", "⏭", "⏮", "⏯"]
    "/dot": ["•", "⚙", "🕸"]
    "/dw": ["Å", "℃", "％", "‰", "‱", "°", "℉", "㏃", "㏆", "㎈", "㏄", "㏅", "㎝", "㎠", "㎤", "㏈", "㎗", "㎙", "㎓", "㎬", "㏉", "㏊", "㏋", "㎐", "㏌", "㎄", "㎅", "㎉", "㎏", "㎑", "㏍", "㎘", "㎞", "㏎", "㎢", "㎦", "㎪", "㏏", "㎸", "㎾", "㏀", "㏐", "㏓", "㎧", "㎨", "㎡", "㎥", "㎃", "㏔", "㎆", "㎎", "㎒", "㏕", "㎖", "㎜", "㎟", "㎣", "㏖", "㎫", "㎳", "㎷", "㎹", "㎽", "㎿", "㏁", "㎁", "㎋", "㎚", "㎱", "㎵", "㎻", "㏘", "㎩", "㎀", "㎊", "㏗", "㏙", "㏚", "㎰", "㎴", "㎺", "㎭", "㎮", "㎯", "㏛", "㏜", "㎔", "㏝", "㎂", "㎌", "㎍", "㎕", "㎛", "㎲", "㎶", "㎼"]
    "/dz": ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]
    "/e": ["ē", "é", "ě", "è", "ȅ", "ê", "ĕ", "ȇ", "ė", "ë", "ẽ", "ₑ", "ᵉ", "ɇ", "ꬳ", "ẻ", "ȩ", "ę", "ḙ", "ẹ", "ḛ", "ḗ", "ḕ", "ế", "ề", "ễ", "ể", "ḝ", "ệ", "ᶒ", "ꬴ", "ɘ", "ə", "ɚ", "ᶕ", "ɛ", "ᵋ", "ᶓ", "ɜ", "ᵌ", "ᴈ", "ᶟ", "ɝ", "ᶔ", "ɞ", "ʚ", "ǝ", "ₔ", "ᵊ", "ȝ", "ⱸ"]
    "/ey": ["а", "б", "в", "г", "д", "е", "ё", "ж", "з", "и", "й", "к", "л", "м", "н", "о", "п", "р", "с", "т", "у", "ф", "х", "ц", "ч", "ш", "щ", "ъ", "ы", "ь", "э", "ю", "я"]
    "/eyd": ["А", "Б", "В", "Г", "Д", "Е", "Ё", "Ж", "З", "И", "Й", "К", "Л", "М", "Н", "О", "П", "Р", "С", "Т", "У", "Ф", "Х", "Ц", "Ч", "Ш", "Щ", "Ъ", "Ы", "Ь", "Э", "Ю", "Я"]
    "/f": ["ḟ", "ᶠ", "ƒ", "ᵮ", "ᶂ", "ꞙ"]
    "/ff": ["ﬀ"]
    "/ffi": ["ﬃ"]
    "/ffl": ["ﬄ"]
    "/fh": ["©", "®", "℗", "℠", "™", "℡", "℻", "☇", "☈", "☉", "☊", "☋", "☌", "☍", "☎", "☏", "☐", "☑", "☒", "☓", "☕", "☖", "☗", "⛉", "⛊", "☘", "☙", "☚", "☛", "☜", "☝", "☞", "☟", "☠", "☡", "☢", "☣", "☤", "☥", "☦", "☧", "☨", "☩", "☪", "☫", "☬", "☭", "☮", "☯", "☸", "♨", "♰", "♱", "♲", "♳", "♴", "♵", "♶", "♷", "♸", "♹", "♺", "♻", "♼", "♽", "♾", "♿", "⚆", "⚇", "⚈", "⚉", "⚐", "⚑", "⚒", "⚓", "⚔", "⚕", "⚖", "⚗", "⚘", "⚙", "⚚", "⚛", "⚜", "⚝", "⚞", "⚟", "⚠", "⚡", "⚰", "⚱", "⚲", "⚳", "⚴", "⚵", "⚶", "⚷", "⚸", "⚹", "⚺", "⚻", "⚼", "⚽", "⚾", "⚿", "⛀", "⛁", "⛂", "⛃", "⛋", "⛌", "⛍", "⛎", "⛏", "⛐", "⛑", "⛒", "⛓", "⛔", "⛕", "⛖", "⛗", "⛘", "⛙", "⛚", "⛛", "⛜", "⛝", "⛞", "⛟", "⛠", "⛡", "⛢", "⛣", "⛨", "⛩", "⛪", "⛫", "⛬", "⛭", "⛮", "⛯", "⛰", "⛱", "⛲", "⛳", "⛴", "⛵", "⛶", "⛷", "⛸", "⛹", "⛺", "⛻", "⛼", "⛽", "⛾", "⛿"]
    "/fi": ["ﬁ"]
    "/fk": ["▀", "▁", "▂", "▃", "▄", "▅", "▆", "▇", "█", "▉", "▊", "▋", "▌", "▍", "▎", "▏", "▐", "░", "▒", "▓", "▔", "▕", "▖", "▗", "▘", "▙", "▚", "▛", "▜", "▝", "▞", "▟"]
    "/fl": ["ﬂ"]
    "/fn": ["ʩ"]
    "/fs": ["⅟", "½", "↉", "⅓", "⅔", "¼", "¾", "⅕", "⅖", "⅗", "⅘", "⅙", "⅚", "⅐", "⅛", "⅜", "⅝", "⅞", "⅑", "⅒"]
    "/h": ["ĥ", "ȟ", "ḣ", "ḧ", "ͪ", "ħ", "ɦ", "ʱ", "ꜧ", "ꭜ", "ɧ", "ḩ", "ẖ", "ḫ", "ḥ", "ⱨ", "ꞕ", "ɥ", "ᶣ", "ʮ", "ʯ", "ⱶ"]
    "/hb": ["￥", "¥", "¤", "￠", "＄", "$", "￡", "£", "৳", "฿", "₠", "₡", "₢", "₣", "₤", "₥", "₦", "₧", "₩", "₪", "₫", "€", "₭", "₮", "₯", "₰", "₱", "₲", "₳", "₴", "₵", "₶", "₷", "₸", "₹", "₺", "₨", "﷼"]
    "/hv": ["ƕ"]
    "/hw": ["ㄱ", "ㄴ", "ㄷ", "ㄹ", "ㅁ", "ㅂ", "ㅅ", "ㅇ", "ㅈ", "ㅊ", "ㅋ", "ㅌ", "ㅍ", "ㅎ"]
    "/hwh": ["㈀", "㈁", "㈂", "㈃", "㈄", "㈅", "㈆", "㈇", "㈈", "㈉", "㈊", "㈋", "㈌", "㈍", "㈎", "㈏", "㈐", "㈑", "㈒", "㈓", "㈔", "㈕", "㈖", "㈗", "㈘", "㈙", "㈚", "㈛", "㈜", "㈝", "㈞"]
    "/hwq": ["㉠", "㉡", "㉢", "㉣", "㉤", "㉥", "㉦", "㉧", "㉨", "㉩", "㉪", "㉫", "㉬", "㉭", "㉮", "㉯", "㉰", "㉱", "㉲", "㉳", "㉴", "㉵", "㉶", "㉷", "㉸", "㉹", "㉺", "㉻", "㉼", "㉽", "㉾", "㉿"]
    "/hzh": ["㈠", "㈡", "㈢", "㈣", "㈤", "㈥", "㈦", "㈧", "㈨", "㈩", "㈪", "㈫", "㈬", "㈭", "㈮", "㈯", "㈰", "㈱", "㈲", "㈳", "㈴", "㈵", "㈶", "㈷", "㈸", "㈹", "㈺", "㈻", "㈼", "㈽", "㈾", "㈿", "㉀", "㉁", "㉂", "㉃"]
    "/hzq": ["㊀", "㊁", "㊂", "㊃", "㊄", "㊅", "㊆", "㊇", "㊈", "㊉", "㊊", "㊋", "㊌", "㊍", "㊎", "㊏", "㊐", "㊑", "㊒", "㊓", "㊔", "㊕", "㊖", "㊗", "㊘", "㊙", "㊚", "㊛", "㊜", "㊝", "㊞", "㊟", "㊠", "㊡", "㊢", "㊣", "㊤", "㊥", "㊦", "㊧", "㊨", "㊩", "㊪", "㊫", "㊬", "㊭", "㊮", "㊯", "㊰", "㉄", "㉅", "㉆", "㉇"]
    "/i": ["ī", "í", "ǐ", "ì", "ȉ", "î", "ĭ", "ȋ", "ï", "ĩ", "ı", "ᵢ", "ɨ", "ᶤ", "ỉ", "į", "ị", "ḭ", "ᴉ", "ᵎ", "ḯ", "ᶖ", "ɩ", "ᶥ", "ᵼ"]
    "/ij": ["ĳ"]
    "/iro": ["い", "ろ", "は", "に", "ほ", "へ", "と", "ち", "り", "ぬ", "る", "を", "わ", "か", "よ", "た", "れ", "そ", "つ", "ね", "な", "ら", "む", "う", "ゐ", "の", "お", "く", "や", "ま", "け", "ふ", "こ", "え", "て", "あ", "さ", "き", "ゆ", "め", "み", "し", "ゑ", "ひ", "も", "せ", "す"]
    "/j": ["ĵ", "ǰ", "ⱼ", "ʲ", "ɉ", "ȷ", "ɟ", "ᶡ", "ʄ", "ʝ", "ᶨ"]
    "/jg": ["⿰", "⿱", "⿲", "⿳", "⿴", "⿵", "⿶", "⿷", "⿸", "⿹", "⿺", "⿻", "〾"]
    "/jh": ["■", "□", "▢", "▣", "▤", "▥", "▦", "▧", "▨", "▩", "▪", "▫", "▬", "▭", "▮", "▯", "▰", "▱", "▲", "△", "▴", "▵", "▶", "▷", "▸", "▹", "►", "▻", "▼", "▽", "▾", "▿", "◀", "◁", "◂", "◃", "◄", "◅", "◆", "◇", "◈", "◉", "◊", "○", "◌", "◍", "◎", "●", "◐", "◑", "◒", "◓", "◔", "◕", "◖", "◗", "◘", "◙", "◚", "◛", "◜", "◝", "◞", "◟", "◠", "◡", "◢", "◣", "◤", "◥", "◦", "◧", "◨", "◩", "◪", "◫", "◬", "◭", "◮", "◯", "◰", "◱", "◲", "◳", "◴", "◵", "◶", "◷", "◸", "◹", "◺", "◻", "◼", "◽", "◾", "◿"]
    "/jm": ["あ", "ぁ", "い", "ぃ", "う", "ぅ", "え", "ぇ", "お", "ぉ", "か", "ゕ", "が", "き", "ぎ", "く", "ぐ", "け", "ゖ", "げ", "こ", "ご", "さ", "ざ", "し", "じ", "す", "ず", "せ", "ぜ", "そ", "ぞ", "た", "だ", "ち", "ぢ", "つ", "っ", "づ", "て", "で", "と", "ど", "な", "に", "ぬ", "ね", "の", "は", "ば", "ぱ", "ひ", "び", "ぴ", "ふ", "ぶ", "ぷ", "へ", "べ", "ぺ", "ほ", "ぼ", "ぽ", "ま", "み", "む", "め", "も", "や", "ゃ", "ゆ", "ゅ", "よ", "ょ", "ら", "り", "る", "れ", "ろ", "わ", "ゎ", "ゐ", "ゔ", "ゑ", "を", "ん", "・", "ー", "ゝ", "ゞ", "ゟ"]
    "/jma": ["あ", "か", "が", "さ", "ざ", "た", "だ", "な", "は", "ば", "ぱ", "ま", "や", "ら", "わ", "ア", "カ", "ガ", "サ", "ザ", "タ", "ダ", "ナ", "ハ", "バ", "パ", "マ", "ヤ", "ラ", "ワ"]
    "/jmb": ["ば", "び", "ぶ", "べ", "ぼ", "バ", "ビ", "ブ", "ベ", "ボ"]
    "/jmbj": ["ｱ", "ｧ", "ｲ", "ｨ", "ｳ", "ｩ", "ｴ", "ｪ", "ｵ", "ｫ", "ｶ", "ｷ", "ｸ", "ｹ", "ｺ", "ｻ", "ｼ", "ｽ", "ｾ", "ｿ", "ﾀ", "ﾁ", "ﾂ", "ｯ", "ﾃ", "ﾄ", "ﾅ", "ﾆ", "ﾇ", "ﾈ", "ﾉ", "ﾊ", "ﾋ", "ﾌ", "ﾍ", "ﾎ", "ﾏ", "ﾐ", "ﾑ", "ﾒ", "ﾓ", "ﾔ", "ｬ", "ﾕ", "ｭ", "ﾖ", "ｮ", "ﾗ", "ﾘ", "ﾙ", "ﾚ", "ﾛ", "ﾜ", "ｦ", "ﾝ", "･", "ｰ", "ﾞ", "ﾟ"]
    "/jmd": ["だ", "ぢ", "づ", "で", "ど", "ダ", "ヂ", "ヅ", "デ", "ド"]
    "/jme": ["え", "け", "げ", "せ", "ぜ", "て", "で", "ね", "へ", "べ", "ぺ", "め", "れ", "ゑ", "エ", "ケ", "ゲ", "セ", "ゼ", "テ", "デ", "ネ", "ヘ", "ベ", "ペ", "メ", "レ", "ヱ"]
    "/jmg": ["が", "ぎ", "ぐ", "げ", "ご", "ガ", "ギ", "グ", "ゲ", "ゴ"]
    "/jmh": ["は", "ひ", "ふ", "へ", "ほ", "ハ", "ヒ", "フ", "ヘ", "ホ"]
    "/jmi": ["い", "き", "ぎ", "し", "じ", "ち", "ぢ", "に", "ひ", "び", "ぴ", "み", "り", "ゐ", "イ", "キ", "ギ", "シ", "ジ", "チ", "ヂ", "ニ", "ヒ", "ビ", "ピ", "ミ", "リ", "ヰ"]
    "/jmk": ["か", "ゕ", "き", "く", "け", "ゖ", "こ", "カ", "ヵ", "キ", "ク", "ケ", "ヶ", "コ"]
    "/jmm": ["ま", "み", "む", "め", "も", "マ", "ミ", "ム", "メ", "モ"]
    "/jmn": ["な", "に", "ぬ", "ね", "の", "ん", "ナ", "ニ", "ヌ", "ネ", "ノ", "ン"]
    "/jmo": ["お", "こ", "ご", "そ", "ぞ", "と", "ど", "の", "ほ", "ぼ", "ぽ", "も", "ろ", "を", "オ", "コ", "ゴ", "ソ", "ゾ", "ト", "ド", "ノ", "ホ", "ボ", "ポ", "モ", "ロ", "ヲ"]
    "/jmp": ["ぱ", "ぴ", "ぷ", "ぺ", "ぽ", "パ", "ピ", "プ", "ペ", "ポ"]
    "/jmq": ["㋐", "㋑", "㋒", "㋓", "㋔", "㋕", "㋖", "㋗", "㋘", "㋙", "㋚", "㋛", "㋜", "㋝", "㋞", "㋟", "㋠", "㋡", "㋢", "㋣", "㋤", "㋥", "㋦", "㋧", "㋨", "㋩", "㋪", "㋫", "㋬", "㋭", "㋮", "㋯", "㋰", "㋱", "㋲", "㋳", "㋴", "㋵", "㋶", "㋷", "㋸", "㋹", "㋺", "㋻", "㋼", "㋽", "㋾"]
    "/jmr": ["ら", "り", "る", "れ", "ろ", "ラ", "リ", "ル", "レ", "ロ"]
    "/jms": ["さ", "し", "す", "せ", "そ", "サ", "シ", "ス", "セ", "ソ"]
    "/jmt": ["た", "ち", "つ", "っ", "て", "と", "タ", "チ", "ツ", "ッ", "テ", "ト"]
    "/jmu": ["う", "く", "ぐ", "す", "ず", "つ", "づ", "ぬ", "ふ", "ぶ", "ぷ", "む", "る", "ウ", "ク", "グ", "ス", "ズ", "ツ", "ヅ", "ヌ", "フ", "ブ", "プ", "ム", "ル"]
    "/jmw": ["わ", "ゐ", "ゑ", "を", "ワ", "ヰ", "ヱ", "ヲ"]
    "/jmy": ["や", "ゃ", "ゆ", "ゅ", "よ", "ょ", "ヤ", "ャ", "ユ", "ュ", "ヨ", "ョ"]
    "/jmz": ["ざ", "じ", "ず", "ぜ", "ぞ", "ザ", "ジ", "ズ", "ゼ", "ゾ"]
    "/jq": ["立春", "雨水", "驚蟄", "春分", "清明", "穀雨", "立夏", "小滿", "芒種", "夏至", "小暑", "大暑", "立秋", "處暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至", "小寒", "大寒"]
    "/jt": ["↑", "↓", "←", "→", "↕", "↔", "↖", "↗", "↙", "↘", "↚", "↛", "↮", "↜", "↝", "↞", "↟", "↠", "↡", "↢", "↣", "↤", "↥", "↦", "↧", "↨", "↩", "↪", "↫", "↬", "↭", "↯", "↰", "↱", "↲", "↳", "↴", "↵", "↶", "↷", "↸", "↹", "↺", "↻", "↼", "↽", "↾", "↿", "⇀", "⇁", "⇂", "⇃", "⇄", "⇅", "⇆", "⇇", "⇈", "⇉", "⇊", "⇋", "⇌", "⇐", "⇍", "⇑", "⇒", "⇏", "⇓", "⇔", "⇎", "⇕", "⇖", "⇗", "⇘", "⇙", "⇚", "⇛", "⇜", "⇝", "⇞", "⇟", "⇠", "⇡", "⇢", "⇣", "⇤", "⇥", "⇦", "⇧", "⇨", "⇩", "⇪", "⇫", "⇬", "⇭", "⇮", "⇯", "⇰", "⇱", "⇲", "⇳", "⇴", "⇵", "⇶", "⇷", "⇸", "⇹", "⇺", "⇻", "⇼", "⇽", "➔", "➘", "➙", "➚", "➛", "➜", "➝", "➞", "➟", "➠", "➡", "➢", "➣", "➤", "➥", "➦", "➧", "➨", "➩", "➪", "➫", "➬", "➭", "➮", "➱", "➲", "➳", "➴", "➵", "➶", "➷", "➸", "➹", "➺", "➻", "➼", "➽", "➾"]
    "/k": ["ḱ", "ǩ", "ₖ", "ᵏ", "ꝁ", "ꝃ", "ꞣ", "ꝅ", "ķ", "ḵ", "ḳ", "ƙ", "ᶄ", "ⱪ", "ʞ", "ĸ"]
    "/kx": ["一", "丨", "丶", "丿", "乙", "亅", "二", "亠", "人", "儿", "入", "八", "冂", "冖", "冫", "几", "凵", "刀", "力", "勹", "匕", "匚", "匸", "十", "卜", "卩", "厂", "厶", "又", "口", "囗", "土", "士", "夂", "夊", "夕", "大", "女", "子", "宀", "寸", "小", "尢", "尸", "屮", "山", "巛", "工", "己", "巾", "干", "幺", "广", "廴", "廾", "弋", "弓", "彐", "彡", "彳", "心", "戈", "戶", "手", "支", "攴", "文", "斗", "斤", "方", "无", "日", "曰", "月", "木", "欠", "止", "歹", "殳", "毋", "比", "毛", "氏", "气", "水", "火", "爪", "父", "爻", "爿", "片", "牙", "牛", "犬", "玄", "玉", "瓜", "瓦", "甘", "生", "用", "田", "疋", "疒", "癶", "白", "皮", "皿", "目", "矛", "矢", "石", "示", "禸", "禾", "穴", "立", "竹", "米", "糸", "缶", "网", "羊", "羽", "老", "而", "耒", "耳", "聿", "肉", "臣", "自", "至", "臼", "舌", "舛", "舟", "艮", "色", "艸", "虍", "虫", "血", "行", "衣", "襾", "見", "角", "言", "谷", "豆", "豕", "豸", "貝", "赤", "走", "足", "身", "車", "辛", "辰", "辵", "邑", "酉", "釆", "里", "金", "長", "門", "阜", "隶", "隹", "雨", "靑", "非", "面", "革", "韋", "韭", "音", "頁", "風", "飛", "食", "首", "香", "馬", "骨", "高", "髟", "鬥", "鬯", "鬲", "鬼", "魚", "鳥", "鹵", "鹿", "麥", "麻", "黃", "黍", "黑", "黹", "黽", "鼎", "鼓", "鼠", "鼻", "齊", "齒", "龍", "龜", "龠"]
    "/l": ["ĺ", "ˡ", "ł", "ꝉ", "ƚ", "ⱡ", "ɫ", "ꭞ", "ꬸ", "ɬ", "ľ", "ļ", "ḻ", "ḽ", "ḷ", "ŀ", "ꝲ", "ƛ", "ᶅ", "ᶪ", "ɭ", "ᶩ", "ḹ", "ꬷ", "ꭝ", "ꬹ", "ȴ", "ꝇ"]
    "/lj": ["ǉ"]
    "/ll": ["ỻ"]
    "/lm": ["ⅰ", "ⅱ", "ⅲ", "ⅳ", "ⅴ", "ⅵ", "ⅶ", "ⅷ", "ⅸ", "ⅹ", "ⅺ", "ⅻ", "ⅼ", "ⅽ", "ⅾ", "ⅿ"]
    "/lmd": ["Ⅰ", "Ⅱ", "Ⅲ", "Ⅳ", "Ⅴ", "Ⅵ", "Ⅶ", "Ⅷ", "Ⅸ", "Ⅹ", "Ⅺ", "Ⅻ", "Ⅼ", "Ⅽ", "Ⅾ", "Ⅿ"]
    "/ls": ["ʪ"]
    "/lssg": ["䷀", "䷁", "䷂", "䷃", "䷄", "䷅", "䷆", "䷇", "䷈", "䷉", "䷊", "䷋", "䷌", "䷍", "䷎", "䷏", "䷐", "䷑", "䷒", "䷓", "䷔", "䷕", "䷖", "䷗", "䷘", "䷙", "䷚", "䷛", "䷜", "䷝", "䷞", "䷟", "䷠", "䷡", "䷢", "䷣", "䷤", "䷥", "䷦", "䷧", "䷨", "䷩", "䷪", "䷫", "䷬", "䷭", "䷮", "䷯", "䷰", "䷱", "䷲", "䷳", "䷴", "䷵", "䷶", "䷷", "䷸", "䷹", "䷺", "䷻", "䷼", "䷽", "䷾", "䷿"]
    "/lssgm": ["乾", "坤", "屯", "蒙", "需", "訟", "師", "比", "小畜", "履", "泰", "否", "同人", "大有", "謙", "豫", "隨", "蠱", "臨", "觀", "噬嗑", "賁", "剝", "復", "无妄", "大畜", "頤", "大過", "坎", "離", "咸", "恆", "遯", "大壯", "晉", "明夷", "家人", "睽", "蹇", "解", "損", "益", "夬", "姤", "萃", "升", "困", "井", "革", "鼎", "震", "艮", "漸", "歸妹", "豐", "旅", "巽", "兌", "渙", "節", "中孚", "小過", "既濟", "未濟"]
    "/lx": ["♂", "♀", "⚢", "⚣", "⚤", "⚥", "⚦", "⚧", "⚨", "⚩", "⚪", "⚫", "⚬", "⚭", "⚮", "⚯"]
    "/lz": ["ʫ", "ɮ"]
    "/m": ["ḿ", "ṁ", "ᵐ", "ₘ", "ṃ", "ᵯ", "ɱ", "ᶬ", "ꬺ", "ᶆ", "ꝳ", "ɯ", "ᵚ", "ɰ", "ᶭ", "ᴟ"]
    "/mj": ["🀀", "🀁", "🀂", "🀃", "🀄", "🀅", "🀆", "🀇", "🀈", "🀉", "🀊", "🀋", "🀌", "🀍", "🀎", "🀏", "🀐", "🀑", "🀒", "🀓", "🀔", "🀕", "🀖", "🀗", "🀘", "🀙", "🀚", "🀛", "🀜", "🀝", "🀞", "🀟", "🀠", "🀡", "🀢", "🀣", "🀤", "🀥", "🀦", "🀧", "🀨", "🀩", "🀪", "🀫"]
    "/n": ["ń", "ň", "ǹ", "ṅ", "ñ", "ₙ", "ⁿ", "ɲ", "ᶮ", "ɳ", "ᶯ", "ȵ", "ƞ", "ŋ", "ᵑ", "ꬻ", "ꬼ", "ꝴ", "ŉ", "ꞥ", "ņ", "ṉ", "ṋ", "ṇ", "ᵰ", "ꞑ", "ᶇ"]
    "/nj": ["ǌ"]
    "/o": ["ō", "ó", "ő", "ǒ", "ò", "ô", "ŏ", "ȯ", "ö", "õ", "ₒ", "ᵒ", "º", "ɔ", "ᵓ", "ᶗ", "ꬿ", "ø", "ǫ", "ọ", "ơ", "ɵ", "ᶱ", "ᴑ", "ᴒ", "ᴓ", "ꝋ", "ꝍ", "ṓ", "ṑ", "ố", "ồ", "ỗ", "ổ", "ȱ", "ȫ", "ȭ", "ṍ", "ṏ", "ộ", "ǭ", "ǿ", "ớ", "ờ", "ỡ", "ở", "ợ", "ɷ", "ⱺ", "ᴖ", "ᵔ", "ᴗ", "ᵕ"]
    "/oe": ["œ", "ᴔ"]
    "/oi": ["ƣ"]
    "/oo": ["ꝏ"]
    "/ou": ["ȣ"]
    "/p": ["ṕ", "ṗ", "ᵖ", "ᵽ", "ꝑ", "ᵱ", "ƥ", "ᶈ", "ꝓ", "ꝕ", "ɸ", "ᶲ", "ⱷ"]
    "/pjm": ["ア", "ァ", "イ", "ィ", "ウ", "ゥ", "エ", "ェ", "オ", "ォ", "カ", "ヵ", "ガ", "キ", "ギ", "ク", "グ", "ケ", "ヶ", "ゲ", "コ", "ゴ", "サ", "ザ", "シ", "ジ", "ス", "ズ", "セ", "ゼ", "ソ", "ゾ", "タ", "ダ", "チ", "ヂ", "ツ", "ッ", "ヅ", "テ", "デ", "ト", "ド", "ナ", "ニ", "ヌ", "ネ", "ノ", "ハ", "バ", "パ", "ヒ", "ビ", "ピ", "フ", "ブ", "プ", "ヘ", "ベ", "ペ", "ホ", "ボ", "ポ", "マ", "ミ", "ム", "メ", "モ", "ヤ", "ャ", "ユ", "ュ", "ヨ", "ョ", "ラ", "リ", "ル", "レ", "ロ", "ワ", "ヮ", "ヰ", "ヸ", "ヴ", "ヱ", "ヹ", "ヲ", "ヺ", "ン", "・", "ー", "ヽ", "ヾ", "ヿ", "ㇰ", "ㇱ", "ㇲ", "ㇳ", "ㇴ", "ㇵ", "ㇶ", "ㇷ", "ㇸ", "ㇹ", "ㇺ", "ㇻ", "ㇼ", "ㇽ", "ㇾ", "ㇿ"]
    "/pk": ["♠", "♥", "♣", "♦", "♤", "♡", "♧", "♢"]
    "/pp": ["乛", "冫", "丷", "龹", "⺌", "龸", "亻", "亼", "亽", "仒", "冖", "冂", "冃", "冄", "宀", "罒", "㓁", "罓", "冈", "凵", "厶", "刂", "勹", "匚", "匸", "卩", "阝", "厂", "丆", "广", "壬", "訁", "讠", "釒", "钅", "飠", "饣", "龺", "攵", "夂", "夊", "尢", "尣", "兂", "旡", "巜", "巛", "彐", "彑", "彡", "彳", "龰", "辶", "廴", "㞢", "忄", "㣺", "扌", "爫", "龵", "廾", "歺", "癶", "氵", "氺", "火", "灬", "爿", "丬", "疒", "牜", "⺶", "犭", "豕", "豸", "虍", "艹", "卝", "龷", "丗", "龶", "芈", "丵", "菐", "黹", "礻", "衤", "糸", "糹", "纟", "龻", "镸", "髟", "襾", "覀", "吅", "㗊", "㠭", "㸚", "叕"]
    "/py": ["ā", "á", "ǎ", "à", "ō", "ó", "ǒ", "ò", "ê", "ê̄", "ế", "ê̌", "ề", "ē", "é", "ě", "è", "ī", "í", "ǐ", "ì", "ū", "ú", "ǔ", "ù", "ü", "ǖ", "ǘ", "ǚ", "ǜ", "ḿ", "m̀", "ń", "ň", "ǹ", "ẑ", "ĉ", "ŝ", "ŋ"]
    "/pyd": ["Ā", "Á", "Ǎ", "À", "Ō", "Ó", "Ǒ", "Ò", "Ê", "Ê̄", "Ế", "Ê̌", "Ề", "Ē", "É", "Ě", "È", "Ī", "Í", "Ǐ", "Ì", "Ū", "Ú", "Ǔ", "Ù", "Ü", "Ǖ", "Ǘ", "Ǚ", "Ǜ", "Ḿ", "M̀", "Ń", "Ň", "Ǹ", "Ẑ", "Ĉ", "Ŝ", "Ŋ"]
    "/q": ["ɋ", "ꝗ", "ꝙ", "ʠ"]
    "/qp": ["ȹ"]
    "/r": ["ŕ", "ř", "ȑ", "ȓ", "ṙ", "ᵣ", "ɍ", "ꞧ", "ᵲ", "ŗ", "ṟ", "ṛ", "ṝ", "ᵳ", "ɽ", "ᶉ", "ꭇ", "ꭈ", "ꭊ", "ꭉ", "ꝵ", "ꭋ", "ꭌ", "ɹ", "ʴ", "ɺ", "ɻ", "ʵ", "ⱹ", "ɼ", "ʳ", "ɾ", "ɿ", "ꝛ", "ꝝ"]
    "/rq": ["㏠", "㏡", "㏢", "㏣", "㏤", "㏥", "㏦", "㏧", "㏨", "㏩", "㏪", "㏫", "㏬", "㏭", "㏮", "㏯", "㏰", "㏱", "㏲", "㏳", "㏴", "㏵", "㏶", "㏷", "㏸", "㏹", "㏺", "㏻", "㏼", "㏽", "㏾"]
    "/s": ["ś", "ŝ", "š", "ṡ", "ˢ", "ʂ", "ᶳ", "ᵴ", "ꞩ", "ᶊ", "ş", "ṣ", "ș", "ȿ", "ṥ", "ṧ", "ṩ", "ʃ", "ᶴ", "ʆ", "ᶘ", "ʅ", "ƪ", "ß", "ſ", "ẛ", "ẜ", "ẝ"]
    "/sb": ["⁰", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹", "˜", "⁺", "⁻", "⁼", "⁽", "⁾", "ᴬ", "ᵃ", "ᵄ", "ᵅ", "ᶛ", "ᴭ", "ᵆ", "ᴮ", "ᴯ", "ᵇ", "ᵝ", "ᶜ", "ᵓ", "ᶝ", "ᴰ", "ᵈ", "ᶞ", "ᵟ", "ᴱ", "ᵉ", "ᴲ", "ᵊ", "ᵋ", "ᶟ", "ᵌ", "ᶠ", "ᶡ", "ᶲ", "ᵠ", "ᴳ", "ᵍ", "ᶢ", "ˠ", "ᵞ", "ᴴ", "ʰ", "ᶣ", "ʱ", "ᴵ", "ⁱ", "ᶤ", "ᵎ", "ᶥ", "ᴶ", "ʲ", "ᶨ", "ᴷ", "ᵏ", "ᴸ", "ᶫ", "ˡ", "ᶩ", "ᶪ", "ᴹ", "ᵐ", "ᶬ", "ᵚ", "ᶭ", "ᴺ", "ᴻ", "ⁿ", "ᵑ", "ᶮ", "ᶯ", "ᴼ", "ᵒ", "ᶱ", "ᴽ", "ᴾ", "ᵖ", "ᴿ", "ʳ", "ʶ", "ʴ", "ʵ", "ˢ", "ᶴ", "ᶳ", "ᵀ", "ᵗ", "ᶵ", "ᶿ", "ᵁ", "ᵘ", "ᶶ", "ᶷ", "ᵙ", "ⱽ", "ᵛ", "ᶺ", "ᶹ", "ᵂ", "ʷ", "ˣ", "ᵡ", "ʸ", "ᶻ", "ᶾ", "ᶽ", "ᶼ"]
    "/sd": ["ˉ", "ˊ", "ˇ", "ˋ", "ˆ", "˙", "˜", "˥", "˦", "˧", "˨", "˩", "꜀", "꜁", "꜂", "꜃", "꜄", "꜅", "꜆", "꜇", "〪", "〫", "〬", "〭"]
    "/seg": ["白羊宮", "金牛宮", "雙子宮", "巨蟹宮", "獅子宮", "室女宮", "天秤宮", "天蠍宮", "人馬宮", "摩羯宮", "寶瓶宮", "雙魚宮"]
    "/sj": ["㍘", "㍙", "㍚", "㍛", "㍜", "㍝", "㍞", "㍟", "㍠", "㍡", "㍢", "㍣", "㍤", "㍥", "㍦", "㍧", "㍨", "㍩", "㍪", "㍫", "㍬", "㍭", "㍮", "㍯", "㍰"]
    "/sx": ["±", "÷", "×", "∈", "∏", "∑", "－", "＋", "＜", "≮", "＝", "≠", "＞", "≯", "∕", "√", "∝", "∞", "⟨", "⟩", "∟", "∠", "∥", "∧", "∨", "∩", "∪", "∫", "∮", "∴", "∵", "∷", "∽", "≈", "≌", "≒", "≡", "≤", "≥", "≦", "≧", "⊕", "⊙", "⊥", "⊿", "㏑", "㏒"]
    "/sz": ["⚀", "⚁", "⚂", "⚃", "⚄", "⚅"]
    "/szd": ["⒈", "⒉", "⒊", "⒋", "⒌", "⒍", "⒎", "⒏", "⒐", "⒑", "⒒", "⒓", "⒔", "⒕", "⒖", "⒗", "⒘", "⒙", "⒚", "⒛"]
    "/szh": ["⑴", "⑵", "⑶", "⑷", "⑸", "⑹", "⑺", "⑻", "⑼", "⑽", "⑾", "⑿", "⒀", "⒁", "⒂", "⒃", "⒄", "⒅", "⒆", "⒇"]
    "/szm": ["〡", "〢", "〣", "〤", "〥", "〦", "〧", "〨", "〩", "〸", "〹", "〺"]
    "/szq": ["⓪", "①", "②", "③", "④", "⑤", "⑥", "⑦", "⑧", "⑨", "⑩", "⑪", "⑫", "⑬", "⑭", "⑮", "⑯", "⑰", "⑱", "⑲", "⑳", "㉑", "㉒", "㉓", "㉔", "㉕", "㉖", "㉗", "㉘", "㉙", "㉚", "㉛", "㉜", "㉝", "㉞", "㉟", "㊱", "㊲", "㊳", "㊴", "㊵", "㊶", "㊷", "㊸", "㊹", "㊺", "㊻", "㊼", "㊽", "㊾", "㊿", "⓿", "❶", "❷", "❸", "❹", "❺", "❻", "❼", "❽", "❾", "❿", "⓫", "⓬", "⓭", "⓮", "⓯", "⓰", "⓱", "⓲", "⓳", "⓴"]
    "/t": ["ť", "ṫ", "ẗ", "ᵗ", "ₜ", "ʈ", "þ", "ꝥ", "ꝧ", "ŧ", "ⱦ", "ţ", "ṯ", "ṱ", "ṭ", "ț", "ƭ", "ᵵ", "ƫ", "ᶵ", "ʇ", "ȶ", "ꝷ"]
    "/tc": ["ʨ"]
    "/tg": ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"]
    "/th": ["ᵺ"]
    "/tq": ["☀", "☁", "⛅", "⛈", "⛆", "☂", "☔", "☃", "⛄", "⛇"]
    "/ts": ["ʦ", "ʧ"]
    "/tt": ["☄", "☼", "☽", "☾", "☿", "♀", "♁", "♂", "♃", "♄", "♅", "♆", "♇"]
    "/txj": ["⚊", "⚋", "⚌", "⚍", "⚎", "⚏", "𝌀", "𝌁", "𝌂", "𝌃", "𝌄", "𝌅", "𝌆", "𝌇", "𝌈", "𝌉", "𝌊", "𝌋", "𝌌", "𝌍", "𝌎", "𝌏", "𝌐", "𝌑", "𝌒", "𝌓", "𝌔", "𝌕", "𝌖", "𝌗", "𝌘", "𝌙", "𝌚", "𝌛", "𝌜", "𝌝", "𝌞", "𝌟", "𝌠", "𝌡", "𝌢", "𝌣", "𝌤", "𝌥", "𝌦", "𝌧", "𝌨", "𝌩", "𝌪", "𝌫", "𝌬", "𝌭", "𝌮", "𝌯", "𝌰", "𝌱", "𝌲", "𝌳", "𝌴", "𝌵", "𝌶", "𝌷", "𝌸", "𝌹", "𝌺", "𝌻", "𝌼", "𝌽", "𝌾", "𝌿", "𝍀", "𝍁", "𝍂", "𝍃", "𝍄", "𝍅", "𝍆", "𝍇", "𝍈", "𝍉", "𝍊", "𝍋", "𝍌", "𝍍", "𝍎", "𝍏", "𝍐", "𝍑", "𝍒", "𝍓", "𝍔", "𝍕", "𝍖"]
    "/tz": ["ꜩ"]
    "/u": ["ū", "ú", "ű", "ǔ", "ù", "ȕ", "û", "ŭ", "ȗ", "ü", "ǖ", "ǘ", "ǚ", "ǜ", "ů", "ũ", "ᵤ", "ᵘ", "ʉ", "ᶶ", "ủ", "ų", "ṷ", "ụ", "ṳ", "ṵ", "ư", "ʊ", "ᶷ", "ᵿ", "ᶙ", "ṻ", "ṹ", "ứ", "ừ", "ữ", "ử", "ự", "ꭒ", "ꭟ", "ꝸ", "ꭎ", "ꭏ", "ᴝ", "ᵙ", "ᴞ"]
    "/ue": ["ᵫ"]
    "/v": ["ü", "ǖ", "ǘ", "ǚ", "ǜ", "ṽ", "ᵛ", "ᵥ", "ṿ", "ꝟ", "ʋ", "ᶹ", "ᶌ", "ⱴ", "ⱱ", "ỽ", "ʌ", "ᶺ"]
    "/vy": ["ꝡ"]
    "/w": ["ẃ", "ẁ", "ŵ", "ẇ", "ẅ", "ẘ", "ʷ", "ẉ", "ƿ", "ʍ", "ⱳ"]
    "/ww": ["ʬ"]
    "/x": ["ẋ", "ẍ", "ᶍ", "ˣ", "ₓ", "ꭖ", "ꭗ", "ꭘ", "ꭙ"]
    "/xb": ["₀", "₁", "₂", "₃", "₄", "₅", "₆", "₇", "₈", "₉", "₊", "₋", "₌", "₍", "₎", "‸", "ᴀ", "ₐ", "ᴁ", "ʙ", "ᴃ", "ᵦ", "ᴄ", "ᴐ", "ᴒ", "ᴅ", "ᴆ", "ᴇ", "ₑ", "ₔ", "ᵩ", "ɢ", "ʛ", "ᴦ", "ᵧ", "ʜ", "ₕ", "ɪ", "ᵻ", "ᵢ", "ᴊ", "ⱼ", "ᴋ", "ₖ", "ʟ", "ₗ", "ᴌ", "ᴧ", "ᴍ", "ₘ", "ꟺ", "ɴ", "ᴎ", "ₙ", "ᴏ", "ₒ", "ɶ", "ʘ", "ᴓ", "ᴑ", "ᴘ", "ₚ", "ᴨ", "ᴪ", "ʀ", "ᵣ", "ᴙ", "ʁ", "ᴚ", "ᵨ", "ₛ", "ᴛ", "ₜ", "ᴜ", "ᵤ", "ᵾ", "ᴠ", "ᵥ", "ᴡ", "ₓ", "ᵪ", "ʏ", "ᴢ", "ᴣ"]
    "/xh": ["★", "☆", "⛤", "⛥", "⛦", "⛧", "✡", "❋", "❊", "❉", "❈", "❇", "❆", "❅", "❄", "❃", "❂", "❁", "❀", "✿", "✾", "✽", "✼", "✻", "✺", "✹", "✸", "✷", "✶", "✵", "✴", "✳", "✲", "✱", "✰", "✯", "✮", "✭", "✬", "✫", "✪", "✩", "✧", "✦", "✥", "✤", "✣", "✢"]
    "/xl": ["α", "β", "γ", "δ", "ε", "ζ", "η", "θ", "ι", "κ", "λ", "μ", "ν", "ξ", "ο", "π", "ρ", "σ", "ς", "τ", "υ", "φ", "χ", "ψ", "ω"]
    "/xld": ["Α", "Β", "Γ", "Δ", "Ε", "Ζ", "Η", "Θ", "Ι", "Κ", "Λ", "Μ", "Ν", "Ξ", "Ο", "Π", "Ρ", "Σ", "Τ", "Υ", "Φ", "Χ", "Ψ", "Ω"]
    "/xq": ["♔", "♕", "♖", "♗", "♘", "♙", "♚", "♛", "♜", "♝", "♞", "♟"]
    "/xz": ["♈", "♉", "♊", "♋", "♌", "♍", "♎", "♏", "♐", "♑", "♒", "♓"]
    "/xzm": ["白羊座", "金牛座", "雙子座", "巨蟹座", "獅子座", "室女座", "天秤座", "天蠍座", "人馬座", "摩羯座", "寶瓶座", "雙魚座"]
    "/y": ["ȳ", "ý", "ỳ", "ŷ", "ẏ", "ÿ", "ẙ", "ỹ", "ʸ", "ɏ", "ỷ", "ỵ", "ƴ", "ʎ", "ỿ", "ꭚ"]
    "/yf": ["㋀", "㋁", "㋂", "㋃", "㋄", "㋅", "㋆", "㋇", "㋈", "㋉", "㋊", "㋋"]
    "/yr": ["月", "火", "水", "木", "金", "土", "日", "㊊", "㊋", "㊌", "㊍", "㊎", "㊏", "㊐", "㊗", "㊡", "㈪", "㈫", "㈬", "㈭", "㈮", "㈯", "㈰", "㈷", "㉁", "㉀"]
    "/yy": ["𝄞", "♩", "♪", "♫", "♬", "♭", "♮", "♯"]
    "/z": ["ź", "ž", "ẑ", "ż", "ᶻ", "ʐ", "ᶼ", "ʑ", "ᶽ", "ƶ", "ẕ", "ẓ", "ᵶ", "ȥ", "ⱬ", "ᶎ", "ʒ", "ᶾ", "ǯ", "ʓ", "ƹ", "ƺ", "ᶚ", "θ", "ᶿ", "ɀ", "ꝣ"]
    "/zmh": ["⒜", "⒝", "⒞", "⒟", "⒠", "⒡", "⒢", "⒣", "⒤", "⒥", "⒦", "⒧", "⒨", "⒩", "⒪", "⒫", "⒬", "⒭", "⒮", "⒯", "⒰", "⒱", "⒲", "⒳", "⒴", "⒵"]
    "/zmq": ["ⓐ", "Ⓐ", "ⓑ", "Ⓑ", "ⓒ", "Ⓒ", "ⓓ", "Ⓓ", "ⓔ", "Ⓔ", "ⓕ", "Ⓕ", "ⓖ", "Ⓖ", "ⓗ", "Ⓗ", "ⓘ", "Ⓘ", "ⓙ", "Ⓙ", "ⓚ", "Ⓚ", "ⓛ", "Ⓛ", "ⓜ", "Ⓜ", "ⓝ", "Ⓝ", "ⓞ", "Ⓞ", "ⓟ", "Ⓟ", "ⓠ", "Ⓠ", "ⓡ", "Ⓡ", "ⓢ", "Ⓢ", "ⓣ", "Ⓣ", "ⓤ", "Ⓤ", "ⓥ", "Ⓥ", "ⓦ", "Ⓦ", "ⓧ", "Ⓧ", "ⓨ", "Ⓨ", "ⓩ", "Ⓩ"]
    "/zy": ["ㄅ", "ㄆ", "ㄇ", "ㄈ", "ㄉ", "ㄊ", "ㄋ", "ㄌ", "ㄍ", "ㄎ", "ㄏ", "ㄐ", "ㄑ", "ㄒ", "ㄓ", "ㄔ", "ㄕ", "ㄖ", "ㄗ", "ㄘ", "ㄙ", "ㄧ", "ㄨ", "ㄩ", "ㄚ", "ㄛ", "ㄜ", "ㄝ", "ㄞ", "ㄟ", "ㄠ", "ㄡ", "ㄢ", "ㄣ", "ㄤ", "ㄥ", "ㄦ", "ㄪ", "ㄫ", "ㄬ", "ㄭ", "ㆠ", "ㆡ", "ㆢ", "ㆣ", "ㆤ", "ㆥ", "ㆦ", "ㆧ", "ㆨ", "ㆩ", "ㆪ", "ㆫ", "ㆬ", "ㆭ", "ㆮ", "ㆯ", "ㆰ", "ㆱ", "ㆲ", "ㆳ", "ㆴ", "ㆵ", "ㆶ", "ㆷ"]
recognizer:
  import_preset: default
  patterns:
    email: "^[A-Za-z][-_.0-9A-Za-z]*@.*$"
    punct: "^/([0-9]0?|[A-Za-z]+)$"
    reverse_lookup: "`[a-z]*'?$"
    uppercase: "[A-Z][-_+.'0-9A-Za-z]*$"
    url: "^(www[.]|https?:|ftp[.:]|mailto:|file:).*$|^[a-z]+[.].+$"
reverse_lookup:
  comment_format:
    - "xform/([nl])v/$1ü/"
  dictionary: stroke
  enable_completion: true
  preedit_format:
    - "xlit/hspnz/一丨丿丶乙/"
  prefix: "`"
  suffix: "'"
  tips: "〔筆畫〕"
schema:
  author:
    - "佛振 <chen.sst@gmail.com>"
  dependencies:
    - stroke
  description: |
    Rime 預設的拼音輸入方案。
    參考以下作品而創作：
      * CC-CEDICT
      * Android open source project
      * Chewing - 新酷音
      * opencc - 開放中文轉換

  name: "朙月拼音"
  schema_id: luna_pinyin
  version: 0.26
speller:
  algebra:
    - "abbrev/^([a-z]).+$/$1/"
    - "abbrev/^([zcs]h).+$/$1/"
    - "derive/^([nl])ve$/$1ue/"
    - "derive/^([jqxy])u/$1v/"
    - "derive/un$/uen/"
    - "derive/ui$/uei/"
    - "derive/iu$/iou/"
    - "derive/([aeiou])ng$/$1gn/"
    - "derive/([dtngkhrzcs])o(u|ng)$/$1o/"
    - "derive/ong$/on/"
    - "derive/ao$/oa/"
    - "derive/([iu])a(o|ng?)$/a$1$2/"
  alphabet: zyxwvutsrqponmlkjihgfedcba
  delimiter: " '"
switches:
  - name: ascii_mode
    reset: 0
    states: ["中文", "西文"]
  - name: full_shape
    states: ["半角", "全角"]
  - name: simplification
    states: ["漢字", "汉字"]
  - name: ascii_punct
    states: ["。，", "．，"]
translator:
  dictionary: luna_pinyin
  preedit_format:
    - "xform/([nl])v/$1ü/"
    - "xform/([nl])ue/$1üe/"
    - "xform/([jqxy])v/$1u/"
```

# Rime 配置文件

- [Rime 配置文件](#rime-配置文件)
  - [文件格式](#文件格式)
  - [位置及組織方式](#位置及組織方式)
  - [語法](#語法)
    - [包含](#包含)
    - [補靪](#補靪)
    - [用補靪指令修改列表](#用補靪指令修改列表)
    - [可選的包含與補靪](#可選的包含與補靪)
    - [追加與合併](#追加與合併)
  - [配置編譯器插件](#配置編譯器插件)
    - [自動應用補靪](#自動應用補靪)
    - [應用默認配置](#應用默認配置)
    - [導入成套組件配置](#導入成套組件配置)
    - [導入韻書配置](#導入韻書配置)
  - [加載規則](#加載規則)
  - [配置組件調用方式](#配置組件調用方式)
  - [代碼風格](#代碼風格)
  - [錯誤處理](#錯誤處理)
  - [版本控制](#版本控制)
  - [分發](#分發)


Rime 配置文件，用於設置輸入法引擎、輸入法客戶端的運行參數，也包括輸入方案及詞典配置。

## 文件格式

採用 UTF-8 編碼的 [YAML][] 文本。

  [YAML]: http://yaml.org/

## 位置及組織方式

Rime 所使用的配置文件在 [[用戶文件夾|UserData]] 及 [[共享文件夾|SharedData]]。

## 語法

在 [YAML][] 語法的基礎上，增設以下編譯指令：

### 包含

`__include:` 指令在當前位置包含另一 YAML 節點的內容。

可寫在配置源文件任一 YAML map 節點下。其語法爲

```yaml
include_example_1:
  __include: local/node

local:
  node: contents to include
```

被引用的節點可以來自另一個配置文件。
目標配置節點的路徑以 `<filename>:/` 開始，可省略擴展名 `.yaml`。

```yaml
include_example_2:
  __include: config:/external/node

include_example_3:
  __include: config.yaml:/external/node
```

包含整個文件，可指定路徑爲目標配置文件的根節點：

```yaml
include_example_4:
  __include: config.yaml:/
```

包含另一個 YAML map 節點後，源文件中 `__include:` 指令所在 map 除編譯指令外的其他數據與被包含的 map 合併：

```yaml
include_example_5:
  __include: some_map
  occupation: journalist # new key and value
  simplicity: very # override value for included key

some_map:
  simplicity: somewhat
  naivety: sometimes
```

合併發生在 `__include:` 指令所在節點，不會修改被引用節點 `some_map` 的內容。

包含 YAML 列表，則指令所在 map 節點替換爲所引用的 YAML 列表。
該 map 節點不應包含任何編譯指令以外的 key-value，因爲不相容於 YAML 列表類型。

也不能直接在該節點下追加列表項，因爲 YAML 語法不允許混合 map 與 list。
在包含列表後追加、修改列表項，必須使用下文介紹的 `__append:` 或 `__patch:` 指令。

```yaml
include_example_6:
  __include: some_list
  __append:
    - someone else

some_list:
  - youngster
  - elder
```

### 補靪

修改某一相對路徑下的配置節點，而非當前節點的整體。
基本語法爲：

```yaml
__patch:
  key/alpha: value A
  key/beta: value B
```

目標節點路徑的寫法爲將各級 map 的 key 用 `/` 分隔。
因此 `key` 如果包含 `/` 字符，則不能作爲節點路徑的一部分。

可在節點路徑末尾添加 `/+` 操作符，表示合併 list 或 map 節點；
或者（可選地）添加 `/=` 表示用指定的值替換目標節點原有的值。
若未指定操作符，`__patch:` 指令的默認操作爲替換。

以下是一些示例：

```yaml
patch_example_1:
  sibling: old value
  append_to_list:
    - existing item
  merge_with_map:
    key: value
  replace_list:
    - item 1
    - item 2
  replace_map:
    a: value
    b: value
  __patch:
    sibling: new value
    append_to_list/+:
      - appended item
    merge_with_map/+:
      key: new value
      new_key: value
    replace_list/=:
      - only item
    replace_map/=:
      only_key: value
```

以上示例僅爲表現 `__patch:` 的作用方式。
實際上在當前節點和補靪內容均爲字面值的情況下，沒有打補靪的必要。
字面值補靪通常用於當前節點包含了其他節點，並需要修改部份配置項的場景：

```yaml
patch_example_2:
  __include: patch_example_1
  __patch:
    sibling: even newer value
    append_to_list/+:
      - another appended item
```

由於 YAML map 的 key 是無序的，書寫順序並不決定編譯指令的先後。

同一節點下，編譯指令的執行順序爲：
`__include:` 包含指定節點 → 合併當前節點下的其他 key-value 數據 → `__patch:` 修改子節點。

`__patch:` 指令的另一種主要用法是引用另一個節點中的補靪內容，並作用於指令所在節點：

```yaml
patch_example_3:
  __patch: changes
  some_list:
    - youngster
    - elder
  some_map:
    simplicity: somewhat
    naivety: sometimes

changes:
  some_list/+:
    - someone else
  some_map/simplicity: too much
```

YAML 語法不允許 map 有重複的 key。
如果要引用不同位置的多項補靪，可以爲 `__patch:` 指定一個列表，其中每項通過節點引用定義一組補靪：

```yaml
patch_example_4:
  __include: base_config
  __patch:
    - company_standard
    - team_convention
    - personal_preference

base_config:
  actors: []
  company_info:
    based_in: unknown location
  favorites: {}

company_standard:
  company_info/based_in: american san diego

team_convention:
  actors/+:
    - feifei
    - meimei
    - riri

personal_preference:
  favorites/fertilizer: jinkela
```

### 用補靪指令修改列表

補靪指令中，目標節點路徑由各級節點的 key 組成。
若某一節點爲 list 類型，可以 `@<下標>` 形式指定列表項。下標從 0 開始計數。
無論列表長度，末位列表元素可表示爲 `@last`。

```yaml
patch_list_example_1:
  some_list/@0/simplicity: very
  some_list/@last/naivety: always

some_list:
  - simplicity: somewhat
  - naivety: sometimes
```

在指定元素之前、之後插入列表元素，用 `@before <下標>`、`@after <下標>`。
`@after last` 可簡寫爲 `@next`，向列表末尾添加元素：

```yaml
patch_list_example_2:
  'some_list/@before 0/youthfulness': too much
  'some_list/@after last/velocity': greater than westerners
  some_list/@next/questions: no good
```

### 可選的包含與補靪

若包含或補靪指令的目標是以 `?` 結尾的節點路徑，
則當該路徑對應的節點（或所屬外部配置文件）不存在時，不產生編譯錯誤。

如：

```yaml
__patch: default.custom:/patch?

nice_to_have:
  __include: optional_config?
```

### 追加與合併

追加指令 `__append:` 將其下的列表項追加到該指令所在的節點。
合併指令 `__merge:` 將其下的 map 合併到該指令所在的節點。

這兩條指令只能用在 `__include:` 指令所在節點及其（字面值）子節點。

```yaml
append_merge_example_1:
  __include: starcraft
  __merge:
    made_by: blizzard entertainment
    races:
      __append:
        - protoss
        - zerg

starcraft:
  first_release: 1998
  races:
    - terrans
```

實際書寫配置時，`__merge:` 指令往往省略。
因爲 `__include:` 指令自動合併其所在節點下的 key-value 並遞歸地合併所有 map 類型的子節點。

而對於類型爲 list 的子節點，默認操作是替換整個列表。
如果要以向後追加列表項的方式合併，除了 `__append:` 指令之外，還可以採用 `/+` 操作符：

```yaml
append_merge_example_2:
  __include: starcraft
  made_by: blizzard entertainment
  races/+:
    - protoss
    - zerg
```

在 `__include:` 指令自動合併的節點樹中，如果要對某個 map 類型的子節點整體替換，可使用 `/=` 操作符：

```yaml
revealed_map:
  __include: old_map
  terran_command_center/=:
    x: 3.14
    y: 6.28
old_map:
  terran_command_center:
    location: unexplored
  protoss_nexus: {x: 128, y: 256}
  zerg_hatchary: {x -1024, y: 0}
```

案例解析：

- https://github.com/rime/librime/pull/192#issuecomment-371202389

## 配置編譯器插件

自動添加一些隱含的編譯指令，用來實現對原有補靪機制以及導入成套組件配置等語法的兼容。

這些插件的作用是將當前輸入方案所需的全部配置內容在部署期間彙總到一份編譯結果文件裏。使輸入法程序不必在運行時打開衆多的配置文件。

### 自動應用補靪

配置文件的根節點如果沒有使用 `__patch:` 指令，則在源文件編譯完成後，自動插入以下指令：

（註：請將實際的配置名稱代入 `<config>`）

```yaml
# <config>.yaml 或 <config>.schema.yaml 的根節點
__patch: <config>.custom:/patch?
```

如果存在與舊版本 librime 兼容的補靪文件，則從中加載補靪：

```yaml
# <config>.custom.yaml
patch:
  key: value
```

以上插件的效果相當於

```yaml
# <config>.yaml 或 <config>.schema.yaml 的根節點
__patch:
  key: value
```

如果源文件的根節點使用了 `__patch:` 指令，則不論其是否加載 `<config>.custom:/patch`，都不再添加自動補靪指令。
如果這種情況下仍希望支持補靪文件，須將其列爲 `__patch:` 列表中的一項：

```yaml
# <config>.yaml 或 <config>.schema.yaml 的根節點
__patch:
  - other_patch # ...
  - <config>.custom:/patch?
```

### 應用默認配置

輸入方案中未指定以下配置項時，自動導入默認配置 `default.yaml` 的定義：

```yaml
menu:
  page_size: # ...
```

### 導入成套組件配置

將部份組件配置中的 `<component>/import_preset: <config>` 語法翻譯爲

（註：請將實際的配置名稱和組件名稱代入 `<config>`、`<component>`）

```yaml
<component>:
  __include: <config>:/<component>
  # 以下爲輸入方案覆蓋定義的內容
```

注意：如果指定的配置節點 `<config>:/<component>` 不存在會導致輸入方案編譯錯誤。

### 導入韻書配置

（尚未實現）導入 `*.dict.yaml` 的 YAML 配置部份。

## 加載規則

以上介紹的編譯指令及編譯器插件，僅對交給 *配置編譯器* 處理的 *源文件* 有效。

配置源文件的位置詳見 [[用戶文件夾|UserData]] 及 [[共享文件夾|SharedData]]。

輸入法程序運行時讀取的配置文件是 *編譯結果文件*（可能是 YAML 格式或二進制格式）。
編譯結果只包含直接供程序讀取的配置內容，而不再包含有特殊含義的編譯指令。

配置的編譯結果文件與源文件並非一一對應的關係，
而是合併重組爲編譯後的默認配置 `default` 以及各輸入方案的配置。

其他不經過編譯處理而直接在運行時由輸入法程序存取的配置文件有：
`installation.yaml`, `user.yaml` 等。

*韻書* 文件中的 YAML 配置部份目前也不支持配置編譯指令。

TODO(rime/docs): 詳解 YAML 節點樹及編譯指令的解析、執行順序

## 配置組件調用方式

TODO(rime/engine): 完成本節

## 代碼風格

YAML 書寫樣式參照 [yaml.org][YAML] 的示例。推薦以下風格：

配置文件開頭用註釋行簡述文件的內容和使用方法。

縮進：用兩個空格縮進。

字符串值：無特殊字符時不使用引號；
需要使用引號時，優先用單引號，以減少雙引號引起的字符轉義問題。

flow-style list: 僅在節點樹的最內層使用。不嵌套使用。元素較多時不用。

flow-style map: 僅在節點樹的最內層使用。不嵌套使用。元素較多時不用。

僅包含一對 key-value 的 map 作爲列表項時，省略 `{ }` 並與 `-` 寫在同一行。

不推薦使用 YAML 的錨點（`&`）和別名引用（`*`）。請用本文介紹的 `__include:` 編譯指令。

## 錯誤處理

部署後出現錯誤，請查看 `INFO` 日誌（[參考][debug]），
找到行首字符爲 `E` 的記錄，根據錯誤信息以及上下文排查出錯的配置文件。

未出現錯誤信息，配置亦未達到預期效果，請對照 `<用戶文件夾>/build/` 文件夾內的編譯結果文件，檢查配置源文件與補靪。

  [debug]: https://github.com/rime/home/wiki/RimeWithSchemata#%E9%97%9C%E6%96%BC%E8%AA%BF%E8%A9%A6

## 版本控制

輸入方案及配置的版本可以用文件中的一項 *字符串值* 記錄。如：`version: '3.14'`

版本號習慣以形爲 `X.Y.Z` 的多個數字組成。
爲避免將版本號解析爲 YAML 數值類型而發生錯誤，如 `0.10`（〇點十）不同於 `0.1`（〇點一），
應一律爲版本號加上引號 `'3.14'` 以示其爲字符串類型。

## 分發

輸入方案設計師完成輸入方案及配套韻書後，將源文件發佈在一間 [GitHub][] 代碼庫，
用家便可通過 Rime 配置管理工具 [東風破][plum] 獲取輸入方案的最新版本並安裝到輸入法。

  [GitHub]: https://github.com
  [plum]: https://github.com/rime/plum


# Rime 定製指南

目錄
- [中州韻輸入法引擎 | Rime Input Method Engine](#中州韻輸入法引擎--rime-input-method-engine)
    - [擊出中文之韻 | Just rime with it](#擊出中文之韻--just-rime-with-it)
    - [也來瞧瞧](#也來瞧瞧)
    - [也來試試](#也來試試)
    - [也來設計](#也來設計)
    - [也來寫代碼](#也來寫代碼)
    - [純粹地喜歡？](#純粹地喜歡)
- [認識 La Rime](#認識-la-rime)
  - [自序](#自序)
    - [歷史](#歷史)
    - [概念](#概念)
    - [項目構成](#項目構成)
    - [開發計劃](#開發計劃)
- [概念解讀](#概念解讀)
  - [框架](#框架)
  - [引擎](#引擎)
- [設計與實現](#設計與實現)
  - [組件](#組件)
  - [框架級組件和基礎組件](#框架級組件和基礎組件)
    - [框架級組件](#框架級組件)
    - [基礎組件](#基礎組件)
- [說明書](#說明書)
  - [專題](#專題)
  - [第三方文檔](#第三方文檔)
  - [使用方案選單](#使用方案選單)
  - [輸入法設定](#輸入法設定)
  - [打字入門](#打字入門)
    - [選字與換頁](#選字與換頁)
    - [令輸入碼直接上屏](#令輸入碼直接上屏)
    - [使用編輯鍵](#使用編輯鍵)
    - [刪除誤上屏的錯詞](#刪除誤上屏的錯詞)
    - [Emacs 風格的編輯鍵](#emacs-風格的編輯鍵)
    - [輸入標點符號](#輸入標點符號)
    - [中西文切換](#中西文切換)
    - [繁簡字切換](#繁簡字切換)
  - [部分輸入方案的用法](#部分輸入方案的用法)
    - [朙月拼音](#朙月拼音)
    - [語句流](#語句流)
    - [雙拼](#雙拼)
    - [宮保拼音](#宮保拼音)
    - [地球拼音](#地球拼音)
    - [注音](#注音)
    - [倉頡](#倉頡)
    - [速成](#速成)
    - [五筆](#五筆)
    - [粵拼](#粵拼)
    - [吳語](#吳語)
  - [用戶詞典管理](#用戶詞典管理)
    - [命令行工具](#命令行工具)
    - [備份及合併詞典快照](#備份及合併詞典快照)
    - [導出及導入文本碼表](#導出及導入文本碼表)
    - [導入其他來源的碼表](#導入其他來源的碼表)
    - [同步用戶資料](#同步用戶資料)
      - [設定同步位置](#設定同步位置)
- [用家如是說](#用家如是說)
  - [囧丁乙](#囧丁乙)
  - [玩家點評](#玩家點評)
    - [「封铀」試玩心得](#封铀試玩心得)
    - [星際玩家點評](#星際玩家點評)
    - [十三叔點評](#十三叔點評)
  - [當心！關「鍵」時刻用錯輸入法 恐惹禍事](#當心關鍵時刻用錯輸入法-恐惹禍事)
  - [正體漢字 QQ 羣](#正體漢字-qq-羣)
  - [中州韻 QQ 羣](#中州韻-qq-羣)
  - [Quotes from a foreign user learning Chinese](#quotes-from-a-foreign-user-learning-chinese)
  - [推文裏的故事](#推文裏的故事)
  - [微博故事](#微博故事)
- [心情集](#心情集)
- [Rime\\build\\luna\_pinyin.schema.yaml 配置参考](#rimebuildluna_pinyinschemayaml-配置参考)
- [Rime 配置文件](#rime-配置文件)
  - [文件格式](#文件格式)
  - [位置及組織方式](#位置及組織方式)
  - [語法](#語法)
    - [包含](#包含)
    - [補靪](#補靪)
    - [用補靪指令修改列表](#用補靪指令修改列表)
    - [可選的包含與補靪](#可選的包含與補靪)
    - [追加與合併](#追加與合併)
  - [配置編譯器插件](#配置編譯器插件)
    - [自動應用補靪](#自動應用補靪)
    - [應用默認配置](#應用默認配置)
    - [導入成套組件配置](#導入成套組件配置)
    - [導入韻書配置](#導入韻書配置)
  - [加載規則](#加載規則)
  - [配置組件調用方式](#配置組件調用方式)
  - [代碼風格](#代碼風格)
  - [錯誤處理](#錯誤處理)
  - [版本控制](#版本控制)
  - [分發](#分發)
- [Rime 定製指南](#rime-定製指南)
  - [必知必會](#必知必會)
    - [重新佈署的操作方法](#重新佈署的操作方法)
    - [查閱 DIY 處方集](#查閱-diy-處方集)
    - [設定項速查手冊](#設定項速查手冊)
  - [定製指南](#定製指南)
    - [一例、定製每頁候選數](#一例定製每頁候選數)
    - [一例、定製標點符號](#一例定製標點符號)
    - [一例、定製簡化字輸出](#一例定製簡化字輸出)
    - [一例、默認英文輸出](#一例默認英文輸出)
    - [一例、定製方案選單](#一例定製方案選單)
    - [一例、定製喚出方案選單的快捷鍵](#一例定製喚出方案選單的快捷鍵)
    - [一例、定製【小狼毫】字體字號](#一例定製小狼毫字體字號)
    - [一例、定製【小狼毫】配色方案](#一例定製小狼毫配色方案)
  - [DIY 處方集](#diy-處方集)
    - [初始設定](#初始設定)
      - [在方案選單中添加五筆、雙拼](#在方案選單中添加五筆雙拼)
      - [【小狼毫】外觀設定](#小狼毫外觀設定)
      - [【鼠鬚管】外觀與鍵盤設定](#鼠鬚管外觀與鍵盤設定)
    - [在特定程序裏關閉中文輸入](#在特定程序裏關閉中文輸入)
    - [輸入習慣](#輸入習慣)
      - [使用Control鍵切換中西文](#使用control鍵切換中西文)
      - [方便地輸入含數字的西文用戶名](#方便地輸入含數字的西文用戶名)
      - [以方括號鍵換頁](#以方括號鍵換頁)
      - [使用西文標點兼以方括號鍵換頁](#使用西文標點兼以方括號鍵換頁)
      - [以回車鍵清除編碼兼以分號、單引號選字](#以回車鍵清除編碼兼以分號單引號選字)
      - [關閉逐鍵提示](#關閉逐鍵提示)
      - [關閉用戶詞典和字頻調整](#關閉用戶詞典和字頻調整)
      - [關閉碼表輸入法連打](#關閉碼表輸入法連打)
      - [關閉倉頡與拼音混打](#關閉倉頡與拼音混打)
      - [空碼時按空格鍵清空輸入碼](#空碼時按空格鍵清空輸入碼)
    - [模糊音](#模糊音)
      - [【朙月拼音】模糊音定製模板](#朙月拼音模糊音定製模板)
      - [【吳語】模糊音定製模板](#吳語模糊音定製模板)
    - [編碼反查](#編碼反查)
      - [設定【速成】的反查碼爲粵拼](#設定速成的反查碼爲粵拼)
      - [設定【倉頡】的反查碼爲雙拼](#設定倉頡的反查碼爲雙拼)
    - [在Mac系統上輸入emoji表情](#在mac系統上輸入emoji表情)
    - [五筆簡入繁出](#五筆簡入繁出)
      - [修正不對稱繁簡字](#修正不對稱繁簡字)
    - [活用標點創建自定義詞組](#活用標點創建自定義詞組)
- [Rime with Schemata](#rime-with-schemata)
- [Rime 輸入方案](#rime-輸入方案)
  - [Rime 是啥](#rime-是啥)
  - [Rime 輸入方案又是啥](#rime-輸入方案又是啥)
  - [爲啥這麼繁？](#爲啥這麼繁)
  - [共享文件夾](#共享文件夾)
    - [位置](#位置)
    - [內容](#內容)
  - [準備開工](#準備開工)
    - [Rime with Text Files](#rime-with-text-files)
    - [必知必會](#必知必會-1)
    - [Rime 中的數據文件分佈及作用](#rime-中的數據文件分佈及作用)
  - [詳解輸入方案](#詳解輸入方案)
    - [方案定義](#方案定義)
    - [輸入法引擎與功能組件](#輸入法引擎與功能組件)
      - [理解 Processors](#理解-processors)
      - [理解 Segmentors](#理解-segmentors)
      - [理解 Translators](#理解-translators)
      - [理解 Filters](#理解-filters)
    - [碼表與詞典](#碼表與詞典)
    - [設定項速查手冊](#設定項速查手冊-1)
    - [八股文](#八股文)
    - [編譯輸入方案](#編譯輸入方案)
    - [佈署 Rime](#佈署-rime)
  - [定製指南](#定製指南-1)
  - [拼寫運算](#拼寫運算)
  - [綜合演練](#綜合演練)
    - [【一】破空中出鞘](#一破空中出鞘)
      - [Hello, Rime!](#hello-rime)
      - [開始改裝](#開始改裝)
      - [創建候選項](#創建候選項)
      - [編寫詞典](#編寫詞典)
      - [實現選字及換頁](#實現選字及換頁)
      - [輸出中文標點](#輸出中文標點)
      - [用符號鍵換頁](#用符號鍵換頁)
    - [【二】修煉之道](#二修煉之道)
      - [改造鍵盤](#改造鍵盤)
      - [大寫數字鍵盤](#大寫數字鍵盤)
      - [羅馬字之道](#羅馬字之道)
      - [用拼寫運算定義簡碼](#用拼寫運算定義簡碼)
    - [【三】最高武藝](#三最高武藝)
    - [【四】標準庫](#四標準庫)
    - [關於調試](#關於調試)
  - [東風破](#東風破)
- [宮保拼音](#宮保拼音-1)
    - [指法演示](#指法演示)
  - [宮保拼音是啥](#宮保拼音是啥)
  - [方案概要](#方案概要)
  - [軟硬件需求](#軟硬件需求)
    - [客製化鍵盤用家須知](#客製化鍵盤用家須知)
  - [問得多](#問得多)
  - [先導知識](#先導知識)
  - [《漢語拼音方案》導讀](#漢語拼音方案導讀)
    - [字母表](#字母表)
    - [聲調符號](#聲調符號)
    - [隔音符號](#隔音符號)
    - [聲母表](#聲母表)
    - [韻母表](#韻母表)
    - [對韻母表的說明](#對韻母表的說明)
  - [《宮保拼音》並擊方案詳解](#宮保拼音並擊方案詳解)
    - [鍵盤佈局](#鍵盤佈局)
    - [鍵位與指法](#鍵位與指法)
    - [並擊鍵序](#並擊鍵序)
    - [並擊鍵位濃縮圖](#並擊鍵位濃縮圖)
    - [並擊聲母](#並擊聲母)
      - [zh, ch, sh](#zh-ch-sh)
      - [m, n, r](#m-n-r)
      - [j, q, x](#j-q-x)
      - [尖團音](#尖團音)
    - [並擊韻母](#並擊韻母)
      - [單韻母](#單韻母)
      - [複韻母](#複韻母)
      - [鼻韻母](#鼻韻母)
    - [韻母的缺省與通借](#韻母的缺省與通借)
      - [缺省韻母](#缺省韻母)
      - [R 通借爲 ei](#r-通借爲-ei)
      - [RO 通借爲 -ng](#ro-通借爲--ng)
  - [結語](#結語)
- [詞典擴展包](#詞典擴展包)
  - [概述](#概述)
  - [示例](#示例)
  - [總結](#總結)
- [配方](#配方)
  - [用配方管理自定義配置](#用配方管理自定義配置)
- [How to Rime with the Code](#how-to-rime-with-the-code)
  - [Get the Code](#get-the-code)
  - [How to Rime with the OS](#how-to-rime-with-the-os)
  - [Report Issues](#report-issues)
- [下載 Rime 輸入法](#下載-rime-輸入法)
- [librime for Emacs](#librime-for-emacs)
- [Squirrel Release Manual](#squirrel-release-manual)
- [weasel 發佈手冊](#weasel-發佈手冊)
- [FAQs](#faqs)
    - [如何定製輸入法？](#如何定製輸入法)
    - [如何卸載鼠鬚管（Squirrel）？](#如何卸載鼠鬚管squirrel)
    - [如何使用雙拼時，啟動臺灣繁體習慣用字？（Linux + ibus或fcitx）](#如何使用雙拼時啟動臺灣繁體習慣用字linux--ibus或fcitx)


## 必知必會

建議您在定製 Rime 輸入法之前瞭解 Rime 輸入方案的概念、Rime 中的數據文件分佈及作用等基礎知識。

[[必知必會|RimeWithSchemata]]

### 重新佈署的操作方法

  * 【中州韻】點擊輸入法狀態欄上的 ⟲ (Deploy) 按鈕
    或：如果找不到狀態欄，在終端輸入以下命令，可觸發自動部署：

        touch ~/.config/ibus/rime/; ibus restart

  * 【小狼毫】開始菜單→小狼毫輸入法→重新佈署；當開啓托盤圖標時，右鍵點選「重新佈署」
  * 【鼠鬚管】在系統語言文字選單中選擇「重新佈署」

對設置的修改於重新佈署後生效。編譯新的輸入方案需要一段時間，此間若無法輸出中文，請稍等片刻。

若部署完畢後，可以通過 Ctrl+` 喚出方案選單，輸入方案卻仍無法正常使用，可能是輸入方案未部署成功。請[[查看日誌文件|RimeWithSchemata#關於調試]]定位錯誤。

### 查閱 DIY 處方集

已將一些定製 Rime 的常見問題、解法及定製檔鏈接俱收錄於下文的〔DIY 處方集〕

### 設定項速查手冊

[雪齋的文檔](https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md) 全面而詳細解釋了輸入方案及詞典中各設定項的含義及用法。


## 定製指南

Rime 輸入方案，將 Rime 輸入法的設定整理成完善的、可分發的形式。
但並非一定要創作新的輸入方案，才可以改變 Rime 的行爲。

當用戶需要對 Rime 中的各種設定做小幅的調節，最直接、但不完全正確的做法是：編輯用戶資料夾中那些 .yaml 文檔。

這一方法有弊端：

  * 當 Rime 軟件升級時，也會升級各種設定檔、預設輸入方案。用戶編輯過的文檔會被覆寫爲更高版本，所做調整也便丟失了。
  * 即使在軟件升級後再手動恢復經過編輯的文件，也會因設定檔的其他部分未得到更新而失去本次升級新增和修復的功能。


因此，對於隨 Rime 發行的設定檔及預設輸入方案，推薦的定製方法是：

創建一個文件名的主體部份（「.」之前）與要定製的文件相同、次級擴展名（「.yaml」之前）爲 `.custom` 的定製文檔：

```yaml
patch:
  "一級設定項/二級設定項/三級設定項": 新的設定值
  "另一個設定項": 新的設定值
  "再一個設定項": 新的設定值
  "含列表的設定項/@n": 列表第n個元素新的設定值，從0開始計數
  "含列表的設定項/@last": 列表最後一個元素新的設定值
  "含列表的設定項/@before 0": 在列表第一個元素之前插入新的設定值（不建議在補靪中使用）
  "含列表的設定項/@after last": 在列表最後一個元素之後插入新的設定值（不建議在補靪中使用）
  "含列表的設定項/@next": 在列表最後一個元素之後插入新的設定值（不建議在補靪中使用）
  "含列表的設定項/+": 與列表合併的設定值（必須爲列表）
  "含字典的設定項/+": 與字典合併的設定值（必須爲字典，注意YAML字典的無序性）
```

就是這樣：`patch` 定義了一組「補靪」，以源文件中的設定爲基礎，寫入新的設定項、或以新的設定值取代現有設定項的值。

不懂？那看我來示範。


### 一例、定製每頁候選數

Rime 中，默認每頁至多顯示 5 個候選項，而允許的範圍是 1〜9（個別 Rime 發行版可支持10個候選）。

設定每頁候選個數的默認值爲 9，在用戶目錄建立文檔 `default.custom.yaml` ：

```yaml
patch:
  "menu/page_size": 9
```

重新佈署即可生效。

**〔注意〕** 如果 default.custom.yaml 裏面已經有其他設定內容，只要以相同的縮進方式添加 `patch:` 以下的部分，不可重複 `patch:` 這一行。

若只需要將獨孤一個輸入方案的每頁候選數設爲 9，以【朙月拼音】爲例，建立文檔 `luna_pinyin.custom.yaml` 寫入相同內容，重新佈署即可生效。

註：請參閱前文「重新佈署的操作方法」★


### 一例、定製標點符號

有的用家習慣以 `/` 鍵輸入標點「、」。

仍以【朙月拼音】爲例，輸入方案中有以下設定：

```yaml
# luna_pinyin.schema.yaml
# ...

punctuator:
  import_preset: default
```

解釋：

`punctuator` 是 Rime 中負責轉換標點符號的組件。該組件會從設定中讀取符號映射表，而知道該做哪些轉換。

`punctuator/import_preset` 是說，本方案要繼承一組預設的符號映射表、要從另一個設定檔 `default.yaml` 導入。

查看 `default.yaml` ，確有如下符號表：

```yaml
punctuator:
  full_shape:
    # ……其他……
    "/" : [ ／, "/", ÷ ]
    # ……其他……
  half_shape:
    # ……其他……
    "/" : [ "/", ／, ÷ ]
    # ……其他……
```

可見按鍵 `/` 是被指定到 `"/", ／, ÷` 等一組符號了。
並且全角和半角狀態下，符號有不同的定義。

欲令 `/` 鍵直接輸出「、」，可如此定製 `luna_pinyin.custom.yaml`:

```yaml
patch:
  punctuator/full_shape:
    "/" : "、"
  punctuator/half_shape:
    "/" : "、"
```

以上在輸入方案設定中寫入兩組新值，合併後的輸入方案成爲：

```yaml
# luna_pinyin.schema.yaml
# ...

punctuator:
  import_preset: default
  full_shape:
    "/" : "、"
  half_shape:
    "/" : "、"
```

含義是、在由 `default` 導入的符號表之上，覆寫對按鍵 `/` 的定義。

通過這種方法，既直接繼承了大多數符號的默認定義，又做到了局部的個性化。

### 一例、定製簡化字輸出

*注意：*

  * 如果您只是需要 Rime 輸出簡化字，敲 Ctrl+` 組合鍵、從菜單中選擇「漢字→汉字」即可！
  * 本例說明了其中原理，以及通過設定檔修改預設輸出字形的方法。

Rime 預設的詞彙表使用傳統漢字。
這是因爲傳統漢字較簡化字提供了更多信息，做「繁→簡」轉換能夠保證較高的精度。

Rime 中的過濾器組件 simplifier，完成對候選詞的繁簡轉換。

```yaml
# luna_pinyin.schema.yaml
# ...

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification    # 轉換開關
    states: [ 漢字, 汉字 ]

engine:
  filters:
    - simplifier  # 必要組件一
    - uniquifier  # 必要組件二
```

以上是【朙月拼音】中有關繁簡轉換功能的設定。

在 `engine/filters` 中，除了 `simplifier`，還用了一件 `uniquifier`。
這是因爲有些時候，不同的候選會轉化爲相同的簡化字，例如「鐘→钟」、「鍾→钟」。
`uniquifier` 的作用是在 `simplifier` 執行轉換之後，將文字相同的候選項合併。

該輸入方案設有三個狀態開關：中／西文、全／半角、繁簡字。即 `switches` 之下三項。

每個開關可在兩種狀態（`states`）之間切換，`simplifier` 依據名爲 `simplification` 的開關狀態來決定是否做簡化：
  * 初始狀態下、輸出爲傳統漢字、〔方案選單〕中的開關選項顯示爲「漢字→汉字」。
  * 選擇該項後、輸出爲簡化漢字、〔方案選單〕中顯示「汉字→漢字」。
  * Rime 會記憶您的選擇，下次打開輸入法時、直接切換到所選的字形。
  * 亦可無視上次記住的選擇，在方案中重設初始值：`reset` 設爲 0 或 1，分別選中 `states` 列表中的兩種狀態。

如果日常應用以簡化字爲主`:-(`，則每每在〔方案選單〕中切換十分不便；
於是佛振獻上默認輸出簡化字的設定檔：

```yaml
# luna_pinyin.custom.yaml

patch:
  switches:                   # 注意縮進
    - name: ascii_mode
      reset: 0                # reset 0 的作用是當從其他輸入方案切換到本方案時，
      states: [ 中文, 西文 ]  # 重設爲指定的狀態，而不保留在前一個方案中設定的狀態。
    - name: full_shape        # 選擇輸入方案後通常需要立即輸入中文，故重設 ascii_mode = 0；
      states: [ 半角, 全角 ]  # 而全／半角則可沿用之前方案中的用法。
    - name: simplification
      reset: 1                # 增加這一行：默認啓用「繁→簡」轉換。
      states: [ 漢字, 汉字 ]
```

其實預設輸入方案中就提供了一套【朙月拼音】的簡化字版本，名爲【簡化字】，以應大家“填表”之需。
看他的代碼如何卻與上篇定製檔寫得不同：

```yaml
# luna_pinyin_simp.schema.yaml
# ...

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: zh_simp           # 注意這裏（※1）
    reset: 1
    states: [ 漢字, 汉字 ]

simplifier:
  option_name: zh_simp      # 和這裏（※2）
```

前文說，`simplifier` 這個組件會檢查名爲 `simplification` 的開關狀態；
而這款【簡化字】方案卻用了一個不同名的開關 `zh_simp`，即 ※1 處所示；
並通過在 ※2 行設定 `simplifier/option_name` 告知 `simplifier` 組件所需關注的開關名字。

何故？

還記得否，前文對「全／半角」這個開關的討論——
當切換方案時，未明確使用 `reset` 重置的開關，會保持之前設定過的狀態。

【朙月拼音】等多數方案，並未重設 `simplification` 這個選項——
因爲用戶換了一種輸入編碼的方式、並不意味着需要變更輸出的字形。

而【簡化字】這一方案不同，恰恰是表達變更輸出字形的需求；
用戶再從【簡化字】切回【朙月拼音】時，一定是爲了「回到」繁體輸出模式。
所以令【簡化字】使用獨立命名的開關、而非方案間共用的 `simplification` 開關，
以避免影響其他輸入方案的繁簡轉換狀態。


### 一例、默認英文輸出

有些用戶習慣默認英文輸出，在需要用中文時再做切換。這就需要我們在方案中重設狀態開關初始值。

還記得否？我們可用`reset`設定項在方案中爲某些狀態開關重設初始值：`reset` 設爲 0 或 1，分別選中 `states` 列表中的兩種狀態。

我們以【朙月拼音】爲例：

```yaml
# luna_pinyin.custom.yaml

patch:
  "switches/@0/reset": 1  #表示將 switcher 列表中的第一個元素（即 ascii_mode 開關）的初始值重設爲狀態1（即「英文」）。
```


### 一例、定製方案選單

在【小狼毫】方案選單設定介面上勾勾選選，就可以如此定製輸入方案列表：

```yaml
# default.custom.yaml

patch:
  schema_list:  # 對於列表類型，現在無有辦法指定如何添加、消除或單一修改某項，於是要在定製檔中將整個列表替換！
    - schema: luna_pinyin
    - schema: cangjie5
    - schema: luna_pinyin_fluency
    - schema: luna_pinyin_simp
    - schema: my_coolest_ever_schema  # 這樣就啓用了未曾有過的高級輸入方案！其實這麼好的方案應該排在最前面哈。
```

無有設定介面時，又想啓用、禁用某個輸入方案，手寫這樣一份定製檔、重新佈署就好啦。


### 一例、定製喚出方案選單的快捷鍵

喚出方案選單，當然要用鍵盤。默認的快捷鍵爲 Ctrl+` 或 F4。

不過，有些同學電腦上 Ctrl+` 與其他軟件衝突，F4 甚至本文寫作時在【鼠鬚管】中還不可用。又或者有的玩家切換頻繁，想定義到更好的鍵位。

那麼……

```yaml
# default.custom.yaml

patch:
  "switcher/hotkeys":  # 這個列表裏每項定義一個快捷鍵，使哪個都中
    - "Control+s"      # 添加 Ctrl+s
    - "Control+grave"  # 你看寫法並不是 Ctrl+` 而是與 IBus 一致的表示法
    - F4
```

按鍵定義的格式爲「修飾符甲+修飾符乙+…+按鍵名稱」，加號爲分隔符，要寫出。

所謂修飾符，就是以下組合鍵的狀態標誌或是按鍵彈起的標誌：
 * Release——按鍵被放開，而不是按下
 * Shift
 * Control
 * Alt——Windows上 Alt+字母 會被系統優先識別爲程序菜單項的快捷鍵，當然 Alt+Tab 也不可用
 * 嗯，Linux 發行版還支持 Super, Meta 等組合鍵，不過最好選每個平臺都能用的啦

按鍵的名稱，大小寫字母和數字都用他們自己表示，其他的按鍵名稱 [參考這裏](https://github.com/rime/librime/blob/master/thirdparty/include/X11/keysymdef.h) [这个更直观的文档](https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md) 的定義，去除代碼前綴 `XK_` 即是。


### 一例、定製【小狼毫】字體字號

雖與輸入方案無關，也在此列出以作參考。

```yaml
# weasel.custom.yaml

patch:
  "style/font_face": "明兰"  # 字體名稱，從記事本等處的系統字體對話框裏能看到
  "style/font_point": 14     # 字號，只認數字的，不認「五號」、「小五」這樣的
```


### 一例、定製【小狼毫】配色方案

註：這款配色已經在新版本的小狼毫裏預設了，做練習時，你可以將文中 `starcraft` 換成自己命名的標識。

```yaml
# weasel.custom.yaml

patch:
  "style/color_scheme": starcraft    # 這項用於選中下面定義的新方案
  "preset_color_schemes/starcraft":  # 在配色方案列表裏加入標識爲 starcraft 的新方案
    name: 星際我爭霸／StarCraft
    author: Contralisk <contralisk@gmail.com>, original artwork by Blizzard Entertainment
    text_color: 0xccaa88             # 編碼行文字顏色，24位色值，用十六進制書寫方便些，順序是藍綠紅0xBBGGRR
    candidate_text_color: 0x30bb55   # 候選項文字顏色，當與文字顏色不同時指定
    back_color: 0x000000             # 底色
    border_color: 0x1010a0           # 邊框顏色，與底色相同則爲無邊框的效果
    hilited_text_color: 0xfecb96     # 高亮文字，即與當前高亮候選對應的那部份輸入碼
    hilited_back_color: 0x000000     # 設定高亮文字的底色，可起到凸顯高亮部份的作用
    hilited_candidate_text_color: 0x60ffa8  # 高亮候選項的文字顏色，要醒目！
    hilited_candidate_back_color: 0x000000  # 高亮候選項的底色，若與背景色不同就會顯出光棒
```

效果自己看！

也可以參照這張比較直觀的圖：

![](http://i.imgur.com/hSty6cB.png)

另，此處有現成的配色方案工具供用家調配：

* <del>http://tieba.baidu.com/p/2491103778</del>

* 小狼毫：https://bennyyip.github.io/Rime-See-Me/

* 鼠鬚管：https://gjrobert.github.io/Rime-See-Me-squirrel/

## DIY 處方集

已將一些定製 Rime 的常見問題、解法及定製檔鏈接收錄於此。

建議您首先讀完《定製指南》、通曉相關原理，以正確運用這些處方。

### 初始設定

#### 在方案選單中添加五筆、雙拼

https://gist.github.com/2309739

倣此例，可啓用任一預設或自訂輸入方案，如【粵拼】、【注音】等。（詳解：參見前文「定製方案選單」一節）

如果下載、自己製作了非預設的輸入方案，將源文件複製到「用戶資料夾」後，也用上面的方法將方案標識加入選單！

修改於重新佈署後生效。

#### 【小狼毫】外觀設定

上文已介紹設定字體字號、製作配色方案的方法。

使用橫向候選欄、嵌入式編碼行：

```yaml
# weasel.custom.yaml
patch:
  style/horizontal: true      # 候選橫排
  style/inline_preedit: true  # 內嵌編碼（僅支持TSF）
  style/display_tray_icon: true  # 顯示托盤圖標
```

#### 【鼠鬚管】外觀與鍵盤設定

鼠鬚管從 0.9.6 版本開始支持選擇配色方案，用 `squirrel.custom.yaml` 保存用戶的設定。

https://gist.github.com/2290714

ibus用户： `ibus_rime.custom.yaml` 不包含控制配色、字體字號等外觀樣式的設定項。

### 在特定程序裏關閉中文輸入

【鼠鬚管】0.9.9 開始支持這項設定：

在指定的應用程序中，改變輸入法的初始轉換狀態。如在
  * 終端 `Terminal / iTerm`
  * 代碼編輯器 `MacVim`
  * 快速啓動工具 `QuickSilver / Alfred`
等程序裏很少需要輸入中文，於是鼠鬚管在這些程序裏默認不開啓中文輸入。

自定義 Mac 應用程序的初始轉換狀態，首先查看應用的 `Info.plist` 文件得到 該應用的 `Bundle Identifier`，通常是形如 `com.apple.Xcode` 的字符串。

例如，要在 `Xcode` 裏面默認關閉中文輸入，又要在 `Alfred` 裏面恢復開啓中文輸入，可如此設定：

```yaml
# example squirrel.custom.yaml
patch:
  app_options/com.apple.Xcode:
    ascii_mode: true
  app_options/com.alfredapp.Alfred: {}
```

註：一些版本的 `Xcode` 標識爲 `com.apple.dt.Xcode`，請注意查看 `Info.plist`。

【小狼毫】0.9.16 亦開始支持這項設定。

例如，要在 `gVim` 裏面默認關閉中文輸入，可如此設定：

```yaml
# example weasel.custom.yaml
patch:
  app_options/gvim.exe:  # 程序名字全用小寫字母
    ascii_mode: true
```

### 輸入習慣

#### 使用Control鍵切換中西文

https://gist.github.com/2981316

以及修改Caps Lock、左右Shift、左右Control鍵的行爲，提供三種切換方式。
詳見 Gist 代碼註釋。

#### 方便地輸入含數字的西文用戶名

通常，輸入以小寫拉丁字母組成的編碼後，數字鍵的作用是選擇相應序號的候選字。

假設我的郵箱地址是 `rime123@company.com`，則需要在輸入rime之後上屏或做臨時中西文切換，方可輸入數字部分。

爲了更方便輸入我的用戶名 `rime123`，設置一組特例，將 `rime` 與其後的數字優先識別西文：

https://gist.github.com/3076166

#### 以方括號鍵換頁

https://gist.github.com/2316704

添加 Mac 風格的翻頁鍵 `[ ]` 。這是比較直接的設定方式。下一則示例給出了一種更系統、可重用的設定方式。

#### 使用西文標點兼以方括號鍵換頁

https://gist.github.com/2334409

詳見上文「使用全套西文標點」一節。

#### 以回車鍵清除編碼兼以分號、單引號選字

https://gist.github.com/2390510

適合一些形碼輸入法（如五筆、鄭碼）的快手。

#### 關閉逐鍵提示

`table_translator` 默認開啓逐鍵提示。若要只出精確匹配輸入碼的候選字，可關閉這一選項。

以【倉頡五代】爲例：

```yaml
# cangjie5.custom.yaml
patch:
  translator/enable_completion: false
```

#### 關閉用戶詞典和字頻調整

以【五笔86】爲例：

```yaml
# wubi86.custom.yaml
patch:
  translator/enable_user_dict: false
```

#### 關閉碼表輸入法連打

註：這個選項僅針對 `table_translator`，用於屏蔽倉頡、五筆中帶有太極圖章「☯」的連打詞句選項，不可作用於拼音、注音、速成等輸入方案。

以【倉頡】爲例：

```yaml
# cangjie5.custom.yaml
patch:
  translator/enable_sentence: false
```

#### 關閉倉頡與拼音混打

默認，給出倉頡與拼音候選的混合列表。

如此設定，直接敲字母只認作倉頡碼，但仍可在敲 ` 之後輸入拼音：

```yaml
# cangjie5.custom.yaml
patch:
  abc_segmentor/extra_tags: {}
```

#### 空碼時按空格鍵清空輸入碼

首先需要關閉碼表輸入法連打（參見上文），這樣才可以在打空時不出候選詞。

然後設定（以五筆86爲例）：

```yaml
# wubi86.custom.yaml
patch:
  translator/enable_sentence: false
  key_binder/bindings:
    - {when: has_menu, accept: space, send: space}
    - {when: composing, accept: space, send: Escape}
```

### 模糊音

#### 【朙月拼音】模糊音定製模板

https://gist.github.com/2320943

【明月拼音·简化字／臺灣正體／語句流】也適用，
只須將模板保存到 `luna_pinyin_simp.custom.yaml` 、 `luna_pinyin_tw.custom.yaml` 或 `luna_pinyin_fluency.custom.yaml` 。

对比模糊音定製模板與[【朙月拼音】方案原件](https://github.com/rime/rime-luna-pinyin/blob/master/luna_pinyin.schema.yaml)，
可見模板的做法是，在 `speller/algebra` 原有的規則中插入了一些定義模糊音的代碼行。

類似方案如雙拼、粵拼等可參考模板演示的方法改寫 `speller/algebra` 。

#### 【吳語】模糊音定製模板

https://gist.github.com/2015335

### 編碼反查

#### 設定【速成】的反查碼爲粵拼

https://gist.github.com/2944320

#### 設定【倉頡】的反查碼爲雙拼

https://gist.github.com/2944319

### 在Mac系統上輸入emoji表情

以下配置方法已過時，新的emoji用法見 https://github.com/rime/rime-emoji

<del>
參考 https://gist.github.com/2309739 把 `emoji` 加入輸入方案選單；

切換到 `emoji` 輸入方案，即可通過拼音代碼輸入表情符號。[查看符號表](https://github.com/rime/home/raw/master/images/emoji-chart.png)

輸入 `all` 可以列出全部符號，符號後面的括弧裏標記其拼音代碼。

若要直接在【朙月拼音】裏輸入表情符號，請按此文設定：

http://gist.github.com/3705586
</del>

### 五筆簡入繁出

【小狼毫】用家請到[[下載頁|Downloads]]取得「擴展方案集」。

安裝完成後，執行輸入法設定，添加【五筆·簡入繁出】輸入方案。

其他版本請參考這篇說明：

https://gist.github.com/3467172

#### 修正不對稱繁簡字

繁→簡即時轉換比簡體轉繁體要輕鬆許多，卻也免不了個別的錯誤。

比如這一例，「乾」字是一繁對多簡的典型。由它組成的常用詞組，opencc 都做了仔細分辨。但是遇到較生僻的詞組、專名，就比較頭疼：

http://tieba.baidu.com/p/1909252328

### 活用標點創建自定義詞組

在【朙月拼音】裏添加一些自定義文字、符號。可以按照上文設定「emoji表情」的方式爲自定義詞組創建一個專門的詞典。

可是建立詞典稍顯繁瑣，而活用自定義標點，不失爲一個便捷的方法：

```yaml
# luna_pinyin.custom.yaml
# 如果不需要 ` 鍵的倉頡反查拼音功能，則可利用 ` 鍵輸入自定義詞組
patch:
  recognizer/patterns/reverse_lookup:
  'punctuator/half_shape/`':
    - '佛振 <chen.sst@gmail.com>'
    - 'http://rime.github.io'
    - 上天赋予你高的智商，教你用到有用的地方。
```

上例 `recognizer/patterns/reverse_lookup:` 作用是關閉 ` 鍵的反查功能。若選用其他符號則不需要這行。又一例：

```yaml
patch:
  'punctuator/half_shape/*': '*_*'
```

`'punctuator/half_shape/*'` 因爲字符串包含符號，最好用 **單引號** 括起來；儘量不用雙引號以避免符號的轉義問題。

然而，重定義「/」「+」「=」這些符號時，因其在節點路徑中有特殊含義，無法用上面演示的路徑連寫方式。
因此對於標點符號，推薦的定製方法爲在輸入方案裏覆蓋定義 `half_shape` 或 `full_shape` 節點：

```yaml
patch:
  punctuator/half_shape:
   '/': [ '/', '/hello', '/bye', '/* TODO */' ]
   '+': '+_+'
   '=': '=_='
```

> Rime 輸入方案設計書

- [Rime with Schemata](#rime-with-schemata)
- [Rime 輸入方案](#rime-輸入方案)
  - [Rime 是啥](#rime-是啥)
  - [Rime 輸入方案又是啥](#rime-輸入方案又是啥)
  - [爲啥這麼繁？](#爲啥這麼繁)
- [準備開工](#準備開工)
  - [Rime with Text Files](#rime-with-text-files)
  - [必知必會](#必知必會)
  - [Rime 中的數據文件分佈及作用](#rime-中的數據文件分佈及作用)
- [詳解輸入方案](#詳解輸入方案)
  - [方案定義](#方案定義)
  - [輸入法引擎與功能組件](#輸入法引擎與功能組件)
    - [理解 Processors](#理解-processors)
    - [理解 Segmentors](#理解-segmentors)
    - [理解 Translators](#理解-translators)
    - [理解 Filters](#理解-filters)
  - [碼表與詞典](#碼表與詞典)
  - [設定項速查手冊](#設定項速查手冊)
  - [八股文](#八股文)
  - [編譯輸入方案](#編譯輸入方案)
  - [佈署 Rime](#佈署-rime)
- [定製指南](#定製指南)
- [拼寫運算](#拼寫運算)
- [綜合演練](#綜合演練)
  - [【一】破空中出鞘](#一破空中出鞘)
    - [Hello, Rime!](#hello-rime)
    - [開始改裝](#開始改裝)
    - [創建候選項](#創建候選項)
    - [編寫詞典](#編寫詞典)
    - [實現選字及換頁](#實現選字及換頁)
    - [輸出中文標點](#輸出中文標點)
    - [用符號鍵換頁](#用符號鍵換頁)
  - [【二】修煉之道](#二修煉之道)
    - [改造鍵盤](#改造鍵盤)
    - [大寫數字鍵盤](#大寫數字鍵盤)
    - [羅馬字之道](#羅馬字之道)
    - [用拼寫運算定義簡碼](#用拼寫運算定義簡碼)
  - [【三】最高武藝](#三最高武藝)
  - [【四】標準庫](#四標準庫)
  - [關於調試](#關於調試)
- [東風破](#東風破)


# Rime with Schemata

Rime 輸入方案創作者的第一本參考書

※ 佛振 <chen.sst@gmail.com> 修訂於 2013年5月4日


# Rime 輸入方案

作者的一點主張：選用適合自己的輸入法。

來折騰 Rime 的同學，我只能說，您對輸入法的追求比較與衆不同啦！

當然，因爲您理想中的輸入方式千奇百怪、也許從沒有人那樣玩過，所以不可能在那種勾勾選選的介面上做得出來；需要親手來創作——

Rime 輸入方案！

## Rime 是啥

Rime 不是一種輸入法。是從各種常見鍵盤輸入法中提煉出來的抽象的輸入算法框架。因爲 Rime 涵蓋了大多數輸入法的「共性」，所以在不同的設定下，Rime 可化身爲不同的輸入法用來打字。

## Rime 輸入方案又是啥

要讓 Rime 實現某種具體輸入法的功能，就需要一些數據來描述這種輸入法以何種形式工作。即，定義該輸入法的「個性」。

如「漢語拼音」、「注音」、「倉頡碼」、「五筆字型」，這些方法可憑藉 Rime 提供的通用設施、給定不同的工作參數來實作。以本文介紹的規格寫成一套套的配方，就是 Rime 輸入方案。

## 爲啥這麼繁？

一鍵就搞掂，必然選項少，功能單一。不好玩。

輸入法程序一寫兩三年，也許還不夠火候；花兩三個小時來讀入門書，已是輸入法專業速成班。


## 共享文件夾

存放由本機多個用戶共享的文件，通常由輸入法安裝程序寫入。

Rime 輸入法在查找一項資源的時候，會優先訪問 [[用戶文件夾|UserData]] 中的文件。
用戶文件不存在時，再到共享文件夾中尋找。

一些 Linux 發行版可由 `rime-data` 軟件包安裝常用數據文件到這裏。或用 [/plum/][plum-make-install] 編譯安裝。

  [plum-make-install]: https://github.com/rime/plum#install-as-shared-data

### 位置

`librime` 允許輸入法指定共享文件夾的位置。

- **小狼毫：** `<安裝目錄>\data`
- **鼠鬚管：** `"/Library/Input Methods/Squirrel.app/Contents/SharedSupport"`
- **ibus-rime, fcitx-rime:** `/usr/share/rime-data` （編譯時可配置）

### 內容

輸入方案、韻書、默認配置源文件：

- `<輸入方案代號>.schema.yaml`: 用戶下載或自定義的 *輸入方案*。
- `<韻書代號>.dict.yaml`: 用戶下載或自定義的 *韻書*。
- `<詞典名稱>.txt`: 文本格式的詞典，如預設詞彙表。

也可以包含編譯後的機讀格式，從而省去用戶部署時從相同源文件再次編譯的步驟：

- `build/*` 快取文件。爲使輸入法程序高效運行，預先將配置、韻書等編譯爲機讀格式。

註： `librime` 1.3 版本之前，編譯後的快取文件直接存放在共享文件夾，與源文件並列。

其他：

- `opencc/*` - [OpenCC](https://github.com/BYVoid/OpenCC) 字形轉換配置及字典文件。


## 準備開工

Rime 是跨平臺的輸入法軟件，Rime 輸入方案可通用於以下發行版：
  * 【中州韻】 ibus-rime → Linux
  * 【小狼毫】 Weasel → Windows
  * 【鼠鬚管】 Squirrel → Mac OS X

取得適合你系統的最新版 Rime 輸入法，印一份《指南書》，準備開工了！

### Rime with Text Files

文本爲王。
Rime 的配置文件、輸入方案定義及詞典文件，均爲特定格式的文本文檔。
因此，一款夠專業的 **文本編輯器** ，是設計 Rime 輸入方案的必備工具。

Rime 中所有文本文檔，均要求以 UTF-8 編碼，並建議使用 UNIX 換行符（LF）。

鑑於一些文本編輯器會爲 UTF-8 編碼的文件添加 BOM 標記，爲防止誤將該字符混入文中，
莫要從文件的第一行開始正文，而請在該行行首以 # 記號起一行註釋，如：

```yaml
## Rime default settings

## Rime schema: My First Cool Schema

## Rime dictionary: Lingua Latina
```

也可繼續以註釋行寫下方案簡介、碼表來源、製作者、修訂記錄等信息，再切入正文。

### 必知必會

Rime 輸入法中，多用擴展名爲「`.yaml`」的文本文檔，這是以一種可讀性高的數據描述語言—— YAML 寫成。

請訪問 <http://yaml.org/> 瞭解 YAML 文檔格式。
下文只對部分語法作簡要說明，而將重點放在對語義的解讀上面。

Rime 輸入方案亦會用到「正則表達式」實現一些高級功能。

輸入方案設計者需要掌握這份文檔所描述的 Perl 正則表達式語法：

http://www.boost.org/doc/libs/1_49_0/libs/regex/doc/html/boost_regex/syntax/perl_syntax.html

### Rime 中的數據文件分佈及作用

除程序文件以外，Rime 還包括多種數據文件。
這些數據文件存在於以下位置：

[共享資料夾](https://github.com/rime/home/wiki/SharedData)
  * 【中州韻】  `/usr/share/rime-data/`
  * 【小狼毫】  `"安裝目錄\data"`
  * 【鼠鬚管】  `"/Library/Input Methods/Squirrel.app/Contents/SharedSupport/"`

[用戶資料夾](https://github.com/rime/home/wiki/UserData)
  * 【中州韻】  `~/.config/ibus/rime/` （0.9.1 以下版本爲 `~/.ibus/rime/`；fcitx5 为 `~/.local/share/fcitx5/rime/`）
  * 【小狼毫】  `%APPDATA%\Rime`
  * 【鼠鬚管】  `~/Library/Rime/`

[共享資料夾](https://github.com/rime/home/wiki/SharedData) 包含預設輸入方案的源文件。
這些文件屬於 Rime 所發行軟件的一部份，在訪問權限控制較嚴格的系統上對用戶是只讀的，因此謝絕軟件版本更新以外的任何修改——
一旦用戶修改這裏的文件，很可能影響後續的軟件升級或在升級時丟失數據。

在「[部署](https://github.com/rime/home/wiki/CustomizationGuide#%E9%87%8D%E6%96%B0%E4%BD%88%E7%BD%B2%E7%9A%84%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95)」操作時，將用到這裏的輸入方案源文件、並結合用戶定製的內容來編譯預設輸入方案。

[用戶資料夾](https://github.com/rime/home/wiki/UserData) 則包含爲用戶準備的內容，如：
  * 〔全局設定〕 `default.yaml`
  * 〔發行版設定〕 `weasel.yaml`
  * 〔預設輸入方案副本〕 `<方案標識>.schema.yaml`

  * ※〔安裝信息〕 `installation.yaml`
  * ※〔用戶狀態信息〕 `user.yaml`

編譯輸入方案所產出的二進制文件：
  * 〔Rime 棱鏡〕 `<方案標識>.prism.bin`
  * 〔Rime 固態詞典〕 `<詞典名>.table.bin`
  * 〔Rime 反查詞典〕 `<詞典名>.reverse.bin`

記錄用戶寫作習慣的文件：
  * ※〔用戶詞典〕 `<詞典名>.userdb/` 或 `<詞典名>.userdb.kct`
  * ※〔用戶詞典快照〕 `<詞典名>.userdb.txt`、`<詞典名>.userdb.kct.snapshot` 見於同步文件夾

以及用戶自己設定的：
  * ※〔用戶對全局設定的定製信息〕 `default.custom.yaml`
  * ※〔用戶對預設輸入方案的定製信息〕 `<方案標識>.custom.yaml`
  * ※〔用戶自製輸入方案〕及配套的詞典源文件

註：以上標有 ※ 號的文件，包含用戶資料，您在清理文件時要注意備份！

## 詳解輸入方案

### 方案定義

一套輸入方案，通常包含「方案定義」和「詞典」文件。

方案定義，命名爲 `<方案標識>.schema.yaml`，是一份包含輸入方案配置信息的 YAML 文檔。

文檔中需要有這樣一組方案描述：

```yaml
## 以下代碼片段節選自 luna_pinyin.schema.yaml

schema:
  schema_id: luna_pinyin
  name: 朙月拼音
  version: "0.9"
  author:
    - 佛振 <chen.sst@gmail.com>
  description: |
    Rime 預設的拼音輸入方案。
```

首先來爲方案命名。`schema/name` 字段是顯示在〔方案選單〕中的名稱。

然後——重點是——要定一個在整個 Rime 輸入法中唯一的「方案標識」，即 `schema/schema_id` 字段的內容。
方案標識由小寫字母、數字、下劃線構成。
僅於輸入法內部使用，且會構成方案定義文件名的一部分，因此爲了兼容不同的文件系統，不要用大寫字母、漢字、空格和其他符號做方案標識。
一例：這款名爲【朙月拼音】的輸入方案，方案標識爲「`luna_pinyin`」。

方案如做升級，通過版本號（`schema/version`）來區分相互兼容的新舊版本。

版本號——以「.」分隔的整數（或文字）構成的字符串。

如下都是版本號常見的形式：

    "1"      # 最好加引號表明是字符串！
    "1.0"    # 最好加引號表明是字符串！
    "0.9.8"
    "0.9.8.custom.86427531"  # 這種形式是經過用戶自定義的版本；自動生成

然而，若對方案的升級會導致原有的用戶輸入習慣無法在新的方案中繼續使用，則需要換個新的方案標識。

比如【倉頡五代】之於【倉頡三代】、【五筆98】之於【五筆86】，其實已是互不兼容的輸入法。

`schema/author` ——列出作者和主要貢獻者，格式爲文字列表：

```yaml
schema:
  author:
    - 作者甲 <alpha@rime.org>
    - 作者乙 <beta@rime.org>
    - 作者丙
```

`schema/description` ——對方案作簡要介紹的多行文字。

以上 `schema/schema_id`、`schema/version` 字段用於在程序中識別輸入方案，
而 `schema/name`、`schema/author`、`schema/description` 則主要是展示給用戶的信息。


除方案描述外，方案定義文件中還包含各種功能設定，控制着輸入法引擎的工作方式。


### 輸入法引擎與功能組件

論 Rime 輸入法的工作流程：

> 按鍵消息→後臺「服務」→分配給對應的「會話」→由「方案選單」或「輸入引擎」處理……

這裏要點是，有會話的概念：多窗口、多線操作嘛，你懂得的，同時與好幾位 MM 聊天時，有無有好幾組會話。
每一組會話中都有一部輸入引擎完成按鍵序列到文字的變換。

Rime 可以在不同會話裏使用不同輸入方案。因爲有「方案選單」。
方案選單本身可響應一些按鍵。但由於他不會寫字的緣故，更多時候要把按鍵遞給同一會話中的「輸入引擎」繼續處理。
方案選單的貢獻，就是給用戶一個便捷的方案切換介面，再把用戶挑中的輸入方案加載到輸入引擎。

再論輸入引擎的工作流程：

> 加載輸入方案、預備功能組件；各就位之後就進入處理按鍵消息、處理按鍵消息……的循環。

響應各種按鍵、產生各類結果的工作，由不同的功能組件分擔。

好，看代碼：

```yaml
## luna_pinyin.schema.yaml
## ...

engine:                    # 輸入引擎設定，即掛接組件的「處方」
  processors:              # 一、這批組件處理各類按鍵消息
    - ascii_composer       # ※ 處理西文模式及中西文切換
    - recognizer           # ※ 與 matcher 搭配，處理符合特定規則的輸入碼，如網址、反查等
    - key_binder           # ※ 在特定條件下將按鍵綁定到其他按鍵，如重定義逗號、句號爲候選翻頁鍵
    - speller              # ※ 拼寫處理器，接受字符按鍵，編輯輸入碼
    - punctuator           # ※ 句讀處理器，將單個字符按鍵直接映射爲文字符號
    - selector             # ※ 選字處理器，處理數字選字鍵、上、下候選定位、換頁鍵
    - navigator            # ※ 處理輸入欄內的光標移動鍵
    - express_editor       # ※ 編輯器，處理空格、回車上屏、回退鍵等
  segmentors:              # 二、這批組件識別不同內容類型，將輸入碼分段
    - ascii_segmentor      # ※ 標識西文段落
    - matcher              # ※ 標識符合特定規則的段落，如網址、反查等
    - abc_segmentor        # ※ 標識常規的文字段落
    - punct_segmentor      # ※ 標識句讀段落
    - fallback_segmentor   # ※ 標識其他未標識段落
  translators:             # 三、這批組件翻譯特定類型的編碼段爲一組候選文字
    - echo_translator      # ※ 沒有其他候選字時，回顯輸入碼
    - punct_translator     # ※ 轉換標點符號
    - script_translator    # ※ 腳本翻譯器，用於拼音等基於音節表的輸入方案
    - reverse_lookup_translator  # ※ 反查翻譯器，用另一種編碼方案查碼
  filters:                 # 四、這批組件過濾翻譯的結果
    - simplifier           # ※ 繁簡轉換
    - uniquifier           # ※ 過濾重複的候選字，有可能來自繁簡轉換
```

註：除示例代碼中引用的組件外，尚有

```yaml
- fluid_editor      # ※ 句式編輯器，用於以空格斷詞、回車上屏的【注音】、【語句流】等輸入方案，替換 express_editor，也可以寫作 fluency_editor
- chord_composer    # ※ 和絃作曲家或曰並擊處理器，用於【宮保拼音】等多鍵並擊的輸入方案
- table_translator  # ※ 碼表翻譯器，用於倉頡、五筆等基於碼表的輸入方案，替換 script_translator
```

輸入引擎把完成具體功能的邏輯拆分爲可裝卸、組合的部件。
「加載」輸入方案，即按該處方掛接所需的功能組件、令這些組件從輸入方案定義中加載各自的設定、準備各司其職。
而他們接下來要完成的作業，由引擎收到的一份按鍵消息引發。

#### 理解 Processors

輸入引擎，作爲整體來看，以按鍵消息爲輸入，輸出包括三部分：
  * 一是對按鍵消息的處理結果：操作系統要一個結果、這按鍵、輪入法接是不接？
  * 二是暫存於輸入法、尚未完成處理的內容，會展現在輸入法候選窗中。
  * 三是要「上屏」的文字，並不是每按一鍵都有輸出。通常中文字都會伴隨「確認」動作而上屏，有些按鍵則會直接導致符號上屏，而這些還要視具體場景而定。

那麼第一類功能組件 `processor`s，就是比較籠統地、起着「處理」按鍵消息的作用。

按鍵消息依次送往列表中的 `processor`，由他給出對按鍵的處理意見：
  * 或曰「收」、即由 Rime 響應該按鍵；
  * 或曰「拒」、回禀操作系統 Rime 不做響應、請對按鍵做默認處理；
  * 或曰這個按鍵我不認得、請下一個 `processor` 繼續看。

優先級依照 `processors` 列表順序排定，接收按鍵者會針對按鍵消息做處理。

雖然看起來 `processor` 通過組合可以承擔引擎的全部任務，但爲了將邏輯繼續細分、Rime 又爲引擎設置了另外三類功能組件。這些組件都可以訪問引擎中的數據對象——輸入上下文，並將各自所做處理的階段成果存於其中。

`processor` 最常見的處理，便是將按鍵所產生的字符記入上下文中的「輸入碼」序列。
當「輸入碼」發生變更時，下一組組件 `segmentor`s 開始一輪新的作業。

#### 理解 Segmentors

Segment是段落的意思，segmentor意即分段器，將用戶連續輸入的文字、數字、符號等不同內容按照需要，識別不同格式的輸入碼，將輸入碼分成若干段分而治之。
這通過數輪代碼段劃分操作完成。每一輪操作中、一衆 `segmentor`s 分別給出起始於某一處、符合特定格式的代碼段，識別到的最長代碼段成爲本輪劃分的結果，而給出這一劃分的一個或多個 `segmentor` 組件則可爲該代碼段打上「類型標籤」；從這一新代碼段的結束位置，開始下一輪劃分，直到整個輸入碼序列劃分完畢。

舉例來說，【朙月拼音】中，輸入碼 `2012nian\`，劃分爲三個編碼段：`2012`（貼`number`標籤）、`nian`（貼`abc`標籤）、`\`（貼`punct`標籤）。

那些標籤是初步劃分後判定的類型，也可能有一個編碼段貼多個標籤的情況。下一個階段中，`translator`s 會把特定類型的編碼段翻譯爲文字。

#### 理解 Translators

顧名思義，`translator` 完成由編碼到文字的翻譯。但有幾個要點：
  * 一是翻譯的對象是劃分好的一個代碼段。
  * 二是某個 `translator` 組件往往只翻譯具有特定標籤的代碼段。
  * 三是翻譯的結果可能有多條，每條結果成爲一個展現給用戶的候選項。
  * 四是代碼段可由幾種 `translator` 分別翻譯、翻譯結果按一定規則合併成一列候選。
  * 五是候選項所對應的編碼未必是整個代碼段。用拼音敲一個詞組時，詞組後面繼續列出單字候選，即是此例。

雙目如探針般進入內存查看，發現翻譯的結果呈現這種形式：

    input | tag    | translations
    ------+--------+-------------------------------------
    2012  | number | [ "2012" ], [ "二〇一二" ]
    nian  | abc    | [ "年", "念", "唸",... ], [ "nian" ]
    \     | punct  | [ "、", "\" ]

輸入串劃分爲多個代碼段、每段代碼又可具有多組翻譯結果；取各代碼段的首選結果連接起來，就是預備上屏的文字「`2012年、`」。

且將以上所示的數據稱爲「作文」。這是一篇未定稿（未搞定）的作文，輸入法介面此時顯示預備上屏的文字「`2012年、`」，並列出最末一個代碼段上的候選「`、`」及「`\`」以供選擇。

有兩款主力 `translator` 完成主要文字內容的翻譯，其實現的方式很不一樣：

  * `script_translator` 也叫做 `r10n_translator` 修煉羅馬字分析法，以「固定音節表」爲算法的基礎，識別輸入碼的音節構成，推敲排列組合、完成遣詞造句。
  * `table_translator` 修煉傳承自上世紀的碼表功夫，基於規則的動態碼表，構成編碼空間內一個開放的編碼集合。

拼音、注音、方言拼音，皆是以固定音節表上的拼寫排列組合的方式產生編碼，故適用羅馬字分析法。
倉頡、五筆字型這類則是傳統的碼表輸入法。

如果以碼表方式來寫拼音輸入方案，是怎樣的效果呢？雖然仍可完成輸入，但無法完全實現支持簡拼、模糊拼音、使用隔音符號的動態調頻、智能語句等有用的特性。

反之，以羅馬字方式使用碼表輸入法，則無法實現定長編碼頂字上屏、按編碼規則構詞等功能。在 Rime 各發行版預設輸入方案中，有一款「速成」輸入方案，即是以 `script_translator` 翻譯倉頡碼，實現全、簡碼混合的語句輸入。

概括起來，這是兩種構造新編碼的方式：羅馬字式輸入方案以一組固定的基本音節碼創造新的組合而構詞，而碼表式輸入方案則以一定碼長爲限創造新的編碼映射而構詞。

#### 理解 Filters

Filter即過濾器。
上一步已經收集到各個代碼段的翻譯結果，當輸入法需要在介面呈現一頁候選項時，就從最末一個代碼段的結果集中挑選、直至取夠方案中設定的頁最大候選數。

每從結果集選出一條字詞、會經過一組 `filter`s 過濾。多個 `filter` 串行工作，最終產出的結果進入候選序列。

`filter` 可以：
  * 改裝正在處理的候選項，修改某些屬性值：簡化字、火星文、菊花文有無有？過時了！有 Rime，你對文字的想象力終於得救
  * 消除當前候選項，比如檢測到重複（由不同 `translator` 產生）的候選條目
  * 插入新的候選項，比如根據已有條目插入關聯的結果
  * 修改已有的候選序列


### 碼表與詞典

詞典是 `translator` 的參考書。

他往往與同名輸入方案配套使用，如拼音的詞典以拼音碼查字，倉頡的詞典以倉頡碼查字。但也可以由若干編碼屬於同一系統的輸入方案共用，如各種雙拼方案，都使用和拼音同樣的詞典，於是不僅復用了碼表數據，也可共享用戶以任一款此系列方案錄入的自造詞（仍以碼表中的形式即全拼編碼記錄）。

Rime 的詞典文件，命名爲 `<詞典名>.dict.yaml`，包含一份碼表及對應的規則說明。
詞典文件的前半部份爲一份 YAML 文檔：

```yaml
## 注意這裏以 --- ... 分別標記出 YAML 文檔的起始與結束位置
## 在 ... 標記之後的部份就不會作 YAML 文檔來解讀

---
name: luna_pinyin
version: "0.9"
sort: by_weight
use_preset_vocabulary: true
...
```

解釋：

  * `name`: 詞典名，內部使用，命名原則同「方案標識」；可以與配套的輸入方案標識一致，也可不同；
  * `version`: 管理詞典的版本，規則同輸入方案定義文件的版本號；
  * `sort`: 詞條初始排序方式，可選填 `by_weight`（按詞頻高低排序）或 `original`（保持原碼表中的順序）；
  * `use_preset_vocabulary`: 填 `true` 或 `false`，選擇是否導入預設詞彙表【八股文】。


碼表，定義了輸入法中編碼與文字的對應關係。

碼表位於詞典文件中 YAML 結束標記之後的部份。
其格式爲以製表符分隔的值（TSV），每行定義一條「文字－編碼」的對應關係：

```yaml
## 單字
你	ni
我	wo
的	de	99%
的	di	1%
地	de	10%
地	di	90%
目	mu
好	hao

## 詞組
你我
你的
我的
我的天
天地	tian di
好天
好好地
目的	mu di
目的地	mu di di
```

※注意： **不要** 從網頁複製以上代碼到實作的詞典文件！因爲網頁裏製表符被轉換成空格從而不符合 Rime 詞典要求的格式。一些文本編輯器也會將使用者輸入的製表符自動轉換爲空格，請注意檢查和設置。

碼表部份，除了以上格式的編碼行，還可以包含空行（不含任何字符）及註釋行（行首爲 # 符號）。

以製表符（Tab）分隔的第一個字段是所定義的文字，可以是單字或詞組；

第二個字段是與文字對應的編碼；若該編碼由多個「音節」組成，音節之間以空格分開；

可選地、第三個字段是設定該字詞權重的頻度值（非負整數），或相對於預設權值的百分比（浮點數%）。
在拼音輸入法中，往往多音字的若干種讀音使用的場合不同，於是指定不同百分比來修正每個讀音的使用頻度。

詞組如果滿足以下條件，則可以省去編碼字段：

  * 詞組中每個單字均有編碼定義
  * 詞組中不包含多音字（例：你我），或多音字在該詞組中讀音的權值超過該多音字全部讀音權值的5%（例：我的）

這種條件下，詞組的編碼可由單字編碼的組合推導出來。

反之，則有必要給出詞組的編碼以消除自動註音的不確定性（例：天地）。

當含有多音字的詞組缺少編碼字段時，自動註音程序會利用權重百分比高於5%的讀音進行組合、生成全部可能的註音，如：

  「好好地」在編譯時自動註音爲「`hao hao de`」、「`hao hao di`」


### 設定項速查手冊

[雪齋的文檔](https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md) 全面而詳細解釋了輸入方案及詞典中各設定項的含義及用法。


### 八股文

Rime 有一份名爲【八股文】的預設詞彙表。

多數輸入方案需要用到一些標準白話文中的通用詞彙。爲免重複在每份碼表中包含這些詞彙，減少輸入方案維護成本，Rime 提供了一份預設詞彙表及自動編碼（註音）的設施。

創作輸入方案時，如果希望完全控制詞彙表的內容而不採用【八股文】中的詞組，只須直接將詞彙編入碼表即可。

否則，在詞典文件中設定 `use_preset_vocabulary: true` 將【八股文】導入該詞典；
在碼表中給出單字碼、需要分辨多音字的詞組編碼、以及該輸入方案特有的詞彙，其他交給自動註音來做就好啦。

Rime預設輸入方案正是利用這份詞彙表及自動註音工具，在不犧牲效果及可維護性的前提下、使詞典文件壓縮到最小的行數。

【八股文】包含從 CC-CEDICT、新酷音等開源項目中整理出來的約二十三萬條詞彙，其用字及詞頻數據針對傳統漢字做過調整。因此基於這份詞彙表產生的輸入結果，比較接近以傳統漢字行文的實際用法。

爲了充分利用【八股文】提供的詞彙，自定義的詞典應保證單字碼表收錄了符合 opencc 字形標準的常用字。特別注意，該標準對以下幾組異體字的取捨，【八股文】將這些字（包括詞組及字頻）統一到左邊一列的字形。

```
爲	為
僞	偽
嬀	媯
潙	溈
兇	凶
啓	啟
棱	稜
污	汙
泄	洩
涌	湧
牀	床
着	著
竈	灶
衆	眾
裏	裡
踊	踴
麪	麵
羣	群
峯	峰
```

請務必在碼表中收錄左列的單字；並建議收全右列的單字。

輸入法詞典往往對下列幾組字不做嚴格區分，opencc 則傾向於細分異體字的不同用法。

```
喫	吃
黴	霉
攷	考
覈	核
```

請儘量在碼表中收全以上單字。

部署過程中，未能完成自動註音的字、詞會以警告形式出現在日誌文件裏。如果所報告的字爲生僻字、您可以忽略他；如果警告中大量出現某個常用字，那麼應該注意到碼表裏缺失了該字的註音。


### 編譯輸入方案

將寫好的輸入方案佈署到 Rime 輸入法的過程，稱爲「編譯」：

爲查詢效率故，輸入法工作時不直接加載文本格式的詞典源文件，而要在編譯過程中，爲輸入方案生成專爲高速查詢設計的「.bin」文件。

編譯時程序做以下幾件事：

  * 將用戶的定製內容合併到輸入方案定義中，在用戶資料夾生成 .schema.yaml 文檔副本；
  * 依照輸入方案中指定的詞典：求得音節表（不同種編碼的集合）、單字表；
  * 對詞典中未提供編碼的詞組自動註音，也包括從【八股文】導入的詞組；
  * 建立按音節編碼檢索詞條的索引，製作 Rime 固態詞典；
  * 建立按詞條檢索編碼的索引，製作 Rime 反查詞典；
  * 依照音節表和方案定義中指定的拼寫運算規則，製作 Rime 棱鏡。


### 佈署 Rime

初次安裝 Rime 輸入法，無有任何輸入方案和用戶設定。因此安裝的最後一個步驟即是把發行版預設的輸入方案和設定文件佈署到 Rime 爲該用戶創建的工作目錄，至此 Rime 纔成爲一部可以發動的輸入引擎。

此後無論是修改已有方案的設定，或是添加了新的輸入方案，都需要「重新佈署」成功後方可使用戶的新設定作用於 Rime 輸入法。

〔★〕重新佈署的方法是：

  * 【小狼毫】從開始菜單選擇「重新部署」；或當開啓托盤圖標時，在托盤圖標上右鍵選擇「重新佈署」；
  * 【鼠鬚管】在系統語言文字選單中選擇「重新佈署」；
  * 【中州韻】點擊輸入法狀態欄（或IBus菜單）上的 ⟲ (Deploy) 按鈕；
  * 早於 ibus-rime 0.9.2 的版本：刪除用戶資料夾的 `default.yaml` 之後、執行 `ibus-daemon -drx` 重載 IBus


## 定製指南

Rime 輸入方案，將 Rime 輸入法的設定整理成完善的、可分發的形式。
但並非一定要創作新的輸入方案，才可以改變 Rime 的行爲。

當用戶需要對 Rime 中的各種設定做小幅的調節，最直接、但不完全正確的做法是：編輯用戶資料夾中那些 .yaml 文檔。

這一方法有弊端：

  * 當 Rime 軟件升級時，也會升級各種設定檔、預設輸入方案。用戶編輯過的文檔會被覆寫爲更高版本，所做調整也便丟失了。
  * 即使在軟件升級後再手動恢復經過編輯的文件，也會因設定檔的其他部分未得到更新而失去本次升級新增和修復的功能。


因此，對於隨 Rime 發行的設定檔及預設輸入方案，推薦的定製方法是：

創建一個文件名的主體部份（「.」之前）與要定製的文件相同、次級擴展名（位於「.yaml」之前）寫作 `.custom` 的定製檔，形如：

```yaml
patch:
  "一級設定項/二級設定項/三級設定項": 新的設定值
  "另一個設定項": 新的設定值
  "再一個設定項": 新的設定值
  "含列表的設定項/@0": 列表第一個元素新的設定值
  "含列表的設定項/@last": 列表最後一個元素新的設定值
  "含列表的設定項/@before 0": 在列表第一個元素之前插入新的設定值（不建議在補靪中使用）
  "含列表的設定項/@after last": 在列表最後一個元素之後插入新的設定值（不建議在補靪中使用）
  "含列表的設定項/@next": 在列表最後一個元素之後插入新的設定值（不建議在補靪中使用）
```

`patch` 定義了一組「補靪」，以源文件中的設定爲底本，寫入新的設定項、或以新的設定值取代舊有的值。

以下這些例子，另載於一篇[[《定製指南》|CustomizationGuide]]，其中所介紹的知識和技巧，覆蓋了不少本文未討論的細節，想必對於創作新的輸入方案會有啓發。

  * [[一例、定製每頁候選數|CustomizationGuide#一例定製每頁候選數]]
  * [[一例、定製標點符號|CustomizationGuide#一例定製標點符號]]
  * [[一例、定製簡化字輸出|CustomizationGuide#一例定製簡化字輸出]]
  * [[一例、默認英文輸出|CustomizationGuide#一例默認英文輸出]]
  * [[一例、定製方案選單|CustomizationGuide#一例定製方案選單]]

重要！創作了新的輸入方案，最後一步就是在「方案選單」裏啓用他。

## 拼寫運算

應該算是 Rime 輸入法最主要的獨創技術。

概括來說就是將方案中的編碼通過規則映射到一組全新的拼寫形式！
也就是說能讓 Rime 輸入方案在不修改碼表的情況下、適應不同的輸入習慣。

拼寫運算能用來：
  * 改革拼寫法
    * 將編碼映射到基於同一音系的其他拼寫法，如注音、拼音、國語羅馬字相互轉換
    * 重定義注音鍵盤、雙拼方案
  * 實現簡拼查詢
  * 在音節表上靈活地定義模糊音規則
  * 實現音節自動糾錯
  * 變換回顯的輸入碼或提示碼，如將輸入碼顯示爲字根、注音符號、帶聲調標註的羅馬字

給力嗎？

[[★這裏|SpellingAlgebra]] 有介紹拼寫運算的專題文章。


## 綜合演練

如果你安裝好了Rime卻不會玩，就一步一步跟我學吧。

本系列課程每個步驟的完整代碼可由此查閱：

https://github.com/lotem/rimeime/tree/master/doc/tutorial

### 【一】破空中出鞘

#### Hello, Rime!

第一個例子，總是最簡單的（也是最傻的）。

```yaml
## Rime schema
## encoding: utf-8
##
## 最簡單的 Rime 輸入方案
##

schema:
  schema_id: hello    # 注意此ID與文件名裏 .schema.yaml 之前的部分相同
  name: 大家好        # 將在〔方案選單〕中顯示
  version: "1"        # 這是文字類型而非整數或小數，如 "1.2.3"
```

起首幾行是註釋。而後只有一組必要的方案描述信息。

這一課主要練習建立格式正確的YAML文檔。

  * 要點一，讓你的文本編輯器以UTF-8編碼保存該文件；
  * 要點二，注意將 `schema:` 之下的三行代碼以空格縮進——我的習慣是用兩個空格——而 **不要** 用Tab字符來縮進。

縮進表示設定項所屬的層次。在他處引用到此文檔中的設定項，可分別以 `schema/schema_id`, `schema/name`, `schema/version` 來指稱。

我現在把寫好的方案文檔命名爲 `hello.schema.yaml`，丟進[用戶資料夾](https://github.com/rime/home/wiki/UserData)，只要這一個文件就妥了；

然後，啓用他。有些版本會有「方案選單設定」這個介面，在那裏勾選【大家好】這個方案即可。若無有設定介面，則按照上文《定製方案選單》一節來做。

好運！我已建立了一款名爲【大家好】的新方案！雖然他沒有實現任何效果、按鍵仍會像無有輸入法一樣直接輸出西文。

#### 開始改裝

爲了處理字符按鍵、生成輸入碼，本例向輸入引擎添加兩個功能組件。

以下代碼仍是ID爲 `hello` 的新款輸入方案，但增加了 `schema/version` 的數值。
以後每個版本，都以前一個版本爲基礎改寫，引文略去無有改動的部分，以突出重點。

```yaml
## ...
schema:
  schema_id: hello
  name: 大家好
  version: "2"

engine:
  processors:
    - fluid_editor
  segmentors:
    - fallback_segmentor
```

`fluid_editor` 將字符按鍵記入輸入上下文，`fallback_segmentor` 將輸入碼連綴成一段。於是重新佈署後，按下字符鍵不再直接上屏，而顯示爲輸入碼。

你會發現，該輸入法只是收集了鍵盤上的可打印字符，並於按下空格、回車鍵時令輸入碼上屏。

現在就好似寫輸入法程序的過程中，將將取得一小點成果，還有很多邏輯未實現。不同的是，在Rime輸入方案裏寫一行代碼，頂 Rime 開發者所寫的上百上千行。因此我可以很快地組合各種邏輯組件、搭建出心裏想的輸入法。

#### 創建候選項

第二版的【大家好】將鍵盤上所有字符都記入輸入碼，這對整句輸入有用，但是時下流行輸入法只處理編碼字符、其他字符直接上屏的形式。爲了對編碼字符做出區分，以下改用 `speller` + `express_editor` 的組合取代 `fluid_editor`：

```yaml
## ...

schema:
  # ...
  version: "3"

engine:
  processors:
    - speller          # 把字母追加到編碼串
    - express_editor   # 空格確認當前輸入、其他字符直接上屏
  segmentors:
    - fallback_segmentor
```

`speller` 默認只接受小寫拉丁字母作爲輸入碼。
試試看，輸入其他字符如大寫字母、數字、標點，都會直接上屏。並且如果已經輸入了編碼時，下一個直接上屏的字符會將輸入碼頂上屏。

再接着，創建一個最簡單的候選項——把編碼串本身作爲一個選項。故而會提供這個選項的新組件名叫 `echo_translator`。

```yaml
## ...

engine:
  # ...
  translators:
    - echo_translator  # （無有其他結果時，）創建一個與編碼串一個模樣的候選項
```

至此，【大家好】看上去與一個真正的輸入法形似啦。只是還不會打出「大家好」哇？

#### 編寫詞典

那就寫一部詞典，碼表中設定以 `hello` 作爲短語「大家好」的編碼：

```yaml
## Rime dictionary
## encoding: utf-8

---
name: hello
version: "1"
sort: original
...

大家好	hello
再見	bye
再會	bye
```

※注意： **不要** 從網頁複製以上代碼到實作的詞典文件！因爲網頁裏製表符被轉換成空格從而不符合 Rime 詞典要求的格式。一些文本編輯器也會將使用者輸入的製表符自動轉換爲空格，請注意檢查和設置。


同時修改方案定義：

```yaml
##...

schema:
  # ...
  version: "4"

engine:
  #...
  segmentors:
    - abc_segmentor       # 標記輸入碼的類型
    - fallback_segmentor
  translators:
    - echo_translator
    - table_translator    # 碼表式轉換

translator:
  dictionary: hello       # 設定 table_translator 使用的詞典名
```

工作流程是這樣的：

  * `speller` 將字母鍵加入輸入碼序列
  * `abc_segmentor` 給輸入碼打上標籤 `abc`
  * `table_translator` 把帶有 `abc` 籤的輸入碼以查表的方式譯爲中文
  * `table_translator` 所查的碼表在 `translator/dictionary` 所指定的詞典裏

現在可以敲 `hello` 而打出「大家好」。完工！

#### 實現選字及換頁

等一下。

記得 `hello` 詞典裏，還有個編碼叫做 `bye`。敲 `bye`，Rime 給出「再見」、「再會」兩個候選短語。

這時敲空格鍵，就會打出「再見」；那麼怎樣打出「再會」呢？

大家首先想到的方法，是：打完編碼 `bye`，按 `1` 選「再見」，按 `2` 選「再會」。
可是現在按下 `2` 去，卻是上屏「再見」和數字「2」。可見並沒有完成數字鍵選字的處理，而是將數字同其他符號一樣做了頂字上屏處理。

增加一部 `selector`，即可實現以數字鍵選字。

```yaml
schema:
  # ...
  version: "5"

engine:
  processors:
    - speller
    - selector         # 選字、換頁
    - navigator        # 移動插入點
    - express_editor
  # ...
```

`selector` 除了數字鍵，還響應前次頁、上下方向鍵。因此選擇第二候選「再會」，既可以按數字`2`，又可以按方向鍵「↓」將「再會」高亮、再按空格鍵確認。

`navigator` 處理左右方向鍵、`Home`、`End`鍵，實現移動插入點的編輯功能。有兩種情況需要用到他：一是發現輸入碼有誤需要定位修改，二是縮小候選詞對應的輸入碼的範圍、精準地編輯新詞組。

接下來向詞典添加一組重碼，以檢驗換頁的效果：

```yaml
---
name: hello
version: "2"
sort: original
...

大家好	hello
再見	bye
再會	bye

星期一	monday
星期二	tuesday
星期三	wednesday
星期四	thursday
星期五	friday
星期六	saturday
星期日	sunday

星期一	weekday
星期二	weekday
星期三	weekday
星期四	weekday
星期五	weekday
星期六	weekday
星期日	weekday
```

默認每頁候選數爲5，輸入 `weekday`，顯示「星期一」至「星期五」。再敲 `Page_Down` 顯示第二頁後選詞「星期六、星期日」。

#### 輸出中文標點

```yaml
schema:
  # ...
  version: "6"

engine:
  processors:
    - speller
    - punctuator        # 處理符號按鍵
    - selector
    - navigator
    - express_editor
  segmentors:
    - abc_segmentor
    - punct_segmentor   # 劃界，與前後方的其他編碼區分開
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator  # 轉換
    - table_translator

## ...

punctuator:             # 設定符號表，這裏直接導入預設的
  import_preset: default
```

這次的修改，要注意 `punctuator`, `punct_segmentor`, `punct_translator` 相對於其他組件的位置。

`punctuator/import_preset` 告訴 Rime 使用一套預設的符號表。他的值 `default` 可以換成其他名字如 `xxx`，則 Rime 會讀取 `xxx.yaml` 裏面定義的符號表。

如今再敲 `hello.` 就會得到「大家好。」

#### 用符號鍵換頁

早先流行用 `-` 和 `=` 這一對符號換頁，如今流行用 `,` 和 `.` 。
在第六版中「，」「。」是會頂字上屏的。現在要做些處理以達到一鍵兩用的效果。

Rime 提供了 `key_binder` 組件，他能夠在一定條件下，將指定按鍵綁定爲另一個按鍵。對於本例就是：
  * 當展現候選菜單時，句號鍵（`period`）綁定爲向後換頁（`Page_Down`）
  * 當已有（向後）換頁動作時，逗號鍵（`comma`）綁定爲向前換頁（`Page_Up`）

逗號鍵向前換頁的條件之所以比句號鍵嚴格，是爲了「，」仍可在未進行換頁的情況下頂字上屏。

經過 `key_binder` 的處理，用來換頁的逗號、句號鍵改頭換面爲前、後換頁鍵，從而繞過 `punctuator`，最終被 `selector` 當作換頁來處理。

最終的代碼如下：

```yaml
schema:
  schema_id: hello
  name: 大家好
  version: "7"

engine:
  processors:
    - key_binder  # 搶在其他 processor 處理之前判定是否換頁用的符號鍵
    - speller
    - punctuator  # 否則「，。」就會由此上屏
    - selector
    - navigator
    - express_editor
  segmentors:
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - table_translator

translator:
  dictionary: hello

punctuator:
  import_preset: default

key_binder:
  bindings:             # 每條定義包含條件、接收按鍵（IBus規格的鍵名，可加修飾符，如「Control+Return」）、發送按鍵

    - when:   paging    # 僅當已發生向後換頁時，
      accept: comma     # 將「逗號」鍵……
      send:   Page_Up   # 關聯到「向前換頁」；於是 navigator 將收到一發 Page_Up

    - when:   has_menu  # 只要有候選字即滿足條件
      accept: period
      send:   Page_Down
```


### 【二】修煉之道

與【大家好】這個方案不同。以下一組示例，主要演示如何活用符號鍵盤，以及羅馬字轉寫式輸入。

#### 改造鍵盤

莫以爲【大家好】是最最簡單的輸入方案。碼表式輸入法，不如「鍵盤式」輸入法來得簡單明快！

用 `punctuator` 這一套組件，就可實現一款鍵盤輸入法：

```yaml
## Rime schema
## encoding: utf-8

schema:
  schema_id: numbers
  name: 數字之道
  version: "1"

engine:
  processors:
    - punctuator
    - express_editor
  segmentors:
    - punct_segmentor
  translators:
    - punct_translator

punctuator:
  half_shape: &symtable
    "1" : 一
    "2" : 二
    "3" : 三
    "4" : 四
    "5" : 五
    "6" : 六
    "7" : 七
    "8" : 八
    "9" : 九
    "0" : 〇
    "s" : 十
    "b" : 百
    "q" : 千
    "w" : 萬
    "n" : 年
    "y" : [ 月, 元, 億 ]
    "r" : 日
    "x" : 星期
    "j" : 角
    "f" : 分
    "z" : [ 之, 整 ]
    "d" : 第
    "h" : 號
    "." : 點
  full_shape: *symtable
```

對，所謂「鍵盤輸入法」，就是按鍵和字直接對應的輸入方式。

這次，不再寫 `punctuator/import_preset` 這項，而是自訂了一套符號表。

鴰！原來 `punctuator` 不單可以用來打出標點符號；還可以重定義空格以及全部 94 個可打印 ASCII 字符（碼位 0x20 至 0x7e）。

在符號表代碼裏，用對應的ASCII字符表示按鍵。記得這些按鍵字符要放在引號裏面，YAML 纔能夠正確解析喔。

示例代碼表演了兩種符號的映射方式：一對一及一對多。一對多者，按鍵後符號不會立即上屏，而是……嘿嘿，自己體驗吧 `:-)`

關於代碼裏 `symtable` 的一點解釋：

  這是YAML的一種語法，`&symtable` 叫做「錨點標籤」，給緊隨其後的內容起個名字叫 `symtable`；
  `*symtable` 則相當於引用了 `symtable` 所標記的那段內容，從而避免重複。

Rime 裏的符號有「全角」、「半角」兩種狀態。本方案裏暫不作區分，教 `half_shape`、`full_shape` 使用同一份符號表。

#### 大寫數字鍵盤

靈機一動，不如利用「全、半角」模式來區分「大、小寫」中文數字！

```yaml
schema:
  # ...
  version: "2"

switches:
  - name: full_shape
    states: [ 小寫, 大寫 ]

## ...
```

先來定義狀態開關：`0`態改「半角」爲「小寫」，`1`態改「全角」爲「大寫」。

這樣一改，再打開「方案選單」，方案「數字之道」底下就會多出個「小寫→大寫」的選項，每選定一次、狀態隨之反轉一次。

接着給 `half_shape`、`full_shape` 定義不同的符號表：

```yaml
punctuator:
  half_shape:
    "1" : 一
    "2" : 二
    "3" : 三
    "4" : 四
    "5" : 五
    "6" : 六
    "7" : 七
    "8" : 八
    "9" : 九
    "0" : 〇
    "s" : 十
    "b" : 百
    "q" : 千
    "w" : 萬
    "n" : 年
    "y" : [ 月, 元, 億 ]
    "r" : 日
    "x" : 星期
    "j" : 角
    "f" : 分
    "z" : [ 之, 整 ]
    "d" : 第
    "h" : 號
    "." : 點
  full_shape:
    "1" : 壹
    "2" : 貳
    "3" : 參
    "4" : 肆
    "5" : 伍
    "6" : 陸
    "7" : 柒
    "8" : 捌
    "9" : 玖
    "0" : 零
    "s" : 拾
    "b" : 佰
    "q" : 仟
    "w" : 萬
    "n" : 年
    "y" : [ 月, 圓, 億 ]
    "r" : 日
    "x" : 星期
    "j" : 角
    "f" : 分
    "z" : [ 之, 整 ]
    "d" : 第
    "h" : 號
    "." : 點
```

哈，調出選單切換一下大小寫，輸出的字全變樣！酷。

但是要去選單切換，總不如按下 `Shift` 就全都有了：

```yaml
punctuator:
  half_shape:
    # ... 添加以下這些
    "!" : 壹
    "@" : 貳
    "#" : 參
    "$" : [ 肆, ￥, "$", "€", "£" ]
    "%" : [ 伍, 百分之 ]
    "^" : 陸
    "&" : 柒
    "*" : 捌
    "(" : 玖
    ")" : 零
    "S" : 拾
    "B" : 佰
    "Q" : 仟
    "Y" : 圓
```

於是在「小寫」態，只要按 `Shift` + 數字鍵即可打出大寫數字。

用了幾下，發現一處小小的不滿意：敲 `$` 這個鍵，可選的符號有五個之多。想要打出毆元、英鎊符號只得多敲幾下 `$` 鍵使想要的符號高亮；但是按上、下方向鍵並沒有效果，按符號前面標示的數字序號，更是不僅上屏了錯誤的符號、還多上屏一個數字——

這反映出兩個問題。一是 `selector` 組件缺席使得選字、移動選字光標的動作未得到響應。立即加上：

```yaml
## ...

engine:
  processors:
    - punctuator
    - selector        # 加在這裏
    - express_editor
  # ...
```

因爲要讓 `punctuator` 來轉換數字鍵，所以 `selector` 得放在他後頭。

好。二一個問題還在：無法用數字序號選字。爲解決這個衝突，改用閒置的字母鍵來選字：

```yaml
## ...

menu:
  alternative_select_keys: "acegi"
```

完工。

#### 羅馬字之道

畢竟，鍵盤上只有47個字符按鍵、94個編碼字符，對付百十個字還管使。可要輸入上千個常用漢字，嫌鍵盤式輸入的編碼空間太小，必得採用多字符編碼。

羅馬字，以拉丁字母的特定排列作爲漢語音節的轉寫形式。一個音節代表一組同音字，再由音節拼寫組合成詞、句。

凡此單字（音節）編碼自然連用而生詞、句的輸入法，皆可用 `script_translator` 組件完成基於音節碼切分的智能詞句轉換。他有個別名 `r10n_translator`——`r10n` 爲 `romanization` 的簡寫。但不限於「拼音」、「注音」、「雙拼」、「粵拼」等一族基於語音編碼的輸入法：形式相似者，如「速成」，雖以字形爲本，亦可應用。

現在來把【數字之道】改成拼音→中文數字的變換。

```yaml
schema:
  schema_id: numbers
  name: 數字之道
  version: "3"

engine:
  processors:
    - speller
    - punctuator
    - selector
    - express_editor
  segmentors:
    - abc_segmentor
    - punct_segmentor
  translators:
    - punct_translator
    - script_translator

translator:
  dictionary: numbers

punctuator:
  half_shape: &symtable
    "!" : 壹
    "@" : 貳
    "#" : 參
    "$" : [ 肆, ￥, "$", "€", "£" ]
    "%" : [ 伍, 百分之 ]
    "^" : 陸
    "&" : 柒
    "*" : 捌
    "(" : 玖
    ")" : 零
    "S" : 拾
    "B" : 佰
    "Q" : 仟
    "W" : 萬
    "N" : 年
    "Y" : [ 月, 圓, 億 ]
    "R" : 日
    "X" : 星期
    "J" : 角
    "F" : 分
    "Z" : [ 之, 整 ]
    "D" : 第
    "H" : 號
    "." : 點
  full_shape: *symtable
```

符號表裏，把小寫字母、數字鍵都空出來了。小寫字母用來拼音，數字鍵用來選重。重點是本次用了 `script_translator` 這組件。與 `table_translator` 相似，該組件與 `translator/dictionary` 指名的詞典相關聯。

編製詞典：

```yaml
## Rime dictionary
## encoding: utf-8

---
name: numbers
version: "1"
sort: by_weight
use_preset_vocabulary: true
...

一	yi
二	er
三	san
四	si
五	wu
六	liu
七	qi
八	ba
九	jiu
〇	ling
零	ling
十	shi
百	bai
千	qian
萬	wan
億	yi
年	nian
月	yue
日	ri
星	xing
期	qi
時	shi
分	fen
秒	miao
元	yuan
角	jiao
之	zhi
整	zheng
第	di
號	hao
點	dian
是	shi
```

※注意： **不要** 從網頁複製以上代碼到實作的詞典文件！因爲網頁裏製表符被轉換成空格從而不符合 Rime 詞典要求的格式。一些文本編輯器也會將使用者輸入的製表符自動轉換爲空格，請注意檢查和設置。

碼表裏給出了一個「示例」規格的小字集。其中包含幾組重碼字。

要訣 `sort: by_weight` 意圖是不以碼表的順序排列重碼字，而是比較字頻。那字頻呢？沒寫出來。

要訣 `use_preset_vocabulary: true` 用在輸入方案需要支持輸入詞組、而碼表中詞組相對匱乏時。編譯輸入方案期間引入 Rime 預設的【八股文】詞彙——及詞頻資料！這就是碼表中未具字頻的原因。

使用【八股文】，要注意碼表所用的字形是否與該詞彙表一致。八股文的詞彙及詞頻統計都遵照 opencc 繁體字形標準。

如果缺少單字的編碼定義，自然也無法導入某些詞彙。所以本方案只會導入這個數字「小字集」上的詞彙。

#### 用拼寫運算定義簡碼

如今有了一款專門輸入數字的拼音輸入法。比一比昇陽拼音、朙月拼音和地球拼音，還有哪裏不一樣？

很快我發現敲 `xingqiwu` 或 `xingqiw` 都可得到來自【八股文】的詞組「星期五」，這很好。可是敲 `xqw` 怎會不中呢？

原來 `script_translator` 羅馬字中譯的方法是，將輸入碼序列切分爲音節表中的拼寫形式，再按音節查詞典。不信你找本詞典瞧瞧，是不是按完整的拼音（注音）編排的。Rime 詞典也一樣。並沒有 `xqw` 這樣的檢索碼。

現在我要用 Rime 獨門絕活「拼寫運算」來定義一種「音序查字法」。令 `x` 作 `xing` 的簡碼，`q` 作數字之道所有音節中起首爲 `q` 者的簡碼，即略代音節 `qi` 與 `qian`。

「漢語拼音」裏還有三個雙字母的聲符，`zh, ch, sh` 也可做簡碼。

添加拼寫運算規則：

```yaml
schema:
  # ...
  version: "4"

##...

speller:
  algebra:
    - 'abbrev/^([a-z]).+$/$1/'
    - 'abbrev/^([zcs]h).+$/$1/'
```

如此 Rime 便知，除了碼表裏那些拼音，還有若干簡碼也是行得通的拼寫形式。再輸入 `xqw`，Rime 將他拆開 `x'q'w`，再默默對應到音節碼 `xing'qi'wan`、`xing'qi'wu`、`xing'qian'wan` 等等，一翻詞典就得到了一個好詞「星期五」，而其他的組合都說不通。

現在有無有悟到，羅馬字轉寫式輸入法與碼表式輸入法理念上的不同？

哈，做中了。試試看 `sss,sss,sssss,sssss`

卻好像不是我要的「四是四，十是十，十四是十四，四十是四十」……

好辦。如果某些詞彙在方案裏很重要，【八股文】又未收錄，那麼，請添加至碼表：

```yaml
---
name: numbers
version: "2"
sort: by_weight
use_preset_vocabulary: true
...

## ...

四是四
十是十
十四是十四
四十是四十
```

善哉。演示完畢。當然休想就此把 Rime 全盤掌握了。一本《指南書》，若能讓讀者入門，我止說「善哉〜」

再往後，就只有多讀代碼，纔能見識到各種新穎、有趣的玩法。


### 【三】最高武藝

〔警告〕最後這部戲，對智力、技術功底的要求不一般。如果讀不下去，不要怪我、不要懷疑自己的智商！

即使跳過本節書也無妨，只是不可忽略了下文《關於調試》這一節！（重要哇……）

請檢查是否：
  * ※ 已將前兩組實例分析透徹
  * ※ 學習完了《拼寫運算》
  * ※ 知道雙拼是神碼
  * ※ 預習 Rime 預設輸入方案之【朙月拼音】

設計一款【智能ABC雙拼】輸入方案做練習！

```yaml
## Rime schema
## encoding: utf-8

schema:
  schema_id: double_pinyin_abc  # 專有的方案標識
  name: 智能ABC雙拼
  version: "0.9"
  author:
    - 佛振 <chen.sst@gmail.com>
  description: |
    朙月拼音，兼容智能ABC雙拼方案。

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - script_translator
    - reverse_lookup_translator
  filters:
    - simplifier
    - uniquifier

speller:
  alphabet: zyxwvutsrqponmlkjihgfedcba  # 呃，倒背字母表完全是個人喜好
  delimiter: " '"  # 隔音符號用「'」；第一位的空白用來自動插入到音節邊界處
  algebra:  # 拼寫運算規則，這個纔是實現雙拼方案的重點。寫法有很多種，當然也可以把四百多個音節碼一條一條地列舉
    - erase/^xx$/             # 碼表中有幾個拼音不明的字，編碼成xx了，消滅他
    - derive/^([jqxy])u$/$1v/
    - xform/^zh/A/            # 替換聲母鍵，用大寫以防與原有的字母混淆
    - xform/^ch/E/
    - xform/^sh/V/
    - xform/^([aoe].*)$/O$1/  # 添上固定的零聲母o，先標記爲大寫O
    - xform/ei$/Q/            # 替換韻母鍵
    - xform/ian$/W/           # ※2
    - xform/er$|iu$/R/        # 對應兩種韻母的；音節er現在變爲OR了
    - xform/[iu]ang$/T/       # ※1
    - xform/ing$/Y/
    - xform/uo$/O/
    - xform/uan$/P/           # ※3
    - xform/i?ong$/S/
    - xform/[iu]a$/D/
    - xform/en$/F/
    - xform/eng$/G/
    - xform/ang$/H/           # 檢查一下在此之前是否已轉換過了帶介音的ang；好，※1處有了
    - xform/an$/J/            # 如果※2、※3還無有出現在上文中，應該把他們提到本行之前
    - xform/iao$/Z/           # 對——像這樣讓iao提前出場
    - xform/ao$/K/
    - xform/in$|uai$/C/       # 讓uai提前出場
    - xform/ai$/L/
    - xform/ie$/X/
    - xform/ou$/B/
    - xform/un$/N/
    - xform/[uv]e$|ui$/M/
    - xlit/QWERTYOPASDFGHJKLZXCVBNM/qwertyopasdfghjklzxcvbnm/  # 最後把雙拼碼全部變小寫

translator:
  dictionary: luna_pinyin     # 與【朙月拼音】共用詞典
  prism: double_pinyin_abc    # prism 要以本輸入方案的名稱來命名，以免把朙月拼音的拼寫映射表覆蓋掉
  preedit_format:             # 這段代碼用來將輸入的雙拼碼反轉爲全拼顯示；待見雙拼碼的可以把這段拿掉
    - xform/o(\w)/0$1/        # 零聲母先改爲0，以方便後面的轉換
    - xform/(\w)q/$1ei/       # 雙拼第二碼轉換爲韻母
    - xform/(\w)n/$1un/       # 提前轉換雙拼碼 n 和 g，因爲轉換後的拼音裏就快要出現這兩個字母了，那時將難以分辨出雙拼碼
    - xform/(\w)g/$1eng/      # 當然也可以採取事先將雙拼碼變爲大寫的辦法來與轉換過的拼音做區分，可誰讓我是高手呢
    - xform/(\w)w/$1ian/
    - xform/([dtnljqx])r/$1iu/  # 對應多種韻母的雙拼碼，按搭配的聲母做區分（最好別用排除式如 [^o]r 容易出狀況）
    - xform/0r/0er/             # 另一種情況，注意先不消除0，以防後面把e當作聲母轉換爲ch
    - xform/([nljqx])t/$1iang/
    - xform/(\w)t/$1uang/       # 上一行已經把對應到 iang 的雙拼碼 t 消滅，於是這裏不用再列舉相配的聲母
    - xform/(\w)y/$1ing/
    - xform/([dtnlgkhaevrzcs])o/$1uo/
    - xform/(\w)p/$1uan/
    - xform/([jqx])s/$1iong/
    - xform/(\w)s/$1ong/
    - xform/([gkhaevrzcs])d/$1ua/
    - xform/(\w)d/$1ia/
    - xform/(\w)f/$1en/
    - xform/(\w)h/$1ang/
    - xform/(\w)j/$1an/
    - xform/(\w)k/$1ao/       # 默默檢查：雙拼碼 o 已經轉換過了
    - xform/(\w)l/$1ai/
    - xform/(\w)z/$1iao/
    - xform/(\w)x/$1ie/
    - xform/(\w)b/$1ou/
    - xform/([nl])m/$1ve/
    - xform/([jqxy])m/$1ue/
    - xform/(\w)m/$1ui/
    - "xform/(^|[ '])a/$1zh/"  # 復原聲母，音節開始處的雙拼字母a改寫爲zh；其他位置的才真正是a
    - "xform/(^|[ '])e/$1ch/"
    - "xform/(^|[ '])v/$1sh/"
    - xform/0(\w)/$1/          # 好了，現在可以把零聲母拿掉啦
    - xform/([nljqxy])v/$1ü/   # 這樣纔是漢語拼音 :-)

reverse_lookup:
  dictionary: cangjie5
  prefix: "`"
  tips: 〔倉頡〕
  preedit_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田難卜符|"
  comment_format:
    - xform/([nl])v/$1ü/

punctuator:
  import_preset: default

key_binder:
  import_preset: default

recognizer:
  import_preset: default
  patterns:
    reverse_lookup: "`[a-z]*$"
```

完畢。

這是一道大題。通過改造拼寫法而創作出新的輸入方案。


### 【四】標準庫

如果需要製作完全屬於自己的輸入方案，少不了要瞭解 Rime 的標準庫。此時，請客倌品讀[《Rime方案製作詳解》](https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md)。更多新意，就在你的筆下！


### 關於調試

如此複雜的輸入方案，很可能需要反覆調試方可達到想要的結果。

請於試驗時及時查看日誌中是否包含錯誤信息。日誌文件位於：
  * 【中州韻】 `/tmp/rime.ibus.*`
  * 【小狼毫】 `%TEMP%\rime.weasel.*`
  * 【鼠鬚管】 `$TMPDIR/rime.squirrel.*`
  * 各發行版的早期版本 `用戶資料夾/rime.log`

按照日誌的級別分爲 INFO / 信息、WARNING / 警告、ERROR / 錯誤。
後兩類應重點關注，如果新方案部署後不可用或輸出與設計不一致，原因可能在此。

沒有任何錯誤信息，就是不好使，有可能是碼表本身的問題，比如把碼表中文字和編碼兩列弄顛倒了——Rime 等你輸入由漢字組成的編碼，然而鍵盤沒有可能做到這一點（否則也不再需要輸入法了）。

後續有計劃爲輸入方案創作者開發名爲[「拼寫運算調試器」](http://rime.github.io/blog/2013/08/28/spelling-algebra-debugger/)的工具，能夠較直觀地看到每一步拼寫運算的結果。有助於定義雙拼這樣大量使用拼寫運算的方案。


## 東風破

「東風破早梅，向暖一枝開。」

構想在 Rime 輸入軟件完善後，能夠連結漢字字形、音韻、輸入法愛好者的共同興趣，形成穩定的使用者社羣，搭建一個分享知識的平臺。

[【東風破】](https://github.com/rime/plum)，定義爲配置管理器及 Rime 輸入方案倉庫，是廣大 Rime 用家分享配置和輸入方案的平臺。

Rime 是一款強調個性的輸入法。

Rime 不要定義輸入法應當是哪個樣、而要定義輸入法可以玩出哪些花樣。

Rime 不可能通過預設更多的輸入方案來滿足玩家的需求；真正的玩家一定有一般人想不到的高招。

未來一定會有，[【東風破】](https://github.com/rime/plum)（註：現已投入運行），讓用家輕鬆地找到最新、最酷、最適合自己的 Rime 輸入方案。


# 宮保拼音

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-logo.png)

詩云：

宮保拼音並擊術　節奏明快又直觀 \
一擊一個中文字　能分平翹與尖團 \
標準設備廣兼容　六鍵無衝七指禪 \
速記千宗歸簡易　音韻萬變列琴盤

### 指法演示

  - 〈宮保拼音並擊術〉[YouTube](https://youtube.com/shorts/iLqb8Pmah7Q) 
    · [嗶哩嗶哩](https://www.bilibili.com/video/BV1PirLYfE1s/)
  - 〈鼠鬚管〉[YouTube](https://www.youtube.com/shorts/741fOTV4oOM) 
    · [嗶哩嗶哩](https://www.bilibili.com/video/BV1uECWYcEYc/)

## 宮保拼音是啥

宮保拼音，洋文：Combo Pinyin，是用電腦鍵盤並擊輸入的拼音輸入法。

並擊（chording），即多指並用、同時擊鍵。

並擊輸入類似在鋼琴鍵盤上演奏和絃。一次擊鍵能傳達大量信息。
因此這種輸入方式節奏清晰、操作舒適，特別是能與中文一字一音的韻律同步。

宮保拼音的靈感來源——速錄技術，也是用並擊的方法在專業設備上快速錄入文字、記錄語音的。
爲求兼容最廣泛的電腦硬件和應用，宮保拼音設計了爲標準電腦鍵盤優化的並擊鍵位佈局，
並依託 [Rime 輸入法](https://rime.im) 開發了在多個電腦平臺上使用的軟件。

## 方案概要

宮保拼音用雙手同時操作鍵盤上的部分字母鍵、空格鍵，共計 20 鍵；
一次並擊會用到 1 至 6 鍵不等，可一擊輸入一個拼音音節。
在並擊輸入拼音之外，鍵盤上的其他操作如選字、輸入標點符號、使用功能鍵等與尋常的拼音輸入法無異。

按照電腦鍵盤盲打指法，並擊共用到七個手指，故該並擊佈局也稱「七指禪」。
除了標準鍵盤，宮保拼音也有適配分體鍵盤、九鍵鍵盤、速錄鍵盤的特定佈局。

![指法圖](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-touch-typing.png)

[宮保拼音輸入方案](https://github.com/rime/rime-combo-pinyin) 是在 Rime 輸入法上實現該並擊法的配置。
輸入方案代碼爲 `combo_pinyin`。

Rime 輸入法的 `chord_composer` 組件支持對並擊鍵位的自定義，通過拼寫運算技術將並擊組合鍵映射爲拼音音節。

建議初學者通讀本文後，到訪 [宮保拼音鍵位練習](https://lotem.github.io/typewriter/) 頁面練習指法；
初步掌握並擊操作後，即可用 Rime 輸入法實踐並擊輸入。

## 軟硬件需求

Rime 輸入法支持 Windows、Linux、macOS 等電腦操作系統。詳見 [Rime 輸入法](https://rime.im) 網站。

並擊操作要求鍵盤的性能滿足 6 鍵並擊無衝突（6KRO）。大多數機械鍵盤、電容式鍵盤都滿足此要求。

薄膜電路鍵盤普遍存在不同程度的按鍵衝突。宮保拼音的並擊鍵位儘量選用不易造成衝突的組合，可以在部分型號的薄膜鍵盤上正常使用，如 IBM Thinkpad、Mac 筆記本電腦的鍵盤等。但從觸感而言，膠碗-薄膜鍵盤不是運用並擊的最佳選擇。

機械鍵盤的衆多軸體類型中，輕線性軸是用於並擊的首選。
而觸發壓力較大或段落感極強的軸體，多鍵並擊手指易疲勞、得到不整齊的力反饋和聲音反饋，不推薦長時間使用。

### 客製化鍵盤用家須知

客製化鍵盤若搭載 QMK/ZMK 等支持自定義鍵位的固件，須將宮保拼音用到的字母鍵、空格鍵設置爲普通按鍵（`KP`）。
鍵盤固件支持的一鍵兩用（`MT`, `LT`, auto-shift）、一鍵多用（tap-dance）、並擊（combo）等功能與輸入法並擊衝突。

分體鍵盤，須將右手半區的拇指鍵設爲空格。

如果字母鍵、空格鍵的位置不同，可修改 Rime 輸入方案適配鍵盤的配列。

## 問得多

<details>
<summary>問：宮保拼音的好處有啥？</summary>

答：對比串擊輸入拼音，宮保拼音並擊更符合漢語的節奏和人們字音的直觀認知，操作迅捷、舒適；
對比專業的速錄技術，宮保拼音大幅簡化並擊方案，降低了入門的門檻；適配標準電腦鍵盤，廣泛適用於日常的電腦軟件和工作流程。
</details>

<details>
<summary>問：宮保拼音快不快？</summary>

答：並擊輸入拼音，不會明顯加快輸入速度。因爲拼音輸入法的速度瓶頸在於確認結果和選字。

要在音節並擊的基礎上進一步提高速度，須借鑑速記/速錄技術，制定一套系統的縮略編碼、消除歧義的方法。
引進提速機制，也意味着大大增加指法的難度和編碼、規則的記憶量。

宮保拼音的定位是大衆化並擊方案，因此，默認的配置不包含這些內容。

此外，由於標準鍵盤不是專門爲並擊設計的，有性能上的限制，如：不易僅用一個手指並擊左右相鄰兩鍵或上下排的兩鍵。
即使充分運用各項技巧，使用電腦鍵盤的並擊輸入法也無法媲美專業的速錄。
</details>

<details>
<summary>問：爲什麼要重新排列鍵位？</summary>

答：速記/速錄是以語音爲基礎的技術。每種語言中的音素按照特定的排列組合方式構成有用的音節。
按照語音的內在規律設計並擊方案，並結合各個手指的運動能力制定鍵位，可以發揮鍵盤和雙手的最大效率。

照搬爲串擊設計的 QWERTY 鍵位，強行改作並擊是行不通的。
一方面，如 ⟨nan⟩, ⟨gong⟩ 等拼音中，有的字母出現兩次，無法一次並擊完成。
另一方面，按照鍵盤上的字母拼寫，得到的是近似隨機的鍵位組合，其中很大部分不能用理想的指法並擊。
還有，即使部分拼音能夠形成並擊組合，也不遵從特定的方位順序，如⟨liang⟩在鍵盤上找到這些字母須反覆橫跳，顯得毫無規律性；
串擊和並擊的手型，肌肉的動作很不一樣，熟習的串擊鍵位，對掌握並擊的幫助不大，反而有極大的限制。

所謂「肌肉記憶」，說得不準確。人的肢體和肌肉沒有記憶力；手指能否靈活地運動，本質是大腦會不會高效地指揮。
學習新指法的過程，表面是練手，實際是在練腦。因此，系統性、規律性、容易理解和記憶的鍵位設計，對熟練掌握並擊有很大幫助。
</details>

<details>
<summary>問：爲什麼不直接用全拼？</summary>

答：輸入全拼的過程是串行的，輸入順序也是信息的一部分。

欲輸入「我」，按照串擊的步驟必先確定一個“聲母”，即先按 W 鍵。
可是「我」的韻母⟨uo⟩與「果」的韻母是完全相同的聲音。W 也不是一個聲母，是因⟨u⟩在串流中處於音節開始位置而須改變字母的拼寫。
也就是說輸入全拼的過程中，我們在爲聽到的、或腦海中的語音重新編碼，使之符合漢語拼音方案定義的拉丁字母線性書寫的規則。

並擊則不同，一個字音中要輸入的各個成分：聲母、介音和韻母，須同時擊鍵，不存在一個形式上的「音序」。
並擊可以直接將語音的各部分同時映射爲擊鍵的動作。這是更純粹地拼「音」，而不是拼字母。

注音符號沒有複雜的拼寫規則，其與語音的對應關係也比拼音來得直接。因此宮保拼音也非常適合注音輸入法的使用者學習。

誠然，拼音熟練者可以非常快速、幾乎無所覺察地完成這道編碼的轉換。
然而這裏討論的重點是：語音到線性文字的編碼過程，即分先後、寫出拼音字母的過程，對串擊是必要的，如⟨ia, ai⟩、⟨uo, ou⟩靠字母順序區分不同的韻母，又如⟨y, w⟩可幫助確定連續字母中的音節邊界；
但對並擊是完全多餘的——並擊編碼可直接對應語音，免去對字母順序的關注和不必要的腦力開銷。
</details>

<details>
<summary>問：爲什麼不用雙拼？</summary>

答：雙拼是在全拼的拼寫規則之上，做了第二次壓縮編碼。因此上一個問題的回答在這裏也適用。

即使跳過轉換爲全拼的中間步驟，直接記憶雙拼碼，也繞不開發端於漢語拼音拼寫規則、同一個發音拼寫上出現的分化，
如⟨i, u, ü⟩, ⟨y, w, yu⟩的分化，韻母⟨iou, uei, uen⟩分化爲⟨-iu, -ui, -un⟩⟨you, wei, wen⟩，
這些分化的結果被雙拼全部繼承下來，又各自做了第二次演化，再也看不出原本同屬一個韻母的關係，
使得雙拼成爲同一個發音有兩三種不同編碼、反過來一個字母表示兩三種不同發音的複雜編碼方案。

並擊輸入有一種實現思路，是用並擊對雙拼的字母編碼。這種多次編碼同樣欠缺直觀性。
而且，由於是間接編碼，更難做到全盤考慮、優化並擊指法。

或曰：雙拼最終都是靠條件反射打字，不需要編碼過程。
按照這種說法，對漢語音節的任何無理編碼都可以收到相同的效果；而人的主觀感受並非如此。
難道直觀的編碼方案，在加快習得速度、對抗遺忘方面，不比多層編碼的、規則複雜的方案有優勢嗎？
</details>

<details>
<summary>問：我要不要學？</summary>

答：看情況。
輸入法，我主張，用合適的。

學習一種新的打字技能，必經枯燥的鍛鍊過程，直至熟練運用。
下文有助於讀者全面地瞭解宮保拼音的原理和方案設計、再根據自己的情況做出判斷。
</details>

## 先導知識

宮保拼音是以普通話的語音系統爲基礎設計的。他的按鍵與編碼並非依據漢語拼音的拼寫，而是直接對應普通話的音位。

考慮到大多數讀者不熟悉《漢語拼音方案》，這裏容我回顧該方案的主要內容，並對宮保拼音的語音基礎做出說明。

《漢語拼音方案》的完整文本，請參閱《新華字典》《現代漢語詞典》附錄、[教育部網站提供的影印版](http://www.moe.gov.cn/ewebeditor/uploadfile/2015/03/02/20150302165814246.pdf) 或 [維基文庫頁面](https://zh.wikisource.org/wiki/%E6%B1%89%E8%AF%AD%E6%8B%BC%E9%9F%B3%E6%96%B9%E6%A1%88)。

## 《漢語拼音方案》導讀

方案正文共有 5 個部分：一、字母表，二、聲母表，三、韻母表，四、聲調符號，五、隔音符號。

宮保拼音用左手輸入拼音音節中的聲母，用右手輸入拼音音節的韻母，同時擊發，奏出一個音節。
因此本文將詳細解讀〈聲母表〉〈韻母表〉。對其他章節做簡要說明。

### 字母表

〈字母表〉對拉丁字母（用作拼音字母）的名稱、順序、寫法做了定義和說明。

這裏要補充是，本文以及宮保拼音 3.0 版本各種圖表中字母的用法：

  * 宮保拼音鍵位或並擊組合鍵用大寫字母表示。如 `SHANE`。
  * 漢語拼音用小寫字母。爲明確拼寫法的種類，常用尖角括弧把拼音括起來，如 ⟨shang⟩。
  * QWERTY 鍵盤的字母鍵，本文用大寫字母指稱，但不套用代碼樣式。
  * 若敘述中同時提及鍵盤上的字母和宮保拼音鍵位，把宮保拼音鍵位及組合碼放在方括弧裏，以示區別。
    如：`[SHANE]` 須並擊鍵盤上的 S, D, K, L 及空格鍵。

### 聲調符號

定義了陰平、陽平、上聲、去聲四個聲調符號及標註方法。輕聲不標調。

本方案不輸入聲調。因此不再贅述。

### 隔音符號

⟨a, o, e⟩ 開頭的音節，與前面的音節之間用 `’` 隔開。

這個符號在連續書寫或連擊拼音字母時運用。

宮保拼音方案中，並擊提供了天然的音節界限，因此不需要額外輸入隔音符號。
技術上，軟件將在每個並擊所得的音節後自動加入隔音符號；輸入拼音後按退格鍵，也會以音節爲單位回退刪除拼音。

### 聲母表

原表在每個聲母下方用注音符號和漢字兩種方法註音，本文只節錄拼音部分。

|    |    |    |   |   |   |   |   |   |
|:--:|:--:|:--:|:-:|:-:|:-:|:-:|:-:|:-:|
| b  | p  | m  | f |   | d | t | n | l |
| g  | k  | h  |   |   | j | q | x |   |
| zh | ch | sh | r |   | z | c | s |   |
    
漢語拼音共設以上 21 個聲母。根據發音部位分爲六組。

在宮保拼音中，表中每一組發音部位相近的聲母，排列在同一行或同一列上；
相同的發音方法，如不送氣清音（全清）、送氣清音（次清）、鼻音（次濁）、邊音及擦音，也各有相同的指法。

### 韻母表

原表在每個韻母下方用注音符號和漢字兩種方法註音，本文只節錄拼音部分。

|     | i    | u    | ü   |
|:---:|:----:|:----:|:---:|
| a   | ia   | ua   |     |
| o   |      | uo   |     |
| e   | ie   |      | üe  |
| ai  |      | uai  |     |
| ei  |      | uei  |     |
| ao  | iao  |      |     |
| ou  | iou  |      |     |
| an  | ian  | uan  | üan |
| en  | in   | uen  | ün  |
| ang | iang | uang |     |
| eng | ing  | ueng |     |
| ong | iong |      |     |

表格第一行是 ⟨i, u, ü⟩ 三個韻母，他們可以用作介音，因此各自位於一豎行韻母的排頭。

表格左起第一豎行是不帶介音的韻母。按照順序，分別爲

  - 單元音⟨a, o, e⟩
  - 韻尾爲⟨-i⟩的雙元音⟨ai, ei⟩
  - 韻尾爲⟨-u⟩的雙元音⟨ao, ou⟩
  - 韻尾爲⟨-n⟩的前鼻音⟨an, en⟩
  - 韻尾爲⟨-ng⟩的後鼻音⟨ang, eng, ong⟩

他們與介音兩兩拼合，可得到表中的其他韻母。
通過表格，我們可以觀察到介音於韻的搭配關係，據此設計和理解並擊的組合鍵。

本文對上表需要補充的是：

1. 左列不帶介音的韻母，每個都是一個整體的符號，組成這些韻母的多個字母只描述大致的發音部位，不能直接按照字母拼出。
   特別是⟨ao, ong⟩兩個韻母中字母⟨o⟩對應的發音更接近元音⟨u⟩，而距元音⟨o⟩較遠。
   
2. 介音與韻的搭配，顯示了一定的規律性。
   如⟨ai, ei⟩只與介音⟨u⟩相拼、⟨ao, ou⟩只與介音⟨i⟩相拼；
   又如⟨o, e⟩在與介音的搭配上形成互補，⟨o⟩只在少量音節中與⟨e⟩形成對立且多爲語氣詞；
   與韻尾搭配，⟨ei, ou⟩也形成互補，因此有學者將⟨o, e⟩處理爲同一個音位。

3. ⟨ong, iong⟩兩個韻母，按照傳統的四呼分類、或是注音符號的拼法，分屬合口呼（⟨u⟩介音）、撮口呼（⟨ü⟩介音）；
   且⟨ueng, ong⟩這兩個韻母在與聲母的搭配上形成互補——⟨ueng⟩只拼零聲母或者說只用在自成音節的⟨weng⟩，而⟨ong⟩用於拼其他聲母。
   兩者無論從實際發音的近似性，還是歷史淵源，都可以視爲同一個韻母的條件變體。
   如果拋開方案擬定的拼寫，按照四呼的分類，可將⟨ong, iong⟩併入⟨eng⟩行合口呼（⟨u⟩介音）、撮口呼（⟨ü⟩介音）的位置。
   
至此，我們可以將普通話的韻母歸納爲 3 個介音、2 類韻核、4 種韻尾搭配組合的音位配列。

在宮保拼音的設計中，會運用我們對〈韻母表〉的分析，這可以幫助學習者理解並擊韻母的設置；
也會兼顧漢語拼音的拼寫法，用大家熟知的拼寫幫助記憶。

### 對韻母表的說明

方案在表後列出六條說明。這對理解《漢語拼音方案》和學習宮保拼音極爲重要，卻又是學校的拼音教育未涵蓋的內容，因此全文摘抄，並做說明。

>（1）“知、蚩、詩、日、資、雌、思”等七個音節的韻母用 i，即：知、蚩、詩、日、資、雌、思等字拼作 zhi，chi，shi，ri，zi，ci，si。
>
>（2）韻母ㄦ寫成 er，用作韻尾的時候寫成 r。例如：“兒童”拼作 ertong，“花兒”拼作 huar。
>
>（3）韻母ㄝ單用的時候寫成 ê。

這三條介紹了未列入表中的韻母：

  - “知、蚩、詩、日、資、雌、思”等七個音節的韻母，也可叫做舌尖元音。
    他的發音不同於⟨i⟩，且傳統音韻學將其分類爲開口呼而非齊齒呼。大致可以放入表中左上角空白的位置。
    本文爲了區別於⟨i⟩，把舌尖元音標記爲⟨ï⟩。注意這個符號不是《漢語拼音方案》的一部分。
    
  - 韻母⟨er⟩只獨用，不與聲母搭配。
    從歷史上看，⟨er⟩是從舌尖元音分化出來，也與舌尖元音形成互補。因此也可以併入左上角的單元格。
    
  - 韻母⟨ê⟩極少單用，但與介音相拼得⟨ie, üe⟩兩個韻母。反而是⟨e⟩不能與任何介音拼合。可知方案視⟨ê⟩爲⟨e⟩的變體。

>（4）i行的韻母，前面沒有聲母的時候，寫成 yi（衣），ya（呀），ye（耶），yao（腰），you（憂），yan（煙），yin（因），yang（央），ying（英），yong（雍）。\
>u行的韻母，前面沒有聲母的時候，寫成 wu（烏），wa（蛙），wo（窩），wai（歪），wei（威），wan（彎），wen（溫），wang（汪），weng（翁）。\
>ü行的韻母，前面沒有聲母的時候，寫成 yu（迂），yue（約），yuan（冤），yun（暈）；ü 上兩點省略。\
>ü行的韻母跟聲母 j，q，x 拼的時候，寫成 ju（居），qu（區），xu（虛），ü上兩點也省略；但是跟聲母 n，l 拼的時候，仍然寫成 nü（女），lü（呂）。
>
>（5）iou，uei，uen 前面加聲母的時候，寫成 iu，ui，un。例如 niu（牛），gui（歸），lun（論）。

這兩條介紹了漢語拼音韻母在音節中的拼寫規則。請熟知：

  - ⟨i, u, ü⟩與各種聲母拼合時的改寫方法、拼音字母⟨y, w⟩的使用；
  - ⟨iou, uei, uen⟩自成音節時（改寫首字母）以及與其他聲母拼合時（省略中間的元音字母）所得的兩種拼寫形式。
  
宮保拼音不使用這些拼寫規則。同一個韻母在不同的音節裏有一致的鍵位和指法。

>（6）在給漢字注音的時候，爲了使拼式簡短，ng可以省作ŋ。

⟨ng⟩ 是一個韻尾。包含⟨ng⟩的韻母，其發音部位較靠後，因此叫做「後鼻音」。本文將該韻尾表記爲⟨-ng⟩。

熟知了漢語拼音方案中的聲母、韻母和拼寫規則，再學習宮保拼音的聲母、韻母，就會思維透徹，條理清晰，事倍功半。

## 《宮保拼音》並擊方案詳解

建議初學者通讀本文後，到訪 [宮保拼音鍵位練習](https://lotem.github.io/typewriter/) 頁面練習指法。

### 鍵盤佈局

![鍵盤佈局圖](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-layout.png)

宮保拼音「七指禪」佈局，用到鍵盤左手半區的 W E R T, S D F G, X C V B 等字母鍵、右手半區的 U I O, J K L, M 等字母鍵，以及右手拇指操作的空格鍵。小指和左手拇指不用。這樣配置，並擊的指法難度大大降低。

本文的圖示只畫出並擊用到的按鍵所在的行、列。

鍵盤上的 F, J 兩鍵是盲打定位鍵，帶有凸點，在圖上有所顯示。
學習者可以憑借兩個定位鍵確定圖中其他按鍵在鍵盤上的位置。

### 鍵位與指法

![指法圖](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-touch-typing.png)

沿中軸線，上方的三行按鍵分爲左右兩個半區。

圖中標在鍵位上方、側方的數字是手指的解剖學編號，拇指爲 1 號手指，食指爲 2 號手指，依此類推。

左手半區的 12 個聲母鍵用左手 2, 3, 4 指操作。其中 2 號指負責兩列，與盲打指法相同。

這 12 個聲母鍵表示與其字母相同的聲母。可分爲四塊。按照聲母表順序有：

  - `[B][P][F]` 位於第三行，對應鍵盤上的字母 V, B, C
  - `[D][T][L]` 位於第一行，對應鍵盤上的字母 R, T, E
  - `[G][K][H]` 位於第二行，對應鍵盤上的字母 F, G, D
  - `[Z][C][S]` 位於縱向第一列，對應的鍵盤字母 X, W, S
  
其他 9 個未分配鍵位的聲母用並擊輸入。

各個縱列的分佈規律是：

  - 2 號指轄`[B][D][G]`、`[P][T][K]`。
    不送氣清音⟨b, d, g⟩位於盲點所在的列；送氣清音⟨p, t, k⟩在距盲點較遠的一列。
  - 3 號指轄`[F][L][H]`，即各行聲母中的邊音、擦音⟨f, l, h⟩。
  - 4 號指轄`[Z][C][S]`，即⟨z, c, s⟩這組聲母。

右手半區的韻母多用並擊。設有以下鍵位。

  - 2 號指轄 `[I][U][Ü]`，對應鍵盤上的字母 J, U, M
  - 1 號指轄 `[A]`，用在包含元音字母 ⟨a⟩ 的並擊韻母裏，這在所有韻母中佔到近半數。
  - 4 號指轄 `[O][E]`
  - 3 號指轄 `[N]` 表示韻尾 ⟨-n⟩、`[R]` 表示韻母 ⟨er⟩。用於並擊時，`[R]` 兼表韻尾 ⟨-i⟩ 或 ⟨-u⟩。
    兒化韻裏⟨-r⟩做韻尾；雖然本方案不支持兒化韻，但因爲這層關係，將 `[R]` 鍵歸入韻尾之列，並統轄非鼻音韻尾。

與 QWERTY 鍵盤上字母重合的宮保拼音鍵位有 `[S] [T] [U] [O]`。

### 並擊鍵序

宮保拼音的按鍵，並擊時不論按下的先後順序；然而在書寫並擊組合時，組合鍵要按照特定的順序排列以方便閱讀。

所有按鍵的書寫順序如下。左右兩個半區以 `-` 爲界。
各縱列從左到右排列，唯有 `A` 穿插到介音與韻尾之間的位置。

    SCZHLFGDBKTP-IUÜANREO

### 並擊鍵位濃縮圖

![並擊鍵位](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-chords.png)

### 並擊聲母

左手半區設有 3 組、共計 9 個並擊聲母。

#### zh, ch, sh

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-zh-ch-sh-ou-eng.png)

4 號指、3 號指並擊 `[Z][C][S]` 與右邊相鄰的鍵，得到並擊聲母⟨zh, ch, sh⟩。

  - `ZF` = ⟨zh⟩
  - `CL` = ⟨ch⟩
  - `SH` = ⟨sh⟩

`[ZH] [CH]` 需要錯行，指法不便利，故借用了與 `[H]` 同一列的鍵，改爲 `[ZF] [CL]`。

#### m, n, r

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-m-n-r-uei-in.png)

3 號指、2 號指並擊同一行的相鄰兩鍵，得到並擊聲母⟨m, n, r⟩。

  - `FB` = ⟨m⟩
  - `LD` = ⟨n⟩
  - `HG` = ⟨r⟩

⟨m⟩用同組的聲母 `[F][B]` 並擊，⟨n⟩用同組的聲母 `[L][D]` 並擊，二者皆是各組聲母中的鼻音。

⟨r⟩與`[H][G]`沒有直接關聯，他演化自中古漢語裏屬於鼻音聲母的日母，故與鼻音聲母並列。

#### j, q, x

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-j-q-x-iou-yun.png)

⟨j, q, x⟩復用 `[G][K][H]` 三鍵。兩組聲母在聲韻搭配上形成互補：
⟨g, k, h⟩只拼開口呼（無介音）、合口呼（⟨-u⟩介音）的韻母，而⟨j, q, x⟩只拼齊齒呼（⟨-i⟩介音）、撮口呼（⟨-ü⟩介音）的韻母。

這一規律反映在並擊指法上即爲：`[G][K][H]` 與 `[I]` 或 `[Ü]` 並擊時，代表聲母⟨j, q, x⟩。

#### 尖團音

分尖團的方言，`[G][K][H]` 與 `[I][Ü]` 並擊表示團音⟨j, q, x⟩，
用 `[Z][C][S]` 與 `[I][Ü]` 並擊，表示與其對立的尖音。

普通話不分尖團，不用這組並擊聲母。

### 並擊韻母

右手半區大量設置並擊韻母。

#### 單韻母

8 個韻母鍵各自代表一個韻母：

  - `[I]` = ⟨i⟩
  - `[U]` = ⟨u⟩
  - `[Ü]` = ⟨ü⟩
  - `[A]` = ⟨a⟩，單擊爲空格
  - `[O]` = ⟨o⟩
  - `[E]` = ⟨e⟩
  - `[R]` = ⟨er⟩，與⟨zh⟩組、⟨z⟩組聲母並擊表示舌尖元音⟨ï⟩，但通常省略
  - `[N]` = ⟨en⟩

介音與韻的組合，無一例外用 `[I][U][Ü]` 與其他韻母並擊。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-uo-ie.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-io-yue.png)

`[A]` 鍵單擊爲空格鍵，用於輸入空格、選字等操作。
  
![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-space.png)

音節⟨'a⟩用特定並擊組合 `[AE]` 輸入。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-a-ia-ua.png)

#### 複韻母

雙元音⟨ai, ei, ou⟩用 `[R]` 鍵與 `[A][E][O]` 並擊。`[R]` 代表韻尾 ⟨-i⟩ 或 ⟨-u⟩。
  
雙元音⟨ao⟩用`[AO]`並擊。韻尾的⟨-u⟩用與拼寫一致的 `[O]` 表示。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-ai-ao-an.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-ei-uen.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-zh-ch-sh-ou-eng.png)
  
雙元音與介音相拼，得⟨iao, iou, uai, uei⟩。
 
![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-iao-yuan.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-j-q-x-iou-yun.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-uai-ian.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-m-n-r-uei-in.png)

⟨iou⟩省略中間的元音字母，並擊 `[IR]`；
⟨uei⟩省略中間的元音字母，並擊 `[UR]`。

不同於漢語拼音的拼寫規則，上述省略形式也用於零聲母音節⟨you, wei⟩。

#### 鼻韻母

`[N]` 爲韻尾 ⟨-n⟩，`[NE]` 爲韻尾 ⟨-ng⟩。
不與其他元音字母鍵並擊時，二者分別代表韻母⟨en, eng⟩，省略拼音字母⟨e⟩。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-i-u-yu-er-en-o-e.png)
    
![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-zh-ch-sh-ou-eng.png)

按照四呼拼讀，⟨en, in, uen, ün⟩分別爲並擊 `[N], [IN], [UN], [ÜN]`。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-m-n-r-uei-in.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-ei-uen.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-j-q-x-iou-yun.png)

按照四呼拼讀，⟨eng, ing, ueng/ong, iong⟩分別爲並擊 `[NE], [INE], [UNE], [ÜNE]`。
    
`[UNE]` = ⟨ueng/ong⟩，需要錯行並擊，可借用 `[U]` 所在行的 `[RO]` 兩鍵代替 `[NE]`。於是有：

`[URO]` = ⟨ueng/ong⟩。相鄰三鍵並擊，指法便利。也可以看作爲⟨ong⟩的拼寫而設置的並擊組合鍵。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-ing-ong.png)
    
`[ÜNE]` = ⟨iong⟩，可以把三鍵同時上移到 `[IRO]` 的位置，使該並擊韻母更符合拼寫。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-iong.png)

`[A]` 與 `[N]` 並擊爲韻母⟨an⟩。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-ai-ao-an.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-uai-ian.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-uan.png)

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-iao-yuan.png)

`[A]` 與 `[NE]` 並擊爲韻母⟨ang⟩。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-ang.png)

`[A]` 與 `[INE], [URO]` 並擊，分別爲韻母⟨iang, uang⟩。

![](https://github.com/rime/home/blob/master/images/combo-pinyin-v3/combo-pinyin-iang-uang.png)

### 韻母的缺省與通借

通借，即通假。是速記技術中，復用基本符號、利用空閒編碼空間、簡化速記符號的方法。

並擊碼的通借是在一定的音韻學規律下，將不構成有效音節的並擊組合借作他用，簡化並擊的指法。

前文已經介紹過如將 `[ZH], [CH]` 優化爲指法便利的 `[ZF], [CL]`，將 `[UNE]` 中的 `[NE]` 改爲與 `[U]` 在同一行的 `[RO]`。
這些都是通借的例子。

如果不熟悉本節介紹的韻母缺省與通借的適用條件，學習者可以一律並擊完整的韻母，在今後的使用中逐漸總結發現可通借的規律，達到簡省擊鍵的目的。

#### 缺省韻母

並擊輸入的特點是，一次並擊輸入一個（或多個）完整音節。

因此，當只擊出韻母、聲母空缺時，表示拼零聲母，或者說韻母自成音節。

只擊出聲母、韻母空缺時，由於韻母是拼音輸入法裏音節的必要成分，故添加一個缺省韻母，與聲母拼成一個常用音節。

⟨u, e, ï⟩可以充當缺省韻母，以下按照聲母表分組列出。

    [B] = ⟨bu⟩
    [P] = ⟨pu⟩
    [F] = ⟨fu⟩
    [FB] = ⟨me⟩

該組聲母的呼讀音⟨bo, po, mo, fo⟩對應的音節不十分常用，因而規定缺省韻母的音節爲⟨bu, pu, fu⟩和⟨me⟩，對應「不、麼」等常用字。

    [D] = ⟨de⟩
    [T] = ⟨te⟩
    [L] = ⟨le⟩
    [LD] = ⟨ne⟩

該組聲母的呼讀音⟨de, te, ne, le⟩用於輸入語助詞「的、了」等常用字。

    [G] = ⟨ge⟩
    [K] = ⟨ke⟩
    [H] = ⟨he⟩

該組聲母的呼讀音⟨ge, ke, he⟩皆常用，故設爲缺省韻母。

⟨j, q, x⟩必須與韻母並擊，因此不設缺省韻母。

    [ZF] = ⟨zhi⟩
    [CL] = ⟨chi⟩
    [SH] = ⟨shi⟩
    [HG] = ⟨ri⟩

    [Z] = ⟨si⟩
    [C] = ⟨si⟩
    [S] = ⟨si⟩

這兩組聲母的缺省韻母爲舌尖元音⟨ï⟩。

因爲在音節中的舌尖元音全部是缺省韻母，所以表示舌尖元音的 `[R]` 通常省略。

#### R 通借爲 ei

`[R]` 鍵單用表示獨立的韻母⟨er⟩；他與⟨zh⟩組、⟨z⟩組聲母並擊表示舌尖元音⟨ï⟩；而其他各組聲母不與之相拼。
於是，以下三組聲母可以借用 `[R]` 鍵表示拼韻母⟨ei⟩。

    [BR] = ⟨bei⟩
    [PR] = ⟨pei⟩
    [FR] = ⟨fei⟩
    [FBR] = ⟨mei⟩

    [DR] = ⟨dei⟩
    [TR] = ⟨tei⟩
    [LR] = ⟨lei⟩
    [LDR] = ⟨nei⟩

    [GR] = ⟨gei⟩
    [KR] = ⟨kei⟩
    [HR] = ⟨hei⟩

然而，⟨zhei, shei, zei, cei, sei⟩與⟨zhi, shi, zi, ci, si⟩存在對立，這組聲母拼⟨ei⟩不可以借用 `[R]`。

#### RO 通借爲 -ng

前文已經介紹過：

並擊 `[UNE]` = ⟨ueng/ong⟩, `[UANE]` = ⟨uang⟩ 需要錯指，改爲指法便利的 `[URO]`, `[UARO]`；
這利用了韻母⟨ou⟩不能與介音⟨u⟩拼合的性質。

並擊 `[ÜNE]` = ⟨iong⟩，改爲 `[IRO]` 使該並擊韻母更符合拼寫；
這得益於韻母⟨iou⟩在本方案中採用固定的並擊碼 `[IR]` 從而使 `[IRO]` 空缺。

## 結語

至此，宮保拼音的並擊方案介紹完了。
這是並擊技術與電腦軟硬件、與漢語言文字的美妙結合。

要享受並擊輸入的便利，輕鬆自如地鍵字，須在理解和記憶本方案的基礎上，通過不斷的練習形成字音到並擊鍵位的條件反射。

建議初學者通讀本文後，到訪 [宮保拼音鍵位練習](https://lotem.github.io/typewriter/) 頁面練習指法。

本文用到的所有圖表彙編成卷，供用家參考。
https://github.com/rime/home/blob/master/manual/combo-pinyin-cheatsheet.pdf

輸入技術，亦無他，惟手熟耳。
Rime 輸入法多平臺可及，宮保拼音的並擊方案對電腦鍵盤做了最大程度的兼容，於是用家初步掌握後即可在工作、學習中充分鍛鍊，達到慣用。

宮保拼音還在探索適配特殊配列鍵盤、加入縮略碼等速錄的機制。有關這些方向的發展，請關注 [rime/rime-combo-pinyin](https://github.com/rime/rime-combo-pinyin) 代碼庫的更新。

祝你打字愉快！


# 詞典擴展包

## 概述

librime 1.6.0 增加了一種擴展詞典內容的機制——詞典擴展包。可用於爲固定音節表的輸入方案添加詞彙。

固態詞典包含`*.table.bin`和`*.prism.bin`兩個文件。
前者用於存儲來自詞典源文件`*.dict.yaml`的數據，後者綜合了從詞典源文件中提取的音節表和輸入方案定義的拼寫規則。

擴充固態詞典內容，舊有在詞典文件的YAML配置中使用`import_tables`從其他詞典源文件導入碼表的方法。
此法相當於將其他源文件中的碼表內容追加到待編譯的詞典文件中，再將合併的碼表編譯成二進制詞典文件。

詞典擴展包可以達到相似的效果。其實現方式有所不同。
編譯過程中，將額外的詞典源文件`*.dict.yaml`生成對應的`*.table.bin`，其音節表與主碼表的音節表保持一致。
使用輸入方案時，按照`translator/packs`配置列表中的包名加載額外的`*.table.bin`文件，多表並用，從而一併查得擴充的詞彙。

## 示例

我有一例，請諸位靜觀。

```shell
# 在Linux環境做出librime及命令行工具
cd librime
make

# 準備示例文件（有三）
# 做一個構建擴展包專用的方案，以示如何獨立於主詞典的構建流程。
# 如果不需要把擴展包和主詞典分開製備，也可以用原有的輸入方案。
cat > build/bin/luna_pinyin_packs.schema.yaml <<EOF
# Rime schema
schema:
  schema_id: luna_pinyin_packs

translator:
  dictionary: luna_pinyin_packs
  packs:
    - sample_pack
EOF

# 代用的主詞典。因爲本示例只構建擴展包。
# 做這個文件的目的是不必費時地編譯導入了預設詞彙表的朙月拼音主詞典。
# 如果在主詞典的構建流程生成擴展包，則可直接使用主詞典文件。
cat > build/bin/luna_pinyin_packs.dict.yaml <<EOF
# Rime dict
---
name: luna_pinyin_packs
version: '1.0'
sort: original
use_preset_vocabulary: false
import_tables:
  - luna_pinyin
...

EOF

# 擴展包源文件
cat > build/bin/sample_pack.dict.yaml <<EOF
# Rime dict
---
name: sample_pack
version: '1.0'
sort: original
use_preset_vocabulary: false
...

粗鄙之語	cu bi zhi yu
EOF

# 製作擴展包
(cd build/bin; ./rime_deployer --compile luna_pinyin_packs.schema.yaml)
# 構建完成後可丟棄代用的主詞典，只留擴展包
rm build/bin/build/luna_pinyin_packs.*

# 重新配置朙月拼音輸入方案，令其加載先時生成的詞典擴展包
(cd build/bin; ./rime_patch luna_pinyin 'translator/packs' '[sample_pack]')
# 驗證詞典可查到擴展包中的詞語
echo 'cubizhiyu' | (cd build/bin; ./rime_console)
```

## 總結

與編譯詞典時導入碼表的方法相比，使用詞典擴展包有兩項優勢：

  - 擴展包可以獨立於主詞典及其他擴展包單獨構建，增量添加擴展包不必重複編譯完整的主詞典，減少編譯時間及資源開銷；
  - 詞典擴展包的編譯單元與詞典源文件粒度一致，方便組合使用，增減擴展包只須重新配置輸入方案。

需要注意的是，查詢時使用主詞典的音節表，這要求擴展包使用相同的音節表構建。
目前librime並沒有機制保證加載的擴展包與主詞典兼容。用家須充分理解該功能的實現機制，保證數據文件的一致性。
這也意味着二進制擴展包不宜脫離於主詞典而製作和分發。


# 配方

配方也記作 ℞，是由 [東風破](https://github.com/rime/plum) 配置管理工具所支持的 Rime 數據分發形式。

配方可以用來安裝輸入方案、修改配置、實現自定義功能。

## 用配方管理自定義配置

將所需輸入方案及自定義配置項全部以配方形式列出，則可以按照列表自動完成各項配置動作，或在全新的用戶文件夾還原輸入法的自定義配置。
（爲最大限度還原使用習慣，還需要另行同步用戶詞典的數據。）

以下示例 bash 腳本爲 [鼠鬚管](https://github.com/rime/squirrel) 安裝輸入方案並修改個人偏好。

配方列表 `recipes` 中的定製內容爲：
  - 安裝「預設方案集」「國際音標」「繪文字」
  - 方案選單設定爲啓用「地球拼音」「雲龍國際音標」
  - 設定在「地球拼音」中列出繪文字候選
  - 設定鼠鬚管的配色方案
  - 設定候選字列表橫排

```bash
#!/bin/bash

recipes=(
  :preset
  ipa
  emoji
  emoji:customize:schema=terra-pinyin
  custom:clear_schema_list
  custom:add:schema=terra_pinyin
  custom:add:schema=ipa_yunlong
  custom:set:config=squirrel,key=style/color_scheme,value=aqua
  custom:set:config=squirrel,key=style/horizontal,value=true
)

bash rime-install "${recipes[@]}" || exit 1
"/Library/Input Methods/Squirrel.app/Contents/MacOS/Squirrel" --reload
```

> La Rime HowTo for Developers

# How to Rime with the Code

## Get the Code

Fork Rime on [GitHub](https://github.com/rime):

  * La rime - the core library
    <https://github.com/rime/librime>

  * /plum/ - Rime configuration manager and input schema repository
    <https://github.com/rime/plum>

  * ibus-rime - Linux client powered by IBus
    <https://github.com/rime/ibus-rime>

  * Weasel - Windows client
    <https://github.com/rime/weasel>

  * Squirrel - macOS client
    <https://github.com/rime/squirrel>

## How to Rime with the OS

[[Instructions|RimeWithIBus]] on building and installing ibus-rime.

[[Instructions|RimeWithSquirrel]] on building Squirrel on macOS.

[[Instructions|RimeWithWeasel]] on building Weasel on Windows.

## Report Issues

Prefer to report issues to a specific repo. Pull requests are welcome.

If you can't decide where to file an issue, for example if the issue doesn't belong to a specific project, or if the issue is about [the project home page](http://rime.github.io), documentation or issue tracking, please report to [Rime::Home](https://github.com/rime/home/issues).


# 下載 Rime 輸入法

去 [Rime 主站下載頁](http://rime.github.io/download)

> Instructions to build Weasel on Windows.

Please refer to
https://github.com/rime/weasel/blob/master/INSTALL.md


# librime for Emacs

https://github.com/merrickluo/liberime

https://github.com/DogLooksGood/emacs-rime, a frontend of librime for Emacs.


# Squirrel Release Manual

1.  Update the version of `squirrel/data/squirrel.yaml` if there are changes since last release.

1.  Run `package/bump_version` to update app version; push the commit and version tag to GitHub.

    Pushing the version tag will trigger a release CI build on GitHub Actions.

1.  At the [GitHub Releases](https://github.com/rime/squirrel/releases) page, edit the draft release created from CI, publish it as latest release, then download the zip archive.

1.  Copy/move the downloaded file to local source tree, under `squirrel/package/`.

1.  Put private key file in `squirrel/package/sign/`.

    The private key for signing auto-update Squirrel releases is owned by Rime Keyholder.

1.  In [GitHub Actions](https://github.com/rime/squirrel/actions), find the release CI workflow run with the version tag, then copy the sha256 checksum from build log, near the end of "Build Squirrel" step.

    For example:

        bash package/make_archive
        adding: Squirrel.pkg (deflated 0%)
        sha256 checksum:
        8f3f3e9aa2e923e88220ea603dcbd3b70c3a88d8177a6c487cfdccc946b25379  Squirrel-0.16.1.zip

1.  Run
    ```shell
    make sign-archive checksum=8f3f3e9aa2e923e88220ea603dcbd3b70c3a88d8177a6c487cfdccc946b25379
    ```
    The script generates `package/*appcast.xml`.

1.  Prepare to update project website.

    Assume GitHub repo `rime/<project>` is cloned to local directory `./<project>`; do
    ```shell
    cp squirrel/package/appcast.xml home/blog/source/release/squirrel/appcast.xml
    cp squirrel/package/testing-appcast.xml home/blog/source/testing/squirrel/appcast.xml

    cat <<EOF > home/blog/source/release/squirrel/index.md
    title: 【鼠鬚管】更新日誌
    comments: false
    $(date '+date: %Y-%m-%d %H:%M:%S')
    ---

    EOF
    cat squirrel/CHANGELOG.md >> home/blog/source/release/squirrel/index.md
    cp home/blog/source/release/squirrel/index.md  home/blog/source/testing/squirrel/index.md
    ```

1.  Also update latest Squirrel version and download URL in
    - `home/blog/source/_data/downloads.yaml`
    - `home/blog/source/download/index.md`

1.  Test the website locally with Hexo:
    ```shell
    npm install -g hexo-cli
    cd home/blog
    npm install
    hexo server
    open http://0.0.0.0:4000/
    ```
    Verify the updated links are valid.

1.  Commit changes with commit message `chore(release): squirrel ${version} :tada:` and push to [`rime/home`](https://github.com/rime/home).

    This will trigger automated update to the site <https://rime.im>.



# weasel 發佈手冊

TODO: 更新該文檔，以反映自動化發佈流程

1.  在 [Trello](https://trello.com/b/iUJWFnjb/rime-development) 或筆記本上闢一葉紙，記下主要更新內容，方便粘貼到更新日誌。
    例如 https://trello.com/c/WieadeZt
1.  對比上次發佈（git tag），檢查 `weasel.yaml` 是否需要更新版本號。
    注：檢查配置更新的機制改動後，這一步不嚴格要求。但仍建議更新小狼毫配置同時升級該配置文件的版本。
1.  代碼交齊後，用工具根據慣例格式生成變更記錄。（這一步合併到 `update/bump-version.sh` 腳本中）
    以 clog-cli 爲例，爲新版本 0.11.0 生成變更記錄，做法是
    ``` sh
    # cargo install clog-cli
    cd weasel
    clog --from-latest-tag \
        --changelog CHANGELOG.md \
        --repository https://github.com/rime/weasel \
        --setversion 0.11.0
    ```
1.  把手寫的「主要更新」列在變更記錄文件中本次發佈的標題下，格式（包括空行）須與自動生成的段落相同：
    ``` markdown
    <a name="0.11.0"></a>
    ## 0.11.0 (2018-04-07)


    #### 主要更新

    * 新增 [Rime 配置管理器](https://github.com/rime/plum)，通過「輸入法設定／獲取更多輸入方案」調用
    * 在輸入法語言欄顯示狀態切換按鈕（TSF 模式）
    * 修復多個前端兼容性問題
    * 新增配色主題「現代藍」`metroblue`、「幽能」`psionics`

    #### Features
    ```
1.  提交對變更記錄的修改（可以與版本號的修改合併爲一條提交記錄）
    ``` sh
    git commit --all --message "docs(CHANGELOG.md): release 0.11.0"
    ```
1.  用腳本更新輸入法程序的版本號，並提交修改過的文件（腳本會在最後調用 `clog` 提取更新日誌）
    ``` sh
    update/bump-version.sh # print usage
    update/bump-version.sh 0.10.0 0.11.0

    git commit --all --message "chore(release): 0.11.0 :tada:"
    ```
1.  以上提交在 `master` 完成。如果在另一個分支發佈，如 `legacy`，則將以上修改合併到分支。
1.  push 所有修改到 GitHub。檢驗 CI build：下載安裝程序，測試全新安裝以及從上一個推送版本升級。
1.  確認該版本可發佈後，在 `master` 或要做發佈的分支上打標籤。推送標籤到 GitHub 會在安裝包構建完成後自動觸發發佈到 bintray release 頻道的部署作業。
    ``` sh
    git tag --annotate 0.11.0 --message "chore(release): 0.11.0 :tada:"
    git push --tags
    ```
1.  AppVeyor 已經創建好了版本，並上傳了文件，只等一鍵發佈。如果手動完成，這個過程爲：
    將（release tag 觸發的） CI build 生成的安裝包上傳到 bintray。
    在 https://bintray.com/rime/weasel/release 新建版本 (New version)，命名爲版本號 `0.11.0`，描述：`小狼毫 0.11.0`。
    爲新建的版本上傳文件 `weasel-0.11.0.0-installer.exe`。
1.  生成顯示在推送更新介面的變更記錄。只包含 `CHANGELOG.md` 的最新版本章節，格式爲樸素的 HTML 網頁。
    ``` sh
    # npm install --global marked
    update/write-release-notes.sh
    ```
    留存生成的 `release-notes.html` 文件備用。
1.  使用 [Hexo](https://hexo.io/) 在官方網站 <rime.im> 發佈更新。

    ``` sh
    git clone https://github.com/rime/home.git rime-home
    cd rime-home/blog
    npm install

    npm install --global hexo-cli

    # TODO(keyholder): edit files
    cp ~/code/rime/weasel/update/appcast.xml ~/code/rime/home/blog/source/release/weasel/appcast.xml
    cp ~/code/rime/weasel/update/testing-appcast.xml ~/code/rime/home/blog/source/testing/weasel/appcast.xml
    cp ~/code/rime/weasel/release-notes.html ~/code/rime/home/blog/source/release/weasel/release-notes.html
    cp ~/code/rime/weasel/release-notes.html ~/code/rime/home/blog/source/testing/weasel/release-notes.html

    cat <<EOF > ~/code/rime/home/blog/source/release/weasel/index.md
    title: 【小狼毫】更新日誌
    comments: false
    $(date '+date: %Y-%m-%d %H:%M:%S')
    ---

    EOF
    cat ~/code/rime/weasel/CHANGELOG.md >> ~/code/rime/home/blog/source/release/weasel/index.md
    cp ~/code/rime/home/blog/source/release/weasel/index.md  ~/code/rime/home/blog/source/testing/weasel/index.md
    ```

    需要修改的內容包括：

    - [首葉](https://rime.im/) 的下載按鈕：[源代碼](https://github.com/rime/home/blob/master/blog/source/_data/downloads.yaml)
    - [下載葉](https://rime.im/download/) 的版本號及下載鏈接：[源代碼](https://github.com/rime/home/blob/master/blog/source/download/index.md)
    - [更新日誌](https://rime.im/release/weasel/)，
      更新 [源代碼](https://github.com/rime/home/blob/master/blog/source/release/weasel/index.md) 文件頭的 `date` 字段，
      並用 `weasel/CHANGELOG.md` 的內容替換 Markdown 正文部份（YAML 結束標記 `---` 及隨後空行以下）
    - [推送更新頻道](https://rime.im/release/weasel/appcast.xml)，
      將 [源代碼](https://github.com/rime/home/blob/master/blog/source/release/weasel/appcast.xml) 替換爲第 5 步修改過的 `weasel/update/appcast.xml`
    - [推送更新提示](https://rime.im/release/weasel/release-notes.html)，
      將 [源代碼](https://github.com/rime/home/blob/master/blog/source/release/weasel/release-notes.html) 替換爲第 10 步生成的 `release-notes.html`

    測試頻道（用於手動檢查更新）自動化調試就緒前，將 `blog/source/release/weasel/` 的內容複製到 `blog/source/testing/weasel/`，唯獨需要用 `weasel/update/testing-appcast.xml` 更新 `blog/source/testing/weasel/appcast.xml`。

1.  修改完成後，在本地調試網站。

    ``` sh
    # check your changes with local HTTP server
    hexo server
    ```

    方法爲：將以上修改過的網葉地址中的域名部份替換爲 Hexo 提示的本地服務器地址，在瀏覽器中預覽各個網葉，檢查文字內容和鏈接地址。

1.  確認內容無誤，用 Hexo 發佈網站。

    ``` sh
    # first time releaser, setup without deployment
    hexo deploy --setup

    # source XML/HTML files in generated folder may not get updated.
    hexo clean

    # publish website at rime.github.io
    hexo deploy --generate
    ```

    發佈完成後，可以在 https://github.com/rime/rime.github.io/commits/master 複查提交到 GitHub Pages 的修訂。

1.  提交以上修改到 `rime/home` 代碼庫。

1.  如果本次發佈不是針對小狼毫 0.9 的升級版本（見第 6 步），發佈至此完成。
    否則需要在驗證新版本工作正常後，將其推送到位於 <rimeime.github.io> 的舊更新頻道。

    首先需要取得 [rimeime.github.io](https://github.com/rimeime/rimeime.github.io) 的寫權限。

    ``` sh
    git clone https://github.com/rimeime/rimeime.github.io
    cd rimeime.github.io
    ```

1.  編輯 `weasel-update/appcast.xml` 以及 `weasel-update/pioneer/appcast.xml`：
    從第 5 步的 `weasel/update/appcast.xml` 複製 `<item>` 標籤的內容，視情況修改 `channel > title` 文字中的升級終點版本號。

    當前版本同時在新、舊兩個更新頻道發佈，因此不必修改 <rimeime.github.io> 的更新日誌。
    因爲根據 `appcast.xml` 中 `<sparkle:releaseNotesLink>` 的定義，推送更新提示一律從新官網 <rime.github.io> 加載。

1.  最後提交修改，發出 pull-request。修改併入 `master` 即開始推送更新。


# FAQs

### 如何定製輸入法？

請查閱[[定製指南|CustomizationGuide]]。

### 如何卸載鼠鬚管（Squirrel）？

1. 開啓系統輸入法設定面板，移除「鼠鬚管」。
2. 打開 Finder 並按下 command+shift+G 前往 `/Library/Input Methods` 檔案夾，移除「鼠鬚管.app」。
3. 如上，前往 `~/Library` 並移除個人鼠鬚管設定資料夾 `Rime`。
4. 重新登入系統，確保清理完畢。

### 如何使用雙拼時，啟動臺灣繁體習慣用字？（Linux + ibus或fcitx）
例如：

    爲→為
    啓→啟
    着→著
    裏→裡
    麪→麵 …等
1. 在方案Schema裡面，switches項目之下加：

    \- name: zh_tw  
    &nbsp;&nbsp;  reset: 1

2. Schema檔案中再來多件一項simplifier項目（在reverse lookup下面位置），如下：

    simplifier:  
    &nbsp;&nbsp;opencc_config: t2tw.json  
    &nbsp;&nbsp;option_name: zh_tw

3. 輸入引擎（ibus或fcitx）重新開啟後，就應該成功打出《麵包》、《裡面》等臺灣繁體字。  
（註：schema檔案在 ~/.config/ibus/rime/ 裡面）

Windows用戶的簡單設定方法：
1. 按下Windows鍵
2. 尋找【小狼毫輸入法設定】 
3. 選擇【繁體正題】
4. 