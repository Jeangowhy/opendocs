
# =üö© File & Folder

binary file

```py
numbs = array.array('H', [0x62, 0xfa, 0x10]) # must be same type

# Write binary data to a file
with open('filebinary.bin', 'wb') as fl:
    fl.write(b'Hello World')
    fl.write(numbs)
    fl.write(b'\0\1\2\3')
    fl.write(b"\x62\xfa\x10")

# Read the entire file as a single byte string
with open('filebinary.bin', 'rb') as fl:
    allBinData = fl.read()
    print(allBinData)
```


The following example uses the `dir_fd` parameter of the `os.open()` function to open a file relative to a given directory:


>>> import os
>>> dir_fd = os.open('somedir', os.O_RDONLY)
>>> def opener(path, flags):
...     return os.open(path, flags, dir_fd=dir_fd)
...
>>> with open('spamspam.txt', 'w', opener=opener) as f:
...     print('This will be written to somedir/spamspam.txt', file=f)
...
>>> os.close(dir_fd)  # don't leak a file descriptor




# =üö© gzip
- https://docs.python.org/3/library/gzip.html

    import gzip

    plaintext = 'testing'
    filename = 'foo.gz'
    with gzip.open(filename, 'wb') as outfile:
        outfile.write(bytes(plaintext, 'UTF-8'))
    with gzip.open(filename, 'r') as infile:
        outfile_content = infile.read().decode('UTF-8')
    print(outfile_content)


    s = b'testing'
    s = gzip.compress(s)
    print(s)
      
    # using gzip.decompress(s) method 
    t = gzip.decompress(s) 
    print(t) 

# =üö© zlib
- https://docs.python.org/3/library/zlib.html

    import zlib

    plaintext = 'testing'

    s = b'testing'
    s = zlib.compress(s)
    print(s)
      
    # using zlib.decompress(s) method 
    t = zlib.decompress(s) 
    print(t) 



# =üö© urllib & threading Â§öÁ∫øÁ®ã‰∏ãËΩΩÂô® MTD

    # coding = UTF-8
    # download lazyload image from https://www.192td.com/meitu/79701/
    # cls && python mtd.py -u https://www.192td.com/meitu/79701/


    import urllib.request, re, os, sys, getopt, queue, socket, threading
    from pprint import pprint

    socket.setdefaulttimeout(3)

    # urllib.request.Request(url, data=None, context=context, headers={}, origin_req_host=None, unverifiable=true, method=None)
    headers = {
        "method": "GET",
        "authority": "www.ttbcdn.com",
        "path": "/d/file/p/2017-12-11/960151b51b53ef46d37ea3599aefbd6a.jpg",
        "scheme": "https",
        "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3",
        "accept-encoding": "gzip, deflate, br",
        "accept-language": "zh-CN,zh;q=0.9,en;q=0.8,pt;q=0.7,zh-TW;q=0.6",
        "cache-control": "max-age=0",
        "cookie": "__cfduid=dff07b97871979c3e3da5748476b0af721572948329",
        "if-modified-since": "Sun, 10 Dec 2017 17:31:56 GMT",
        "if-none-match": "5a2d6f8c-15313",
        "referer": "https://www.192td.com/meitu/79700/",
        "sec-fetch-mode": "navigate",
        "sec-fetch-site": "none",
        "sec-fetch-user": "?1",
        "upgrade-insecure-requests": "1",
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.87 Safari/537.36",
    }

    def getHTML(url, decode="UTF-8"):
        page = urllib.request.urlopen(url)
        html = page.read()
        page.close()
        return html.decode(decode)

    def getLazyLink(html, regexp=r'(?:lazysrc=)\r\n(.+\.jpg)'):
        reg = re.compile(regexp)
        lazy = reg.findall(html)
        return lazy

    # compile the regular expressions and find
    # all stuff we need
    def getUrls(html, regexp=r'(?:href|HREF)="?((?:http://)?.+?\.pdf)'):
        reg = re.compile(regexp)
        urls = reg.findall(html)
        return(urls)

    def getFile(url, folder):
        name = os.path.basename(url) # url.split("/")[-1]
        print("‚ñ∂ Start downlaod: %s %s" % (folder, name))
        # file = urllib.request.urlopen(url=url, data={"headers": headers})
        # data = urllib.parse.urlencode({"a":"b"})
        req  = urllib.request.Request(url=url, headers=headers)
        file = urllib.request.urlopen(req)
        out = open(os.path.join(folder, name), 'wb')

        block = 8192
        while True:
            buffer = file.read(block)
            if not buffer:
                break
            out.write(buffer)
        file.close()
        print("‚úì Sucessful downlaod: %s" % name)


    class MT (threading.Thread):
        def __init__(self, mtd, threadID, name, folder):
            threading.Thread.__init__(self)
            self.threadID = threadID
            self.mtd = mtd
            self.name = name
            self.folder = folder

        def run(self):
            # print("Thread Start: " + self.name)
            self.worker(self.name, self.folder)
            # print("Thread Exit: " + self.name)

        def worker(self, threadName, folder):
            workQueue = self.mtd.workQueue
            taskList = self.mtd.taskList
            queueLock = self.mtd.queueLock
            while not self.mtd.exitFlag:
                print("‚öê %s starting..." % (threadName))
                queueLock.acquire()
                if not workQueue.empty():
                    url = workQueue.get()
                    queueLock.release()
                else:
                    queueLock.release()
                    return

                # time.sleep(1)
                it = os.path.basename(url)
                target = os.path.join(folder, it)
                # 2<<19 1024kb  2<<18 512kb 2<<17 256kb 3<<17 384kb
                # if os.path.exists(target):
                if os.path.exists(target) and os.path.getsize(target) > 2 << 15:
                    size = os.path.getsize(target)
                    print("‚öê File exists %d KB %s" % (size/1024, target))
                    continue
                if os.path.exists(target):
                    kb = os.path.getsize(target) / 1024
                    print("‚öê %d kb tiny file %s" % (kb, it))

                queueLock.acquire()
                taskList.append(it)
                queueLock.release()
                try:
                    getFile(url, folder)
                    workQueue.task_done()
                except urllib.error.HTTPError as e:
                    pprint(['‚ùå HTTP error', url, e.info, e.code, e.msg])
                except socket.timeout as e:
                    print("‚è± %s %s %s" % (threadName, it, str(e)))
                    queueLock.acquire()
                    workQueue.put(url)
                    queueLock.release()
                except Exception as e:
                    print('‚ùå error %s %s', url, e)

                queueLock.acquire()
                taskList.remove(it)
                queueLock.release()
                print("‚ñ∂ Task list %d" % (workQueue.qsize()))

    class MTD:
        def __init__(self, urls, folder):
            self.exitFlag = 0
            self.taskList = []
            self.queueLock = threading.Lock()

            threads = []
            threadID = 1
            threadList = [
                "Thread #1", "Thread #2", "Thread #3", "Thread #4",
                "Thread #5", "Thread #6", "Thread #7", "Thread #8"
            ]

            try:
                self.workQueue = self.initQueue(urls)
                # ÂàõÂª∫Êñ∞Á∫øÁ®ã
                for tName in threadList:
                    thread = MT(self, threadID, tName, folder)
                    thread.start()
                    threads.append(thread)
                    threadID += 1

                # Á≠âÂæÖÈòüÂàóÊ∏ÖÁ©∫
                while not self.workQueue.empty() and self.exitFlag == 0:
                    pass
                # ÈÄöÁü•Á∫øÁ®ãÊòØÊó∂ÂÄôÈÄÄÂá∫
                self.exitFlag = 1

            except(KeyboardInterrupt, SystemExit) as e:
                self.exitFlag = 1
                print("KeyboardInterrupt or SystemExit, Please wait for thread return ...")
                print(e)

            # Á≠âÂæÖÊâÄÊúâÁ∫øÁ®ãÂÆåÊàê
            for t in threads:
                t.join()

            print('DONE!')

        def initQueue(self, urls):
            # Â°´ÂÖÖÈòüÂàó
            self.queueLock.acquire()
            self.workQueue = queue.Queue(len(urls))
            for it in urls[:]:
                self.workQueue.put(it)
            print("Queue initlized and file count: %d" % len(urls))
            self.queueLock.release()
            return self.workQueue


    def main(argv):
        url = ""
        out = "lazy"
        usage = "Usage: %s -u https://www.192td.com/meitu/79701/ -o 79701" % argv[0]
        try:
            opts, args = getopt.getopt(argv[1:], "u:o:",["url=","out="])
            for opt, arg in opts:
                if opt in ("-u", "--url"):
                    url = arg
                elif opt in ("-o", "-out"):
                    out = arg
            if out=="lazy":
                li = url.split("/")
                out = os.path.basename(url)
                if out=="":
                    out = li[-2]
        except getopt.GetoptError:
            print(usage)
            sys.exit(1)
        if url != "":
            os.path.exists(out) or os.mkdir(out)
            path = os.path.join(os.getcwd(), out)
            
            html = getHTML(url)
            links = getLazyLink(html)
            print(links, "\n\n", path, url, out, len(links), "\n\n")
            MTD(links, path)
        else:
            print(usage)

    if __name__ == "__main__":
       main(sys.argv)






# =üö© wechat ÁôªÂΩïÊ®°Êãü
[itchat ÊïôÁ®ã](https://itchat.readthedocs.io/zh/latest/tutorial/tutorial1/)

‰ΩøÁî®ÁöÑÁéØÂ¢ÉÂ¶Ç‰∏ãÔºö

Windows 10
Python 3.7 (ÂÆâË£ÖImage, requestsÔºâ
Wireshark 2.0.2
ÂæÆ‰ø°ÁâàÊú¨6.3.15

Wireshark ÊòØÂ∏∏ËßÅÁöÑÊäìÂåÖËΩØ‰ª∂ÔºåÁî±‰∫éÂæÆ‰ø°ÁΩëÈ°µÁ´Ø‰ΩøÁî® httpsÔºåÈúÄË¶Å WireShark SSL/TLS Á≠âÂä†ÂØÜÈÖçÁΩÆ„ÄÇÂΩì‰ªäÊµÅË°åÂâçÂêëÂä†ÂØÜÊäÄÊúØ PFS ÁöÑÊó∂‰ª£‰∫ÜÔºåÂõ†‰∏∫ÂâçÂêëÂä†ÂØÜÊäÄÊúØÁöÑÁõÆÁöÑÂ∞±ÊòØËÆ©ÊØè‰∏™Êï∞ÊçÆ‰∫§‰∫íÈÉΩ‰ΩøÁî®ÁöÑÊòØ‰∏çÂêåÁöÑÁßÅÈí•ÔºåÊâÄ‰ª•‰Ω†ÂÉè‰ª•ÂâçRSAÊó∂‰ª£‰∏ÄÊ†∑ÊÉ≥Âè™Áî®‰∏Ä‰∏™ÁßÅÈí•Â∞±ËÉΩÊääÊï¥‰∏™session‰ºöËØùÁöÑÁΩëÁªúÊï∞ÊçÆÂåÖÈÉΩÁ†¥Ëß£Âá∫Êù•ÁöÑËØùÊòØ‰∏çÂèØËÉΩÁöÑ‰∫Ü„ÄÇ

Ëß£ÂØÜÊñπÂºèÊúÄÁÆÄÂçïÁöÑÊñπÊ≥ïÂ∞±ÊòØÂà©Áî® Firefox Âíå Chrome ÊµèËßàÂô®ÊîØÊåÅÁöÑÁî®Êó•ËÆ∞Êñá‰ª∂ÁöÑÊñπÂºèËÆ∞ÂΩï‰∏ãÁî®Êù•Âä†ÂØÜTLSÊï∞ÊçÆÂåÖÂØπÁß∞‰ºöËØùÁßòÈí•„ÄÇËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè SSLKEYLOGFILE ÊåáÂÆöÂÖ∂Ë∑ØÂæÑÂà∞‰Ω†ÊÉ≥Ë¶Å‰øùÂ≠ò‰Ω†ÁöÑ‰ºöËØùÁßÅÈí•ÁöÑÂú∞ÊñπÔºåËøôÊ†∑Êàë‰ª¨‰∏ãÊ¨°ÂêØÂä®FirefoxÊàñËÄÖChromeÁöÑÂºÄÂèëËÄÖÊ®°ÂºèÁöÑÊó∂ÂÄôÔºåTLSÁßòÈí•Â∞±‰ºöËá™Âä®ÂÜôÂÖ•Âà∞ËØ•ÊåáÂÆöÊñá‰ª∂‰∏ãÈù¢‰∫Ü„ÄÇËøôÊ†∑Â∞±ÂèØ‰ª•Âú®WireShark‰∏≠ÊåáÂÆöËØ•Êñá‰ª∂Êù•Âø´ÈÄüÂÆåÊàê‰Ω†ÁöÑÁ†¥Ëß£ÁõÆÁöÑ‰∫Ü„ÄÇ

‰∏∫‰∫ÜÊîØÊåÅËøô‰∏™ÂäüËÉΩÔºåÈúÄË¶Å WireShark 1.6 ÊàñËÄÖÊõ¥Êñ∞ÔºåËøõÂÖ•ËèúÂçïÊ†è Edit‚Äî‚ÄîPreferences‚Äî‚ÄîProtocols‚Äî‚ÄîSSL/TLS ÔºåÂú® (Pre)-Master-Secret log filename ‰∏≠ÈÄâÊã©ÂØºÂá∫ÁöÑÁßÅÈí•„ÄÇ

Wireshark ÂØπ HTTP ËØ∑Ê±ÇÂàÜÊûê‰∏ÄËà¨ÊòØÈÄöËøáÈÄâÂÆöÊï∞ÊçÆËøõË°åÊµÅËøΩË∏™ÔºåÂè≥ÈîÆÈº†Ê†áÔºåÊü•ÁúãFollow TCP Stream„ÄÇÊçïÊçâÂàóË°®‰∏≠ÊúâËÆ∏Â§ö Client Hello Âíå Server HelloÔºåËøôÊòØ TCP ÂçèËÆÆÁöÑËøûÊé•Êè°Êâã‰ø°ÊÅØ„ÄÇ

Âú®LinuxÊàñËÄÖMAC OS X‰∏äÁöÑÈÖçÁΩÆ:

    $ export SSLKEYLOGFILE=~/path/to/sslkeylog.log

ÂΩìÁÑ∂ÔºåÂ¶ÇÊûú‰Ω†ÊÉ≥Âú®‰Ω†ÁöÑÁ≥ªÁªüÊØèÊ¨°ÂêØÂä®ÁöÑÊó∂ÂÄôÈÉΩÊåáÂÆöËØ•Êó•ËÆ∞Ë∑ØÂæÑÁöÑËØùÔºå‰Ω†ÂèØ‰ª•Âú®‰Ω†ÁöÑLinux„ÄÅMAC OS X Áõ∏Â∫î‰∏ãÊâßË°å‰∏ãÈù¢ÁöÑÂä®‰Ωú‰øùÊåÅÁéØÂ¢ÉÂèòÈáèËÆæÁΩÆÔºö

    ~/.bashrc
    ~/.MacOSX/environment


ÂæÆ‰ø°ÁΩëÈ°µÁ´ØÁôªÈôÜËøô‰∏™ËøáÁ®ãÁÆÄÂçïËÄåË®ÄÂèØ‰ª•ÂàÜ‰∏∫Â¶Ç‰∏ãÂá†Ê≠•Ôºö

ÂêëÊúçÂä°Âô®Êèê‰æõ‰∏Ä‰∫õÁî®‰∫éËé∑Âèñ‰∫åÁª¥Á†ÅÁöÑÊï∞ÊçÆ
ÊúçÂä°Âô®ËøîÂõû‰∫åÁª¥Á†Å
ÂêëÊúçÂä°Âô®ËØ¢ÈóÆ‰∫åÁª¥Á†ÅÊâ´ÊèèÁä∂ÊÄÅ
ÊúçÂä°Âô®ËøîÂõûÊâ´ÊèèÁä∂ÊÄÅ



    #coding=utf8
    import time, requests
    import platform, os, subprocess
    import re, json, xml.dom.minidom

    session = requests.Session()

    def login_init():
        url = 'https://login.weixin.qq.com/jslogin'
        params = {
            'appid': 'wx782c26e4c19acffb',
            'redirect_uri': 'https://wx.qq.com/cgi-bin/mmwebwx-bin/webwxnewloginpage',
            'fun': 'new',
            'lang': 'en_US',
            '_': int(time.time()),
            }
        r = session.get(url, params = params)
        print('Content: %s'%r.text)

        # Êã¨Âè∑ÂÜÖÁöÑÂÜÖÂÆπË¢´ÊèêÂèñ‰∫ÜÂá∫Êù•
        regx = r'window.QRLogin.code = (\d+); window.QRLogin.uuid = "(\S+?)";'
        data = re.search(regx, r.text)
        if data and data.group(1) == '200': uuid = data.group(2)
        print('uuid: %s'%uuid)
        return uuid

    def get_qrcode(uuid):
        url = 'https://login.weixin.qq.com/qrcode/' + uuid
        r = session.get(url, stream = True)
        with open('QRCode.jpg', 'wb') as f: f.write(r.content)
        if platform.system() == 'Darwin':
            subprocess.call(['open', 'QRCode.jpg'])
        elif platform.system() == 'Linux':
            subprocess.call(['xdg-open', 'QRCode.jpg'])
        else:
            os.startfile('QRCode.jpg')

    def get_login_info(s):
        baseRequest = {}
        for node in xml.dom.minidom.parseString(s).documentElement.childNodes:
            if node.nodeName == 'skey':
                baseRequest['Skey'] = node.childNodes[0].data.encode('utf8')
            elif node.nodeName == 'wxsid':
                baseRequest['Sid'] = node.childNodes[0].data.encode('utf8')
            elif node.nodeName == 'wxuin':
                baseRequest['Uin'] = node.childNodes[0].data.encode('utf8')
            elif node.nodeName == 'pass_ticket':
                baseRequest['DeviceID'] = node.childNodes[0].data.encode('utf8')
        return baseRequest

    def get_user_info(baseRequest, redirectUri):
        url = '%s/webwxinit?r=%s' % (redirectUri, int(time.time()))
        data = {
            'BaseRequest': baseRequest,
        }
        headers = { 'ContentType': 'application/json; charset=UTF-8' }
        r = session.post(url, data = json.dumps(data), headers = headers)
        dic = json.loads(r.content.decode('utf-8', 'replace'))
        print('Log in as %s'%dic['User']['NickName'], r.text, r.content.decode('utf-8','replace'))
        return dic

    def query_scan_status(uuid):
        url = 'https://login.weixin.qq.com/cgi-bin/mmwebwx-bin/login'
        params = 'tip=1&uuid=%s&_=%s'%(uuid, int(time.time()))
        r = session.get(url, params = params)
        regx = r'window.code=(\d+)'
        data = re.search(regx, r.text)
        if not data: return 0
        if data.group(1) == '200':
            uriRegex = r'window.redirect_uri="(\S+)";'
            redirectUri = re.search(uriRegex, r.text).group(1)
            r = session.get(redirectUri, allow_redirects=False)
            redirectUri = redirectUri[:redirectUri.rfind('/')]
            baseRequestText = r.text

            regx = r'<error><ret>(\d+)</ret>'
            res = re.search(regx, baseRequestText)
            if( res.group(1) ): 
                print(baseRequestText)
                return 2
            baseRequest = get_login_info(baseRequestText)
            get_user_info(baseRequest, redirectUri)
            print('Login successfully', )
            return 1
        elif data.group(1) == '201':
            print('Tap login button to go(QRCode was scanned)')
            time.sleep(1)
        elif data.group(1) == '408':
            raise Exception('QRCode should be renewed')

    uuid = login_init()
    get_qrcode(uuid)
    while not query_scan_status(uuid):
        pass
    print("Done!")




# =üö© yaml 

YAML ËØ≠Ë®ÄÔºàÂèëÈü≥ /Ààj√¶m…ôl/ ÔºâÁöÑËÆæËÆ°ÁõÆÊ†áÔºåÂ∞±ÊòØÊñπ‰æø‰∫∫Á±ªËØªÂÜô„ÄÇÂÆÉÂÆûË¥®‰∏äÊòØ‰∏ÄÁßçÈÄöÁî®ÁöÑÊï∞ÊçÆ‰∏≤Ë°åÂåñÊ†ºÂºè„ÄÇÁî±‰∫éÂÆûÁé∞ÁÆÄÂçïÔºåËß£ÊûêÊàêÊú¨Âæà‰ΩéÔºåYAMLÁâπÂà´ÈÄÇÂêàÂú®ËÑöÊú¨ËØ≠Ë®Ä‰∏≠‰ΩøÁî®„ÄÇÂàó‰∏Ä‰∏ãÁé∞ÊúâÁöÑËØ≠Ë®ÄÂÆûÁé∞ÔºöRubyÔºåJavaÔºåPerlÔºåPythonÔºåPHPÔºåOCamlÔºåJavaScriptÔºåGo „ÄÇ

yaml Êñá‰ª∂Êï∞ÊçÆÊ†ºÂºèÂèÇËÄÉÔºå`-` Ë°®Á§∫Êï∞‰∏Ä‰∏™ÁªÑÂÖÉÁ¥†ÁöÑÂºÄÂßãÔºö

    # data = [{'name': 'Zhang', 'score':88, 'more':[1, 2, 3, {'more':[1, 2, 3,]}]}]
    - more:
      - 1
      - 2
      - 3
      - more: [1, 2, 3]
      name: Zhang
      score: 88



yamlÊñá‰ª∂‰∏≠Âü∫Êú¨Êï∞ÊçÆÁ±ªÂûãÔºö

    # Á∫ØÈáè
    s_val: name              # Â≠óÁ¨¶‰∏≤Ôºö{'s_val': 'name'}
    spec_s_val: "name\n"    # ÁâπÊÆäÂ≠óÁ¨¶‰∏≤Ôºö{'spec_s_val': 'name\n'
    num_val: 31.14          # Êï∞Â≠óÔºö{'num_val': 31.14}
    bol_val: true           # Â∏ÉÂ∞îÂÄºÔºö{'bol_val': True}
    nul_val: null           # nullÂÄºÔºö{'nul_val': None}
    nul_val1: ~             # nullÂÄºÔºö{'nul_val1': None}
    time_val: 2018-03-01t11:33:22.55-06:00     # Êó∂Èó¥ÂÄºÔºö{'time_val': datetime.datetime(2018, 3, 1, 17, 33, 22, 550000)}
    date_val: 2019-01-10    # Êó•ÊúüÂÄºÔºö{'date_val': datetime.date(2019, 1, 10)}

ÂÆÉÁöÑÂü∫Êú¨ËØ≠Ê≥ïËßÑÂàôÂ¶Ç‰∏ã„ÄÇ

    Â§ßÂ∞èÂÜôÊïèÊÑü
    ‰ΩøÁî®Áº©ËøõË°®Á§∫Â±ÇÁ∫ßÂÖ≥Á≥ª
    Áº©ËøõÊó∂‰∏çÂÖÅËÆ∏‰ΩøÁî®TabÈîÆÔºåÂè™ÂÖÅËÆ∏‰ΩøÁî®Á©∫Ê†º„ÄÇ
    Áº©ËøõÁöÑÁ©∫Ê†ºÊï∞ÁõÆ‰∏çÈáçË¶ÅÔºåÂè™Ë¶ÅÁõ∏ÂêåÂ±ÇÁ∫ßÁöÑÂÖÉÁ¥†Â∑¶‰æßÂØπÈΩêÂç≥ÂèØ
    # Ë°®Á§∫Ê≥®ÈáäÔºå‰ªéËøô‰∏™Â≠óÁ¨¶‰∏ÄÁõ¥Âà∞Ë°åÂ∞æÔºåÈÉΩ‰ºöË¢´Ëß£ÊûêÂô®ÂøΩÁï•„ÄÇ

YAML ÊîØÊåÅÁöÑÊï∞ÊçÆÁªìÊûÑÊúâ‰∏âÁßç„ÄÇ

ÂØπË±°ÔºöÈîÆÂÄºÂØπÁöÑÈõÜÂêàÔºåÂèàÁß∞‰∏∫Êò†Â∞ÑÔºàmappingÔºâ/ ÂìàÂ∏åÔºàhashesÔºâ / Â≠óÂÖ∏ÔºàdictionaryÔºâ
Êï∞ÁªÑÔºö‰∏ÄÁªÑÊåâÊ¨°Â∫èÊéíÂàóÁöÑÂÄºÔºåÂèàÁß∞‰∏∫Â∫èÂàóÔºàsequenceÔºâ / ÂàóË°®ÔºàlistÔºâ
Á∫ØÈáèÔºàscalarsÔºâÔºöÂçï‰∏™ÁöÑ„ÄÅ‰∏çÂèØÂÜçÂàÜÁöÑÂÄº

    import yaml
    import os

    def save_yaml(yaml_file, py_object):
        file = open(yaml_file, 'w', encoding='utf-8')
        yaml.dump(py_object, file)
        file.close()

    def load_yaml(yaml_file):
        file = open(yaml_file, 'r', encoding="utf-8")
        file_data = file.read()
        file.close()

        # Â∞ÜÂ≠óÁ¨¶‰∏≤ËΩ¨Âåñ‰∏∫Â≠óÂÖ∏ÊàñÂàóË°®
        data = yaml.load(file_data)
        return data

    current_path = os.path.abspath(".")
    yaml_path = os.path.join(current_path, "config.yaml")

    data = [{'name': 'Zhang', 'score':88}, { 'name':'Wang', 'score':90}]
    data = [{'name': 'Zhang', 'score':88, 'more':[1, 2, 3, {'more':[1, 2, 3,]}]}]
    save_yaml(yaml_path, data)

    data = load_yaml(yaml_path)
    print(type(data), data[0]['name'])


# =üö© json
[json](https://www.runoob.com/python/python-json.html)

    import json

    dict = { "one":"this is a dictionary", "two":2, "three":3, 4:"four" };
    jsonText = json.dumps(dict)
    print(jsonText)
    obj = json.loads(jsonText)
    print("read json", obj['one'])


# =üö© CSV Comma Separated Values ÈÄóÂè∑ÂàÜÈöîÂÄº
[CSV](https://docs.python.org/3/library/csv.html)
[os Methods](https://www.runoob.com/python/os-file-methods.html)

CSV Êñá‰ª∂ÊØè‰∏ÄË°åÂ∞±Áõ∏ÂΩì‰∏ÄÊù°Êï∞ÊçÆËÆ∞ÂΩïÔºåÊØèÊù°ËÆ∞ÂΩïÂêÑ‰∏™Â≠óÊÆµÁî®ÈÄóÂè∑ÂàÜÈöîÔºåÂ¶ÇÊûúÂ≠óÊÆµÂ≠òÂú®ÈÄóÂè∑ÊàñÂèåÂºïÂè∑ÔºåÂàôÁî®ÂèåÂºïÂè∑Â∞ÜÂ≠óÊÆµÂÜÖÂÆπÂåÖË£πÔºåÂπ∂‰∏îÂ≠óÊÆµÂÄºÁöÑÂèåÂºïÂè∑Áî®‰∏§‰∏™ËøûÁª≠ÁöÑÂèåÂºïÂè∑‰ª£Êõø„ÄÇ

Excel ÊîØÊåÅ CSV ‰∏≠‰ΩøÁî®ÂÖ¨ÂºèÊàñË°®ËææÂºèÔºå‰æãÂ¶Ç "=A1 & B1"Ôºå

Âú®Python 3ÔºåÂèØ‰ª•ÈÄöËøáopenÂáΩÊï∞ËØªÂèñÊñá‰ª∂Êó∂Ôºå‰∏çÊåáÂÆönewlineÔºåÂàôÈªòËÆ§ÂºÄÂêØ Universal new line modeÔºåÊâÄÊúâ\n, \r, or \r\n Ë¢´ÈªòËÆ§ËΩ¨Êç¢‰∏∫\n ÔºõÂÜôÂÖ•Êó∂Ôºå‰∏çÊåáÂÆönewlineÔºåÂàôÊç¢Ë°åÁ¨¶‰∏∫ÂêÑÁ≥ªÁªüÈªòËÆ§ÁöÑÊç¢Ë°åÁ¨¶Ôºà\n, \r, or \r\n, ÔºâÔºåÊåáÂÆö‰∏∫newline='\n'ÔºåÂàôÈÉΩÊõøÊç¢‰∏∫\nÔºàÁõ∏ÂΩì‰∫éUniversal new line modeÔºâÔºõ‰∏çËÆ∫ËØªÊàñËÄÖÂÜôÊó∂Ôºånewline=''ÈÉΩË°®Á§∫‰∏çËΩ¨Êç¢„ÄÇ

    import os
    import sys
    import csv

    def formatLongtime(longtime):
        import time
        return time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(longtime))

    def humanReading(size):
        for(scale, label) in [(1024*1024*1024,"GB"), (1024*1024,"MB"), (1024, "KB")]:
            if size>=scale:
                return "%.2f %s" %(size*1.0/scale, label)
        return str(size) + "Bytes"

    filename = "tree.csv"
    fields = ["root", "filename", "extension", "access", "modify", "size"]
    with open(filename, "w", newline='\n') as log:
        writer = csv.writer(log)
        writer.writerow(fields)

        for root, dirs, files in os.walk("c:/php7.2.6/"):
            for file in files:
                fileinfo = os.stat(os.path.abspath(root+"/"+file))
                atime = formatLongtime(fileinfo.st_atime)
                mtime = formatLongtime(fileinfo.st_mtime)
                size = humanReading(fileinfo.st_size)
                ext = os.path.splitext(file)[1]
                writer.writerow((root, file, ext, atime, mtime, size))

    with open(filename, newline='\n', encoding='utf-8') as log:
        reader = csv.reader(log, delimiter=',', quoting=csv.QUOTE_NONE)
        # reader = csv.reader(['one,two,three','a,b,c'])
        try:
            for row in reader:
                print(row)
        except csv.Error as e:
            sys.exit('file {}, line {}: {}'.format(filename, reader.line_num, e))


PythonÂºïÂÖ•‰∫ÜwithËØ≠Âè•Êù•Ëá™Âä®Â∏ÆÊàë‰ª¨Ë∞ÉÁî®close()ÊñπÊ≥ïÂÖ≥Èó≠Êñá‰ª∂ÔºåËøôÊØî try ... finally ÁªìÊûÑ‰ª£Á†ÅÊõ¥ÁÆÄÊ¥ÅÔºåÂπ∂‰∏î‰∏çÂøÖË∞ÉÁî®f.close()ÊñπÊ≥ï„ÄÇ


# =üö© turtle Êµ∑ÈæüÂõæ
[Turtle](https://www.liaoxuefeng.com/wiki/1016959663602400/1249593505347328)
[Turtle methods](https://docs.python.org/3.3/library/turtle.html#turtle-methods)

Âú®1966Âπ¥ÔºåSeymour PapertÂíåWally FeurzigÂèëÊòé‰∫Ü‰∏ÄÁßç‰∏ìÈó®ÁªôÂÑøÁ´•Â≠¶‰π†ÁºñÁ®ãÁöÑËØ≠Ë®Ä‚Äî‚ÄîLOGOËØ≠Ë®ÄÔºåÂÆÉÁöÑÁâπËâ≤Â∞±ÊòØÈÄöËøáÁºñÁ®ãÊåáÊå•‰∏Ä‰∏™Â∞èÊµ∑ÈæüÔºàturtleÔºâÂú®Â±èÂπï‰∏äÁªòÂõæ„ÄÇ

Êµ∑ÈæüÁªòÂõæÔºàTurtle GraphicsÔºâÂêéÊù•Ë¢´ÁßªÊ§çÂà∞ÂêÑÁßçÈ´òÁ∫ßËØ≠Ë®Ä‰∏≠ÔºåPythonÂÜÖÁΩÆ‰∫ÜturtleÂ∫ìÔºåÂü∫Êú¨‰∏ä100%Â§çÂà∂‰∫ÜÂéüÂßãÁöÑTurtle GraphicsÁöÑÊâÄÊúâÂäüËÉΩ„ÄÇ

Êµ∑ÈæüÁªòÂõæÂ∞±ÊòØÊåáÊå•Êµ∑ÈæüÂâçËøõ„ÄÅËΩ¨ÂêëÔºåÊµ∑ÈæüÁßªÂä®ÁöÑËΩ®ËøπÂ∞±ÊòØÁªòÂà∂ÁöÑÁ∫øÊù°„ÄÇË¶ÅÁªòÂà∂‰∏Ä‰∏™ÈïøÊñπÂΩ¢ÔºåÂè™ÈúÄË¶ÅËÆ©Êµ∑ÈæüÂâçËøõ„ÄÅÂè≥ËΩ¨90Â∫¶ÔºåÂèçÂ§ç4Ê¨°„ÄÇ

Ë∞ÉÁî®width()ÂáΩÊï∞ÂèØ‰ª•ËÆæÁΩÆÁ¨îÂà∑ÂÆΩÂ∫¶ÔºåË∞ÉÁî®pencolor()ÂáΩÊï∞ÂèØ‰ª•ËÆæÁΩÆÈ¢úËâ≤„ÄÇÊõ¥Â§öÊìç‰ΩúËØ∑ÂèÇËÄÉturtleÂ∫ìÁöÑËØ¥Êòé„ÄÇ

ÁªòÂõæÂÆåÊàêÂêéÔºåËÆ∞ÂæóË∞ÉÁî®done()ÂáΩÊï∞ÔºåËÆ©Á™óÂè£ËøõÂÖ•Ê∂àÊÅØÂæ™ÁéØÔºåÁ≠âÂæÖË¢´ÂÖ≥Èó≠„ÄÇÂê¶ÂàôÔºåÁî±‰∫éPythonËøõÁ®ã‰ºöÁ´ãÂàªÁªìÊùüÔºåÂ∞ÜÂØºËá¥Á™óÂè£Ë¢´Á´ãÂàªÂÖ≥Èó≠„ÄÇ

    from turtle import *

    # ËÆæÁΩÆËâ≤ÂΩ©Ê®°ÂºèÊòØRGB:
    colormode(255)

    lt(90)

    lv = 14
    l = 120
    s = 45

    width(lv)

    # ÂàùÂßãÂåñRGBÈ¢úËâ≤:
    r = 0
    g = 0
    b = 0
    pencolor(r, g, b)

    penup()
    bk(l)
    pendown()
    fd(l)

    def draw_tree(l, level):
        global r, g, b
        # save the current pen width
        w = width()

        # narrow the pen width
        width(w * 3.0 / 4.0)
        # set color:
        r = r + 1
        g = g + 2
        b = b + 3
        pencolor(r % 200, g % 200, b % 200)

        l = 3.0 / 4.0 * l

        lt(s)
        fd(l)

        if level < lv:
            draw_tree(l, level + 1)
        bk(l)
        rt(2 * s)
        fd(l)

        if level < lv:
            draw_tree(l, level + 1)
        bk(l)
        lt(s)

        # restore the previous pen width
        width(w)

    speed("fastest")

    draw_tree(l, 4)

    done()


# =üö© pySerial ‰∏≤Âè£ÈÄöËÆØÊ®°Âùó

ÂÖ∏ÂûãÂú∫ÊôØÂ∞±ÊòØÂíå‰∏Ä‰∫õÁ°¨‰ª∂ËÆæÂ§áÊâì‰∫§ÈÅì(ÊØîÂ¶Ç‰∏Ä‰∏™Êú∫Âô®‰∫∫Êàñ‰º†ÊÑüÂô®)„ÄÇÂ∞ΩÁÆ°‰Ω†ÂèØ‰ª•ÈÄöËøá‰ΩøÁî®PythonÂÜÖÁΩÆÁöÑI/OÊ®°ÂùóÊù•ÂÆåÊàêËøô‰∏™‰ªªÂä°,‰ΩÜÂØπ‰∫é‰∏≤Ë°åÈÄö‰ø°ÊúÄÂ•ΩÁöÑÈÄâÊã©ÊòØ‰ΩøÁî® pySerialÂåÖ „ÄÇ

- Âú®ÊîØÊåÅÁöÑÂπ≥Âè∞‰∏äÊúâÁªü‰∏ÄÁöÑÊé•Âè£„ÄÇ
- ÈÄöËøá Python Â±ûÊÄßËÆøÈóÆ‰∏≤Âè£ËÆæÁΩÆ„ÄÇ
- ÊîØÊåÅ‰∏çÂêåÁöÑÂ≠óËäÇÂ§ßÂ∞è„ÄÅÂÅúÊ≠¢‰Ωç„ÄÅÊ†°È™å‰ΩçÂíåÊµÅÊéßËÆæÁΩÆ„ÄÇ
- ÂèØ‰ª•ÊúâÊàñËÄÖÊ≤°ÊúâÊé•Êî∂Ë∂ÖÊó∂„ÄÇ
- Á±ª‰ººÊñá‰ª∂ÁöÑ APIÔºå‰æãÂ¶Ç read Âíå writeÔºå‰πüÊîØÊåÅ readline Á≠â„ÄÇ
- ÊîØÊåÅ‰∫åËøõÂà∂‰º†ËæìÔºåÊ≤°Êúâ null Ê∂àÈô§ÔºåÊ≤°Êúâ cr-lf ËΩ¨Êç¢„ÄÇ

ÂÆâË£Ö pySerial ‰∏≤Âè£ÈÄöËÆØÊ®°ÂùóÔºåÂèØ‰ª•ÂÖà‰ΩøÁî®ÂëΩ‰ª§Êü•ËØ¢ÂΩìÂâçÁ≥ªÁªüÊòØÂê¶Â∑≤ÂÆâË£ÖÔºåÂëΩ‰ª§ÂèÇËÄÉÂ¶Ç‰∏ãÔºö

    pip list | findstr serial
    pip install pyserial
    pip uninstall pyserial

Linux Âíå Windows ‰∏≠‰∏≤Âè£ÁöÑÂêçÂ≠óËßÑÂàô‰∏çÂ§™‰∏ÄÊ†∑ÔºåÂú® Windows Á≥ªÁªü‰∏ä‰ΩøÁî® 0„ÄÅ1 Á≠âË°®Á§∫ÁöÑ‰∏Ä‰∏™ËÆæÂ§áÔºåCOM0„ÄÅCOM1 Ë°®Á§∫‰∏§‰∏™‰∏≤Âè£„ÄÇ‰∏ÄÊó¶Á´ØÂè£ÊâìÂºÄÔºåÈÇ£Â∞±ÂèØ‰ª•‰ΩøÁî® read(), readline() Âíå write() ÂáΩÊï∞ËØªÂÜôÊï∞ÊçÆ‰∫Ü„ÄÇLinux ‰∏ãÁöÑÊü•Áúã‰∏≤Âè£ÂëΩ‰ª§:

    ls -l /dev/ttyS*

‰∏≤Âè£Âü∫Êú¨‰ΩøÁî®ÊñπÊ≥ïÔºö

    # linux
    ser = serial.Serial('/dev/ttyS0', 9600, timeout=0.2)
    
    # windows
    # ser = serial.Serial('COM0', 9600, timeout=0.2)

    # ser = serial.Serial()
    # ser.port = '/dev/ttyS0'
    # ser.baudrate = 9600
    # ser.timeout = 0.2
    # ser.open()

    # ser = serial.Serial(
    #   port='COM0',
    #   baudrate=9600,
    #   parity=serial.PARITY_ODD,
    #   stopbits=serial.STOPBITS_TWO,
    #   bytesize=serial.SEVENBITS
    # )


ÂçÅÂÖ≠ËøõÂà∂ÂèëÈÄÅÂÆûË¥®ÊòØÂèëÈÄÅÂçÅÂÖ≠ËøõÂà∂Ê†ºÂºèÁöÑÂ≠óÁ¨¶‰∏≤ÔºåÂ¶Ç '\xaa'Ôºå'\x0b'ÔºåÈáçÁÇπÂú®‰∫éÊÄé‰πàÊ†∑Êää‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ËΩ¨Êç¢ÊàêÂçÅÂÖ≠ËøõÂà∂ÁöÑÊ†ºÂºèÔºåÊúâ‰∏§‰∏™ËØØÂå∫Ôºö

- '\x'+'aa' ÊòØ‰∏çÂèØ‰ª•ÔºåÊ∂âÂèäÂà∞ËΩ¨‰πâÁ¨¶ÂèçÊñúÊù†
- '\\x'+'aa' Âíå r'\x'+'aa'‰πü‰∏çÂèØ‰ª•ÔºåËøôÊ†∑ÁöÑÊâìÂç∞ÁªìÊûúËôΩÁÑ∂ÊòØ\xaaÔºå‰ΩÜËµãÁªôÂèòÈáèÁöÑÂÄºÂç¥ÊòØ'\\xaa'

ËøôÈáåÁî®Âà∞decodeÂáΩÊï∞Ôºå

    msg = 'aabbccddee'  
    hex = msg.decode("hex")  
    print(hex)  

ÂÅáÂ¶ÇÂú®‰∏≤Âè£Âä©Êâã‰ª•ÂçÅÂÖ≠ËøõÂà∂ÂèëÈÄÅÂ≠óÁ¨¶‰∏≤ "abc"ÔºåÈÇ£‰πà‰Ω†Âú® Python ‰∏≠ÂàôËøôÊ†∑Êìç‰Ωú write("\x61\x62\x63")

    #!/usr/bin/python
    # coding=UTF-8

    import serial


    def hexshow(data):
        '''
        Âäü ËÉΩ: Â∞ÜÊé•Êî∂Âà∞ÁöÑÊï∞ÊçÆËΩ¨Êç¢Âà∞ hex ÂΩ¢Âºè
        :param data: str
        :return: hex string
        '''
        hex_data = ''
        hLen = len(data)
        for i in range(hLen):
            hvol = ord(data[i])
            hhex = '%02x' % hvol
            hex_data += hhex+' '
        print('hexshow:', hex_data)


    def hexsend(string_data=''):
        '''
        Âäü ËÉΩ: Â∞ÜÈúÄË¶ÅÂèëÈÄÅÁöÑÂ≠óÁ¨¶‰∏≤‰ª• hex ÂΩ¢ÂºèÂèëÈÄÅ
        :param string_data: string
        :return: hex string
        '''
        hex_data = string_data.decode("hex")
        return hex_data


    if __name__ == '__main__':
        found = []
        for x in range(0, 8):
            try:
                port = 'COM' + str(x)
                ser = serial.Serial(port, 115200)
                ser.close()
                found.append(port)
                print("Serial Port Found: %s" % port)
            except serial.SerialException as e:
                pass
        port = "COM1"
        if(len(found) == 1):
            port = found[0]
        ser = serial.Serial(port, 115200)
        print(ser.portstr)

        if ser.isOpen():
            print("open success")
        else:
            print("open failed")

        try:
            while True:
                count = ser.inWaiting()
                if count > 0:
                    data = ser.read(count)
                    if data != b'':
                        print("receive:", data)
                        ser.write(data)
                    else:
                        ser.write(hexsend(data))
        except KeyboardInterrupt:
            if ser is not None:
                ser.close()


pySerial Â∫ìÂ∏∏Áî®ÂáΩÊï∞‰ªãÁªç

    serial = serial.Serial(‚ÄòCOM1‚Äô, 115200) ÊâìÂºÄCOM1Âπ∂ËÆæÁΩÆÊ≥¢ÁâπÁéá‰∏∫115200ÔºåCOM1Âè™ÈÄÇÁî®‰∫éWindows
    serial = serial.Serial(‚Äò/dev/ttyS0‚Äô, 115200) ÊâìÂºÄ/dev/ttyS0Âπ∂ËÆæÁΩÆÊ≥¢ÁâπÁéá‰∏∫115200, Âè™ÈÄÇÁî®‰∫éLinux
    print serial .portstr ËÉΩÁúãÂà∞Á¨¨‰∏Ä‰∏™‰∏≤Âè£ÁöÑÊ†áËØÜ
    serial .write(‚Äúhello‚Äù) ÂæÄ‰∏≤Âè£ÈáåÈù¢ÂÜôÊï∞ÊçÆ
    serial .close() ÂÖ≥Èó≠serial Ë°®Á§∫ÁöÑ‰∏≤Âè£
    serial .open() ÊâìÂºÄ‰∏≤Âè£
    data = serial .read(num) ËØªnum‰∏™Â≠óÁ¨¶
    data = serial .readline() ËØª‰∏ÄË°åÊï∞ÊçÆÔºå‰ª•/nÁªìÊùüÔºåË¶ÅÊòØÊ≤°Êúâ/nÂ∞±‰∏ÄÁõ¥ËØªÔºåÈòªÂ°û„ÄÇ
    serial .baudrate = 9600 ËÆæÁΩÆÊ≥¢ÁâπÁéá
    print serial ÂèØÊü•ÁúãÂΩìÂâç‰∏≤Âè£ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØ
    serial .isOpen() ÂΩìÂâç‰∏≤Âè£ÊòØÂê¶Â∑≤ÁªèÊâìÂºÄ
    serial.inWaiting() Âà§Êñ≠ÂΩìÂâçÊé•Êî∂ÁöÑÊï∞ÊçÆ
    serial.flushInput() Ê∏ÖÈô§ËæìÂÖ•ÁºìÂÜ≤Âå∫Êï∞ÊçÆ
    serial.flushOutput() ‰∏≠Ê≠¢ÂΩìÂâçËæìÂá∫Âπ∂Ê∏ÖÈô§ËæìÂá∫ÁºìÂÜ≤Âå∫Êï∞ÊçÆ


# =üö© SQLite
[SQLite](https://www.runoob.com/sqlite/sqlite-python.html)
[Python SQLite3](https://docs.python.org/3/library/sqlite3.html)

    # -*- coding: utf-8 -*-

    import os, sqlite3

    db_file = os.path.join(os.path.dirname(__file__), 'test.db')
    if os.path.isfile(db_file):
        os.remove(db_file)

    # ÂàùÂßãÊï∞ÊçÆ:
    conn = sqlite3.connect(db_file)
    cursor = conn.cursor()
    cursor.execute('create table user(id varchar(20) primary key, name varchar(20), score int)')
    cursor.execute(r"insert into user values ('A-001', 'Adam', 95)")
    cursor.execute(r"insert into user values ('A-002', 'Bart', 62)")
    cursor.execute(r"insert into user values ('A-003', 'Lisa', 78)")
    cursor.execute(r'insert into user values(:key,:name,:score)',  {"key":"A-004","name":"Aob","score":123} )
    print('rowcount =', cursor.rowcount)

    def get_score_in(low, high):
        ' ËøîÂõûÊåáÂÆöÂàÜÊï∞Âå∫Èó¥ÁöÑÂêçÂ≠óÔºåÊåâÂàÜÊï∞‰ªé‰ΩéÂà∞È´òÊéíÂ∫è '
        cursor.execute('select name from user where score>=? and score<=? order by score', (low, high) )
        res = cursor.fetchall()
        return res

    # ÊµãËØï:
    assert get_score_in(80, 95) == [('Adam',)], get_score_in(80, 95)
    assert get_score_in(60, 80) == [('Bart',), ('Lisa',)], get_score_in(60, 80)
    assert get_score_in(60, 100) == [('Bart',), ('Lisa',), ('Adam',)], get_score_in(60, 100)

    print('Pass')

    cursor.close()
    conn.commit()
    conn.close()


# =üö© MySQL
[PyMySQL](https://pymysql.readthedocs.io/en/latest/)
[mysql-python](http://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python)
[Peewee ORM](http://docs.peewee-orm.com/en/latest/peewee/installation.html)
[SQLAlchemy ÊéòÈáë](https://juejin.im/post/5a26ab82f265da430d57df8b)
[SQLAlchemy ËèúÈ∏üÊïôÁ®ã](http://www.runoob.com/python/python-mysql.html)
[mysql-connector-python ËèúÈ∏üÊïôÁ®ã](https://www.runoob.com/python3/python-mysql-connector.html)
[mysql-connector-python Doc](https://dev.mysql.com/doc/connector-python/en/)

Python ÁöÑ DB-API ÊòØÊï∞ÊçÆÂ∫ìÂÆûÁé∞Êé•Âè£Ôºå‰ΩøÁî®ÂÆÉËøûÊé•ÂêÑÊï∞ÊçÆÂ∫ìÂêéÔºåÂ∞±ÂèØ‰ª•Áî®Áõ∏ÂêåÁöÑÊñπÂºèÊìç‰ΩúÂêÑÊï∞ÊçÆÂ∫ìÔºåDB-API‰ΩøÁî®ÊµÅÁ®ãÔºö

- ÂºïÂÖ• API Ê®°Âùó„ÄÇ
- Ëé∑Âèñ‰∏éÊï∞ÊçÆÂ∫ìÁöÑËøûÊé•„ÄÇ
- ÊâßË°åSQLËØ≠Âè•ÂíåÂ≠òÂÇ®ËøáÁ®ã„ÄÇ
- ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•

MySQL-python Âç≥ MySQLdbÔºåÊòØ Python ËøûÊé• MySQL ÊúÄÊµÅË°åÁöÑ‰∏Ä‰∏™È©±Âä®ÔºåÂæàÂ§öÊ°ÜÊû∂‰πüÊòØ‰æùÊçÆÂÖ∂ÂºÄÂèëÁöÑ„ÄÇMySQLdb ÂÆûÁé∞‰∫Ü Python Êï∞ÊçÆÂ∫ì API ËßÑËåÉ V2.0ÔºåCËØ≠Ë®ÄÂºÄÂèëÔºåÂü∫‰∫é MySQL C API ‰∏äÂª∫Á´ãÔºåÂè™ÊîØÊåÅ Python 2.xÔºåÂÆâË£ÖÊúâËÆ∏Â§öÂâçÁΩÆÊù°‰ª∂„ÄÇÂèØ‰ª•‰ΩøÁî® Mysqlclient Êõø‰ª£ÔºåÂÆÉÊòØÂÆåÂÖ®ÂÖºÂÆπ MySQLdb ÁöÑË°çÁîüÁâàÔºåÂêåÊó∂ÂÖºÂÆπ Python 3.xÔºå‰πüÊòØ Django ORM ÁöÑ‰æùËµñÂ∑•ÂÖ∑ÔºåÊîØÊåÅÂéüÁîüSQLÊìç‰ΩúÊï∞ÊçÆÂ∫ì„ÄÇPyMysql ÊòØÁ∫Ø Python ÂÆûÁé∞ÁöÑÈ©±Âä®ÔºåÈÄüÂ∫¶‰∏çÂ¶Ç MySQLdb„ÄÇ

mysql-connector-python ÊòØ MySQL Á§æÂå∫Êèê‰æõÁöÑËøûÊé•Â∫ì„ÄÇ

[Peewee ORM] ÊòØ Python ÂØπË±°‰∏éÊï∞ÊçÆÂ∫ìÂÖ≥Á≥ªË°®ÁöÑ‰∏ÄÁßçÊò†Â∞ÑÂÖ≥Á≥ªÔºåÊúâ‰∫Ü ORM ‰Ω†‰∏çÂÜçÈúÄË¶ÅÂÜô SQL ËØ≠Âè•„ÄÇ

 ORM  ÂÖºÂÆπÂ§öÁßçÊï∞ÊçÆÂ∫ìÁ≥ªÁªüÔºåÂ¶Çsqlite, mysql„ÄÅpostgresql„ÄÇ

ÂÜôÂéüÁîü SQL ÁöÑËøáÁ®ãÈùûÂ∏∏ÁπÅÁêêÔºå‰ª£Á†ÅÈáçÂ§ç„ÄÇ

SQLAlchemy ÊòØÊó¢ÊîØÊåÅÂéüÁîü SQLÔºåÂèàÊîØÊåÅ  ORM  ÁöÑÂ∑•ÂÖ∑Ôºõ

Áõ¥Êé•ÈÄöËøá conda install mysql-pyhton ÂèØËÉΩ‰∏çËÉΩÂÆâË£ÖÊàêÂäüÔºåË¢´Â¢ô‰∫ÜÔºÅ

ÂèØ‰ª•ÊâãÂä®ÂÆâË£ÖÔºåÂÖà‰∏ãËΩΩ [mysql-python] ÂÜçÂÆâË£ÖÔºåËøõÂÖ•Ê®°ÂùóÂàóË°®ÂèØ‰ª•ÁúãÂà∞ Python 2 ÁöÑÂèØ‰ª•ÂÆâË£Ö MySQL-pythonÔºåËÄå Python 3 ÂàôÊòØÂÆâË£Ö Mysqlclient Â¶Ç mysqlclient‚Äë1.4.4‚Äëcp37‚Äëcp37m‚Äëwin_amd64.whl„ÄÇ

1.Áî®ÁÆ°ÁêÜÂëòÊñπÂºèÊâìÂºÄcmd
ÂÖà pip list Êü•ÁúãÊúâÊ≤°ÊúâÂÆâË£ÖÊàêÂäü wheelÔºåÊ≤°ÊúâÂÆâË£ÖËΩ¨Ê≠•È™§2ÔºåÊàêÂäüÂÆâË£Ö‰∫Ü wheel ÂèØ‰ª•ËΩ¨Ê≠•È™§3

2.È¶ñÂÖàÈÄöËøá pip ÂëΩ‰ª§ÂÆâË£Öwheel 
Â¶ÇÊûúÊèêÁ§∫ pip ‰∏çÊòØÂÜÖÈÉ®ÊàñÂ§ñÈÉ®ÂëΩ‰ª§Ôºå‰πü‰∏çÊòØÂèØËøêË°åÁöÑÁ®ãÂ∫èÊàñÊâπÂ§ÑÁêÜÊñá‰ª∂ÔºåÂèØËÉΩÊòØ‰∏çËÉΩÂÆö‰Ωç pip Á®ãÂ∫èÔºö

Â∞Ü Anaconda3 ÁöÑÂÆâË£ÖÁõÆÂΩï‰∏ãÁöÑ scripts ÁõÆÂΩïÊ∑ªÂä†Âà∞Á≥ªÁªüÁéØÂ¢ÉÂèòÈáè path ÈáåÔºåÂÜçÊâßË°åËØ•ÂëΩ‰ª§ 

    pip install wheel 

ÊàñÂú® cmd ‰∏ãËøõÂÖ•Âà∞ Anaconda3\Scripts ÁõÆÂΩï‰∏ãÊâßË°åËØ•ÂëΩ‰ª§ 

    pip install wheel

3.ÂÆâË£ÖwhlÊñá‰ª∂
Â¶ÇÊûúÂ∞Ü Anaconda3\Scripts ÁõÆÂΩïÊ∑ªÂä†Âà∞path‰∏≠ÔºåÂèØ‰ª•Áõ¥Êé•Âú® whl Êñá‰ª∂ÊâÄÂú®ÁõÆÂΩïÁî®ÁÆ°ÁêÜÂëòÊâìÂºÄ‰∏Ä‰∏™cmdÁ™óÂè£ÔºåÁõ¥Êé•ÊâßË°å‰∏ãÈù¢ÁöÑËØ≠Âè•:

    pip install mysqlclient‚Äë1.4.4‚Äëcp37‚Äëcp37m‚Äëwin_amd64.whl


Ê≥®ÊÑèÊúâ‰∫õÂ∫ìÊ≤°Êúâ Python 3 ÂæóÁâàÊú¨ÔºåÂ¶Ç umysql Â∞±‰∏çËÉΩÂú® Python 3 ‰∏≠‰ΩøÁî®„ÄÇ


    #!/usr/bin/env python3
    # -*- coding: utf-8 -*-

    ########## prepare ##########

    # install mysql-connector-python:
    # pip3 install mysql-connector-python --allow-external mysql-connector-python

    import mysql.connector

    # change root password to yours:
    conn = mysql.connector.connect(user='root', password='password', database='test')

    cursor = conn.cursor()
    # ÂàõÂª∫userË°®:
    cursor.execute('create table user (id varchar(20) primary key, name varchar(20))')
    # ÊèíÂÖ•‰∏ÄË°åËÆ∞ÂΩïÔºåÊ≥®ÊÑèMySQLÁöÑÂç†‰ΩçÁ¨¶ÊòØ%s:
    cursor.execute('insert into user (id, name) values (%s, %s)', ('1', 'Michael'))
    print('rowcount =', cursor.rowcount)
    # Êèê‰∫§‰∫ãÂä°:
    conn.commit()
    cursor.close()

    # ËøêË°åÊü•ËØ¢:
    cursor = conn.cursor()
    cursor.execute('select * from user where id = %s', ('1',))
    values = cursor.fetchall()
    print(values)
    # ÂÖ≥Èó≠CursorÂíåConnection:
    cursor.close()
    conn.close()


# =üö© SQLAlchemy
[SQLAlchemy](https://www.liaoxuefeng.com/wiki/1016959663602400/1017803857459008)

Êï∞ÊçÆÂ∫ìË°®ÊòØ‰∏Ä‰∏™‰∫åÁª¥Ë°®ÔºåÂåÖÂê´Â§öË°åÂ§öÂàó„ÄÇÊää‰∏Ä‰∏™Ë°®ÁöÑÂÜÖÂÆπÁî® Python ÁöÑÊï∞ÊçÆÁªìÊûÑË°®Á§∫Âá∫Êù•ÁöÑËØùÔºåÂèØ‰ª•Áî®‰∏Ä‰∏™ list Ë°®Á§∫Â§öË°åÔºålist ÁöÑÊØè‰∏Ä‰∏™ÂÖÉÁ¥†ÊòØ tupleÔºåË°®Á§∫‰∏ÄË°åËÆ∞ÂΩïÔºåÊØîÂ¶ÇÔºåÂåÖÂê´ id Âíå name ‰∏§‰∏™Â≠óÊÆµÁöÑ user Ë°®Ôºö

    [
        ('1', 'Michael'),
        ('2', 'Bob'),
        ('3', 'Adam')
    ]

Python ÁöÑ DB-API ËøîÂõûÁöÑÊï∞ÊçÆÁªìÊûÑÂ∞±ÊòØÂÉè‰∏äÈù¢ËøôÊ†∑Ë°®Á§∫ÁöÑ„ÄÇ ‰ΩÜÊòØÁî® tuple Ë°®Á§∫‰∏ÄË°åÂæàÈöæÁúãÂá∫Ë°®ÁöÑÁªìÊûÑ„ÄÇÂ¶ÇÊûúÁî® class User Êù•Ë°®Á§∫ÔºåÂ∞±ÂèØ‰ª•Êõ¥ÂÆπÊòìÂú∞ÁúãÂá∫Ë°®ÁöÑÁªìÊûÑÊù•Ôºö

    class User(object):
        def __init__(self, id, name):
            self.id = id
            self.name = name

    [
        User('1', 'Michael'),
        User('2', 'Bob'),
        User('3', 'Adam')
    ]

ËøôÂ∞±ÊòØ‰º†ËØ¥‰∏≠ÁöÑ ORM - Object-Relational Mapping ÊäÄÊúØÔºåÊääÂÖ≥Á≥ªÊï∞ÊçÆÂ∫ìÁöÑË°®ÁªìÊûÑÊò†Â∞ÑÂà∞ÂØπË±°‰∏ä„ÄÇ Âú® Python‰∏≠ÔºåÊúÄÊúâÂêçÁöÑ ORM Ê°ÜÊû∂ÊòØ SQLAlchemy„ÄÇ

È¶ñÂÖàÈÄöËøápipÂÆâË£ÖSQLAlchemyÔºö

    $ pip install sqlalchemy

ÁÑ∂ÂêéÔºåÂà©Áî®‰∏äÊ¨°Êàë‰ª¨Âú®MySQLÁöÑtestÊï∞ÊçÆÂ∫ì‰∏≠ÂàõÂª∫ÁöÑuserË°®ÔºåÁî®SQLAlchemyÊù•ËØïËØïÔºö

Á¨¨‰∏ÄÊ≠•ÔºåÂØºÂÖ•SQLAlchemyÔºåÂπ∂ÂàùÂßãÂåñDBSessionÔºö

    # ÂØºÂÖ•:
    from sqlalchemy import Column, String, create_engine
    from sqlalchemy.orm import sessionmaker
    from sqlalchemy.ext.declarative import declarative_base

    # ÂàõÂª∫ÂØπË±°ÁöÑÂü∫Á±ª:
    Base = declarative_base()

    # ÂÆö‰πâUserÂØπË±°:
    class User(Base):
        # Ë°®ÁöÑÂêçÂ≠ó:
        __tablename__ = 'user'

        # Ë°®ÁöÑÁªìÊûÑ:
        id = Column(String(20), primary_key=True)
        name = Column(String(20))

    # ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ìËøûÊé•:
    engine = create_engine('mysql+mysqlconnector://root:password@localhost:3306/test')
    # ÂàõÂª∫DBSessionÁ±ªÂûã:
    DBSession = sessionmaker(bind=engine)

‰ª•‰∏ä‰ª£Á†ÅÂÆåÊàêSQLAlchemyÁöÑÂàùÂßãÂåñÂíåÂÖ∑‰ΩìÊØè‰∏™Ë°®ÁöÑclassÂÆö‰πâ„ÄÇÂ¶ÇÊûúÊúâÂ§ö‰∏™Ë°®ÔºåÂ∞±ÁªßÁª≠ÂÆö‰πâÂÖ∂‰ªñclassÔºå‰æãÂ¶ÇSchoolÔºö

    class School(Base):
        __tablename__ = 'school'
        id = ...
        name = ...

create_engine()Áî®Êù•ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ìËøûÊé•„ÄÇSQLAlchemyÁî®‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤Ë°®Á§∫ËøûÊé•‰ø°ÊÅØÔºö

'Êï∞ÊçÆÂ∫ìÁ±ªÂûã+Êï∞ÊçÆÂ∫ìÈ©±Âä®ÂêçÁß∞://Áî®Êà∑Âêç:Âè£‰ª§@Êú∫Âô®Âú∞ÂùÄ:Á´ØÂè£Âè∑/Êï∞ÊçÆÂ∫ìÂêç'
‰Ω†Âè™ÈúÄË¶ÅÊ†πÊçÆÈúÄË¶ÅÊõøÊç¢ÊéâÁî®Êà∑Âêç„ÄÅÂè£‰ª§Á≠â‰ø°ÊÅØÂç≥ÂèØ„ÄÇ

‰∏ãÈù¢ÔºåÊàë‰ª¨ÁúãÁúãÂ¶Ç‰ΩïÂêëÊï∞ÊçÆÂ∫ìË°®‰∏≠Ê∑ªÂä†‰∏ÄË°åËÆ∞ÂΩï„ÄÇ

Áî±‰∫éÊúâ‰∫ÜORMÔºåÊàë‰ª¨ÂêëÊï∞ÊçÆÂ∫ìË°®‰∏≠Ê∑ªÂä†‰∏ÄË°åËÆ∞ÂΩïÔºåÂèØ‰ª•ËßÜ‰∏∫Ê∑ªÂä†‰∏Ä‰∏™UserÂØπË±°Ôºö

    # ÂàõÂª∫sessionÂØπË±°:
    session = DBSession()
    # ÂàõÂª∫Êñ∞UserÂØπË±°:
    new_user = User(id='5', name='Bob')
    # Ê∑ªÂä†Âà∞session:
    session.add(new_user)
    # Êèê‰∫§Âç≥‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ì:
    session.commit()
    # ÂÖ≥Èó≠session:
    session.close()

ÂèØËßÅÔºåÂÖ≥ÈîÆÊòØËé∑ÂèñsessionÔºåÁÑ∂ÂêéÊääÂØπË±°Ê∑ªÂä†Âà∞sessionÔºåÊúÄÂêéÊèê‰∫§Âπ∂ÂÖ≥Èó≠„ÄÇDBSessionÂØπË±°ÂèØËßÜ‰∏∫ÂΩìÂâçÊï∞ÊçÆÂ∫ìËøûÊé•„ÄÇ

Â¶Ç‰Ωï‰ªéÊï∞ÊçÆÂ∫ìË°®‰∏≠Êü•ËØ¢Êï∞ÊçÆÂë¢ÔºüÊúâ‰∫ÜORMÔºåÊü•ËØ¢Âá∫Êù•ÁöÑÂèØ‰ª•‰∏çÂÜçÊòØtupleÔºåËÄåÊòØUserÂØπË±°„ÄÇSQLAlchemyÊèê‰æõÁöÑÊü•ËØ¢Êé•Âè£Â¶Ç‰∏ãÔºö

    # ÂàõÂª∫Session:
    session = DBSession()
    # ÂàõÂª∫QueryÊü•ËØ¢ÔºåfilterÊòØwhereÊù°‰ª∂ÔºåÊúÄÂêéË∞ÉÁî®one()ËøîÂõûÂîØ‰∏ÄË°åÔºåÂ¶ÇÊûúË∞ÉÁî®all()ÂàôËøîÂõûÊâÄÊúâË°å:
    user = session.query(User).filter(User.id=='5').one()
    # ÊâìÂç∞Á±ªÂûãÂíåÂØπË±°ÁöÑnameÂ±ûÊÄß:
    print('type:', type(user))
    print('name:', user.name)
    # ÂÖ≥Èó≠Session:
    session.close()

ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö

    type: <class '__main__.User'>
    name: Bob

ÂèØËßÅÔºåORMÂ∞±ÊòØÊääÊï∞ÊçÆÂ∫ìË°®ÁöÑË°å‰∏éÁõ∏Â∫îÁöÑÂØπË±°Âª∫Á´ãÂÖ≥ËÅîÔºå‰∫íÁõ∏ËΩ¨Êç¢„ÄÇ

Áî±‰∫éÂÖ≥Á≥ªÊï∞ÊçÆÂ∫ìÁöÑÂ§ö‰∏™Ë°®ËøòÂèØ‰ª•Áî®Â§ñÈîÆÂÆûÁé∞‰∏ÄÂØπÂ§ö„ÄÅÂ§öÂØπÂ§öÁ≠âÂÖ≥ËÅîÔºåÁõ∏Â∫îÂú∞ÔºåORMÊ°ÜÊû∂‰πüÂèØ‰ª•Êèê‰æõ‰∏§‰∏™ÂØπË±°‰πãÈó¥ÁöÑ‰∏ÄÂØπÂ§ö„ÄÅÂ§öÂØπÂ§öÁ≠âÂäüËÉΩ„ÄÇ

‰æãÂ¶ÇÔºåÂ¶ÇÊûú‰∏Ä‰∏™UserÊã•ÊúâÂ§ö‰∏™BookÔºåÂ∞±ÂèØ‰ª•ÂÆö‰πâ‰∏ÄÂØπÂ§öÂÖ≥Á≥ªÂ¶Ç‰∏ãÔºö

    class User(Base):
        __tablename__ = 'user'

        id = Column(String(20), primary_key=True)
        name = Column(String(20))
        # ‰∏ÄÂØπÂ§ö:
        books = relationship('Book')

    class Book(Base):
        __tablename__ = 'book'

        id = Column(String(20), primary_key=True)
        name = Column(String(20))
        # ‚ÄúÂ§ö‚ÄùÁöÑ‰∏ÄÊñπÁöÑbookË°®ÊòØÈÄöËøáÂ§ñÈîÆÂÖ≥ËÅîÂà∞userË°®ÁöÑ:
        user_id = Column(String(20), ForeignKey('user.id'))

ÂΩìÊàë‰ª¨Êü•ËØ¢‰∏Ä‰∏™UserÂØπË±°Êó∂ÔºåËØ•ÂØπË±°ÁöÑbooksÂ±ûÊÄßÂ∞ÜËøîÂõû‰∏Ä‰∏™ÂåÖÂê´Ëã•Âπ≤‰∏™BookÂØπË±°ÁöÑlist„ÄÇ



# =üö© Decorator

Python ‰øÆÈ•∞Âô®ÁöÑ DEMOÔºö

    def hello(fun):
        def wrapper(msg):
            print("decorator wrapper for function %s" % fun.__name__)
            fun(msg)
        return wrapper


    @hello
    def foo(msg):
        print("hello foo " + msg)

    foo("test")

ËæìÂá∫

    decorator wrapper for function foo
    hello foo test

Ê†πÊçÆ„ÄäÂáΩÊï∞ÂºèÁºñÁ®ã„Äã‰∏≠ÁöÑ first class functions ‰∏≠ÁöÑÂÆö‰πâÁöÑÔºå‰Ω†ÂèØ‰ª•ÊääÂáΩÊï∞ÂΩìÊàêÂèòÈáèÊù•‰ΩøÁî®„ÄÇDecorator ÈÄöËøá @Ê≥®Ëß£ËØ≠Ê≥ïÁ≥ñ Syntactic Sugar ÂºïÂÖ•ÔºåÊú¨Ë¥®Â∞±ÊòØÈ´òÈò∂ÂáΩÊï∞ Higher Order FunctionÔºå‰ΩøÁî® @decorator Êù•‰øÆÈ•∞ÂáΩÊï∞Êó∂ÔºåÂ∞±ÊòØÈÄöËøáÈ´òÈò∂ÂáΩÊï∞Â∞ÅË£ÖÂÆÉ„ÄÇ‰∏Ä‰∏™È´òÈò∂ÂáΩÊï∞Êª°Ë∂≥ÔºöÊé•Êî∂‰∏Ä‰∏™ÂáΩÊï∞ÂèÇÊï∞ÔºåÂêåÊó∂ËøîÂõû‰∏Ä‰∏™ÂáΩÊï∞ÔºåÂπ∂‰∏î‰øùÊåÅÂÖ∂ÈÄªËæëÂÖ≥Á≥ª„ÄÇÂõ†Ê≠§Ôºå‰øÆÈ•∞ÂáΩÊï∞ÂèØ‰ª•‰ªªÊÑèÊ∑ªÂä†‰ΩøÁî®ËÄå‰∏ç‰ºöÁ†¥ÂùèÁ®ãÂ∫èÁªìÊûÑÔºåÂç≥ @hello ÂèØ‰ª•Â∫îÁî®Â§öÊ¨°„ÄÇ‰∏äÈù¢ÂÆö‰πâÁöÑ foo ‰ΩøÁî®‰øÆÈ•∞ÂáΩÊï∞ÂêéÁõ∏ÂΩì‰∫é‰ª•‰∏ã‰ª£Á†ÅÂÜôÊ≥ïÔºå‰øÆÈ•∞ÂáΩÊï∞ hello ‰ºöÂÖàË¢´ÊâßË°åÂÜçËøîÂõûÈÄªËæëÁ≠â‰ª∑ÁöÑ wrapper ÂáΩÊï∞Ôºö

    foo = hello(foo)

ÊâÄ‰ª•Ôºåfoo("test") ÂÆûÈôÖÂ∞±ÊòØÂú®ÊâßË°å wrapper("test") -> foo("test")„ÄÇ‰øÆÈ•∞ÂáΩÊï∞ËøòÂèØ‰ª•ÂÉè‰∏ÄËà¨ÂáΩÊï∞‰∏ÄÊ†∑Â∏¶ÂèÇÊï∞Ôºå‰ª•‰∏ãÊòØ‰∏Ä‰∏™ÊØîËæÉÂÆûÁî®ÁöÑ Decorator Â±ïÁ§∫Ôºö

    def hello(str, *args, **kwds):
        def real_decorator(fun):
            def wrapper(*args, **set):
                print("%s<%s>" % (kwds['indent'], kwds['tag']))
                fun(*args, **set)
                print("%s</%s>" % (kwds['indent'], kwds['tag']))
            return wrapper
        return real_decorator


    @hello(str="abc", tag="Release", indent="")
    @hello(str="xyz", tag="Test", indent="    ")
    def foo(msg):
        print("        hello foo " + msg)

    foo("test")

ËæìÂá∫

    <Release>
        <Test>
            hello foo test
        </Test>
    </Release>

‰øÆÈ•∞Âô®ÂáΩÊï∞ÁöÑÂèÇÊï∞Ê†ºÂºèÊòØ Python ÁöÑÂ§öÂèÇÊï∞ÁâπËâ≤ËØ≠Ê≥ïÁªìÊûÑÔºå`arg1, arg2..., *args, **kwds` ÂâçÈù¢Ë°®Á§∫‰ªªÊÑèÁöÑÂëΩÂêçÂèÇÊï∞Ôºå`*args` Âíå `**kwds` ÂàÜÂà´Ë°®Á§∫ÂÖ∂ÂÆÉÊõ¥Â§öÁöÑÂèÇÊï∞‰ΩøÁî®ÂàóË°® args ÊàñÈîÆÂÄºÂØπ kwds ËøõË°åËÆøÈóÆ„ÄÇ

## ==‚ö° Decorator & Class

Decorator ÊòØ Python 2.4 ‰∏≠Â¢ûÂä†ÁöÑÂäüËÉΩÔºå‰πüÊòØÂÆûÁé∞ÂÖÉÁºñÁ®ã Meta Programming ÁöÑÊúÄÊñ∞ÊñπÂºèÔºåÂêåÊó∂ÂÆÉ‰πüÊòØÊúÄÁÆÄÂçïÁöÑÂÖÉÁºñÁ®ãÊñπÂºè„ÄÇÂú® Decorator ‰πãÂâçÂ∞±Â∑≤Áªè
Êúâ classmethod() Âíå staticmethod() ÂÜÖÁΩÆÂáΩÊï∞ÂÆûÁé∞ÂÖÉÁºñÁ®ãÔºå‰ΩÜ‰ªñ‰ª¨ÁöÑÁº∫Èô∑ÊòØ‰ºöÂØºËá¥ÂáΩÊï∞ÂêçÁöÑÈáçÂ§ç‰ΩøÁî®ÔºåÂèÇËÄÉ David Mertz ÁöÑ Charming Python: Decorators make magic easy„ÄÇ

    #!/usr/bin/python
    # -*- coding: UTF-8 -*-


    class C(object):
        def foo():
            print('foo ...')

        def bar(self):
            print('bar ...')

        foo = staticmethod(foo)
        bar = classmethod(bar)


    # ÈùôÊÄÅÊñπÊ≥ïÊó†ÈúÄÂÆû‰æãÂåñ
    C.foo()
    C.bar()

    cobj = C()
    cobj.foo()

Êñ∞ÁöÑ‰øÆÈ•∞Âô®ËØ≠Ê≥ïÂºïÂÖ•ÂêéÔºå‰ª£Á†ÅÂÜôÊ≥ïÂ∞±Êõ¥ÁÆÄÂçï‰∫ÜÔºåÈÅøÂÖçÁöÑÈáçÂ§ç‰π¶ÂÜôÔºö

    class C(object):

        @staticmethod
        def foo():
            print('foo ...')

        @classmethod
        def bar(self):
            print('bar ...')

Decorator ÁöÑÁ±ªÂÆûÁé∞ÊñπÂºèÔºö

    class Decorator(object):

        def __init__(self, fn):
            print("inside __init__()")
            self.fn = fn

        def __call__(self):
            print("inside __call__()")
            self.fn()


    @Decorator
    def test():
        print("inside test()")

    print("Let's test decorator")
    test()

    inside __init__()
    Let's test decorator
    inside __call__()
    inside test()


‰∏äÈù¢Ëøô‰∏™Á§∫‰æãÂ±ïÁ§∫‰ª•Á±ªÁöÑÊñπÂºèÂ£∞Êòé‰∏Ä‰∏™ decoratorÔºåÁ±ª‰∏≠Êúâ‰∏§‰∏™ÊàêÂëòÊñπÂºèÊòØÈ¢ÑÂÆö‰πâÁöÑÔºö

- ‰∏ÄÊòØ__init__()ÊñπÊ≥ïÔºåÂú®Á±ªÂÆö‰πâÊó∂ÊâßË°åÔºåÁªôÊüê‰∏™ÂáΩÊï∞ decorator Êó∂Â∞±‰ºöË¢´Ë∞ÉÁî®„ÄÇ
- ÂÜç‰∏Ä‰∏™ÊòØ__call__()ÊñπÊ≥ïÔºåÂú®Ë∞ÉÁî®Ë¢´ decorator ‰øÆÈ•∞ÁöÑÂáΩÊï∞Êó∂Ë¢´Ë∞ÉÁî®„ÄÇ
- Â¶ÇÊûú decorator ÊòØÂ∏¶ÊúâÂèÇÊï∞ÁöÑËØùÔºåinit ÊàêÂëòÂ∞±‰∏çËÉΩÊé•Êî∂‰º†ÂÖ• fnÔºåÈúÄË¶ÅÂú® call ÊàêÂëò‰∏≠‰º†ÂÖ•„ÄÇ


## ==‚ö° Decorator & Side Effects

Ë¢´ decorator ÁöÑÂáΩÊï∞ÂÖ∂ÂÆûÂ∑≤ÁªèÊòØÂè¶Â§ñ‰∏Ä‰∏™ÂáΩÊï∞‰∫ÜÔºåÊü•ËØ¢__name__‰ºöÂèëÁé∞ÂÖ∂ËæìÂá∫ÁöÑÊòØ‰øÆÈ•∞Âô®ÈáåÁöÑÂ∞ÅË£ÖÂáΩÊï∞ wrapperÔºåËÄå‰∏çÊòØÂéüÊù•ÁöÑÂáΩÊï∞ÂêçÔºåËøôÂèØËÉΩ‰ºöÁªôÊàë‰ª¨ÁöÑÁ®ãÂ∫èÂüã‰∏Ä‰∫õÂùë„ÄÇÊâÄ‰ª•ÔºåPython ÁöÑ functool ÂåÖ‰∏≠Êèê‰æõ‰∫Ü‰∏Ä‰∏™Âè´ wrap ÁöÑ decorator Êù•Ê∂àÈô§ËøôÊ†∑ÁöÑÂâØ‰ΩúÁî®„ÄÇ

    from functools import wraps


    def hello(fun):
        @wraps(fun)
        def wrapper(msg):
            fun(msg)
        return wrapper


    @hello
    def foo(msg):
        print("hello foo " + msg)

    print(foo.__name__)

ËøòÊúâ‰∏Ä‰∏™ decorator ÂâØ‰ΩúÁî®Â∞±ÊòØÂèÇÊï∞ÂàóË°®‰ø°ÊÅØ‰∏¢Â§±Ôºågetfullargspec ‰∏çËÉΩÊ≠£Á°ÆËé∑ÂèñÂèÇÊï∞ÂàóË°®‰ø°ÊÅØÔºåPython ÂèçÂ∞ÑÊú∫Âà∂Â§±ÊïàÔºö

    from inspect import getmembers, getfullargspec
    from functools import wraps
    import inspect


    def wraps_decorator(f):
        @wraps(f)
        def wraps_wrapper(*args, **kwargs):
            return f(*args, **kwargs)
        return wraps_wrapper


    class Demo(object):
        @wraps_decorator
        def foobar(self, x, y):
            pass

    obj = Demo()
    for name, func in getmembers(obj, predicate=inspect.ismethod):
        print("Member Name: %s" % name)
        print("Func Name: %s" % func.__name__)
        print("Args: %s" % getfullargspec(func)[0])

Ëß£ÂÜ≥ÂäûÊ≥ïËøòÊòØÂèçÂ∞ÑÔºåËé∑ÂèñÂéüÂÖàÂæóÈó≠ÂåÖÔºåÂÜçËé∑ÂèñÂÖ∂ÁúüÂÆûÂæóÂèÇÊï∞ÂàóË°® `['self', 'x', 'y']`Ôºö

    def get_closure_argspec(method):
        argspec = getfullargspec(method)
        args = argspec[0]
        if args and args[0] == 'self':
            return argspec
        if hasattr(method, '__func__'):
            method = method.__func__
        if not hasattr(method, '__closure__') or method.__closure__ is None:
            raise Exception("No closure for method.")

        method = method.__closure__[0].cell_contents
        return get_closure_argspec(method)

Python 3 ËØ≠Ê≥ïË∑üÊóßÁâàÊúâÂ∑ÆÂà´Ôºå`__closure__` ÂØπÂ∫î func_closureÔºå`__name__` ÂØπÂ∫î func_nameÔºågetfullargspec Êõø‰ª£‰∫Ü getargspec„ÄÇ


## ==‚ö° Decorator & Fibonacci

Ëøô‰∏™‰æãÂ≠ê‰∏≠ÔºåÊòØ‰∏Ä‰∏™ Fibonacci ÊñêÊ≥¢ÊãâÂ•ëÊï∞‰æãÁöÑÈÄíÂΩíÁÆóÊ≥ï„ÄÇÊàë‰ª¨Áü•ÈÅìÔºåËøô‰∏™ÈÄíÂΩíÊòØÁõ∏ÂΩìÊ≤°ÊúâÊïàÁéáÁöÑÔºåÂõ†‰∏∫‰ºöÈáçÂ§çË∞ÉÁî®ËÆ°ÁÆóÂêåÊ†∑ÂæóÁÆóÂºè„ÄÇÊØîÂ¶ÇË¶ÅËÆ°ÁÆófib(5)Ôºå‰∫éÊòØÂÖ∂ÂàÜËß£Êàêfib(4) + fib(3)ÔºåËÄåfib(4)ÂàÜËß£Êàê fib(3)+fib(2)Ôºåfib(3) ÂèàÂàÜËß£Êàê fib(2)+fib(1)„ÄÇÂèØÁúãÂà∞Ôºåfib(3), fib(2), fib(1) Âú®Êï¥‰∏™ÈÄíÂΩíËøáÁ®ã‰∏≠Ë¢´Ë∞ÉÁî®‰∫ÜÂ§öÊ¨°ÔºåËÄå‰∏îÈöèÁ≥ªÊï∞ÂæóÂ¢ûÂ§ßÈáçÂ§çË∞ÉÁî®Ê¨°Êï∞Ë∂äÂ§ö„ÄÇÁî® decorator Âú®Ë∞ÉÁî®ÂáΩÊï∞ÂâçÊü•ËØ¢‰∏Ä‰∏ãÁºìÂ≠òÔºåÂ∞±ÂèØ‰ª•Â∞ÜËøô‰∏™ÈÄíÂΩí‰ªé‰∫åÂèâÊ†ëÂºèÁöÑÈÄíÂΩíÊàê‰∫ÜÁ±ª‰ººÁ∫øÊÄßÁöÑÈÄíÂΩí„ÄÇ‰ª• fib(10) Êù•ËÆ°Êï∞ÂáΩÊï∞Ë∞ÉÁî®Ê¨°Êï∞Ôºå‰ΩøÁî®ÁºìÂ≠òÊó∂‰∏é‰∏ç‰ΩøÁî®ÁºìÂ≠òÂæóÂ∑ÆÂà´ 19 vs 177ÔºÅ

    def memo(fn):
        cache = {}
        miss = object()

        def wrapper(*args):
            global tick
            tick = tick + 1
            result = cache.get(args, miss)
            if result is miss:
                result = fn(*args)
                cache[args] = result
            return result
        return wrapper

    @memo
    def fib(n):
        if n < 2:
            return n
        return fib(n - 1) + fib(n - 2)

    print(fib(10))


‰ª•‰∏ã‰æãÂ≠êÂ±ïÁ§∫ URL Ë∑ØÁî±Êù•Ë∞ÉÁî®Áõ∏ÂÖ≥Ê≥®ÂÜåÁöÑÂáΩÊï∞Ôºö

    class MyApp():
        def __init__(self):
            self.func_map = {}

        def register(self, name):
            def func_wrapper(func):
                self.func_map[name] = func
                return func
            return func_wrapper

        def call_method(self, name=None):
            func = self.func_map.get(name, None)
            if func is None:
                return "404 Method Not Found - " + str(name)
            return func()


    app = MyApp()


    @app.register('/')
    def main_page_func():
        return "This is the main page."


    @app.register('/next_page')
    def next_page_func():
        return "This is the next page."

    print(app.call_method('/'))
    print(app.call_method('/next_page'))
    print(app.call_method('/empty'))

‰∏äÈù¢Ëøô‰∏™Á§∫‰æã‰∏≠ÔºåÁî®Á±ªÁöÑÂÆû‰æãÂæóÊñπÊ≥ïÊù•ÂÅö decoratorÔºåÁ±ª‰∏≠Ê≤°Êúâ__call__()ÔºåÈÄöËøáÊ≥®ÂÜåÂáΩÊï∞ÂæóÈó≠ÂåÖ wrapper ËøîÂõû‰∫ÜÂéüÂáΩÊï∞„ÄÇÊâÄ‰ª•ÔºåÂéüÂáΩÊï∞Ê≤°ÊúâÂèëÁîü‰ªª‰ΩïÂèòÂåñ„ÄÇ


## ==‚ö° Decorator & MySQL

‰ª•‰∏ãÊòØ Python 2 ÁâàÊú¨‰æãÂ≠êÔºåÂ±ïÁ§∫ umysql Ëé∑ÂèñÊï∞ÊçÆÁöÑÂ∫îÁî®Ôºö

    import sys
    import umysql
    from functools import wraps


    class Configuraion:
        def __init__(self, env):
            if env == "Prod":
                self.host    = "coolshell.cn"
                self.port    = 3306
                self.db      = "coolshell"
                self.user    = "coolshell"
                self.passwd  = "fuckgfw"
            elif env == "Test":
                self.host   = 'localhost'
                self.port   = 3300
                self.user   = 'coolshell'
                self.db     = 'coolshell'
                self.passwd = 'fuckgfw'


    def mysql(sql):

        _conf = Configuraion(env="Prod")

        def on_sql_error(err):
            print(err)
            sys.exit(-1)

        def handle_sql_result(rs):
            if rs.rows > 0:
                fieldnames = [f[0] for f in rs.fields]
                return [dict(zip(fieldnames, r)) for r in rs.rows]
            else:
                return []

        def decorator(fn):
            @wraps(fn)
            def wrapper(*args, **kwargs):
                mysqlconn = umysql.Connection()
                mysqlconn.settimeout(5)
                mysqlconn.connect(_conf.host, _conf.port, _conf.user,
                                  _conf.passwd, _conf.db, True, 'utf8')
                try:
                    rs = mysqlconn.query(sql, {})
                except umysql.Error as e:
                    on_sql_error(e)

                data = handle_sql_result(rs)
                kwargs["data"] = data
                result = fn(*args, **kwargs)
                mysqlconn.close()
                return result
            return wrapper

        return decorator


    @mysql(sql = "select * from coolshell")
    def get_coolshell(data):
        pass


‰ª•‰∏ãÊòØ Python 3 ‰∏ä mysql-python ÁöÑÂÆûÂàóÔºö

    import sys
    import MySQLdb


    class Configuraion:
        def __init__(self, env):
            if env == "Prod":
                self.host = "localhost"
                self.port = 3306
                self.db = "miniot"
                self.user = "root"
                self.passwd = "pass"


    def mysql(sql, fieldnames):

        cf = Configuraion(env="Prod")

        def on_sql_error(err):
            print(err)
            sys.exit(-1)

        def handle_sql_result(rows):
            # fieldnames = [f[0] for f in fields]
            if(len(rows) > 0):
                return [dict(zip(fieldnames, r)) for r in rows]
            else:
                return []

        def decorator(fn):
            def wrapper(*args, **kwargs):
                try:
                    db = MySQLdb.connect(
                        cf.host, cf.user, cf.passwd, cf.db, cf.port, 'utf8')
                    cursor = db.cursor()
                    # cursor = db.cursor(MySQLdb.cursors.DictCursor)
                    cursor.execute(sql)
                except Exception as e:
                    on_sql_error(e)

                data = handle_sql_result(cursor.fetchall())
                kwargs["data"] = data
                result = fn(*args, **kwargs)
                db.close()
                return result
            return wrapper

        return decorator


    @mysql(
        "select id, nick_name, role, timestamp from users limit 10",
        ['id', 'nick_name', 'role', 'timestamp'])
    def get_data(data, *args, **kwargs):
        for row in data:
            print(row["id"], ":", row["nick_name"], ":", row["role"])


    @mysql(
        "select id, user, name, timestamp from wxapp_devices limit 10",
        ['id', 'user', 'name', 'timestamp'])
    def get_devices(data, *args, **kwargs):
        for row in data:
            print(row["id"], ":", row["user"], ":", row["name"])

    get_devices()


## ==‚ö° Decorator & Coroutine

‰∏ãÈù¢Èáè‰∏™ÈùûÂ∏∏ÁÆÄÂçïÁöÑÂºÇÊ≠•ÊâßË°åÁöÑdecoratorÔºåÊ≥®ÊÑèÔºåÂºÇÊ≠•Â§ÑÁêÜÂπ∂‰∏çÁÆÄÂçïÔºå‰∏ãÈù¢Âè™ÊòØ‰∏Ä‰∏™Á§∫‰æã„ÄÇ

    from threading import Thread
    from functools import wraps


    def coro(func):
        @wraps(func)
        def async_func(*args, **kwargs):
            th = Thread(target=func, args=args, kwargs=kwargs)
            th.start()
            return th

        return async_func

    if __name__ == '__main__':
        from time import sleep

        @coro
        def print_somedata():
            print('Print starting ...')
            sleep(2)
            print('Print: 2 sec passed')
            sleep(2)
            print('Print: 2 sec passed')
            sleep(2)
            print('Print finished!')

        def main():
            print_somedata()
            print('Back to main')
            print_somedata()
            print('Back to main')

        main()




# =üö© UDP Server
[UDP ÁºñÁ®ã](https://www.liaoxuefeng.com/wiki/1016959663602400/1017790181885952)

TCPÊòØÂª∫Á´ãÂèØÈù†ËøûÊé•ÔºåÂπ∂‰∏îÈÄö‰ø°ÂèåÊñπÈÉΩÂèØ‰ª•‰ª•ÊµÅÁöÑÂΩ¢ÂºèÂèëÈÄÅÊï∞ÊçÆ„ÄÇÁõ∏ÂØπTCPÔºåUDPÂàôÊòØÈù¢ÂêëÊó†ËøûÊé•ÁöÑÂçèËÆÆ„ÄÇ

‰ΩøÁî®UDPÂçèËÆÆÊó∂Ôºå‰∏çÈúÄË¶ÅÂª∫Á´ãËøûÊé•ÔºåÂè™ÈúÄË¶ÅÁü•ÈÅìÂØπÊñπÁöÑIPÂú∞ÂùÄÂíåÁ´ØÂè£Âè∑ÔºåÂ∞±ÂèØ‰ª•Áõ¥Êé•ÂèëÊï∞ÊçÆÂåÖ„ÄÇ‰ΩÜÊòØÔºåËÉΩ‰∏çËÉΩÂà∞ËææÂ∞±‰∏çÁü•ÈÅì‰∫Ü„ÄÇ

ËôΩÁÑ∂Áî®UDP‰º†ËæìÊï∞ÊçÆ‰∏çÂèØÈù†Ôºå‰ΩÜÂÆÉÁöÑ‰ºòÁÇπÊòØÂíåTCPÊØîÔºåÈÄüÂ∫¶Âø´ÔºåÂØπ‰∫é‰∏çË¶ÅÊ±ÇÂèØÈù†Âà∞ËææÁöÑÊï∞ÊçÆÔºåÂ∞±ÂèØ‰ª•‰ΩøÁî®UDPÂçèËÆÆ„ÄÇ

Êàë‰ª¨Êù•ÁúãÁúãÂ¶Ç‰ΩïÈÄöËøáUDPÂçèËÆÆ‰º†ËæìÊï∞ÊçÆ„ÄÇÂíåTCPÁ±ª‰ººÔºå‰ΩøÁî®UDPÁöÑÈÄö‰ø°ÂèåÊñπ‰πüÂàÜ‰∏∫ÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®„ÄÇÊúçÂä°Âô®È¶ñÂÖàÈúÄË¶ÅÁªëÂÆöÁ´ØÂè£Ôºö

    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    # ÁªëÂÆöÁ´ØÂè£:
    s.bind(('127.0.0.1', 9999))

ÂàõÂª∫SocketÊó∂ÔºåSOCK_DGRAMÊåáÂÆö‰∫ÜËøô‰∏™SocketÁöÑÁ±ªÂûãÊòØUDP„ÄÇÁªëÂÆöÁ´ØÂè£ÂíåTCP‰∏ÄÊ†∑Ôºå‰ΩÜÊòØ‰∏çÈúÄË¶ÅË∞ÉÁî®listen()ÊñπÊ≥ïÔºåËÄåÊòØÁõ¥Êé•Êé•Êî∂Êù•Ëá™‰ªª‰ΩïÂÆ¢Êà∑Á´ØÁöÑÊï∞ÊçÆÔºö

    print('Bind UDP on 9999...')
    while True:
        # Êé•Êî∂Êï∞ÊçÆ:
        data, addr = s.recvfrom(1024)
        print('Received from %s:%s.' % addr)
        s.sendto(b'Hello, %s!' % data, addr)

recvfrom()ÊñπÊ≥ïËøîÂõûÊï∞ÊçÆÂíåÂÆ¢Êà∑Á´ØÁöÑÂú∞ÂùÄ‰∏éÁ´ØÂè£ÔºåËøôÊ†∑ÔºåÊúçÂä°Âô®Êî∂Âà∞Êï∞ÊçÆÂêéÔºåÁõ¥Êé•Ë∞ÉÁî®sendto()Â∞±ÂèØ‰ª•ÊääÊï∞ÊçÆÁî®UDPÂèëÁªôÂÆ¢Êà∑Á´Ø„ÄÇ

Ê≥®ÊÑèËøôÈáåÁúÅÊéâ‰∫ÜÂ§öÁ∫øÁ®ãÔºåÂõ†‰∏∫Ëøô‰∏™‰æãÂ≠êÂæàÁÆÄÂçï„ÄÇ

ÂÆ¢Êà∑Á´Ø‰ΩøÁî®UDPÊó∂ÔºåÈ¶ñÂÖà‰ªçÁÑ∂ÂàõÂª∫Âü∫‰∫éUDPÁöÑSocketÔºåÁÑ∂ÂêéÔºå‰∏çÈúÄË¶ÅË∞ÉÁî®connect()ÔºåÁõ¥Êé•ÈÄöËøásendto()ÁªôÊúçÂä°Âô®ÂèëÊï∞ÊçÆÔºö

    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    for data in [b'Michael', b'Tracy', b'Sarah']:
        # ÂèëÈÄÅÊï∞ÊçÆ:
        s.sendto(data, ('127.0.0.1', 9999))
        # Êé•Êî∂Êï∞ÊçÆ:
        print(s.recv(1024).decode('utf-8'))
    s.close()

‰ªéÊúçÂä°Âô®Êé•Êî∂Êï∞ÊçÆ‰ªçÁÑ∂Ë∞ÉÁî®recv()ÊñπÊ≥ï„ÄÇ

‰ªçÁÑ∂Áî®‰∏§‰∏™ÂëΩ‰ª§Ë°åÂàÜÂà´ÂêØÂä®ÊúçÂä°Âô®ÂíåÂÆ¢Êà∑Á´ØÊµãËØïÔºåÁªìÊûúÂ¶Ç‰∏ãÔºö

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇCommand Prompt                                    - ‚ñ° x ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ$ python udp_server.py                                  ‚îÇ
‚îÇBind UDP on 9999...                                     ‚îÇ
‚îÇReceived from 127.0.0.1:63823...                        ‚îÇ
‚îÇReceived from 127.0.0.1:63823...                        ‚îÇ
‚îÇReceived from 127.0.0.1:63823...                        ‚îÇ
‚îÇ       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       ‚îÇCommand Prompt                                    - ‚ñ° x ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ       ‚îÇ$ python udp_client.py                                  ‚îÇ
‚îÇ       ‚îÇWelcome!                                                ‚îÇ
‚îÇ       ‚îÇHello, Michael!                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§Hello, Tracy!                                           ‚îÇ
        ‚îÇHello, Sarah!                                           ‚îÇ
        ‚îÇ$                                                       ‚îÇ
        ‚îÇ                                                        ‚îÇ
        ‚îÇ                                                        ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Â∞èÁªì
UDPÁöÑ‰ΩøÁî®‰∏éTCPÁ±ª‰ººÔºå‰ΩÜÊòØ‰∏çÈúÄË¶ÅÂª∫Á´ãËøûÊé•„ÄÇÊ≠§Â§ñÔºåÊúçÂä°Âô®ÁªëÂÆöUDPÁ´ØÂè£ÂíåTCPÁ´ØÂè£‰∫í‰∏çÂÜ≤Á™ÅÔºå‰πüÂ∞±ÊòØËØ¥ÔºåUDPÁöÑ9999Á´ØÂè£‰∏éTCPÁöÑ9999Á´ØÂè£ÂèØ‰ª•ÂêÑËá™ÁªëÂÆö„ÄÇ




# =üö© Threading

Python Â§öÁ∫øÁ®ãÊòØ‰∏™‰º™Âπ∂ÂèëÔºåÁ∫øÁ®ãÂèØ‰ª•ÂàÜ‰∏∫:

- ÂÜÖÊ†∏Á∫øÁ®ãÔºöÁî±Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏ÂàõÂª∫ÂíåÊí§ÈîÄ„ÄÇ
- Áî®Êà∑Á∫øÁ®ãÔºö‰∏çÈúÄË¶ÅÂÜÖÊ†∏ÊîØÊåÅËÄåÂú®Áî®Êà∑Á®ãÂ∫è‰∏≠ÂÆûÁé∞ÁöÑÁ∫øÁ®ã„ÄÇ


Python3 Á∫øÁ®ã‰∏≠ `_thread` Ê®°ÂùóÂ∑≤Ë¢´Â∫üÂºÉÔºå‰ΩøÁî® threading Ê®°Âùó‰ª£Êõø„ÄÇÂú® Python3 ‰∏≠‰∏çËÉΩÂÜç‰ΩøÁî® thread Ê®°Âùó„ÄÇ‰∏∫‰∫ÜÂÖºÂÆπÊÄßÔºåPython3 Â∞Ü thread ÈáçÂëΩÂêç‰∏∫ `_thread`„ÄÇ

    #!/usr/bin/python3

    import _thread
    import time

    def print_time( threadName, delay):
        count = 0
        while count < 5:
            time.sleep(delay)
            count += 1
            print ("%s: No.%s %s" % ( threadName, count, time.ctime(time.time()) ))

    try:
        _thread.start_new_thread( print_time, ("Thread #1", 1, ) )
        _thread.start_new_thread( print_time, ("Thread #2", 2.5, ) )
    except:
        print ("Error: Êó†Ê≥ïÂêØÂä®Á∫øÁ®ã")

    while 1:
        pass

threading Ê®°ÂùóÈô§‰∫ÜÂåÖÂê´ `_thread` Ê®°Âùó‰∏≠ÁöÑÊâÄÊúâÊñπÊ≥ïÂ§ñÔºåËøòÊèê‰æõÁöÑÂÖ∂‰ªñÊñπÊ≥ïÔºö

- threading.currentThread(): ËøîÂõûÂΩìÂâçÁöÑÁ∫øÁ®ãÂèòÈáè„ÄÇ
- threading.enumerate(): ËøîÂõû‰∏Ä‰∏™ÂåÖÂê´Ê≠£Âú®ËøêË°åÁöÑÁ∫øÁ®ãÁöÑlist„ÄÇÊ≠£Âú®ËøêË°åÊåáÁ∫øÁ®ãÂêØÂä®Âêé„ÄÅÁªìÊùüÂâçÔºå‰∏çÂåÖÊã¨ÂêØÂä®ÂâçÂíåÁªàÊ≠¢ÂêéÁöÑÁ∫øÁ®ã„ÄÇ
- threading.activeCount(): ËøîÂõûÊ≠£Âú®ËøêË°åÁöÑÁ∫øÁ®ãÊï∞ÈáèÔºå‰∏élen(threading.enumerate())ÊúâÁõ∏ÂêåÁöÑÁªìÊûú„ÄÇ

Èô§‰∫Ü‰ΩøÁî®ÊñπÊ≥ïÂ§ñÔºåÁ∫øÁ®ãÊ®°ÂùóÂêåÊ†∑Êèê‰æõ‰∫ÜThreadÁ±ªÊù•Â§ÑÁêÜÁ∫øÁ®ãÔºåThreadÁ±ªÊèê‰æõ‰∫Ü‰ª•‰∏ãÊñπÊ≥ïÊàñÂ±ûÊÄß:

- name    A string used for identification purposes only.
- ident   The thread identifier of this thread or None if the thread has not been started. 
- daemon  A boolean value indicating whether this thread is a daemon thread (True) or not (False).

- run()   Method representing the thread‚Äôs activity. Áî®‰ª•Ë°®Á§∫Á∫øÁ®ãÊ¥ªÂä®ÁöÑÊñπÊ≥ï„ÄÇ
- start() Start the thread‚Äôs activity. ÂêØÂä®Á∫øÁ®ãÊ¥ªÂä®„ÄÇ
- join(timeout=None) Á≠âÂæÖËá≥Á∫øÁ®ã‰∏≠Ê≠¢„ÄÇËøôÈòªÂ°ûË∞ÉÁî®Á∫øÁ®ãÁõ¥Ëá≥Á∫øÁ®ãÁöÑ join() ÊñπÊ≥ïË¢´Ë∞ÉÁî®‰∏≠Ê≠¢ÔºåÊ≠£Â∏∏ÈÄÄÂá∫ÊàñËÄÖÊäõÂá∫Êú™Â§ÑÁêÜÁöÑÂºÇÂ∏∏ÔºåÊàñËÄÖÊòØÂèØÈÄâÁöÑË∂ÖÊó∂ÂèëÁîü„ÄÇ
- isAlive()  Return whether the thread is alive. ËøîÂõûÁ∫øÁ®ãÊòØÂê¶Ê¥ªÂä®ÁöÑ„ÄÇ
- getName()  ËøîÂõûÁ∫øÁ®ãÂêç„ÄÇ
- setName()  ËÆæÁΩÆÁ∫øÁ®ãÂêç„ÄÇ

Âú®Á∫øÁ®ãÈáå‰º†ÈÄíÂèÇÊï∞ÁöÑÊñπÊ≥ïÔºö

1„ÄÅ‰ΩøÁî®ÂÖÉÁªÑ‰º†ÈÄí threading.Thread(target=ÊñπÊ≥ïÂêçÔºåargs=(arg1, arg2, ...))
2„ÄÅ‰ΩøÁî®Â≠óÂÖ∏‰º†ÈÄí threading.Thread(target=ÊñπÊ≥ïÂêç, kwargs={"key1": arg1, "key2": arg2, ...})
3„ÄÅÊ∑∑Âêà‰ΩøÁî®ÂÖÉÁªÑÂíåÂ≠óÂÖ∏ threading.Thread(target=ÊñπÊ≥ïÂêçÔºåargs=(arg1, arg2, ...), kwargs={"key1": arg1, "key2": arg2, ...})

    #!/usr/bin/python3

    import threading
    import time

    class MT (threading.Thread):
        def __init__(self, threadID, name, counter):
            threading.Thread.__init__(self)
            self.threadID = threadID
            self.name = name
            self.counter = counter
        def run(self):
            print ("Start Thread:" + self.name)
            worker(self.name, self.counter, 5)
            print ("Exit Thread:" + self.name)

    def worker(threadName, delay, counter):
        while counter:
            time.sleep(delay)
            print ("%s: No.%s %s" % (threadName, counter, time.ctime(time.time())))
            counter -= 1

    # ÂàõÂª∫Êñ∞Á∫øÁ®ã
    thread1 = MT(1, "Thread #1", 1)
    thread2 = MT(2, "Thread #2", 2)

    # ÂºÄÂêØÊñ∞Á∫øÁ®ã
    thread1.start()
    thread2.start()
    thread1.join()
    thread2.join()
    print ("DONE!")

# =üö© Thread restart

Âú®Á∫øÁ®ãÊ®°Âùó‰∏≠Ôºå‰ΩøÁî®Â≠êÁ∫øÁ®ãÂØπË±°Áî®Âà∞join()ÂáΩÊï∞Ôºå‰∏ªÁ∫øÁ®ãÈúÄË¶Å‰æùËµñÂ≠êÁ∫øÁ®ãÊâßË°åÂÆåÊØïÂêéÊâçÁªßÁª≠ÊâßË°å‰ª£Á†Å„ÄÇÂ¶ÇÊûúÂ≠êÁ∫øÁ®ã‰∏ç‰ΩøÁî®join()ÂáΩÊï∞Ôºå‰∏ªÁ∫øÁ®ãÂíåÂ≠êÁ∫øÁ®ãÊòØÂπ∂Ë°åËøêË°åÁöÑÔºåÊ≤°Êúâ‰æùËµñÂÖ≥Á≥ªÔºå‰∏ªÁ∫øÁ®ãÊâßË°å‰∫ÜÔºåÂ≠êÁ∫øÁ®ã‰πüÂú®ÊâßË°å„ÄÇ

Âú®Â§öÁ∫øÁ®ãÂºÄÂèë‰∏≠ÔºåÂ¶ÇÊûúÂ≠êÁ∫øÁ®ãËÆæÂÆö‰∏∫‰∫ÜÂÆàÊä§Á∫øÁ®ãÔºåÂÆàÊä§Á∫øÁ®ã‰ºöÁ≠âÂæÖ‰∏ªÁ∫øÁ®ãËøêË°åÂÆåÊØïÂêéË¢´ÈîÄÊØÅ„ÄÇ‰∏Ä‰∏™‰∏ªÁ∫øÁ®ãÂèØ‰ª•ËÆæÁΩÆÂ§ö‰∏™ÂÆàÊä§Á∫øÁ®ãÔºåÂÆàÊä§Á∫øÁ®ãËøêË°åÁöÑÂâçÊèêÊòØÔºå‰∏ªÁ∫øÁ®ãÂøÖÈ°ªÂ≠òÂú®ÔºåÂ¶ÇÊûú‰∏ªÁ∫øÁ®ã‰∏çÂ≠òÂú®‰∫ÜÔºåÂÆàÊä§Á∫øÁ®ã‰ºöË¢´ÈîÄÊØÅ„ÄÇ

ÁõëËßÜÁ∫øÁ®ãË¶ÅÁî®Á∫øÁ®ãÊ±†Êù•ËøõË°åÁÆ°ÁêÜÔºåÈÄöËøáÂÆàÊä§ËøõÁ®ãÊù•ÁõëÊéßËøô‰∏™ËøõÁ®ãÊ±†ÁöÑÁ∫øÁ®ãÊï∞ÂíåÊØè‰∏Ä‰∏™Á∫øÁ®ãÊòØÂê¶Â≠òÊ¥ªÔºåisAlive Â±ûÊÄßÂà§Êñ≠„ÄÇÂ¶ÇÊûúÊåÇËµ∑‰∫ÜÔºåÂ∞±ËÆ∞ÂΩïÂú®ÈòüÂàó‰∏≠ÔºåÂèØ‰ª•Êää‰∏Ä‰∫õÁ∫øÁ®ãÁöÑÂèÇÊï∞ÈÉΩËÆ∞ÂΩïËøõÂéªÔºåÂÜ≥ÂÆöÊòØÂê¶ÂøÖË¶ÅÈáçÂêØ„ÄÇ ÊúÄÂêéÔºåÊåâÁÖßËÆ∞ÂΩïÁöÑÊ≠ªÊéâËøõÁ®ãÈáçÊñ∞Âú®Á∫øÁ®ãÊ±†‰∏≠Âª∫Á´ã„ÄÇ

‰ª•‰∏ã‰æãÂ≠êÈÄöËøáÊûö‰∏æÂΩìÂâçÂ≠òÊ¥ªÁ∫øÁ®ãÊù•ÁÆ°ÁêÜÔºåÁ∫øÁ®ãÁöÑ args ÂèÇÊï∞ÂèØ‰ª•Á∫øÁ®ãÂêçÂ≠ó‰∏ÄÊ†∑Ôºå‰∏çÂøÖÂè¶ÂÜô‰ª£Á†ÅÁÆ°ÁêÜÔºö

    #coding:utf-8
    import threading, time

    list_ip=['1.1.1.1','2.2.2.2','3.3.3.3']

    def printIP(ip):
        for i in range(1,5):
            print (ip)
            time.sleep(1)

    #ÊØè 2s Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÂêçÔºåÂπ∂Ë∑üÂàùÂßãÁ∫øÁ®ãÁªÑÊØîËæÉÔºåÊüê‰∏ÄÁ∫øÁ®ãÂÅúÊ≠¢ÂêéËá™Âä®ËøêË°å
    def checkThread(sleeptimes=2,initThreadsName=[]):
        for i in range(0, 10):
            aliveNames = []
            threads = threading.enumerate()
            for it in threads:
                aliveNames.append(it.getName())

            print("Keep checking %d..." % i)
            for ip in initThreadsName:
                if ip in aliveNames:
                    pass # ÂΩìÂâçÊüêÁ∫øÁ®ãÂêçÂåÖÂê´Âú®ÂàùÂßãÂåñÁ∫øÁ®ãÁªÑ‰∏≠ÔºåÂèØ‰ª•ËÆ§‰∏∫Á∫øÁ®ã‰ªçÂú®ËøêË°å
                else:
                    print ('>', ip,'stoppedÔºånow restart')
                    t = threading.Thread(target=printIP,args=(ip,))
                    t.setName(ip)
                    t.start()
            time.sleep(sleeptimes)

    if __name__ == '__main__':
        threads=[]
        initThreadsName=[]
        for ip in list_ip:
            t=threading.Thread(target=printIP,args=(ip,))
            t.setName(ip)
            threads.append(t)

        for t in threads:
            t.start()

        init=threading.enumerate()
        for i in init:
            initThreadsName.append(i.getName())

        # ÁõëÊä§Á∫øÁ®ãÔºåÊ£ÄÊü• down Á∫øÁ®ãÂπ∂ÈáçÂêØ
        check=threading.Thread(target=checkThread,args=(2, initThreadsName))
        check.setName('Thread:check')
        check.setDaemon(True)
        check.start()


# =üö© Thread Lock Á∫øÁ®ãÂÆâÂÖ®Êú∫Âà∂

 Thread ÂØπË±°ÁöÑ Lock Âíå Rlock ÂèØ‰ª•ÂÆûÁé∞ÁÆÄÂçïÁöÑÁ∫øÁ®ãÂêåÊ≠•ÔºåËøô‰∏§‰∏™ÂØπË±°ÈÉΩÊúâ acquire ÊñπÊ≥ïÂíå release ÊñπÊ≥ïÔºåÂØπ‰∫éÈÇ£‰∫õÈúÄË¶ÅÊØèÊ¨°Âè™ÂÖÅËÆ∏‰∏Ä‰∏™Á∫øÁ®ãÊìç‰ΩúÁöÑÊï∞ÊçÆÔºåÂèØ‰ª•Â∞ÜÂÖ∂Êìç‰ΩúÊîæÂà∞ acquire Âíå release ÊñπÊ≥ï‰πãÈó¥„ÄÇ

    #!/usr/bin/python3

    import threading
    import time

    class MT (threading.Thread):
        def __init__(self, threadID, name, counter):
            threading.Thread.__init__(self)
            self.threadID = threadID
            self.name = name
            self.counter = counter
        def run(self):
            print ("Thread StartÔºö " + self.name)
            # Ëé∑ÂèñÈîÅÔºåÁî®‰∫éÁ∫øÁ®ãÂêåÊ≠•
            threadLock.acquire()
            worker(self.name, self.counter, 3)
            # ÈáäÊîæÈîÅÔºåÂºÄÂêØ‰∏ã‰∏Ä‰∏™Á∫øÁ®ã
            threadLock.release()

    def worker(threadName, delay, counter):
        while counter:
            time.sleep(delay)
            print ("%s: No.%s %s" % (threadName, counter, time.ctime(time.time())))
            counter -= 1

    threadLock = threading.Lock()
    threads = []

    thread1 = MT(1, "Thread #1", 1)
    thread2 = MT(2, "Thread #2", 1.5)

    thread1.start()
    thread2.start()

    threads.append(thread1)
    threads.append(thread2)

    for t in threads:
        t.join()
    print ("DONE!")


# =üö© Thread Queue & Priority Á∫øÁ®ãÈòüÂàó‰ºòÂÖàÊùÉ

Python ÁöÑ Queue Ê®°Âùó‰∏≠Êèê‰æõ‰∫ÜÂêåÊ≠•ÁöÑ„ÄÅÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÈòüÂàóÁ±ªÔºåÂåÖÊã¨ FIFO ÂÖàÂÖ•ÂÖàÂá∫ÈòüÂàó QueueÔºåLIFO ÂêéÂÖ•ÂÖàÂá∫ÈòüÂàó LifoQueueÔºåÂíå‰ºòÂÖàÁ∫ßÈòüÂàó PriorityQueueÔºå‰ΩÜÂÆÉ‰ª¨‰∏çÊòØ‰∏∫‰∫ÜÈáçÂÖ• reentrance ËÄåËÆæËÆ°ÁöÑ„ÄÇ

    import queue

    que = queue.Queue()
    for x in range(1,3):
        que.put(x)

    print("start")
    print(que.qsize())

    que.task_done()
    que.task_done()

    que.join()
    print("end")

Queue Ê®°Âùó‰∏≠ÁöÑÂ∏∏Áî®ÊñπÊ≥ï:

- Queue.qsize() ËøîÂõûÈòüÂàóÁöÑÂ§ßÂ∞è
- Queue.empty() Â¶ÇÊûúÈòüÂàó‰∏∫Á©∫ÔºåËøîÂõûTrue,Âèç‰πãFalse
- Queue.full() Â¶ÇÊûúÈòüÂàóÊª°‰∫ÜÔºåËøîÂõûTrue,Âèç‰πãFalse
- Queue.full ‰∏é maxsize Â§ßÂ∞èÂØπÂ∫î
- Queue.get([block[, timeout]])Ëé∑ÂèñÈòüÂàóÔºåtimeoutÁ≠âÂæÖÊó∂Èó¥
- Queue.get_nowait() Áõ∏ÂΩìQueue.get(False)
- Queue.put(item) ÂÜôÂÖ•ÈòüÂàóÔºåtimeoutÁ≠âÂæÖÊó∂Èó¥
- Queue.put_nowait(item) Áõ∏ÂΩìQueue.put(item, False)
- Queue.task_done() Âú®ÂÆåÊàê‰∏ÄÈ°πÂ∑•‰Ωú‰πãÂêéÔºåQueue.task_done()ÂáΩÊï∞Âêë‰ªªÂä°Â∑≤ÁªèÂÆåÊàêÁöÑÈòüÂàóÂèëÈÄÅ‰∏Ä‰∏™‰ø°Âè∑
- Queue.join() ÂÆûÈôÖ‰∏äÊÑèÂë≥ÁùÄÁ≠âÂà∞ÈòüÂàó‰∏∫Á©∫ÔºåÂÜçÊâßË°åÂà´ÁöÑÊìç‰Ωú

Queue„ÄÅLifoQueue Âèä PriorityQueue Ëøô‰∫õÈòüÂàóÈÉΩÂÆûÁé∞‰∫ÜÈîÅÂéüËØ≠ÔºåËÉΩÂ§üÂú®Â§öÁ∫øÁ®ã‰∏≠Áõ¥Êé•‰ΩøÁî®ÔºåÂèØ‰ª•‰ΩøÁî®ÈòüÂàóÊù•ÂÆûÁé∞Á∫øÁ®ãÈó¥ÁöÑÂêåÊ≠•„ÄÇ

ÂàõÂª∫ÈòüÂàóÊåáÂÆöÈòüÂàóÂ§ßÂ∞èÔºåÂàùÂßãÂåñÊï∞ÊçÆÊó∂‰πü‰∏çËÉΩË∂ÖËøáÈòüÂàóÂÆπÈáèÔºåÂê¶Âàô‰ºöÈîÅÊ≠ªÔºåÈòüÂàóÊñπÊ≥ï task_done() Ë∞ÉÁî®ÂêåÊ†∑Ê¨°Êï∞Ë°®Á§∫‰ªªÂä°ÂÆåÊàêÔºåjoin() ÊñπÊ≥ïËé∑ÂæóËß£ÈîÅ„ÄÇ

‰ΩøÁî® 0 ÂÆπÈáèÂÆû‰æãÂåñÈòüÂàóË°®Á§∫ÈòüÂàóËá™Ë°åÊâ©ÂÆπ„ÄÇ

queueLock Âú®ËøôÈáåÂè™Êó∂ÊºîÁ§∫Áî®Ê≥ïÔºåÂØπ‰∫é queue Ê®°ÂùóÁöÑÂØπÂàóÂπ∂‰∏çÈúÄË¶ÅÊâãÂä®ÈÄöËøá threading.Lock() Âä†ÈîÅ„ÄÇ

    #!/usr/bin/python3

    import queue
    import threading
    import time

    exitFlag = 0

    class MT (threading.Thread):
        def __init__(self, threadID, name, q):
            threading.Thread.__init__(self)
            self.threadID = threadID
            self.name = name
            self.q = q
        def run(self):
            print ("Thread Start: " + self.name)
            process_data(self.name, self.q)
            print ("Thread Exit: " + self.name)

    def process_data(threadName, q):
        while not exitFlag:
            queueLock.acquire()
            if not workQueue.empty():
                data = q.get()
                queueLock.release()
                print ("%s processing %s" % (threadName, data))
            else:
                queueLock.release()
            time.sleep(1)

    threadList = ["Thread #1", "Thread #2", "Thread #3"]
    nameList = ["One", "Two", "Three", "Four", "Five"]
    queueLock = threading.Lock()
    workQueue = queue.Queue(10)
    threads = []
    threadID = 1

    # ÂàõÂª∫Êñ∞Á∫øÁ®ã
    for tName in threadList:
        thread = MT(threadID, tName, workQueue)
        thread.start()
        threads.append(thread)
        threadID += 1

    # Â°´ÂÖÖÈòüÂàó
    queueLock.acquire()
    for word in nameList:
        workQueue.put(word)
    queueLock.release()

    # Á≠âÂæÖÈòüÂàóÊ∏ÖÁ©∫
    while not workQueue.empty():
        pass

    # ÈÄöÁü•Á∫øÁ®ãÊòØÊó∂ÂÄôÈÄÄÂá∫
    exitFlag = 1

    # Á≠âÂæÖÊâÄÊúâÁ∫øÁ®ãÂÆåÊàê
    for t in threads:
        t.join()
    print ("DONE!")


## ==‚ö° ProgressBar Demo

```py
import os
import sys
import time

class ProgressBar:

   def get_console_control(message_type=None):
     return {
         "COMPLETE": '\r\033[92m{message}\033[0m',
         "COURSE": '\r\033[94m{message}\033[0m',
         "WARNING": '\r\033[93m{message}\033[0m',
         "FAIL": '\r\033[91m{message}\033[0m',
     }.get(message_type) or '\r{message}'

   def write(message, message_type=None):
     message_format = ProgressBar.get_console_control(message_type)
     sys.stdout.write(message_format.format(message=message))
     sys.stdout.flush()

   def demo(style=0):
      legend = "‚ñí‚ñì‚ñà‚ñ•‚ñ®‚ñ¶‚ñ©‚ñß"[style if 0<= style < 8 else 0]
      for it in range(0,100):
         kind = "COURSE"
         ani = "‚ñö‚ñû"[it % 2]
         if it>10 and it<20: kind = "WARNING"
         if it>30 and it<40: kind = "FAIL"
         if it == 99: 
            kind = "COMPLETE"
            ani = ""
         ProgressBar.write(legend*int(it/2+1) + ani, kind )
         time.sleep(0.030)

for it in range(0, 8):
   ProgressBar.demo(it)
```

## ==‚ö° Spinner Âä†‰∏™ÊñáÂ≠óÂä®Áîª

GIL - Global Interpreter Lock Âç≥ÂÖ®Â±ÄËß£ÈáäÈîÅ‰øùËØÅ‰∫Ü‰∫ÜÂêå‰∏ÄÊó∂ÂàªÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãÂú®‰∏Ä‰∏™ CPU ‰∏äÊâßË°åÂ≠óËäÇÁ†ÅÔºåÊó†Ê≥ïÂ∞ÜÂ§ö‰∏™Á∫øÁ®ãÊò†Â∞ÑÂà∞Â§ö‰∏™ CPU ‰∏ä„ÄÇËøôÊòØ CPython Ëß£ÈáäÂô®ÁöÑÁº∫Èô∑ÔºåÁî±‰∫é CPython ÊòØÂ§ßÈÉ®ÂàÜÁéØÂ¢É‰∏ãÈªòËÆ§ÁöÑ Python ÊâßË°åÁéØÂ¢ÉÔºåËÄåÂæàÂ§öÂ∫ìÈÉΩÊòØÂü∫‰∫é CPython ÁºñÂÜôÁöÑ„ÄÇ GIL Ë¢´ËÆæËÆ°Êù•‰øùÊä§Á∫øÁ®ãÂÆâÂÖ®ÔºåÁî±‰∫éÂ§öÁ∫øÁ®ãÂÖ±‰∫´ÂèòÈáèÔºåÂ¶ÇÊûú‰∏çËÉΩÂæàÂ•ΩÁöÑËøõË°åÁ∫øÁ®ãÂêåÊ≠•ÔºåÂ§öÁ∫øÁ®ãÈùûÂ∏∏ÂÆπÊòìÂ∞ÜÁ∫øÁ®ãÊîπ‰π±„ÄÇ

GIL Âπ∂‰∏çÊòØ Python ÁöÑÁâπÊÄßÔºåÂÆÉÊòØÂú®ÂÆûÁé∞ Python Ëß£ÊûêÂô® CPython Êó∂ÊâÄÂºïÂÖ•ÁöÑ‰∏Ä‰∏™Ê¶ÇÂøµ„ÄÇÂ∞±Â•ΩÊØî C++ ÊòØ‰∏ÄÂ•óËØ≠Ë®ÄÊ†áÂáÜÔºå‰∏çÂêåÁöÑËΩØ‰ª∂ÂéÇÂïÜÂèØ‰ª•ÂÆûÁé∞ÂêåÁöÑÁºñËØëÂô®Êù•ÁºñËØëÂèØÊâßË°å‰ª£Á†ÅÔºåÂ¶Ç GCCÔºåIntel C++ÔºåVisual C++„ÄÇ

Áî±‰∫é GIL ‰∏çÊòØÊ†πÊçÆ Python ‰ª£Á†ÅÊÆµÊù•ÈáäÊîæÔºåËÄåÊòØÊ†πÊçÆÂ≠óËäÇÁ†ÅÊàñËÄÖÊó∂Èó¥ÁâáÊù•ÈáäÊîæÁöÑÔºåÂΩìÁ®ãÂ∫èÈÅáÂà∞ IO Êìç‰ΩúÂíå time.sleep() Â∞ÜÁ®ãÂ∫èÈòªÂ°ûÊó∂‰ºöËß¶ÂèëÈáäÊîæ GILÔºåÂàõÂª∫‰ªéÂ±ûÁ∫øÁ®ãÔºåÂõ†Ê≠§Â§öÁ∫øÁ®ãÂØπ‰∫éÂ§ÑÁêÜIOÊìç‰ΩúÁöÑÈóÆÈ¢òÈùûÂ∏∏ÊúâÊïà„ÄÇ

itertools.cycle() ÂáΩÊï∞ÂèØ‰ª•‰ªéÊåáÂÆöÁöÑÂ≠óÁ¨¶‰∏≤Â∫èÂàó‰∏≠Âæ™ÁéØ‰∏çÊñ≠Âú∞ÂèñÂá∫ÂÖ∂‰∏≠‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂèØ‰ª•Áî®Êù•ÂÅöÊñáÂ≠óÁöÑËΩÆÂä®„ÄÇ‰ΩøÁî® ASCII Backspace ÈÄÄÊ†ºÊéßÂà∂Á¨¶ `\x08`  ÊääÂÖâÊ†áÁßªÂõûË°åÈ¶ñÔºåËøôÊ†∑ÊñáÂ≠óÁöÑËΩÆÂä®Âá∫Áé∞Âú®ÂêåÊ†∑ÁöÑ‰ΩçÁΩÆÂ∞±ÊúâÂä®ÊÄÅÊïàÊûú‰∫Ü„ÄÇ‰πüÂèØ‰ª•‰ΩøÁî® Carriage Return Ë°åÈ¶ñÊéßÂà∂Á¨¶ '\x0D' Áõ¥Êé•Ë∑≥ËΩ¨Âà∞Ë°åÈ¶ñ„ÄÇ 

supervisor Ëøô‰∏™ÂáΩÊï∞ËÆæÁΩÆ‰ªéÂ±ûÁ∫øÁ®ãÔºåÊòæÁ§∫Á∫øÁ®ãÂØπË±°‰ø°ÊÅØÔºåËøêË°åËÄóÊó∂ËÆ°ÁÆóÔºåÊúÄÂêéÈÄöËøá working = False ÂëäÁü• spiner ÈÄÄÂá∫„ÄÇ

    # sinner_thread.py

    import threading
    import itertools
    import time
    import sys


    class Signal:
        working = True


    def spin(msg, signal):
        write, flush = sys.stdout.write, sys.stdout.flush
        for char in itertools.cycle('|/-\\'):
            status = char + ' ' + msg
            write(status)
            flush()
            write('\x08' * len(status)) 
            time.sleep(.1)
            if not signal.working:
                break

        write(' ' * len(status) + '\x08' * len(status))  # ‰ΩøÁî®Á©∫Ê†ºÊ∏ÖÈô§Áä∂ÊÄÅÊ∂àÊÅØÔºåÊääÂÖâÊ†áÁßªÂõûÂºÄÂ§¥


    def slow_function():
        time.sleep(3)
        return 42


    def supervisor():
        signal = Signal()
        spinner = threading.Thread(target=spin, args=('thinking!', signal))
        print('spinner object:', spinner)
        spinner.start()
        result = slow_function()
        signal.working = False
        spinner.join()  # wait for spinner exit
        return result

    def main():
        result = supervisor()  
        print('Answer', result)


    if __name__ == '__main__':
        main()



# =üö© multi-processing Â§öËøõÁ®ã
[multi-processing](https://www.liaoxuefeng.com/wiki/1016959663602400/1017628290184064)

Ë¶ÅËÆ©PythonÁ®ãÂ∫èÂÆûÁé∞Â§öËøõÁ®ãÔºàmultiprocessingÔºâÔºåÊàë‰ª¨ÂÖà‰∫ÜËß£Êìç‰ΩúÁ≥ªÁªüÁöÑÁõ∏ÂÖ≥Áü•ËØÜ„ÄÇ

Unix/LinuxÊìç‰ΩúÁ≥ªÁªüÊèê‰æõ‰∫Ü‰∏Ä‰∏™fork()Á≥ªÁªüË∞ÉÁî®ÔºåÂÆÉÈùûÂ∏∏ÁâπÊÆä„ÄÇÊôÆÈÄöÁöÑÂáΩÊï∞Ë∞ÉÁî®ÔºåË∞ÉÁî®‰∏ÄÊ¨°ÔºåËøîÂõû‰∏ÄÊ¨°Ôºå‰ΩÜÊòØfork()Ë∞ÉÁî®‰∏ÄÊ¨°ÔºåËøîÂõû‰∏§Ê¨°ÔºåÂõ†‰∏∫Êìç‰ΩúÁ≥ªÁªüËá™Âä®ÊääÂΩìÂâçËøõÁ®ãÔºàÁß∞‰∏∫Áà∂ËøõÁ®ãÔºâÂ§çÂà∂‰∫Ü‰∏Ä‰ªΩÔºàÁß∞‰∏∫Â≠êËøõÁ®ãÔºâÔºåÁÑ∂ÂêéÔºåÂàÜÂà´Âú®Áà∂ËøõÁ®ãÂíåÂ≠êËøõÁ®ãÂÜÖËøîÂõû„ÄÇ

Â≠êËøõÁ®ãÊ∞∏ËøúËøîÂõû0ÔºåËÄåÁà∂ËøõÁ®ãËøîÂõûÂ≠êËøõÁ®ãÁöÑID„ÄÇËøôÊ†∑ÂÅöÁöÑÁêÜÁî±ÊòØÔºå‰∏Ä‰∏™Áà∂ËøõÁ®ãÂèØ‰ª•forkÂá∫ÂæàÂ§öÂ≠êËøõÁ®ãÔºåÊâÄ‰ª•ÔºåÁà∂ËøõÁ®ãË¶ÅËÆ∞‰∏ãÊØè‰∏™Â≠êËøõÁ®ãÁöÑIDÔºåËÄåÂ≠êËøõÁ®ãÂè™ÈúÄË¶ÅË∞ÉÁî®getppid()Â∞±ÂèØ‰ª•ÊãøÂà∞Áà∂ËøõÁ®ãÁöÑID„ÄÇ

PythonÁöÑosÊ®°ÂùóÂ∞ÅË£Ö‰∫ÜÂ∏∏ËßÅÁöÑÁ≥ªÁªüË∞ÉÁî®ÔºåÂÖ∂‰∏≠Â∞±ÂåÖÊã¨forkÔºåÂèØ‰ª•Âú®PythonÁ®ãÂ∫è‰∏≠ËΩªÊùæÂàõÂª∫Â≠êËøõÁ®ãÔºö

    import os

    print('Process (%s) start...' % os.getpid())
    # Only works on Unix/Linux/Mac:
    pid = os.fork()
    if pid == 0:
        print('I am child process (%s) and my parent is %s.' % (os.getpid(), os.getppid()))
    else:
        print('I (%s) just created a child process (%s).' % (os.getpid(), pid))

ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö

    Process (876) start...
    I (876) just created a child process (877).
    I am child process (877) and my parent is 876.

Áî±‰∫é Windows Ê≤°Êúâ fork Ë∞ÉÁî®Ôºå‰∏äÈù¢ÁöÑ‰ª£Á†ÅÂú® Windows ‰∏äÊó†Ê≥ïËøêË°å„ÄÇÁî±‰∫é Mac Á≥ªÁªüÊòØÂü∫‰∫éBSDÔºàUnixÁöÑ‰∏ÄÁßçÔºâÂÜÖÊ†∏ÔºåÊâÄ‰ª•ÔºåÂú®Mac‰∏ãËøêË°åÊòØÊ≤°ÊúâÈóÆÈ¢òÁöÑ„ÄÇ

Êúâ‰∫ÜforkË∞ÉÁî®Ôºå‰∏Ä‰∏™ËøõÁ®ãÂú®Êé•Âà∞Êñ∞‰ªªÂä°Êó∂Â∞±ÂèØ‰ª•Â§çÂà∂Âá∫‰∏Ä‰∏™Â≠êËøõÁ®ãÊù•Â§ÑÁêÜÊñ∞‰ªªÂä°ÔºåÂ∏∏ËßÅÁöÑApacheÊúçÂä°Âô®Â∞±ÊòØÁî±Áà∂ËøõÁ®ãÁõëÂê¨Á´ØÂè£ÔºåÊØèÂΩìÊúâÊñ∞ÁöÑhttpËØ∑Ê±ÇÊó∂ÔºåÂ∞±forkÂá∫Â≠êËøõÁ®ãÊù•Â§ÑÁêÜÊñ∞ÁöÑhttpËØ∑Ê±Ç„ÄÇ

Áî±‰∫éPythonÊòØË∑®Âπ≥Âè∞ÁöÑÔºåËá™ÁÑ∂‰πüÂ∫îËØ•Êèê‰æõ‰∏Ä‰∏™Ë∑®Âπ≥Âè∞ÁöÑÂ§öËøõÁ®ãÊîØÊåÅ„ÄÇmultiprocessing Ê®°ÂùóÂ∞±ÊòØË∑®Âπ≥Âè∞ÁâàÊú¨ÁöÑÂ§öËøõÁ®ãÊ®°ÂùóÔºåÊèê‰æõ‰∫Ü‰∏Ä‰∏™ Process Á±ªÊù•‰ª£Ë°®‰∏Ä‰∏™ËøõÁ®ãÂØπË±°Ôºå‰∏ãÈù¢ÁöÑ‰æãÂ≠êÊºîÁ§∫‰∫ÜÂêØÂä®‰∏Ä‰∏™Â≠êËøõÁ®ãÂπ∂Á≠âÂæÖÂÖ∂ÁªìÊùüÔºö

    from multiprocessing import Process
    import os

    # Â≠êËøõÁ®ãË¶ÅÊâßË°åÁöÑ‰ª£Á†Å
    def run_proc(name):
        print('Run child process %s (%s)...' % (name, os.getpid()))

    if __name__=='__main__':
        print('Parent process %s.' % os.getpid())
        p = Process(target=run_proc, args=('test',))
        print('Child process will start.')
        p.start()
        p.join()
        print('Child process end.')

ÊâßË°åÁªìÊûúÂ¶Ç‰∏ãÔºö

    Parent process 928.
    Process will start.
    Run child process test (929)...
    Process end.

ÂàõÂª∫Â≠êËøõÁ®ãÊó∂ÔºåÂè™ÈúÄË¶Å‰º†ÂÖ•‰∏Ä‰∏™ÊâßË°åÂáΩÊï∞ÂíåÂáΩÊï∞ÁöÑÂèÇÊï∞ÔºåÂàõÂª∫‰∏Ä‰∏™ProcessÂÆû‰æãÔºåÁî®start()ÊñπÊ≥ïÂêØÂä®ÔºåËøôÊ†∑ÂàõÂª∫ËøõÁ®ãÊØîfork()ËøòË¶ÅÁÆÄÂçï„ÄÇjoin()ÊñπÊ≥ïÂèØ‰ª•Á≠âÂæÖÂ≠êËøõÁ®ãÁªìÊùüÂêéÂÜçÁªßÁª≠ÂæÄ‰∏ãËøêË°åÔºåÈÄöÂ∏∏Áî®‰∫éËøõÁ®ãÈó¥ÁöÑÂêåÊ≠•„ÄÇ


Â¶ÇÊûúË¶ÅÂêØÂä®Â§ßÈáèÁöÑÂ≠êËøõÁ®ãÔºåÂèØ‰ª•Áî®ËøõÁ®ãÊ±† Pool ÁöÑÊñπÂºèÊâπÈáèÂàõÂª∫Â≠êËøõÁ®ãÔºö

    from multiprocessing import Pool
    import os, time, random

    def long_time_task(name):
        print('Run task %s (%s)...' % (name, os.getpid()))
        start = time.time()
        time.sleep(random.random() * 3)
        end = time.time()
        print('Task %s runs %0.2f seconds.' %(name, os.getpid()))

    if __name__=='__main__':
        print('Parent process %s.' % os.getpid())
        p = Pool(4)
        for i in range(5):
            p.apply_async(long_time_task, args=(i,))
        print('Waiting for all subprocesses return...')
        p.close()
        p.join()
        print('All done.')

ÂØπPoolÂØπË±°Ë∞ÉÁî®join()ÊñπÊ≥ï‰ºöÁ≠âÂæÖÊâÄÊúâÂ≠êËøõÁ®ãÊâßË°åÂÆåÊØïÔºåË∞ÉÁî®join()‰πãÂâçÂøÖÈ°ªÂÖàË∞ÉÁî®close()ÔºåË∞ÉÁî®close()‰πãÂêéÂ∞±‰∏çËÉΩÁªßÁª≠Ê∑ªÂä†Êñ∞ÁöÑProcess‰∫Ü„ÄÇ

ËØ∑Ê≥®ÊÑèËæìÂá∫ÁöÑÁªìÊûúÔºåtask 0Ôºå1Ôºå2Ôºå3ÊòØÁ´ãÂàªÊâßË°åÁöÑÔºåËÄåtask 4Ë¶ÅÁ≠âÂæÖÂâçÈù¢Êüê‰∏™taskÂÆåÊàêÂêéÊâçÊâßË°åÔºåËøôÊòØÂõ†‰∏∫Pool(4)ËÆæÁΩÆÊúÄÂ§öÂêåÊó∂ÊâßË°å4‰∏™ËøõÁ®ã„ÄÇ

Áî±‰∫éPoolÁöÑÈªòËÆ§Â§ßÂ∞èÊòØCPUÁöÑÊ†∏Êï∞ÔºåÂ¶ÇÊûú‰Ω†‰∏çÂπ∏Êã•Êúâ8Ê†∏CPUÔºå‰Ω†Ë¶ÅÊèê‰∫§Ëá≥Â∞ë9‰∏™Â≠êËøõÁ®ãÊâçËÉΩÁúãÂà∞‰∏äÈù¢ÁöÑÁ≠âÂæÖÊïàÊûú„ÄÇ

ÂæàÂ§öÊó∂ÂÄôÔºåÂ≠êËøõÁ®ãÂπ∂‰∏çÊòØËá™Ë∫´ÔºåËÄåÊòØ‰∏Ä‰∏™Â§ñÈÉ®ËøõÁ®ã„ÄÇÊàë‰ª¨ÂàõÂª∫‰∫ÜÂ≠êËøõÁ®ãÂêéÔºåËøòÈúÄË¶ÅÊéßÂà∂Â≠êËøõÁ®ãÁöÑËæìÂÖ•ÂíåËæìÂá∫„ÄÇ

subprocess Ê®°ÂùóÂèØ‰ª•ËÆ©Êàë‰ª¨ÈùûÂ∏∏Êñπ‰æøÂú∞ÂêØÂä®‰∏Ä‰∏™Â≠êËøõÁ®ãÔºåÁÑ∂ÂêéÊéßÂà∂ÂÖ∂ËæìÂÖ•ÂíåËæìÂá∫„ÄÇ

‰∏ãÈù¢ÁöÑ‰æãÂ≠êÊºîÁ§∫‰∫ÜÂ¶Ç‰ΩïÂú®Python‰ª£Á†Å‰∏≠ËøêË°åÂëΩ‰ª§ nslookup ÔºåËøôÂíåÂëΩ‰ª§Ë°åÁõ¥Êé•ËøêË°åÁöÑÊïàÊûúÊòØ‰∏ÄÊ†∑ÁöÑÔºö

    import subprocess

    print('$ nslookup www.python.org')
    r = subprocess.call(['nslookup', 'www.python.org'])
    print('Exit code:', r)

ËøêË°åÁªìÊûúÔºö

    $ nslookup www.python.org
    Server:     192.168.19.4
    Address:    192.168.19.4#53

    Non-authoritative answer:
    www.python.org  canonical name = python.map.fastly.net.
    Name:   python.map.fastly.net
    Address: 199.27.79.223

    Exit code: 0

Â¶ÇÊûúÂ≠êËøõÁ®ãËøòÈúÄË¶ÅËæìÂÖ•ÔºåÂàôÂèØ‰ª•ÈÄöËøácommunicate()ÊñπÊ≥ïËæìÂÖ•Ôºö

    import subprocess

    print('$ nslookup')
    p = subprocess.Popen(['nslookup'], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    output, err = p.communicate(b'set q=mx\npython.org\nexit\n')
    print(output.decode('utf-8'))
    print('Exit code:', p.returncode)

‰∏äÈù¢ÁöÑ‰ª£Á†ÅÁõ∏ÂΩì‰∫éÂú®ÂëΩ‰ª§Ë°åÊâßË°åÂëΩ‰ª§nslookupÔºåÁÑ∂ÂêéÊâãÂä®ËæìÂÖ•Ôºö

    set q=mx
    python.org
    exit

ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö

    $ nslookup
    Server:     192.168.19.4
    Address:    192.168.19.4#53

    Non-authoritative answer:
    python.org  mail exchanger = 50 mail.python.org.

    Authoritative answers can be found from:
    mail.python.org internet address = 82.94.164.166
    mail.python.org has AAAA address 2001:888:2000:d::a6


    Exit code: 0

ËøõÁ®ãÈó¥ÈÄö‰ø°

Process ‰πãÈó¥ËÇØÂÆöÊòØÈúÄË¶ÅÈÄö‰ø°ÁöÑÔºåÊìç‰ΩúÁ≥ªÁªüÊèê‰æõ‰∫ÜÂæàÂ§öÊú∫Âà∂Êù•ÂÆûÁé∞ËøõÁ®ãÈó¥ÁöÑÈÄö‰ø°„ÄÇPython ÁöÑ multiprocessing Ê®°ÂùóÂåÖË£Ö‰∫ÜÂ∫ïÂ±ÇÁöÑÊú∫Âà∂ÔºåÊèê‰æõ‰∫Ü Queue„ÄÅPipes Á≠âÂ§öÁßçÊñπÂºèÊù•‰∫§Êç¢Êï∞ÊçÆ„ÄÇ

Êàë‰ª¨‰ª• Queue ‰∏∫‰æãÔºåÂú®Áà∂ËøõÁ®ã‰∏≠ÂàõÂª∫‰∏§‰∏™Â≠êËøõÁ®ãÔºå‰∏Ä‰∏™ÂæÄ Queue ÈáåÂÜôÊï∞ÊçÆÔºå‰∏Ä‰∏™‰ªé Queue ÈáåËØªÊï∞ÊçÆÔºö

    from multiprocessing import Process, Queue
    import os, time, random

    # ÂÜôÊï∞ÊçÆËøõÁ®ãÊâßË°åÁöÑ‰ª£Á†Å:
    def write(q):
        print('Process to write: %s' % os.getpid())
        for value in ['A', 'B', 'C']:
            print('Put %s to queue...' % value)
            q.put(value)
            time.sleep(random.random())

    # ËØªÊï∞ÊçÆËøõÁ®ãÊâßË°åÁöÑ‰ª£Á†Å:
    def read(q):
        print('Process to read: %s' % os.getpid())
        while True:
            value = q.get(True)
            print('Get %s from queue.' % value)

    if __name__=='__main__':
        # Áà∂ËøõÁ®ãÂàõÂª∫QueueÔºåÂπ∂‰º†ÁªôÂêÑ‰∏™Â≠êËøõÁ®ãÔºö
        q = Queue()
        pw = Process(target=write, args=(q,))
        pr = Process(target=read, args=(q,))
        # ÂêØÂä®Â≠êËøõÁ®ãpwÔºåÂÜôÂÖ•:
        pw.start()
        # ÂêØÂä®Â≠êËøõÁ®ãprÔºåËØªÂèñ:
        pr.start()
        # Á≠âÂæÖpwÁªìÊùü:
        pw.join()
        # prËøõÁ®ãÈáåÊòØÊ≠ªÂæ™ÁéØÔºåÊó†Ê≥ïÁ≠âÂæÖÂÖ∂ÁªìÊùüÔºåÂè™ËÉΩÂº∫Ë°åÁªàÊ≠¢:
        pr.terminate()

ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö

    Process to write: 50563
    Put A to queue...
    Process to read: 50564
    Get A from queue.
    Put B to queue...
    Get B from queue.
    Put C to queue...
    Get C from queue.

Âú® Unix/Linux ‰∏ãÔºåmultiprocessing Ê®°ÂùóÂ∞ÅË£Ö‰∫Ü fork() Ë∞ÉÁî®Ôºå‰ΩøÊàë‰ª¨‰∏çÈúÄË¶ÅÂÖ≥Ê≥® fork() ÁöÑÁªÜËäÇ„ÄÇÁî±‰∫é Windows Ê≤°ÊúâforkË∞ÉÁî®ÔºåÂõ†Ê≠§Ôºåmultiprocessing ÈúÄË¶ÅÊ®°ÊãüÂá∫ fork ÁöÑÊïàÊûúÔºåÁà∂ËøõÁ®ãÊâÄÊúâ Python ÂØπË±°ÈÉΩÂøÖÈ°ªÈÄöËøá pickle Â∫èÂàóÂåñÂÜç‰º†Âà∞Â≠êËøõÁ®ãÂéªÔºåÊâÄÊúâÔºåÂ¶ÇÊûú multiprocessing Âú® Windows ‰∏ãË∞ÉÁî®Â§±Ë¥•‰∫ÜÔºåË¶ÅÂÖàËÄÉËôëÊòØ‰∏çÊòØpickleÂ§±Ë¥•‰∫Ü„ÄÇ


# =üö© Thread vs Process ÂàÜÂ∏ÉÂºèËøõÁ®ã
[ÂàÜÂ∏ÉÂºèËøõÁ®ã](https://www.liaoxuefeng.com/wiki/1016959663602400/1017631559645600)

Âú®ThreadÂíåProcess‰∏≠ÔºåÂ∫îÂΩì‰ºòÈÄâProcessÔºåÂõ†‰∏∫ProcessÊõ¥Á®≥ÂÆöÔºåËÄå‰∏îÔºåProcessÂèØ‰ª•ÂàÜÂ∏ÉÂà∞Â§öÂè∞Êú∫Âô®‰∏äÔºåËÄåThreadÊúÄÂ§öÂè™ËÉΩÂàÜÂ∏ÉÂà∞Âêå‰∏ÄÂè∞Êú∫Âô®ÁöÑÂ§ö‰∏™CPU‰∏ä„ÄÇ

PythonÁöÑmultiprocessingÊ®°Âùó‰∏ç‰ΩÜÊîØÊåÅÂ§öËøõÁ®ãÔºåÂÖ∂‰∏≠managersÂ≠êÊ®°ÂùóËøòÊîØÊåÅÊääÂ§öËøõÁ®ãÂàÜÂ∏ÉÂà∞Â§öÂè∞Êú∫Âô®‰∏ä„ÄÇ‰∏Ä‰∏™ÊúçÂä°ËøõÁ®ãÂèØ‰ª•‰Ωú‰∏∫Ë∞ÉÂ∫¶ËÄÖÔºåÂ∞Ü‰ªªÂä°ÂàÜÂ∏ÉÂà∞ÂÖ∂‰ªñÂ§ö‰∏™ËøõÁ®ã‰∏≠Ôºå‰æùÈù†ÁΩëÁªúÈÄö‰ø°„ÄÇÁî±‰∫émanagersÊ®°ÂùóÂ∞ÅË£ÖÂæàÂ•ΩÔºå‰∏çÂøÖ‰∫ÜËß£ÁΩëÁªúÈÄö‰ø°ÁöÑÁªÜËäÇÔºåÂ∞±ÂèØ‰ª•ÂæàÂÆπÊòìÂú∞ÁºñÂÜôÂàÜÂ∏ÉÂºèÂ§öËøõÁ®ãÁ®ãÂ∫è„ÄÇ

‰∏æ‰∏™‰æãÂ≠êÔºöÂ¶ÇÊûúÊàë‰ª¨Â∑≤ÁªèÊúâ‰∏Ä‰∏™ÈÄöËøá Queue ÈÄö‰ø°ÁöÑÂ§öËøõÁ®ãÁ®ãÂ∫èÂú®Âêå‰∏ÄÂè∞Êú∫Âô®‰∏äËøêË°åÔºåÁé∞Âú®ÔºåÁî±‰∫éÂ§ÑÁêÜ‰ªªÂä°ÁöÑËøõÁ®ã‰ªªÂä°ÁπÅÈáçÔºåÂ∏åÊúõÊääÂèëÈÄÅ‰ªªÂä°ÁöÑËøõÁ®ãÂíåÂ§ÑÁêÜ‰ªªÂä°ÁöÑËøõÁ®ãÂàÜÂ∏ÉÂà∞‰∏§Âè∞Êú∫Âô®‰∏ä„ÄÇÊÄé‰πàÁî®ÂàÜÂ∏ÉÂºèËøõÁ®ãÂÆûÁé∞Ôºü

ÂéüÊúâÁöÑ Queue ÂèØ‰ª•ÁªßÁª≠‰ΩøÁî®Ôºå‰ΩÜÊòØÔºåÈÄöËøá managers Ê®°ÂùóÊää Queue ÈÄöËøáÁΩëÁªúÊö¥Èú≤Âá∫ÂéªÔºåÂ∞±ÂèØ‰ª•ËÆ©ÂÖ∂‰ªñÊú∫Âô®ÁöÑËøõÁ®ãËÆøÈóÆ Queue ‰∫Ü„ÄÇ

Êàë‰ª¨ÂÖàÁúãÊúçÂä°ËøõÁ®ãÔºåÊúçÂä°ËøõÁ®ãË¥üË¥£ÂêØÂä® QueueÔºåÊää Queue Ê≥®ÂÜåÂà∞ÁΩëÁªú‰∏äÔºåÁÑ∂ÂêéÂæÄ Queue ÈáåÈù¢ÂÜôÂÖ•‰ªªÂä°Ôºö

    # task_master.py

    import random, time, queue
    from multiprocessing.managers import BaseManager
    from multiprocessing import freeze_support

    # ‰ªéBaseManagerÁªßÊâøÁöÑQueueManager:
    class QueueManager(BaseManager):
        pass

    # ÂèëÈÄÅ‰ªªÂä°ÁöÑÈòüÂàó:
    task_queue = queue.Queue()
    # Êé•Êî∂ÁªìÊûúÁöÑÈòüÂàó:
    result_queue = queue.Queue()

    def get_task_queue(): return task_queue
    def get_result_queue(): return result_queue

    # Windows ËøõÁ®ãÊ±†Áõ∏ÂÖ≥‰ª£Á†ÅÂ∫îËØ•ÊîæÂú® if __name__ == '__main__'
    if __name__ == '__main__':
        #windows‰∏ãÂ§öËøõÁ®ãÂèØËÉΩ‰ºöÁÇ∏ÔºåÊ∑ªÂä†ËøôÂè•ÂèØ‰ª•ÁºìËß£
        freeze_support()

        # Êää‰∏§‰∏™QueueÈÉΩÊ≥®ÂÜåÂà∞ÁΩëÁªú‰∏ä, callableÂèÇÊï∞ÂÖ≥ËÅî‰∫ÜQueueÂØπË±°ÔºåWindows ‰∏çÊîØÊåÅ lambda:
        # QueueManager.register('get_task_queue', callable=lambda: task_queue)
        # QueueManager.register('get_result_queue', callable=lambda: result_queue)

        QueueManager.register('get_task_queue', callable=get_task_queue)
        QueueManager.register('get_result_queue', callable=get_result_queue)

        #ÁªëÂÆöÁ´ØÂè£Âπ∂ËÆæÁΩÆÈ™åËØÅÁ†ÅÔºåwindows‰∏ãÈúÄË¶ÅÂ°´ÂÜôipÂú∞ÂùÄÔºålinux‰∏ã‰∏çÂ°´ÈªòËÆ§‰∏∫Êú¨Âú∞
        manager = QueueManager(address = ('127.0.0.1',5000),authkey = b'abc');

        # ÂêØÂä®Queue:
        manager.start()
        # Ëé∑ÂæóÈÄöËøáÁΩëÁªúËÆøÈóÆÁöÑQueueÂØπË±°:
        task = manager.get_task_queue()
        result = manager.get_result_queue()
        # ÊîæÂá†‰∏™‰ªªÂä°ËøõÂéª:
        for i in range(10):
            n = random.randint(0, 10000)
            print('Put task %d...' % n)
            task.put(n)
        # ‰ªéresultÈòüÂàóËØªÂèñÁªìÊûú:
        print('Try get results...')
        for i in range(10):
            r = result.get(timeout=10)
            print('Result: %s' % r)

        #‰∏ÄÂÆöË¶ÅÂÖ≥Èó≠ÔºåÂê¶Âàô‰ºöÁàÜÁÆ°ÈÅìÊú™ÂÖ≥Èó≠ÁöÑÈîôËØØ
        manager.shutdown();

        print('master exit.')

Á¨¨‰∏ÄÁÇπwindows‰∏ãÁªëÂÆöË∞ÉÁî®Êé•Âè£‰∏çËÉΩ‰ΩøÁî®lambdaÔºåÊâÄ‰ª•Âè™ËÉΩÂÖàÂÆö‰πâÂáΩÊï∞ÂÜçÁªëÂÆö Á¨¨‰∫åÁÇπÁªëÂÆöÁ´ØÂè£Âπ∂ËÆæÁΩÆÈ™åËØÅÁ†ÅÔºåwindows‰∏ãÈúÄË¶ÅÂ°´ÂÜôipÂú∞ÂùÄÔºålinux‰∏ã‰∏çÂ°´ÔºåÈªòËÆ§‰∏∫Êú¨Âú∞„ÄÇ

ËØ∑Ê≥®ÊÑèÔºåÂΩìÊàë‰ª¨Âú®‰∏ÄÂè∞Êú∫Âô®‰∏äÂÜôÂ§öËøõÁ®ãÁ®ãÂ∫èÊó∂ÔºåÂàõÂª∫ÁöÑ Queue ÂèØ‰ª•Áõ¥Êé•ÊãøÊù•Áî®Ôºå‰ΩÜÊòØÔºåÂú®ÂàÜÂ∏ÉÂºèÂ§öËøõÁ®ãÁéØÂ¢É‰∏ãÔºåÊ∑ªÂä†‰ªªÂä°Âà∞ Queue ‰∏çÂèØ‰ª•Áõ¥Êé•ÂØπÂéüÂßãÁöÑtask_ queue ËøõË°åÊìç‰ΩúÔºåÈÇ£Ê†∑Â∞±ÁªïËøá‰∫Ü QueueManagerÁöÑÂ∞ÅË£ÖÔºåÂøÖÈ°ªÈÄöËøá manager.get_task_queue() Ëé∑ÂæóÁöÑ Queue Êé•Âè£Ê∑ªÂä†„ÄÇ

ÁÑ∂ÂêéÔºåÂú®Âè¶‰∏ÄÂè∞Êú∫Âô®‰∏äÂêØÂä®‰ªªÂä°ËøõÁ®ãÔºàÊú¨Êú∫‰∏äÂêØÂä®‰πüÂèØ‰ª•ÔºâÔºö

    # task_worker.py

    import time, sys, queue
    from multiprocessing.managers import BaseManager

    # ÂàõÂª∫Á±ª‰ººÁöÑQueueManager:
    class QueueManager(BaseManager):
        pass

    # Áî±‰∫éËøô‰∏™QueueManagerÂè™‰ªéÁΩëÁªú‰∏äËé∑ÂèñQueueÔºåÊâÄ‰ª•Ê≥®ÂÜåÊó∂Âè™Êèê‰æõÂêçÂ≠ó:
    QueueManager.register('get_task_queue')
    QueueManager.register('get_result_queue')

    # ËøûÊé•Âà∞ÊúçÂä°Âô®Ôºå‰πüÂ∞±ÊòØËøêË°åtask_master.pyÁöÑÊú∫Âô®:
    server_addr = '127.0.0.1'
    print('Connect to server %s...' % server_addr)
    # Á´ØÂè£ÂíåÈ™åËØÅÁ†ÅÊ≥®ÊÑè‰øùÊåÅ‰∏étask_master.pyËÆæÁΩÆÁöÑÂÆåÂÖ®‰∏ÄËá¥:
    m = QueueManager(address=(server_addr, 5000), authkey=b'abc')
    # ‰ªéÁΩëÁªúËøûÊé•:
    m.connect()
    # Ëé∑ÂèñQueueÁöÑÂØπË±°:
    task = m.get_task_queue()
    result = m.get_result_queue()
    # ‰ªétaskÈòüÂàóÂèñ‰ªªÂä°,Âπ∂ÊääÁªìÊûúÂÜôÂÖ•resultÈòüÂàó:
    for i in range(10):
        try:
            n = task.get(timeout=1)
            print('run task %d * %d...' % (n, n))
            r = '%d * %d = %d' % (n, n, n*n)
            time.sleep(1)
            result.put(r)
        except Queue.Empty:
            print('task queue is empty.')
    # Â§ÑÁêÜÁªìÊùü:
    print('worker exit.')

‰ªªÂä°ËøõÁ®ãË¶ÅÈÄöËøáÁΩëÁªúËøûÊé•Âà∞ÊúçÂä°ËøõÁ®ãÔºåÊâÄ‰ª•Ë¶ÅÊåáÂÆöÊúçÂä°ËøõÁ®ãÁöÑIP„ÄÇ

Áé∞Âú®ÔºåÂèØ‰ª•ËØïËØïÂàÜÂ∏ÉÂºèËøõÁ®ãÁöÑÂ∑•‰ΩúÊïàÊûú‰∫Ü„ÄÇÂÖàÂêØÂä®task_master.pyÊúçÂä°ËøõÁ®ãÔºåÂèëÈÄÅÂÆå‰ªªÂä°ÂêéÔºåÂºÄÂßãÁ≠âÂæÖresultÈòüÂàóÁöÑÁªìÊûú„ÄÇÁÑ∂ÂêéÂêØÂä®task_worker.pyËøõÁ®ãÔºö

    $ python3 task_master.py 
    $ python3 task_worker.py

Ëøô‰∏™ÁÆÄÂçïÁöÑMaster/WorkerÊ®°ÂûãÊúâ‰ªÄ‰πàÁî®ÔºüÂÖ∂ÂÆûËøôÂ∞±ÊòØ‰∏Ä‰∏™ÁÆÄÂçï‰ΩÜÁúüÊ≠£ÁöÑÂàÜÂ∏ÉÂºèËÆ°ÁÆóÔºåÊää‰ª£Á†ÅÁ®çÂä†ÊîπÈÄ†ÔºåÂêØÂä®Â§ö‰∏™workerÔºåÂ∞±ÂèØ‰ª•Êää‰ªªÂä°ÂàÜÂ∏ÉÂà∞Âá†Âè∞ÁîöËá≥Âá†ÂçÅÂè∞Êú∫Âô®‰∏äÔºåÊØîÂ¶ÇÊääËÆ°ÁÆó`n*n`ÁöÑ‰ª£Á†ÅÊç¢ÊàêÂèëÈÄÅÈÇÆ‰ª∂ÔºåÂ∞±ÂÆûÁé∞‰∫ÜÈÇÆ‰ª∂ÈòüÂàóÁöÑÂºÇÊ≠•ÂèëÈÄÅ„ÄÇ

QueueÂØπË±°Â≠òÂÇ®Âú®Âì™ÔºüÊ≥®ÊÑèÂà∞task_worker.py‰∏≠Ê†πÊú¨Ê≤°ÊúâÂàõÂª∫QueueÁöÑ‰ª£Á†ÅÔºåÊâÄ‰ª•ÔºåQueueÂØπË±°Â≠òÂÇ®Âú®task_master.pyËøõÁ®ã‰∏≠„ÄÇ

ËÄåQueue‰πãÊâÄ‰ª•ËÉΩÈÄöËøáÁΩëÁªúËÆøÈóÆÔºåÂ∞±ÊòØÈÄöËøáQueueManagerÂÆûÁé∞ÁöÑ„ÄÇÁî±‰∫éQueueManagerÁÆ°ÁêÜÁöÑ‰∏çÊ≠¢‰∏Ä‰∏™QueueÔºåÊâÄ‰ª•ÔºåË¶ÅÁªôÊØè‰∏™QueueÁöÑÁΩëÁªúË∞ÉÁî®Êé•Âè£Ëµ∑‰∏™ÂêçÂ≠óÔºåÊØîÂ¶Çget_task_queue„ÄÇ

authkeyÊúâ‰ªÄ‰πàÁî®ÔºüËøôÊòØ‰∏∫‰∫Ü‰øùËØÅ‰∏§Âè∞Êú∫Âô®Ê≠£Â∏∏ÈÄö‰ø°Ôºå‰∏çpip install tensorflowË¢´ÂÖ∂‰ªñÊú∫Âô®ÊÅ∂ÊÑèÂπ≤Êâ∞„ÄÇÂ¶ÇÊûútask_worker.pyÁöÑauthkeyÂíåtask_master.pyÁöÑauthkey‰∏ç‰∏ÄËá¥ÔºåËÇØÂÆöËøûÊé•‰∏ç‰∏ä„ÄÇ


# =üö© Shell call

ÊñπÊ≥ï‰∏Ä„ÄÅ‰ΩøÁî® os.systemÔºàcmdÔºâÔºåÂÖ∂ËøîÂõûÂÄºÊòØshellÊåá‰ª§ËøêË°åÂêéËøîÂõûÁöÑÁä∂ÊÄÅÁ†ÅÔºåintÁ±ªÂûãÔºå0Ë°®Á§∫shellÊåá‰ª§ÊàêÂäüÊâßË°åÔºå256Ë°®Á§∫Êú™ÊâæÂà∞ÔºåËØ•ÊñπÊ≥ïÈÄÇÁî®‰∫éshellÂëΩ‰ª§‰∏çÈúÄË¶ÅËæìÂá∫ÂÜÖÂÆπÁöÑÂú∫ÊôØ„ÄÇ

    import os
    val = os.system('ls -al')
    print val

Ê≤°ÊúâÊâæÂà∞Êó∂ÔºåshËøîÂõûÁöÑÁä∂ÊÄÅÁ†ÅÊòØ1ÔºåËÄåÈÄÇÁî®pythonË∞ÉÁî®ÔºåËøîÂõûÁöÑÊòØÔºö256

ÊñπÊ≥ï‰∫å„ÄÅ‰ΩøÁî®os.popen()ÔºåËØ•ÊñπÊ≥ï‰ª•Êñá‰ª∂ÁöÑÂΩ¢ÂºèËøîÂõûshellÊåá‰ª§ËøêË°åÂêéÁöÑÁªìÊûúÔºåÈúÄË¶ÅËé∑ÂèñÂÜÖÂÆπÊó∂ÂèØ‰ΩøÁî®read()ÊàñreadlinesÔºàÔºâÊñπÊ≥ïÔºå‰∏æ‰æãÂ¶Ç‰∏ãÔºö

    import os
    val = os.popen('ls -al')
    for i in val.readlines():
        print(i)

ÊñπÊ≥ï‰∏â„ÄÅ‰ΩøÁî®commandsÊ®°ÂùóÔºåÊúâ‰∏â‰∏™ÊñπÊ≥ïÂèØ‰ª•‰ΩøÁî®Ôºö

Ôºà1Ôºâcommands.getstatusoutput(cmd)ÔºåÂÖ∂‰ª•Â≠óÁ¨¶‰∏≤ÁöÑÂΩ¢ÂºèËøîÂõûÁöÑÊòØËæìÂá∫ÁªìÊûúÂíåÁä∂ÊÄÅÁ†ÅÔºåÂç≥Ôºàstatus,outputÔºâ„ÄÇ
Ôºà2Ôºâcommands.getoutput(cmd)ÔºåËøîÂõûcmdÁöÑËæìÂá∫ÁªìÊûú„ÄÇ
Ôºà3Ôºâcommands.getstatus(file)ÔºåËøîÂõûls -l fileÁöÑÊâßË°åÁªìÊûúÂ≠óÁ¨¶‰∏≤ÔºåË∞ÉÁî®‰∫ÜgetoutputÔºå‰∏çÂª∫ËÆÆ‰ΩøÁî®Ê≠§ÊñπÊ≥ï

ÊñπÊ≥ïÂõõ„ÄÅsubprocess Ê®°ÂùóÔºåÂÖÅËÆ∏ÂàõÂª∫ÂæàÂ§öÂ≠êËøõÁ®ãÔºåÂàõÂª∫ÁöÑÊó∂ÂÄôËÉΩÊåáÂÆöÂ≠êËøõÁ®ãÂíåÂ≠êËøõÁ®ãÁöÑËæìÂÖ•„ÄÅËæìÂá∫„ÄÅÈîôËØØËæìÂá∫ÁÆ°ÈÅìÔºåÊâßË°åÂêéËÉΩËé∑ÂèñËæìÂá∫ÁªìÊûúÂíåÊâßË°åÁä∂ÊÄÅ„ÄÇ

Ôºà1Ôºâsubprocess.run()Ôºöpython3.5‰∏≠Êñ∞Â¢ûÁöÑÂáΩÊï∞Ôºå ÊâßË°åÊåáÂÆöÁöÑÂëΩ‰ª§Ôºå Á≠âÂæÖÂëΩ‰ª§ÊâßË°åÂÆåÊàêÂêéËøîÂõû‰∏Ä‰∏™ÂåÖÂê´ÊâßË°åÁªìÊûúÁöÑCompletedProcessÁ±ªÁöÑÂÆû‰æã„ÄÇ
Ôºà2Ôºâsubprocess.call()ÔºöÊâßË°åÊåáÂÆöÁöÑÂëΩ‰ª§Ôºå ËøîÂõûÂëΩ‰ª§ÊâßË°åÁä∂ÊÄÅÔºå ÂäüËÉΩÁ±ª‰ººos.systemÔºàcmdÔºâ„ÄÇ
Ôºà3Ôºâsubprocess.check_call()Ôºöpython2.5‰∏≠Êñ∞Â¢ûÁöÑÂáΩÊï∞, ÊâßË°åÊåáÂÆöÁöÑÂëΩ‰ª§, Â¶ÇÊûúÊâßË°åÊàêÂäüÂàôËøîÂõûÁä∂ÊÄÅÁ†ÅÔºå Âê¶ÂàôÊäõÂá∫ÂºÇÂ∏∏„ÄÇ

ËØ¥ÊòéÔºö

    subprocess.run(args, *, stdin=None, input=None, stdout=None, stderr=None, shell=False, timeout=None, check=False, universal_newlines=False)

„ÄÄ„ÄÄsubprocess.call(args, *, stdin=None, stdout=None, stderr=None, shell=False, timeout=None)

„ÄÄ„ÄÄsubprocess.check_call(args, *, stdin=None, stdout=None, stderr=None, shell=False, timeout=None)


argsÔºöË°®Á§∫shellÊåá‰ª§ÔºåËã•‰ª•Â≠óÁ¨¶‰∏≤ÂΩ¢ÂºèÁªôÂá∫shellÊåá‰ª§ÔºåÂ¶Ç"ls -l "ÂàôÈúÄË¶Å‰Ωøshell = Ture„ÄÇÂê¶ÂàôÈªòËÆ§Â∑≤Êï∞ÁªÑÂΩ¢ÂºèË°®Á§∫shellÂèòÈáèÔºåÂ¶Ç"ls","-l"„ÄÇ

ÂΩì‰ΩøÁî®ÊØîËæÉÂ§çÊùÇÁöÑshellËØ≠Âè•Êó∂ÔºåÂèØ‰ª•ÂÖà‰ΩøÁî®shlexÊ®°ÂùóÁöÑshlex.split()ÊñπÊ≥ïÊù•Â∏ÆÂä©Ê†ºÂºèÂåñÂëΩ‰ª§ÔºåÁÑ∂ÂêéÂú®‰º†ÈÄíÁªôrun()ÊñπÊ≥ïÊàñPopen„ÄÇ



# =üö© QT5 GUI
- [Qt for Python](https://www.qt.io/qt-for-python)
- [PyQt vs PySide](https://machinekoder.com/pyqt-vs-qt-for-python-pyside2-pyside/)
- [PyQt5 Reference Guide](https://www.riverbankcomputing.com/static/Docs/PyQt5/)


PyQt ÊòØÊúÄÊó©Áª¥Êä§ÁöÑ‰∏Ä‰∏™ Python Ê®°ÂùóÔºå2018 Âπ¥ QT ÂÖ¨Âè∏ÈÄÄÂá∫ Qt for Python Êêû‰∫Ü‰∏Ä‰∏™ PySide2ÔºåËøôÊòØ‰∏∫ Python ËØ≠Ë®ÄÊèê‰æõ Qt ÈõÜÊàêÁöÑÂè¶‰∏Ä‰∏™Ê®°Âùó„ÄÇ

PyQt ÊòØ GPLv3 ÂçèËÆÆÔºåÂ§ßÊÑèÊòØ‰Ω†ÁöÑÁ®ãÂ∫è‰∏≠Áî®‰∫ÜÂÆÉÔºå‰Ω†ÁöÑÁ®ãÂ∫èÂ∞±Ë¶ÅÂºÄÊ∫êÔºåÂ¶ÇÊûúÈó≠Ê∫êÂïÜÁî®Â∞±‰ºöËøùÂèçÂçèËÆÆÔºàÂêéÊûúËá™Ë¥üÔºåËÑ∏ÁöÆÂ§üÂéöÊó†ÊâÄË∞ìÔºâ„ÄÇ

PySide ÊòØ LGPL ÂçèËÆÆÔºåÂ¶ÇÊûú‰Ω†Âè™ÊòØ‰Ωú‰∏∫Â∫ìÁî®Áî®ÂÆÉÔºå‰Ω†ÁöÑÁ®ãÂ∫èËøòÊòØÂèØ‰ª•Èó≠Ê∫êÂïÜÁî®„ÄÇ

Â¶ÇÊûú‰∏çÂÅöÂïÜ‰∏öÈ°πÁõÆÔºåÂº∫ÁÉàÂª∫ËÆÆ‰ΩøÁî® PyQtÔºåËµÑÊñôÂ§öÔºåÁ®≥ÂÆöÔºåÈúÄË¶ÅÂºÄÂèëÈó≠Ê∫êÂïÜÁî®ËΩØ‰ª∂ÁöÑÂ∞±Áî® PySide„ÄÇ


PyQt Demo:

    from PyQt5.QtWidgets import QApplication, QLabel

    app = QApplication([])
    label = QLabel('Hello World!')
    label.show()
    app.exec_()

ÊØè‰∏™ QT GUI Á®ãÂ∫èÈÉΩÂøÖÈ°ªÊúâ‰∏îÂè™Êúâ‰∏Ä‰∏™ QApplication ÁöÑÂÆû‰æãÔºåÂàõÂª∫Ëøô‰∏™ÂØπË±°Êó∂ÈúÄË¶Å‰º†ÈÄí‰∏Ä‰∏™ list ÂèÇÊï∞ÔºåÁÑ∂ÂêéÂàõÂª∫ÁªÑ‰ª∂ÔºåÂÜçÊâßË°å GUI Á®ãÂ∫è„ÄÇ


PySide ÂÆòÊñπ DemoÔºåÁªßÊâø‰∫Ü QWidget ÂºÄÂèëËá™Â∑±ÁöÑ Widget ÁªÑ‰ª∂Ôºö

    import sys
    import random
    from PySide2.QtWidgets import (QApplication, QLabel, QPushButton,
                                   QVBoxLayout, QWidget)
    from PySide2.QtCore import Slot, Qt

    class MyWidget(QWidget):
        def __init__(self):
            QWidget.__init__(self)

            self.hello = ["Hallo Welt", "‰Ω†Â•ΩÔºå‰∏ñÁïå", "Hei maailma",
                "Hola Mundo", "–ü—Ä–∏–≤–µ—Ç –º–∏—Ä"]

            self.button = QPushButton("Click me!")
            self.text = QLabel("Hello World")
            self.text.setAlignment(Qt.AlignCenter)

            self.layout = QVBoxLayout()
            self.layout.addWidget(self.text)
            self.layout.addWidget(self.button)
            self.setLayout(self.layout)

            # Connecting the signal
            self.button.clicked.connect(self.magic)

        @Slot()
        def magic(self):
            self.text.setText(random.choice(self.hello))

    if __name__ == "__main__":
        app = QApplication(sys.argv)

        widget = MyWidget()
        widget.resize(800, 600)
        widget.show()

        sys.exit(app.exec_())

Â∏∏Áî®ÁöÑ QWidgets ÁªÑ‰ª∂Ê®°ÂùóÔºö

- QLabel
- QComboBox
- QCheckBox
- QRadioButton
- QPushButton
- QTableWidget
- QLineEdit
- QSlider
- QProgressBar

ËÄåÂ¶Ç‰ΩïÂØπÁïåÈù¢ÁöÑÁªÑ‰ª∂ÊéíÁâàÂ∞±ÊòØÂ∏ÉÂ±ÄÁªÑ‰ª∂ÁöÑÂ∑•‰ΩúÔºåÂÆÉ‰ª¨‰πüÂ±û‰∫é Widget ÁªÑ‰ª∂Ê®°ÂùóÔºåÂ¶ÇÔºö

- QVBoxLayout ÂûÇÁõ¥Â∏ÉÂ±Ä
- QHBoxLayOut Ê∞¥Âπ≥Â∏ÉÂ±Ä


‰ΩøÁî®ÂûÇÁõ¥Â∏ÉÂ±ÄÁªÑ‰ª∂ÁöÑ‰æãÂ≠êÔºö

    from PyQt5.QtWidgets import QApplication, QWidget, QPushButton, QVBoxLayout

    app = QApplication([])

    window = QWidget()
    layout = QVBoxLayout()

    layout.addWidget(QPushButton('Top'))
    layout.addWidget(QPushButton('Bottom'))

    window.setLayout(layout)
    window.show()

    app.exec_()

ÂàõÂª∫‰∫Ü‰∏§‰∏™ QPushButton ÊîæÂú®Â∏ÉÂ±ÄÁªÑ‰ª∂ÈáåÔºå‰ΩøÁî®ÊñπÊ≥ï `SetLayout()` ÊñπÊ≥ïÂëäËØâ window ÂØπË±°Ë¶Å‰ΩøÁî®ÁöÑÂ∏ÉÂ±Ä„ÄÇ

Áõ∏ÂÖ≥ÂÆòÊñπÊñáÊ°£Ôºö

- Getting Started - Qt Examples And Tutorials - Widgets - [Layout Examples](https://doc.qt.io/qt-5/qtexamplesandtutorials.html)
- Overview - User Interface - [Widget-based User Interfaces](https://doc.qt.io/qt-5/topics-ui.html)


## ==‚ö° QT Signals

‰æãÂ≠ê button.clicked Â∞±ÊòØ‰∏™ signalÔºå‰ø°Âè∑ÂÖ≥ËÅîÂà∞ slot Âç≥Â§ÑÁêÜÂáΩÊï∞„ÄÇÂΩìÊàë‰ª¨ÁÇπÂáªËøô‰∏™ÊåâÈíÆÁöÑÊó∂ÂÄôÔºå‰ø°Âè∑Â∞±‰ºöÂá∫Áé∞‰ª•ÔºåÂ§ÑÁêÜ‰∫ã‰ª∂Ëøô‰∏™Âä®‰ΩúÁöÑÂáΩÊï∞Â∞±‰ºöËß¶Âèë„ÄÇSignals Âú® QT ‰∏≠ÊòØÊó†Â§Ñ‰∏çÂú®ÁöÑÔºåÁî®Êà∑‰πüÂèØ‰ª•ÂÆö‰πâËá™Â∑±ÁöÑ signal„ÄÇ


    from PyQt5.QtWidgets import QApplication, QPushButton, QMessageBox

    app = QApplication([])
    app.setStyleSheet("QPushButton { margin: 2ex 4px; }")

    # app.setStyle('Fusion')
    # palette = QPalette()
    # palette.setColor(QPalette.ButtonText, Qt.red)
    # app.setPalette(palette)

    def on_button_clicked():
        alert = QMessageBox()
        alert.setText('You clicked the button!')
        alert.exec_()

    button = QPushButton('Hello')
    button.clicked.connect(on_button_clicked)
    button.show()
    app.exec_()




## ==‚ö° QT APP
- [PyQt EXE Creation](https://build-system.fman.io/pyqt-exe-creation/)
- [fbs EXE Creation](https://github.com/mherrmann/fbs-tutorial)


Âú® Python ÁöÑ‰∏ñÁïå‰∏≠ÔºåÂ∞ÜÊ∫êÁ†ÅËΩ¨Êç¢Êàê‰∏Ä‰∏™ÂèØÊâßË°åÁöÑÂåÖÔºåËøôÁßçÊìç‰ΩúÁß∞‰πã‰∏∫ freezing„ÄÇ‰æãÂ¶Ç PyInstaller/py2exe/cx_Freeze/bbfreze/py2app Á≠âÁ≠âÔºå‰ΩÜÊòØËøô‰∫õ‰º†ÁªüÁöÑÂ∫ìÁî®Êù• freezing ‰∏Ä‰∏™ PyQt Á®ãÂ∫èËøòÊòØÊúâÁÇπÈöæÂ∫¶ÁöÑ„ÄÇ

ÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∏™ÂÖ®Êñ∞ÁöÑ fbs Â∫ìÔºåÂÆÉÂèØ‰ª•ËÆ©Êàë‰ª¨ËΩªÊòìÁöÑÂ∞Ü python Ê∫êÁ†ÅËΩ¨Êç¢Êàê‰∏Ä‰∏™ÊâßË°åÁöÑ PyQt Á®ãÂ∫è„ÄÇ

ÂÆâË£Ö‰ΩøÁî® fbsÔºö

    pip install fbs
    fbs startproject

ÁÑ∂Âêé‰Ω†Â∞±‰ºöÁúãÂà∞‰∏ãÈù¢ÁöÑÊèêÁ§∫Ôºö

    Commands for starting a new project with fbs

ÂΩì‰Ω†ËæìÂÖ•run‰πãÂêéÔºåÂ∞±‰ºöÊâìÂºÄ‰∏Ä‰∏™Á©∫ÁöÑÁ™óÂè£Ôºö

    An empty window showing 'Hello World!' in its title

ËøôÂ∞±Ë∑üÊàë‰ª¨‰πãÂâçÂàõÂª∫ÁöÑ‰∏Ä‰∏™ QT Á®ãÂ∫èÁõ∏‰ºº„ÄÇÂÆÉ‰ºöÂú®Êàë‰ª¨ÁöÑÂΩìÂâçÁõÆÂΩï‰∏ãÂàõÂª∫‰∏Ä‰∏™Êñá‰ª∂ src/main/python/main.py ÁÑ∂ÂêéÊàë‰ª¨ÂèØ‰ª•ËØïÁùÄÊääÂÆÉÁºñÁ®ã‰∏Ä‰∏™ÂèØÊâßË°åÁöÑÊñá‰ª∂„ÄÇ

    fbs freeze

Ëøô‰∏™ÂëΩ‰ª§Â∞±Âú®‰Ω†ÂΩìÂâçÁöÑÁõÆÂΩïÁöÑ target/MyApp/ Â≠êÁõÆÂΩïÊúâ‰∫Ü‰∏Ä‰∏™ÂèØÊâßË°åÁöÑÊñá‰ª∂„ÄÇÁÑ∂ÂêéÊàë‰ª¨Â∞±ÂèØ‰ª•ÊääÂÆÉÂèëÈÄÅÁªôÂà´‰∫∫‰∫Ü„ÄÇ

Ê≥®ÊÑèÔºöfbs Áé∞Âú®ÊîØÊåÅ Python 3.5 ÊàñËÄÖ 3.6ÔºåÂá∫Áé∞‰∫ÜÈóÆÈ¢òÔºåÂª∫ËÆÆ‰Ω†ÂÆâË£Ö Python 3.6 ÂÜçËØïËØï„ÄÇ

ÈÄöËøá fbs installer ÂëΩ‰ª§Êàë‰ª¨ËøòÂèØ‰ª•ÂàõÂª∫ÂÆâË£ÖÂåÖ„ÄÇÂ¶ÇÊûúÊòØ Windows Á≥ªÁªüÔºåÈÇ£‰πà‰Ω†ÈúÄË¶ÅÂÖàÂÆâË£Ö NSISÔºåÁÑ∂ÂêéÈÖçÁΩÆÂ•ΩÁéØÂ¢ÉÂèòÈáè„ÄÇ



# =üö© matplotlib ÂõæÂΩ¢Â∫ì
- [PyLab module](https://www.tutorialspoint.com/matplotlib/matplotlib_pylab_module.htm)
- [Matplotlib - Quick Guide](https://www.tutorialspoint.com/matplotlib/matplotlib_quick_guide.htm)
- [Documentation overview](https://matplotlib.org/3.1.0/contents.html)

Matplotlib ÊòØ‰∏Ä‰∏™ÊµÅË°åÁöÑ Python ÂõæÂΩ¢Â∫ìÔºåË∑®Âπ≥Âè∞ 2D ÁªÑÂõæÔºåÊèê‰æõ OOP APIÔºåÂÉè PyQt, WxPythonotTkinter ‰∏ÄÊ†∑Êèê‰æõÂõæÂΩ¢ÁïåÈù¢ÔºåÂèØ‰ª•Âú® Python Âíå IPython shells, Jupyter notebook ‰ª•Âèä web application Á≠âËøêË°å„ÄÇ

ÂÆâË£ÖÔºö

    pip3 install matplotlib

Matplotlib ÈúÄË¶Å‰æùËµñÔºö

- Python (>= 2.7 or >= 3.4)
- NumPy
- setuptools
- dateutil
- pyparsing
- libpng
- pytz
- FreeType
- cycler
- six

Âè¶Â§ñÂèØ‰ª•ÈÄâÊã©ÂÆâË£ÖÁöÑÂ∫ì‰ª•Êèê‰æõÊõ¥Â•ΩÁöÑ UIÔºö

- tk
- PyQt4
- PyQt5
- pygtk
- wxpython
- pycairo
- Tornado

ËæìÂá∫ÂõæÂÉèÁªÑ‰ª∂Ôºö

- ffmpeg/avconv
- ImageMagick
- Pillow (>=2.0)
- LaTeX and GhostScript (for rendering text with LaTeX).
- LaTeX and GhostScript (for rendering text with LaTeX).

‰ΩøÁî® Anaconda ÂÆâË£ÖÊòØ‰∏™Â•ΩÊñπÊ≥ïÔºö

    https://repo.continuum.io/archive/Anaconda3-5.1.0-Windows-x86.exe
    https://repo.continuum.io/archive/Anaconda3-5.1.0-Windows-x86_64.exe

    https://repo.continuum.io/archive/Anaconda3-5.1.0-Linux-x86.sh
    https://repo.continuum.io/archive/Anaconda3-5.1.0-Linux-x86_64.sh

    $ bash Anaconda3-5.0.1-Linux-x86_64.sh

Sin Demo:

    from matplotlib import pyplot as plt
    import numpy as np
    import math #needed for definition of pi

    x = np.arange(0, math.pi*2, 0.05)
    y = np.sin(x)
    plt.plot(x,y)
    plt.xlabel("angle")
    plt.ylabel("sine")
    plt.title('sine wave')
    plt.show()

ÂØπË±°Âåñ APIÔºåÂ¶Ç Figure Á±ªÊèê‰æõÁöÑÂ±ûÊÄßÔºö

    fig = plt.figure()

| Â±ûÊÄß        | ËØ¥Êòé    |
| :-------- | :-------- |
| Figsize   | (width,height) tuple in inches |
| Dpi       | Dots per inches |
| Facecolor | Figure patch facecolor |
| Edgecolor | Figure patch edge color |
| Linewidth | Edge line width |

## ==‚ö° subplot
- https://matplotlib.org/3.1.0/api/_as_gen/matplotlib.pyplot.subplot.html
- https://matplotlib.org/3.1.0/api/_as_gen/matplotlib.pyplot.subplot2grid.html

Call signatures:

    subplot(nrows, ncols, index, **kwargs)
    subplot(pos, **kwargs)
    subplot(ax)
    subplot2grid(shape, loc, rowspan=1, colspan=1, fig=None, **kwargs)[source]

Â§öÂõæÁªòÂà∂ subplotsÔºö

    import matplotlib.pyplot as plt
    import numpy as np

    fig,a =  plt.subplots(2,2)
    x = np.arange(1,5)
    
    a[0][0].plot(x,x*x)
    a[0][0].set_title('square')
    a[0][1].plot(x,np.sqrt(x))
    a[0][1].set_title('square root')
    a[1][0].plot(x,np.exp(x))
    a[1][0].set_title('exp')
    a[1][1].plot(x,np.log10(x))
    a[1][1].set_title('log')
    plt.show()

Â§öÂõæÁªòÂà∂ subplot2gridÔºö

    import matplotlib.pyplot as plt
    import numpy as np

    a1 = plt.subplot2grid((3,3),(0,0),colspan = 2)
    a2 = plt.subplot2grid((3,3),(0,2), rowspan = 3)
    a3 = plt.subplot2grid((3,3),(1,0),rowspan = 2, colspan = 2)

    x = np.arange(1,10)
    a2.plot(x, x*x)
    a2.set_title('square')
    a1.plot(x, np.exp(x))
    a1.set_title('exp')
    a3.plot(x, np.log(x))
    a3.set_title('log')
    plt.tight_layout()
    plt.show()

subplots & gridÔºö

    import matplotlib.pyplot as plt
    import numpy as np

    fig, axes = plt.subplots(1,3, figsize = (12,4))
    x = np.arange(1,11)

    axes[0].plot(x, x**3, 'g',lw=2)
    axes[0].grid(True)
    axes[0].set_title('default grid')
    axes[1].plot(x, np.exp(x), 'r')
    axes[1].grid(color='b', ls = '-.', lw = 0.25)
    axes[1].set_title('custom grid')
    axes[2].plot(x,x)
    axes[2].set_title('no grid')
    fig.tight_layout()
    plt.show()


## ==‚ö° wxPython

pip install wxPython

    from matplotlib.backends.backend_wxagg import FigureCanvasWxAgg as FigureCanvas
    from matplotlib.backends.backend_wx import NavigationToolbar2Wx as NavigationToolbar
    from matplotlib.figure import Figure

    import numpy as np

    import wx
    import wx.lib.mixins.inspection as WIT


    class CanvasFrame(wx.Frame):
        def __init__(self):
            wx.Frame.__init__(self, None, -1,
                              'CanvasFrame', size=(550, 350))

            self.figure = Figure()
            self.axes = self.figure.add_subplot(111)
            t = np.arange(0.0, 3.0, 0.01)
            s = np.sin(2 * np.pi * t)

            self.axes.plot(t, s)
            self.canvas = FigureCanvas(self, -1, self.figure)

            self.sizer = wx.BoxSizer(wx.VERTICAL)
            self.sizer.Add(self.canvas, 1, wx.LEFT | wx.TOP | wx.EXPAND)
            self.SetSizer(self.sizer)
            self.Fit()

            self.add_toolbar()  # comment this out for no toolbar

        def add_toolbar(self):
            self.toolbar = NavigationToolbar(self.canvas)
            self.toolbar.Realize()
            # By adding toolbar in sizer, we are able to put it at the bottom
            # of the frame - so appearance is closer to GTK version.
            self.sizer.Add(self.toolbar, 0, wx.LEFT | wx.EXPAND)
            # update the axes menu on the toolbar
            self.toolbar.update()


    # alternatively you could use
    #class App(wx.App):
    class App(WIT.InspectableApp):
        def OnInit(self):
            'Create the main window and insert the custom frame'
            self.Init()
            frame = CanvasFrame()
            frame.Show(True)

            return True

    app = App(0)
    app.MainLoop()


## ==‚ö° math text
- [Documentation Index](https://matplotlib.org/3.1.0/genindex.html)
- https://matplotlib.org/3.1.0/tutorials/text/usetex.html
- https://matplotlib.org/3.1.0/tutorials/text/mathtext.html

‰ΩøÁî® TeXmarkup Â≠êÈõÜÂäüËÉΩÊòæÁ§∫Êï∞Â≠¶Á¨¶Âè∑Ôºå‰∏ä‰∏ãÊ†áÂâçÁºÄ `_`„ÄÅ `^` Á¨¶Âè∑Ôºå`$\alpha` ËΩ¨‰πâÊï∞ÊçÆÁ¨¶Âè∑Ôºö

    import numpy as np
    import matplotlib.pyplot as plt
    t = np.arange(0.0, 2.0, 0.01)
    s = np.sin(2*np.pi*t)

    plt.plot(t,s)
    plt.title(r'$\alpha_i> \beta_i$', fontsize=20)

    plt.text(0.6, 0.6, r'$\mathcal{A}\mathrm{sin}(2 \omega t)$', fontsize = 20)
    plt.text(0.1, -0.5, r'$\sqrt{2}$', fontsize=10)
    plt.xlabel('time (s)')
    plt.ylabel('volts (mV)')
    plt.show()

Matplotlib ÂÜÖÈÉ®ÂÆûÁé∞ LaTeX parserÔºåÂèÇËÄÉ text.usetex ÈÄâÈ°πÔºö

    import matplotlib.pyplot as plt

    fig, ax = plt.subplots()

    ax.plot([1, 2, 3], label=r'$\sqrt{x^2}$')
    ax.legend()

    ax.set_xlabel(r'$\Delta_i^j$', fontsize=20)
    ax.set_ylabel(r'$\Delta_{i+1}^j$', fontsize=20)
    ax.set_title(r'$\Delta_i^j \hspace{0.4} \mathrm{versus} \hspace{0.4} '
                 r'\Delta_{i+1}^j$', fontsize=20)

    tex = r'$\mathcal{R}\prod_{i=\alpha_{i+1}}^\infty a_i\sin(2 \pi f x_i)$'
    ax.text(1, 1.6, tex, fontsize=20, va='bottom')

    fig.tight_layout()
    plt.show()

‰ΩøÁî® LaTexÔºö 

    import numpy as np
    import matplotlib
    import matplotlib.pyplot as plt

    matplotlib.rcParams['text.usetex'] = True

    t = np.linspace(0.0, 1.0, 100)
    s = np.cos(4 * np.pi * t) + 2

    fig, ax = plt.subplots(figsize=(6, 4), tight_layout=True)
    ax.plot(t, s)

    ax.set_xlabel(r'\textbf{time (s)}')
    ax.set_ylabel('\\textit{Velocity (\N{DEGREE SIGN}/sec)}', fontsize=16)
    ax.set_title(r'\TeX\ is Number $\displaystyle\sum_{n=1}^\infty'
                 r'\frac{-e^{i\pi}}{2^n}$!', fontsize=16, color='r')
    plt.show()


## ==‚ö° 3D Plotting
- https://matplotlib.org/3.1.0/gallery/mplot3d/surface3d.html
- https://matplotlib.org/3.1.0/tutorials/index.html

plot3DÔºö

    from mpl_toolkits import mplot3d
    import numpy as np
    import matplotlib.pyplot as plt

    fig = plt.figure()
    ax = plt.axes(projection='3d')
    z = np.linspace(0, 1, 200)
    x = z * np.sin(20 * z)
    y = z * np.cos(20 * z)
    ax.plot3D(x, y, z, 'gray')
    ax.set_title('3D line plot')
    plt.show()

scatterÔºö

    from mpl_toolkits import mplot3d
    import numpy as np
    import matplotlib.pyplot as plt

    fig = plt.figure()
    ax  = plt.axes(projection='3d')
    z   = np.linspace(0, 1, 100)
    x   = z * np.sin(20 * z)
    y   = z * np.cos(20 * z)
    c   = x + y
    ax.scatter(x, y, z, c=c)
    ax.set_title('3d Scatter plot')
    plt.show()

plot_surfaceÔºö

    Axes3D.plot_surface(self, X, Y, Z, *args, norm=None, vmin=None, vmax=None, lightsource=None, **kwargs)[source]

    from mpl_toolkits import mplot3d
    import numpy as np
    import matplotlib.pyplot as plt

    x = np.outer(np.linspace(-2, 2, 130), np.ones(130))
    y = x.copy().T # transpose
    z = np.cos(x ** 2 + y ** 2)

    fig = plt.figure()
    ax = plt.axes(projection='3d')

    ax.plot_surface(x, y, z, cmap='viridis', edgecolor='none')
    ax.set_title('Surface plot')
    plt.show()

plot_trisurfÔºö

    # This import registers the 3D projection, but is otherwise unused.
    from mpl_toolkits.mplot3d import Axes3D  # noqa: F401 unused import

    import matplotlib.pyplot as plt
    import numpy as np

    n_radii = 8
    n_angles = 36

    # Make radii and angles spaces (radius r=0 omitted to eliminate duplication).
    radii = np.linspace(0.125, 1.0, n_radii)
    angles = np.linspace(0, 2*np.pi, n_angles, endpoint=False)[..., np.newaxis]

    # Convert polar (radii, angles) coords to cartesian (x, y) coords.
    # (0, 0) is manually added at this stage,  so there will be no duplicate
    # points in the (x, y) plane.
    x = np.append(0, (radii*np.cos(angles)).flatten())
    y = np.append(0, (radii*np.sin(angles)).flatten())

    # Compute z to make the pringle surface.
    z = np.sin(-x*y)

    fig = plt.figure()
    ax = fig.gca(projection='3d')

    ax.plot_trisurf(x, y, z, linewidth=0.0, antialiased=True)

    plt.show()

contour3DÔºö

    from mpl_toolkits import mplot3d
    import numpy as np
    import matplotlib.pyplot as plt

    def f(x, y):
       return np.sin(np.sqrt(x ** 2 + y ** 2))

    x = np.linspace(-6, 6, 120)
    y = np.linspace(-6, 6, 120)

    X, Y = np.meshgrid(x, y)
    Z = f(X, Y)

    fig = plt.figure()
    ax = plt.axes(projection='3d')
    ax.contour3D(X, Y, Z, 120, cmap='binary')
    ax.set_xlabel('x')
    ax.set_ylabel('y')
    ax.set_zlabel('z')
    ax.set_title('3D contour')
    plt.show()

plot_wireframeÔºö

    from mpl_toolkits import mplot3d
    import numpy as np
    import matplotlib.pyplot as plt

    def f(x, y):
       return np.sin(np.sqrt(x ** 2 + y ** 2))
        
    x = np.linspace(-6, 6, 130)
    y = np.linspace(-6, 6, 130)

    X, Y = np.meshgrid(x, y)
    Z = f(X, Y)

    fig = plt.figure()
    ax = plt.axes(projection='3d')
    ax.plot_wireframe(X, Y, Z, color='y')
    ax.set_title('wireframe')
    plt.show()


## ==‚ö° PyLab module

matplotlib.pyplot ÊòØ‰∏Ä‰∏™Èöè Matplotlib ÂÆâË£ÖÁöÑ‰ΩúÂõæÊ®°ÂùóÔºåÁ±ª‰ºº MathWorks ÁöÑ MATLAB ËΩØ‰ª∂„ÄÇÂèØ‰ª•ËÆ§‰∏∫ Matplotlib + NumPy Â∞±ÊòØÂºÄÊ∫êÁâà MATLAB„ÄÇ

Basic Plotting

    from numpy import *
    from pylab import *
    x = linspace(-3, 3, 30)
    y = x**2
    plot(x, y)
    show()

‰ΩøÁî®ÂÖ∂ÂÆÉÁ¨¶Âè∑ÂíåÈ¢úËâ≤‰ΩúÂõæ

    - , ‚Äì, -., , . , , , o , ^ , v , < , > , s , + , x , 
    D , d , 1 , 2 , 3 , 4 , h , H , p , | , _

È¢úËâ≤ÊåáÂÆö b, g, r, c, m, y, k, w

    from pylab import *
    x = linspace(-3, 3, 30)
    y = x**2
    plot(x, y, 'ro')
    show()

Â§öÂ±ÇÂè†Âä†Ôºö

    from numpy import *
    from pylab import *
    x = linspace(-3, 3, 160)

    plot(x, sin(x))
    plot(x, cos(x), 'r-')
    plot(x, -sin(x), 'g--')
    show()




# =üö© Tornado Web Ê°ÜÊû∂
[Tornado ÊñáÊ°£](https://tornado-zh.readthedocs.io/zh/latest/index.html)
[Tornado Documentation](http://www.tornadoweb.org/en/stable/)

Tornado ÊòØ Python ÁºñÂÜôÁöÑ Web ÊúçÂä°Âô®Ôºå‰πüÊòØ Web Â∫îÁî®Ê°ÜÊû∂Ôºö

‚úì ËΩªÈáèÁ∫ßwebÊ°ÜÊû∂
‚úì ÂºÇÊ≠•ÈùûÈòªÂ°ûIOÂ§ÑÁêÜÊñπÂºè
‚úì Âá∫Ëâ≤ÁöÑÊäóË¥üËΩΩËÉΩÂäõ
‚úì ‰ºòÂºÇÁöÑÂ§ÑÁêÜÊÄßËÉΩÔºå‰∏ç‰æùËµñÂ§öËøõÁ®ã/Â§öÁ∫øÁ®ãÔºå‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äËß£ÂÜ≥C10KÈóÆÈ¢ò
‚úì WSGIÂÖ®Ê†àÊõø‰ª£‰∫ßÂìÅÔºåÊé®ËçêÂêåÊó∂‰ΩøÁî®ÂÖ∂webÊ°ÜÊû∂ÂíåHTTPÊúçÂä°Âô®

Tornado VS Django

Django ÈáçÈáèÁ∫ßwebÊ°ÜÊû∂ÔºåÂäüËÉΩÂ§ßËÄåÂÖ®ÔºåÊ≥®ÈáçÈ´òÊïàÂºÄÂèëÔºåÂÜÖÁΩÆÁÆ°ÁêÜÂêéÂè∞ÔºåÂÜÖÁΩÆÂ∞ÅË£ÖÂÆåÂñÑÁöÑ ORM Êìç‰ΩúÔºåsessionÂäüËÉΩÔºåÁº∫Èô∑ÔºöÈ´òËÄ¶ÂêàÔºÅ
Tornado ËΩªÈáèÁ∫ßwebÊ°ÜÊû∂ÔºåÂäüËÉΩÂ∞ëËÄåÁ≤æÔºåÊ≥®ÈáçÊÄßËÉΩ‰ºòË∂ä„ÄÇ ÊòØ HTTP ÊúçÂä°Âô®ÔºåÊîØÊåÅÂºÇÊ≠•ÁºñÁ®ãÔºåWebSocketÔºåÁº∫Èô∑ÔºöÂÖ•Èó®Èó®ÊßõËæÉÈ´òÔºÅ

**Â§áÊ≥®Ôºö** TornadoÂ∫îËØ•ËøêË°åÂú®Á±ªUnixÂπ≥Âè∞Ôºå‰∏∫‰∫ÜËææÂà∞ÊúÄ‰Ω≥ÁöÑÊÄßËÉΩÂíåÊâ©Â±ïÊÄßÔºå‰ªÖÊé®ËçêLinuxÂíåBSDÂÖÖÂàÜÂà©Áî®LinuxÁöÑepollÂ∑•ÂÖ∑ÂíåBSDÁöÑkqueueËææÂà∞È´òÊÄßËÉΩÂ§ÑÁêÜÁöÑÁõÆÁöÑ)

```py
#-*- coding:utf-8 -*-
import tornado.web
import tornado.ioloop

class IndexHandler(tornado.web.RequestHandler):
    def get(self):
        self.write('it works.')

if __name__ == '__main__':
    app = tornado.web.Application([(r'/',IndexHandler)], autoreload=True)
    app.listen(8888)
    tornado.ioloop.IOLoop.current().start()
```

‰øùÂ≠ò demo.py Âπ∂ÂÆâË£Ö‰æùËµñÂåÖÔºåÂÜçËøêË°åÁ®ãÂ∫èÔºåÊµèËßà http://localhost:8888Ôºö

    pip install tornado
    python demo.py


# =üö© Flask Web Ê°ÜÊû∂
[Flash Documention](https://flask.palletsprojects.com/en/1.1.x/)

Flask ÊòØËΩªÈáè WSGI Web Ê°ÜÊû∂ÔºåÂü∫‰∫é Werkzeug WSGI & Jinja Ê®°ÊùøÂºïÊìéÔºåÁõ∏ÂØπ Django Á≤æÁÆÄÔºå‰πüÂ∞±ÊòØËØ¥Ê≤°Êúâ Django ÈÇ£Ê†∑Êèê‰æõ‰∏∞ÂØåÁöÑÈÖç‰ª∂Ôºå‰ΩÜÂ•ΩÂ§ÑÊòØÊèí‰ª∂Êâ©Â±ïËÆæËÆ°ÂêàÁêÜ„ÄÇ

‰ΩøÁî® virtualen ÂàõÂª∫È°πÁõÆÁéØÂ¢ÉÔºö

    $ mkdir myproject
    $ cd myproject
    $ python3 -m venv venv
    
    # On Windows:
    $ py -3 -m venv venv

‰ΩøÁî® Python 2 ÈúÄË¶ÅÂè¶Ë°åÂÆâË£Ö virtualenvÔºö

    $ python2 -m virtualenv venv

    # On Windows:
    > \Python27\Scripts\virtualenv.exe venv

Âú®È°πÁõÆ‰ΩøÁî®ÂâçÔºåÊâßË°åÊøÄÊ¥ªÂëΩ‰ª§ËøõÂÖ• virtualenv ÁéØÂ¢ÉÔºåÈÄÄÂá∫ÂëΩ‰ª§ÊòØ deactivateÔºö

    $ . venv/bin/activate

    # On Windows:
    > venv\Scripts\activate

Âú® virtualenv ÁéØÂ¢ÉÂÆâË£Ö FlaskÔºåÂèØËÉΩÈúÄË¶ÅÂçáÁ∫ß PIPÔºö

    $ python -m pip install --upgrade pip
    $ pip install Flask && pip list

ÂèØ‰ª•‰ΩøÁî®ÊúÄÊñ∞ÁöÑÂºÄÂèëÁâàÔºö

    $ pip install -U https://github.com/pallets/flask/archive/master.tar.gz


‰ΩøÁî® Python 2 Êó∂ÊòØÊ≤°ÊúâÊèê‰æõ venv Ê®°ÂùóÁöÑÔºåÈúÄË¶ÅÂè¶Ë°åÂÆâË£Ö„ÄÇ

    # Debian, Ubuntu
    $ sudo apt-get install python-virtualenv

    # CentOS, Fedora
    $ sudo yum install python-virtualenv

    # Arch
    $ sudo pacman -S python-virtualenv


    # Mac OS X or Windows, download https://bootstrap.pypa.io/get-pip.py
    $ sudo python2 Downloads/get-pip.py
    $ sudo python2 -m pip install virtualenv

    # On Windows, as an administrator:
    > \Python27\python.exe Downloads\get-pip.py
    > \Python27\python.exe -m pip install virtualenv


```py
from flask import Flask, escape, request

app = Flask(__name__)

@app.route('/')
def hello():
    name = request.args.get("name", "World")
    return f'Hello, {escape(name)}!'
# $ env FLASK_APP=hello.py flask run
#  * Serving Flask app "hello"
#  * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

‰∏Ä‰∏™ Flask Â∫îÁî®ÁõÆÂΩïÁªìÊûÑÂü∫Êú¨‰ºöÂåÖÊã¨ `flaskr` ÁõÆÂΩïÂ≠òÊîæÁ®ãÂ∫èÁöÑ Python ÂåÖ„ÄÇ`tests`ÁõÆÂΩïÂ≠òÊîæÊµãËØïÊ®°Âùó„ÄÇ`venv` ‰Ωú‰∏∫ Python ËôöÊãüÁéØÂ¢ÉÔºåÂç≥ virtualenv ÁîüÊàêÁöÑ‰∏ìÁî® Pythond ËøêË°åÁéØÂ¢É„ÄÇÈ°πÁõÆÁõÆÂΩïÁªìÊûÑÂ§ßÊ¶ÇÂ¶Ç‰∏ãÔºö

    /Projects/flask-tutorial
    ‚îú‚îÄ‚îÄ flaskr/
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ db.py
    ‚îÇ   ‚îú‚îÄ‚îÄ schema.sql
    ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
    ‚îÇ   ‚îú‚îÄ‚îÄ blog.py
    ‚îÇ   ‚îú‚îÄ‚îÄ templates/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.html
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.html
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register.html
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ blog/
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ create.html
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.html
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ update.html
    ‚îÇ   ‚îî‚îÄ‚îÄ static/
    ‚îÇ       ‚îî‚îÄ‚îÄ style.css
    ‚îú‚îÄ‚îÄ tests/
    ‚îÇ   ‚îú‚îÄ‚îÄ conftest.py
    ‚îÇ   ‚îú‚îÄ‚îÄ data.sql
    ‚îÇ   ‚îú‚îÄ‚îÄ test_factory.py
    ‚îÇ   ‚îú‚îÄ‚îÄ test_db.py
    ‚îÇ   ‚îú‚îÄ‚îÄ test_auth.py
    ‚îÇ   ‚îî‚îÄ‚îÄ test_blog.py
    ‚îú‚îÄ‚îÄ venv/
    ‚îú‚îÄ‚îÄ setup.py
    ‚îî‚îÄ‚îÄ MANIFEST.in

Â¶ÇÊûú‰ΩøÁî® git ÁâàÊú¨ÊéßÂà∂ÔºåÂàô `.gitignore` Êñá‰ª∂ÂèØ‰ª•ËøôÊ†∑ÂÜôÔºö

    venv/

    *.pyc
    __pycache__/

    instance/

    .pytest_cache/
    .coverage
    htmlcov/

    dist/
    build/
    *.egg-info/

‰ª•‰∏ãÊòØ‰∏Ä‰∏™Á≤æÁÆÄÂäüËÉΩÁöÑ Flask Â∫îÁî®Ôºå‰Ωú‰∏∫ Demo Âπ∂‰∏çÈúÄË¶ÅËøô‰πàÂ§çÊùÇÁöÑÁªìÊûÑÔºåÂè™ÈúÄË¶Å‰∏§‰∏™Êñá‰ª∂Â∞±ÂèØ‰ª•‰∫Ü„ÄÇDemo Â±ïÁ§∫‰∫ÜÂü∫Êú¨ÁöÑÊ®°ÊùøÂä†ËΩΩ„ÄÅË∑ØÁî±ËÆæÁΩÆÁªëÂÆöÂ§ö‰∏™URLÂà∞ÂáΩÊï∞‰∏é‰∏âÁßçÂèÇÊï∞ÁªëÂÆöÊñπÂºèÔºåËøòÊúâ url_for() ÂáΩÊï∞ÁîüÊàê URLÔºö

    #-*- coding:utf-8 -*-

    from flask import Flask, escape, url_for, render_template
    app = Flask(__name__)

    @app.route('/')
    def hello_world():
        return 'Hello, World!'

    @app.route('/hello')
    @app.route('/hello/<name>')
    def hello(name=None):
        return render_template('hello.html', name=name)

    @app.route('/test/<path:subpath>/<int:post_id>/<username>', methods=['GET', 'POST'])
    def show_user_profile(subpath, post_id, username):
        return '%s : %s : %s : %s' % ( url_for("hello", name="Jane"), subpath, post_id, escape(username))

Âú® template ÁõÆÂΩïÂàõÂª∫‰∏Ä‰∏™Êë∏ÊùøÊñá‰ª∂Ôºö

    <!doctype html>
    <title>Hello from Flask</title>
    {% if name %}
      <h1>Hello {{ name }}!</h1>
    {% else %}
      <h1>Hello, World!</h1>
    {% endif %}

Â¶ÇÊûúÊòØÊ®°ÂùóÊñπÂºèËøêË°åÔºåÊ®°ÊùøÁõÆÂΩïÂíåÁ®ãÂ∫èÂêå‰∏ÄÁ∫ßÁõÆÂΩïÔºåÂ¶ÇÊûúÊòØÁ®ãÂ∫èÂåÖ package ÊñπÂºèÂàôÊîæÂú® application ÁõÆÂΩï‰∏ã„ÄÇ

ËøêË°åÁ®ãÂ∫èÂèØ‰ª•‰ΩøÁî® flask ÂëΩ‰ª§Êàñ `python -m flask`„ÄÇÂèØ‰ª•ËÆæÁΩÆ FLASK_APP ÁéØÂ¢ÉÂèòÈáèÊù•ÂëäËØâ FLask Ë¶ÅËøêË°åÁöÑÁ®ãÂ∫èÔºåËÆæÁΩÆ `FLASK_DEBUG=1` ÊâìÂºÄË∞ÉËØïÊ®°ÂºèÔºå`FLASK_ENV=development` ËÆæÁΩÆÂºÄÂèëÊ®°ÂºèÔºö

    $ export FLASK_APP=flaskDemo.py
    $ export FLASK_ENV=development
    $ export FLASK_DEBUG=1
    $ flask run

    # Windows
    C:\path\to\app>set FLASK_APP=flaskDemo.py

    # PowerShell:
    PS C:\path\to\app> $env:FLASK_APP = "flaskDemo.py"

    $ python -m flask run
    $ flask run

Â¶ÇÊûúËøêË°åÊó∂ÊèêÁ§∫Êâæ‰∏çÂà∞ Flask ÂåÖÔºåÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ

    ImportError: cannot import name 'Flask' from 'flask'

ÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÂëΩ‰ª§Êàñ Python ËÑöÊú¨Ê£ÄÊü•ÁéØÂ¢ÉÂèòÈáèÊúâÊ≤°ÊúâÊåáÂÆöÂåÖÊâÄÂú®Ë∑ØÂæÑÔºö

    python -c "import sys;print(sys.path)"

    import sys
    print (sys.path)

Â¶ÇÊûúÊ≤°ÊúâÂ∞±Âú®ÁéØÂ¢ÉÂèòÈáè PYTHONPATH ‰∏≠Ê∑ªÂä†ÔºåÊàñËÄÖÈÄöËøáËÑöÊú¨Ê∑ªÂä† `sys.path.append('/path/to/flask/')` „ÄÇ

Â¶ÇÊûúÂ∑≤ÁªèÂåÖÂê´ Flask ÂåÖÊâÄÂú®Ë∑ØÂæÑËøòÊèêÁ§∫ÂØºÂÖ•ÂåÖÂ§±Ë¥•ÔºåÈÇ£‰πàËøõË¶ÅÊ£ÄÊü•‰∏Ä‰∏ãÁ®ãÂ∫èÊñá‰ª∂ÂêçÊòØ‰∏çÂíåÂåÖÂëΩÈáçÂ§ç‰∫ÜÔºÅ‰∏Ä‰∏™Áõ¥Êé•Á≤óÊö¥ÁöÑËß£ÂÜ≥ÂäûÊ≥ïÂ∞±ÊòØÂ∞Ü flask ÂåÖÁõÆÂΩïÊã∑Ë¥ù‰∏Ä‰ªΩÊîæÂà∞Á®ãÂ∫èÊñá‰ª∂ÊâÄÂú®ÁõÆÂΩï‰∏ãÔºÅ


# =üö© Django Web Ê°ÜÊû∂ 
- [Download Django](https://www.djangoproject.com/download/)
- [Django Documentation](https://docs.djangoproject.com/)
- [Quick install guide](https://docs.djangoproject.com/en/2.2/intro/install/)

Django ÁâàÊú¨ÂØπÂ∫îÁöÑ Python ÁâàÊú¨Ôºö

    Django ÁâàÊú¨       Python ÁâàÊú¨
    1.8             2.7, 3.2 , 3.3, 3.4, 3.5
    1.9, 1.10       2.7, 3.4, 3.5
    1.11            2.7, 3.4, 3.5, 3.6
    2.0             3.4, 3.5, 3.6, 3.7
    2.1, 2.2        3.5, 3.6, 3.7

‰∏ãËΩΩ Django ÂéãÁº©ÂåÖÔºåËß£ÂéãÂπ∂Âíå Python ÂÆâË£ÖÁõÆÂΩïÊîæÂú®Âêå‰∏Ä‰∏™Ê†πÁõÆÂΩïÔºåËøõÂÖ• Django ÁõÆÂΩïÔºåÊâßË°åÂÆâË£ÖÂëΩ‰ª§ÔºåDjango Â∞ÜË¶ÅË¢´ÂÆâË£ÖÂà∞ Python\Lib\site-packages„ÄÇ

    python setup.py install
    git clone https://github.com/django/django.git

Êàñ‰ΩøÁî® pip ‰æùËµñÁÆ°ÁêÜÂ∑•ÂÖ∑ÂÆâË£ÖÔºåÈúÄË¶ÅÊúÄÊñ∞ÁöÑÂºÄÂèëÁâàÔºåÂèØ‰ª•ÂÖãÈöÜ‰ªìÂ∫ìÔºö

    pip install Django==2.2.4

pip ÂëΩ‰ª§‰ºöËá™Âä®‰∏ãËΩΩÂÆâË£ÖÂåÖ whl Ê†ºÂºèÊñá‰ª∂„ÄÇÂÆÉÊòØ‰∏Ä‰∏™ÂéãÁº©ÂåÖÔºåÈáåÈù¢ÂåÖÂê´‰∫ÜpyÊñá‰ª∂‰ª•ÂèäÁªèËøáÁºñËØëÁöÑpydÊñá‰ª∂„ÄÇ‰ΩøÂæóÂèØ‰ª•Âú®‰∏çÂÖ∑Â§áÁºñËØëÁéØÂ¢ÉÁöÑÊÉÖÂÜµ‰∏ãÔºåÈÄâÊã©ÂêàÈÄÇËá™Â∑±ÁöÑpythonÁéØÂ¢ÉËøõË°åÂÆâË£ÖÔºåÊàñËÄÖÂçáÁ∫ßÔºö

    pip install xxxx.whl
    pip install -U xxxx.whl

ËøòÂèØ‰ª•‰ΩøÁî® python-setuptools Êèê‰æõÁöÑ easy_install ÂëΩ‰ª§ÂÆâË£Ö django

    yum install python-setuptools
    easy_install django

Â¶ÇÊûúÊó∂‰∏ãËΩΩÂÆâË£ÖÔºåÂàôÈúÄË¶ÅÊâãÂä®ËøêË°åÂÆâË£ÖËÑöÊú¨ÔºåÂπ∂ÂÖàËß£ÂéãÔºö

    $ tar zxvf Django-2.2.4.tar.gz
    cd Django-2.2.4
    sudo python setup.py install

ÁÑ∂ÂêéÊòØÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáèÔºåÊ†πÊçÆ Django ÂÆâË£ÖÁõÆÂΩïÔºåÂ∞ÜÂÖ∂ bin ÁõÆÂΩïÊ∑ªÂä†Âà∞Á≥ªÁªüÁéØÂ¢ÉÂèòÈáè‰∏≠„ÄÇPython ÁöÑ Scripts ÁõÆÂΩï‰∏ÄËà¨Âú®ÂÆâË£ÖÁ®ãÂ∫èËâ≤ËÆæÁΩÆÔºåÂ¶ÇÊûúÊ≤°ÊúâÂú®ÁéØÂ¢ÉÂèòÈáè‰∏≠Ôºå‰πü‰∏ÄÂπ∂Ê∑ªÂä†Ôºö 

    C:\Python37\Lib\site-packages\django;C:\Python37\Scripts

Ê∑ªÂä†ÂÆåÊàêÂêéÂ∞±ÂèØ‰ª•‰ΩøÁî® Django ÁöÑ django-admin.py ÂëΩ‰ª§Êñ∞Âª∫Â∑•Á®ã‰∫Ü„ÄÇ ËøõÂÖ• Python ‰∫§‰∫íÁéØÂ¢ÉÔºåËæìÂÖ•‰ª•‰∏ãÂëΩ‰ª§Ê£ÄÊü•ÊòØÂê¶ÂÆâË£ÖÊàêÂäü:

    python --version

    >>> import django
    >>> django.get_version()
    >>> print(django.get_version())

ÂÆö‰Ωç Python ÁöÑÁõÆÂΩï‰ΩçÁΩÆÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§Ôºö

    where python

    python -c "from distutils.sysconfig import get_python_lib; print(get_python_lib());"

    >>> import os
    >>> os.path.dirname(os.__file__)

    >>> from distutils.sysconfig import get_python_lib
    >>> print(get_python_lib())


## ==‚ö° Django Admin ÁÆ°ÁêÜÂ∑•ÂÖ∑
[Django Admin](https://docs.djangoproject.com/en/2.2/ref/django-admin/)

ÂÆâË£Ö Django ‰πãÂêéÂ∞±ÊúâÂèØ‰ª•‰ΩøÁî®ÁÆ°ÁêÜÂ∑•ÂÖ∑ django-admin.pyÔºåÂÆÉÊèê‰æõÈ°πÁõÆÁÆ°ÁêÜÁ≠âÂäüËÉΩÔºåÂú® Windows Á≥ªÁªü‰∏ä‰ΩøÁî®ÁöÑÊòØ django-admin.exe„ÄÇÂ¶ÇÂª∫Á´ãÈ°πÁõÆÈ™®Êû∂ startprojectÔºåËøêË°å Web ÊúçÂä°Âô® runserver„ÄÇÂÖ∂ÂëΩ‰ª§ÂàÜÊàêÂ§ö‰∏™Á±ªÂà´Ôºö

[auth]

    changepassword
    createsuperuser

[contenttypes]

    remove_stale_contenttypes

[django]

    check
    compilemessages
    createcachetable
    dbshell
    diffsettings
    dumpdata
    flush
    inspectdb
    loaddata
    makemessages
    makemigrations
    migrate
    sendtestemail
    shell
    showmigrations
    sqlflush
    sqlmigrate
    sqlsequencereset
    squashmigrations
    startapp
    startproject
    test
    testserver

[sessions]

    clearsessions

[staticfiles]

    collectstatic
    findstatic
    runserver



Âª∫Á´ãÊñ∞È°πÁõÆÔºö

    $ django-admin startproject demo

Êñ∞Âª∫È°πÁõÆÂêé‰ºöÊèê‰æõ‰∏Ä‰∏™ `manage.py` Â∑•ÂÖ∑ËÑöÊú¨ÔºåÂèØ‰ª•ÈÄöËøáÂÆÉÊù•ËøêË°å WEB ÊúçÂä°Âô®Ôºå‰ª•‰∏ãÊòØÁ≠â‰ª∑ÂëΩ‰ª§Áî®Ê≥ïÔºö

    $ django-admin <command> [options]
    $ manage.py <command> [options]
    $ python -m django <command> [options]

`manage.py` ‰πüÊòØÈÄöËøáËøêË°å django-admin Êèê‰æõÊúçÂä°ÁöÑÔºåÂè™ÊòØÂÆÉ‰ºöËá™Âä®È¢ÑËÆæËøêË°åÁéØÂ¢ÉÔºåÂÆÉ‰ºöÂ∞ÜÈ°πÁõÆÁ®ãÂ∫èÂåÖÊ∑ªÂä†Âà∞ path ÁéØÂ¢ÉÂèòÈáè‰∏äÔºåËøòÂ∞Ü DJANGO_SETTINGS_MODULE ÁéØÂ¢ÉÂèòÈáèÊåáÂêëÈ°πÁõÆÁ®ãÂ∫èÂåÖÁöÑ `settings.py`Ôºö

‚úì It puts your project‚Äôs package on `sys.path`.
‚úì It sets the `DJANGO_SETTINGS_MODULE` environment variable so that it points to your project‚Äôs `settings.py` file.
‚úì It calls `django.setup()` to initialize various internals of Django.

Â¶ÇÊûúË¶ÅÈÄöËøá django-admin Êù•ËøêË°å Web ÊúçÂä°Âô®ÔºåÂàôÈúÄË¶ÅËá™Â∑±ÈÖçÁΩÆÔºåDJANGO_SETTINGS_MODULE Âíå PYTHONPATH„ÄÇ‰πüÂèØ‰ª•‰ΩøÁî® `--settings`„ÄÅ `--pythonpath` ÂëΩ‰ª§Ë°åÂèÇÊï∞Êù•Êõø‰ª£Ôºö

    set DJANGO_SETTINGS_MODULE=demo.settings
    set PYTHONPATH=c:\coding\python\demo

    django-admin runserver --settings demo.settings --pythonpath c:\coding\python\demo


Django ÈªòËÆ§Êèê‰æõ‰∫Ü Admin ÁÆ°ÁêÜÂ∑•ÂÖ∑Ôºådjango.contrib ÊòØ‰∏ÄÂ•óÂ∫ûÂ§ßÁöÑÂäüËÉΩÈõÜÔºåÂÆÉÊòØ Django Âü∫Êú¨ÁªÑÊàêÈÉ®ÂàÜ„ÄÇÂú®È¶ñÊ¨°ËøêË°åÂêéÔºå‰ºö‰∫ßÁîüÊï∞ÊçÆÂ∫ìËøÅÁßªËÑöÊú¨ÔºåÈÄöËøáÊâßË°å migrate Â∞±ÂèØ‰ª•ÁîüÊàê SQLite Êï∞ÊçÆË°®„ÄÇÁÑ∂ÂêéÂèØ‰ª•‰ΩøÁî® createsuperuser Êù•ÂàõÂª∫ÁôªÂΩïË¥¶Êà∑ÔºåÊåâÊèêÁ§∫ËæìÂÖ•Ë¥¶Êà∑‰ø°ÊÅØÔºö

    # python manage.py migrate
    # python manage.py createsuperuser

ÈÖçÁΩÆÊñá‰ª∂ `settings.py` ‰∏≠Áõ∏ÂÖ≥ÁöÑÈÖçÁΩÆÂ¶Ç‰∏ãÔºå`INSTALLED_APPS` ÈÖçÁΩÆÁöÑÊòØÂÆåÊï¥Áã¨Á´ãÁöÑÁ®ãÂ∫èÁõÆÂΩïÁªìÊûÑÔºåÂèØ‰ª•‰ΩøÁî® startapp Êù•ÂàõÂª∫Ôºå‰∏Ä‰∏™Á®ãÂ∫èÁõÆÂΩïÁªìÊûÑÂåÖÂê´‰∫Ü model„ÄÅview Á≠â MVC ÊûÑÊàêÔºö

    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
    ]

    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.sqlite3',
            'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
        }
    }

Á®ãÂ∫èÁªìÊûÑ‰∏≠ËøòÊúâ‰∏Ä‰∏™ `admin.py` ÂèØ‰ª•Áî®Êù•ÂæÄÁÆ°ÁêÜ‰∏≠ÂøÉÊ≥®ÂÜåÂ∫îÁî®ÔºåÂ¶ÇÂàõÂª∫‰∏Ä‰∏™ TestModel Âπ∂Ê≥®ÂÜåÂà∞ÁÆ°ÁêÜ‰∏≠ÂøÉÔºö

    # django-admin startapp TestModel

    from django.contrib import admin
    from TestModel.models import Test
     
    # Register your models here.
    admin.site.register(Test)

Âú®‰ΩøÁî® admin ÁÆ°ÁêÜÂêéÂè∞Êó∂ËØ∑Ê≥®ÊÑè‰∏ãÈù¢ÁöÑÈúÄÊ±ÇÂíåË¶ÅÁÇπÔºö

‚úì Â∞Ü `django.contrib.admin` Âä†ÂÖ• INSTALLED_APPS„ÄÇ

‚úì ‰æùËµñ INSTALLED_APPS ÈÖçÁΩÆÁöÑ `auth`„ÄÅ`contenttypes`„ÄÅ`sessions`„ÄÅ`messages` Âõõ‰∏™Ê®°ÂùóÔºåÈô§ staticfiles Â§ñ„ÄÇ

‚úì TEMPLATES ‰∏≠ÁöÑ `context_processors` ÈÄâÈ°πÂÜÖÊ∑ªÂä† `django.contrib.auth.context_processors.auth`Âíå`django.contrib.messages.context_processors.messages`Ëøô‰∏§Êù°„ÄÇ

‚úì MIDDLEWARE ‰∏≠Èó¥‰ª∂ `django.contrib.auth.middleware.AuthenticationMiddleware`Âíå`django.contrib.messages.middleware.MessageMiddleware`„ÄÇ

‚úì ÂÜ≥ÂÆöÂì™‰∫õÊ®°ÂûãÈúÄË¶ÅÂú®adminÂÜÖËøõË°åÁÆ°ÁêÜÔºåÂú® `admin.py` Êñá‰ª∂‰∏≠Ê≥®ÂÜåÂÆÉ‰ª¨„ÄÇ

‚úì ÂØπ‰∫éÊØè‰∏™Ê®°ÂûãÔºåÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™ÂØπÂ∫îÁöÑ ModelAdmin Ë£ÖÈ•∞Á±ªÔºåËøô‰∏™Á±ªÂ∞ÜÂ∞ÅË£ÖÂØπÊ®°ÂûãÁöÑÊâÄÊúâËá™ÂÆö‰πâËÆæÁΩÆ„ÄÇ

‚úì ÂÆû‰æãÂåñ‰∏Ä‰∏™ AdminSiteÔºåÂ∞ÜÊ®°Âûã„ÄÅÊ®°ÂûãÂØπÂ∫îÁöÑ ModelAdmin Á±ª‰º†ÁªôÂÆÉ„ÄÇ

‚úì ÈìæÊé•AdminSiteÂíå‰Ω†ÁöÑURLconf„ÄÇËøô‰∏ÄÊ≠•ÈÄöÂ∏∏ÈªòËÆ§Â∑≤ÁªèÂÆåÊàê„ÄÇ

ÂÅöÂÆå‰∏äÈù¢ÁöÑÊ≠•È™§Ôºå‰Ω†Â∞±ÂèØ‰ª•Âú®ÊµèËßàÂô®‰∏≠ËÆøÈóÆ admin Á´ôÁÇπ‰∫ÜÔºåÈªòËÆ§Âú∞ÂùÄÊòØ /admin/„ÄÇ‰ΩÜÊòØÔºåÊÉ≥Ë¶ÅÁôªÂΩïËøõÂéªÔºå‰Ω†È¶ñÂÖàÂøÖÈ°ª‰ΩøÁî®ÂëΩ‰ª§ÂàõÂª∫ÁÆ°ÁêÜÂëòË¥¶Êà∑„ÄÇ


ÈªòËÆ§ÈÖçÁΩÆÊñá‰ª∂ÊâìÂºÄ‰∫ÜË∞ÉËØïÊ®°ÂºèÔºåÊâìÂºÄÊµèËßàÂô®Â∞±ÂèØ‰ª•ÁúãÂà∞ÈªòËÆ§ÁöÑË∞ÉËØï‰ø°ÊÅØÈ°µÈù¢„ÄÇÂ¶ÇÊûúÂÖ≥Èó≠Ë∞ÉËØïÔºåÂàôÈúÄË¶ÅËÆæÁΩÆ ALLOWED_HOSTSÔºåÂèØ‰ª•‰ΩøÁî® `*` ÈÄöÈÖçÁ¨¶,‰ΩÜÂÖÅËÆ∏ÊâÄÊúâÊú∫Âô®ËÆøÈóÆÂ®ÅËÉÅÊõ¥Â§öÔºö

    DEBUG = False
    ALLOWED_HOSTS = ['localhost', '127.0.0.1', '[::1]']

Ë∑ØÁî±ÈÖçÁΩÆ `urls.py` ‰πüÂè™ÊòØÈÖçÁΩÆ‰∫Ü Admin ÁÆ°ÁêÜÂ∑•ÂÖ∑Ôºö

    from django.contrib import admin
    from django.urls import path

    urlpatterns = [
        path('admin/', admin.site.urls),
    ]





## ==‚ö° Demo Project
[Django Tutorials](https://docs.djangoproject.com/en/2.2/intro/)

ÂÆâË£ÖÂ•Ω Python Âíå Django ÂêéÔºåÂπ∂ËÆæÁΩÆÂ•ΩÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáèÔºåÂ∞±ÂèØ‰ª•ÂºÄÂßã‰ΩøÁî® django-admin.py ËÑöÊú¨Êù•ÂàõÂª∫È°πÁõÆÈ™®Êû∂‰∫Ü„ÄÇÈÄâ‰∏Ä‰∏™ÁõÆÂΩï‰Ωú‰∏∫Â∑•Á®ãÁÆ°ÁêÜÁõÆÂΩïÔºåËøõÂÖ•ÁõÆÂΩïËøêË°åÂëΩ‰ª§ÂàõÂª∫ Django È°πÁõÆÔºö

    $ django-admin startproject demo

È°πÁõÆÁõÆÂΩïÂü∫Êú¨ÁªìÊûÑÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö

    +-- demo
        +-- manage.py
        +-- demo
            +-- settings.py
            +-- urls.py
            +-- wsgi.py
            +-- __init__.py

`manage.py` Â∞±ÊòØ‰∏Ä‰∏™ÂÆûÁî®ÁöÑÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑ÔºåÂèØËÆ©‰Ω†‰ª•ÂêÑÁßçÊñπÂºè‰∏éËØ• Django È°πÁõÆËøõË°å‰∫§‰∫íÔºåÂèØ‰ª•Áî®ÂÆÉÊù•ÂêØÂä® WEB ÊúçÂä°Âô®„ÄÇ
`settings.py` ÊòØËØ•È°πÁõÆÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇ
`urls.py` ÊòØËØ•È°πÁõÆÁöÑ URL Â£∞ÊòéÔºå‰∏Ä‰ªΩÁî± Django È©±Âä®ÁöÑÁΩëÁ´ôÁõÆÂΩï„ÄÇ
`wsgi.py` ÊòØ‰∏Ä‰∏™ WSGI ÂÖºÂÆπÁöÑ Web ÊúçÂä°Âô®ÁöÑÂÖ•Âè£Ôºå‰ª•‰æøËøêË°å‰Ω†ÁöÑÈ°πÁõÆ„ÄÇ

Python ËÑöÊú¨È¶ñÊ¨°ËøêË°åÂêéÔºåËß£ÈáäÂô®‰ºöÂ∞Ü `*.py` ËÑöÊú¨ÁºñËØëÊàê `*.pyc` Â≠óËäÇÁ†ÅÊñá‰ª∂‰øùÂ≠òÂà∞ `__pycache__` ‰∏¥Êó∂Êñá‰ª∂ÁõÆÂΩïÔºå‰∏ãÊ¨°ÊâßË°åËÑöÊú¨Êó∂Â∞±ÂèØ‰ª•Ë∑≥ËøáÁºñËØë‰∏ÄÊ≠•Áõ¥Êé•ËøêË°å„ÄÇÂèØ‰ª•Âú®ËøêË°åËÑöÊú¨Êó∂Ê∑ªÂä† `-B` ÂèÇÊï∞ÂÖ≥Èó≠Ôºå‰πüÂèØ‰ª•ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèÊ∞∏‰πÖÂÖ≥Èó≠ `PYTHONDONTWRITEBYTECODE=1` Âç≥ÂèØ„ÄÇ

Á®ãÂ∫èËøêË°åÂêéÔºåËøòÊúâÁîüÊàê‰∏Ä‰∏™ SQLite Êï∞ÊçÆÂ∫ìÊñá‰ª∂ `db.sqlite3`ÔºåÂõ†‰∏∫È°πÁõÆÈ™®Êû∂ÈªòËÆ§‰ΩøÁî®‰∫Ü SQLite„ÄÇ

ÂêØÂä® WEB ÊúçÂä°Âô®ÔºåÂÆÉÊîØÊåÅÁÉ≠Êõ¥Êñ∞Ôºå‰øÆÊîπÊ∫ê‰ª£Á†ÅÂç≥ÂèØÊõ¥Êñ∞ÔºåÊµèËßàÂô®ËÆøÈóÆÊéßÂà∂Âè∞ÊèêÁ§∫ÁöÑÂú∞ÂùÄ http://127.0.0.1:8000/Ôºö

    cd demo # ÂàáÊç¢Âà∞Êàë‰ª¨ÂàõÂª∫ÁöÑÈ°πÁõÆ
    $ python manage.py runserver
    ‚Ä¶‚Ä¶
    Starting development server at http://127.0.0.1:8000/
    Quit the server with CONTROL-C.

## ==‚ö° MVC & Router

Âú®È°πÁõÆÁ®ãÂ∫èÂåÖÁõÆÂΩï‰∏ãÔºåÊ≥®ÊÑèÈ°πÁõÆÁõÆÂΩïÂíåÁ®ãÂ∫èÂåÖÁõÆÂΩïÂêåÂêçÔºåÂª∫Á´ã‰∏Ä‰∏™ËßÜÂõæÊñá‰ª∂ `/demo/demo/view.py`Ôºö

    from django.http import HttpResponse
    
    def hello(request):
        return HttpResponse("Hello world ! ")

Êé•ÁùÄÊâìÂºÄ `urls.py` Êñá‰ª∂ÔºåÂØºÂÖ•ËßÜÂõæÊñá‰ª∂ÔºåÁªëÂÆöË∑ØÁî± URL ‰∏éËßÜÂõæÂáΩÊï∞ÔºåÁõ∏Â∫î‰øÆÊîπ‰∏∫Ôºö

    from django.contrib import admin
    from django.urls import path, re_path
    from . import view

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('hello/', view.hello),
        path('', view.hello),
        # re_path(r'^$', view.hello),
    ]


Django Ë∑ØÁî±ÈÖçÁΩÆÊñπÊ≥ï `path()` ÂèØ‰ª•Êé•Êî∂Âõõ‰∏™ÂèÇÊï∞ÔºåÂâç‰∏§‰∏™ÂøÖÈÄâÂèÇÊï∞Ôºö

    path(route, view, kwargs=None, name=None)

`route`  Â≠óÁ¨¶‰∏≤ÔºåË°®Á§∫ URL ËßÑÂàôÔºå‰∏é‰πãÂåπÈÖçÁöÑ URL ‰ºöÊâßË°åÂØπÂ∫îÁöÑÁ¨¨‰∫å‰∏™ÂèÇÊï∞ view„ÄÇ
`view`  Áî®‰∫éÊâßË°å‰∏éÊ≠£ÂàôË°®ËææÂºèÂåπÈÖçÁöÑ URL ËØ∑Ê±Ç„ÄÇ
`kwargs`  ËßÜÂõæ‰ΩøÁî®ÁöÑÂ≠óÂÖ∏Á±ªÂûãÁöÑÂèÇÊï∞„ÄÇ
`name`  Áî®Êù•ÂèçÂêëËé∑Âèñ URL„ÄÇ

Django 2.0 ‰∏≠ÂèØ‰ª•‰ΩøÁî® `re_path()` ÊñπÊ≥ïÊù•ÂÖºÂÆπ 1.x ÁâàÊú¨‰∏≠ÁöÑ `url()` ÊñπÊ≥ïÔºå‰∏Ä‰∫õÊ≠£ÂàôË°®ËææÂºèÁöÑËßÑÂàô‰πüÂèØ‰ª•ÈÄöËøá `re_path()` Êù•ÂÆûÁé∞ „ÄÇ

    from django.urls import include, re_path

    urlpatterns = [
        re_path(r'^index/$', views.index, name='index'),
        re_path(r'^bio/(?P<username>\w+)/$', views.bio, name='bio'),
        re_path(r'^weblog/', include('blog.urls')),
        ...
    ]


## ==‚ö° Template

‰ΩøÁî®Ê®°ÊùøÊù•ËæìÂá∫Êï∞ÊçÆÔºå‰ªéËÄåÂÆûÁé∞Êï∞ÊçÆ‰∏éËßÜÂõæÂàÜÁ¶ª„ÄÇÂú®È°πÁõÆÁõÆÂΩï‰∏ãÂª∫Á´ã‰∏Ä‰∏™Ê®°ÊùøÊñá‰ª∂Â§πÔºåÂπ∂Êñ∞Âª∫‰∏Ä‰∏™Ê®°ÊùøÊñá‰ª∂ `demo/templates/hello.html` Ê®°Êùø‰∏≠‰ΩøÁî®ÂèåÊã¨Âè∑ËæìÂá∫ÂèòÈáèÔºåÊòØÂü∫Êú¨Ê®°ÊùøÊ†ºÂºèÔºö

    <h1>{{ hello }}</h1>

Êé•‰∏ãÊù•‰øÆÊîπ settings.py ÁöÑ TEMPLATES ÈÖçÁΩÆÔºåÂêë Django ËØ¥ÊòéÊ®°ÊùøÊñá‰ª∂ÁöÑË∑ØÂæÑÔºåËÆæÁΩÆ DIRS ‰∏∫ [BASE_DIR+"/templates",]:

    TEMPLATES = [
        {
            'BACKEND': 'django.template.backends.django.DjangoTemplates',
            'DIRS': [BASE_DIR+"/templates",],       # ‰øÆÊîπ‰ΩçÁΩÆ
            'APP_DIRS': True,
            'OPTIONS': {
                'context_processors': [
                    'django.template.context_processors.debug',
                    'django.template.context_processors.request',
                    'django.contrib.auth.context_processors.auth',
                    'django.contrib.messages.context_processors.messages',
                ],
            },
        },
    ]

Ê®°ÊùøÊ∏≤Êüì‰∏ÄËà¨‰∏ç‰ºöÁõ¥Êé•‰ΩøÁî® `get_template()` ÂéªËé∑ÂèñÊ®°ÊùøÂÜÖÂÆπÔºåËÄåÊòØ‰ΩøÁî® Django ÁöÑ `render()` ÊñπÊ≥ïÂ§ÑÁêÜÔºå `render_to_response()` ÊñπÊ≥ï‰πüÂèØ‰ª•Ê∏≤ÊüìÊ®°ÊùøÔºåÂÆÉ‰ª¨ÈÉΩËøîÂõû‰∏Ä‰∏™ HttpResponse„ÄÇÂ¶ÇÊûúË¶ÅÂú®Ê®°Êùø‰∏≠‰ΩøÁî® `request` ÂØπË±°ÔºåËØ∑Âä°ÂøÖ‰ΩøÁî® `render()`„ÄÇ‰øÆÊîπ view.py Â∑≤ÂÆö‰πâÁöÑ hello ÊñπÊ≥ïÔºåÂØºÂÖ• django.shortcuts.render Áî®‰∫éÂêëÊ®°ÊùøÊ∏≤ÊüìÊï∞ÊçÆÔºö

    from django.shortcuts import render, render_to_response
    
    def hello(request):
        context          = {}
        context['hello'] = 'Hello World...'
        return render(request, 'hello.html', context)
        # return render_to_response('hello.html', context)

ËøôÈáå‰ΩøÁî® `render()` Êù•Êõø‰ª£‰πãÂâç‰ΩøÁî®ÁöÑ `HttpResponse()`ÔºåÂπ∂‰º†ÂÖ•‰∏Ä‰∏™Â≠óÂÖ∏ context ‰Ωú‰∏∫Ê®°ÊùøÁöÑÊï∞ÊçÆÊ∫ê„ÄÇ

context Â≠óÂÖ∏‰∏≠ÂÖÉÁ¥†ÁöÑÈîÆÂÄº `hello` ÂØπÂ∫î‰∫ÜÊ®°Êùø‰∏≠ÁöÑÂèòÈáè `{{ hello }}`„ÄÇ ÂÜçËÆøÈóÆËÆøÈóÆ http://127.0.0.1:8000/hello ÂèØ‰ª•ÁúãÂà∞È°µÈù¢ÂÜÖÂÆπÊòØÁî±Ê®°ÊùøÊñá‰ª∂ÁîüÊàêÁöÑ‰∫Ü„ÄÇ

‰ΩøÁî® `get_template()` Êù•Â§ÑÁêÜÂ∞±Ê≤°ÈÇ£‰πàÁÆÄÊ¥Å‰∫ÜÔºö

    from django.template.loader import get_template
    from django.template import Context
    from django.http import HttpResponse
    import datetime

    def current_datetime_template(request):
        now = datetime.datetime.now()
        tpl = get_template('current_datetime.html')
        html = tpl.render(Context({'current_date': now}))
        return HttpResponse(html)


Â∏∏Áî®ÁöÑ Django Ê®°ÊùøÊ†áÁ≠æÔºö

    {% if condition1 %}
       ... display 1
    {% elif condition2 %}
       ... display 2
    {% else %}
       ... display 3
    {% endif %}

    {% for athlete in athlete_list %}
        <li>{{ athlete.name }}</li>
    {% empty %}
        <h1>empty of list</h1>
    {% endfor %}

    {% for athlete in athlete_list reversed %}
    ... reversed ‰ΩøÂæóËØ•ÂàóË°®Ë¢´ÂèçÂêëËø≠‰ª£
    {% endfor %}

    {# ËøôÊòØ‰∏Ä‰∏™Ê≥®Èáä #}

    {% ifequal section 'sitenews' %}
        <h1>Site News</h1>
    {% else %}
        <h1>No News Here</h1>
    {% endifequal %}

    {{ name|lower }}
    {{ my_list|first|upper }}
    {{ bio|truncatewords:"30" }}
    {{ pub_date|date:"F j, Y" }}

Âíå Flask Ê®°ÊùøËØ≠Ê≥ïÂØπÊØî‰∏Ä‰∏ãÔºö

    <!--Django-->
    <div class="categories">Categories:{{ post.categories|join:"," }}</div>
    <!--Jinja2-->
    <div class="categories">Categories:{{  post.categories|join(", ")  }}</div>

Âú®JinjaÁöÑÊ®°ÊùøËØ≠Ë®ÄÈáåÔºåÂèØ‰ª•Êää‰ªª‰ΩïÊï∞ÈáèÁöÑÂèÇÊï∞‰º†ÁªôËøáÊª§Âô®ÔºåÂõ†‰∏∫JinjaÂÉèË∞ÉÁî®‰∏Ä‰∏™PythonÂáΩÊï∞ÁöÑÊñπÂºèÊù•ÁúãÂæÖÂÆÉÔºåÁî®ÂúÜÊã¨Âè∑Êù•Â∞ÅË£ÖÂèÇÊï∞„ÄÇDjango‰ΩøÁî®ÂÜíÂè∑Êù•ÂàÜÈöîËøáÊª§Âô®ÂêçÂíåÂèÇÊï∞ÔºåËøôÊ†∑Â∞±Âè™ËÉΩ‰º†ÈÄí‰∏Ä‰∏™ÂèÇÊï∞‰∫Ü„ÄÇ


Ê®°ÊùøÂèØ‰ª•Áî®ÁªßÊâøÁöÑÊñπÂºèÊàñÁõ¥Êé•ÂåÖÂê´ÂºïÁî® include Êù•ÂÆûÁé∞Â§çÁî®„ÄÇ

    <!DOCTYPE html>
    <html>
    <head>
    <meta charset="utf-8">
    <title>Demo</title>
    </head>
    <body>
        <h1>Hello World!</h1>
        {% include "nav.html" %}
        {% block mainbody %}
           <p>original</p>
        {% endblock %}
    </body>
    </html>

‰ª•‰∏ä‰ª£Á†Å‰∏≠ `block mainbody` Ê†áÁ≠æÊòØÂèØ‰ª•Ë¢´ÁªßÊâøËÄÖÊõøÊç¢ÊéâÁöÑÈÉ®ÂàÜ„ÄÇÊâÄÊúâÁöÑ {% block %} Ê†áÁ≠æÂëäËØâÊ®°ÊùøÂºïÊìéÔºåÂ≠êÊ®°ÊùøÂèØ‰ª•ÈáçËΩΩËøô‰∫õÈÉ®ÂàÜ„ÄÇ

Â¶ÇÂú® hello.html ‰∏≠ÁªßÊâø base.htmlÔºåÂπ∂ÊõøÊç¢ÁâπÂÆö blockÔºö

    {%extends "base.html" %}
     
    {% block mainbody %}
    <p>replace base block</p>
    {% endblock %}


## ==‚ö° Form
[HttpRequest, HttpResponse, QueryDict](https://docs.djangoproject.com/en/2.2/ref/request-response/)
[Working with Forms](https://docs.djangoproject.com/en/2.2/topics/forms/)
[Pillow ÂõæÂΩ¢Â∫ì](https://pillow-cn.readthedocs.io/zh_CN/latest/)

HttpRequest ÂØπË±°‰∏≠ GET Âíå POST ÈÉΩÊòØ QueryDict ÂÆû‰æãÔºåËé∑ÂèñË°®ÂçïÊèê‰∫§ÁöÑÊï∞ÊçÆÁªèÂ∏∏Áî® `QueryDict.get(key,default)` ÔºåËøîÂõû key ÂØπÂ∫îÁöÑÂÄºÔºåËã•ÂØπÂ∫îÂ§ö‰∏™ÂÄºÔºåÂàôËøîÂõûÊúÄÂêéÁöÑÂÄºÔºåËã•key‰∏çÂ≠òÂú®ÔºåÂàôËøîÂõûÈªòËÆ§ÂÄº„ÄÇÂú®ÊóßÁâà Python ‰∏≠ `request["foo"]` Á≠âÂêå‰∫éÂÖàËé∑Âèñ `request.POST["foo"]` ÁÑ∂ÂêéÂÜçËØï `request.GET["foo"]` Ëé∑ÂèñÔºåÊñ∞ÁâàÂ∞±‰∏çËÉΩ‰ΩøÁî® `request['q']` ËøôÁßçÊñπÂºè„ÄÇQueryDict ÁöÑÂü∫Êú¨‰ΩøÁî®Ôºö

    q = QueryDict('a=1')
    q = q.copy() # to make it mutable
    q.update({'a': '2'})
    q.getlist('a') # ['1', '2']
    q['a'] # returns the latest ['2']

‰ΩøÁî® POST ËØ∑Ê±ÇÊù•Êèê‰∫§Êï∞ÊçÆÔºåÂèØ‰ª•‰ΩøÁî® `csrf` Êù•Èò≤Ê≠¢‰º™Ë£ÖÊèê‰∫§Â¢ûÂä†ÂÆâÂÖ®ÊÄßÔºåÂÖ®Áß∞ÊòØË∑®Á´ô‰º™ÈÄ†ËØ∑Ê±Ç Cross Site Request Forgery„ÄÇÂèØ‰ª•Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠Á¶ÅÁî® CSRF ‰∏≠Èó¥‰ª∂ÔºåCsrfViewMiddlewareÔºå‰πüÂèØ‰ª•Âú®ÂØπÂ∫îËßÜÂõæÂáΩÊï∞‰∏äÂä†‰∏ä‰∏Ä‰∏™Ë£ÖÈ•∞Âô® `@csrf_exempt` ËøòÂèØ‰ª•Âú® urls.py ‰∏≠Áî® `csrf_exempt()` ÂáΩÊï∞ÂåÖË£ÖËßÜÂõæÂáΩÊï∞„ÄÇ ÈªòËÆ§ËÆæÁΩÆÊó∂ÂêØÁî® CSRF È™åËØÅÁöÑÔºåÂú®Ê®°ÊùøÊñá‰ª∂ÁöÑË°®ÂçïÂÜÖÈúÄË¶ÅËÆæÁΩÆ `{% csrf_token %}` Ê†áÁ≠æ„ÄÇ

ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊó∂ `APPEND_SLASH` Ëøô‰∏™ÈÖçÁΩÆÈ°πÔºåÂÆÉÈªòËÆ§‰∏∫ TrueÔºåÂç≥‰ºöÂ∞ÜÊ≤°Êúâ `/` ÁªìÂ∞æÁöÑ URL ËØ∑Ê±ÇÈÄöËøá‰∏Ä‰∏™ 301 ‰∏¥Êó∂Ë∑≥ËΩ¨Âà∞ÊñúÊù†ÁªìÊùüÁöÑ URL Âú∞ÂùÄ‰∏ä„ÄÇÂä†ÂÅáÂ¶Ç urls.py ‰∏≠Êúâ‰ª•‰∏ãËøôÊù°Ë∑ØÁî±ÔºåÈÇ£‰πà http://loacalhost/hello Â∞±‰ºöË∑≥ËΩ¨Âà∞ http://localhost/hello/„ÄÇÂ¶ÇÊûú `APPEND_SLASH=False` ÈÇ£‰∏çÂ∏¶ `/` ÁªìÊùüÁöÑ URL Â∞±‰∏çËÉΩÂåπÈÖçÂà∞Ëøô‰∏™Ë∑ØÁî±ÔºåÂ∞±‰ºö‰∫ßÁîü‰∏Ä‰∏™ 404 ÈîôËØØÔºö

    path('hello/', view.hello),

Â¶ÇÊûúË°®ÂçïÊèê‰∫§Âà∞ http://loacalhost/hello Ëøô‰∏™Âú∞ÂùÄÔºåÈªòËÆ§ÁöÑ `APPEND_SLASH` ÈÖçÁΩÆÂØπË°®ÂçïÁöÑ GET Êèê‰∫§ÊñπÂºèÊ≤°ÊúâÂΩ±ÂìçÔºåË∑≥ËΩ¨Êó∂ÂèØ‰ª•Â∞Ü URL Êê∫Â∏¶ÁöÑÂèÇÊï∞‰∏ÄÂπ∂‰º†ÈÄí„ÄÇ‰ΩÜÊòØÔºåË°®ÂçïÁöÑ POST Êèê‰∫§ÊñπÂºèÂ∞±‰ºöÊúâÈóÆÈ¢òÔºåPOST Êï∞ÊçÆ‰∏çËÉΩÂú® 301 ‰∏¥Êó∂Ë∑≥ËΩ¨‰∏≠‰º†ÈÄíÔºåÊâÄ‰ª• POST Ë°®ÂçïË¶ÅÊ≥®ÊÑè action ÁöÑÂú∞ÂùÄËÆæÁΩÆÊòØÂê¶ÂÆåÂÖ®Ê≠£Á°Æ„ÄÇ 

Django ‰∏≠ forms.Form Ë°®ÂçïÁ±ªÊèê‰æõÁöÑËá™Âä®ÁîüÊàêHTMLË°®ÂçïÂÖÉÁ¥†„ÄÅ Ê£ÄÊü•Ë°®ÂçïÊï∞ÊçÆÁöÑÂêàÊ≥ïÊÄß„ÄÅÂ¶ÇÊûúÈ™åËØÅÈîôËØØÔºåÈáçÊñ∞ÊòæÁ§∫Ë°®ÂçïÔºàÊï∞ÊçÆ‰∏ç‰ºöÈáçÁΩÆÔºâ„ÄÅÊï∞ÊçÆÁ±ªÂûãËΩ¨Êç¢ÔºåForm ÂåÖÊã¨‰ª•‰∏ãÁõ∏ÂÖ≥ÁöÑÂØπË±°Ôºö

WidgetÔºöÁî®Êù•Ê∏≤ÊüìÊàêHTMLÂÖÉÁ¥†ÁöÑÂ∑•ÂÖ∑ÔºåÂ¶ÇÔºöforms.TextareaÂØπÂ∫îHTML‰∏≠ÁöÑ`<textarea>`Ê†áÁ≠æ
FieldÔºöFormÂØπË±°‰∏≠ÁöÑ‰∏Ä‰∏™Â≠óÊÆµÔºåÂ¶ÇÔºö`EmailField`Ë°®Á§∫emailÂ≠óÊÆµÔºåÂ¶ÇÊûúËøô‰∏™Â≠óÊÆµ‰∏çÊòØÊúâÊïàÁöÑemailÊ†ºÂºèÔºåÂ∞±‰ºö‰∫ßÁîüÈîôËØØ„ÄÇ
FormÔºö‰∏ÄÁ≥ªÂàóFieldÂØπË±°ÁöÑÈõÜÂêàÔºåË¥üË¥£È™åËØÅÂíåÊòæÁ§∫HTMLÂÖÉÁ¥†
Form MediaÔºöÁî®Êù•Ê∏≤ÊüìË°®ÂçïÁöÑCSSÂíåJavaScriptËµÑÊ∫ê„ÄÇ

Êñá‰ª∂‰∏ä‰º†‰ΩøÁî®Âà∞ request.FILESÔºåËøô‰∏™ QueryDict ÂåÖÂê´‰∏ä‰º†Âà∞ÊúçÂä°Âô®ÂÜÖÂ≠òÁöÑÊñá‰ª∂ÂØπË±° `InMemoryUploadedFile`„ÄÇÁõ∏ÂÖ≥ÁöÑË°®ÂçïÈ°πÊúâ FileField FilePathField ImageFieldÔºåÁªìÂêà `upload_to` Â±ûÊÄßÊù•ËÆæÁΩÆÊñá‰ª∂ÁöÑ‰øùÂ≠òË∑ØÂæÑÔºåPOST Ë°®Âçï‰πüË¶Å‰ΩøÁî® `enctype="multipart/form-data"`„ÄÇÂ¶ÇÊûú‰∏ä‰º†Â§ÑÁêÜÂõæÂÉèÊñá‰ª∂ÔºåÊúçÂä°Âô®Á´Ø‰πüÈúÄË¶ÅÂÆâË£ÖÂõæÂΩ¢Â∫ì PillowÔºåÂê¶Âàô Django ‰ºöÊèêÁ§∫Êâæ‰∏çÂà∞ PIL Â∫ìÔºö

    pip install Pillow

È°πÁõÆÈÖçÁΩÆÊñá‰ª∂‰∏≠ÂèØ‰ª•ËÆæÁΩÆ MEDIA_ROOT Âíå MEDIA_URLÔºåÂèØ‰ª•Áõ¥Êé•Âú®Ê®°ÊùøÈ°µ‰∏≠‰ΩøÁî®Ôºö

    MEDIA_ROOT = os.path.join(BASE_DIR, 'media')#Âç≥È°πÁõÆË∑ØÂæÑ‰∏ãÁöÑmediaÊñá‰ª∂Â§πÔºåÊ≤°ÊúâÂàôËá™Âä®ÂàõÂª∫
    MEDIA_URL = '/media/' #Ëøô‰∏™ÊòØÂú®ÊµèËßàÂô®‰∏äËÆøÈóÆËØ•‰∏ä‰º†Êñá‰ª∂ÁöÑurlÁöÑÂâçÁºÄ

ÈÖçÁΩÆ‰ø°ÊÅØË∞ÉÁî®ÊñπÊ≥ïÔºåÂ¶Ç BASE_DIR Ëé∑ÂèñÔºö

    from django.conf import settings
    print("settings.BASE_DIR="+settings.BASE_DIR)

Django ‰ΩøÁî®‰∫Ü `strftime()` ÂáΩÊï∞Â§ÑÁêÜ `upload_to`ÔºåÂèØ‰ª•‰ΩøÁî®Âç†‰ΩçÁ¨¶Êù•ÈÅøÂÖçÊñá‰ª∂ÂêçÈáçÂêçÔºåÂ¶Ç `%Y`„ÄÅ`%m`„ÄÅ`%d`ÂàÜÂà´Ë°®Á§∫Âπ¥„ÄÅÊúà„ÄÅÊó•Ôºå‰ª•Âèä `%H`„ÄÅ `%M`„ÄÅ `%S`„ÄÇ‰πüÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Êó∂Èó¥Ê†ºÂºèÂáΩÊï∞Êù•ÁîüÊàêÂêçÂ≠óÁÇπÁºÄ `strftime("%Y%m%d%H%M%S")`Ôºö

    # models.py
    class MyModel(models.Model):
        avatar = ImageField(upload_to = 'photos/%Y/%m/%d/')

Django ËøòÊîØÊåÅÈáçÂÜô‰∏Ä‰∏™ upload_to ‰∏∫ÂáΩÊï∞ÔºåÈáçÂÆö‰πâ‰∏ä‰º†Êñá‰ª∂ÁöÑË∑ØÂæÑÂâçÁºÄÔºö

    # models.py
    def upload_to(instance, fielname):
        return '/'.join([MEDIA_ROOT, instance.user_name, filename])

    class MyModel(models.Model):
        avatar = ImageField(upload_to = upload_to)
        user_name = CharField(max_length = 250)

Êñá‰ª∂‰∏ä‰º†ÂêéÔºåÂèØ‰ª•ÈÄöËøá `request.FILES.get('avatar')` Ëé∑ÂèñÔºåÂ¶ÇÊûúÊòØÂ§öÊñá‰ª∂Â∞±‰ΩøÁî® `request.FILES.getlist('avatar')` Ëé∑ÂèñÂàóË°®„ÄÇ ` UploadedFile` Êèê‰æõ‰∫Ü `chunks()` ÊñπÊ≥ïËé∑Âèñ `InMemoryUploadedFile` Êñá‰ª∂Êï∞ÊçÆÈÉ®ÂàÜÔºåÂèØ‰ª•‰ΩøÁî® Python ÁöÑ `open()` ÂáΩÊï∞‰øùÂ≠òÂà∞Êñá‰ª∂„ÄÇÊ≥®ÊÑèÔºåÂ¶ÇÊûú‰ΩøÁî®‰∫ÜÁõÆÂΩïÔºåÈúÄË¶ÅÂÖàÁ°Æ‰øùÁõÆÂΩïÂ≠òÂú®ÔºåÂê¶Âàô `open()` ‰ºö‰øÉÂèëÂºÇÂ∏∏„ÄÇ


Form ÂØπË±°ÂèØ‰ª•Â∞ÅË£Ö‰∏ÄÁ≥ªÂàó Field ÂíåÈ™åËØÅËßÑÂàôÔºåForm Á±ªÈÉΩÂøÖÈ°ªÁõ¥Êé•ÊàñÈó¥Êé•ÁªßÊâøËá™ django.forms.Form:

    from django import forms
    class ContactForm(forms.Form):
        subject = forms.CharField(max_length=100,label='‰∏ªÈ¢ò')
        message = form.CharField(widget=forms.TextArea)
        sender = form.EmailField()
        cc_myself = forms.BooleanField(required=False)

‰πüÂèØ‰ª•ÁªìÂêà ModelÔºåÁªßÊâø django.forms.ModelForm Êù•ÂÆö‰πâ Form ÂØπË±°Ôºö

    #models.py
    class Contact(models.Model):
        title = models.CharField(max_length=30)
        content = models.CharField(max_length=20)
     
    #form.py
    class ConotactForm(ModelForm):
        class Meta:
        model = Contact
        field = ('title','content') #Âè™ÊòæÁ§∫model‰∏≠ÊåáÂÆöÁöÑÂ≠óÊÆµ

Ë°®ÂçïÂÆûÂàóÊèê‰æõÂ≠óÊÆµÊï∞ÊçÆÊúâ‰ª•‰∏ãËøô‰∫õÔºåÂèØ‰ª•Âú®Ê®°Êùø‰∏≠ÊâãÂä®ÁîüÊàêË°®ÂçïÔºö

    {{field}}               <input type="text" name="query" value="ABC" maxlength="100" required id="id_query"> 
    {{field.label_tag}}     <label for="id_query">Your query:</label>
    {{field.value}}         ABC 

    {{field.label}}         Your query
    {{field.help_text}}     
    {{field.help_name}}     
    {{field.is_hidden}}     False
    {{field.id_for_label}}  id_query

    {{field.field}}         django.forms.fields.CharField object
    {{field.errors}}        <ul class="errorlist"><li>This field is required.</li></ul>

`{{field.value}}` ÊòØÊé•ÂèóÂà∞ÁöÑË°®ÂçïÊï∞ÊçÆÔºå`{{field.errors}}` Âè™Âú®ÊûÑÈÄ†Ë°®ÂçïÊó∂Ê£ÄÊü•Âà∞Ê≤°ÊúâÊèê‰∫§Á¨¶ÂêàÊù°‰ª∂ÁöÑÊï∞ÊçÆÊâç‰ºöÊúâÂÜÖÂÆπ„ÄÇ

Èô§‰∫Ü‰∏äÈù¢ËøôÁßçÊâãÂä®ÁîüÊàêË°®ÂçïÔºåËøòÂèØÂÉè‰∏ãÈù¢ËøôÊ†∑Ëá™Âä®ÁîüÊàêË°®Âçï„ÄÇËøòÂèØ‰ΩøÁî® `form.p`„ÄÅ`form.as_ul`ÔºåÂàÜÂà´Ë°®Á§∫Áî®`<p>`Ê†áÁ≠æÔºåÂíå`<ul>`ÂåÖË£πË°®ÂçïÁöÑÊåáÊÆµÔºåÈªòËÆ§ÊòØ `<tr>` Ê†áÁ≠æÔºåÂç≥ `form.as_table` ÊñπÂºè„ÄÇ

    {{ form }}
    {{ form.as_p }}
    {{ form.as_ul }}
    {{ form.as_table }}


Áé∞Âú®‰øÆÊîπËßÜÂõæÊñá‰ª∂ view.py ‰∏≠ÁöÑ `hello()` ËßÜÂõæÊñπÊ≥ïÊù•Â±ïÁ§∫ GET/POST Ë°®ÂçïÁöÑÂ§ÑÁêÜÔºåÈÄöËøá request.method Âà§Êñ≠Êèê‰∫§ÊñπÂºè„ÄÇ‰∏∫‰∫ÜÁÆÄÂåñÔºåË°®ÂçïÁ±ª DemoForm Áõ¥Êé•ÂÜôÂú®ËßÜÂõæÊñá‰ª∂Ôºö

    # -*- coding: utf-8 -*-
    
    from django import forms
    from django.http import HttpResponse, HttpResponseRedirect
    from django.shortcuts import render, render_to_response
    from django.views.decorators import csrf
    from os import mkdir
    from os.path import isdir
    from pprint import pprint


    class DemoForm(forms.Form):
        query = forms.CharField(label='Your query', max_length=100, required=False)
        avatar = forms.ImageField() # for model.ImageFiel default="/upload/micro.jpg"
        # path = forms.FilePathField(path='avatars/')

    def handle_uploaded_file(f):
        if not isdir("upload"):
            mkdir("upload")

        with open('upload\\%s' % f.name, 'wb+') as destination:
            for chunk in f.chunks():
                destination.write(chunk)

    def hello(request):
        if request.method == 'POST':
            form = DemoForm(request.POST, request.FILES)
            file = request.FILES.get('avatar')
            pprint([form, file, request.POST, request.FILES['avatar']])
            handle_uploaded_file(request.FILES['avatar'])
            # if form.is_valid():
                # pass
                # return HttpResponseRedirect('/thanks/')
        else:
            form = DemoForm(request.GET)
        
        args = request.POST if request.method=="POST" else request.GET
        context          = {"form": form}
        context['hello'] = 'Hello HTTP %s!' % request.method
        context['result'] = args.get('q', 'EMPTY')
        return render(request, 'hello.html', context)
        # return render_to_response('hello.html', context)

Â¶ÇÊûú‰∏çËÉΩÂ§ÑÁêÜ‰∏≠ÊñáÔºåËØ∑‰ΩøÁî® utf8 ÁºñÁ†ÅÔºö

    import sys  

    reload(sys)
    sys.setdefaultencoding('utf8')

Ê®°ÊùøÊñá‰ª∂Â¶Ç‰∏ãÔºåËÆæÁΩÆ‰∫Ü‰∏§‰∏™Ë°®ÂçïÔºåÂêØÁî® CSRF È™åËØÅÁöÑÊÉÖÂÜµ‰∏ãÔºåÊ®°ÊùøÊñá‰ª∂‰∏≠Ë°®ÂçïÂÜÖË¶ÅËÆæÁΩÆ`{% csrf_token %}`Ê†áÁ≠æ„ÄÇ

    <!DOCTYPE html>
    <html>
    <head>
    <meta charset="utf-8">
    <title>post & csrf</title>
    </head>
    <body>

        <form action="/hello" method="get">

            {% for field in form %}
            <div>
                <br>field: {{field}} 
                <br>field.label_tag: {{field.label_tag}}
                <br>field.value: {{field.value}} 

                <br>field.label: {{field.label}}
                <br>field.help_text: {{field.help_text}}
                <br>field.help_name: {{field.help_name}}
                <br>field.is_hidden: {{field.is_hidden}}
                <br>field.id_for_label: {{field.id_for_label}}
                <br>field.field: {{field.field}}

                <br>field.errors: {{field.errors}}
            </div>
            {% endfor %}

            <input type="text" name="q">
            <input type="submit" value="HTTP GET">
        </form>

        <form action="/hello" method="post">
            {% csrf_token %}
            <input type="text" name="q">
            <input type="submit" value="HTTP POST">
        </form>
     
        <p>{{ result }}</p>
        <p>{{ hello }}</p>

    </body>
    </html>


## ==‚ö° session

DjangoÂÆåÂÖ®ÊîØÊåÅ‰πüÂåøÂêç‰ºöËØùÔºåÁÆÄÂçïËØ¥Â∞±ÊòØ‰ΩøÁî®Ë∑®ÁΩëÈ°µ‰πãÈó¥ÂèØ‰ª•ËøõË°åÈÄöËÆØÔºåÊØîÂ¶ÇÊòæÁ§∫Áî®Êà∑ÂêçÔºåÁî®Êà∑ÊòØÂê¶Â∑≤ÁªèÂèëË°®ËØÑËÆ∫„ÄÇsessionÊ°ÜÊû∂ËÆ©‰Ω†Â≠òÂÇ®ÂíåËé∑ÂèñËÆøÈóÆËÄÖÁöÑÊï∞ÊçÆ‰ø°ÊÅØÔºåËøô‰∫õ‰ø°ÊÅØ‰øùÂ≠òÂú®ÊúçÂä°Âô®‰∏äÔºàÈªòËÆ§ÊòØÊï∞ÊçÆÂ∫ì‰∏≠ÔºâÔºå‰ª• cookies ÁöÑÊñπÂºèÂèëÈÄÅÂíåËé∑Âèñ‰∏Ä‰∏™ÂåÖÂê´ session IDÁöÑÂÄºÔºåÂπ∂‰∏çÊòØÁî®cookies‰º†ÈÄíÊï∞ÊçÆÊú¨Ë∫´„ÄÇ

ÂêØÁî®session
ÁºñËæësettings.py‰∏≠ÁöÑ‰∏Ä‰∫õÈÖçÁΩÆ

MIDDLEWARE_CLASSES Á°Æ‰øùÂÖ∂‰∏≠ÂåÖÂê´‰ª•‰∏ãÂÜÖÂÆπ

    'django.contrib.sessions.middleware.SessionMiddleware',

INSTALLED_APPS ÊòØÂåÖÂê´

    'django.contrib.sessions',

Ëøô‰∫õÊòØÈªòËÆ§ÂêØÁî®ÁöÑ„ÄÇÂ¶ÇÊûú‰Ω†‰∏çÁî®ÁöÑËØùÔºå‰πüÂèØ‰ª•ÂÖ≥ÊéâËøô‰∏™‰ª•ËäÇÁúÅ‰∏ÄÁÇπÊúçÂä°Âô®ÁöÑÂºÄÈîÄ„ÄÇ

ÊèêÁ§∫ÔºöÊÇ®‰πüÂèØ‰ª•ÈÖçÁΩÆ‰ΩøÁî®ÊØîÂ¶Ç cache Êù•Â≠òÂÇ® session

Âú®ËßÜÂõæ‰∏≠‰ΩøÁî® session

request.session ÂèØ‰ª•Âú®ËßÜÂõæ‰∏≠‰ªª‰ΩïÂú∞Êñπ‰ΩøÁî®ÔºåÂÆÉÁ±ª‰ºº‰∫épython‰∏≠ÁöÑÂ≠óÂÖ∏

session ÈªòËÆ§ÊúâÊïàÊó∂Èó¥‰∏∫‰∏§Âë®ÔºåÂèØ‰ª•Âú® settings.py ‰∏≠‰øÆÊîπÈªòËÆ§ÂÄºÔºöÂèÇËßÅËøôÈáå

    # ÂàõÂª∫Êàñ‰øÆÊîπ sessionÔºö
    request.session[key] = value
    # Ëé∑Âèñ sessionÔºö
    request.session.get(key,default=None)
    # Âà†Èô§ session
    del request.session[key] # ‰∏çÂ≠òÂú®Êó∂Êä•Èîô
    session ‰æãÂ≠ê
    ÊØîÂ¶ÇÂÜô‰∏Ä‰∏™‰∏çËÆ©Áî®Êà∑ËØÑËÆ∫‰∏§Ê¨°ÁöÑÂ∫îÁî®Ôºö

    from django.http import HttpResponse
     
    def post_comment(request, new_comment):
        if request.session.get('has_commented', False):
            return HttpResponse("You've already commented.")
        c = comments.Comment(comment=new_comment)
        c.save()
        request.session['has_commented'] = True
        return HttpResponse('Thanks for your comment!')


‰∏Ä‰∏™ÁÆÄÂåñÁöÑÁôªÈôÜËÆ§ËØÅÔºö

    def login(request):
        m = Member.objects.get(username=request.POST['username'])
        if m.password == request.POST['password']:
            request.session['member_id'] = m.id
            return HttpResponse("You're logged in.")
        else:
            return HttpResponse("Your username and password didn't match.")
             
             
    def logout(request):
        try:
            del request.session['member_id']
        except KeyError:
            pass
        return HttpResponse("You're logged out.")


ÂΩìÁôªÈôÜÊó∂È™åËØÅÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅÔºåÂπ∂‰øùÂ≠òÁî®Êà∑idÂú® session ‰∏≠ÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Âú®ËßÜÂõæ‰∏≠Áî® request.session['member_id']Êù•Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶ÁôªÈôÜÔºåÂΩìÈÄÄÂá∫ÁöÑÊó∂ÂÄôÔºåÂà†Èô§ÊéâÂÆÉ„ÄÇ

## ==‚ö° I18N ÂõΩÈôÖÂåñ

DjangoÁöÑÂõΩÈôÖÂåñÊòØÈªòËÆ§ÂºÄÂêØÁöÑÔºåÂ¶ÇÊûúÊÇ®‰∏çÈúÄË¶ÅÂõΩÈôÖÂåñÊîØÊåÅÔºåÈÇ£‰πàÊÇ®ÂèØ‰ª•Âú®ÊÇ®ÁöÑËÆæÁΩÆÊñá‰ª∂‰∏≠ËÆæÁΩÆ USE_I18N = FalseÔºåÈÇ£‰πàDjango‰ºöËøõË°å‰∏Ä‰∫õ‰ºòÂåñÔºå‰∏çÂä†ËΩΩÂõΩÈôÖÂåñÊîØÊåÅÊú∫Âà∂„ÄÇ

NOTE: 18Ë°®Á§∫InternationalizationËøô‰∏™ÂçïËØçÈ¶ñÂ≠óÊØçIÂíåÁªìÂ∞æÂ≠óÊØçN‰πãÈó¥ÁöÑÂ≠óÊØçÊúâ18‰∏™„ÄÇI18NÂ∞±ÊòØInternationalizationÔºàÂõΩÈôÖÂåñÔºâÁöÑÊÑèÊÄù„ÄÇ

Django ÂÆåÂÖ®ÊîØÊåÅÊñáÊú¨ÁøªËØëÔºåÊó•ÊúüÊó∂Èó¥Êï∞Â≠óÊ†ºÂºèÂíåÊó∂Âå∫„ÄÇ

Êú¨Ë¥®‰∏äËÆ≤ÔºåDjangoÂÅö‰∫Ü‰∏§‰ª∂‰∫ãÔºö

ÂÆÉÂÖÅËÆ∏ÂºÄÂèëËÄÖÊåáÂÆöË¶ÅÁøªËØëÁöÑÂ≠óÁ¨¶‰∏≤

DjangoÊ†πÊçÆÁâπÂÆöÁöÑËÆøÈóÆËÄÖÁöÑÂÅèÂ•ΩËÆæÁΩÆ ËøõË°åË∞ÉÁî®Áõ∏Â∫îÁöÑÁøªËØëÊñáÊú¨„ÄÇ


‰∏ÄÔºåÂºÄÂêØÂõΩÈôÖÂåñÁöÑÊîØÊåÅÔºåÈúÄË¶ÅÂú®settings.pyÊñá‰ª∂‰∏≠ËÆæÁΩÆ

    MIDDLEWARE_CLASSES = (
        ...
        'django.middleware.locale.LocaleMiddleware',
    )
     
     
    LANGUAGE_CODE = 'en'
    TIME_ZONE = 'UTC'
    USE_I18N = True
    USE_L10N = True
    USE_TZ = True
     
    LANGUAGES = (
        ('en', ('English')),
        ('zh-cn', ('‰∏≠ÊñáÁÆÄ‰Ωì')),
        ('zh-tw', ('‰∏≠ÊñáÁπÅÈ´î')),
    )
     
    #ÁøªËØëÊñá‰ª∂ÊâÄÂú®ÁõÆÂΩïÔºåÈúÄË¶ÅÊâãÂ∑•ÂàõÂª∫
    LOCALE_PATHS = (
        os.path.join(BASE_DIR, 'locale'),
    )
     
    TEMPLATE_CONTEXT_PROCESSORS = (
        ...
        "django.core.context_processors.i18n",
    )

Ê≥®ÊÑèÔºöDjango 1.9 Âèä‰ª•‰∏äÁâàÊú¨‰∏≠ÔºåËØ≠Ë®ÄÁöÑ‰ª£Á†ÅÂèëÁîüÂèòÂåñ(ËØ¶ÊÉÖÈìæÊé•Ôºögithub, django ticketÔºåÂ¶Ç‰∏ã

    LANGUAGES = (
        ('en', ('English')),
        ('zh-hans', ('‰∏≠ÊñáÁÆÄ‰Ωì')),
        ('zh-hant', ('‰∏≠ÊñáÁπÅÈ´î')),
    )


‰∫åÔºåÁîüÊàêÈúÄË¶ÅÁøªËØëÁöÑÊñá‰ª∂ÔºàDjango 1.8Âèä‰ª•‰∏ãÁöÑÁâàÊú¨ÔºâÔºö

    python manage.py makemessages -l zh-cn
    python manage.py makemessages -l zh-tw

Django 1.9 Âèä‰ª•‰∏äÁâàÊú¨Ë¶ÅÊîπÊàê

    python manage.py makemessages -l zh_hans
    python manage.py makemessages -l zh_hant


‰∏âÔºåÊâãÂ∑•ÁøªËØë locale ‰∏≠ÁöÑ django.po
 
    # ...
     
    #: .\tutorial\models.py:23
    msgid "created at"
    msgstr "ÂàõÂª∫‰∫é"
     
    #: .\tutorial\models.py:24
    msgid "updated at"
    msgstr "Êõ¥Êñ∞‰∫é" 

ÂõõÔºåÁºñËØë‰∏Ä‰∏ãÔºåËøôÊ†∑ÁøªËØëÊâç‰ºöÁîüÊïà

    python manage.py compilemessages

Â¶ÇÊûúÁøªËØë‰∏çÁîüÊïàÔºåËØ∑Ê£ÄÊü•‰Ω†ÁöÑËØ≠Ë®ÄÂåÖÁöÑÊñá‰ª∂Â§πÊòØ‰∏çÊòØÊúâ ‰∏≠ÂàíÁ∫øÔºåËØ∑Áî®‰∏ãÂàíÁ∫ø‰ª£ÊõøÂÆÉ„ÄÇ

## ==‚ö° Models
[Models and databases](https://docs.djangoproject.com/en/dev/topics/db/)
[QuerySet API reference](https://docs.djangoproject.com/en/dev/ref/models/querysets/)

Django ÂØπÂêÑÁßçÊï∞ÊçÆÂ∫ìÊèê‰æõ‰∫ÜÂæàÂ•ΩÁöÑÊîØÊåÅÔºå‰∏∫ÂÆÉ‰ª¨Êèê‰æõ‰∫ÜÁªü‰∏ÄÁöÑË∞ÉÁî®APIÔºåÂåÖÊã¨ÔºöPostgreSQL„ÄÅMySQL„ÄÅSQLite„ÄÅOracle„ÄÇÂÆâË£Ö mysql È©±Âä®ÔºåÂèØ‰ª•ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§ÂÆâË£ÖÔºö

    sudo pip install mysqlclient

Âú® `settings.py` Êñá‰ª∂‰∏≠ÊâæÂà∞ DATABASES ÈÖçÁΩÆÈ°πÔºåÂ∞ÜÂÖ∂‰øÆÊîπ‰∏∫ MySQL ÈÖçÁΩÆÔºö

    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.mysql',  # mysql.connector.django
            'NAME': 'testdb',
            'USER': 'root',
            'PASSWORD': 'abcd',
            'HOST':'localhost',
            'PORT':'3306',
        }
    }

Â¶ÇÊûú‰ΩøÁî®‰∏≠ÊñáÂ≠óÁ¨¶ÔºåÈúÄË¶ÅÂú®ÈÖçÁΩÆÊñá‰ª∂Â§¥ÈÉ®Ê∑ªÂä† `# -*- coding: UTF-8 -*-`„ÄÇDjango ‰ºöÊ†πÊçÆËøôËÆæÁΩÆÔºå‰∏é MySQL ‰∏≠Áõ∏Â∫îÁöÑÊï∞ÊçÆÂ∫ìÂíåÁî®Êà∑ËøûÊé•Ëµ∑Êù•„ÄÇ

Django ËßÑÂÆöË¶Å‰ΩøÁî®Ê®°ÂûãÂ∞±ÂøÖÈ°ªË¶ÅÂàõÂª∫‰∏Ä‰∏™ app ÁõÆÂΩïÁªìÊûÑÔºå‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§ÂàõÂª∫‰∏Ä‰∏™ app ÁõÆÂΩïÁªìÊûÑÔºö

    django-admin startapp TestModel

ÁõÆÂΩïÁªìÊûÑÂ¶Ç‰∏ãÔºö

    +--demo
       +-- TestModel
           +-- __init__.py
           +-- admin.py  Ê≥®ÂÜåÊñá‰ª∂ÔºåÂèØ‰ª•Ê≥®ÂÜåÂà∞ Django Admin ÁÆ°ÁêÜÈ°µÈù¢
           +-- apps.py
           +-- models.py
           +-- tests.py
           +-- views.py

`models.py` Â∞±ÊòØÊ®°ÂûãÊñá‰ª∂ÔºåÂÖàÂÆö‰πâ‰∏Ä‰∏™Ê®°ÂûãÁ±ªÔºö

    from django.db import models
     
    class Test(models.Model):
        name = models.CharField(max_length=20)
        value = models.IntegerField()

Á±ªÂêç Test Â∞±‰ª£Ë°®Êï∞ÊçÆÂ∫ìË°®ÂêçÔºåÁ®ãÂ∫èÂêç TestModel Âàô‰Ωú‰∏∫Ë°®ÂêçÂâçÁºÄÔºåÊúÄÁªàË°®Âêç‰∏∫ `TestModel_test`„ÄÇÁ±ªÁªßÊâø‰∫Ü `models.Model` Âü∫Á°ÄÁ±ªÔºåÁ±ªÊàêÂëò‰ª£Ë°®Êï∞ÊçÆË°®‰∏≠ÁöÑÂ≠óÊÆµÔºåÊï∞ÊçÆÁ±ªÂûãÂàôÁî±Âü∫Á°ÄÁ±ªÊèê‰æõÁöÑÂêÑÁßçÊñπÊ≥ïÂÆö‰πâÔºåmax_length ÂèÇÊï∞ÈôêÂÆöÈïøÂ∫¶„ÄÇDjango ‰ºöËá™Âä®Ê∑ªÂä†‰∏Ä‰∏™ id ‰Ωú‰∏∫‰∏ªÈîÆÔºå‰πüÂèØ‰ª•Ëá™Ë°åÂÆö‰πâ‰∏Ä‰∏™ AutoField ÂÅö‰∏∫‰∏ªÈîÆ„ÄÇ

    id = models.AutoField(primary_key=True)

    first_name = models.CharField(max_length=30)
    first_name = models.CharField("comments for first_name", max_length=30)

Êé•‰∏ãÊù•Âú® settings.py Â∞ÜÂÖ∂Ê∑ªÂä†Âà∞ INSTALLED_APPSÔºö

    INSTALLED_APPS = (
        'TestModel',
    )

Êúâ‰∫ÜÊñ∞ÁöÑÊ®°ÂûãÂ∞±ÂèØ‰ª•ÈÄöËøá `makemigrations` ÁîüÊàêÊï∞ÊçÆÂ∫ìËøÅÁßªËÑöÊú¨ÔºåÁÑ∂ÂêéÊâßË°åÊï∞ÊçÆÂ∫ìËøÅÁßªÂëΩ‰ª§Êõ¥Êñ∞Êï∞ÊçÆË°®Ôºö

    python manage.py makemigrations TestModel
    python manage.py migrate TestModel

ÁúãÂà∞Âá†Ë°å "Creating table‚Ä¶" ÁöÑÂ≠óÊ†∑ÔºåÊï∞ÊçÆË°®Â§ßÊ¶ÇÂ∞±ÂàõÂª∫Â•Ω‰∫Ü„ÄÇ

ÁÑ∂ÂêéÂ∞±ÂèØ‰ª•ÈÄöËøáÊ®°ÂûãÁ±ªÊèê‰æõÁöÑÊ®°ÂûãÁÆ°ÁêÜÂô® objects Êù•ËøõË°åÊï∞ÊçÆÊìç‰Ωú„ÄÇ‰æãÂ¶Ç `all()` Ëé∑ÂæóÊâÄÊúâÊï∞ÊçÆË°åÔºåÁõ∏ÂΩì‰∫éSQL‰∏≠ÁöÑ`SELECT * FROM`„ÄÇ`filter(id=1)` ËøáÊª§ÂáΩÊï∞Áõ∏ÂΩì SQL ÁöÑ `where id=1`ÔºåÂ¶ÇÊûúÊòØÊü•ËØ¢‰πüÂèØ‰ª•ÈÄöËøá `get(id=1)` Êù•ËÆæÁΩÆ„ÄÇ

Â¢ûÂä†‰ª•‰∏ãÂá†‰∏™Ë∑ØÁî±Ôºö

    path('add/', view.add),
    path('list/', view.list),
    path('update/', view.update),
    path('delete/', view.delete),

‰∏ÄÂπ∂Êõ¥Êñ∞ view.py ËßÜÂõæÔºåÊ∑ªÂä†Ë∑ØÁî±ËÆæÁΩÆÁöÑÁõ∏Â∫îÊñπÊ≥ïÔºåÊï∞ÊçÆÁöÑ CURD Êìç‰ΩúÂØπÂ∫î‰ª•‰∏ãÊñπÊ≥ïÁ§∫‰æãÔºö

    from django.http import HttpResponse
    from TestModel.models import Test
    from pprint import pprint
    from django.db.models import Count

    def hello(request):
        return HttpResponse("Hello world!")

    def add(request):
        row = Test(name='Jane', value=18)
        row.save()
        return HttpResponse("<p>Êï∞ÊçÆÊ∑ªÂä†ÊàêÂäüÔºÅ</p>")

    def update(request):
        row = Test.objects.get(id=1)
        row.name = 'Jean'
        row.save()

        # Test.objects.filter(id=1).update(name='Jean')
        # Test.objects.all().update(name='Jean')
        
        return HttpResponse("<p>‰øÆÊîπÊàêÂäü</p>")

    def delete(request):
        row = Test.objects.get(id=1)
        row.delete()
        
        # Test.objects.filter(id=1).delete()
        # Test.objects.all().delete()
        
        return HttpResponse("<p>Âà†Èô§ÊàêÂäü</p>")

    def list(request):
        response = ""

        # list = Test.objects.all()
        # querySet = Test.objects.filter(id=1) 
        # row = Test.objects.get(id=1) 
        
        # ÈôêÂà∂ËøîÂõûÁöÑÊï∞ÊçÆ Áõ∏ÂΩì‰∫é SQL ‰∏≠ÁöÑ OFFSET 0 LIMIT 2;
        # querySet = Test.objects.order_by('name')[0:2]
        # querySet = Test.objects.order_by("id")
        
        list = Test.objects.exclude(name="abc").order_by("-id", "name")

        count = Test.objects.all().values('id').aggregate(Count('id'))
        sql = Test.objects.all().values('id').annotate(Count('id')).query.__str__()
        # pprint(count)

        for var in list:
            response += "<li>id: %i name: %s</li>" % (var.id, var.name)
        return HttpResponse("<h1>Count:%d</h1><ul>%s</ul>%s" % (count['id__count'], response, sql ))

Âú® QuerySet ÁöÑËÅöÂêàÊü•ËØ¢‰∏≠ÁªèÂ∏∏‰ª• `aggregate()` Áî®‰∫éÊï¥‰∏™QuerySetÂØπË±°ÁöÑÊ±áÊÄªÂÄº„ÄÇËÄå `annotate()`ÂáΩÊï∞ÂèØ‰ª•‰∏∫ QuerySet ‰∏≠ÁöÑÊØè‰∏™ÂØπË±°ÁîüÊàê‰∏Ä‰∏™Áã¨Á´ãÁöÑÊëòË¶ÅÔºåËæìÂá∫ÁöÑÁªìÊûú‰ªçÁÑ∂ÊòØ‰∏Ä‰∏™ QuerySet ÂØπË±°ÔºåËÉΩÂ§üË∞ÉÁî® `filter()`„ÄÅ`order_by()`ÁîöËá≥`annotate()`„ÄÇ


    models.AutoField(`**options`)„ÄÄ„ÄÄ„ÄÄ„ÄÄ#intÔºõÂú®Django‰ª£Á†ÅÂÜÖÊòØËá™Â¢û
    models.BooleanField(`**options`)„ÄÄ„ÄÄ„ÄÄ„ÄÄ#booleanÊàñbit
    models.CharField(max_length=None[, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#varchar
    models.CommaSeparatedIntegerField(max_length=None[, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#varchar
    models.DateField([auto_now=False, auto_now_add=False, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#date  #auto_now
    models.DateTimeField([auto_now=False, auto_now_add=False, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#datetime
    models.DecimalField(max_digits=None, decimal_places=None[, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#decimal
    models.EmailField([max_length=75, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#varchar
    models.FileField(upload_to=None[, max_length=100, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#varchar #upload_to ÊåáÂÆö‰øùÂ≠òÁõÆÂΩïÂèØÂ∏¶Ê†ºÂºèÔºå
    models.FilePathField(path=None[, match=None, recursive=False, max_length=100, `**options`])„ÄÄ#varchar
    models.FloatField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#real
    models.ForeignKey(othermodel[, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#Â§ñÈîÆÔºåÂÖ≥ËÅîÂÖ∂ÂÆÉÊ®°ÂûãÔºåÂàõÂª∫ÂÖ≥ËÅîÁ¥¢Âºï
    models.ImageField(upload_to=None[, height_field=None, width_field=None, max_length=100, `**options`])
    models.IntegerField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#int
    models.IPAddressField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#varchar
    models.ManyToManyField(othermodel[, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#Â§öÂØπÂ§öÔºåÂÖ≥ËÅîÂÖ∂ÂÆÉÊ®°ÂûãÔºåÂàõÂª∫ÂÖ≥ËÅîË°®
    models.NullBooleanField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#bitÂ≠óÊÆµ‰∏äÂèØ‰ª•ËÆæÁΩÆ‰∏änullÂÄº
    models.OneToOneField(othermodel[, parent_link=False, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#‰∏ÄÂØπ‰∏ÄÔºåÂ≠óÊÆµÂÖ≥ËÅîË°®Â±ûÊÄß
    models.PositiveIntegerField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#int Ê≠£Êï¥Êï∞
    models.PositiveSmallIntegerField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#smallint Ê≠£Êï¥Êï∞
    models.SlugField([max_length=50, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#varcharÔºåÊ†áÁ≠æÔºåÂÜÖÂê´Á¥¢Âºï
    models.SmallIntegerField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#smallint
    models.TextField([`**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#text
    models.TimeField([auto_now=False, auto_now_add=False, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#time
    models.URLField([verify_exists=True, max_length=200, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#varchar
    models.XMLField(schema_path=None[, `**options`])„ÄÄ„ÄÄ„ÄÄ„ÄÄ#text


# =üö© Django Admin ÂÆöÂà∂
[The Django admin site](https://docs.djangoproject.com/en/2.2/ref/contrib/admin/)
[Ëá™ÂÆö‰πâ Django Admin](http://www.liujiangblog.com/course/django/93)
[AdminÁÆ°ÁêÜÂêéÂè∞](http://www.liujiangblog.com/course/django/157)
[Models and databases](https://docs.djangoproject.com/en/dev/topics/db/)
[QuerySet API reference](https://docs.djangoproject.com/en/dev/ref/models/querysets/)

Âú® INSTALLED_APPS ËÆæÁΩÆ‰∫Ü django.contrib.admin ÂêéÔºåDjango Â∞ÜËá™Âä®Âú®ÊØè‰∏™Â∫îÁî®ÁõÆÂΩï‰∏≠ÊêúÁ¥¢ `admin.py` Ê®°ÂùóÂπ∂ÂØºÂÖ•ÂÆÉ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÊØè‰∏™ app ‰∏ãÁöÑ admin.py ÂèØ‰ª•Êú™ Django Admin Êèê‰æõÂÆöÂà∂ÂäüËÉΩ„ÄÇ

`class apps.AdminConfig` ÂΩì Django ÂêØÂä®Êó∂Ëá™Âä®Ë∞ÉÁî®ÂÖ∂ autodiscover() ÊñπÊ≥ï
`class apps.SimpleAdminConfig` Âíå‰∏äÈù¢ÁöÑÁ±ª‰ººÔºå‰ΩÜ‰∏çË∞ÉÁî® autodiscover()
`autodiscover()[source]` Ëá™Âä®ÊêúÁ¥¢ admin Ê®°ÂùóÁöÑÊñπÊ≥ï„ÄÇÂú®‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑsiteÊó∂ÔºåÂøÖÈ°ªÁ¶ÅÁî®Ëøô‰∏™ÊñπÊ≥ïÔºå‰Ω†Â∫îËØ•Âú® INSTALLED_APPS ËÆæÁΩÆ‰∏≠Áî® django.contrib.admin.apps.SimpleAdminConfig Êõø‰ª£ django.contrib.admin„ÄÇ

Êï∞ÊçÆÊ®°ÂûãÂèØ‰ª•Ê≥®ÂÜåÂà∞ Django Admin ‰ΩøÁî®„ÄÇÊØîÂ¶ÇÔºåÂâçÈù¢Âú® TestModel ‰∏≠Â∑≤ÁªèÂàõÂª∫‰∫ÜÊ®°Âûã TestÔºå‰øÆÊîπ `admin.py` Â∞±ÂèØ‰ª•ËÆ©ÂØπÂ∫îÁöÑÊï∞ÊçÆÊòæÁ§∫Âá∫Âú®ÁÆ°ÁêÜÈ°µÈù¢ÔºåÂπ∂ÁîüÊàê‰∏Ä‰∏™ TESTMODEL Ê†èÁõÆÔºå‰πü‰∏ÄÊ†∑Êèê‰æõ‰∫Ü Add„ÄÅChange ‰∏§‰∏™Êìç‰ΩúËßÜÂõæ:

    from django.contrib import admin
    from TestModel.models import Test
     
    # Register your models here.
    admin.site.register(Test)

ÂêéÈù¢Â∞±‰ªãÁªç ModelAdmin Ë£ÖÈ•∞Âô®Á±ªÁöÑÂ∫îÁî®„ÄÇ

## ==‚ö° ÂàÜÊ†èÂèäÂàóË°®ÁæéÂåñ list_display

ÂèØ‰ª•Ëá™ÂÆö‰πâÁÆ°ÁêÜÈ°µÈù¢ÁöÑË°®ÂçïÔºåÊØîÂ¶ÇÁÆ°ÁêÜÈ°µÈù¢‰∏≠ÁöÑ Add È°µÈù¢Âè™ÊòæÁ§∫ name Âíå email ÈÉ®ÂàÜÔºåÂè™ÈúÄË¶ÅÂØπÂ∫î‰øÆÊîπ `admin.py`:

    from django.contrib import admin
    from TestModel.models import Test
     
    # Register your models here.
    class ContactAdmin(admin.ModelAdmin):
        # fields = ('name', 'email')
        fieldsets = (
            ['Main',{
                'fields':('name','email'),
            }],
            ['Advance',{
                'classes': ('collapse',), # CSS
                'fields': ('value',),
            }]
        )
     
    admin.site.register(Test, ContactAdmin)

Ê≥®ÂÜå‰ª£Á†ÅÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ ModelAdmin Ë£ÖÈ•∞Âô®Á±ª ContactAdmin Áî®‰ª•ËØ¥ÊòéÁÆ°ÁêÜÈ°µÈù¢ÁöÑÊòæÁ§∫Ê†ºÂºèÔºå`fields` Â±ûÊÄßÂÆö‰πâ‰∫ÜË¶ÅÊòæÁ§∫ÁöÑÂ≠óÊÆµÔºå`fieldsets` Áî®Êù•Â∞ÜË°®ÂçïÂàÜÊ†è„ÄÇÁÆ°ÁêÜÈ°µÈù¢Ê†èÁõÆÂàÜ‰∏∫‰∫Ü `Main` Âíå `Advance` ‰∏§ÈÉ®ÂàÜÂ±ïÁ§∫Ôºåclasses ËØ¥ÊòéÂÆÉÊâÄÂú®ÁöÑÈÉ®ÂàÜÁöÑ CSS Ê†ºÂºè„ÄÇAdvance ÈÉ®ÂàÜÊóÅËæπÊúâ‰∏Ä‰∏™ Show ÊåâÈíÆÔºåÁî®‰∫éÂ±ïÂºÄÔºåÂ±ïÂºÄÂêéÂèØÁÇπÂáª Hide Â∞ÜÂÖ∂ÈöêËóè„ÄÇÁî±‰∫éËØ•Á±ªÂØπÂ∫îÁöÑÊòØ Test Êï∞ÊçÆÊ®°ÂûãÔºåÊàë‰ª¨Âú®Ê≥®ÂÜåÁöÑÊó∂ÂÄôÔºåÈúÄË¶ÅÂ∞ÜÂÆÉ‰ª¨‰∏ÄËµ∑Ê≥®ÂÜå„ÄÇ

Áé∞Âú®ÂÆö‰πâÂ§çÊùÇ‰∏ÄÁÇπÁöÑÊ®°ÂûãÔºåÂ¢ûÂä†‰∏Ä‰∏™ Tag Ê®°ÂûãÁ±ªÔºåËÆæÁΩÆ Test ‰Ωú‰∏∫Â§ñÈîÆ„ÄÇÂêå‰∏Ä‰∏™Ê®°ÂûãÊñá‰ª∂ÂÆö‰πâÁöÑ Test„ÄÅTag Ê®°ÂûãÁ±ª‰ºöÂú®ÁÆ°ÁêÜÈ°µÈù¢Áªü‰∏ÄÂú® TESTMODELÂ±ïÁ§∫„ÄÇ‰∏Ä‰∏™ Test ËÆ∞ÂΩïÂèØ‰ª•ÂØπÂ∫îÂ§ö‰∏™ TagÔºå‰ΩÜÊØè‰∏™ Tag ÂøÖÈ°ªÂú® Test Êúâ‰∏ÄÊù°ËÆ∞ÂΩïÂØπÂ∫îÔºåÂê¶Âàô‰∏çËÉΩÂàõÂª∫ Tag ËÆ∞ÂΩï„ÄÇËøôÁßçÂÖ≥Á≥ªÂ∞±ÊòØÊï∞ÊçÆË°®ÁöÑÂ§ñÈîÆÁ∫¶ÊùüÔºåÂõ†Ê≠§Âú®Âà†Èô§ Test ËÆ∞ÂΩïÊó∂ÔºåÂ∞±Ê∂âÂèäÂà∞ Tag Ë°®ÁöÑÂ§ÑÁêÜÔºåËøôÈáå‰ΩøÁî®‰∫Ü `models.CASCADE` Âç≥Á∫ßËÅîÂà†Èô§Êìç‰ΩúÔºåÂú®Âà†Èô§ Test ËÆ∞ÂΩïÊó∂ÔºåÈÄöËøáÂ§ñÈîÆÂÖ≥ËÅîÁöÑ Tag ËÆ∞ÂΩï‰πü‰ºöË¢´Âà†Èô§Ôºö

    from django.db import models

    # Create your models here.
    class Test(models.Model):
        name = models.CharField(max_length=20)
        email = models.EmailField(default="")
        value = models.IntegerField()
        timestamp = models.DateTimeField(auto_now=True)
        def __str__(self):
            return "%d - %s - %s - %i" %(self.id, self.name, self.email, self.value)

    class Tag(models.Model):
        contact = models.ForeignKey(Test, on_delete=models.CASCADE)
        name    = models.CharField(default="",max_length=50)
        def __str__(self):
            return "%d - %s" %(self.id, self.name)

`on_delete` ÂèØ‰ª•ÈÖçÁΩÆÁöÑÈÄâÈ°πÂ¶Ç‰∏ãÔºö

CASCADEÔºöÊ≠§ÂÄºËÆæÁΩÆÔºåÊòØÁ∫ßËÅîÂà†Èô§„ÄÇ
PROTECTÔºöÊ≠§ÂÄºËÆæÁΩÆÔºåÊòØ‰ºöÊä•ÂÆåÊï¥ÊÄßÈîôËØØ„ÄÇ
SET_NULLÔºöÊ≠§ÂÄºËÆæÁΩÆÔºå‰ºöÊääÂ§ñÈîÆËÆæÁΩÆ‰∏∫ nullÔºåÂâçÊèêÊòØÂÖÅËÆ∏‰∏∫ null„ÄÇ
SET_DEFAULTÔºöÊ≠§ÂÄºËÆæÁΩÆÔºå‰ºöÊääËÆæÁΩÆ‰∏∫Â§ñÈîÆÁöÑÈªòËÆ§ÂÄº„ÄÇ
SET()ÔºöÊ≠§ÂÄºËÆæÁΩÆÔºå‰ºöË∞ÉÁî®Â§ñÈù¢ÁöÑÂÄºÔºåÂèØ‰ª•ÊòØ‰∏Ä‰∏™ÂáΩÊï∞„ÄÇ‰∏ÄËà¨ÊÉÖÂÜµ‰∏ã‰ΩøÁî® CASCADE Â∞±ÂèØ‰ª•‰∫Ü„ÄÇ

‰øÆÊîπÊï∞ÊçÆÊ®°ÂûãÂêéËÆ∞ÂæóÂØπÊï∞ÊçÆÂ∫ìËøõË°åËøÅÁßªÊìç‰ΩúÔºö

    python manage.py makemigrations TestModel
    python manage.py migrate TestModel

Âú® Django ÁöÑÊ®°ÂûãÁ±ª‰∏≠ÂÆö‰πâ‰∫Ü `__unicode__()` ÊñπÊ≥ïÊù•ÁæéÂåñÈ°µÈù¢ÁöÑÂàóË°®ÂÜÖÂÆπÔºåÂ¶ÇÊûú Python 3 Â∞±Áî® `__str__(self)`Ôºå‰ΩøÁî®Ëøô‰∏™ÁæéÂåñÊñπÊ≥ïÂèØ‰ª•ÂÆöÂà∂ÁÆ°ÁêÜÈ°µÈù¢ÁöÑÂàóË°®ÊòæÁ§∫ÔºåÂ¶ÇÊûú‰∏çÂÆö‰πâËøô‰∏™ÊñπÊ≥ïÔºåÂàóË°®Â∞±Âè™ËÉΩÊòæÁ§∫Âá∫Á±ª‰ºº `Test object (5)` ËøôÊ†∑ÁöÑÊù°ÁõÆÔºåÊòæÂæó‰∏çÁõ¥ËßÇÔºö

    def __unicode__(self):
        return self.name

    def __str__(self):
        return 'Name:' + self.name

ÂΩìÁÑ∂ËøòÂèØ‰ª•ÈÄöËøá ContactAdmin ËÆæÁΩÆ `list_display` Êù•Êõø‰ª£ÁæéÂåñÊñπÊ≥ïÔºåËøôÊ†∑Â∞±ÂèØ‰ª•Âú®ÂàóË°®‰∏≠ÊòæÁ§∫ÊåáÂÆöÂ≠óÊÆµÔºö

    list_display = ("id", "name", "email")


## ==‚ö° ÂÆöÂà∂ admin Êï¥‰ΩìÁïåÈù¢

Âú®ÊØè‰∏Ä‰∏™È°πÁõÆÁöÑ admin È°µÈù¢È°∂Á´ØÈÉΩÊòæÁ§∫ Django administrationÔºåÂÆÉ‰ªÖ‰ªÖÊòØ‰∏™Âç†‰ΩçÊñáÊú¨„ÄÇÂà©Áî®DjangoÁöÑÊ®°ÊùøÁ≥ªÁªüÔºåÊàë‰ª¨ÂèØ‰ª•Âø´ÈÄü‰øÆÊîπÂÆÉ„ÄÇ

Âú® manage.py Êñá‰ª∂ÂêåÁ∫ß‰∏ãÂàõÂª∫‰∏Ä‰∏™templatesÁõÆÂΩï„ÄÇÁÑ∂ÂêéÔºåÊâìÂºÄËÆæÁΩÆÊñá‰ª∂ settings.pyÔºåÂú® TEMPLATES Êù°ÁõÆ‰∏≠Ê∑ªÂä†‰∏Ä‰∏™ DIRS ÈÄâÈ°πÔºö

    TEMPLATES = [
        {
            'BACKEND': 'django.template.backends.django.DjangoTemplates',
            'DIRS': [os.path.join(BASE_DIR, 'templates')],  # Ë¶ÅÊúâËøô‰∏ÄË°åÔºåÂ¶ÇÊûúÂ∑≤ÁªèÂ≠òÂú®ËØ∑‰øùÊåÅÂéüÊ†∑
            'APP_DIRS': True,
            'OPTIONS': {
                'context_processors': [
                    'django.template.context_processors.debug',
                    'django.template.context_processors.request',
                    'django.contrib.auth.context_processors.auth',
                    'django.contrib.messages.context_processors.messages',
                ],
            },
        },
    ]

DIRSÊòØ‰∏Ä‰∏™Êñá‰ª∂Á≥ªÁªüÁõÆÂΩïÁöÑÂàóË°®ÔºåÊòØÊ®°ÊùøÁöÑÊêúÁ¥¢Ë∑ØÂæÑ„ÄÇÂΩìÂä†ËΩΩDjangoÊ®°ÊùøÊó∂Ôºå‰ºöÂú®DIRS‰∏≠ËøõË°åÊü•Êâæ„ÄÇ

ÂÜçÂú® templates ÁõÆÂΩï‰∏≠ÂàõÂª∫‰∏Ä‰∏™ admin Â≠êÁõÆÂΩïÔºåÂ∞Ü Django Ê∫êÁ†ÅÁöÑ django/contrib/admin/templates/admin/base_site.html Ê®°ÊùøÊñá‰ª∂Êã∑Ë¥ùÂà∞ËØ•ÁõÆÂΩïÂÜÖ„ÄÇ Â¶ÇÊûú‰Ω†Êó†Ê≥ïÊâæÂà∞ Django Ê∫ê‰ª£Á†ÅÊñá‰ª∂ÁöÑÂ≠òÊîæ‰ΩçÁΩÆÔºåÂèØ‰ª•‰ΩøÁî®‰∏ãÈù¢ÁöÑÂëΩ‰ª§Ôºö

    $ python -c "import django; print(django.__path__)"

ÁºñËæë base_site.html Êñá‰ª∂ÔºåÁî®‰Ω†ÂñúÊ¨¢ÁöÑÂÜÖÂÆπÊõøÊç¢ÊéâÊ®°ÊùøÂÜÖÂÆπÔºö

    {% extends "admin/base.html" %}

    {% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

    {% block branding %}
    <h1 id="site-name"><a href="{% url 'admin:index' %}">Á´ôÁÇπÁÆ°ÁêÜÁïåÈù¢</a></h1>
    {% endblock %}

    {% block nav-global %}{% endblock %}

Âú®ËøôÈáåÔºåÊàë‰ª¨‰ΩøÁî®ÁöÑÊòØÁ°¨ÁºñÁ†ÅÔºåÂº∫Ë°åÊîπÂêç‰∏∫Á´ôÁÇπÁÆ°ÁêÜÁïåÈù¢"„ÄÇÂú®ÂÆûÈôÖÁöÑÈ°πÁõÆ‰∏≠Ôºå‰Ω†ÂèØ‰ª•‰ΩøÁî® django.contrib.admin.AdminSite.site_header Â±ûÊÄßÔºåÊñπ‰æøÁöÑÂØπËøô‰∏™È°µÈù¢ title ËøõË°åËá™ÂÆö‰πâ„ÄÇ

ÊèêÁ§∫ÔºöÊâÄÊúâDjango ÈªòËÆ§ÁöÑ admin Ê®°ÊùøÈÉΩÂèØ‰ª•Ë¢´ÈáçÂÜôÔºåÁ±ª‰ººÂàöÊâçÈáçÂÜô base_site.html Ê®°ÊùøÁöÑÊñπÊ≥ï‰∏ÄÊ†∑Ôºå‰ªéÊ∫ê‰ª£Á†ÅÁõÆÂΩïÂ∞ÜHTMLÊñá‰ª∂Êã∑Ë¥ùËá≥‰Ω†Ëá™ÂÆö‰πâÁöÑÁõÆÂΩïÂÜÖÔºåÁÑ∂Âêé‰øÆÊîπÊñá‰ª∂„ÄÇ

ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåadmin È¶ñÈ°µÊòæÁ§∫ÊâÄÊúâ INSTALLED_APPS ÂÜÖÂπ∂Âú® admin Â∫îÁî®‰∏≠Ê≥®ÂÜåËøáÁöÑ appÔºå‰ª•Â≠óÊØçÈ°∫Â∫èËøõË°åÊéíÂ∫è„ÄÇ

Ë¶ÅÂÆöÂà∂ admin È¶ñÈ°µÔºå‰Ω†ÈúÄË¶ÅÈáçÂÜô admin/index.html Ê®°ÊùøÔºåÂ∞±ÂÉèÂâçÈù¢‰øÆÊîπ base_site.html Ê®°ÊùøÁöÑÊñπÊ≥ï‰∏ÄÊ†∑Ôºå‰ªéÊ∫êÁ†ÅÁõÆÂΩïÊã∑Ë¥ùÂà∞‰Ω†ÊåáÂÆöÁöÑÁõÆÂΩïÂÜÖ„ÄÇÁºñËæëËØ•Êñá‰ª∂Ôºå‰Ω†‰ºöÁúãÂà∞Êñá‰ª∂ÂÜÖ‰ΩøÁî®‰∫Ü‰∏Ä‰∏™ app_list Ê®°ÊùøÂèòÈáè„ÄÇËØ•ÂèòÈáèÂåÖÂê´‰∫ÜÊâÄÊúâÂ∑≤ÁªèÂÆâË£ÖÁöÑ Django Â∫îÁî®„ÄÇ‰Ω†ÂèØ‰ª•Á°¨ÁºñÁ†ÅÈìæÊé•Âà∞ÊåáÂÆöÂØπË±°ÁöÑadminÈ°µÈù¢Ôºå‰ΩøÁî®‰ªª‰Ωï‰Ω†ËÆ§‰∏∫Â•ΩÁöÑÊñπÊ≥ïÔºåÁî®‰∫éÊõø‰ª£Ëøô‰∏™app_list„ÄÇ

Django ÁöÑ adminÁ´ôÁÇπÊòØËá™Âä®ÁîüÊàêÁöÑ„ÄÅÈ´òÂ∫¶ÂèØÂÆöÂà∂ÁöÑÔºåÂÆÉÊòØ Django Áõ∏ËæÉÂÖ∂ÂÆÉ Web Ê°ÜÊû∂Áã¨ÊúâÁöÑÂÜÖÂÆπÔºåÂπøÂèóÊ¨¢Ëøé„ÄÇËøòÊúâÁ¨¨‰∏âÊñπÁæéÂåñÁâà xadminÔºåËØ∑‰∏ÄÂÆö‰∏çË¶ÅÂøΩÁï•ÂÆÉÔºåÂÆÉÂÄºÂæóÊã•ÊúâÔºÅ


## ==‚ö° actions ÂëΩ‰ª§ÂàóË°®

ModelAdmin.actions ËÆæÁΩÆÂ§ßÊâπÈáèÊìç‰Ωú Action ÂëΩ‰ª§ÂàóË°®„ÄÇ

`actions_on_top` ÊòØÂê¶Âú®ÂàóË°®‰∏äÊñπÊòæÁ§∫ actions ÁöÑ‰∏ãÊãâÊ°ÜÔºåÈªòËÆ§‰∏∫True
`actions_on_bottom` ÊòØÂê¶Âú®ÂàóË°®‰∏ãÊñπÊòæÁ§∫actionsÁöÑ‰∏ãÊãâÊ°ÜÔºåÈªòËÆ§‰∏∫False„ÄÇ
`actions_selection_counter` ÊòØÂê¶Âú® actions‰∏ãÊãâÊ°ÜÂè≥‰æßÊòæÁ§∫ÈÄâ‰∏≠ÂàóË°®ÂØπË±°ÁöÑÊï∞ÈáèÔºåÈªòËÆ§‰∏∫TrueÔºåÊúâÂä©‰∫éÊèê‰æõÁêÜËß£ Action Êìç‰ΩúÂΩ±ÂìçÁöÑÊï∞ÊçÆ„ÄÇ

    actions_on_top = True
    actions_on_bottom = True
    actions_selection_counter = True

‰∏ãÈù¢ÂÆûÁé∞‰∏Ä‰∏™ÊâπÈáèÂëΩ‰ª§ action Áî®Êù•Ëá™Â¢û value Â≠óÊÆµÔºåÂëΩ‰ª§ÂáΩÊï∞Êé•Âèó‰∏â‰∏™ÂèÇÊï∞ÔºåModelAdmin„ÄÅHttpRequest Âíå QuerySet Âç≥Ë¢´ÈÄâÊã©ÁöÑÂØπË±°„ÄÇ

Âú®Â∫îÁî®‰∏≠ÁöÑ admin.py Êñá‰ª∂‰∏≠ÂÆö‰πâ‰∏Ä‰∏™ÂáΩÊï∞ÔºåÂèØ‰ª•‰∏∫ÂëΩ‰ª§ËÆæÁΩÆ‰∏Ä‰∏™ÁÆÄÂçïÊòìÊáÇÁöÑÁÆÄÁü≠ÊèèËø∞ short_description Áî®‰∫é‰ª£ÊõøÁîüÁ°¨ÁöÑÂáΩÊï∞ÂêçÔºö

    def make_published(modeladmin, request, queryset):
        queryset.update(value=1)
    # Ê≥®ÊÑèÁº©ËøõÔºå‰∏ãÈù¢ËøôÂè•‰∏çÂú®ÂáΩÊï∞‰ΩìÂÜÖ„ÄÇ
    make_published.short_description = "Increase selected value"

ÂÜçÂ∞ÜËá™ÂÆö‰πâ action Ê∑ªÂä†Âà∞ÂØπÂ∫îÁöÑ ModelAdmin ‰∏≠Ôºö

    actions = [make_published]

ÂèØ‰ª•Â∞ÜÂÆÉ‰Ωú‰∏∫ ModelAdmin ÁöÑÊñπÊ≥ïÊù•‰ΩøÁî®ÔºåËøôÊ†∑ÂÅöÁöÑÂ•ΩÂ§ÑÊòØÂèØ‰ª•ÈÄöËøá self ËÆøÈóÆÁ±ªÂÆûÂàóÊú¨Ë∫´Ôºö

    class ContactAdmin(admin.ModelAdmin):
        actions = ['make_published']  # ËØ∑Ê≥®ÊÑèËøôÈáåÊîπÊàêÂ≠óÁ¨¶‰∏≤ÂºïÁî®‰∫Ü
        # Á¨¨‰∏Ä‰∏™ÂèÇÊï∞Âèò‰∏∫ self
        def make_published(self, request, queryset):
            rows_updated = 0
            for row in queryset:
                row.value += 1
                rows_updated += 1
                row.save()
            if rows_updated == 1:
                message_bit = "1 row was"
            else:
                message_bit = "%s rows were" % rows_updated
            self.message_user(request, "%s increased." % message_bit)
        # Ê≥®ÊÑèÁº©ËøõÔºå‰∏ãÈù¢ËøôÂè•‰∏çÂú®ÂáΩÊï∞‰ΩìÂÜÖ„ÄÇ
        make_published.short_description = "Increase selected value"

Ê≥®ÊÑèÔºö‰Ωú‰∏∫‰æãÂ≠êÔºåÂèØ‰ª•ÁÆÄÂçïÂú∞‰ΩøÁî® `queryset.update(status='p')` ÊñπÊ≥ïÊâπÈáèÊâßË°åÊõ¥Êñ∞Êìç‰Ωú„ÄÇ‰ΩÜÂú®Â§öÊï∞ÊÉÖÂÜµ‰∏ãÔºå‰Ω†Ë¶ÅËá™Â∑±ÈÅçÂéÜ queryset ÁöÑÊØè‰∏™ÂÖÉÁ¥†ÔºåÂπ∂ÁºñÂÜôÂÖ∑‰ΩìÁöÑÊìç‰Ωú„ÄÇ

Â¶ÇÊûú‰Ω†ËÉΩÂ§üÈ¢ÑÁü•Âú®Ëá™ÂÆö‰πâÁöÑÊìç‰Ωú‰∏≠ÂèØËÉΩ‰∫ßÁîüÁöÑÈîôËØØÔºåËØ∑Â§ÑÁêÜËØ•ÈîôËØØÔºåÂπ∂ÈÄöËøá django.contrib.admin.ModelAdmin.message_user() ‰ª•ÂèãÂ•ΩÁöÑÊñπÂºèÁªô‰∫àÁî®Êà∑ÊèêÁ§∫‰ø°ÊÅØ„ÄÇ

ËøôÈÉ®ÂàÜÂÆöÂà∂ÈúÄË¶ÅÁÜüÁªÉ‰ΩøÁî® QuerySetÔºåÂèÇËÄÉÊñáÊ°£ [Models and databases] Âíå [QuerySet API reference]„ÄÇ


‚ö° inlines

ËøôÈáå Test ÊòØ Tag ‰∏§‰∏™Ê®°ÂûãÈÄöËøáÂ§ñÈîÆ‰∫ßÁîü‰∫ÜÂÖ≥ËÅîÔºå‰ΩÜÊòØÂú®ÈªòËÆ§ÁöÑÈ°µÈù¢ÊòæÁ§∫‰∏≠ÔºåÂ∞Ü‰∏§ËÄÖÊòØÂàÜÁ¶ªÂºÄËøõË°åÁºñËæëÁöÑÔºåÊó†Ê≥ï‰ΩìÁé∞Âá∫‰∏§ËÄÖÁöÑ‰ªéÂ±ûÂÖ≥Á≥ª„ÄÇDjango Êèê‰æõ‰∫ÜÂÜÖËÅîÊòæÁ§∫ `inlines` Ëøô‰∏™ ModelAdmin ÈÖçÁΩÆÂ±ûÊÄßÔºåËÆ© Tag ÈôÑÂä†Âú® Test ÁöÑÁºñËæëÈ°µÈù¢‰∏äÊòæÁ§∫„ÄÇ

‰øÆÊîπ `admini.py` Â¶Ç‰∏ãÔºåÂÆö‰πâ‰∏Ä‰∏™ TagInline Á±ªÂπ∂ÈÄöËøá inlines Â±ûÊÄßÈÖçÁΩÆÂà∞ ContactAdminÔºö

    class TagInline(admin.TabularInline):
        model = Tag

    class ContactAdmin(admin.ModelAdmin):
        inlines = [TagInline]

‚ö° search_fields

ÊêúÁ¥¢ÂäüËÉΩÂú®ÁÆ°ÁêÜÂ§ßÈáèËÆ∞ÂΩïÊó∂ÈùûÂ∏∏ÊúâÔºåÂèØ‰ª•‰ΩøÁî® search_fields ‰∏∫ËØ•ÂàóË°®È°µÂ¢ûÂä†ÊêúÁ¥¢Ê†èÔºö

    search_fields = ('name',)

Ë¢´ÊêúÁ¥¢ÁöÑÂ≠óÊÆµÂèØ‰ª•ÊòØCharFieldÊàñËÄÖTextFieldÊñáÊú¨Á±ªÂûãÔºå‰πüÂèØ‰ª•ÈÄöËøáÂèå‰∏ãÂàíÁ∫øËøõË°åForeignKeyÊàñËÄÖManyToManyFieldÁöÑÊü•ËØ¢ÔºåÊ†ºÂºè‰∏∫search_fields = ['foreign_key__related_fieldname'].

‰æãÂ¶ÇÔºöÂ¶ÇÊûú‰ΩúËÄÖÊòØÂçöÂÆ¢ÁöÑForeignKeyÂ≠óÊÆµÔºå‰∏ãÈù¢ÁöÑÊñπÂºèÂ∞ÜÈÄöËøá‰ΩúËÄÖÁöÑemailÂú∞ÂùÄÊù•Êü•ËØ¢ÂØπÂ∫îÁöÑÂçöÂÆ¢Ôºå‰πüÂ∞±ÊòØemailÂú∞ÂùÄÊòØÊü•ËØ¢ÂÄºÁöÑ‰ΩúËÄÖÊâÄÂÜôÁöÑÊâÄÊúâÂçöÂÆ¢„ÄÇ

    search_fields = ['user__email']

ÂΩì‰Ω†Âú®ÊêúÁ¥¢Ê°ÜÈáåËæìÂÖ•‰∏Ä‰∫õÊñáÊú¨ÁöÑÊó∂ÂÄôÔºåDjango‰ºöÂ∞ÜÊñáÊú¨ÂàÜÂâ≤Êàê‰∏Ä‰∏™‰∏Ä‰∏™ÁöÑÂÖ≥ÈîÆÂ≠óÔºåÂπ∂ËøîÂõûÊâÄÊúâÂåÖÂê´Ëøô‰∫õÂÖ≥ÈîÆÂ≠óÁöÑÂØπË±°ÔºåÂøÖÈ°ªÊ≥®ÊÑèÁöÑÊòØÔºåÊØè‰∏™ÂÖ≥ÈîÆËØçËá≥Â∞ëÂæóÊòØsearch_fieldsÂÖ∂‰∏≠‰πã‰∏Ä„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûú search_fieldsÊòØ['first_name', 'last_name']ÔºåÂΩìÁî®Êà∑ËæìÂÖ•John lennonÊó∂ÔºàÊ≥®ÊÑè‰∏≠Èó¥ÁöÑÁ©∫Ê†ºÔºâÔºåDjangoÂ∞ÜÊâßË°åÁ≠âÂêå‰∫é‰∏ãÈù¢ÁöÑSQLËØ≠Ê≥ïWHEREÂ≠êÂè•Ôºö

    WHERE (first_name ILIKE '%john%' OR last_name ILIKE '%john%') AND (first_name ILIKE '%lennon%' OR last_name ILIKE '%lennon%')

Â¶ÇÊûúË¶ÅÊâßË°åÊõ¥Âä†‰∏•Ê†ºÁöÑÂåπÈÖçÊàñÊêúÁ¥¢ÔºåÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∫õÂÖÉÂ≠óÁ¨¶Ôºå‰æãÂ¶Ç‚Äú^‚Äù„ÄÇÁ±ª‰ººÊ≠£ÂàôÔºåÂÆÉ‰ª£Ë°®‰ªéÂºÄÂ§¥ÂåπÈÖç„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúsearch_fieldsÊòØ['^first_name','^last_name'],ÂΩìÁî®Êà∑ËæìÂÖ•‚ÄúJohn lennon‚ÄùÊó∂ÔºàÊ≥®ÊÑè‰∏≠Èó¥ÁöÑÁ©∫Ê†ºÔºâÔºåDjangoÂ∞ÜÊâßË°åÁ≠âÂêå‰∫é‰∏ãÈù¢ÁöÑSQLËØ≠Ê≥ïWHEREÂ≠êÂè•Ôºö

    WHERE (first_name ILIKE 'john%' OR last_name ILIKE 'john%') AND (first_name ILIKE 'lennon%' OR last_name ILIKE 'lennon%')

‰πüÂèØ‰ª•‰ΩøÁî®‚Äú=‚ÄùÔºåÊù•ËøõË°åÂå∫ÂàÜÂ§ßÂ∞èÂÜôÁöÑÂπ∂ÁªùÂØπÁõ∏Á≠âÁöÑ‰∏•Ê†ºÂåπÈÖç„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúsearch_fieldsÊòØ['=first_name','=last_name'],ÂΩìÁî®Êà∑ËæìÂÖ•‚ÄúJohn lennon‚ÄùÊó∂ÔºàÊ≥®ÊÑè‰∏≠Èó¥ÁöÑÁ©∫Ê†ºÔºâÔºåDjangoÂ∞ÜÊâßË°åÁ≠âÂêå‰∫é‰∏ãÈù¢ÁöÑSQLËØ≠Ê≥ïWHEREÂ≠êÂè•Ôºö

    WHERE (first_name ILIKE 'john' OR last_name ILIKE 'john') AND (first_name ILIKE 'lennon' OR last_name ILIKE 'lennon')

‚ö° list_filter

ËøáÊª§Âô®ÂàóË°®ÔºåÊèê‰æõ‰∫ÜÂàóË°®ËøáÊª§ÈÄâÈ°πÂç°ÔºåÂ∞±ÂÉèÊèê‰æõ‰∫Ü SQL ÁöÑ where Êù°‰ª∂ËøáÊª§„ÄÇ‰ΩÜËØ•Â≠óÊÆµÂøÖÈ°ªÊòØBooleanField„ÄÅCharField„ÄÅDateField„ÄÅDateTimeField„ÄÅIntegerField„ÄÅForeignKeyÊàñËÄÖManyToManyField‰∏≠ÁöÑ‰∏ÄÁßç„ÄÇ

    list_filter = ("name", "email")

‰Ω†ÂèØ‰ª•Âà©Áî®Âèå‰∏ãÂàíÁ∫øËøõË°åË∑®Ë°®ÂÖ≥ËÅîÔºåÂ¶Ç‰∏ã‰æãÔºö

    list_filter = ('tag__name',)

‰πüÂèØ‰ª•ÊòØ‰∏Ä‰∏™ÂÖÉÁªÑ„ÄÇÂÆÉÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÊòØ‰∏™Â≠óÊÆµÂêçÔºåÁ¨¨‰∫å‰∏™ÂÖÉÁ¥†ÂàôÊòØÁªßÊâø‰∫Ü django.contrib.admin.FieldListFilter ÁöÑÁ±ªÔºö

    list_filter = (
        ('is_staff', admin.BooleanFieldListFilter),
    )

‰Ω†ÂèØ‰ª•‰ΩøÁî® RelatedOnlyFieldListFilter ÈôêÂà∂ÂÖ≥ËÅîÁöÑÂØπË±°„ÄÇÂÅáËÆæ author ÊòØÂÖ≥ËÅî User Ê®°ÂûãÁöÑ ForeignKeyÔºå‰∏ãÈù¢ÁöÑÁî®Ê≥ïÂ∞ÜÂè™ÈÄâÊã©ÈÇ£‰∫õÂá∫Ëøá‰π¶ÁöÑ user ËÄå‰∏çÊòØÊâÄÊúâÁöÑ userÔºö

    list_filter = ( 
        ('author', admin.RelatedOnlyFieldListFilter),
    )

ËøòÂèØÊ∑±Â∫¶ÂÆöÂà∂ÔºåÁªôÂÆÉËÆæÁΩÆ‰∏Ä‰∏™ÁªßÊâø django.contrib.admin.SimpleListFilter ÁöÑÁ±ª„ÄÇ‰Ω†Ë¶ÅÁªôËøô‰∏™Á±ªÊèê‰æõ title Âíå parameter_name ÁöÑÂÄºÔºåÂπ∂ÈáçÂÜô lookups Âíå queryset ÊñπÊ≥ï„ÄÇ‰∏∫‰∫ÜÊñπ‰æøÔºåÊàë‰ª¨ÈÄöÂ∏∏‰ºöÂ∞Ü HttpRequest ÂØπË±°‰º†ÈÄíÁªô lookups Âíå queryset ÊñπÊ≥ï„ÄÇ


‚ö° date_hierarchy

Ê†πÊçÆÊåáÂÆöÁöÑ Date Âíå DateTime Â≠óÊÆµËøõË°åÊêúÁ¥¢Ôºå‰∏∫È°µÈù¢ÂàõÂª∫‰∏Ä‰∏™Êó•ÊúüËøáÊª§Èù¢ÊùøÔºö

    date_hierarchy = 'timestamp'

‚ö° list_max_show_all

ËÆæÁΩÆ‰∏Ä‰∏™Êï∞ÂÄºÔºåÂΩìÂàóË°®ÂÖÉÁ¥†ÊÄªÊï∞Â∞è‰∫éËøô‰∏™ÂÄºÁöÑÊó∂ÂÄôÔºåÂ∞ÜÊòæÁ§∫‰∏Ä‰∏™‚Äúshow all‚ÄùÈìæÊé•ÔºåÁÇπÂáªÂêéÂ∞±ËÉΩÁúãÂà∞‰∏Ä‰∏™Â±ïÁ§∫‰∫ÜÊâÄÊúâÂÖÉÁ¥†ÁöÑÈ°µÈù¢ÔºåËØ•ÂÄºÈªòËÆ§‰∏∫ 200„ÄÇ

    list_max_show_all = 10

‚ö° list_per_page

ËÆæÁΩÆÊØèÈ°µÊòæÁ§∫Â§öÂ∞ë‰∏™ÂÖÉÁ¥†„ÄÇDjangoËá™Âä®Â∏Æ‰Ω†ÂàÜÈ°µ„ÄÇÈªòËÆ§‰∏∫100„ÄÇ

    list_per_page = 5

‚ö° list_editable

ËÆæÁΩÆÂú®ÂàóË°®‰∏≠ÂèØ‰ª•ÁºñËæëÁöÑÂ≠óÊÆµ

    list_editable = ('name',)

‚ö° list_display_links

ËÆæÁΩÆÁºñËæëË∑≥ËΩ¨ÈìæÊé•ÁöÑÂ≠óÊÆµ

    list_display_links = ('name',)

‚ö° list_select_related

Â¶ÇÊûúËÆæÁΩÆ‰∫Ü list_select_related Â±ûÊÄßÔºåDjango Â∞Ü‰ºö‰ΩøÁî® `select_related()` ÊñπÊ≥ïÊü•ËØ¢Êï∞ÊçÆÔºåËøôÂèØËÉΩ‰ºöÂ∏ÆÂä©‰Ω†ÂáèÂ∞ë‰∏Ä‰∫õÊï∞ÊçÆÂ∫ìËÆøÈóÆ„ÄÇ

Â±ûÊÄßÁöÑÂÄºÂèØ‰ª•ÊòØÂ∏ÉÂ∞îÂÄº„ÄÅÂÖÉÁªÑÊàñÂàóË°®ÔºåÈªòËÆ§‰∏∫False„ÄÇÂΩìÂÄº‰∏∫TrueÊó∂ÔºåÂ∞ÜÂßãÁªàË∞ÉÁî®`select_related()`ÊñπÊ≥ïÔºõÂ¶ÇÊûúÂÄº‰∏∫FalseÔºåDjango Â∞ÜÊü•Áúã list_display Â±ûÊÄßÔºåÂè™ÂØπ ForeignKey Â≠óÊÆµË∞ÉÁî® `select_related()` ÊñπÊ≥ï„ÄÇ

Â¶ÇÊûú‰Ω†ÈúÄË¶ÅÊõ¥ÁªÜÁ≤íÂ∫¶ÁöÑÊéßÂà∂ÔºåËØ∑ËµãÂÄº‰∏Ä‰∏™ÂÖÉÁªÑÔºàÊàñÂàóË°®Ôºâ„ÄÇÁ©∫ÂÖÉÁªÑÂ∞ÜÈòªÊ≠¢select_related()ÊñπÊ≥ïÔºåÂê¶ÂàôÂÖÉÁªÑ‰ºöË¢´ÂΩìÂÅöÂèÇÊï∞‰º†ÈÄíÁªôselect_related()ÊñπÊ≥ï„ÄÇ‰æãÂ¶ÇÔºö

    list_select_related = ('author', 'category')

ËøôÂ∞Ü‰ºöË∞ÉÁî® `select_related('author', 'category')`ÔºåË¶ÅÊòØÂä®ÊÄÅÊü•ËØ¢Ëá™Ë°åÂÆûÁé∞ `get_list_select_related()`„ÄÇ


‚ö° ordering

ËÆæÁΩÆÊéíÂ∫èÁöÑÊñπÂºèÔºåÂ±ûÊÄßÁöÑÂÄºÂøÖÈ°ª‰∏∫‰∏Ä‰∏™ÂÖÉÁªÑÊàñÂàóË°®ÔºåÊ†ºÂºèÂíåÊ®°ÂûãÁöÑ ordering ÂèÇÊï∞‰∏ÄÊ†∑„ÄÇÂ¶ÇÊûú‰∏çËÆæÁΩÆËøô‰∏™Â±ûÊÄßÔºåDjango Â∞ÜÊåâÈªòËÆ§ÊñπÂºèËøõË°åÊéíÂ∫è„ÄÇÂ¶ÇÊûú‰Ω†ÊÉ≥ËøõË°åÂä®ÊÄÅÊéíÂ∫èÔºåËØ∑Ëá™Â∑±ÂÆûÁé∞ `get_ordering()`ÊñπÊ≥ï„ÄÇ

‚ö° paginator

ÊåáÂÆöÁî®‰∫éÂàÜÈ°µÁöÑÂàÜÈ°µÂô®„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂàÜÈ°µÂô®Áî®ÁöÑÊòØ Django Ëá™Â∏¶ÁöÑ django.core.paginator.Paginator„ÄÇÂ¶ÇÊûúËá™ÂÆö‰πâÂàÜÈ°µÂô®ÁöÑÊûÑÈÄ†ÂáΩÊï∞Êé•Âè£Âíå django.core.paginator.Paginator ÁöÑ‰∏ç‰∏ÄÊ†∑ÔºåÈÇ£‰Ω†ËøòÈúÄË¶ÅËá™Â∑±ÂÆûÁé∞ ModelAdmin.get_paginator() ÊñπÊ≥ï„ÄÇ

‚ö° prepopulated_fields

ËÆæÁΩÆÈ¢ÑÂ°´ÂÖÖÂ≠óÊÆµÔºåÂç≥‰∏∫Â≠óÊÆµÊèê‰æõÁºñËæëÊó∂ÁöÑÂÄôÈÄâÈ°π„ÄÇ‰∏çÊé•Êî∂ DateTimeField„ÄÅForeignKey Âíå ManyToManyField Á±ªÂûãÁöÑÂ≠óÊÆµ„ÄÇ

    prepopulated_fields = {"name": ("title",)}

‚ö° preserve_filters

ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂΩì‰Ω†ÂØπÁõÆÊ†áËøõË°åÂàõÂª∫„ÄÅÁºñËæëÊàñÂà†Èô§Êìç‰ΩúÂêéÔºåÈ°µÈù¢‰ºö‰æùÁÑ∂‰øùÊåÅÂéüÊù•ÁöÑËøáÊª§Áä∂ÊÄÅ„ÄÇÂ∞Üpreserve_filtersËÆæ‰∏∫FalseÂêéÔºåÂàô‰ºöËøîÂõûÊú™ËøáÊª§Áä∂ÊÄÅ„ÄÇ

‚ö° radio_fields

ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåDjango ‰ΩøÁî® select Ê†áÁ≠æÊòæÁ§∫ ForeignKey Êàñ choices ÈõÜÂêà„ÄÇÂ¶ÇÊûúÂ∞ÜËøôÁßçÂ≠óÊÆµËÆæÁΩÆ‰∏∫ radio_fieldsÔºåÂàô‰ºö‰ª•radio_boxÊ†áÁ≠æÁöÑÂΩ¢ÂºèÂ±ïÁ§∫„ÄÇ‰∏ãÈù¢ÁöÑ‰æãÂ≠êÂÅáËÆæ contact ÊòØ‰∏Ä‰∏™ForeignKeyÂ≠óÊÆµÔºö

    # ÂûÇÁõ¥Â∏ÉÂ±Ä„ÄÇÔºàËÇØÂÆö‰πüÊúâÊ∞¥Âπ≥Â∏ÉÂ±ÄHORIZONTALÁöÑÂï¶Ôºâ
    radio_fields = {"contact": admin.VERTICAL}

Ê≥®ÊÑèÔºö‰∏çË¶ÅÂ∞ÜForeignKeyÊàñchoicesÈõÜÂêà‰πãÂ§ñÁöÑÂ≠óÊÆµÁ±ªÂûãËÆæÁΩÆÁªôËøô‰∏™Â±ûÊÄß„ÄÇ

‚ö° raw_id_fields

Ëøô‰∏™Â±ûÊÄß‰ºöÊîπÂèòÈªòËÆ§ÁöÑForeignKeyÂíåManyToManyFieldÁöÑÂ±ïÁ§∫ÊñπÂºèÔºåÂÆÉ‰ºöÂèòÊàê‰∏Ä‰∏™ËæìÂÖ•Ê°ÜÔºåÁî®‰∫éËæìÂÖ•ÂÖ≥ËÅîÂØπË±°ÁöÑ‰∏ªÈîÆid„ÄÇÂØπ‰∫éManyToManyFieldÔºåid‰ª•ÈÄóÂè∑ÂàÜÈöî„ÄÇÂπ∂‰∏îÂÜçËæìÂÖ•Ê°ÜÂè≥‰æßÊèê‰æõ‰∏Ä‰∏™ÊîæÂ§ßÈïúÁöÑÂõæÊ†áÔºå‰Ω†ÂèØ‰ª•ÁÇπÂáªËøõÂÖ•ÈÄâÊã©ÁïåÈù¢„ÄÇ‰æãÂ¶ÇÔºö

    raw_id_fields = ("group",)

‚ö° readonly_fields

ËØ•Â±ûÊÄßÂåÖÂê´ÁöÑÂ≠óÊÆµÂú®È°µÈù¢ÂÜÖÂ∞ÜÂ±ïÁ§∫‰∏∫‰∏çÂèØÁºñËæëÁä∂ÊÄÅ„ÄÇÂÆÉËøòÂèØ‰ª•Â±ïÁ§∫Ê®°ÂûãÊàñËÄÖModelAdminÊú¨Ë∫´ÁöÑÊñπÊ≥ïÁöÑËøîÂõûÂÄºÔºåÁ±ª‰ººModelAdmin.list_displayÁöÑË°å‰∏∫„ÄÇ

ÂèÇËÄÉ‰∏ãÈù¢ÁöÑ‰æãÂ≠êÔºö

    from django.contrib import admin
    from django.utils.html import format_html_join
    from django.utils.safestring import mark_safe

    class PersonAdmin(admin.ModelAdmin):
        readonly_fields = ('address_report',)

        def address_report(self, instance):
            # assuming get_full_address() returns a list of strings
            # for each line of the address and you want to separate each
            # line by a linebreak
            return format_html_join(
                mark_safe('<br/>'),
                '{}',
                ((line,) for line in instance.get_full_address()),
            ) or mark_safe("<span class='errors'>I can't determine this address.</span>")

        # short_description functions like a model field's verbose_name
        address_report.short_description = "Address"

‚ö° save_as

ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂÆÉÁöÑÂÄº‰∏∫False„ÄÇÂ¶ÇÊûúËÆæÁΩÆ‰∏∫TrueÔºåÈÇ£‰πàÂè≥‰∏ãËßíÁöÑ‚ÄúSave and add another‚ÄùÊåâÈíÆÂ∞ÜË¢´ÊõøÊç¢Êàê‚ÄúSave as new‚ÄùÔºåÊÑèÊÄù‰πüÂèòÊàê‰øùÂ≠ò‰∏∫‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±°„ÄÇ

‚ö° save_as_continue

ÈªòËÆ§ÂÄº‰∏∫True, Âú®‰øùÂ≠òÊñ∞ÂØπË±°ÂêéË∑≥ËΩ¨Âà∞ËØ•ÂØπË±°ÁöÑ‰øÆÊîπÈ°µÈù¢„ÄÇ‰ΩÜÊòØÂ¶ÇÊûúËøôÊó∂save_as_continue=FalseÔºåÂàô‰ºöË∑≥ËΩ¨Âà∞ÂÖÉÁ¥†ÂàóË°®È°µÈù¢„ÄÇ

‚ö° save_on_top

ÈªòËÆ§‰∏∫False„ÄÇ ËÆæ‰∏∫TrueÊó∂ÔºåÈ°µÈù¢ÁöÑÈ°∂ÈÉ®‰ºöÊèê‰æõÂêåÊ†∑ÁöÑ‰∏ÄÁ≥ªÂàó‰øùÂ≠òÊåâÈíÆ„ÄÇ

‚ö° show_full_result_count

Áî®‰∫éËÆæÁΩÆÊòØÂê¶ÊòæÁ§∫‰∏Ä‰∏™ËøáÊª§ÂêéÁöÑÂØπË±°ÊÄªÊï∞ÁöÑÊèêÁ§∫‰ø°ÊÅØÔºå‰æãÂ¶Ç‚Äú99 results (103 total)‚Äù„ÄÇÂ¶ÇÊûúÂÆÉË¢´ËÆæÁΩÆ‰∏∫FalseÔºåÈÇ£‰πàÊòæÁ§∫ÁöÑÂ∞ÜÊòØ‚Äú 99 results (Show all)‚Äù„ÄÇ ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂÆÉÁöÑÂÄº‰∏∫TrueÔºåËøôÂ∞Ü‰ºöÂØπÊï¥‰∏™Ë°®ËøõË°å‰∏Ä‰∏™countÊìç‰ΩúÔºåÂú®Ë°®ÂæàÂ§ßÁöÑÊó∂ÂÄôÔºåÂèØËÉΩ‰ºöËÄóË¥π‰∏ÄÂÆöÁöÑÊó∂Èó¥ÂíåËµÑÊ∫ê„ÄÇ

‚ö° view_on_site

Ëøô‰∏™Â±ûÊÄßÂèØ‰ª•ÊéßÂà∂ÊòØÂê¶Âú® admin È°µÈù¢ÊòæÁ§∫‚ÄúView site‚ÄùÈìæÊé•„ÄÇËøô‰∏™ÈìæÊé•‰∏ªË¶ÅÁî®‰∫éË∑≥ËΩ¨Âà∞‰Ω†ÊåáÂÆöÁöÑURLÈ°µÈù¢„ÄÇ

Â±ûÊÄßÁöÑÂÄºÂèØ‰ª•ÊòØÂ∏ÉÂ∞îÂÄºÊàñÊüê‰∏™Ë∞ÉÁî®„ÄÇÂ¶ÇÊûúÊòØTrueÔºàÈªòËÆ§ÂÄºÔºâÔºåÂØπË±°ÁöÑ `get_absolute_url()` ÊñπÊ≥ïÂ∞ÜË¢´Ë∞ÉÁî®Âπ∂ÁîüÊàêrul„ÄÇ

Â¶ÇÊûú‰Ω†ÁöÑÊ®°ÂûãÊúâ‰∏Ä‰∏™ `get_absolute_url()` ÊñπÊ≥ïÔºå‰ΩÜ‰Ω†‰∏çÊÉ≥ÊòæÁ§∫‚ÄúView site‚ÄùÈìæÊé•Ôºå‰Ω†Âè™ÈúÄË¶ÅËÆæÁΩÆ‰∏∫ view_on_site=False„ÄÇ

        view_on_site = False

Â¶ÇÊûúÂ±ûÊÄßÁöÑÂÄºÊòØ‰∏Ä‰∏™Ë∞ÉÁî®ÔºåÂÆÉÂ∞ÜÊé•Êî∂‰∏Ä‰∏™Ê®°ÂûãÂÆû‰æã‰Ωú‰∏∫ÂèÇÊï∞Ôºö

    from django.contrib import admin
    from django.urls import reverse

    class TestAdmin(admin.ModelAdmin):
        def view_on_site(self, obj):
            url = reverse('person-detail', kwargs={'slug': obj.slug})
            return 'https://example.com' + url



## ==‚ö° ModelAdmin ÊñπÊ≥ïÂèÇËÄÉÂàóË°®

    ModelAdmin.add_view(request, form_url='', extra_context=None)[source]
    ModelAdmin.change_view(request, object_id, form_url='', extra_context=None)[source]
    ModelAdmin.changelist_view(request, extra_context=None)[source]
    ModelAdmin.delete_model(request, obj)[source]
    ModelAdmin.delete_queryset(request, queryset)[source]
    ModelAdmin.delete_view(request, object_id, extra_context=None)[source]
    ModelAdmin.formfield_for_choice_field(db_field, request, `**kwargs`)
    ModelAdmin.formfield_for_foreignkey(db_field, request, `**kwargs`)
    ModelAdmin.formfield_for_manytomany(db_field, request, `**kwargs`)
    ModelAdmin.get_autocomplete_fields(request)
    ModelAdmin.get_changeform_initial_data(request)[source]
    ModelAdmin.get_changelist(request, `**kwargs`)[source]
    ModelAdmin.get_changelist_form(request, `**kwargs`)[source]
    ModelAdmin.get_changelist_formset(request, `**kwargs`)[source]
    ModelAdmin.get_deleted_objects(objs, request)[source]
    ModelAdmin.get_exclude(request, obj=None)
    ModelAdmin.get_fields(request, obj=None)
    ModelAdmin.get_fieldsets(request, obj=None)
    ModelAdmin.get_form(request, obj=None, `**kwargs`)[source]
    ModelAdmin.get_formsets_with_inlines(request, obj=None)[source]
    ModelAdmin.get_inline_instances(request, obj=None)[source]
    ModelAdmin.get_list_display(request)[source]
    ModelAdmin.get_list_display_links(request, list_display)[source]
    ModelAdmin.get_list_filter(request)[source]
    ModelAdmin.get_list_select_related(request)[source]
    ModelAdmin.get_ordering(request)
    ModelAdmin.get_paginator(request, queryset, per_page, orphans=0, allow_empty_first_page=True)[source]
    ModelAdmin.get_prepopulated_fields(request, obj=None)
    ModelAdmin.get_queryset(request)
    ModelAdmin.get_readonly_fields(request, obj=None)
    ModelAdmin.get_search_fields(request)[source]
    ModelAdmin.get_search_results(request, queryset, search_term)[source]
    ModelAdmin.get_sortable_by(request)
    ModelAdmin.get_urls()[source]
    ModelAdmin.has_add_permission(request)
    ModelAdmin.has_change_permission(request, obj=None)
    ModelAdmin.has_delete_permission(request, obj=None)
    ModelAdmin.has_module_permission(request)
    ModelAdmin.has_view_permission(request, obj=None)
    ModelAdmin.history_view(request, object_id, extra_context=None)[source]
    ModelAdmin.lookup_allowed(lookup, value)
    ModelAdmin.message_user(request, message, level=messages.INFO, extra_tags='', fail_silently=False)[source]
    ModelAdmin.response_add(request, obj, post_url_continue=None)[source]
    ModelAdmin.response_change(request, obj)[source]
    ModelAdmin.response_delete(request, obj_display, obj_id)[source]
    ModelAdmin.save_formset(request, form, formset, change)[source]
    ModelAdmin.save_related(request, form, formsets, change)[source]


## ==‚ö° Nginx uwsgi ÈÖçÁΩÆ
[Python with UWSGI](https://www.runoob.com/python3/python-uwsgi.html)

‰ΩøÁî® python manage.py runserver Êù•ËøêË°åÊúçÂä°Âô®Âè™ÈÄÇÁî®ÊµãËØïÁéØÂ¢É‰∏≠‰ΩøÁî®„ÄÇÊ≠£ÂºèÂèëÂ∏ÉÁöÑÊúçÂä°ÔºåÊàë‰ª¨ÈúÄË¶Å‰∏Ä‰∏™ÂèØ‰ª•Á®≥ÂÆöËÄåÊåÅÁª≠ÁöÑÊúçÂä°Âô®ÔºåÊØîÂ¶Ç apache, Nginx, lighttpdÁ≠âÔºå‰ª• Nginx ‰∏∫‰æã„ÄÇ


Centos ‰∏ãÂÆâË£ÖÂü∫Á°ÄÂºÄÂèëÂåÖÊ≠•È™§Â¶Ç‰∏ãÔºö

    yum groupinstall "Development tools"
    yum install zlib-devel bzip2-devel pcre-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel

CentOS Ëá™Â∏¶ Python 2.4.3Ôºå‰ΩÜÊàë‰ª¨ÂèØ‰ª•ÂÜçÂÆâË£Ö Python2.7.5Ôºö

    cd ~
    wget http://python.org/ftp/python/2.7.5/Python-2.7.5.tar.bz2
    tar xvf Python-2.7.5.tar.bz2
    cd Python-2.7.5
    ./configure --prefix=/usr/local
    make && make altinstall

ÂÆâË£Ö Python ÂåÖÁÆ°ÁêÜÂ∑•ÂÖ∑

ÂÆâË£Ö easy_install Ê≠•È™§:

    cd ~
    wget https://pypi.python.org/packages/source/d/distribute/distribute-0.6.49.tar.gz
    tar xf distribute-0.6.49.tar.gz
    cd distribute-0.6.49
    python2.7 setup.py install
    easy_install --version

‰πüÂèØÊòØ‰ΩøÁî® pip ÂåÖÁÆ°ÁêÜ: https://pypi.python.org/pypi/pip

ÂÆâË£Ö pip ÁöÑÂ•ΩÂ§ÑÊòØÂèØ‰ª•Áî® pip list„ÄÅpip uninstall ÁÆ°ÁêÜ Python ÂåÖÔºåeasy_install Ê≤°ÊúâËøô‰∏™ÂäüËÉΩÔºåÂè™Êúâ uninstall„ÄÇ


ÂÆâË£Ö uwsgi

uwsgi:https://pypi.python.org/pypi/uWSGI
uwsgi ÂèÇÊï∞ËØ¶Ëß£Ôºöhttp://uwsgi-docs.readthedocs.org/en/latest/Options.html


    pip install uwsgi
    uwsgi --version    # Êü•Áúã uwsgi ÁâàÊú¨

ÊµãËØï uwsgi ÊòØÂê¶Ê≠£Â∏∏Ôºö

Êñ∞Âª∫ test.py Êñá‰ª∂ÔºåÂÜÖÂÆπÂ¶Ç‰∏ãÔºö

    def application(env, start_response):
        start_response('200 OK', [('Content-Type','text/html')])
        return "Hello World"

ÁÑ∂ÂêéÂú®ÁªàÁ´ØËøêË°åÔºö

    uwsgi --http :8001 --wsgi-file test.py

Âú®ÊµèËßàÂô®ÂÜÖËæìÂÖ•Ôºöhttp://127.0.0.1:8001ÔºåÊü•ÁúãÊòØÂê¶Êúâ"Hello World"ËæìÂá∫ÔºåËã•Ê≤°ÊúâËæìÂá∫ÔºåËØ∑Ê£ÄÊü•‰Ω†ÁöÑÂÆâË£ÖËøáÁ®ã„ÄÇ

ÂÆâË£Ö Django

    pip install django

ÊµãËØï django ÊòØÂê¶Ê≠£Â∏∏ÔºåËøêË°åÔºö

    django-admin.py startproject demosite
    cd demosite
    python2.7 manage.py runserver 0.0.0.0:8002

Âú®ÊµèËßàÂô®ÂÜÖËæìÂÖ•Ôºöhttp://127.0.0.1:8002ÔºåÊ£ÄÊü•djangoÊòØÂê¶ËøêË°åÊ≠£Â∏∏„ÄÇ

ÂÆâË£Ö Nginx

    cd ~
    wget http://nginx.org/download/nginx-1.5.6.tar.gz
    tar xf nginx-1.5.6.tar.gz
    cd nginx-1.5.6
    ./configure --prefix=/usr/local/nginx-1.5.6 \
    --with-http_stub_status_module \
    --with-http_gzip_static_module
    make && make install

uwsgi ÈÖçÁΩÆ

uwsgiÊîØÊåÅini„ÄÅxmlÁ≠âÂ§öÁßçÈÖçÁΩÆÊñπÂºèÔºåÊú¨Êñá‰ª• ini ‰∏∫‰æãÔºå Âú®/etc/ÁõÆÂΩï‰∏ãÊñ∞Âª∫uwsgi9090.iniÔºåÊ∑ªÂä†Â¶Ç‰∏ãÈÖçÁΩÆÔºö

    [uwsgi]
    socket = 127.0.0.1:9090
    master = true         //‰∏ªËøõÁ®ã
    vhost = true          //Â§öÁ´ôÊ®°Âºè
    no-site = true        //Â§öÁ´ôÊ®°ÂºèÊó∂‰∏çËÆæÁΩÆÂÖ•Âè£Ê®°ÂùóÂíåÊñá‰ª∂
    workers = 2           //Â≠êËøõÁ®ãÊï∞
    reload-mercy = 10     
    vacuum = true         //ÈÄÄÂá∫„ÄÅÈáçÂêØÊó∂Ê∏ÖÁêÜÊñá‰ª∂
    max-requests = 1000   
    limit-as = 512
    buffer-size = 30000
    pidfile = /var/run/uwsgi9090.pid    //pidÊñá‰ª∂ÔºåÁî®‰∫é‰∏ãÈù¢ÁöÑËÑöÊú¨ÂêØÂä®„ÄÅÂÅúÊ≠¢ËØ•ËøõÁ®ã
    daemonize = /website/uwsgi9090.log

Nginx ÈÖçÁΩÆ

ÊâæÂà∞nginxÁöÑÂÆâË£ÖÁõÆÂΩïÔºàÂ¶ÇÔºö/usr/local/nginx/ÔºâÔºåÊâìÂºÄconf/nginx.confÊñá‰ª∂Ôºå‰øÆÊîπserverÈÖçÁΩÆÔºö

    server {
        listen       80;
        server_name  localhost;
        
        location / {            
            include  uwsgi_params;
            uwsgi_pass  127.0.0.1:9090;              //ÂøÖÈ°ªÂíåuwsgi‰∏≠ÁöÑËÆæÁΩÆ‰∏ÄËá¥
            uwsgi_param UWSGI_SCRIPT demosite.wsgi;  //ÂÖ•Âè£Êñá‰ª∂ÔºåÂç≥wsgi.pyÁõ∏ÂØπ‰∫éÈ°πÁõÆÊ†πÁõÆÂΩïÁöÑ‰ΩçÁΩÆÔºå‚Äú.‚ÄùÁõ∏ÂΩì‰∫é‰∏ÄÂ±ÇÁõÆÂΩï
            uwsgi_param UWSGI_CHDIR /demosite;       //È°πÁõÆÊ†πÁõÆÂΩï
            index  index.html index.htm;
            client_max_body_size 35m;
        }
    }

ËÆæÁΩÆÂÆåÊàêÂêéÔºåÂú®ÁªàÁ´ØËøêË°åÔºö

    uwsgi --ini /etc/uwsgi9090.ini &
    /usr/local/nginx/sbin/nginx

Âú®ÊµèËßàÂô®ËæìÂÖ•Ôºöhttp://127.0.0.1Ôºå‰Ω†Â∞±ÂèØ‰ª•ÁúãÂà∞ django ÁöÑ "It work" ‰∫Ü„ÄÇ




# =üö© keeprunning.py

ÈúÄÊ±ÇÔºöÁé∞ÊúâÁà¨Ëô´Á®ãÂ∫èÔºàÂêç‰∏∫CNSubAllIndÔºâÔºåÈúÄË¶Å‰ΩøÂÖ∂‰∏ÄÁõ¥‰øùÊåÅÂú®ÂêéÂè∞ËøêË°åÔºàÂ¶ÇÊûúÊâßË°åÂÆåÊØïÔºåÁ´ãÂç≥ÈáçÊñ∞ÂêØÂä®ÔºåÁªßÁª≠ÊâßË°åÔºâÔºåÂπ∂ËÆ∞ÂΩïÂÖ∂ËøêË°åÊó•Âøó„ÄÇ

Âà©Áî®pythonÁöÑloggingÊ®°ÂùóÊù•ËÆ∞ÂΩïÊó•ÂøóÔºåÂà©Áî®subprocessÊ®°ÂùóÊù•ÂíåÁ≥ªÁªü‰∫§‰∫íÊâßË°åÂëΩ‰ª§ÔºåÊ£ÄÊµãÂà∞Â≠êÁ®ãÂ∫èÁªìÊùüËøêË°å‰πãÂêéÔºåÈáçÊñ∞ÂºÄÂêØÂ≠êÁ®ãÂ∫è„ÄÇ

keeprunning.py(CNSubAllIndÂ∞±ÊòØÈúÄË¶Å‰øùÊåÅÂú®ÂêéÂè∞ËøêË°åÁöÑÁ®ãÂ∫è)Ôºö

    # -*- coding: UTF-8 -*-
    #!DATE: 2018/10/9
    #!@Author: yingying
    #keeprunning.py
    import os
    import subprocess

    # logging
    # require python2.6.6 and later
    import logging
    from logging.handlers import RotatingFileHandler

    ## log settings: SHOULD BE CONFIGURED BY config
    LOG_PATH_FILE = "D:\workspace\PyCharmProject\CompanyInfoSpider\my_service_mgr.log"
    LOG_MODE = 'a'
    LOG_MAX_SIZE = 10 * 1024 * 1024  # 10M per file
    LOG_MAX_FILES = 10  # 10 Files: my_service_mgr.log.1, printmy_service_mgrlog.2, ...
    LOG_LEVEL = logging.DEBUG

    LOG_FORMAT = "%(asctime)s %(levelname)-10s[%(filename)s:%(lineno)d(%(funcName)s)] %(message)s"

    handler = RotatingFileHandler(LOG_PATH_FILE, LOG_MODE, LOG_MAX_SIZE, LOG_MAX_FILES)
    formatter = logging.Formatter(LOG_FORMAT)
    handler.setFormatter(formatter)

    Logger = logging.getLogger()
    Logger.setLevel(LOG_LEVEL)
    Logger.addHandler(handler)

    # color output
    #
    pid = os.getpid()


    def print_error(s):
        print '\033[31m[%d: ERROR] %s\033[31;m' % (pid, s)


    def print_info(s):
        print '\033[32m[%d: INFO] %s\033[32;m' % (pid, s)


    def print_warning(s):
        print '\033[33m[%d: WARNING] %s\033[33;m' % (pid, s)


    def start_child_proc(command, merged):
        try:
            if command is None:
                raise OSError, "Invalid command"

            child = None
            if merged is True:
                # merge stdout and stderr
                child = subprocess.Popen(command)
                # child = subprocess.Popen(command,
                #                          stderr=subprocess.STDOUT,  # Ë°®Á§∫Â≠êËøõÁ®ãÁöÑÊ†áÂáÜÈîôËØØ‰πüËæìÂá∫Âà∞Ê†áÂáÜËæìÂá∫
                #                          stdout=subprocess.PIPE  # Ë°®Á§∫ÈúÄË¶ÅÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÁÆ°ÈÅì
                #                          )
            else:
                # DO NOT merge stdout and stderr
                child = subprocess.Popen(command)
                # child = subprocess.Popen(command,
                #                          stderr=subprocess.PIPE,
                #                          stdout=subprocess.PIPE)
            return child
        except subprocess.CalledProcessError:
            pass  # handle errors in the called executable
        except OSError:
            raise OSError, "Failed to run command!"


    def run_forever(command):
        print_info("start child process with command: " + ' '.join(command))
        Logger.info("start child process with command: " + ' '.join(command))

        merged = False
        child = start_child_proc(command, merged)

        failover = 0

        while True:
            while child.poll() != None:
                failover = failover + 1
                print_warning("child process shutdown with return code: " + str(child.returncode))
                Logger.critical("child process shutdown with return code: " + str(child.returncode))

                print_warning("restart child process again, times=%d" % failover)
                Logger.info("restart child process again, times=%d" % failover)
                child = start_child_proc(command, merged)

            # read child process stdout and log it
            out, err = child.communicate()
            returncode = child.returncode
            if returncode != 0:
                for errorline in err.slitlines():
                    Logger.info(errorline)
            else:
                Logger.info("execute child process failed")

        Logger.exception("!!!should never run to this!!!")


    if __name__ == "__main__":
        run_forever(['scrapy', 'crawl', 'CNSubAllInd'])

windows‰∏≠ËøêË°åÊñπÂºèÔºöÂú®ÂëΩ‰ª§Ë°å‰∏≠ËæìÂÖ•start pythonw keeprunning.pyÂëΩ‰ª§Ôºå‰πãÂêé‰æø‰ºöÊâìÂºÄpythonwÁ™óÂè£Â¶Ç‰∏ãÔºö

Ê≥®ÊÑèÔºöËøô‰∏™Á™óÂè£ÊòØÂÖ≥‰∏çÊéâÁöÑÔºåÂõ†‰∏∫ÊúâkeeprunningÂú®ÂêéÂè∞ËøêË°åÔºå‰∏ÄÊó¶Ê£ÄÊµãÂà∞Áà¨Ëô´Á®ãÂ∫èÁªìÊùü‰∫ÜÔºåÂ∞±‰ºöÈáçÊñ∞ÊâìÂºÄ‰∏Ä‰∏™Á™óÂè£Ôºà‰πüÂç≥ÈáçÊñ∞ÂºÄÂêØÁ®ãÂ∫èÔºâ„ÄÇÊÉ≥Ë¶ÅÂÖ≥Èó≠ÁöÑËØùÔºåÂè™ËÉΩÂú®‰ªªÂä°ÁÆ°ÁêÜÂô®‰∏≠ÂÖ≥Èó≠pythonw.exeÁ®ãÂ∫èÔºå‰æøÂÅúÊ≠¢‰∫ÜÁõëÊéßÔºåÂΩìÂâçÁà¨Ëô´Á®ãÂ∫èÊâßË°åÂÆåÊØï‰πãÂêé‰æøÁªìÊùüÁà¨Ëô´„ÄÇ




# =üö© logging

logging Êèê‰æõ‰∫Ü‰∏ÄÁªÑ‰æøÂà©ÁöÑÊó•ÂøóÂáΩÊï∞ÔºåÂÆÉ‰ª¨ÂàÜÂà´ÊòØÔºö`debug()`„ÄÅ `info()`„ÄÅ `warning()`„ÄÅ `error()` Âíå `critical()`„ÄÇloggingÂáΩÊï∞Ê†πÊçÆÂÆÉ‰ª¨Áî®Êù•Ë∑üË∏™ÁöÑ‰∫ã‰ª∂ÁöÑÁ∫ßÂà´Êàñ‰∏•ÈáçÁ®ãÂ∫¶Êù•ÂëΩÂêç„ÄÇ

ÊØè‰∏™Á∫ßÂà´ÂØπÂ∫îÁöÑÊï∞Â≠óÂÄº‰∏∫ CRITICALÔºö50ÔºåERRORÔºö40ÔºåWARNINGÔºö30ÔºåINFOÔºö20ÔºåDEBUGÔºö10ÔºåNOTSETÔºö0„ÄÇ

    import logging

    logging.debug('A Debug')
    logging.info('C Information')
    logging.warning('B Warning!')

Python ‰∏≠Êó•ÂøóÁöÑÈªòËÆ§ÊòæÁ§∫Á≠âÁ∫ßÊòØ WARNINGÔºåDEBUG Âíå INFO Á∫ßÂà´ÁöÑÊó•ÂøóÂ∞Ü‰∏ç‰ºöÂæóÂà∞ÊòæÁ§∫ÔºåÂú® logging.basicConfig ‰∏≠ÁöÑ level ÂèÇÊï∞Êõ¥ÊîπËÆæÁΩÆÔºåfilename ÂèØ‰ª•ËÆæÁΩÆÊó•ÂøóËæìÂá∫Êñá‰ª∂ÔºåÂÜôÂÖ•Ê®°Âºè filemode ‰∏ÄËà¨ËÆæÁΩÆ append Â∞±ÂèØ‰ª•„ÄÇ

    logging.basicConfig(level=logging.DEBUG, filename='coder.log', filemode='a')


Êó•ÂøóÊ®°ÂùóÊèê‰æõ‰∫ÜÂõõÂ§ßÁªÑ‰ª∂ loggers„ÄÅhandlers„ÄÅfilters Âíå formatters„ÄÇ logger ÊòØÊó•ÂøóÊé•Âè£ÔºåÁúüÊ≠£Â§ÑÁêÜËæìÂá∫ÁöÑÊòØÂ§ÑÁêÜÂô® handlerÔºåËøòÂèØ‰ª•‰ΩøÁî®ËøáÊª§Âô® filter ÂíåÊ†ºÂºèÂåñ formatter ÂØπË¶ÅËæìÂá∫ÁöÑÊó•ÂøóÂÜÖÂÆπÂÅöËøáÊª§ÂíåÊ†ºÂºèÂåñÁ≠âÂ§ÑÁêÜÊìç‰Ωú„ÄÇ

Logger ÂØπË±°Êúâ3‰∏™Â∑•‰ΩúË¶ÅÂÅöÔºö

1ÔºâÂêëÂ∫îÁî®Á®ãÂ∫è‰ª£Á†ÅÊö¥Èú≤Âá†‰∏™ÊñπÊ≥ïÔºå‰ΩøÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•Âú®ËøêË°åÊó∂ËÆ∞ÂΩïÊó•ÂøóÊ∂àÊÅØÔºõ
2ÔºâÂü∫‰∫éÊó•Âøó‰∏•ÈáçÁ≠âÁ∫ßÔºàÈªòËÆ§ÁöÑËøáÊª§ËÆæÊñΩÔºâÊàñfilterÂØπË±°Êù•ÂÜ≥ÂÆöË¶ÅÂØπÂì™‰∫õÊó•ÂøóËøõË°åÂêéÁª≠Â§ÑÁêÜÔºõ
3ÔºâÂ∞ÜÊó•ÂøóÊ∂àÊÅØ‰º†ÈÄÅÁªôÊâÄÊúâÊÑüÂÖ¥Ë∂£ÁöÑÊó•Âøóhandlers„ÄÇ

`Logger.setLevel()`

ÂÜÖÂª∫Á≠âÁ∫ß‰∏≠ÔºåÁ∫ßÂà´ÊúÄ‰ΩéÁöÑÊòØ DEBUGÔºåÁ∫ßÂà´ÊúÄÈ´òÁöÑÊòØ CRITICAL„ÄÇ‰æãÂ¶Ç setLevel(logging.INFO)ÔºåÊ≠§Êó∂ÂáΩÊï∞ÂèÇÊï∞‰∏∫INFOÔºåÂè™‰ºöÂ§ÑÁêÜINFO„ÄÅWARNING„ÄÅERRORÂíåCRITICALÁ∫ßÂà´ÁöÑÊó•ÂøóÔºåËÄåDEBUGÁ∫ßÂà´ÁöÑÊ∂àÊÅØÂ∞Ü‰ºöË¢´ÂøΩÁï•/‰∏¢ÂºÉ„ÄÇ

`logging.getLogger()`

Ëé∑Âèñ Logger ÂØπË±°ÔºåËøòÊúâ‰∏ÄÁßçÊñπÂºèÊòØÈÄöËøá Logger Á±ªÁöÑÂÆû‰æãÂåñÊñπÊ≥ïÂàõÂª∫‰∏Ä‰∏™ÂÆû‰æã„ÄÇÊñπÊ≥ïÊúâ‰∏Ä‰∏™ÂèØÈÄâÂèÇÊï∞ name Ë°®Á§∫Â∞ÜË¶ÅËøîÂõûÁöÑÊó•ÂøóÂô®ÁöÑÂêçÁß∞Ê†áËØÜÔºåÂ¶ÇÊûú‰∏çÊèê‰æõËØ•ÂèÇÊï∞ÔºåÂàôÂÖ∂ÂÄº‰∏∫'root'„ÄÇËã•‰ª•Áõ∏ÂêåÁöÑ name Ë∞ÉÁî® `getLogger()` ÊñπÊ≥ïÔºåÊÄªÊòØËøîÂõûÂêå‰∏Ä‰∏™ logger ÂØπË±°ÁöÑÂºïÁî®„ÄÇ

Handler

HandlerÂØπË±°ÁöÑ‰ΩúÁî®ÊòØÔºàÂü∫‰∫éÊó•ÂøóÊ∂àÊÅØÁöÑlevelÔºâÂ∞ÜÊ∂àÊÅØÂàÜÂèëÂà∞handlerÊåáÂÆöÁöÑ‰ΩçÁΩÆÔºàÊñá‰ª∂„ÄÅÁΩëÁªú„ÄÅÈÇÆ‰ª∂Á≠âÔºâ„ÄÇLoggerÂØπË±°ÂèØ‰ª•ÈÄöËøáaddHandler()ÊñπÊ≥ï‰∏∫Ëá™Â∑±Ê∑ªÂä†0‰∏™ÊàñËÄÖÊõ¥Â§ö‰∏™handlerÂØπË±°„ÄÇÊØîÂ¶ÇÔºå‰∏Ä‰∏™Â∫îÁî®Á®ãÂ∫èÂèØËÉΩÊÉ≥Ë¶ÅÂÆûÁé∞‰ª•‰∏ãÂá†‰∏™Êó•ÂøóÈúÄÊ±ÇÔºö

1ÔºâÊääÊâÄÊúâÊó•ÂøóÈÉΩÂèëÈÄÅÂà∞‰∏Ä‰∏™Êó•ÂøóÊñá‰ª∂‰∏≠Ôºõ
2ÔºâÊääÊâÄÊúâ‰∏•ÈáçÁ∫ßÂà´Â§ß‰∫éÁ≠â‰∫éerrorÁöÑÊó•ÂøóÂèëÈÄÅÂà∞stdoutÔºàÊ†áÂáÜËæìÂá∫ÔºâÔºõ
3ÔºâÊääÊâÄÊúâ‰∏•ÈáçÁ∫ßÂà´‰∏∫criticalÁöÑÊó•ÂøóÂèëÈÄÅÂà∞‰∏Ä‰∏™emailÈÇÆ‰ª∂Âú∞ÂùÄ„ÄÇ

ËøôÁßçÂú∫ÊôØÂ∞±ÈúÄË¶Å3‰∏™‰∏çÂêåÁöÑhandlersÔºåÊØè‰∏™handlerÂ§çÊùÇÂèëÈÄÅ‰∏Ä‰∏™ÁâπÂÆö‰∏•ÈáçÁ∫ßÂà´ÁöÑÊó•ÂøóÂà∞‰∏Ä‰∏™ÁâπÂÆöÁöÑ‰ΩçÁΩÆ„ÄÇ

‰∏Ä‰∏™handler‰∏≠Âè™ÊúâÈùûÂ∏∏Â∞ëÊï∞ÁöÑÊñπÊ≥ïÊòØÈúÄË¶ÅÂ∫îÁî®ÂºÄÂèë‰∫∫ÂëòÂéªÂÖ≥ÂøÉÁöÑ„ÄÇÂØπ‰∫é‰ΩøÁî®ÂÜÖÂª∫handlerÂØπË±°ÁöÑÂ∫îÁî®ÂºÄÂèë‰∫∫ÂëòÊù•ËØ¥Ôºå‰ºº‰πéÂîØ‰∏ÄÁõ∏ÂÖ≥ÁöÑhandlerÊñπÊ≥ïÂ∞±ÊòØ‰∏ãÈù¢ËøôÂá†‰∏™ÈÖçÁΩÆÊñπÊ≥ï `Handler.setLevel()`„ÄÅ `Handler.setFormatter()`„ÄÅ `Handler.addFilter()`„ÄÅ `Handler.removeFilter()`„ÄÇ

ÈúÄË¶ÅËØ¥ÊòéÁöÑÊòØÔºåÂ∫îÁî®Á®ãÂ∫è‰ª£Á†Å‰∏çÂ∫îËØ•Áõ¥Êé•ÂÆû‰æãÂåñÂíå‰ΩøÁî®HandlerÂÆû‰æã„ÄÇÂõ†‰∏∫HandlerÊòØ‰∏Ä‰∏™Âü∫Á±ªÔºåÂÆÉÂè™ÂÆö‰πâ‰∫ÜÁ¥†ÊúâhandlersÈÉΩÂ∫îËØ•ÊúâÁöÑÊé•Âè£ÔºåÂêåÊó∂Êèê‰æõ‰∫Ü‰∏Ä‰∫õÂ≠êÁ±ªÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ÊàñË¶ÜÁõñÁöÑÈªòËÆ§Ë°å‰∏∫„ÄÇ


Formater

FormaterÂØπË±°Áî®‰∫éÈÖçÁΩÆÊó•Âøó‰ø°ÊÅØÁöÑÊúÄÁªàÈ°∫Â∫è„ÄÅÁªìÊûÑÂíåÂÜÖÂÆπ„ÄÇ‰∏élogging.HandlerÂü∫Á±ª‰∏çÂêåÁöÑÊòØÔºåÂ∫îÁî®‰ª£Á†ÅÂèØ‰ª•Áõ¥Êé•ÂÆû‰æãÂåñFormatterÁ±ª„ÄÇÂè¶Â§ñÔºåÂ¶ÇÊûú‰Ω†ÁöÑÂ∫îÁî®Á®ãÂ∫èÈúÄË¶Å‰∏Ä‰∫õÁâπÊÆäÁöÑÂ§ÑÁêÜË°å‰∏∫Ôºå‰πüÂèØ‰ª•ÂÆûÁé∞‰∏Ä‰∏™FormatterÁöÑÂ≠êÁ±ªÊù•ÂÆåÊàê„ÄÇ 

FormatterÁ±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ïÂÆö‰πâÂ¶Ç‰∏ãÔºö

    logging.Formatter.__init__(fmt=None, datefmt=None, style='%')

ËØ•ÊûÑÈÄ†ÊñπÊ≥ïÊé•Êî∂3‰∏™ÂèØÈÄâÂèÇÊï∞Ôºö

fmtÔºöÊåáÂÆöÊ∂àÊÅØÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÔºåÂ¶ÇÊûú‰∏çÊåáÂÆöËØ•ÂèÇÊï∞ÂàôÈªòËÆ§‰ΩøÁî®messageÁöÑÂéüÂßãÂÄº
datefmtÔºöÊåáÂÆöÊó•ÊúüÊ†ºÂºèÂ≠óÁ¨¶‰∏≤ÔºåÂ¶ÇÊûú‰∏çÊåáÂÆöËØ•ÂèÇÊï∞ÂàôÈªòËÆ§‰ΩøÁî®"%Y-%m-%d %H:%M:%S"
styleÔºöPython 3.2Êñ∞Â¢ûÁöÑÂèÇÊï∞ÔºåÂèØÂèñÂÄº‰∏∫ '%', '{'Âíå '$'ÔºåÂ¶ÇÊûú‰∏çÊåáÂÆöËØ•ÂèÇÊï∞ÂàôÈªòËÆ§‰ΩøÁî®'%'


Filter

FilterÂèØ‰ª•Ë¢´HandlerÂíåLoggerÁî®Êù•ÂÅöÊØîlevelÊõ¥ÁªÜÁ≤íÂ∫¶ÁöÑ„ÄÅÊõ¥Â§çÊùÇÁöÑËøáÊª§ÂäüËÉΩ„ÄÇFilterÊòØ‰∏Ä‰∏™ËøáÊª§Âô®Âü∫Á±ªÔºåÂÆÉÂè™ÂÖÅËÆ∏Êüê‰∏™loggerÂ±ÇÁ∫ß‰∏ãÁöÑÊó•Âøó‰∫ã‰ª∂ÈÄöËøáËøáÊª§„ÄÇËØ•Á±ªÂÆö‰πâÂ¶Ç‰∏ãÔºö

    class logging.Filter(name='')
        filter(record)

ÊØîÂ¶ÇÔºå‰∏Ä‰∏™filterÂÆû‰æãÂåñÊó∂‰º†ÈÄíÁöÑnameÂèÇÊï∞ÂÄº‰∏∫'A.B'ÔºåÈÇ£‰πàËØ•filterÂÆû‰æãÂ∞ÜÂè™ÂÖÅËÆ∏ÂêçÁß∞‰∏∫Á±ª‰ººÂ¶Ç‰∏ãËßÑÂàôÁöÑloggers‰∫ßÁîüÁöÑÊó•ÂøóËÆ∞ÂΩïÈÄöËøáËøáÊª§Ôºö'A.B'Ôºå'A.B,C'Ôºå'A.B.C.D'Ôºå'A.B.D'ÔºåËÄåÂêçÁß∞‰∏∫'A.BB', 'B.A.B'ÁöÑloggers‰∫ßÁîüÁöÑÊó•ÂøóÂàô‰ºöË¢´ËøáÊª§Êéâ„ÄÇÂ¶ÇÊûúnameÁöÑÂÄº‰∏∫Á©∫Â≠óÁ¨¶‰∏≤ÔºåÂàôÂÖÅËÆ∏ÊâÄÊúâÁöÑÊó•Âøó‰∫ã‰ª∂ÈÄöËøáËøáÊª§„ÄÇ

filterÊñπÊ≥ïÁî®‰∫éÂÖ∑‰ΩìÊéßÂà∂‰º†ÈÄíÁöÑrecordËÆ∞ÂΩïÊòØÂê¶ËÉΩÈÄöËøáËøáÊª§ÔºåÂ¶ÇÊûúËØ•ÊñπÊ≥ïËøîÂõûÂÄº‰∏∫0Ë°®Á§∫‰∏çËÉΩÈÄöËøáËøáÊª§ÔºåËøîÂõûÂÄº‰∏∫Èùû0Ë°®Á§∫ÂèØ‰ª•ÈÄöËøáËøáÊª§„ÄÇ

ËØ¥ÊòéÔºö

Â¶ÇÊûúÊúâÈúÄË¶ÅÔºå‰πüÂèØ‰ª•Âú®filter(record)ÊñπÊ≥ïÂÜÖÈÉ®ÊîπÂèòËØ•recordÔºåÊØîÂ¶ÇÊ∑ªÂä†„ÄÅÂà†Èô§Êàñ‰øÆÊîπ‰∏Ä‰∫õÂ±ûÊÄß„ÄÇ
Êàë‰ª¨ËøòÂèØ‰ª•ÈÄöËøáfilterÂÅö‰∏Ä‰∫õÁªüËÆ°Â∑•‰ΩúÔºåÊØîÂ¶ÇÂèØ‰ª•ËÆ°ÁÆó‰∏ãË¢´‰∏Ä‰∏™ÁâπÊÆäÁöÑloggerÊàñhandlerÊâÄÂ§ÑÁêÜÁöÑrecordÊï∞ÈáèÁ≠â„ÄÇ


    import os
    import logging
    import uuid
    from logging import Handler, FileHandler, StreamHandler


    class PathFileHandler(FileHandler):
        def __init__(self, path, filename, mode='a', encoding=None, delay=False):

            filename = os.fspath(filename)
            if not os.path.exists(path):
                os.mkdir(path)
            self.baseFilename = os.path.join(path, filename)
            self.mode = mode
            self.encoding = encoding
            self.delay = delay
            if delay:
                Handler.__init__(self)
                self.stream = None
            else:
                StreamHandler.__init__(self, self._open())


    class Loggers(object):
        # Êó•ÂøóÁ∫ßÂà´ÂÖ≥Á≥ªÊò†Â∞Ñ
        level_relations = {
            'debug': logging.DEBUG, 'info': logging.INFO, 'warning': logging.WARNING,
            'error': logging.ERROR, 'critical': logging.CRITICAL
        }

        def __init__(self, filename='{uid}.log'.format(uid=uuid.uuid4()), level='info', log_dir='log',
                     fmt='%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s'):
            self.logger = logging.getLogger(filename)
            abspath = os.path.dirname(os.path.abspath(__file__))
            self.directory = os.path.join(abspath, log_dir)
            format_str = logging.Formatter(fmt)  # ËÆæÁΩÆÊó•ÂøóÊ†ºÂºè
            self.logger.setLevel(self.level_relations.get(level))  # ËÆæÁΩÆÊó•ÂøóÁ∫ßÂà´
            stream_handler = logging.StreamHandler()  # ÂæÄÂ±èÂπï‰∏äËæìÂá∫
            stream_handler.setFormatter(format_str)
            file_handler = PathFileHandler(path=self.directory, filename=filename, mode='a')
            file_handler.setFormatter(format_str)
            self.logger.addHandler(stream_handler)
            self.logger.addHandler(file_handler)


    if __name__ == "__main__":
        txt = "ÂÖ≥Ê≥®ÂÖ¨‰ºóÂè∑„ÄêËøõÂáªÁöÑ Coder„ÄëÔºåÂõûÂ§ç„ÄéÊó•Âøó‰ª£Á†Å„ÄèÂèØ‰ª•È¢ÜÂèñÊñáÁ´†‰∏≠ÂÆåÊï¥ÁöÑ‰ª£Á†Å‰ª•ÂèäÊµÅÁ®ãÂõæ"
        log = Loggers(level='debug')
        log.logger.info(4)
        log.logger.info(5)
        log.logger.info(txt)



# =üö© WSGI & WEB

Introduction ‚Äî WSGI Tutorial - http://wsgi.tutorial.codepoint.net/
uWSGIÈ°πÁõÆ ‚Äî uWSGI 2.0 ÊñáÊ°£ https://uwsgi-docs-zh.readthedocs.io/zh_CN/latest/
Quickstart for Python/WSGI ‚Äî https://uwsgi-docs.readthedocs.io/en/latest/WSGIquickstart.html
Frameworks that run on WSGI ‚Äî https://wsgi.readthedocs.io/en/latest/frameworks.html
Python WSGIÁöÑÊ∑±ÂÖ•ÁêÜËß£ - https://www.jb51.net/article/144862.htm
WSGI & uwsgi ¬∑ rainybowe - http://www.rainybowe.com/blog/2017/01/04/WSGI&uwsgi/index.html
Ê¨¢ËøéËøõÂÖ•FlaskÂ§ßÂûãÊïôÁ®ãÈ°πÁõÆÔºÅ - http://www.pythondoc.com/flask-mega-tutorial/

WSGI - Web Server Gateway Interface ËßÑËåÉÔºåÊèèËø∞ web server Â¶Ç‰Ωï‰∏é web application ÈÄö‰ø°ÁöÑËßÑËåÉÔºåPEP 3333 ‰∏≠ÊúâÂÖ∑‰ΩìÊèèËø∞„ÄÇ

Ë¶ÅÂÆûÁé∞ WSGI ÂçèËÆÆÔºåÂøÖÈ°ªÂêåÊó∂ÂÆûÁé∞ web server Âíå web applicationÔºåÂΩìÂâçËøêË°åÂú® WSGI ÂçèËÆÆ‰πã‰∏äÁöÑ web Ê°ÜÊû∂Êúâ Bottle, Flask, Django„ÄÇ

uwsgiÔºö‰∏é WSGI ‰∏ÄÊ†∑ÊòØ‰∏ÄÁßçÈÄö‰ø°ÂçèËÆÆÔºåÊòØuWSGIÊúçÂä°Âô®ÁöÑÁã¨Âç†ÂçèËÆÆÔºåÁî®‰∫éÂÆö‰πâ‰º†Ëæì‰ø°ÊÅØÁöÑÁ±ªÂûã(type of information)ÔºåÊØè‰∏Ä‰∏™uwsgi packetÂâç4byte‰∏∫‰º†Ëæì‰ø°ÊÅØÁ±ªÂûãÁöÑÊèèËø∞Ôºå‰∏éWSGIÂçèËÆÆÊòØ‰∏§Áßç‰∏úË•øÔºåÊçÆËØ¥ËØ•ÂçèËÆÆÊòØfcgiÂçèËÆÆÁöÑ10ÂÄçÂø´„ÄÇ

uWSGIÔºöÊòØ‰∏Ä‰∏™ web ÊúçÂä°Âô®ÔºåÂÆûÁé∞‰∫Ü WSGI„ÄÅuwsgi„ÄÅhttp Á≠âÂçèËÆÆ„ÄÇuWSGI serverÊâÄÂÅöÁöÑÂ∑•‰Ωú‰ªÖ‰ªÖÊòØÂ∞Ü‰ªéÂÆ¢Êà∑Á´ØÊî∂Âà∞ÁöÑËØ∑Ê±Ç‰º†ÈÄíÁªôWSGI applicationÔºåÁÑ∂ÂêéÂ∞ÜWSGI applicationÁöÑËøîÂõûÂÄº‰Ωú‰∏∫ÂìçÂ∫î‰º†ÁªôÂÆ¢Êà∑Á´Ø„ÄÇWSGI applications ÂèØ‰ª•ÊòØÊ†àÂºèÁöÑÔºåËøô‰∏™Ê†àÁöÑ‰∏≠Èó¥ÈÉ®ÂàÜÂè´ÂÅö‰∏≠Èó¥‰ª∂Ôºå‰∏§Á´ØÊòØÂøÖÈ°ªË¶ÅÂÆûÁé∞ÁöÑapplicationÂíåserver„ÄÇ

Âú®ÈòøÈáå‰∫ë Ubuntu Á≥ªÁªüÂÆâË£Ö Pythond 3.6 Âíå uWSGI

    yum search python3 | grep python36
    yum list | grep python36
    yum -y install python36
    python3.6 --version
    whereis python3

    yum search python-dev # Êü•ËØ¢PythonÂºÄÂèëÂåÖ
    yum -y install python-devel
    pip install uwsgi


## ==‚ö° WSGI applicationÊé•Âè£

PythonÂÜÖÁΩÆ‰∫Ü‰∏Ä‰∏™WSGIÊúçÂä°Âô®,Ëøô‰∏™Ê®°ÂùóÂè´wsgiref,ÂÆÉÊòØÁî®Á∫ØPythonÁºñÂÜôÁöÑWSGIÊúçÂä°Âô®ÁöÑÂèÇËÄÉÂÆûÁé∞„ÄÇWSGI application Êé•Âè£Â∫îËØ•ÂÆûÁé∞‰∏∫‰∏Ä‰∏™ÂèØË∞ÉÁî®ÂØπË±°ÔºåËøô‰∏™ÂèØË∞ÉÁî®ÂØπË±°ÂèØ‰ª•Êé•Êî∂2‰∏™ÂèÇÊï∞Ôºö
environment ÂåÖÂê´‰∫ÜÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÁöÑ‰ø°ÊÅØ‰ª•ÂèäÂÖ∂‰ªñ‰ø°ÊÅØÔºåÂèØ‰ª•ËÆ§‰∏∫ÊòØËØ∑Ê±Ç‰∏ä‰∏ãÊñáÔºàÁºñÁ†Å‰∏≠Â§öÁÆÄÂÜô‰∏∫environ„ÄÅenvÔºâÔºõ
response ÂìçÂ∫îÂØπË±°ÔºåÁî®‰∫éÂèëÈÄÅÂìçÂ∫îÁä∂ÊÄÅ HTTP status/HTTP headers ÁöÑÂõûË∞ÉÂáΩÊï∞„ÄÇ
ÊúÄÂêéÔºåapplication ÂèØË∞ÉÁî®ÂØπË±°ÁöÑËøîÂõûÂÄºÊòØÂìçÂ∫îÊ≠£ÊñáÔºàresponse bodyÔºâ„ÄÇ‰∏ãÈù¢ÁöÑ‰æã‰∏≠Ôºåapplication ‰ºöÁî±uwsgiÊêúÁ¥¢Âà∞Âπ∂Ëá™Âä®ÊâßË°åÔºö

    def application (environ, start_response):
        response_body = 'Request method: %s' % environ['REQUEST_METHOD']
        status = '200 OK'
        response_headers = [
            ('Content-Type', 'text/plain'),
            ('Content-Length', str(len(response_body)))
        ]
        start_response(status, response_headers)
        return [response_body]

ÊääÁ§∫‰æã‰ª£Á†Å‰øùÂ≠òÂà∞ server.py Êñá‰ª∂‰∏≠ÔºåÊâßË°å‰ª•‰∏ãÂëΩ‰ª§ÔºåÂ∞±ÂèØ‰ª•Âú®ÊµèËßàÂô®‰∏≠ÊâìÂºÄ9090Ëøô‰∏™ÂïÜÂìÅÊü•ÁúãËæìÂá∫ÂÜÖÂÆπÔºå--uid Áî®Êù•ÊåáÂÆöËøêË°åË¥¶Êà∑ÔºåÂêéÈù¢‰∏§Êù°ÂëΩ‰ª§ÂÆö‰πâ‰∫Ü4ËøõÁ®ãËøêË°åÔºåÊØèËøõÁ®ãÂê´2Á∫øÁ®ã„ÄÇËøôÁßçÁõ¥Êé•ÂêØÂä®ÁöÑÊñπÂºèÈÄÇÂêàÂÅöÂºÄÂèëÊµãËØïÔºå  

    uwsgi --http *:9090 --uid www --wsgi-file server.py
    uwsgi --http :9090 --wsgi-file server.py --master --processes 4 --threads 2
    uwsgi --http :9090 --wsgi-file server.py --master --processes 4 --threads 2 --stats 127.0.0.1:9191

ÂèØ‰ª•‰ΩøÁî® curl Êàñ php ÂëΩ‰ª§Êù•ÂÅöËÆøÈóÆÊµãËØïÔºö

    curl "http://localhost:9090/"
    php -r 'echo file_get_contents("http://localhost:9090");'

Âè¶‰∏Ä‰∏™ÂÆûÁé∞ÔºåËøô‰∏™ÂÆûÁé∞ÂÆû‰æãÂåñ‰∫ÜapplicationÔºåÁõ¥Êé•‰ΩøÁî®pythonËøêË°åÂç≥ÂèØ„ÄÇÊ≥®ÊÑè python Êúâ‰∏™ÂÜÖÁΩÆÂ±ûÊÄß __name__ÔºåËøô‰∏™Â±ûÊÄßÊåáÁ§∫ÂΩìÂâçÁöÑÊ®°ÂùóÊòØ‰∏ªÊ®°ÂùóËøòÊòØÂºïÁî®Ê®°Âùó„ÄÇ‰∏Ä‰∏™pythonÁöÑÊñá‰ª∂Êúâ‰∏§Áßç‰ΩøÁî®ÁöÑÊñπÊ≥ïÔºåÈÄöËøáimportÂºïÁî®Âç≥‰Ωú‰∏∫Ê®°ÂùóÊâßË°å„ÄÇÊàñÁõ¥Êé•‰Ωú‰∏∫ËÑöÊú¨ÊâßË°åÂç≥‰∏ªÊ®°ÂùóÔºåÈÇ£‰πà if __name__ == 'main': ‰∏ãÁöÑ‰ª£Á†ÅÂ∞±‰ºöË¢´ÊâßË°å„ÄÇ

    # ! /usr/bin/env python
    # -*- coding: utf-8 -*- 
     
    # ÂØºÂÖ•pythonÂÜÖÁΩÆÁöÑWSGI server
    from wsgiref.simple_server import make_server
     
    def application (environ, start_response):
        response_body = [
            '%s: %s' % (key, value) for key, value in sorted(environ.items())
        ]
        response_body = '\n'.join(response_body) # Áî±‰∫é‰∏ãÈù¢Â∞ÜContent-TypeËÆæÁΩÆ‰∏∫text/plainÔºåÊâÄ‰ª•`\n`Âú®ÊµèËßàÂô®‰∏≠‰ºöËµ∑Âà∞Êç¢Ë°åÁöÑ‰ΩúÁî®
        
        status = '200 OK'
        response_headers = [
            ('Content-Type', 'text/plain'),
            ('Content-Length', str(len(response_body)))
        ]
        start_response(status, response_headers)
        
        return [response_body]

    if __name__ == "__main__":
        # ÂÆû‰æãÂåñWSGI server
        httpd = make_server (
            '127.0.0.1', 
            8051, # port
            application # WSGI applicationÔºåÊ≠§Â§ÑÂ∞±ÊòØ‰∏Ä‰∏™ÂáΩÊï∞
        )
        
        # handle_requestÂáΩÊï∞Âè™ËÉΩÂ§ÑÁêÜ‰∏ÄÊ¨°ËØ∑Ê±ÇÔºå‰πãÂêéÂ∞±Âú®ÊéßÂà∂Âè∞`print 'end'`‰∫Ü
        httpd.handle_request()
    
    print 'end'

ÂèØ‰ª•‰∏éÁ±ª‰ºº nginx ËøôÊ†∑ÁöÑWEBÊúçÂä°Âô®ÁªìÂêàÔºånginx ÈÖçÁΩÆÁ§∫‰æãÂ¶Ç‰∏ãÔºåuwsgi_pass ÂØπÂ∫î --socket„ÄÇ proxy_pass ÂØπÂ∫î‰ª• uwsgi --http ÊñπÂºèÂêØÂä®ÁöÑÊúçÂä°ÔºåÂç≥‰∏äÈù¢Ëøô‰∏™‰æãÂ≠êÔºö

    location / {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:3031;
        # proxy_pass  http://127.0.0.1:9090;
        # access_log /tmp/logs/api_access.log;
    }

Ëøô‰∏™ÈÖçÁΩÆÂëäËØâ nginx Ë¶ÅÊääÊØè‰∏™ËØ∑Ê±ÇÂèëÈÄÅÂà∞ uwsgi ÂçèËÆÆÁ´ØÂè£ 3031ÔºåÊé•‰∏ãÊù•Â∞±Ë¶ÅÂêØÂä® uwsgi ÈÄöËøá socket Êù•‰æ¶Âê¨ 3031 Á´ØÂè£Ôºö

    uwsgi --socket 127.0.0.1:3031 --wsgi-file server.py --master --processes 4 --threads 2 --stats 127.0.0.1:9191
 
ÂÅúÊ≠¢ uwsgi ÊúçÂä°

    uwsgi --stop <uwsgi pid file> 
    killall -s INT /usr/bin/uwsgi

ËøòÂèØ‰ª•ÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂Êù•ËøêË°åÔºö

    [uwsgi]
    socket = 127.0.0.1:3031
    chdir = /home/server/myproject/
    wsgi-file = myproject/wsgi.py
    processes = 4
    threads = 2
    stats = 127.0.0.1:9191

ËøôÊ†∑ÂëΩ‰ª§Ë°åÂè™Ë¶ÅÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂Ë∑ØÂæÑÂ∞±ÂèØ‰ª•‰∫ÜÔºö

    uwsgi yourfile.ini

## ==‚ö° GETÂä®‰ΩúËß£Êûê

cgi.parse_qs() ÂáΩÊï∞ÂèØ‰ª•ÂæàÊñπ‰æøÁöÑÂ§ÑÁêÜQUERY_STRINGÔºåÂêåÊó∂ÈúÄË¶Å cgi.escape() Â§ÑÁêÜÁâπÊÆäÂ≠óÁ¨¶‰ª•Èò≤Ê≠¢ËÑöÊú¨Ê≥®ÂÖ•Ôºå‰ª£Á†ÅÊòØ Python 2 ÁöÑËØ≠Ê≥ïÔºåÂú®Python 3 ‰∏≠ print ËøôÊ†∑ÁöÑË∞ÉÁî®Ë¶ÅÂä†Êã¨Âè∑„ÄÇ

    # ! /usr/bin/env python
    # -*- coding: utf-8 -*- 
    from cgi import parse_qs, escape
     
    QUERY_STRING = 'age=10&hobbies=software&hobbies=tunning'
    d = parse_qs(QUERY_STRING)
    print d.get('age', ['default_value'])[0]
    print d.get('hobbies', [])
    print d.get('name', ['unknown'])
     
    print 10 * '*'
    print escape('<script>alert(123);</script>')

WEBËØ∑Ê±Ç‰∏≠ÁöÑQUERY_STRINGÈúÄË¶ÅÂú® environ ‰∏≠ËØªÂèñÔºö

    d = parse_qs(environ['QUERY_STRING'])


## ==‚ö° POSTÂä®‰ΩúËß£Êûê

ÂØπ‰∫éPOSTËØ∑Ê±ÇÔºåÊü•ËØ¢Â≠óÁ¨¶‰∏≤ÊîæÂú®HTTPËØ∑Ê±ÇÊ≠£Êñá request body ‰∏≠„ÄÇËØ∑Ê±ÇÊ≠£ÊñáÂú®environmentÂ≠óÂÖ∏ÂèòÈáè‰∏≠ÈîÆwsgi.inputÂØπÂ∫îÁöÑÂÄº‰∏≠ÔºåËøôÊòØ‰∏Ä‰∏™Á±ª‰ººfileÁöÑÂèòÈáèÔºåËøô‰∏™ÂÄºÊòØ‰∏Ä‰∏™„ÄÇThe PEP 3333 ÊåáÂá∫ÔºåËØ∑Ê±ÇÂ§¥‰∏≠CONTENT_LENGTHÂ≠óÊÆµË°®Á§∫Ê≠£ÊñáÁöÑÂ§ßÂ∞èÔºå‰ΩÜÊòØÂèØËÉΩ‰∏∫Á©∫„ÄÅÊàñËÄÖ‰∏çÂ≠òÂú®ÔºåÊâÄ‰ª•ËØªÂèñËØ∑Ê±ÇÊ≠£ÊñáÊó∂ÂÄôË¶ÅÁî®try/except„ÄÇ

    # ! /usr/bin/env python
    # -*- coding: utf-8 -*- 
        
    from wsgiref.simple_server import make_server
    from cgi import parse_qs, escape
        
    html = """
    <html>
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" >
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" >
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <style>.container {}</style>
    </head>
    <body>
        <div class="container>
            <div class="jumbotron">
                <form action="" method="post">
                <h1>Post Test</h1>
                <p>Age:</p>
                <input type="text" name="age" value="%(age)s">
                <p>Hobbies:</p>
                <label for="chk-game"><input id="chk-game" name="hobbies" value="Game" type="checkbox" %(chk-game)s> Game</label>
                <label for="chk-music"><input id="chk-music" name="hobbies" value="Music" type="checkbox" %(chk-music)s> Music</label>
                <p><input type="submit" value="submit" class="btn btn-primary"></p>
                </form>
            </div>
            <div class="panel">
                <input type="text" class="text-info" value="Age: %(age)s">
                <input type="text" class="text-info" value="Hobbies: %(hobbies)s">
            </div>
        </div>
    </body>
    </html>
    """

    def application(environ, start_response):
        
        # CONTENT_LENGTH ÂèØËÉΩ‰∏∫Á©∫ÔºåÊàñËÄÖÊ≤°Êúâ
        try:
            request_body_size = int(environ.get('CONTENT_LENGTH', 0))
        except (ValueError):
            request_body_size = 0
        
        request_body = environ['wsgi.input'].read(request_body_size)
        d = parse_qs(request_body)
        age = d.get('age', [''])[0] 
        hobbies = d.get('hobbies', []) 
        
        # ËΩ¨‰πâÔºåÈò≤Ê≠¢ËÑöÊú¨Ê≥®ÂÖ•
        age = escape(age)
        hobbies = [escape(hobby) for hobby in hobbies]
        
        response_body = html % { 
            'chk-game': ('', 'checked')['Game' in hobbies],
            'chk-music': ('', 'checked')['Music' in hobbies],
            'age': age or 'Empty',
            'hobbies': ', '.join(hobbies or ['No Hobbies?'])
        }
        
        status = '200 OK'
        
        response_headers = [
            ('Content-Type', 'text/html'),
            ('Content-Length', str(len(response_body)))
        ]
        
        start_response(status, response_headers)
        return [response_body]
        
    print 'Testing'
    if __name__ == "__main__":
        httpd = make_server('127.0.0.1', 9090, application)
        #httpd = make_server('localhost', 9090, application)
        httpd.serve_forever()
        httpd.handle_request() # serve one request, then exit
        httpd.server_close()


## ==‚ö° ‰∏≠Èó¥‰ª∂ÔºàMiddlewareÔºâ

‰∏≠Èó¥‰ª∂Â∞±ÊòØÂú®WSGI serverÂíåWSGI application‰πãÈó¥ËøêË°åÁöÑ‰ª£Á†ÅÈÉ®‰ª∂Ôºå‰∏ãÈù¢Áî®‰ª£Á†ÅÂ±ïÁ§∫‰∏≠Èó¥‰ª∂ÁöÑÊÑè‰πâ„ÄÇ

    # ! /usr/bin/env python
    # -*- coding: utf-8 -*- 

    from wsgiref.simple_server import make_server

    def application(environ, start_response):
        response_body = 'hello world!'
        status = '200 OK'
        response_headers = [
            ('Content-Type', 'text/plain'),
            ('Content-Length', str(len(response_body)))
        ]
        start_response(status, response_headers)
        return [response_body]

    # ‰∏≠Èó¥‰ª∂ÂÆö‰πâ
    class Upperware:
    
        def __init__(self, app):
            self.wrapped_app = app
    
        def __call__(self, environ, start_response):
            for data in self.wrapped_app(environ, start_response):
            yield data.upper()

    # ‰∏≠Èó¥‰ª∂Êé•ÂÖ•
    wrapped_app = Upperware(application)
    httpd = make_server('localhost', 9090, wrapped_app)
    httpd.serve_forever()

    print 'end'



# =üö© hashlib md5 & base64

hashlib ÊòØÊ∂âÂèäÂÆâÂÖ®Êï£ÂàóÂíåÊ∂àÊÅØÊëòË¶ÅÔºåÊèê‰æõÂ§ö‰∏™‰∏çÂêåÁöÑÂä†ÂØÜÁÆóÊ≥ïÊé•Âè£ÔºåÂ¶Ç SHA1„ÄÅSHA224„ÄÅSHA256„ÄÅSHA384„ÄÅSHA512„ÄÅMD5Á≠â„ÄÇ

`hash.digest()` ËøîÂõûÊëòË¶ÅÔºå‰Ωú‰∏∫‰∫åËøõÂà∂Êï∞ÊçÆÂ≠óÁ¨¶‰∏≤ÂÄº
`hash.hexdigest()` ËøîÂõûÊëòË¶ÅÔºå‰Ωú‰∏∫ÂçÅÂÖ≠ËøõÂà∂Êï∞ÊçÆÂ≠óÁ¨¶‰∏≤ÂÄº

```py
import hashlib, base64;
from pprint import pprint

md5 = hashlib.md5();
md5.update("sometext".encode("utf-8"));
pprint([
    'md5 digest: %s'% md5.digest(),
    'md5 hexdigest: %s'% md5.hexdigest(),
    'base64:%s'% base64.b64encode(md5.digest()).decode('utf-8'),
]);
```

