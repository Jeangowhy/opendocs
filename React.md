[TOC]

# React readme å‰ç«¯æ¡†æ¶
- [React JS](https://reactjs.org/)
- [React å…¥é—¨å®ä¾‹æ•™ç¨‹](http://www.ruanyifeng.com/blog/2015/03/react.html)
- [React-Devtools](https://github.com/facebook/react-devtools)

React èµ·æºäº Facebook çš„å†…éƒ¨é¡¹ç›®ï¼Œå› ä¸ºè¯¥å…¬å¸å¯¹å¸‚åœºä¸Šæ‰€æœ‰ JavaScript MVC æ¡†æ¶ï¼Œéƒ½ä¸æ»¡æ„ï¼Œå°±å†³å®šè‡ªå·±å†™ä¸€å¥—ï¼Œç”¨æ¥æ¶è®¾ Instagram çš„ç½‘ç«™ã€‚åšå‡ºæ¥ä»¥åï¼Œå‘ç°è¿™å¥—ä¸œè¥¿å¾ˆå¥½ç”¨ï¼Œå°±åœ¨2013å¹´5æœˆå¼€æºäº†ã€‚

ç”±äº React çš„è®¾è®¡æ€æƒ³æå…¶ç‹¬ç‰¹ï¼Œå±äºé©å‘½æ€§åˆ›æ–°ï¼Œæ€§èƒ½å‡ºä¼—ï¼Œä»£ç é€»è¾‘å´éå¸¸ç®€å•ã€‚æ‰€ä»¥ï¼Œè¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹å…³æ³¨å’Œä½¿ç”¨ï¼Œè®¤ä¸ºå®ƒå¯èƒ½æ˜¯å°†æ¥ Web å¼€å‘çš„ä¸»æµå·¥å…·ã€‚

è¿™ä¸ªé¡¹ç›®æœ¬èº«ä¹Ÿè¶Šæ»šè¶Šå¤§ï¼Œä»æœ€æ—©çš„UIå¼•æ“å˜æˆäº†ä¸€æ•´å¥—å‰åç«¯é€šåƒçš„ Web App è§£å†³æ–¹æ¡ˆã€‚è¡ç”Ÿçš„ React Native é¡¹ç›®ï¼Œç›®æ ‡æ›´æ˜¯å®ä¼Ÿï¼Œå¸Œæœ›ç”¨å†™ Web App çš„æ–¹å¼å»å†™ Native Appã€‚å¦‚æœèƒ½å¤Ÿå®ç°ï¼Œæ•´ä¸ªäº’è”ç½‘è¡Œä¸šéƒ½ä¼šè¢«é¢ è¦†ï¼Œå› ä¸ºåŒä¸€ç»„äººåªéœ€è¦å†™ä¸€æ¬¡ UI ï¼Œå°±èƒ½åŒæ—¶è¿è¡Œåœ¨æœåŠ¡å™¨ã€æµè§ˆå™¨å’Œæ‰‹æœºï¼ˆå‚è§ã€Šä¹Ÿè®¸ï¼ŒDOM ä¸æ˜¯ç­”æ¡ˆã€‹ï¼‰ã€‚



# âš‘ Lerna JavaScript å¤šåŒ…å·¥ç¨‹ç®¡ç†
- [Lerna JavaScript å¤šåŒ…å·¥ç¨‹ç®¡ç†](https://github.com/lerna/lerna)

lerna ç”¨äºç®¡ç†å¤š packageï¼Œä¸”å„ package å¯èƒ½ä¼šäº’ç›¸å¼•ç”¨çš„é¡¹ç›®ã€‚

Lerna is a tool that optimizes the workflow around managing multi-package repositories with git and npm.


monorepo(monolithic repository)ï¼Œä¸ multirepo ç›¸å¯¹ï¼Œåˆ†åˆ«æ˜¯å•ä»£ç ä»“åº“ä¸å¤šä»£ç ä»“åº“ã€‚

multirepo å³ä¼ ç»Ÿåšæ³•ï¼ŒæŒ‰æ¨¡å—åˆ†ä¸ºå¤šä¸ªä»£ç åº“ï¼Œå®è·µä¸­å‘ç°ä¸€äº›é—®é¢˜ï¼š

- issue ç®¡ç†æ··ä¹±ï¼Œç»å¸¸æœ‰åœ¨ core repo æ module é—®é¢˜çš„ï¼Œéœ€è¦ Close this and track that
- changelog éš¾ä»¥æ•´åˆï¼Œéœ€è¦äººå·¥æ¢³ç†æ‰€æœ‰å˜åŠ¨çš„ä»“åº“ï¼Œå¹¶åšæ•´åˆ
- core repo ç‰ˆæœ¬æ›´æ–°éº»çƒ¦ï¼Œéœ€è¦åŒæ­¥æ‰€æœ‰ module æ›´æ–°å…¶ä¾èµ–çš„ core repo ç‰ˆæœ¬

monorepo æŠŠæ‰€æœ‰ç›¸å…³ module éƒ½æ”¾åˆ°ä¸€ä¸ª repo é‡Œï¼Œæ¯ä¸ª module ç‹¬ç«‹å‘å¸ƒï¼Œä½†ä½¿ç”¨ä¸è¯¥ repo ç»Ÿä¸€çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ Babel å’Œ Reactã€‚issue å’Œ PR éƒ½é›†ä¸­åˆ°è¯¥ repoï¼Œchangelog å¯ä»¥ç®€å•åœ°ä»ä¸€ä»½ commit åˆ—è¡¨æ¢³ç†å‡ºæ¥ï¼ˆç”šè‡³å¦‚æœæŒ‰ç…§commitè§„èŒƒå…³è”issue tagçš„è¯ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„changelogï¼‰

monorepo ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä½†ä¸å¦‚ä¸Šé¢æåˆ°çš„ç—›ç‚¹å¼ºçƒˆï¼š

- repo ä½“ç§¯è¾ƒå¤§ï¼Œå¯èƒ½å¸¦æ¥ç‰ˆæœ¬æ§åˆ¶çš„é—®é¢˜ï¼ˆGitä¸é€‚åˆç®¡ç†ä½“ç§¯å¤ªå¤§çš„repoï¼‰
- ç»Ÿä¸€æ„å»ºå·¥å…·ï¼Œå¯¹æ„å»ºå·¥å…·æå‡ºäº†æ›´é«˜è¦æ±‚ï¼Œè¦èƒ½æ„å»ºå„ç§ç›¸å…³ module

ä»æºç ç®¡ç†çš„è§’åº¦æ¥çœ‹ï¼Œmultirepo ä¸ monorepo æ˜¯ä¸¤ç§ä¸åŒçš„ç†å¿µï¼Œå‰è€…å…è®¸å¤šå…ƒåŒ–å‘å±•ï¼Œå„ä¸ª module å¯ä»¥æœ‰è‡ªå·±çš„ç©æ³•ï¼ˆæ„å»ºï¼Œä¾èµ–ç®¡ç†ï¼Œå•å…ƒæµ‹è¯•ç­‰ï¼‰ï¼Œåè€…å¸Œæœ›é›†ä¸­ç®¡ç†ï¼Œå‡å°‘ç©æ³•å·®å¼‚å¸¦æ¥çš„æ²Ÿé€šæˆæœ¬ã€‚

Lernaæœ‰å¾ˆå¤šå¼ºå¤§çš„CLIå‘½ä»¤ï¼Œæˆ‘è¿™é‡Œç”¨çš„æœ‰:

- **lerna init** åˆå§‹åŒ–é¡¹ç›®
- **lerna bootstrap** è‡ªåŠ¨æ„å»ºé¡¹ç›®
- **lerna ls** åˆ—å‡ºå½“å‰é¡¹ç›®æ‰€æœ‰åŒ…
- **lerna clean** æ¸…ç† node_modules æ–‡ä»¶å¤¹
- **lerna add** æ·»åŠ ä¾èµ–ï¼Œç±»ä¼¼ npm install
- **lerna publish** å‘ç‰ˆ

lerna é€šè¿‡ä¸¤ç§æ–¹å¼ç®¡ç†å­é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼š

Fixed/Locked mode (default)ï¼šæ¯æ¬¡æ‰§è¡Œ lerna publish éƒ½ä¼šå°†æ‰€æ¶‰åŠåˆ°çš„åŒ…å‡çº§åˆ°æœ€æ–°ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¼€å‘è€…åªéœ€è¦ç¡®å®šå‘å¸ƒä¸‹ä¸€ä¸ª versionã€‚
Independent modeï¼šç”±å¼€å‘è€…è‡ªè¡Œç®¡ç†å­é¡¹ç›®çš„ versionï¼Œæ¯æ¬¡æ‰§è¡Œ lerna publish éƒ½éœ€è¦ç¡®å®šæ¯ä¸ªåŒ…çš„ä¸‹ä¸ªç‰ˆæœ¬å·ã€‚

å›ºå®šæ¨¡å¼ï¼Œé€šè¿‡ lerna.jso nçš„ç‰ˆæœ¬è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚å½“ä½ æ‰§è¡Œ lerna publish å‘½ä»¤æ—¶ï¼Œ å¦‚æœè·ç¦»ä¸Šæ¬¡å‘å¸ƒåªä¿®æ”¹äº†ä¸€ä¸ªæ¨¡å—ï¼Œå°†ä¼šæ›´æ–°å¯¹åº”æ¨¡å—çš„ç‰ˆæœ¬åˆ°æ–°çš„ç‰ˆæœ¬å·ï¼Œç„¶åä½ å¯ä»¥åªå‘å¸ƒä¿®æ”¹çš„åº“ã€‚

è¿™ç§æ¨¡å¼ä¹Ÿæ˜¯ Babel ä½¿ç”¨çš„æ–¹å¼ã€‚å¦‚æœä½ å¸Œæœ›æ‰€æœ‰çš„ç‰ˆæœ¬ä¸€èµ·å˜æ›´ï¼Œå¯ä»¥æ›´æ–° minor ç‰ˆæœ¬å·ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ‰€æœ‰çš„æ¨¡å—éƒ½æ›´æ–°ç‰ˆæœ¬ã€‚

ç‹¬ç«‹æ¨¡å¼ï¼Œinit çš„æ—¶å€™éœ€è¦è®¾ç½®é€‰é¡¹ --independentï¼Œç‹¬ç«‹æ¨¡å¼å…è®¸ç®¡ç†è€…å¯¹æ¯ä¸ªåº“å•ç‹¬æ”¹å˜ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å‘å¸ƒçš„æ—¶å€™ï¼Œä½ éœ€è¦ä¸ºæ¯ä¸ªæ”¹åŠ¨çš„åº“æŒ‡å®šç‰ˆæœ¬å·ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ lerna.jsonçš„ç‰ˆæœ¬å·ä¸ä¼šå˜åŒ–äº†ï¼Œé»˜è®¤ä¸º independentã€‚


lerna ç®¡ç†çš„åº“æ–‡ä»¶ç»“æ„ç±»ä¼¼å¦‚ä¸‹è¿™æ ·

	my-lerna-repo/
	  package.json
	  packages/
	    package-1/
	      package.json
	    package-2/
	      package.json

é€šè¿‡å‘½ä»¤ lerna bootstrap å°†ä¼šæŠŠä»£ç åº“è¿›è¡Œ linkã€‚
é€šè¿‡ lerna publish å‘å¸ƒæœ€æ–°æ”¹åŠ¨çš„åº“

é¦–å…ˆï¼Œå®‰è£…å’Œåˆå§‹åŒ– lerna åº“

	cd lerna-repo
	yarn global add lerna
	lerna init

é»˜è®¤ä¼šåˆ›å»ºlerna.jsonå’Œpackagesç›®å½•, å¦‚ä¸‹

	lerna-repo/
	  packages/
	  package.json
	  lerna.json

lerna.jsonè§£æ

	{
	  "version": "1.1.3",
	  "npmClient": "npm",
	  "command": {
	    "publish": {
	      "ignoreChanges": [
	        "ignored-file",
	        "*.md"
	      ]
	    },
	    "bootstrap": {
	      "ignore": "component-*",
	      "npmClientArgs": ["--no-package-lock"]      
	    }
	  },
	  "packages": ["packages/*"]
	}

	version , å½“å‰åº“çš„ç‰ˆæœ¬
	npmClient , å…è®¸æŒ‡å®šå‘½ä»¤ä½¿ç”¨çš„clientï¼Œ é»˜è®¤æ˜¯ npmï¼Œ å¯ä»¥è®¾ç½®æˆ yarn
	command.publish.ignoreChanges ï¼Œ å¯ä»¥æŒ‡å®šé‚£äº›ç›®å½•æˆ–è€…æ–‡ä»¶çš„å˜æ›´ä¸ä¼šè¢«publish
	command.bootstrap.ignore ï¼Œ æŒ‡å®šä¸å— bootstrap å‘½ä»¤å½±å“çš„åŒ…
	command.bootstrap.npmClientArgs ï¼Œ æŒ‡å®šé»˜è®¤ä¼ ç»™ lerna bootstrap å‘½ä»¤çš„å‚æ•°
	command.bootstrap.scope ï¼Œ æŒ‡å®šé‚£äº›åŒ…ä¼šå— lerna bootstrap å‘½ä»¤å½±å“
	packages ï¼Œ æŒ‡å®šåŒ…æ‰€åœ¨çš„ç›®å½•

Create åˆ›å»ºå­é¡¹ç›®

	lerna create <name>

åˆ›å»ºä¸€ä¸ªå­é¡¹ç›®ï¼Œå¹¶ä¼šæ ¹æ®äº¤äº’æç¤ºç”Ÿæˆå¯¹åº”çš„package.json

Add æ·»åŠ ä¾èµ–
	
	lerna add <package>[@version] [--dev] [--exact]

	lerna add eslintï¼š æ‰€æœ‰åŒ…éƒ½ä¼šè£…ä¸Šeslintã€‚
	lerna add eslint --scope=package1ï¼šåªæœ‰package1ä¼šè£…ä¸Šã€‚
	lerna add eslint packages/prefix-*ï¼šç¬¦åˆprefixçš„åŒ…ä¼šè£…ä¸Šã€‚
	options:

	-devï¼šæ·»åŠ åˆ°devDependencies
	--exact: åªå®‰è£…ç‰¹å®šç‰ˆæœ¬

å¦‚æœæ·»åŠ çš„æ˜¯å­é¡¹ç›®ï¼Œåˆ™ä¼šé€šè¿‡linkè½¯è¿æ¥åˆ°å¯¹åº”çš„é¡¹ç›®ä¸­ã€‚

	lerna add package1 --scope=package2

Run æ‰§è¡Œnpm scriptå‘½ä»¤

	lerna run <script> -- [..args]

	lerna run testï¼šåˆ™ä¼šæ‰§è¡Œæ‰€æœ‰å­é¡¹ç›®ä¸­çš„testã€‚
	lerna run --scope package1 testï¼šåªæ‰§è¡Œpackage1ä¸­çš„testã€‚
	lerna run --ignore package-* testï¼šåªæ‰§è¡Œé™¤äº†åŒ¹é…package-*å¤–çš„é¡¹ç›®ä¸­çš„test

Exec æ‰§è¡Œä»»æ„å‘½ä»¤

	lerna exec -- <command> [..args]

ä¸ lerna run ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

	eg: lerna exec -- rm -rf ./node_modules

å…¶ä»–å‘½ä»¤

- lerna bootstrapï¼šå®‰è£…å„å­é¡¹ç›®ä¾èµ–ï¼Œå¯¹ç›¸äº’å¼•ç”¨çš„é¡¹ç›®è¿›è¡Œè½¯è¿æ¥ï¼Œåœ¨å­é¡¹ç›®ä¸­æ‰§è¡Œ npm run prepublish å’Œ npm run prepare
	- --hoist [glob]ï¼šä¼šå°†å­é¡¹ç›®çš„åŒ¹é…çš„ä¾èµ–(egï¼šeslint, jestç­‰)ï¼Œç»Ÿä¸€æ”¾åœ¨æ ¹ç›®å½•çš„ node_modules ä¸­ï¼Œå‡å°‘å®‰è£…æ—¶é—´ï¼Œä½†ä»…é™ npmClient=npm
	- â€”nohoist [glob]: åŒ¹é…çš„ä¾èµ–(eg: babel)ä¼šå®‰è£…åˆ°å­é¡¹ç›®ä¸­çš„ node_modules ä¸­
- lerna cleanï¼šåˆ é™¤å­é¡¹ç›®çš„ node_modules
- lerna linkï¼šåŒ bootstrap ç¬¬äºŒæ­¥ã€‚



# âš‘ Hello Demo
- [React CDN å¼•å…¥](https://www.runoob.com/react/react-install.html)
- [Babel-Sublime](https://github.com/babel/babel-sublime)
- [Sublime Babel for VSCode](https://marketplace.visualstudio.com/items?itemName=joshpeng.sublime-babel-vscode)
- [Hello World in React](https://codepen.io/gaearon/pen/zKRGpo?editors=0010)

æ²¡æœ‰é…ç½®å¥½ Node.jsã€VSCodeã€Sublime å¼€å‘å·¥å…·ï¼Œå¯ä»¥åœ¨ CodePen å¹³å°ä¸Šç›´æ¥è¿è¡Œ React ä»£ç ã€‚è¿™ä¸ª Demo åªå±•ç¤º ReactDOM åŸºç¡€éƒ¨åˆ†çš„ä½¿ç”¨ï¼Œåœ¨ç”Ÿäº§å¼€å‘ä¸­ä¹ æƒ¯ä¸Šä½¿ç”¨ç»„ä»¶åŒ–å¼€å‘ï¼Œå³ `ReactDOM.render()` ç»“åˆç»„ä»¶ `React.Component`ä¸€èµ·ä½¿ç”¨ï¼Œè¿™å°±æ¶‰åŠç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ”¾åé¢ä»‹ç»ã€‚

åœ¨ç½‘é¡µä¸Šä½¿ç”¨ React å¼€å‘ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥å¼•ç”¨ Staticfile CDN çš„ React CDN åº“ï¼š

	<script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"></script>
	<script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"></script>
	<script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"></script>

å®˜æ–¹æä¾›çš„ CDN åœ°å€ï¼š

	<script src="https://unpkg.com/react@16/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

    <script src="https://cdn.staticfile.org/react/16.4.0/umd/react.production.min.js"> </script>
    <script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.production.min.js"> </script>

æ³¨æ„: åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ Babel æ¥ç¼–è¯‘ JSX æ•ˆç‡æ˜¯éå¸¸ä½çš„ã€‚ç”Ÿäº§ç¯å¢ƒä¸­ä¸å»ºè®®ä½¿ç”¨ development åç¼€ç‰ˆæœ¬ã€‚

å¼•å…¥çš„ä¸‰ä¸ªåº“

`react.min.js` - React çš„æ ¸å¿ƒåº“ï¼ŒåŒ…å« `React.Component` ç»„ä»¶æ¶æ„å®ç°
`react-dom.min.js` - æä¾›ä¸ `ReactDOM` ç›¸å…³çš„åŠŸèƒ½
`babel.min.js` - Babel å¯ä»¥å°† ES6 ä»£ç è½¬ç¼–è¯‘ä¸º ES5 ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨ç›®å‰ä¸æ”¯æŒ ES6 æµè§ˆå™¨ä¸Šæ‰§è¡Œ React ä»£ç ã€‚Babel å†…åµŒäº†å¯¹ JSX çš„æ”¯æŒã€‚

Sublime Text å¼€å‘ç¯å¢ƒå¯ä»¥å®‰è£… [Babel-Sublime] æ’ä»¶ï¼Œè®©æºç çš„è¯­æ³•æ¸²æŸ“ä¸Šå‡åˆ°ä¸€ä¸ªå…¨æ–°çš„æ°´å¹³ã€‚æˆ–è€… [Sublime Babel for VSCode]ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç”¨äºä½“éªŒçš„ React é¡µé¢ç¨‹åºï¼Œç”Ÿäº§å¼€å‘ç¯å¢ƒä¸­æ˜¯ç»“åˆ Node.js å¹³å°æ“ä½œçš„ï¼Œåˆ©ç”¨ npm æ¥ç®¡ç†è½¯ä»¶å·¥ç¨‹ä»¥åŠå®‰è£…å·¥ç¨‹ä¾èµ–çš„ç±»åº“ã€‚

	<!DOCTYPE html>
	<html>
	    <head>
	        <meta charset="utf-8"/>
	        <title>
	            Hello React!
	        </title>
	        <script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"></script>
	        <script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"></script>
	        <script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"></script>
	    </head>
	    <body>
	        <div id="example"> </div>
	        <script type="text/babel">
	            ReactDOM.render(
				    <h1>Hello, world!</h1>,
				    document.getElementById('example')
				);
	        </script>
	    </body>
	</html>

Node.js æ˜¯ç°ä»£å‰ç«¯å¼€å‘å¹³å°ï¼Œä¸‹è½½å®‰è£…åï¼Œå°±å¯ä»¥ä½¿ç”¨ node.exe æ¥è¿è¡Œæˆ–è°ƒè¯•è„šæœ¬ï¼Œä¸»è¦è¿˜æ˜¯ä½¿ç”¨ npm å‘½ä»¤æ¥ç®¡ç†å·¥ç¨‹ã€‚åœ¨å›½å†…ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„æ¨¡å—æœåŠ¡å™¨ï¼Œä»¥å…ä¸‹è½½æ¨¡å—å—é˜»ã€‚

	$ npm install -g cnpm --registry=https://registry.npm.taobao.org
	$ npm config set registry https://registry.npm.taobao.org

è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ cnpm å‘½ä»¤æ¥å®‰è£…æ¨¡å—äº†ï¼š

	$ cnpm install [name]

ä½¿ç”¨ create-react-app å¿«é€Ÿæ„å»º React å¼€å‘ç¯å¢ƒï¼Œè¿™æ˜¯æ¥è‡ªäº Facebook å®˜æ–¹çš„è„šæ‰‹æ¶æ¨¡å—ï¼Œé€šè¿‡è¯¥å‘½ä»¤æˆ‘ä»¬æ— éœ€é…ç½®å°±èƒ½å¿«é€Ÿæ„å»º React å¼€å‘ç¯å¢ƒï¼Œè‡ªåŠ¨åˆ›å»ºçš„é¡¹ç›®åŸºäº Webpack + ES6ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºé¡¹ç›®ï¼š

	$ cnpm install -g create-react-app
	$ create-react-app my-app
	$ cd my-app/
	$ npm start

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä½“éªŒ

	http://localhost:3000/


# âš‘ create-react-app è„šæ‰‹æ¶
- ã€Šåšä¸€ä¸ªåŸºäºreact-scriptsçš„è„šæ‰‹æ¶ã€‹ https://www.codercto.com/a/80522.html
- ğŸ› å¦‚ä½•å¿«é€Ÿå¼€å‘ä¸€ä¸ªè‡ªå·±çš„é¡¹ç›®è„šæ‰‹æ¶ï¼Ÿ https://www.jianshu.com/p/5d77ba59d1f6
- Create React App https://create-react-app.dev/
- Create a New React App https://reactjs.org/docs/create-a-new-react-app.html
- User Guide https://facebook.github.io/create-react-app/
- Adding TypeScript https://create-react-app.dev/docs/adding-typescript

create-react-app ä½œä¸º Facebook å®˜æ–¹çš„è„šæ‰‹æ¶æ˜¯ç›¸å½“å¥½ç”¨çš„ï¼Œè®¾è®¡åŸç†æ˜¯å°†é…ç½®å¥½çš„å¦‚ Webpackï¼ŒBabelï¼ŒESLintï¼Œåˆå¹¶åˆ° react-scripts è¿™ npm åŒ…ä¸­ï¼Œç”¨æˆ·å°±å¯ä»¥å¼€ç®±å³ç”¨ï¼Œreact-scripts å°±æ˜¯ create-react-app è„šæ‰‹æ¶çš„æ ¸å¿ƒé…ç½®ä»£ç ã€‚

ä¸ä½¿ç”¨è„šæ‰‹æ¶å·¥å…·çš„æƒ…å†µä¸‹åˆ›å»ºçš„åº”ç”¨æ˜¯ä½¿ç”¨ npm å®‰è£…ä¾èµ–çš„ï¼Œå¹¶é€šè¿‡ä¿®æ”¹ webpack.config.js è¿›è¡Œé¡¹ç›®é…ç½®çš„ï¼Œæ­å»ºå¥½ç¯å¢ƒååœ¨ src ç›®å½•ä¸‹ç¼–å†™æºä»£ç ã€‚è€Œ create-react-app å°±æ˜¯è‡ªåŠ¨æ„å»ºï¼Œåœ¨ package.json ä¸­åªæœ‰ react-scripts ä½œä¸ºä¾èµ–ï¼ŒæŠŠåŸå…ˆçš„é…ç½®å†…å®¹è½¬ç§»åˆ° reacr-scripts æ¨¡å—ä¸­ï¼Œå®ƒå·²ç»æ­é…å¥½äº†é¡¹ç›®æ‰€æœ‰éœ€è¦çš„é…ç½®é¡¹ï¼Œ ä¸‹æ”¯æŒï¼š

- React, JSX, ES6, and Flow syntax support.
- Language extras beyond ES6 like the object spread operator.
- Import CSS and image files directly from JavaScript.
- Autoprefixed CSS, so you donâ€™t need -webkit or other prefixes.
- A build script to bundle JS, CSS, and images for production, with sourcemaps.
- A dev server that lints for common errors.

ä» Reactï¼ŒES6ï¼ŒBabel, Webpack ç¼–è¾‘åˆ°æ‰“åŒ…ç­‰éƒ½äº¤ç»™ react-scripts éƒ½åšäº†ï¼Œæ¨¡å¡ŠåŒ…å†…æä¾›äº†å…©å¥—æ¨¡æ¿ï¼Œä¸€å¥—æ˜¯ JS ç‰ˆï¼Œå¦ä¸€å¥—æ˜¯ TypeScript ç‰ˆçš„ template-typescriptã€‚

å¦‚æœè¦è‡ªå·±å®šåˆ¶é…ç½®ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆå¯é€‰ã€‚ä¸€ä¸ªæ˜¯ ejectï¼Œå³ä½¿ç”¨å‘½ä»¤ `npm run eject` æ‰§è¡Œ `react-scripts eject` ä»¥æš´éœ²é¡¹ç›®çš„é…ç½®ï¼Œæ•´ä¸ªé¡¹ç›®ç»“æ„ä¼šè½¬æ¢æˆæ™®é€šçš„ Webpack é¡¹ç›®é…ç½®ã€‚å•å‘æ“ä½œä¸å¯é€†ï¼Œè¿™æ ·å¯ä»¥è‡ªç”±é…ç½®é¡¹ç›®æ‰€éœ€çš„ä¾èµ–ï¼Œä¸ä½¿ç”¨ä¾èµ–é›¶é…ç½®å³å¯å¼€å‘ã€‚åŸç†æ˜¯å°† react-scripts æ‹†é™¤ç„¶åå°†é…ç½®æš´éœ²åˆ°åº”ç”¨é¡¶å±‚ï¼Œç”¨æˆ·å°±å¯ä»¥è‡ªè¡Œè¿›è¡Œé…ç½®ã€‚å¦ä¸€ä¸ªæ˜¯ä½¿ç”¨ react-app-rewired ï¼Œç”¨æˆ·é€šè¿‡ config-overrides.js å¢åŠ ä¿®æ”¹é…ç½®ã€‚

ä¸¤è€…å„æœ‰å¥½å¤„ï¼Œeject ç›´æ¥æš´éœ²å¯ä»¥è‡ªè¡Œé…ç½®ï¼Œä½†æ˜¯åå¤„å°±æ˜¯ react-scripts è¢«è§£æ•£äº†ï¼Œå°±ä¸èƒ½éšå®˜æ–¹é…ç½®è¿›è¡Œå‡çº§ã€‚ react-scripts åŒ…æ½äº†é‚£äº›æœ€åŸºç¡€é…ç½®çš„è„æ´»ç´¯æ´»ï¼Œå¹¶ä¸”ä¸€ç›´å†ç»´æŠ¤ï¼Œæ¯”å¦‚ä¿®å¤BUGå’Œæ‰“åŒ…ä¼˜åŒ–ï¼Œè¿è¡Œé€Ÿåº¦ä¼˜åŒ–ã€‚å‰ç«¯å‘å±•çš„è¿…é€Ÿï¼Œè¿™äº›åŸºç¡€é…ç½®éšç€åŸºç¡€è®¾æ–½çš„å‡çº§ï¼Œå¯èƒ½éšæ—¶éƒ½ä¼šå˜åŒ–ã€‚æˆ‘è§‰å¾— eject åè¦å°±éœ€è¦æ‰¿æ‹…ç»´æŠ¤æˆæœ¬çš„é£é™©ã€‚æˆ‘çš„ç†å¿µæ˜¯å°†ä¸“ä¸šçš„äº‹æƒ…äº¤ç»™ä¸“ä¸šçš„äººå»åšå°±å¥½äº†ï¼Œæˆ‘ä»¬åº”è¯¥äº«å—é‡‘å­—å¡”åº•å±‚å¸¦æ¥çš„åŸºç¡€è®¾æ–½ä¾¿åˆ©å»åˆ›é€ ä»·å€¼ï¼Œæ²¡å¿…è¦é‡å¤é€ è½®å­ï¼Œæ›´æ²¡å¿…è¦åœ¨è½®å­ä¸Šè€—è´¹è¿‡å¤šçš„ç»´æŠ¤æˆæœ¬ã€‚


å…¨å±€å®‰è£… create-react-app å¹¶åˆ›å»º React é¡¹ç›®æ¨¡æ¿ï¼š

	$ npm install -g create-react-app
	$ create-react-app react-demo
	Creating a new React app in G:\GitHub\React-demo\react-demo.

	Installing packages. This might take a couple of minutes.
	Installing react, react-dom, and react-scripts...

è„šæ‰‹æ¶ä¼šè‡ªåŠ¨å®‰è£…æ ¸å¿ƒçš„ä¾èµ–ï¼Œä¸»è¦æ˜¯ Reactï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥å¼€å§‹å†™ç»„ä»¶äº†ï¼š

	npm install react react-dom react-scripts 

å®‰è£…å¥½åå°±æä¾›äº†å››ä¸ªåŸºæœ¬å‘½ä»¤ï¼š

- yarn start

    Starts the development server.

- yarn build

    Bundles the app into static files for production.

- yarn test

    Starts the test runner.

- yarn eject

    Removes this tool and copies build dependencies, configuration files
    and scripts into the app directory. If you do this, you canâ€™t go back!


PS: å‡çº§åä¸å†æ”¯æŒå…¨å±€ create-react-app å‘½ä»¤ï¼Œéœ€è¦å¸è½½å®ƒï¼Œæˆ–åˆ é™¤ node ç›®å½•ä¸‹çš„å‘½ä»¤ç›¸å…³å‘½ä»¤ï¼Œç„¶åæ”¹ç”¨ npxã€‚

	npm uninstall -g create-react-app
	yarn global remove create-react-app

	npx create-react-app my-app --template typescript
	# or
	yarn create react-app my-app --template typescript

å°æ–¼ç¾æœ‰é …ç›®å¼•å…¥ TypeScript éœ€è¦å®‰è£ TypeScript ä¾èµ–ï¼Œé‚„æœ‰å„å€‹æ¨¡å¡Šçš„é¡å‹è²æ˜æ–‡ä»¶ï¼Œä»¥ä¸‹å¯é¸ yarn å‘½ä»¤å®‰è£ï¼š

	npm install --save typescript @types/node @types/react @types/react-dom @types/jest
	# or
	yarn add typescript @types/node @types/react @types/react-dom @types/jest

å¯ç”¨ TypeScript çš„é¡¹ç›®é»˜è®¤é…ç½®çš„å…¥å£æ–‡ä»¶å°±æ˜¯ src ç›®å½•ä¸‹çš„ index.tsxï¼Œéœ€è¦å°† index.jsx æ”¹åã€‚

æ‰§è¡Œ `npm run start` æˆ– `react-scripts start` å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚


## ğŸ‘‰ é¡¹ç›®é…ç½®
- Adding Custom Environment Variables https://create-react-app.dev/docs/adding-custom-environment-variables
- Deployment https://create-react-app.dev/docs/deployment
- Advanced Configuration https://create-react-app.dev/docs/advanced-configuration
- Proxying API Requests in Development https://create-react-app.dev/docs/proxying-api-requests-in-development
- [Create React App - Deployment](https://facebook.github.io/create-react-app/docs/deployment)

ç¯å¢ƒå˜é‡é…ç½®ï¼š

	set HTTPS=true
	set PORT=9000
	set HOST=192.168.1.109 


	openssl req -x509 -newkey rsa:2048 -keyout keytmp.pem -out cert.pem -days 365 
	openssl rsa -in keytmp.pem -out key.pem 

	"start": "export HTTPS=true && SSL_CRT_FILE=cert.pem && SSL_KEY_FILE=key.pem && react-scripts start", 

åˆ›å»ºé¡¹ç›®åå¯ä»¥åœ¨ `package.json` é…ç½® `homepage` ä½œä¸ºèµ„æºå¼•ç”¨çš„ç›¸å¯¹è·¯å¾„ï¼Œä»¥ä¸‹è®¾ç½®ä¼šå¿½ç•¥ä¸»æœºåŸŸåéƒ¨åˆ†ï¼Œå‚è€ƒ[Create React App - Deployment]ï¼š

	"homepage": "http://mywebsite.com/relativepath",
	"homepage": ".",

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åç«¯ API è®¿é—®ï¼Œå¯ä»¥åœ¨ package.json ä¸­è®¾ç½®ä»£ç†ï¼Œä»»ä½•æœªçŸ¥è¯·æ±‚ä»£ç†åˆ° API æœåŠ¡å™¨ï¼š

	"proxy": "http://localhost:4000",

ä¸è¿‡ï¼Œæ›´å¥½çš„åšæ³•æ˜¯å»ºç«‹ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œ`src/setupProxy.js`ï¼š

	$ npm install http-proxy-middleware --save
	$ # or
	$ yarn add http-proxy-middleware

å†…å®¹å¦‚ä¸‹ï¼š

```ts
const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) {
  app.use(
    '/api',
    createProxyMiddleware({
      target: 'http://localhost:5000',
      changeOrigin: true,
    })
  );
};
```


å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æˆ–è€… `.env` æ–‡ä»¶é…ç½®å·¥ç¨‹ï¼Œæ³¨æ„ï¼Œç¯å¢ƒå˜é‡é…ç½®ä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨ `REACT_APP_` å‰ç¼€ã€‚

|          Variable         | Dev | Prod |                                   Usage                                    |
|---------------------------|-----|------|----------------------------------------------------------------------------|
| BROWSER                   | âœ…   | ğŸš«    | é»˜è®¤æ‰“å¼€ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ï¼Œè®¾ç½® none æˆ–æŒ‡å®šä¸€ä¸ª Node JS è„šæœ¬æ‰§è¡Œã€‚            |
| BROWSER_ARGS              | âœ…   | ğŸš«    | æŒ‡å®šç»™æµè§ˆå™¨ä¼ é€’çš„å‚æ•°ï¼Œå¤šå‚æ•°ç©ºæ ¼éš”å¼€ã€‚                                   |
| HOST                      | âœ…   | ğŸš«    | è®¾ç½®å¼€å‘æ—¶ç»‘å®šçš„ä¸»æœºï¼Œå¦‚ localhost, LAN network address, etc.              |
| PORT                      | âœ…   | ğŸš«    | æŒ‡å®šå¼€å‘ä¸»æœºçš„ç«¯å£ï¼Œé»˜è®¤ 3000ã€‚                                            |
| HTTPS                     | âœ…   | ğŸš«    | æ˜¯ä¸ä½¿ç”¨ HTTPS æ¨¡å¼ã€‚                                                      |
| WDS_SOCKET_HOST           | âœ…   | ğŸš«    | æŒ‡å®šçƒ­åŠ è½½çš„ websocket ä¸»æœºåï¼Œé»˜è®¤å€¼ window.location.hostnameã€‚           |
| WDS_SOCKET_PATH           | âœ…   | ğŸš«    | ä¸ºçƒ­åŠ è½½æŒ‡å®š websocket è·¯å¾„ï¼Œé»˜è®¤æ˜¯ /sockjs-nodeã€‚                         |
| WDS_SOCKET_PORT           | âœ…   | ğŸš«    | ä¸ºçƒ­åŠ è½½æŒ‡å®š websocket ç«¯å£ï¼Œé€šå¸¸ä½¿ç”¨ window.location.portã€‚               |
| PUBLIC_URL                | âœ…   | âœ…    | å…¬å…±èµ„æºç›®å½•é»˜è®¤æ˜¯ /publicï¼Œç›¸å½“äº Web Root ç›®å½•ï¼Œåœ¨ CDN éƒ¨ç½²ä¸­å¸¸ç”¨ã€‚      |
| BUILD_PATH                | ğŸš«   | âœ…    | é»˜è®¤è¾“å‡ºç›®å½• /buildï¼Œç›¸å¯¹äºå·¥ä½œæ ¹ç›®å½•ã€‚                                    |
| CI                        | âœ…   | âœ…    | æ˜¯å¦å°†ç”Ÿæˆä¸­çš„è­¦å‘Šè§†ä¸ºå¤±è´¥ã€‚                                               |
| REACT_EDITOR              | âœ…   | ğŸš«    | é”™è¯¯å †æ ˆä¿¡æ¯å±‚ä¼šå“åº”ç‚¹å‡»åŠ¨ä½œæ‰“å¼€ç¼–è¾‘å™¨ï¼Œè®¾ç½® none ç¦æ­¢ã€‚                   |
| CHOKIDAR_USEPOLLING       | âœ…   | ğŸš«    | æ˜¯å¦åœ¨è½®è¯¢æ¨¡å¼ä¸‹è¿è¡Œç›‘è§†ç¨‹åºï¼Œè¿™åœ¨ VM å†…éƒ¨æ˜¯å¿…è¦çš„ã€‚                       |
| GENERATE_SOURCEMAP        | ğŸš«   | âœ…    | æ˜¯ä¸è¦ç”Ÿæˆä»£ç åœ°å›¾æ–‡ä»¶ã€‚                                                   |
| INLINE_RUNTIME_CHUNK      | ğŸš«   | âœ…    | æ„å»ºæ—¶é»˜è®¤ä¼šåµŒå…¥è„šæœ¬åˆ° index.htmlï¼Œå¯ä»¥åœ¨å¤„ç† CSP æ—¶ç¦ç”¨ã€‚                 |
| IMAGE_INLINE_SIZE_LIMIT   | ğŸš«   | âœ…    | å†…è”å›¾åƒæ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 10,000 å­—èŠ‚ã€‚ ä½¿ç”¨ Base64 data URI ç¼–ç ï¼Œ0 ä¸ºç¦æ­¢ã€‚ |
| FAST_REFRESH              | âœ…   | ğŸš«    | æ˜¯å¦ä½¿ç”¨ Fast Refreshã€‚                                                    |
| TSC_COMPILE_ON_ERROR      | âœ…   | âœ…    | æ˜¯å¦å°† TSC ç¼–è¯‘é”™è¯¯è½¬æ¢ä¸ºè­¦å‘Šã€‚                                            |
| ESLINT_NO_DEV_ERRORS      | âœ…   | ğŸš«    | æ˜¯å¦å°†å¼€å‘ä¸­çš„ ESLint é”™è¯¯è½¬æ¢ä¸ºè­¦å‘Šã€‚                                     |
| DISABLE_ESLINT_PLUGIN     | âœ…   | âœ…    | æ˜¯ä¸è¦ç¦ç”¨ eslint-webpack-pluginã€‚                                         |
| DISABLE_NEW_JSX_TRANSFORM | âœ…   | âœ…    | æ˜¯å¦è¦ç¦ç”¨ React 17 ä¸­å¼•å…¥çš„æ–° JSX è½¬æ¢ã€‚                                  |


package.json é…ç½®åƒè€ƒï¼š

	{
	  "name": "crop-demo",
	  "version": "0.1.0",
	  "private": true,
	  "dependencies": {
	    "react": "^16.8.6",
	    "react-dom": "^16.8.6"
	  },
	  "scripts": {
	    "start": "react-scripts start",
	    "build": "react-scripts build",
	    "test": "react-scripts test",
	    "eject": "react-scripts eject"
	  },
	  "eslintConfig": {
	    "extends": "react-app"
	  },
	  "browserslist": {
	    "production": [
	      ">0.2%",
	      "not dead",
	      "not op_mini all"
	    ],
	    "development": [
	      "last 1 chrome version",
	      "last 1 firefox version",
	      "last 1 safari version"
	    ]
	  },
	  "devDependencies": {
	    "@babel/runtime": "^7.7.2",
	    "babel": "^6.23.0",
	    "babel-preset-react-app": "^9.0.2",
	    "react-dev-utils": "^9.1.0",
	    "react-scripts": "^3.2.0"
	  }
	}


TypeScript é…ç½® tsconfig.jsonï¼š

	{
	  "compilerOptions": {
	    "target": "es5",
	    "lib": [
	      "dom",
	      "dom.iterable",
	      "esnext"
	    ],
	    "allowJs": true,
	    "skipLibCheck": true,
	    "esModuleInterop": true,
	    "allowSyntheticDefaultImports": true,
	    "strict": true,
	    "forceConsistentCasingInFileNames": true,
	    "module": "esnext",
	    "moduleResolution": "node",
	    "resolveJsonModule": true,
	    "isolatedModules": true,
	    "noEmit": true,
	    "noImplicitAny": false,
	    "jsx": "react"
	  },
	  "include": [
	    "src"
	  ]
	}


# âš‘ Main Concepts åŸºæœ¬æ¦‚å¿µ
- React on Github https://github.com/facebook/react/
- React.org on Github https://github.com/reactjs/reactjs.org/
- Flow é™æ€ç±»å‹æ£€æŸ¥å™¨ https://flow.org/en/docs/
- Flow è¯­æ³•æ£€æŸ¥å™¨åœ¨çº¿ AST æ”¯æŒ https://flow.org/try/
- Flow with React Components https://flow.org/en/docs/react/components/
- Comparison with Facebook Flow Type System #1265 https://github.com/Microsoft/TypeScript/issues/1265
- Compare with Flow & TypeScript https://robin-front.github.io/2017/06/14/compare-with-Flow-and-TypeScript.html
- React Design Principles https://reactjs.org/docs/design-principles.html

è¿™éƒ¨åˆ†ç»“åˆå®˜æ–¹æ–‡æ¡£ï¼Œè®²è§£ React æœ€åŸºæœ¬çš„æ¦‚å¿µï¼Œåˆ†æå’Œç†è§£ React åŸºæœ¬è¿è¡Œæµç¨‹å’ŒåŸºæœ¬å†…éƒ¨åŸç†ï¼Œç”±æµ…åˆ°æ·±æŒæ¡ React çš„åŸºæœ¬å®ç°ã€‚

ä½œä¸ºä¸€ä¸ªå¤§å‹å·¥ç¨‹ï¼ŒReact ä¹Ÿä½¿ç”¨äº†é™æ€ç±»å‹å·¥å…·æ¥å¼ºåŒ– JavaScript ä»£ç çš„ç®¡ç†ï¼Œå¹¶ä¸”æ˜¯ facebook è‡ªå®¶å‡ºå“çš„ Flow é™æ€ç±»å‹æ£€æŸ¥å·¥å…·ã€‚React çš„æºç ä½¿ç”¨ç”¨äº† Flow åšäº†é™æ€ç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥äº†è§£ Flow æœ‰åŠ©äºæˆ‘ä»¬é˜…è¯»æºç ã€‚

Flow ä¸ Typescript ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥éƒ¨åˆ†å¼•å…¥ï¼Œä¸éœ€è¦å®Œå…¨é‡æ„æ•´ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥å¯¹äºä¸€ä¸ªå·²æœ‰ä¸€å®šè§„æ¨¡çš„é¡¹ç›®æ¥è¯´ï¼Œè¿ç§»æˆæœ¬æ›´å°ï¼Œä¹Ÿæ›´åŠ å¯è¡Œã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒFlow å¯ä»¥æä¾›å®æ—¶å¢é‡çš„åé¦ˆï¼Œé€šè¿‡è¿è¡Œ Flow server ä¸éœ€è¦åœ¨æ¯æ¬¡æ›´æ”¹é¡¹ç›®çš„æ—¶å€™å®Œå…¨ä»å¤´è¿è¡Œç±»å‹æ£€æŸ¥ï¼Œæé«˜è¿è¡Œæ•ˆç‡ã€‚å¯ä»¥ç®€å•æ€»ç»“ä¸ºï¼šå¯¹äºæ–°é¡¹ç›®ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ TypeScript æˆ–è€… Flowï¼Œå¯¹äºå·²æœ‰ä¸€å®šè§„æ¨¡çš„é¡¹ç›®åˆ™å»ºè®®ä½¿ç”¨ Flow è¿›è¡Œè¾ƒå°æˆæœ¬çš„é€æ­¥è¿ç§»æ¥å¼•å…¥ç±»å‹æ£€æŸ¥ã€‚


## Hello ReactDom.Render()
1. https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html
2. https://legacy.reactjs.org/docs/react-without-jsx.html

åœ¨å‰é¢ Hello Demo çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨çš„æ˜¯æœ€ç®€å•çš„ React ä¾‹å­ï¼Œæ˜¯ç›´æ¥ä½¿ç”¨ ReactDom.render() æ–¹æ³•æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼š

    const mountNode = document.getElementById('example')
	ReactDOM.render(
	  <h1>Hello, world!</h1>,
	  mountNode
	);

	// é¡µé¢å­˜åœ¨ä¸€ä¸ªå®¹å™¨å…ƒç´  <div id="example"></div>

å‚è€ƒè¿™ä¸ªæ–¹æ³•çš„åŸå‹ï¼Œåœ¨å‚æ•°æä¾›çš„ container æŒ‡å®šä¸€ä¸ª HTML èŠ‚ç‚¹ä½œä¸ºæ¸²æŸ“å®¹å™¨ï¼Œåœ¨å®ƒé‡Œé¢æ¸²æŸ“ä¼ å…¥ React çš„å„ç§å…ƒç´  Elementï¼Œå¹¶è¿”å›å¯¹è¯¥ç»„ä»¶çš„å¼•ç”¨ï¼Œæˆ–è€…é’ˆå¯¹æ— çŠ¶æ€ç»„ä»¶è¿”å› nullã€‚

	ReactDOM.render(element, container[, callback])

æ³¨æ„ Element çš„æ¦‚å¿µï¼Œåƒ HTML ä¸­çš„ `<p>` å°±æ˜¯ä¸€ä¸ª HTMLElementï¼Œè¿˜æœ‰çº¯å­—ç¬¦ä¸²ä¹Ÿç®—æ˜¯ä¸€ç§ã€‚è€Œ React çš„ç»„ä»¶ï¼Œæ— è®ºæ˜¯å‡½æ•°å¼ç»„ä»¶è¿˜æ˜¯ç±»ç»„ä»¶ï¼ŒæŒ‰ç…§è¿™ç§å¸¦æœ‰å°–æ‹¬å·çš„å†™æ³•å°±æ˜¯ä¸€ç§ JSX.Elementã€‚React ä¼šåœ¨å†…éƒ¨å°†å®ƒä»¬æ‹†è§£æˆä¸ºä¸€ç»„æ•°æ®ï¼Œç”¨è™šæ‹ŸèŠ‚ç‚¹ VirtualNode çš„å½¢å¼è¿›è¡Œè·Ÿè¸ªç»´æŠ¤ï¼Œå¯¹åº” ReactNode å¯¹è±¡ã€‚

å¦‚ä»¥ä¸‹æ¸²æŸ“ä¸€ä¸ª Element æ•°ç»„ï¼š

    ReactDOM.render([<h1>xyz</h1>,"ABC"], mountNode);

åœ¨é¡µé¢å®¹å™¨ä¸­å‡ºç°çš„æ¸²æŸ“ç»“æœå°±æ˜¯ä¸¤ä¸ªå¯¹åº”çš„ HTML å…ƒç´ ï¼Œp æ®µè½å…ƒç´ å’Œçº¯æ–‡æœ¬å…ƒç´  PlainTextï¼š

	<div id="example"><h1>xyz</h1>ABC</div>

React ä¼šå°†ä¼ å…¥çš„ Element æ¨¡æ¿ä¼šåœ¨åç»­è§£ææˆä¸€ç»„æ•°æ®ï¼Œå¹¶ä¾› React.createElement() å‡½æ•°è°ƒç”¨å»æ„é€ å‡ºç›¸åº”çš„ HTML èŠ‚ç‚¹ã€‚


å‚è€ƒä»¥ä¸‹ä¸¤ç§å®Œå…¨ç­‰æ•ˆçš„ç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ° createElement æ–¹æ³•ä½¿ç”¨çš„å‚æ•°æ›´æ¥è¿‘çœŸå®çš„ HTML èŠ‚ç‚¹ï¼š

	// JSX style
	const element = (
	  <h1 className="greeting">
	    Hello, world!
	  </h1>
	);

	// JS style
	const element = React.createElement(
	  'h1',
	  {className: 'greeting'},
	  'Hello, world!'
	);

React.createElement() ç”Ÿæˆçš„çš„æ•°æ®å¯¹è±¡ç±»ä¼¼ä»¥ä¸‹ç®€åŒ–åçš„å½¢å¼ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„èŠ‚ç‚¹æ•°æ®ï¼š

	// Note: this structure is simplified
	const element = {
	  type: 'h1',
	  props: {
	    className: 'greeting',
	    children: 'Hello, world!'
	  }
	};

å†æ¯”å¦‚ï¼Œè®¾ç½®æ ·å¼å±æ€§ï¼š

	let dstyle = { 
		background:"#222222", 
		color: "white", 
		padding: "2px 16px 16px", 
		margin: "20%", 
		textAlign: "center",
		borderRadius: "32px",
	};
	const element = <h1 className="greeting" style={dstyle} >Hello, world!</h1>;

å¾—åˆ°çš„æ•°æ®å¯¹è±¡å°±ä¼šåœ¨ props ä¸­åŒ…å«ç›¸åº”çš„æ ·å¼å±æ€§ï¼š

	// Note: this structure is simplified
	const element = {
	  type: 'h1',
	  props: {
	    className: 'greeting',
	    children: 'Hello, world!',
	    style: {
	      background: "#222222",
	      borderRadius: "32px",
	      color: "white",
	      margin: "20%",
	      padding: "2px 16px 16px",
	      textAlign: "center",
	    }
	  }
	};

æ¥çœ‹çœ‹æºä»£ç ä¸­æµ‹è¯•ç”¨çš„å£°æ˜æ–‡ä»¶ä¸­å®šä¹‰çš„ render å’Œ createElement æ–¹æ³•åŸå‹ï¼š

	// React.d.ts 
	declare module 'react' {
	  export class Component {
	    props: any;
	    state: any;
	    context: any;
	    static name: string;
	    constructor(props?, context?);
	    setState(partial : any, callback ?: any) : void;
	    forceUpdate(callback ?: any) : void;
	  }
	  export let PropTypes : any;
	  export function createElement(tag : any, props ?: any, ...children : any[]) : any
	}

	// ReactDom.d.ts 
	declare module 'react-dom' {
	  export function render(element : any, container : any) : any
	  export function unmountComponentAtNode(container : any) : void
	  export function findDOMNode(instance : any) : any
	}

React å°† HTML çš„æ ‡ç­¾å…ƒç´ ã€Component ç»„ä»¶å’Œ FunctionComponent å‡½æ•°å¼ç»„ä»¶ç­‰ç­‰ç»Ÿä¸€æŠ½è±¡ä¸ºå¯ä»¥æ¸²æŸ“çš„ UI å…ƒç´ ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¦‚å¿µã€‚è¿›è€Œæ ¹æ®ä¸åŒçš„å…ƒç´ é‡è½½å‡ºä¸åŒ createElement æ–¹æ³•å®ç°å¯¹åº”çš„æ„é€ è¿‡ç¨‹ï¼Œä½†æ˜¯åŸºæœ¬è¿˜æ˜¯å‡ ä¸ªè¦ç´ ï¼š

- å…ƒç´ å‡ºç°åœ¨é¡µé¢æ—¶çš„ tagï¼›
- å…ƒç´ é…å¥—çš„å±æ€§å€¼ propsï¼›
- å…ƒç´ çš„ä¸‹ä¸€çº§èŠ‚ç‚¹ childrenï¼›

ä»¥ä¸‹æ˜¯æ‘˜è‡ªæºä»£ç ä¸­éƒ¨åˆ† createElement é‡è½½æ–¹æ³•åŸå‹ï¼š

    // DOM Elements
    // TODO: generalize this to everything in `keyof ReactHTML`, not just "input"
    function createElement<P extends DOMAttributes<T>, T extends Element>(
        type: string,
        props?: ClassAttributes<T> & P | null,
        ...children: ReactNode[]): DOMElement<P, T>;


    // Custom components
    function createElement<P extends {}>(
        type: FunctionComponent<P> | ComponentClass<P> | string,
        props?: Attributes & P | null,
        ...children: ReactNode[]): ReactElement<P>;


å¯ä»¥é¢„è®¡çš„æ˜¯ï¼Œæœ€åè¿˜æ˜¯è¦é€šè¿‡æµè§ˆå™¨çš„ DOM API å»æ„é€ å’Œç®¡ç†èŠ‚ç‚¹çš„ï¼š

	document.createElement('div')

å¦‚æœè¦è¿½è¸ªå…·ä½“å®ç°ä»£ç ï¼Œå¯ä»¥ä» React å·¥ç¨‹çš„ç›¸åº”æ¨¡å—ä¸­æŸ¥æ‰¾ï¼Œç›®å‰çš„ç‰ˆæœ¬æ˜¯ react-17.0.0ï¼š

	// react-17.0.0\packages\react-dom\src\client\ReactDOMLegacy.js

	export function render(
	  element: React$Element<any>,
	  container: Container,
	  callback: ?Function,
	) {
	  invariant(
	    isValidContainer(container),
	    'Target container is not a DOM element.',
	  );
	  if (__DEV__) {
	    const isModernRoot =
	      isContainerMarkedAsRoot(container) &&
	      container._reactRootContainer === undefined;
	    if (isModernRoot) {
	      console.error(
	        'You are calling ReactDOM.render() on a container that was previously ' +
	          'passed to ReactDOM.createRoot(). This is not supported. ' +
	          'Did you mean to call root.render(element)?',
	      );
	    }
	  }
	  return legacyRenderSubtreeIntoContainer(
	    null,
	    element,
	    container,
	    false,
	    callback,
	  );
	}

ä»å­—é¢å¯ä»¥çœ‹å‡º legacyRenderSubtreeIntoContainer å¤§è‡´æ„æ€å°±æ˜¯æŠŠè™šæ‹ŸèŠ‚ç‚¹æ ‘ VirtualDOM æ¸²æŸ“åˆ°çœŸå®çš„ Web DOM å®¹å™¨ä¸­ï¼š

	function legacyRenderSubtreeIntoContainer(
	  parentComponent: ?React$Component<any, any>,
	  children: ReactNodeList,
	  container: Container,
	  forceHydrate: boolean,
	  callback: ?Function,
	) {
	  if (__DEV__) {
	    topLevelUpdateWarnings(container);
	    warnOnInvalidCallback(callback === undefined ? null : callback, 'render');
	  }

	  // TODO: Without `any` type, Flow says "Property cannot be accessed on any
	  // member of intersection type." Whyyyyyy.
	  let root: RootType = (container._reactRootContainer: any);
	  let fiberRoot;
	  if (!root) {
	    // Initial mount
	    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(
	      container,
	      forceHydrate,
	    );
	    fiberRoot = root._internalRoot;
	    if (typeof callback === 'function') {
	      const originalCallback = callback;
	      callback = function() {
	        const instance = getPublicRootInstance(fiberRoot);
	        originalCallback.call(instance);
	      };
	    }
	    // Initial mount should not be batched.
	    unbatchedUpdates(() => {
	      updateContainer(children, fiberRoot, parentComponent, callback);
	    });
	  } else {
	    fiberRoot = root._internalRoot;
	    if (typeof callback === 'function') {
	      const originalCallback = callback;
	      callback = function() {
	        const instance = getPublicRootInstance(fiberRoot);
	        originalCallback.call(instance);
	      };
	    }
	    // Update
	    updateContainer(children, fiberRoot, parentComponent, callback);
	  }
	  return getPublicRootInstance(fiberRoot);
	}

å†æ·±å…¥è¿½è¸ª Render çš„ä»£ç å°±æ¶‰åŠ React Fiber éƒ¨åˆ†äº†ï¼Œè¿™é‡Œçš„ fiberRoot å°±æ˜¯æ•´ä¸ª React åº”ç”¨çš„é¡¶çº§ Fiber å¯¹è±¡ï¼ŒFiberRoot å¯¹è±¡ä¸»è¦ç”¨æ¥ç®¡ç†ç»„ä»¶æ ‘ç»„ä»¶çš„æ›´æ–°è¿›ç¨‹ï¼ŒåŒæ—¶è®°å½•ç»„ä»¶æ ‘æŒ‚è½½çš„DOMå®¹å™¨ç›¸å…³ä¿¡æ¯ã€‚



## JSX & Babel å…¥é—¨ 
- Babel ä¸­æ–‡ç½‘ - https://www.babeljs.cn/docs/
- Babel is a JavaScript compiler - https://babeljs.io/
- Using Babel https://babeljs.io/setup#installation
- Babel REPL äº¤äº’å¼è§£é‡Šå™¨ https://babeljs.io/repl
- babel REPL Custom Plugin https://codesandbox.io/s/babel-repl-custom-plugin-7s08o
- Babel with Sublime Text - https://github.com/babel/babel-sublime
- Create a New React App https://reactjs.org/docs/create-a-new-react-app.html

JSX ä»£è¡¨ JavaScript + XMLï¼Œå®ƒçš„æ„ä¹‰æ˜¯å®ç°äº† XML å’Œè„šæœ¬ä»£ç å…±å­˜ï¼Œåœ¨è„šæœ¬ç›´æ¥ä½¿ç”¨ XML èŠ‚ç‚¹æ¥ç¼–å†™ç¨‹åºä¸­çš„ç»„ä»¶ï¼Œè¿™æ˜¯éå¸¸æœ‰è¶£çš„æŠ€æœ¯ï¼š

	const element = <h1>Hello, world!</h1>;

é€šè¿‡è½¬è¯‘ç¨‹åºï¼ŒJSX ç¼–å†™çš„å…ƒç´ ä¼šè½¬è¯‘æˆåŸç”Ÿçš„è„šæœ¬ä»£ç ä¸€è‡´å®ç°ï¼ŒJSX ç¼–å†™äº†ä»€ä¹ˆæ ·çš„ Element å…ƒç´ ï¼Œè½¬è¯‘åå°±æœ‰å¯¹åº”çš„è„šæœ¬ä»£ç å®ç°ï¼Œè¿™æ˜¯è§£æ”¾ç”Ÿäº§åŠ›çš„ä¸€å¤§æŠ€æœ¯ã€‚è¿™æ ·çš„æ··åˆæŠ€æœ¯ä½¿å¾—å¼€å‘è€…å®Œå…¨æ‘†è„±äº†æ—§å¼å­—ç¬¦æ‹¼æ¥ DOM ç»“æ„çš„æŸç¼šï¼Œæˆ–è€…ä½¿ç”¨ jQuery æ¥é›¶æ•£åœ°ç®¡ç† DOMï¼Œä½¿ç”¨ JSX å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç›´æ¥ç¼–å†™ Elements ä¾› React æ¸²æŸ“ã€‚

JSX æ¨¡æ¿è¯­æ³•ï¼Œå¯ä»¥è®°ä½ä¸¤æ¡è§„åˆ™ï¼ŒèŠ±æ‹¬å· `{...}` å†…çš„æ˜¯ JavaScript ä»£ç ï¼Œåœ¨ç®­æ‹¬å· `<...>` å†…çš„å°±æ˜¯æ ‡ç­¾ç»„ä»¶å®šä¹‰ã€‚è¦åœ¨æ ‡ç­¾å…ƒç´ ä¸­å†™ä»£ç å°±éœ€è¦ä½¿ç”¨èŠ±æ‹¬å·ï¼Œåœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥å†™ XML æ ‡ã€‚åœ¨ JSX è¯­æ³•ä¸­ï¼Œä½ å¯ä»¥åœ¨å¤§æ‹¬å·å†…æ”¾ç½®ä»»ä½•æœ‰æ•ˆçš„ JavaScript è¡¨è¾¾å¼ã€‚

é™¤ HTML æ ‡ç­¾ç»„ä»¶å¤–ï¼Œå…¶å®ƒç»„ä»¶åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚React ä¼šå°†ä»¥å°å†™å­—æ¯å¼€å¤´çš„ç»„ä»¶è§†ä¸ºåŸç”Ÿ DOM æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œ`<div />` ä»£è¡¨ HTML çš„ `div` æ ‡ç­¾ï¼Œè€Œ `<Welcome />` åˆ™ä»£è¡¨ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”éœ€åœ¨å…¶ä½œç”¨åŸŸå†…ä½¿ç”¨ã€‚


å› ä¸º JSX è½¬è¯‘åå°±æ˜¯è¾“å‡º JavaScript ä»£ç å®ç°ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥ä¸ç”¨ JSXï¼Œç›´æ¥ç”¨ React æä¾›çš„ DOM æ„å»ºæ–¹æ³•æ¥å†™æ¨¡æ¿ï¼Œæ¯”å¦‚ä¸€ä¸ª JSX å†™çš„ä¸€ä¸ªæ ‡é¢˜å…ƒç´ çš„ç­‰ä»· JSX å’Œ JS ä»£ç ï¼š

	// JSX style
	const element = (
	  <h1 className="greeting">
	    Hello, world!
	  </h1>
	);

	// JS style - Babel Translated
	const element = React.createElement(
	  'h1',
	  {className: 'greeting'},
	  'Hello, world!'
	);

ä»¥ä¸Šï¼Œåªæ˜¯ç»è¿‡ Babel çš„è½¬è¯‘å¾—åˆ°çš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ Babel å°†ä»»æ„ç¬¦åˆè¯­æ³•æ ¼å¼çš„ JSX ä»£ç è¿›è¡Œè½¬è¯‘ï¼Œå¯ä»¥åœ¨çº¿å°è¯• Babel REPL - Read Eval Print Loop äº¤äº’å¼è§£é‡Šå™¨ã€‚

å¦‚åŸå§‹ JSX ä»¥ä¸‹è¿™æ ·ï¼š

	// JSX - JavaScript + XML
	const element = <h1 abc={efg}>Hello, world!</h1>;

	const Fc = (props) => {
	  return props.children;
	}

	class Cc extends Any.Component {
		bar = 'hello';
		static foo = "Apple"
		constructor(props){
			this.props = props;
		}
		render(){
			return <div>{this.props.children}</div>;
		}
	}

	const elements = (props) => {
		let abc = ["A", 1, <Fc name="xyz"/>, <Cc name="xyz"/>];
		return (
			<>
			{abc.length>2 && <b>multiple</b>}
			<div>{abc.map( (it) => <b>{it}</b>) }</div>
			</>
		);
	}

React.createElement æ–¹æ³•åŸå‹å‚è€ƒï¼š

	  export function createElement(tag : any, props ?: any, ...children : any[]) : any

å¯¹åº” JavaScript - Babel React Preset çš„è½¬è¯‘ç»“æœç±»ä¼¼ä»¥ä¸‹ï¼Œæ ¹æ®ä¸åŒçš„é…ç½®ä¼šæœ‰å·®å¼‚ï¼š

	"use strict";

	function _defineProperty(obj, key, value) { 
	    if (key in obj) { 
	        Object.defineProperty(obj, key, { 
	            value: value, 
	            enumerable: true, 
	            configurable: true, 
	            writable: true 
	        }); 
	    } else { 
	        obj[key] = value; 
	    } 
	    return obj;
	}

	const element = /*#__PURE__*/React.createElement("h1", {
	  abc: efg
	}, "Hello, world!");

	const Fc = props => {
	  return props.children;
	};


	class Cc extends Any.Component {
	  constructor(props) {
	    this.props = props;
	  }

	  render() {
	    return /*#__PURE__*/React.createElement("div", null, this.props.children);
	  }
	}

	_defineProperty(Cc, "foo", "Apple");


	const elements = props => {
	  let abc = ["A", 1, 
	    /*#__PURE__*/React.createElement(Fc, {name: "xyz"}), 
	    /*#__PURE__*/React.createElement(Cc, {name: "xyz"})];

	  return /*#__PURE__*/React.createElement(
	    React.Fragment, // Tag
	    null,           // Props and children below
	    abc.length > 2 && 
	    /*#__PURE__*/React.createElement("b", null, "multiple"), 
	    /*#__PURE__*/React.createElement("div", null, abc.map(it => /*#__PURE__*/React.createElement("b", null, it))));
	};

å¯ä»¥çœ‹åˆ°ï¼Œçº¯ç²¹çš„å°–æ‹¬å·å¯¹åº”çš„æ˜¯ React.Fragment ä»£è¡¨çš„æŠ½è±¡èŠ‚ç‚¹ï¼ŒåŸå…ˆçš„ JavaScript è¿˜æ˜¯ä¿ç•™ä¸å˜ï¼Œåªæ˜¯åµŒå…¥çš„ XML æ ‡ç­¾è½¬æ¢æˆäº† React.createElement æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™äº›å°±æ˜¯ Babel åšçš„è½¬è¯‘å·¥ä½œã€‚è€Œ createElement æ–¹æ³•æ¥æ”¶ tag å‚æ•°ä¸­ï¼Œå¯ä»¥æ¥æ”¶çš„ç±»å‹å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š

- Plain Text å³å­—ç¬¦ä¸²æˆ–æ•°å€¼è¿™äº›ä¼šåŸæ ·æ¸²æŸ“çš„å†…å®¹ï¼›
- Function Component å‡½æ•°ç»„ä»¶ï¼Œå°†åŸå‡½æ•°ä¼ å…¥ï¼›
- Class Component ç±»ç»„ä»¶ï¼Œå°†åŸå‡½æ•°ä¼ å…¥ï¼Œç»„ä»¶çš„å±æ€§ä¼ é€’æ–¹å¼ä¸å˜ï¼›


æœ€æ—©ï¼ŒReact æä¾›äº† JSX çš„è½¬è¯‘ç¨‹åºï¼Œä½†æ˜¯åæ¥ Babel åœ¨è½¬è¯‘æ–¹æ³•çš„è´¡çŒ®åšå¾—æ›´å¼ºï¼Œç°åœ¨å‰ç«¯å¼€å‘çš„è½¬è¯‘å·¥ä½œåŸºæœ¬ç”± Babel æ¥åšäº†ã€‚

å½“ç„¶ï¼Œå¯ä»¥æœ‰ JavaScript + XMLï¼Œä¹Ÿå¯ä»¥ TypeScript + XMLï¼Œåªéœ€è¦æ­é…ç›¸åº”çš„å¼€å‘ç¯å¢ƒï¼Œå°† jsx æ–‡ä»¶æ”¹æˆ tsx æ–‡ä»¶æ¥åšå¼€å‘ï¼Œå¹¶ä¸”åè€…å¸¦æ¥çš„é™æ€ç±»å‹æ£€æŸ¥æ‰æ˜¯å¼ºå¤§çš„ã€‚

è¦æ­å»ºä¸€ä¸ªç°ä»£çš„å‰ç«¯å¼€å‘ç¯å¢ƒé…å¥—çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ Grunt / Gulp / Webpack / Broccoliï¼Œéƒ½æ˜¯è¦è§£å†³å‰ç«¯å·¥ç¨‹åŒ–é—®é¢˜ã€‚è¿™ä¸ªä¸»é¢˜å¾ˆå¤§ï¼Œè¿™é‡Œå…³æ³¨åŸºäº Webpack çš„ React JSX å¼€å‘ã€‚ç°åœ¨ä¸šç•Œé¢†å…ˆçš„ ES6 ç¼–è¯‘å·¥å…· Babel éšç€ä½œè€…è¢« Facebook æ‹›å…¥éº¾ä¸‹ï¼Œå·²ç»å†…ç½®äº†å¯¹ JSX çš„æ”¯æŒï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½® Babel ä¸€ä¸ªç¼–è¯‘å·¥å…·å°±å¯ä»¥äº†ï¼Œé…åˆ webpack éå¸¸æ–¹ä¾¿ï¼Œç°æˆçš„å¯ä»¥ç›´æ¥ä½¿ç”¨ Create React App è„šæ‰‹æ¶å·¥å…·ã€‚

Babel ä½œä¸ºä¸€ä¸ª JavaScript è½¬è¯‘å™¨ï¼Œå®ƒå¯ä»¥åšçš„å·¥ä½œå¾ˆå¤šï¼š

- è¯­æ³•è½¬æ¢ï¼ŒBabel èƒ½å¤Ÿè½¬æ¢ JSX è¯­æ³•ä¸ºç›¸åº”çš„ JavaScriptï¼Œè®©æµè§ˆå™¨èƒ½è¿è¡Œï¼
- ç±»å‹æ ‡æ³¨ Type Annotationsï¼Œæ”¯æŒ Flow å’Œ TypeScriptï¼
- å› ä¸ºæµè§ˆå™¨è¿›åŒ–é€Ÿåº¦è·Ÿä¸ä¸Š JavaScript é€Ÿåº¦ï¼Œå¯ä»¥é€šè¿‡ Browser Polyfill åœ¨ç›®æ ‡ç¯å¢ƒä¸­æ·»åŠ ç¼ºå¤±çš„ç‰¹æ€§ï¼Œä½¿ç”¨ @babel/polyfill æ¨¡å—ï¼›
- æºç é‡æ„ codemods...

ä½†åŸºæœ¬çš„è¿˜ç¼–è¯‘å™¨åŸç†ï¼ŒBabel çš„è½¬è¯‘è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š

- å¯¹åŸä»£ç è¿›è¡Œè§£æ parsing ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ç­‰ï¼›
- æ ¹æ®é¢„ç½®è®¾å®šè¿›è¡Œè½¬è¯‘ transformingï¼›
- æœ€åç”Ÿæˆç›¸åº”ä»£ç  generating;

Babel ä½œä¸ºä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ï¼Œè¿™è§£å†³äº†ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œä½¿å¾—æŠ€æœ¯æ›´æ–°æ…¢çš„æµè§ˆå™¨ä¹Ÿå¯ä»¥ç”¨ä¸ŠåŠŸèƒ½å¼ºå¤§ã€å‘å±•æ›´å¿«çš„è„šæœ¬æŠ€æœ¯ã€‚


Babel å¯¹ä¸åŒçš„åŠŸèƒ½é›†åˆæ”¯æŒä¼šæœ‰ç›¸åº”çš„ä¸€ä¸ªé¢„ç½®æ¨¡å— presetï¼Œå®‰è£…ç›¸åº”çš„é¢„ç½®æ¨¡å—æ¥å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œæœ€æ–°ç‰ˆ Babel 7 æä¾›äº†ä»¥ä¸‹å‡ ç§é¢„ç½®ï¼š

- env - æ”¯æŒ JavaScript æ–°ç‰¹æ€§çš„æœ€å°é¢„ç½® https://www.babeljs.cn/docs/babel-preset-env

		npm install --save-dev @babel/preset-env
		yarn add @babel/preset-env --dev

- flow - æ”¯æŒ Flow é™æ€ç±»å‹æ£€æŸ¥ https://www.babeljs.cn/docs/babel-preset-flow

		npm install --save-dev @babel/preset-flow

- minify - æœ€å°åŒ–æ‰“åŒ…æ··æ·† https://www.babeljs.cn/docs/babel-preset-minify

		npm install babel-preset-minify --save-dev

- react - æ”¯æŒ React JSX è¯­æ³• https://www.babeljs.cn/docs/babel-preset-react

		npm install --save-dev @babel/preset-react

- stage-0 ä» Babel v7 å¼€å§‹ï¼Œæ‰€æœ‰é’ˆå¯¹å¤„äºæ ‡å‡†ææ¡ˆé˜¶æ®µçš„åŠŸèƒ½æ‰€ç¼–å†™çš„é¢„è®¾éƒ½å·²è¢«å¼ƒç”¨ï¼Œenv ä¸æ”¯æŒæ‰€æœ‰åœ¨ stage-x çš„ pluginã€‚
- stage-1 Stage 1: proposal
- stage-2 Stage 2: draft
- stage-3 Stage 3: candidate

- typescript - æ”¯æŒ TypeScript é™æ€è¯­è¨€ https://babeljs.io/docs/en/babel-preset-typescript

		npm install --save-dev @babel/preset-typescript


Babel 7 çš„æ›´æ–°ï¼š

- Babel 7 çš„ npm åŒ…æ­£å¼æ›´åä¸º @babel/core @babel/cli ç­‰ã€‚
- Babel 7 ä¸æ”¯æŒ Node.js 0.10, 0.12, 4 å’Œ 5 ç‰ˆæœ¬ã€‚
- Babel 7 ç§»é™¤äº†@babel/polyfill å†…çš„ polyfills æ”¯æŒï¼Œç°åœ¨ @babel/polyfill å‡ ä¹åªæ˜¯ core-js v2 çš„æ˜ å°„ã€‚
- babylon ç°åœ¨è¢«é‡å‘½åä¸º @babel/parser
- å»é™¤åŒ…åä¸Šçš„å¹´ä»½ã€‚
- å°† react å’Œ flow é¢„è®¾åˆ†ç¦»ã€‚


ä¸ºå½“å‰ npm é¡¹ç›®å®‰è£… Babel CLIï¼š

	npm install --save-dev @babel/core @babel/cli

è®¾ç½®é¡¹ç›®è„šæœ¬å‘½ä»¤ï¼š

	  {
	    "name": "my-project",
	    "version": "1.0.0",
	+   "scripts": {
	+     "build": "babel src -d lib"
	+   },
	    "devDependencies": {
	      "@babel/cli": "^7.0.0"
	    }
	  }

è¿è¡Œ Babel è½¬è¯‘ç¨‹åºï¼š

	npm run build



Babel èƒ½å¤Ÿé€šè¿‡ React preset è½¬æ¢ JSX è¯­æ³•ï¼Œå’Œ babel-sublime æ’ä»¶ä¸€èµ·ä½¿ç”¨è¿˜å¯ä»¥æŠŠè¯­æ³•é«˜äº®çš„åŠŸèƒ½æå‡åˆ°ä¸€ä¸ªæ–°çš„æ°´å¹³ã€‚ä½¿ç”¨ Node + Webpack å¼€å‘ç¯å¢ƒï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…æ­¤ preset-react è¿˜æœ‰ babel-loaderï¼š

	npm install --save-dev @babel/preset-react
	npm install --save-dev babel-loader

å¹¶å°† @babel/preset-react æ·»åŠ åˆ°ä½ çš„ Babel é…ç½®æ–‡ä»¶ä¸­ .babelrcï¼š
	
	{
	  "presets": ["env", "stage-0", "react"],
	  "plugins": ["transform-runtime"]
	}

æ·»åŠ  babel-loader é…ç½®é¡¹ï¼š
	
	module: {
	    rules: [
	      { test: /\.js|jsx$/, use: 'babel-loader', exclude: /node_modules/ }
	    ]
	}

Babel å¯ä»¥åˆ é™¤ç±»å‹æ³¨é‡Šï¼Œä¹Ÿå°±æ˜¯è¯´æ”¯æŒ Flow å’Œ TypeScript è¿™æ ·çš„ç±»å‹æ£€æŸ¥ç¼–è¯‘å·¥å…·ï¼ŒæŸ¥çœ‹ Flow preset æˆ– TypeScript preset äº†è§£å¦‚ä½•ä½¿ç”¨ã€‚åŠ¡å¿…ç‰¢è®° Babel ä¸åšç±»å‹æ£€æŸ¥ï¼Œä½ ä»ç„¶éœ€è¦å®‰è£… Flow æˆ– TypeScript æ¥æ‰§è¡Œç±»å‹æ£€æŸ¥çš„å·¥ä½œã€‚

é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… flow preset æˆ– typescript preset

	npm install --save-dev @babel/preset-flow
	npm install --save-dev @babel/preset-typescript

è¿™ä¸¤ä¸ªå·¥å…·éƒ½æœ‰ç›¸å½“ç®€å•çš„æ–¹æ³•ç»™é€ä¸ªæ–‡ä»¶åº”ç”¨ï¼š

- Flow: å‘æ–‡ä»¶é¡¶éƒ¨æ·»åŠ æ³¨é‡Š // @flow æ¥æ¿€æ´» Flow é™æ€ç±»å‹æ£€æŸ¥ï¼› 
- TypeScriptï¼šå°†æ–‡ä»¶æ‰©å±•å .js/.jsx æ›´æ”¹ä¸º .ts/.tsx æ¥æ¿€æ´» TypeScript é™æ€ç±»å‹æ£€æŸ¥ï¼›

ä¾‹å­ï¼š

	// @flow
	function square(n: number): number {
	  return n * n;
	}

	// typescript
	function Greeter(greeting: string) {
	    this.greeting = greeting;
	}

å¯ä»¥åœ¨ HTML é¡µé¢ä¸­ç›´æ¥å¼•ç”¨ Babel CDN è„šæœ¬æ–‡ä»¶æ”¯æŒ JSX è¯­æ³•ï¼Œåœ¨ç¼–å†™ç»„ä»¶çš„è„šæœ¬åŒºï¼Œåªéœ€è¦ä½¿ç”¨ `<script type="text/babel" />` è„šæœ¬æ ‡ç­¾å³å¯ï¼Œè¿™ç§æ–¹æ³•å¾ˆæ–¹ä¾¿ï¼Œèƒ½å¿«é€Ÿç¼–å†™ç¤ºä¾‹ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œè€Œä¸ç”¨æ­å»ºå¼€å‘ç¯å¢ƒã€‚

æ³¨æ„ï¼Œé€šè¿‡ src å¼•ç”¨å¤–éƒ¨ jsx è„šæœ¬æ–‡ä»¶æ™‚ï¼Œéœ€è¦ä½¿ç”¨ AJAXï¼Œå³ XMLHttpRequest åŠ è¼‰ï¼Œéœ€è¦ä»¥ Web æœå‹™æ–¹å¼è¿è¡Œï¼Œæˆ–è€…ä¿®æ”¹æµè§ˆå™¨çš„è·¨ç«™ç­–ç•¥ CORS policy ä»¥æ”¾è¡Œè¿™ç§è·¨ç«™æ–‡ä»¶æ–‡ä»¶ã€‚

	<!DOCTYPE html>
	<html>
		<head>
			<meta charset="utf-8"/>
			<title> Demo for React JSX! </title>
			<script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"> </script> 
			<script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"> </script>
			<script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"> </script>
		</head>
		<body>
			<div id="example"> </div>
		</body>
	</html>

	<script>
		// import React from "react";
		// import {Component} from 'react';
		let Component = React.Component;
		const mountNode = document.getElementById('example')
	</script>

	<script type="text/babel">

		let pstyle = { "border": "1px solid #cccccc"};
		let dstyle = { 
			background:"#222222", 
			color: "white", 
			padding: "2px 16px 16px", 
			margin: "20%", 
			textAlign: "center",
			borderRadius: "32px",
		};

		function Demo(props){
			return <div style={dstyle}>{props.children} {props.dt}</div>
		}

		function Wrap(props){
			return <div>
				<Demo {...props} >
					<p style={pstyle}>Hello</p>
				</Demo>
			</div>
		}

		function render(){
			setInterval(evt=>{
				let dt = Date.now();
				let wrap = <Wrap key="d001" dt={dt} />;
				ReactDOM.unmountComponentAtNode(mountNode)
				ReactDOM.render(wrap, mountNode);
			}, 1000);
		}
		render();
		
	</script>

åœ¨çº¿è¿è¡Œç¤ºä¾‹ï¼š

- MBAä¹¦è®° https://scrimba.com/scrim/cbq2yZhV
- æˆ‘çˆ±ç ç¬” https://codepen.io/jeango/pen/mdrZRao
- ä»£ç æ²™ç›’ https://codesandbox.io/s/patient-cdn-9vw4q?file=/public/index.html


## æ’æ’­ï¼šåœ¨çº¿äº¤äº’æ•™è‚²è½¯ä»¶ç³»ç»Ÿçš„è¦é—»
- ç½‘ç«™å¼€å‘è€…çš„æ„Ÿæƒ³ï¼šWhy we're creating a new video format for code
- å…³äºå¼€å‘è€…çš„é‡‡è®¿ç¨¿ï¼šInterview with Per Harald Borgen https://survivejs.com/blog/scrimba-interview/
- Welcome to Scrimba https://scrimba.com/casts/cast-279
- Official site for Imba https://github.com/imba/imba.io
- 7GUIs: A GUI Programming Benchmark https://eugenkiss.github.io/7guis/
- Learn Vue.js for free https://scrimba.com/learn/learnvue
- Learn React for free https://scrimba.com/learn/learnreact
- Jasmine - A JavaScript Testing Framework https://jasmine.github.io/tutorials/your_first_suite
- 21 Web Dev Tips for 2021 ğŸ‡- with Ania Kubow https://scrimba.com/learn/21tips/tip-4-test-driven-programming-cwwRVJSV
- Introduction to TypeScript with Dylan C. Israel https://scrimba.com/learn/intrototypescript
- ä½ æ‰€éœ€è¦çŸ¥é“çš„ä»£ç æ•´æ´ä¹‹é“ https://zhuanlan.zhihu.com/p/103365961
- Smarter Ways to Generate a Deep Nested HTML Structure by Ana Tudor https://css-tricks.com/smarter-ways-to-generate-a-deep-nested-html-structure/
- https://scrimba.com/learn/flexbox/your-first-flexbox-layout-flexbox-tutorial-canLGCw
- Reactive Player https://ractive-player.org/


Scrimba ä¸åŒäºä¼ ç»Ÿçš„è§†é¢‘æ•™å­¦é™¤äº†è¯„è®ºå°±ä»€ä¹ˆä¹Ÿä¸èƒ½åšï¼ŒScrimba æ˜¯éŸ³é¢‘ã€ç¼–ç è®°å½•å›æ”¾çš„å½¢å¼å±•ç°ï¼Œç”¨æˆ·èƒ½éšæ—¶æš‚åœï¼ŒåŒæ—¶è¿˜èƒ½è¿›è¡Œç¼–è¾‘ï¼Œç»“åˆ discord è¿˜å¯ä»¥åœ¨çº¿äº¤æµã€‚ç¬¬ä¸€æ¬¡è§åˆ°è¿™ç§å¯ç›´æ¥ç¼–è¾‘ä»£ç çš„æ•™å­¦è§†é¢‘ï¼ŒçŸ¥é“å¤§æ¦‚çš„åŸç†å°±æ˜¯è®°å½•æ‰€æœ‰çš„é”®ç›˜å’Œé¼ æ ‡äº‹ä»¶å¹¶é‡ç»˜ DOMï¼Œå½“ç„¶éŸ³è½¨ä¹Ÿè¦ä¿æŒåŒæ­¥ã€‚è¿™ç§åŸºäºäº‹ä»¶å›æ”¾ï¼Œæ²¡æœ‰ä»»ä½•åƒç´ ç‚¹çš„å½•åˆ¶æ–¹å¼èŠ‚çº¦äº†ä¸å°‘æµé‡ï¼Œæ’­æ”¾è¿‡ç¨‹ä¹Ÿååˆ†æµç•…ï¼Œæœ€é‡è¦çš„æ˜¯å¯äº¤äº’å¼çš„å›æ”¾ï¼Œç±»ä¼¼çš„æŠ€æœ¯æœ€æ—©ä» OpenCanvas ç»˜å›¾è½¯ä»¶è§è¯†è¿‡ã€‚

æ¥çœ‹çœ‹åˆ›å§‹äººå¯¹é‡‡è®¿çš„é—®ç­”ï¼š

> How would you describe Scrimba to someone who has never heard of it?
> Scrimba is an interactive video format for communicating code. It makes the experience significantly better for both the creator and the viewer. The easiest way to understand Scrimba is to watch the 1 minute screencast below:
> 
> Welcome to Scrimba https://scrimba.com/casts/cast-279
> 
> As a viewer, you can pause and edit the code at any given time. So if you're struggling to understand something, just hit pause, jump into the environment and play around with the code until you understand it properly.
> 
> Scrimba also makes the creation experience much less frustrating, as we remove all the hassle involved with creating coding screencasts. No more setup, edit, encode, upload and re-encode. Just code while you talk and then publish it instantly.
> 
> How does Scrimba work?
> We record the underlying events instead of pixels. When replaying a Scrimba screencast, we recreate exactly what the creator did.
> 
> This opens up a whole new world of possibilities for interactivity, creation, responsiveness, search, and recommendations. We've only begun scratching the surface of what we can do with this format.

> How does Scrimba differ from other solutions?
> Compared to traditional video, Scrimba has the following benefits:
> 
> Much easier to create
> Interactive (viewer can pause and edit code)
> 1% file size of video
> Better mobile experience (because of responsiveness)
> Indexable/searchable


è¿™çœŸæ˜¯ä¸€ä¸ªç¥å¥‡çš„ç½‘ç«™ï¼Œæ–°æ‰‹æ‰¾æ•™ç¨‹ï¼Œè€é¸Ÿæ‰¾çµæ„Ÿ Scrimba - Interactive Screencasts Created in an Instantï¼

Scrimba æ˜¯ä¸€ä¸ªå¼€å‘è€…å›¢é˜Ÿçš„å±å¹•ç›´æ’­æµåˆ†äº«å·¥å…·ï¼Œæœ‰è‡ªä¸»çš„åŸºäºä»£ç çš„ç§°ä¸º scrims çš„è§†é¢‘æ ¼å¼ã€‚Scrimba AS æ€»éƒ¨ä½äºæŒªå¨å¥¥æ–¯é™†ï¼Œæ ¸å¿ƒå›¢é˜Ÿç”± 6 äººç»„æˆï¼Œå¾—åˆ°äº† StartupLabã€åŒ—æ¬§åˆ¶é€ å•†ã€Alliance Venture å’Œ Amasia çš„æ”¯æŒã€‚

Scrims è¿™ç§è§†é¢‘æ ¼å¼æ˜¯äº¤äº’å¼çš„ï¼Œåœ¨å®˜ç½‘ç¼–è¾‘æ—¶ä»¥ Note æ˜¾ç¤ºï¼Œæ¯ä¸€ä¸ª Note éƒ½æ˜¯åŸºæœ¬ç»„ç»‡å•å…ƒï¼Œæ¯ä¸ª Note éƒ½æ˜¯å¯åµŒå¥—çš„ï¼Œå¯ä»¥ä¸€å±‚ Note å¥—ç€å¤šä¸ªå­ Noteã€‚æ¯ä¸ª Note æœ‰å¸¦å£°éŸ³çš„å½•åˆ¶çŠ¶æ€ï¼Œå’Œéå½•åˆ¶çŠ¶æ€ã€‚å½•åˆ¶çŠ¶æ€çš„ Note å¯ä»¥æ’­æ”¾é‡ç°åŸæ¥çš„äº¤äº’åŠ¨ä½œè®°å½•ï¼Œè€Œä¸å¸¦å½•åˆ¶çš„ Note å°±æ˜¯ä¸€ä¸ªåŸæ ·å±•ç¤ºçš„å†…å®¹ï¼Œæ¯ä¸ª Note éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ª URL åˆ†äº«ã€‚

åœ¨ Note è¿›è¡Œæ“ä½œæ—¶ä¼šè‡ªåŠ¨è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œå¦‚æœå‰é¢æ²¡æœ‰æ­£åœ¨ç¼–è¾‘ä¸­çš„ Noteï¼Œè¿™ä¸ªæ“ä½œä¼šäº§ç”Ÿä¸€ä¸ªæ–° Noteï¼Œç¼–è¾‘å®Œæˆåå°±å¯ä»¥å°†è¿™ä¸ª Note è®¾ç½®ä¸ºç¡®è®¤çŠ¶æ€ï¼Œæœªç¡®è®¤ä¿®æ”¹çš„ Note ä¼šåœ¨é€€å‡ºåå°±ä¸¢å¤±ã€‚

Scrims è¿™ç§ç»“æ„ç±»ä¼¼ Git çš„åˆ†æ”¯ç»“æ„ï¼Œä½†è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ Note å¦‚ä½•åˆå¹¶ï¼Œæ¯•ç«Ÿ Scrims ä¸æ˜¯ Gitã€‚

ä»¥ä¸Šæ˜¯ Scrimba å®˜ç½‘ç›®å‰å…è´¹ä½¿ç”¨çš„ç‰ˆæœ¬çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥åˆ¶ä½œå…è´¹çš„å†…å®¹ã€‚æ”¶è´¹çš„ä¸“ä¸šç‰ˆæœ¬å¯ä»¥å‚åŠ æ‰€æœ‰çš„è¯¾ç¨‹ï¼Œè®­ç»ƒè¥å’ŒèŒä¸šé“è·¯ï¼Œä¸çŸ¥é“å¯ä»¥ä¸å¯ä»¥å‘å¸ƒæ”¶è´¹çš„æ•™å­¦å†…å®¹ï¼š

- Monthly 60$
- Semester 360$
- Annual 601$

æ•´ä¸ªå®˜ç½‘å°±æ˜¯ä¸€ä¸ªè¯¾ç¨‹èµ„æºåŠ å†…å®¹åˆ¶ä½œå·¥å…·ï¼Œç¼–è¾‘ç•Œé¢ä¸»è¦æ˜¯ç¼–ç¨‹ IDE ç¯å¢ƒï¼Œé™¤äº†åŸºæœ¬çš„ HTML, CSS, JavaScriptï¼Œå·²ç»æ”¯æŒ Pythonã€TypeScriptã€Imba ç­‰ç¼–ç¨‹è¯­è¨€ï¼Œè¿˜æœ‰ Reactã€Vueã€Angularã€Mithril.jsã€Svelteã€jQuery ç­‰ç­‰å¼€å‘å·¥å…·ã€‚

ç›®å‰ä¸»è¦ä¸ºå¼€å‘è€…æä¾›æ•™å­¦å†…å®¹ï¼Œä½†å¯ä»¥æƒ³è±¡çš„æ˜¯å…¶å®ƒé¢†åŸŸä¹Ÿå¯ä»¥å®ç°ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æœ‰å‰æ™¯çš„é¡¹ç›®ï¼Œä»å¼€å‘å›¢é˜Ÿæ”¶åˆ°çš„èµ„æœ¬æ”¯æŒä¹Ÿå¯ä»¥æ¨æ–­è¿™åˆ°ç‚¹ã€‚


Scrimba ç›®å‰åœ¨å®ç°ä¸Šè¿˜æœ‰äº›é—®é¢˜ï¼Œå¦‚æ’­æ”¾æœ‰æ—¶å‡ºé—®é¢˜ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨é—®é¢˜ã€‚é€‰æ‹©æ¨¡æ¿æ—¶ï¼Œåªèƒ½å•é€‰ï¼Œæ¯”å¦‚ä¸èƒ½åŒæ—¶é€‰æ‹© TypeScript å’Œ Reactã€‚å¦‚æœé€‰æ‹©äº† TypeScript å†æ·»åŠ  React ä¾èµ–ä¹Ÿä¸èƒ½æ­£å¸¸ import å¯¼å…¥ï¼Œéœ€è¦æŒ‰ä»¥ä¸‹æ–¹å¼ï¼Œè€Œä¸” ReactDOM è¿˜ä¸èƒ½å¯¼å…¥ï¼ŒæœåŠ¡å™¨ç¨³å®šæ€§ä¸å¤Ÿï¼š

	import * as React from 'react';
	import * as ReactDOM from 'react-dom';


Imba è¯•ç”¨ï¼š

	npm install -g imba@2.0.0-alpha.109
	git clone --bare https://github.com/imba/imba-starter-app
	cd imba-starter-app
	imba -w server.imba


### ğŸ‘‰ Scrimba æœ¬åœ°ç›´æ’­

Scrimba ä¾èµ–æŠ€æœ¯ï¼š

- Introduction Imba https://imba.io/language/introduction
- Imba - The friendly full-stack language https://github.com/imba/imba
- ESBuild https://github.com/evanw/esbuild
- Scrimba CLI for scrimcasting from your local environment https://cnpmjs.org/package/scrimba
- Web Terminal Emulators https://github.com/microsoft/node-pty
- Xterm.js - Terminal å‰ç«¯ç»„ä»¶ https://github.com/microsoft/xterm.js
- Xterm.js - Terminal front-end component https://www.npmjs.com/package/vscode-xterm
- node-pty - Fork pseudoterminals in Node.JS https://www.npmjs.com/package/node-pty
- Windows conpty API https://devblogs.microsoft.com/commandline/windows-command-line-introducing-the-windows-pseudo-console-conpty/
- winpty library https://github.com/rprichard/winpty
- node-pty-prebuilt GitHub release https://github.com/daviwil/node-pty-prebuilt/releases
- Monaco Editor https://microsoft.github.io/monaco-editor/
- Windows Terminal é€‰é¡¹å¡é£æ ¼æ§åˆ¶å° https://github.com/microsoft/Terminal


Scrimba å‘½ä»¤è¡Œå·¥å…·æä¾›çš„åŠŸèƒ½ï¼š

- Live stream your local dev environment to a URL
- Collaborate in real-time and discuss via voice chat
- Keep a recording of the session afterwards
- The most popular use-cases are code review, onbarding, and documentation.


All features

- Codebase, terminal and browser sharing
- Real-time collaboration
- Mouse pointer for each participant
- Voice chat
- Conferences (up to 4 people)
- Record sessions
- Dashboard for recorded sessions


Quick-start

	# install the CLI
	$ npm -g install scrimba

	# navigate to your project
	$ md scrimba-demo && cd scrimba-demo

	# start a live stream
	$ scrimba start

è¿è¡Œåå°±ä¼šåœ¨ Chrome æ‰“å¼€ä¸€ä¸ª scrimï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡ scrim äº¤äº’ï¼Œç¼–è¾‘å’Œä¿å­˜æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ URL åˆ†äº«æœ¬åœ°çš„å·¥ä½œç¯å¢ƒã€‚

æœ€åè¿˜æ˜¯è”æ¥ä¸ä¸Š scrimba æœåŠ¡å™¨ï¼š

	Ã— Could not connect to https://scrimba.com:9000


### ğŸ‘‰ Monaco Editor
- Monaco Editor ä»‹ç» https://zhuanlan.zhihu.com/p/47746336
- Monaco Editor https://microsoft.github.io/monaco-editor/
- microsoft.github.io/monaco-editor ç«™ç‚¹æºä»£ç  https://github.com/Microsoft/monaco-editor
- Learn how to integrate the editor with these [complete samples](https://github.com/Microsoft/monaco-editor-samples/).
- NPM Package monaco-editor  https://www.npmjs.com/package/monaco-editor
- Monaco Editor Samples https://github.com/microsoft/monaco-editor-samples

å¾®è½¯æœ‰ä¸ªé¡¹ç›®å«åš Monaco Workbenchï¼Œåæ¥è¿™ä¸ªé¡¹ç›®å˜æˆäº† VSCodeï¼Œè€Œ Monaco Editor å°±æ˜¯ä»è¿™ä¸ªé¡¹ç›®ä¸­æˆé•¿å‡ºæ¥çš„ä¸€ä¸ª Web ç¼–è¾‘å™¨ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†çš„ä»£ç  monaco-editor-core éƒ½æ˜¯å…±ç”¨çš„ï¼Œæ‰€ä»¥ monaco å’Œ VSCode åœ¨ç¼–è¾‘ä»£ç ï¼Œäº¤äº’ä»¥åŠ UI ä¸Šå‡ ä¹æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ã€‚

æœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œä¸¤è€…çš„å¹³å°ä¸ä¸€æ ·ï¼Œmonaco åŸºäºæµè§ˆå™¨ï¼Œè€Œ VSCode åŸºäº electronï¼Œæ‰€ä»¥åŠŸèƒ½ä¸Š VSCode æ›´åŠ å¥å…¨ï¼Œå¹¶ä¸”æ€§èƒ½æ¯”è¾ƒå¼ºå¤§ã€‚

- Rich IntelliSense, Validation

	TypeScript, JavaScript, CSS, LESS, SCSS, JSON, HTML

- Basic Syntax Colorization 

	XML, PHP, C#, C++, Razor, Markdown, Diff, Java, VB, CoffeeScript, Handlebars, Batch, Pug, F#, Lua, Powershell, Python, Ruby, SASS, R, Objective-C


NPM ä¸Šå‘å¸ƒçš„ monaco-editor æ¨¡å—åŒ…å«å†…å®¹ï¼š

- esm ç›®å½•åŒ…å« ESM æ¨¡å—æ‰“åŒ…å³ ES è„šæœ¬åŸç”Ÿæ¨¡å—ï¼Œæ”¯æŒ webpackï¼›
- dev ç›®å½•åŒ…å« AMD å¼‚æ­¥åŠ è½½æ¨¡å—æ‰“åŒ…ï¼Œunminified æ–‡ä»¶ï¼›
- min ç›®å½•åŒ…å« AMD å¼‚æ­¥åŠ è½½æ¨¡å—æ‰“åŒ…ï¼Œminified æ–‡ä»¶ï¼›
- min-maps ç›®å½•åŒ…å«æºä»£ç è°ƒè¯•åœ°å›¾æ–‡ä»¶ï¼›
- monaco.d.ts ä¸º TypeScript ä½¿ç”¨çš„ API åŸå‹å£°æ˜æ–‡ä»¶ï¼›

æœ€å¥½çš„å­¦ä¹ æ–¹æ³•æ˜¯ç ”ç©¶ microsoft.github.io/monaco-editor ç«™ç‚¹ä»£ç ï¼Œè¿˜æœ‰æ–‡æ¡£ã€‚ç«™ç‚¹å·¥ç¨‹ä½¿ç”¨ gulp è€Œä¸æ˜¯ webpack ä½œä¸ºæ‰“åŒ…æœºã€‚


#### Gulp æ‰“åŒ…æœºä½¿ç”¨
- Gulp - A toolkit to automate & enhance your workflow https://gulpjs.com/docs/en/getting-started/quick-start
- Gulp å…¥é—¨æŒ‡å— https://www.gulpjs.com.cn/docs/getting-started/quick-start/


å‰ç«¯çš„æ„å»ºå·¥å…·å¸¸è§çš„æœ‰ Gruntã€Gulpã€Webpack ä¸‰ç§ï¼ŒGrunt æ¯”è¾ƒè€æ—§ï¼ŒåŠŸèƒ½å°‘ï¼Œæ›´æ–°å°‘ï¼Œæ’ä»¶å°‘ã€‚

Gulp ä½œä¸ºä¸€ä¸ªè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œä¸»è¦ç”¨æ¥è®¾å®šç¨‹åºè‡ªåŠ¨å¤„ç†é™æ€èµ„æºçš„å·¥ä½œï¼Œç”¨è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·å¢å¼ºä½ çš„å·¥ä½œæµç¨‹ï¼

Gulp æ˜¯åŸºäºä»»åŠ¡å¯¼å‘çš„å·¥å…·ï¼Œä¸ç®¡åšä»€ä¹ˆåŠŸèƒ½ï¼Œå¿…é¡»å»æ³¨å†Œä¸€ä¸ªä»»åŠ¡ï¼Œç„¶åå»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œç¼–å†™ä»»åŠ¡ä»£ç åšéœ€è¦åšçš„åŠŸèƒ½ã€‚Gulp çš„æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œå‹ç¼© CSS çš„ä»»åŠ¡ã€åˆå¹¶æ–‡ä»¶çš„ä»»åŠ¡ç­‰ï¼ŒGulp è§„å®šä»»åŠ¡è¦å†™åœ¨å…¥å£è„šæœ¬ä¸­ glupfile.jsï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç”¨æ¥é…ç½®æ‰€æœ‰ä»»åŠ¡ã€‚

Gulp æ˜¯åŸºäºæµå¼å·¥ä½œçš„å·¥å…·ï¼Œè¿›è¡Œé¡¹ç›®æ„å»ºçš„æ—¶å€™ï¼Œä¼šå°†æœ¬åœ°æ–‡ä»¶æ•°æ®è¯»å–åˆ°å†…å­˜ï¼Œæ¥ä¸‹æ¥çš„æ“ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œæ“ä½œå®Œæˆä»¥åï¼Œå†ä»å†…å­˜ä¸­è¾“å‡ºåˆ°æœ¬åœ°ã€‚æ¯”å¦‚è¯´å½“æˆ‘ä»¬è¦åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå…ˆå°†è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨å†…å­˜ä¸­è¿›è¡Œåˆå¹¶ï¼Œæœ€åå°†åˆå¹¶åçš„å†…å®¹ä»å†…å­˜ä¸­è¾“å‡ºåˆ°æœ¬åœ°çš„æ–‡ä»¶ä¸­ã€‚è¿™æ ·ï¼Œå¯¹åº”ç€ä¸¤ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ˜¯è¾“å…¥ï¼Œä¸€ä¸ªè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ I/O æ“ä½œã€‚

Gulp å…è®¸ä½ ä½¿ç”¨ç°æœ‰ JavaScript çŸ¥è¯†æ¥ä¹¦å†™ gulpfile æ–‡ä»¶ï¼Œæˆ–è€…åˆ©ç”¨ä½ æ‰€æŒæ¡çš„ gulpfile ç»éªŒæ¥ä¹¦å†™æ™®é€šçš„ JavaScript ä»£ç ã€‚è™½ç„¶ gulp æä¾›äº†ä¸€äº›å®ç”¨å·¥å…·æ¥ç®€åŒ–æ–‡ä»¶ç³»ç»Ÿå’Œå‘½ä»¤è¡Œçš„æ“ä½œï¼Œä½†æ˜¯ä½ æ‰€ç¼–å†™çš„å…¶ä»–ä»£ç éƒ½æ˜¯çº¯ JavaScript ä»£ç ã€‚

Gulpfile å…¥å£è„šæœ¬æ˜¯é¡¹ç›®ç›®å½•ä¸‹åä¸º gulpfile.js æˆ–è€…é¦–å­—æ¯å¤§å†™ï¼Œå°±åƒ Makefile ä¸€æ ·å‘½åçš„æ–‡ä»¶ï¼Œåœ¨è¿è¡Œ gulp å‘½ä»¤æ—¶ä¼šè¢«è‡ªåŠ¨åŠ è½½ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ ç»å¸¸ä¼šçœ‹åˆ°ç±»ä¼¼ src()ã€dest()ã€series() æˆ– parallel() å‡½æ•°ä¹‹ç±»çš„ APIã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJavaScript ä»£ç æˆ– Node æ¨¡å—ä¹Ÿä¼šè¢«ä½¿ç”¨ã€‚ä»»ä½•å¯¼å‡º export çš„å‡½æ•°éƒ½å°†æ³¨å†Œåˆ° gulp çš„ä»»åŠ¡ task ç³»ç»Ÿä¸­ã€‚

å¯ä»¥ä½¿ç”¨éœ€è¦è½¬è¯‘çš„ç¼–ç¨‹è¯­è¨€æ¥ä¹¦å†™ gulpfile æ–‡ä»¶ï¼Œä¾‹å¦‚ TypeScript æˆ– Babelï¼Œé€šè¿‡ä¿®æ”¹ gulpfile.js æ–‡ä»¶çš„æ‰©å±•åæ¥è¡¨æ˜æ‰€ç”¨çš„ç¼–ç¨‹è¯­è¨€å¹¶å®‰è£…å¯¹åº”çš„è½¬è¯‘æ¨¡å—ã€‚

- å¯¹äº TypeScriptï¼Œé‡å‘½åä¸º gulpfile.ts å¹¶å®‰è£… ts-node æ¨¡å—ã€‚
- å¯¹äº Babelï¼Œé‡å‘½åä¸º gulpfile.babel.js å¹¶å®‰è£… @babel/register æ¨¡å—ã€‚


æ¯ä¸ªä»»åŠ¡ task å¯ä»¥è¢«åˆ†å‰²ä¸ºç‹¬ç«‹çš„æ–‡ä»¶ï¼Œç„¶åå¯¼å…¥ import åˆ° gulpfile æ–‡ä»¶ä¸­å¹¶ç»„åˆã€‚è¿™ä¸ä»…ä½¿äº‹æƒ…å˜å¾—äº•ç„¶æœ‰åºï¼Œè€Œä¸”å¯ä»¥å¯¹æ¯ä¸ªä»»åŠ¡ task è¿›è¡Œå•ç‹¬æµ‹è¯•ï¼Œæˆ–è€…æ ¹æ®æ¡ä»¶æ”¹å˜ç»„åˆã€‚

å¦å¤– Node çš„æ¨¡å—è§£æåŠŸèƒ½å…è®¸ä½ ç”¨ç›¸åŒå‘½åçš„ gulpfile.js ç›®å½•æ›¿ä»£åŸæ¥çš„è„šæœ¬æ–‡ä»¶ï¼Œåªè¦è¯¥ç›®å½•ä¸­åŒ…å«ä¸€ä¸ªåä¸º index.js çš„æ–‡ä»¶ã€‚åœ¨å¯¼å…¥æ—¶ï¼Œè¯¥æ–‡ä»¶è¢«å½“ä½œ gulpfile.js ä½¿ç”¨ã€‚å¹¶ä¸”ï¼Œè¯¥ç›®å½•ä¸­è¿˜å¯ä»¥åŒ…å«å„ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ task æ¨¡å—ã€‚


æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… Gulpï¼Œå¦‚æœå› ä¸ºæ¨¡å—ä¾èµ–é—®é¢˜å¯¼è‡´å®‰è£…å¤±è´¥ï¼Œå°è¯• -f å¼ºåˆ¶å®‰è£…ã€‚

	npm rm --global gulp

	npm install gulp-cli -g
	npm install gulp --save-dev

	npm install -g -f gulp-cli

åˆ›å»ºå·¥ç¨‹å’Œè¿›è¡Œæµ‹è¯•ï¼š

	npx mkdirp my-project
	cd my-project
	
	#Create a package.json file in your project directory
	npm init

	#Install the gulp package in your devDependencies
	npm install --save-dev gulp

	#Verify your gulp versions
	gulp --version

åˆ›å»ºå…¥å£è„šæœ¬ gulpfile.jsï¼š

	function defaultTask(cb) {
	  // place code for your default task here
	  cb();
	}

	exports.default = defaultTask

åœ¨å·¥ç¨‹ç›®å½•ä¸‹è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼š

	gulp



#### åŸºæœ¬ä½¿ç”¨

å®‰è£… monaco

	npm install monaco-editor --save-dev
	npm install monaco-editor-webpack-plugin --save-dev


ç„¶ååœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­å¼•å…¥ monacoï¼Œè¿™é‡Œä¸éœ€è¦å…¨éƒ¨å¼•å…¥ï¼Œåªéœ€è¦å¼•å…¥è‡ªå·±éœ€è¦ä½¿ç”¨çš„åŠŸèƒ½æ¨¡å—å³å¯ã€‚

	HTML

	<div id="monaco"> </div>

	JS

	import * as monaco from 'monaco-editor/esm/vs/editor/editor.api.js';
	const monacoInstance = monaco.editor.create(document.getElementById("monaco"),{
	    value:`console.log("hello,world")`,
	    language:"javascript"
	})
	monacoInstance.dispose();

æˆ‘ä»¬è®¾ç½®äº†è¯­è¨€ä¸ºjavascriptï¼Œç•Œé¢æ˜¯å‡ºæ¥äº†ï¼Œä½†æ˜¯å´å‘ç°æ²¡æœ‰è¯­æ³•é«˜äº®ï¼Œè¾“å…¥å‘½ä»¤å‘ç°å…¶å®æ ¹æœ¬æ²¡æœ‰javascriptè¯­è¨€ï¼Œåªæœ‰ä¸€ä¸ªæœ€åŸºç¡€çš„plaintextã€‚

åƒä½¿ç”¨ VSCode ä¸€æ ·ä½¿ç”¨ monacoï¼ŒæŒ‰ä¸‹ Ctrl+F æ¥æ‰§è¡Œæ–‡æœ¬æŸ¥æ‰¾ï¼Œéœ€è¦å¼•å…¥æŸ¥æ‰¾æ§ä»¶ï¼š

	import 'monaco-editor/esm/vs/editor/contrib/find/findController.js';

monaco è¿˜æœ‰è®¸å¤šè¿™ç±»æ§ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰éœ€å¼•å…¥è‡ªå·±ç”¨åˆ°çš„ã€‚

ä¸è¿‡æœ‰ä¸€ä¸ªæ›´åŠ ç®€ä¾¿çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ç›´æ¥å¼•å…¥ main æ–‡ä»¶æ¥ä»£æ›¿å•ä¸ª API æ–‡ä»¶ã€‚

	import * as monaco from 'monaco-editor/esm/vs/editor/editor.main.js';


	// editor.main.js
	import '../language/typescript/monaco.contribution';
	import '../language/css/monaco.contribution';
	import '../language/json/monaco.contribution';
	import '../language/html/monaco.contribution';
	import '../basic-languages/monaco.contribution';

	export * from './edcore.main';

é‡‡ç”¨è¿™ç§æ–¹å¼å¼•å…¥çš„è¯ï¼Œä¼šè‡ªåŠ¨å¸¦ä¸Šæ‰€æœ‰çš„å†…ç½®è¯­è¨€å’Œæ§ä»¶ï¼Œå”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯åŒ…çš„ä½“ç§¯è¿‡å¤§ã€‚

ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªå¯ä»¥è¾“å…¥ï¼Œé«˜äº®ï¼ŒæŸ¥æ‰¾çš„webç¼–è¾‘å™¨ï¼Œä½†æ˜¯ï¼Œå’ŒVSCodeæ¯”è¾ƒèµ·æ¥ï¼Œè¿˜å°‘äº†è®¸å¤šé‡è¦çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ä»£ç è¡¥å…¨ï¼Œé”™è¯¯æç¤ºä»¥åŠå¿«æ·å‘½ä»¤åŠŸèƒ½ç­‰ã€‚


é¦–å…ˆï¼Œæˆ‘ä»¬è‡ªå·±å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œå‡å¦‚è¦è‡ªå·±æ¥å®ç°ä»£ç è¡¥å…¨ä»¥åŠé”™è¯¯æç¤ºï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆåšï¼Ÿ

ç¬¬ä¸€ï¼Œæˆ‘ä»¬è¦è§£æè¾“å…¥çš„æ–‡æœ¬ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å†™ä¸€ä¸ªParserã€‚
ç¬¬äºŒï¼Œæ ¹æ®Parserè§£æçš„ç»“æœæ¥è°ƒç”¨monacoçš„æ ‡æ³¨æ¥å£æ¥æ ‡æ³¨é”™è¯¯çš„ä»£ç ä»è€Œå®ç°é”™è¯¯æç¤ºåŠŸèƒ½
ç¬¬ä¸‰ï¼Œæ ¹æ®Parserè§£æçš„ç»“æœä¿¡æ¯ï¼Œæä¾›ä¸Šä¸‹æ–‡ç›¸å…³çš„ä»£ç å€™é€‰é¡¹æ¥å®ç°ä»£ç è¡¥å…¨åŠŸèƒ½ã€‚

å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ç°èµ·æ¥éš¾åº¦ä¼šå¾ˆå¤§ï¼Œæ¶‰åŠåˆ°çš„ç‚¹å¾ˆå¤šï¼Œä¸è¿‡ï¼Œå’Œè¯­æ³•é«˜äº®ä¸€æ ·ï¼Œmonaco ä¹Ÿå¸®åŠ©æˆ‘ä»¬å®ç°äº†è¿™äº›åŠŸèƒ½ï¼Œç›®å‰æ”¯æŒ htmlï¼Œcssï¼Œts/jsï¼Œjson å››ç§è¯­è¨€ï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥å³å¯ï¼Œä½†æ˜¯å¼•å…¥å¯æ²¡æœ‰è¯­æ³•é«˜äº®é‚£ä¹ˆç®€å•ã€‚

Monaco çš„å®ç°é‡‡ç”¨ worker çš„æ–¹å¼ï¼Œå› ä¸ºè¯­æ³•è§£æéœ€è¦è€—è´¹å¤§é‡æ—¶é—´ï¼Œæ‰€ä»¥ç”¨ worker æ¥å¼‚æ­¥å¤„ç†è¿”å›ç»“æœæ¯”è¾ƒé«˜æ•ˆã€‚

æˆ‘ä»¬ä½¿ç”¨çš„è¯éœ€è¦ä¸¤æ­¥ï¼Œå…ˆæä¾›ä¸€ä¸ªå®šä¹‰ worker è·¯å¾„çš„å…¨å±€å˜é‡

	window.MonacoEnvironment = {
	 getWorkerUrl: function (moduleId, label) {
	  if (label === 'json') {
	    return './json.worker.js';
	 }
	  if (label === 'css') {
	   return './css.worker.js';
	  }
	  if (label === 'html') {
	   return './html.worker.js';
	  }
	  if (label === 'typescript' || label === 'javascript') {
	   return './typescript.worker.js';
	  }
	  if(label==="sql"){
	   return "./sql.worker.js";
	  }
	  return './editor.worker.js';
	  }
	}

é€‰æ‹©å¯¹åº”çš„ languageï¼Œmonaco ä¼šå»è°ƒç”¨ getWorkerUrl å»æŸ¥ worker çš„è·¯å¾„ï¼Œç„¶åå»åŠ è½½ã€‚è¿™è¾¹é»˜è®¤ä¼šåŠ è½½ä¸€ä¸ª editor.worker.jsï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºç¡€åŠŸèƒ½æ–‡ä»¶ï¼Œæä¾›äº†æ‰€æœ‰è¯­è¨€é€šç”¨çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚å·²å®šä¹‰å¸¸é‡çš„ä»£ç è¡¥å…¨æç¤ºï¼‰ï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆè¯­è¨€ï¼Œmonaco éƒ½ä¼šå»åŠ è½½ä»–ã€‚

åœ¨ webpack ä¸­å¼•å…¥éœ€è¦çš„ worker

	 entry: {
	      "main": path.resolve(process.cwd(), "src/main.js"),
	      "editor.worker": 'monaco-editor/esm/vs/editor/editor.worker.js',
	      "ts.worker": 'monaco-editor/esm/vs/language/typescript/ts.worker',
	    },


å¥½äº†ï¼Œå¼€å§‹åœ°ç‹±æ¨¡å¼ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°éå¸¸å¤šçš„é—®é¢˜ã€‚

é—®é¢˜ä¸€. æˆ‘ä»¬çš„è¾“å‡ºä¸€èˆ¬æ˜¯åŠ  hash çš„ï¼Œæ‰€ä»¥ï¼Œè¾“å‡ºçš„ worker æ–‡ä»¶ä¹Ÿä¼šæœ‰å¯¹åº”çš„ hash å€¼åç¼€ï¼Œä¾‹å¦‚ typescript.worker.a23sf4asfqw.jsï¼Œé‚£ä¹ˆï¼Œç¬¬ä¸€æ­¥ä¸­çš„ getWorkerUrl ä¸­çš„é…ç½® typescript.worker.js å°±å’Œä»–å¯¹ä¸ä¸Šäº†ï¼Œå¯¼è‡´æŸ¥æ‰¾ worker è·¯å¾„å¤±è´¥ã€‚

é—®é¢˜äºŒ. worker æ˜¯è¿è¡Œåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ window å˜é‡ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ webpack çš„å…¨å±€å˜é‡ä¸º self æ‰å¯ä»¥ã€‚

é—®é¢˜3. å‡å¦‚ä½¿ç”¨ html-webpack-plugin æ’ä»¶ï¼Œæˆ‘ä»¬å°±è¦é˜²æ­¢ worker è¢«ç›´æ¥å¼•å…¥ html æ–‡ä»¶ï¼ˆå› ä¸º worker ä¹Ÿæ˜¯å•ç‹¬çš„ entryï¼‰ï¼Œå› æ­¤è¿˜éœ€è¦è®¾ç½® html-webpack-plugin çš„ chunksã€‚

....

ä¸å¾—ä¸è¯´ monaco æ˜¯ä¸€ä¸ªå¾ˆè´´å¿ƒçš„ç¼–è¾‘å™¨ï¼Œä»–ä¹Ÿå¸®æˆ‘ä»¬è§£å†³äº†è¿™ä¸€ç³»åˆ—é—®é¢˜ã€‚è§£å†³æˆ‘ä»¬é—®é¢˜çš„å°±æ˜¯ monaco-editor-webpack-pluginã€‚

	npm install monaco-editor-webpack-plugin -S

webpacké…ç½®

	const MonacoWebpackPlugin = require('monaco-editor-webpack-plugin');

	module.exports=function(){
	  return {
	    ...
	    plugins:[
	      new MonacoWebpackPlugin()
	    ]
	    ...
	  }
	}

æ’ä»¶ä¼šå¸®æˆ‘ä»¬åšè¿™ä¹ˆå‡ ä»¶äº‹

- è‡ªåŠ¨æ³¨å…¥ getWorkerUrl å…¨å±€å˜é‡
- å¤„ç† worker çš„ç¼–è¯‘é…ç½®
- è‡ªåŠ¨å¼•å…¥æ§ä»¶å’Œè¯­è¨€åŒ…ã€‚
- å…·ä½“è¦å¼•å…¥å“ªäº›æ§ä»¶å’Œè¯­è¨€åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® languages å’Œ features æ¥æ§åˆ¶

ç¼ºçœæƒ…å†µä¸‹ï¼Œæ’ä»¶çš„ä¼šå¼•å…¥é»˜è®¤çš„è¯­è¨€åŒ…å’Œæ§ä»¶ã€‚

	new MonacoWebpackPlugin({
	 languages:["javascript","css","html","json"],
	 features:["coreCommands","find"]
	})

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬ä»¥åŠå®Œæˆäº†ä¸€ä¸ªæ‹¥æœ‰è‡ªåŠ¨è¡¥å…¨ï¼Œé”™è¯¯æç¤ºï¼Œä»¥åŠè¯­æ³•é«˜äº®çš„ç¼–è¾‘å™¨ã€‚


åœ¨å®Œæˆäº†ç¼–è¾‘å™¨æœ¬èº«çš„é…ç½®ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œç»‘å®šç¼–è¾‘äº‹ä»¶ã€‚

	monacoInstance.onDidChangeModelContent((event) => {
	 const newValue=monacoInstance.getValue();
	 console.log(newValue)
	})

monacoInstance æ˜¯ä¸€ä¸ª create æ–¹æ³•è¿”å›çš„å®ä¾‹ï¼Œä»–åŒ…å«å¾ˆå¤šæ“ä½œå®ä¾‹çš„æ–¹æ³•ã€‚event æ˜¯ä¸€ä¸ª IModelContentChangedEvent å¯¹è±¡ï¼Œä»–åŒ…å«äº†éå¸¸éå¸¸è¯¦ç»†çš„å˜æ›´ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ“ä½œçš„ç±»å‹ï¼ˆæ’¤é”€ã€æ¢å¤ï¼Œè¿˜æ˜¯æ‰‹åŠ¨è¾“å…¥å¼•å‘çš„æ–‡æœ¬å˜æ›´ï¼‰ï¼Œå˜æ›´çš„æ–‡æœ¬ä½ç½®ï¼Œå˜æ›´çš„æ–‡æœ¬å†…å®¹ç­‰ã€‚è€Œæˆ‘ä»¬è¦è·å–æœ€æ–°çš„å€¼ï¼Œåˆ™éœ€è¦è°ƒç”¨

	monacoInstance.getValue();

ç»†å¿ƒçš„æœ‹å‹åº”è¯¥è¿˜ä¼šå‘ç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬ç»‘å®šçš„æ–¹æ³•ç”¨çš„æ˜¯ onDidChangeModelContentï¼Œé‡Œé¢æœ‰ä¸€ä¸ª Modelï¼Œè¿™å‘½åå¯æ˜¯å¾ˆè®²ç©¶çš„ï¼Œå­—é¢æ„æ€å°±æ˜¯å˜æ›´ Model å†…å®¹è§¦å‘äº‹ä»¶ï¼Œå…¶å®æˆ‘ä»¬åœ¨ç¼–è¾‘çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨ Model ä¸Šç¼–è¾‘ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œmonaco ä¼šå¸®æˆ‘ç”Ÿæˆä¸€ä¸ª Modelï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ getModel æ‰“å°ä¸€ä¸‹

	monacoInstance.getModel()


çœ‹ä¸€çœ‹ APIï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒModel å…¶å®æ˜¯ä¸€ä¸ªä¿å­˜ç¼–è¾‘çŠ¶æ€çš„å¯¹è±¡ï¼Œä»–é‡Œé¢å«æœ‰è¯­è¨€ä¿¡æ¯ï¼Œå½“å‰çš„ç¼–è¾‘æ–‡æœ¬ä¿¡æ¯ï¼Œæ ‡æ³¨ä¿¡æ¯ç­‰ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¼“å­˜ä¸€ä¸‹ Model å¯¹è±¡ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ç›´æ¥è°ƒç”¨ setModel å³å¯éšæ—¶åˆ‡æ¢åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚æˆ–è€…ä¹Ÿå¯ä»¥åœ¨åˆå§‹åŒ–å®ä¾‹çš„æ—¶å€™è®¾ç½®ä¸€ä¸ª Modelã€‚

	const model=monaco.editor.createModel("hahahaha","javascript");
	monacoInstance = monaco.editor.create(this.monacoDom.current, {
	 model:model
	})

è€Œä¸”æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ model ä¸Šæ¥ç»‘å®šæˆ‘ä»¬çš„äº‹ä»¶

	model.onDidChangeContent((event)=>{
	...
	})

Model æœ€åä¹Ÿéœ€è¦æˆ‘ä»¬é”€æ¯ï¼Œè¿™é‡Œåˆ†ä¸¤ç§æƒ…å†µï¼Œå‡å¦‚æ˜¯é€šè¿‡ createModel åˆ›å»ºçš„ Modelï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é”€æ¯ï¼Œä½†æ˜¯å¦‚æœæ˜¯ monaco é»˜è®¤åˆ›å»ºçš„ï¼Œåˆ™ä¸éœ€è¦ï¼Œåœ¨è°ƒç”¨å®ä¾‹çš„é”€æ¯æ–¹æ³•æ—¶ï¼Œä¼šé¡ºå¸¦é”€æ¯é»˜è®¤åˆ›å»ºçš„ Modelã€‚

	model.dispose();

é™¤äº†ç¼–è¾‘äº‹ä»¶ä¹‹å¤–ï¼ŒModelè¿˜æœ‰è®¸å¤šå…¶ä»–äº‹ä»¶

ä¾‹å¦‚ï¼š

- onDidChangeOptions é…ç½®æ”¹å˜äº‹ä»¶
- onDidChangeLanguage è¯­è¨€æ”¹å˜äº‹ä»¶
- ...

åœ¨ç®€å•çš„åœºæ™¯ä¸‹ï¼ŒModel çš„å­˜åœ¨å¯èƒ½ä½¿å¾—æˆ‘ä»¬ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç¹çï¼Œä½†æ˜¯ï¼Œåœ¨å¤æ‚åœºæ™¯ä¸‹ï¼Œmodelå¯ä»¥æå¤§çš„ç®€åŒ–ä»£ç å¤æ‚æ€§ã€‚

è®¾æƒ³ä¸€ä¸‹æˆ‘ä»¬æœ‰ 5 ä¸ª tabï¼Œæ¯ä¸ª tab éƒ½æ˜¯ä¸€ä¸ªç¼–è¾‘å™¨ï¼Œæ¯ä¸ªç¼–è¾‘å™¨éƒ½æœ‰å„è‡ªçš„è¯­è¨€ï¼Œå†…å®¹å’Œæ ‡æ³¨ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ Modelï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜æ¯ä¸ª tab çš„è¯­è¨€ï¼Œå†…å®¹ç­‰ä¿¡æ¯ï¼Œåœ¨åˆ‡æ¢åˆ°å¯¹åº” tab æ—¶å†å°†è¿™äº›ä¿¡æ¯åˆå§‹åŒ–åˆ°ç¼–è¾‘å™¨ä¸Šï¼Œä½†æ˜¯åˆ©ç”¨ Modelï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–å»ä¿å­˜æ¯ä¸ª tab çš„ç¼–è¾‘ä¿¡æ¯ï¼Œåªéœ€è¦ä¿å­˜æ¯ä¸ª tab çš„ Modelï¼Œç„¶åå°† Model ä¼ ç»™ç¼–è¾‘å™¨è¿›è¡Œåˆå§‹åŒ–å³å¯ã€‚



### ğŸ‘‰ Imba ç¼–ç¨‹è¯­è¨€

Sindre AarsÃ¦ther ä½œä¸º CTO å’Œè”åˆåˆ›å§‹äººï¼Œå¼€å‘äº†æ¯” JavaScript æ›´ç®€æ´çš„ Imba ç¼–ç¨‹è¯­è¨€ã€‚æ•´ä¸ª Scrimba å­¦ä¹ å¹³å°éƒ½æ˜¯ç”¨ Imba æ­å»ºçš„ï¼ŒåŒ…æ‹¬å‰ç«¯å’Œåç«¯ã€‚

Imba ä¾èµ–äº† Go è¯­è¨€å®ç°çš„ esbuildï¼ŒåŸºäº ESM çš„æ‰“åŒ…æœºã€‚Vite å’Œ snowpack åº•å±‚éƒ½æ˜¯ç”¨äº† esbuildã€‚ä» Vite çš„ README ä¸Šå¯ä»¥å‘ç° esbuild çš„æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ï¼ŒTypeScript è½¬ä¹‰æˆ JavaScript è¦æ¯”å®˜æ–¹çš„ tsc å¿« 20-30 å€ã€‚å¯¹ Reactã€Vue å’Œ Imba è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œç»“æœæ˜¯ Imba çš„ DOM æ”¹å†™é€Ÿåº¦å¿«äº† 20-30 å€ã€‚Imba é€Ÿåº¦å¾ˆå¿«ï¼ŒçœŸçš„éå¸¸å¿«ã€‚åŒæ—¶æ”¯æŒ VSCode å’Œ Sublimeï¼Œå¼€å‘éå¸¸ä¾¿åˆ©ã€‚

Imba è¯­æ³•å¾ˆåƒ Pythonï¼Œå¦‚å®˜æ–¹çš„ Paint ç¤ºèŒƒç¨‹åºï¼š

	# https://imba.io/examples/apps/paint/app.imba
	const dpr = window.devicePixelRatio

	tag app-paint
		prop size = 500
		
		def draw e
			let path = e.$path ||= new Path2D
			path.lineTo(e.x * dpr,e.y * dpr)
			$canvas.getContext('2d').stroke(path)

		def render
			<self[d:block overflow:hidden bg:blue1]>
				<canvas$canvas[size:{size}px]
					width=size*dpr height=size*dpr @touch.fit(self)=draw>

	imba.mount <app-paint>


å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæ ·å¼çš„ä½¿ç”¨ï¼Œ:flex è¡¨ç¤º display: flexï¼Œç®€ç›´å°±æ˜¯ Web ä¸“ç”¨çš„è¯­è¨€ï¼Œé¢œè‰²æŒ‡å®šä½¿ç”¨çš„æ˜¯ Tailwind CSS çš„é¢„é…ç½®ï¼Œæ•°å­—è¶Šå¤§è‰²å½©è¶Šæ·±ï¼š

	# https://imba.io/examples/apps/playground/app.imba
	tag x-app
		css .blue bg:blue2 @hover:blue3 color:blue8
		css .teal bg:teal2 @hover:teal3 color:teal8
		css .yellow bg:yellow2 @hover:yellow3 color:yellow8
		css .red bg:red2 @hover:red3 color:red8 
		css .item p:4 flex:1 rd:3 m:4

		def render
			<self [d:flex flw:wrap]>
				<div.blue.item> "One"
				<div.red.item> "Two"
				<div.teal.item> "Three"
				<div.yellow.item> "Four"

	imba.mount <x-app>

Tailwind æ˜¯ä¸€æ¬¾ utility-first çš„æ¡†æ¶ï¼Œå¯ä»¥è¢«ç”¨äºå¿«é€Ÿåœ°æ„å»º UIã€‚åœ¨åˆ›å»ºç½‘ç«™æ—¶ï¼Œæ‚¨åªéœ€è¦ç¡®å®šé¡¹ç›®çš„èŒƒå›´ï¼Œè€Œæ— éœ€è‡ªè¡Œç¼–å†™ CSSã€‚è™½ç„¶ Tailwind å¹¶ä¸æä¾›é»˜è®¤çš„ä¸»é¢˜ï¼Œæ‚¨ä¹Ÿæ‰¾ä¸åˆ°ä»»ä½•å†…ç½®çš„ UI ç»„ä»¶ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨é¢„è®¾è®¡çš„éƒ¨ä»¶èœå•ï¼Œæ¥æ„å»ºç›®æ ‡ç½‘ç«™ã€‚



### ğŸ‘‰ Xterm.js
- node-pty - electron example to v9.1.0 https://github.com/microsoft/node-pty/tree/master/examples
- Node.js Versions https://nodejs.org/zh-cn/download/releases/

Xterm.js æ˜¯ç”¨ JavaScript ç¼–å†™çš„ç»ˆç«¯å‰ç«¯ç»„ä»¶ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨æ¨¡æ‹Ÿç»ˆç«¯çš„å·¥ä½œå°ã€‚å®ƒä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸ºå…¶ç”¨æˆ·æä¾›åŠŸèƒ½é½å…¨çš„ç»ˆç«¯ï¼Œå¹¶åˆ›é€ è‰¯å¥½çš„å¼€å‘ä½“éªŒï¼Œå‚è€ƒ VSCode çš„ç»ˆç«¯ç•Œé¢æ•ˆæœã€‚å®ƒé€‚ç”¨äºå¤§å¤šæ•°ç»ˆç«¯åº”ç”¨ç¨‹åºï¼Œå¦‚ bashï¼Œvim å’Œ tmuxï¼Œè¿™åŒ…æ‹¬å¯¹åŸºäº curses çš„åº”ç”¨ç¨‹åºå’Œé¼ æ ‡äº‹ä»¶æ”¯æŒçš„æ”¯æŒã€‚PTY åœ¨å‰ç«¯åº”ç”¨ä¸ Shell ä¹‹é—´å……å½“ä¸­é—´äººï¼Œè´Ÿè´£è¾“å…¥è¾“å‡ºæ•°æ®çš„ä¼ é€’ã€‚

Xterm.js Features

- Text-based application support:  åŸºäºæ–‡æœ¬çš„åº”ç”¨ç¨‹åºæ”¯æŒï¼Œä½¿ç”¨ bashã€git ç­‰åº”ç”¨ç¨‹åºã€‚
- Curses-based application support:  åŸºäº Curses çš„åº”ç”¨ç¨‹åºæ”¯æŒï¼Œä½¿ç”¨ vimã€tmux ç­‰åº”ç”¨ç¨‹åºã€‚
- Mouse events support:  é¼ æ ‡äº‹ä»¶æ”¯æŒï¼Œæ•è·é¼ æ ‡äº‹ä»¶ï¼Œå¦‚å•å‡»å’Œæ»šåŠ¨ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ç»ˆç«¯çš„åç«¯æ§åˆ¶è¿›ç¨‹ã€‚
- CJK (Chinese, Japanese, Korean) character support:  ä¸­æ—¥éŸ©å­—ç¬¦æ”¯æŒï¼Œæ— ç¼æ¸²æŸ“ CJK å­—ç¬¦ã€‚
- IME support:  è¾“å…¥æ³•æ”¯æŒï¼Œä½¿ç”¨é”®ç›˜è¾“å…¥æ³•æ’å…¥å›½é™…å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸­æ—¥éŸ©ã€‚
- Self-contained library:  ç‹¬ç«‹åº“ï¼Œå®ƒä¸éœ€è¦ä»»ä½•åƒ jQuery æˆ– React è¿™æ ·çš„å¤–éƒ¨åº“
- Modular, event-based API:  æ¨¡å—åŒ–ã€åŸºäºäº‹ä»¶çš„ APIï¼Œè®©æ‚¨è½»æ¾æ„å»ºæ’ä»¶å’Œä¸»é¢˜

å®‰è£…ä½¿ç”¨ï¼Œå¯ä»¥ä¸º TypeScript å®‰è£…ç±»å‹å£°æ˜æ–‡ä»¶ï¼š

	npm install xterm
	npm install @types/xterm

Xterm.js é€šè¿‡åç«¯çš„ node-pty å……å½“ä¸ Shell æœåŠ¡çš„æ•°æ®åª’ä»‹ï¼Œåœ¨ä¸¤è€…ä¹‹é—´äº¤æ¢ stdin å’Œ stdout æ•°æ®ï¼Œå®ç°ä¸€ä¸ª Web pseudoterminalã€‚node-pty ä¾èµ–äº†
Windows conpty API å’Œ winptyã€‚


Xterm.js + Electron ç¤ºèŒƒ

	var os = require('os');
	var pty = require('node-pty');
	var Terminal = require('xterm').Terminal;

	// Initialize node-pty with an appropriate shell
	const shell = process.env[os.platform() === 'win32' ? 'COMSPEC' : 'SHELL'];
	const ptyProcess = pty.spawn(shell, [], {
	  name: 'xterm-color',
	  cols: 80,
	  rows: 30,
	  cwd: process.cwd(),
	  env: process.env
	});

	// Initialize xterm.js and attach it to the DOM
	const xterm = new Terminal();
	xterm.open(document.getElementById('xterm'));

	// Setup communication between xterm.js and node-pty
	xterm.onData(data => ptyProcess.write(data));
	ptyProcess.on('data', function (data) {
	  xterm.write(data);
	});

node-pty å’Œ Electron æ­é…ä½¿ç”¨æ—¶ï¼Œå¦‚æœè¿è¡Œå‡ºé”™ï¼Œéœ€è¦æ³¨æ„ç‰ˆæœ¬åŒ¹é…é—®é¢˜ã€‚

	Uncaught Error: The module '\\?\C:\electron\node_modules\node-pty\build\Release\conpty.node'
	was compiled against a different Node.js version using
	NODE_MODULE_VERSION 72. This version of Node.js requires
	NODE_MODULE_VERSION 80. Please try re-compiling or re-installing
	the module (for instance, using `npm rebuild` or `npm install`).

æœ‰ä¸ªç»†èŠ‚å‰æéœ€è¦æ³¨æ„ï¼Œelectron-rebuild åªä¼š rebuild dependencies ä¾èµ–ã€‚NODE_MODULE_VERSION æŒ‡çš„æ˜¯ Node.js ABI - application binary interface ç‰ˆæœ¬å·ï¼Œç”¨æ¥ç¡®å®šç¼–è¯‘ Node.js çš„ C++ åº“ç‰ˆæœ¬ï¼Œä»¥ç¡®å®šæ˜¯å¦å¯ä»¥ç›´æ¥åŠ è½½è€Œä¸éœ€é‡æ–°ç¼–è¯‘ã€‚

Nodeã€Electronã€v8ã€Chromium å†…æ ¸ç‰ˆæœ¬éƒ½æœ‰ä¸€å®šçš„å¯¹åº”å…³ç³»ï¼ŒElectron ä¸­çš„ V8 å’Œ Nodejs ç¼–è¯‘ addon ä½¿ç”¨çš„ v8 ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´ã€‚è¿™é‡Œæç¤º conpty.node çš„ API 72 ç‰ˆæœ¬ï¼Œè€Œå½“å‰ Electron è¦æ±‚ 80 ç‰ˆæœ¬ã€‚

å¯ä»¥è€ƒè™‘é‡æ–°ç¼–è¯‘æ’ä»¶ï¼š

	npm i electron-rebuild -s
	./node_modules/.bin/electron-rebuild --abi=72

æŒ‡å®šç‰ˆæœ¬

	cnpm rebuild --runtime=electron --target=5.0.13 --dist-url=https://npm.taobao.org/mirrors/atom-shell --abi=72
	node-gyp rebuild --target=5.0.13 --dist-url=https://npm.taobao.org/mirrors/atom-shell 

å…¶å®ƒè§£å†³åŠæ³•ï¼Œæ¢ Electron ç‰ˆæœ¬ï¼Œé‡æ–°ç¼–è¯‘ node-ptyã€‚

	npm install electron@4.x
	npm install electron@5.x


### ğŸ‘‰ node-pty

Windows conpty API å’Œ Windows Command-Line ç³»åˆ—æ–‡ç« ï¼š

- Command-Line Backgrounder 
- The Evolution of the Windows Command-Line 
- Inside the Windows Console 
- Introducing the Windows Pseudo Console (ConPTY) API 
- Unicode and UTF-8 Output Text Buffer 

- https://blogs.msdn.microsoft.com/commandline/2018/06/20/windows-command-line-backgrounder/
- https://blogs.msdn.microsoft.com/commandline/2018/06/27/windows-command-line-the-evolution-of-the-windows-command-line/
- https://blogs.msdn.microsoft.com/commandline/2018/07/20/windows-command-line-inside-the-windows-console/
- https://devblogs.microsoft.com/commandline/windows-command-line-introducing-the-windows-pseudo-console-conpty/
- https://devblogs.microsoft.com/commandline/windows-command-line-unicode-and-utf-8-output-text-buffer/
- https://github.com/Microsoft/node-pty/wiki/Debugging

GYP æ˜¯ä¸€ç§æ„å»ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œnode-gyp å°±æ˜¯ä¸º Node ç¼–è¯‘æ’ä»¶çš„ã€‚ä¸ºäº†æ–¹ä¾¿è·¨å¹³å°ï¼Œnpm å¹²è„†å°±ç›´æ¥æºç åˆ†å‘ï¼Œç”¨æˆ·è£…çš„æ—¶å€™å†ç°åœºç¼–è¯‘ã€‚


æ§åˆ¶å°ç¨‹åºçš„è¶Šæ¥è¶Šæ—¶é«¦ï¼Œå¦‚ Windows Terminal é€‰é¡¹å¡é£æ ¼æ§åˆ¶å°ï¼Œå°† PowerShell å’Œå†…ç½®çš„ WSL - Linux ç³»ç»Ÿæ§åˆ¶å°ç»Ÿä¸€æ•´åˆï¼Œæå¤§æ–¹ä¾¿äº†å¼€å‘è€…çš„ä½¿ç”¨ï¼ŒWindows + Linux æ‰æ˜¯æ¡Œé¢ç³»ç»Ÿçš„æœªæ¥ä¹‹å…‰ã€‚

è¥¿é›…å›¾å¼€å¹•çš„ Build 2019 å¤§ä¼šä¸Šï¼Œå¾®è½¯å…¬å¸ƒäº†å³å°†é¢å‘ Win 10 æ¨å‡ºçš„æ–°å‘½ä»¤è¡Œç¨‹åºï¼ŒWindows Terminal(Windowsç»ˆç«¯)ã€‚Windows Terminal å°†æŠŠç›®å‰çš„ PowerShellã€Cmdã€Windows Linux å­ç³»ç»Ÿï¼ˆWSLï¼‰ã€Azureï¼ˆå¾®è½¯çš„äº‘æœåŠ¡ï¼‰å››å¤§ç¯å¢ƒå®ç°ç»Ÿä¸€ã€‚

è‡ªä» Satya Nadella æ‰§æŒå¾®è½¯å¸å›½ä»¥æ¥ï¼Œå¾®è½¯å¯¹å¼€æºç¤¾åŒºæ€åº¦å‘ç”Ÿ 180 åº¦è½¬å˜ï¼Œä¹Ÿä¸å†è§† Linux ä¸ºæ¯’ç˜¤ï¼Œå¼€å§‹ä»¥å®é™…è¡ŒåŠ¨è·µè¡Œâ€œMicrosoft love Linuxâ€çš„èª“è¨€ï¼šå¾®è½¯çš„ Azure æ”¯æŒ Linuxã€å¼€æº .Net Coreã€å¼€æº VS Codeã€å®Œå–„å‘½ä»¤è¡Œå¯¹ POSIX æ”¯æŒã€æ Windows Subsystem for Linux é»‘ç§‘æŠ€ã€æ”¶è´­ GitHub ç­‰ã€‚


winpty ä¸ Windows console ç¨‹åºé€šä¿¡ï¼Œä¸º Windows ç³»ç»Ÿæä¾›äº†ç±»ä¼¼ Unix pty åŠŸèƒ½çš„å·¥å…·ï¼ŒåŒ…å« libwinpty åº“å’Œç”¨äº Cygwin å’Œ MSYS çš„å·¥å…·ä»¥è¿è¡Œ Windows æ§åˆ¶å°ç¨‹åºã€‚

- winpty-agent.exe åŠ©æ‰‹å·¥å…·ï¼Œé€šå¸¸ç”± winpty.dll å¯åŠ¨ä¸ä¸€ä¸ªéšè—çš„ console äº¤äº’ï¼Œå¯ä»¥ç”¨äºç®€å•çš„è°ƒè¯•ï¼›
- MinGW g++ C++11 ç¼–è¯‘å¾—åˆ° `winpty.dll` and `winpty-agent.exe`
* A g++ toolchain targeting Cygwin or MSYS to build `winpty.exe`

winpty éœ€è¦ä¸¤å¥— g++ å·¥å…·é“¾ï¼Œå› ä¸ºå®ƒè¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä½¿ç”¨ MinGW ç¼–è¯‘ `winpty.dll` è¿˜æœ‰ `winpty-agent.exe` äºŒè¿›åˆ¶æ¥å£ä¸ Windows å‘½ä»¤è¡Œç•Œé¢ã€‚ä½¿ç”¨ MSYS/Cygwin å¤„ç† `winpty.exe` äºŒè¿›åˆ¶æ¥å£ä¸ MSYS/Cygwin ç»ˆç«¯ã€‚

ç›¸æ¯” winpty æä¾›çš„æ§åˆ¶å°ç¨‹åºäº¤äº’ï¼Œæ›´æ–°çš„æ˜¯ conptyã€‚

ç»ˆç«¯ï¼Œä¸€èˆ¬è®¤çŸ¥èŒƒå›´å†…ç•¥åŒäºå‘½ä»¤è¡Œå·¥å…·ï¼Œé€šä¿—ç‚¹è¯´å°±æ˜¯ shell è¿›ç¨‹ã€‚æ¯æ¬¡åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä¸€ä¸²å‘½ä»¤ï¼Œæ•²å…¥å›è½¦ï¼Œç»ˆç«¯è¿›ç¨‹éƒ½ä¼š fork ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”¨æ¥æ‰§è¡Œè¾“å…¥çš„å‘½ä»¤ï¼Œç»ˆç«¯è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ wait4() ç›‘å¬å­è¿›ç¨‹é€€å‡ºï¼ŒåŒæ—¶é€šè¿‡æš´éœ²çš„ stdout è¾“å‡ºå­è¿›ç¨‹æ‰§è¡Œä¿¡æ¯ã€‚

Web ä¼ªç»ˆç«¯çš„å®ç°ç±»ä¼¼äºæœ¬åœ°åŒ–çš„ç»ˆç«¯åŠŸèƒ½ï¼Œä½†éœ€è¦åšå·¥ä½œä¼šæ›´å¤šã€‚ç½‘ç»œæ—¶å»¶åŠå¯é æ€§ä¿è¯ã€shell ç”¨æˆ·ä½“éªŒå°½é‡æ¥è¿‘æœ¬åœ°åŒ–ã€Web ç»ˆç«¯ UI å®½é«˜ä¸è¾“å‡ºä¿¡æ¯é€‚é…ã€å®‰å…¨å‡†å…¥æ§åˆ¶ä¸æƒé™ç®¡ç†ç­‰ã€‚åœ¨å…·ä½“å®ç° Web ç»ˆç«¯ä¹‹å‰ï¼Œéœ€è¦è¯„ä¼°è¿™äº›æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œshell çš„åŠŸèƒ½å®ç°åŠç”¨æˆ·ä½“éªŒã€å®‰å…¨æ€§ã€‚Web ç»ˆç«¯æ˜¯åœ¨æä¾›ä¸€ä¸ªçº¿ä¸ŠæœåŠ¡å™¨åŠŸèƒ½ï¼Œå› æ­¤å®‰å…¨æ€§æ˜¯å¿…é¡»è¦ä¿è¯çš„ã€‚

windows-build-tools æ˜¯åœ¨ Windows å¹³å°ç”¨äºç¼–è¯‘ Node æ¨¡å—çš„å·¥å…·ï¼Œä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ï¼š

	npm install node-pty
	npm install --global --production windows-build-tools

node-pty ä¾èµ–æ¡ä»¶ï¼š

- Windows SDK - only the "Desktop C++ Apps" components are needed to be installed
- Node.JS 10+


å®‰è£… node-pty åè¿˜åœ¨æœ¬æœºè¿è¡Œæç¤º Cannot find module '..\build\Release\pty.node'ï¼Œæˆ– conpty.node æ¨¡å—ã€‚æŸ¥æ‰¾ windowsPtyAgent.js æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ pty çš„æŒ‡å‘ï¼Œæ ¹æ®ä¸åŒç‰ˆæœ¬çš„ node-pty éœ€è¦ä¿®æ”¹çš„ä½ç½®ä¸ä¸€æ ·ï¼Œæ ¹æ®é”™è¯¯ä¿¡æ¯å®šä½è¦ä¿®æ”¹çš„ä½ç½®ï¼š

	// node\node_modules\scrimba\node_modules\node-pty-prebuilt\lib\windowsPtyAgent.js
	console.log("CWD", path.resolve('.'));
	var cwd = path.resolve('.');
	var pty = require(path.join(cwd, 'node_modules', 'node-pty', 'build', 'Release', 'pty.node'));


	// node_modules\node-pty\lib\utils.js
	function loadNative(moduleName) {
	    let modir =  path.parse(path.join(__dirname));
	    console.log("CWD", path.resolve(".."), modir);
	    let module = path.join(modir.dir, 'build', 'Release', moduleName + ".node");
	    try {
	        return require(module);
	    }
	    catch (_a) {
	        console.log("NOTFOUND MODULE", module);
	        let module = path.join(modir.dir, 'build', 'Debug', moduleName + ".node");
	        return require(module);
	    }
	}
	exports.loadNative = loadNative;

æ ¹æ® CWD æ˜¾ç¤ºå½“å‰ç›®å½•å°½ç®¡åœ¨ srcï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èƒ½ä½¿ç”¨ ../node_modules æ¥è®¿é—®æ¨¡å—ï¼Œåªèƒ½å°† node_modules å½“ä½œå·¥ä½œç›®å½•ï¼ŒNode ä¼šæ ¹æ®è¿™ä¸ªç›®å½•åŠ è½½æ¨¡å—ã€‚

ä½¿ç”¨ node-pty-prebuilt ç¼–è¯‘å¤±è´¥ï¼Œéœ€è¦ä½¿ç”¨ npm install --force å¼ºåˆ¶å®‰è£…ï¼Œæ²¡æœ‰å®Œå…¨ç¼–è¯‘é€šè¿‡ï¼Œåªç”Ÿæˆäº†ä¸¤é¡¹ï¼š

- winpty-agent.exe
- winpty.dll

Microsoft Github æä¾›çš„ KillDeepTree ç¤ºèŒƒï¼š

	var os = require('os');
	var pty = require('node-pty-prebuilt');
	// var pty = require('../..');

	var shell = os.platform() === 'win32' ? 'powershell.exe' : 'bash';

	var ptyProcess = pty.spawn(shell, [], {
	  name: 'xterm-color',
	  cols: 80,
	  rows: 30,
	  cwd: __dirname,
	  // cwd: process.env.HOME,
	  env: process.env
	});

	ptyProcess.on('data', (data) => process.stdout.write(data));
	// ptyProcess.onData((data) => process.stdout.write(data));

	ptyProcess.write('start notepad\r');
	ptyProcess.write('npm start\r');
	ptyProcess.resize(100, 40);
	ptyProcess.write('ls\r');

	// Kill the tree at the end
	setTimeout(() => {
	  console.log('Killing pty');
	  ptyProcess.kill();
	}, 10000);

folk ç¤ºèŒƒï¼š

	var os = require('os');
	var pty = require('../..');

	var isWindows = os.platform() === 'win32';
	var shell = isWindows ? 'powershell.exe' : 'bash';

	var ptyProcess = pty.spawn(shell, [], {
	  name: 'xterm-256color',
	  cols: 80,
	  rows: 26,
	  cwd: isWindows ? process.env.USERPROFILE : process.env.HOME,
	  env: Object.assign({ TEST: "Environment vars work" }, process.env),
	  useConpty: true
	});

	ptyProcess.onData(data => process.stdout.write(data));

	ptyProcess.write(isWindows ? 'dir\r' : 'ls\r');

	setTimeout(() => {
	  ptyProcess.resize(30, 19);
	  ptyProcess.write(isWindows ? '$Env:TEST\r' : 'echo $TEST\r');
	}, 2000);

	process.on('exit', () => ptyProcess.kill());

	setTimeout(() => process.exit(), 4000);




### ğŸ‘‰ CodePen

è¯´åˆ° CodePen è¿™ä¸ªåœ¨çº¿ä»£ IDEï¼Œå‰ç«¯å¼€å‘è€…è‚¯å®šä¸é™Œç”Ÿï¼Œå®Œå–„çš„å·¥ç¨‹ç®¡ç†ï¼Œå®Œå–„çš„ç¼–è¾‘å¿«æ·é”®åŠŸèƒ½ï¼Œå®Œå–„çš„ç¤¾åŒºäº¤æµã€‚å¦‚æœè¯´ Dribbble æ˜¯è®¾è®¡å¸ˆä»¬èšé›†çš„åœ£åœ°ï¼Œé‚£ä¹ˆ CodePen åˆ™æ˜¯å‰ç«¯å¼€å‘è€…ä»¬çº¦ç çš„å¤©å ‚ã€‚å®ƒä¸ä»…æä¾›ç»™ä½ äº†ä¸€ä¸ª Showcase çš„å¹³å°ï¼Œè€Œä¸”èƒ½å¤Ÿå¼€æ‹“ä½ çš„è§†é‡ï¼Œè®©ä½ èƒ½å¤ŸåŠæ—¶çš„äº†è§£æœ€æ–°å‰ç«¯æŠ€æœ¯çš„åº”ç”¨ï¼ŒåŒæ—¶å¸®åŠ©äº¤äº’è®¾è®¡å¸ˆæ‰¾å¯»æ›´å¤šçš„çµæ„Ÿã€‚

CodePen æ˜¯ä¸€ä¸ªå®Œå…¨å…è´¹çš„å‰ç«¯ä»£ç æ‰˜ç®¡æœåŠ¡ï¼Œä¸ GitHub Pages ç›¸æ¯”ï¼Œå®ƒæœ€é‡è¦çš„ä¼˜åŠ¿æ˜¯å³æ—¶é¢„è§ˆã€‚æ— è®ºæ˜¯ Jadeã€ LESSã€ Sassï¼Œè¿˜æ˜¯ CoffeeScriptã€ Babel es6+ã€TypeScript éƒ½èƒ½å°½æƒ…ä½¿ç”¨ã€‚

å¿«é€Ÿæ·»åŠ å¤–éƒ¨èµ„æºæ–‡ä»¶ï¼Œåªéœ€åœ¨è¾“å…¥æ¡†é‡Œè¾“å…¥åº“åï¼ŒCodePen å°±ä¼šå¯»æ‰¾åŒ¹é…çš„ CDN ä¸Šçš„ css æˆ– js åº“ã€‚å…è´¹ç”¨æˆ·æ”¯æŒåˆ›å»ºä¸‰ä¸ªæ¨¡æ¿ï¼Œä¸æ˜¯æ¯ä¸ªä½œå“éƒ½éœ€è¦ä»ç™½æ¿å¼€å§‹ã€‚ä¼˜ç§€çš„å¤–åµŒç”Ÿæˆï¼Œä¸”æ”¯æŒ oEmbedï¼Œåœ¨ WordPress æˆ– Reddit ç­‰æ”¯æŒ oEmbed çš„å¹³å°ä¸Šï¼Œåªè¦ç®€å•åœ°æŠŠé“¾æ¥è´´å…¥ç¼–è¾‘æ¡†ï¼Œå‘å¸ƒåä¼šè‡ªåŠ¨è½¬ä¸ºåµŒå…¥ä½œå“ã€‚

å½“ç„¶ï¼Œå®ƒä¸æ˜¯ Git ï¼Œä¸èƒ½è®°å½•æäº¤å†å²åªèƒ½æœ‰ fork åŠŸèƒ½ï¼Œé€šå¸¸å‡ºäºå¤‡ä»½ä»–äººä¼˜ç§€ä½œå“ï¼Œé˜²æ­¢æœªæ¥è¯¥ä½œå“æ¶ˆå¤±äº†æˆ–è€…å˜äº†æ ·å­ã€‚

åœ¨ CodePen ä¸Šå‘å¸ƒçš„å…¬å¼€ä½œå“å‡ä½¿ç”¨ MIT å¼€æºåè®®ã€‚CodePen å›¢é˜Ÿç›®å‰åªæœ‰å…«ä¸ªäººï¼Œå®Œå…¨ç§°å¾—ä¸Šå°è€Œç²¾ã€‚

CodePen æ¯å¹´ä¼šå‡ºä¸€æœŸåä¸º The Most Hearted ä½œå“é›†ä¸“é¢˜ï¼Œè®©æˆ‘ä»¬åœ¨æƒŠå¹å‰ç«¯å¼€å‘è€…åˆ›é€ åŠ›çš„åŒæ—¶ï¼Œä¹Ÿèƒ½å¤Ÿå­¦ä¹ ä¸€äº›æ–°çš„æŠ€æœ¯ï¼Œæ•æ‰ä¸€äº›æ–°çš„æƒ³æ³•ã€‚2016 å¹´ä¸“é¢˜ä¸­ç›˜ç‚¹äº† 100 ä¸ªæœ€å—æ¬¢è¿çš„ Pensï¼Œå‚è€ƒå…¶ä¸­ä¸€äº›ç»å…¸ç¤ºèŒƒï¼š

- æ¸è¿‘å¼ç¶éŸ³å™¨ Musical Chord Progression Arpeggiator - Jake Albaugh

	åœ¨ä½œå“ä¸­ï¼Œä½œè€…åˆ©ç”¨äº†éŸ³é˜¶ç”Ÿæˆå™¨ ã€ç¶éŸ³æ¨¡å¼ç”Ÿæˆå™¨ä»¥åŠ Tone.js å®ç°çš„ä¸€ä¸ª Webï¼ˆHTML/CSS/JSï¼‰åº”ç”¨ã€‚

	- ä½œå“åœ°å€ https://codepen.io/jakealbaugh/pen/qNrZyw
	- ä¾èµ–åº“åœ°å€ https://github.com/Tonejs/Tone.js

- Shader å›¾åƒå˜æ¢ç‰¹æ•ˆ

	åœ¨è¿™ä¸ªä½œå“ä¸­ï¼Œä½œè€…ä¾¿æ‰©å±•äº† THREE.js è¿™ä¸ª WebGL ç¬¬ä¸‰æ–¹åº“ä¸­çš„ MeshPhongMaterial å®ç°äº†åŠ¨ç”»çš„ä»»æ„å˜æ¢ã€‚å¦å¤–ï¼Œä»–è¿˜åˆ©ç”¨ THREE.js å®ç°äº†æ–‡æœ¬å˜æ¢ï¼Œè€Œæ­¤ä½œå“ä¹Ÿæ˜¯åŸºäºæ–‡æœ¬å˜æ¢è€Œæ¥çš„ã€‚å®ç°äº¤äº’å¼å˜æ¢ï¼Œæ‹–åŠ¨é¼ æ ‡å¯ä»¥å¯¹åŠ¨ç”»æ—¶é—´è¿›è¡Œå®šä½ã€‚

	- ä½œå“åœ°å€ https://codepen.io/zadvorsky/pen/PNXbGo

- Flexbox æ¸¸ä¹åœº

	åœ¨è¿™ä¸ªä½œå“ä¸­ï¼Œä½œè€…ä¸ºå¤§å®¶å±•ç¤ºäº† Flex å®¹å™¨å±æ€§ä¸é¡¹ç›®å±æ€§çš„åº”ç”¨ï¼Œäº¤äº’åœ°å­¦ä¹  Web çš„ Flexbox å¸ƒå±€æŠ€æœ¯ã€‚UI æ§ä»¶çš„è®¾è®¡åšå¾—ä¸é”™ï¼Œæ‹–åŠ¨å¯ä»¥è°ƒæ•´æ•°å€¼ï¼Œç‚¹å‡»å¯ä»¥è®¾ç½®é¢„é…ç½®å±æ€§ã€‚

	- å‚è€ƒé˜®ä¸€å³°çš„ Flex å¸ƒå±€æ•™ç¨‹ https://www.ruanyifeng.com/blog/2015/07/flex-grammar.html	
	- ä½œå“åœ°å€ https://codepen.io/enxaneta/pen/adLPwv



## Rendering è§¦å‘æ›´æ–°æ¸²æŸ“
- React v16.6.0: lazy, memo and contextType https://reactjs.org/blog/2018/10/23/react-v-16-6.html
- Hooks FAQ: How do I implement shouldComponentUpdate? https://reactjs.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate
- Dive into React codebase: Handling state changes https://reactkungfu.com/2016/03/dive-into-react-codebase-handling-state-changes/
- Optimizing Performance https://reactjs.org/docs/optimizing-performance.html

å‰é¢è§£æäº† React çš„æ¸²æŸ“åŸºæœ¬æµç¨‹ï¼Œè¿™é‡Œå°†é‡ç‚¹æ”¾åœ¨æ¸²æŸ“æ§åˆ¶ä¸Šã€‚React æ¸²æŸ“å°±æ˜¯æ‰§è¡Œå…ƒç´ çš„æ¸²æŸ“å‡½æ•°çš„è¿‡ç¨‹ï¼Œå¯¹äºç±»ç»„ä»¶ï¼Œå°±æ˜¯ render() æˆå‘˜å‡½æ•°ï¼Œå¯¹äºå‡½æ•°å¼ç»„ä»¶å°±æ˜¯å®ƒæœ¬èº«ï¼Œå¯¹äº HTML å…ƒç´ åˆ™ç›´æ¥è§£ææˆè™šæ‹ŸèŠ‚ç‚¹å†æ„é€ æˆçœŸå®çš„ DOM èŠ‚ç‚¹ã€‚

ä½†æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘ï¼ŒRender() å‡½æ•°æ˜¯æœ‰æ¡ä»¶è§¦å‘çš„ï¼Œå¯¹äºç±»ç»„ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜æ¶‰åŠç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ç»†èŠ‚ï¼š

+ é¦–æ¬¡æ¸²æŸ“ Initial Renderï¼Œå³å…ƒç´ ç¬¬ä¸€æ¬¡è¢«å‘ˆç°åœ¨é¡µé¢æ—¶è§¦å‘ï¼›
+ è°ƒç”¨ this.setState() æ›´æ–°ç»„ä»¶çŠ¶æ€ï¼Œä¸ä¼šç«‹å³è§¦å‘ï¼ŒReact ä¼šä¼˜åŒ–åœ¨é€‚å½“æ—¶æœºæ‰§è¡Œï¼›
+ æ›´æ–°çˆ¶ç»„ä»¶çŠ¶æ€æ—¶ï¼Œé€šå¸¸ä¼šä¿®æ”¹å­ç»„ä»¶çš„ props å±æ€§æ¥ä¼ é€’æ•°æ®ï¼Œä½¿å¾—å­ç»„ä»¶çŠ¶æ€è¢«åŠ¨æ›´æ–°ï¼›
+ å¦‚æœçˆ¶ç»„ä»¶è§¦å‘äº† render(), åŸºæœ¬ä¸Šå­ç»„ä»¶ä¹Ÿä¼šç›¸åº”è§¦å‘ render()ï¼›
+ è°ƒç”¨ç»„ä»¶çš„ this.forceUpdate() æˆ– forcereload() è¿›è¡Œå¼ºåˆ¶æ¸²æŸ“ï¼›
+ è°ƒç”¨ ReactDOM.unmountComponentAtNode(this.el) é”€æ¯ç»„ä»¶å†é‡æ–°æ¸²æŸ“ï¼Œå¯ä»¥é…åˆ ReactDOM.findDOMNode() æ–¹æ³•ä½¿ç”¨ï¼›

æ¸²æŸ“æ—¶æœºçš„æ§åˆ¶æ˜¯å¾ˆå¤§çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œæ¶‰åŠåˆ°æ€§èƒ½ä¼˜åŒ–çš„æ–¹æ–¹é¢é¢ï¼Œç‰¹åˆ«æ˜¯è¶Šå¤§çš„å·¥ç¨‹ï¼Œä¼˜åŒ–éœ€æ±‚è¶Šè¿«åˆ‡ã€‚è¿™éœ€è¦ç†Ÿç»ƒåœ°ä½¿ç”¨ React çš„å„ç§è°ƒä¼˜æŠ€æœ¯ã€‚

React ç»„ä»¶å¤§æ¦‚åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š

- HTML æ ‡ç­¾ç»„ä»¶ï¼Œæ­£ç¡®æ¥è®²æ˜¯ Elementï¼›
- StatelessComponent æ— çŠ¶æ€ç»„ä»¶ï¼Œæˆ–ç§°ä¸ºå‡½æ•°å¼ç»„ä»¶ï¼ŒåŒ…æ‹¬é«˜é˜¶å‡½æ•°ç»„ä»¶ HOC - High Order Componentsï¼›
- React.Component å’Œ PureComponent ä¸¤ç§æœ‰çŠ¶æ€çš„ç±»ç»„ä»¶ï¼Œå®ƒä»¬åŒ…å«å®Œæ•´çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼›


æ¯”å¦‚ï¼Œä¸€å®šè¦ä½¿ç”¨ç±»ç»„ä»¶æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ PureComponent ç±»ç»„ä»¶æ›¿ä»£ Component ç±»ç»„ä»¶ï¼Œä¸¤è€…è¡¨ç°åŸºæœ¬éƒ½ä¸€æ ·ã€‚åªæ˜¯åœ¨ shouldComponentUpdate æ–¹æ³•çš„å®ç°é€»è¾‘ä¸Šä¸ä¸€æ ·ï¼ŒComponent çš„å®ç°åªæ˜¯ç®€å•è¿”å› trueã€‚è€Œ PureComponent çš„å®ç°å¯¹ propsã€state è¿›è¡Œæµ…æ¯”è¾ƒ shallow comparisonï¼Œå¦‚æœç»„ä»¶çš„ props å’Œ state éƒ½æ²¡å‘ç”Ÿæ”¹å˜å°±ä¸æ‰§è¡Œæ¸²æŸ“ï¼ŒåŒ…æ‹¬ componentWillUpdate å’Œ componentDidUpdate å‡½æ•°éƒ½ä¸æ‰§è¡Œã€‚è¿™æ ·è¿‡æ»¤äº†ä¸å¿…è¦è¡Œä¸ºæ¥æé«˜æ€§èƒ½ï¼Œä½†è¯¥ç»„ä»¶ä¹Ÿå…·æœ‰ä¸€å®šçš„ç¼ºé™·ï¼Œå› ä¸ºå®ƒåªèƒ½è¿›è¡Œä¸€å±‚æµ…æ¯”è¾ƒã€‚ç®€å•æ¥è¯´ï¼Œå®ƒåªæ¯”è¾ƒ props å’Œ state çš„å†…å­˜åœ°å€ï¼Œå¦‚æœå†…å­˜åœ°å€ç›¸åŒï¼Œå°±è¿”å› false ä¸æ‰§è¡Œé‡ç»˜ã€‚

React å®šä¹‰äº†ç”Ÿå‘½å‘¨æœŸçš„æ¥å£ ComponentLifecycleï¼Œæ‰€æœ‰ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°éƒ½æ˜¯æ¥å£ç»™å®šçš„ï¼Œè¿™éƒ¨åˆ†ä¸“é—¨åœ¨ç»„ä»¶çš„çŠ¶æ€ä¸ç”Ÿå‘½å‘¨æœŸä¸­è§£æã€‚

å‚è€ƒ ReactBaseClasses æºä»£ç ï¼š

	// react-17.0.0\packages\react\src\ReactBaseClasses.js
	/**
	 * Convenience component with default shallow equality check for sCU.
	 */
	function PureComponent(props, context, updater) {
	  this.props = props;
	  this.context = context;
	  // If a component has string refs, we will assign a different object later.
	  this.refs = emptyObject;
	  this.updater = updater || ReactNoopUpdateQueue;
	}

	const pureComponentPrototype = (PureComponent.prototype = new ComponentDummy());
	pureComponentPrototype.constructor = PureComponent;
	// Avoid an extra prototype jump for these methods.
	Object.assign(pureComponentPrototype, Component.prototype);
	pureComponentPrototype.isPureReactComponent = true;

	export {Component, PureComponent};



å¦‚æœä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ— çŠ¶æ€ç»„ä»¶å°±æ˜¯ä¸€ä¸ª render çº¯å‡½æ•°ï¼Œå¯ä»¥æ­é… Hooks API ä½¿ç”¨ã€‚

- âœ… React.memo() ç¼“å­˜å‡½æ•°å¼ç»„ä»¶å¢å¼ºæ€§èƒ½ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ç»„ä»¶ï¼›
- âœ… React.useMemo() å¯¹å‡½æ•°å¼ç»„ä»¶å¯ç”¨ç¼“å­˜å¢å¼ºæ€§èƒ½ï¼Œè¿™æ˜¯ React æä¾›çš„ä¸€ä¸ª Hooks APIï¼›
- âœ… React.lazy() ä½¿ç”¨ <Suspense /> è¿›è¡Œä»£ç æ‹†åˆ†å’Œæ‡’åŠ è½½ï¼Œå‚è€ƒ Code-Splitting æ–‡æ¡£ï¼›
- âœ… ç±»ç»„ä»¶èƒ½é€šè¿‡ shouldComponentUpdate ä¾æ® props å’Œ state å†³å®šæ˜¯å¦æ‰§è¡Œ renderã€‚
- âœ… å‡½æ•°å¼ç»„ä»¶é€šè¿‡ React 16.6.0 æä¾›çš„ React.memo() é«˜é˜¶ç»„ä»¶å°è£…è·å¾—ä¾æ® props å†³å®šæ˜¯å¦æ‰§è¡Œ render çš„èƒ½åŠ›ã€‚

å…¶ä¸­ memo() å’Œ lazy()ï¼ŒReact 16.6.0 å‘å¸ƒæ›´æ–°äº†ä¸¤ä¸ªæ–°çš„é‡è¦åŠŸèƒ½ï¼Œæ­¤å¤–è¿˜å¼•å…¥å…¶å®ƒå¤šä¸ª Hooks APIã€‚æ—§ç‰ˆæœ¬ React ä¸­ï¼Œå› ä¸ºå‡½æ•°å¼ç»„ä»¶æ²¡æœ‰çŠ¶æ€ç®¡ç†ï¼Œä¸é€‚ç”¨ setState æ–¹å¼æ›´æ–°ç»„ä»¶çŠ¶æ€ï¼Œè€Œæ–°ç‰ˆæœ¬å¼•å…¥äº† useState() ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ä¹Ÿèƒ½åƒç±»ç»„ä»¶ä¸€æ ·ä½¿ç”¨çŠ¶æ€ç®¡ç†å‡½æ•°ã€‚

å½“å·¥ç¨‹è§„æ¨¡ã€ä¾èµ–ç»„ä»¶è¾¾åˆ°ä¸€å®šé‡ä¹‹åï¼Œæ‰“åŒ…åçš„æ–‡ä»¶ä¹Ÿä¼šéšä¹‹å¢å¤§è€Œä½¿å¾—é¡µé¢ä¸èƒ½ä¸€æ¬¡è¿‡åŠ è½½æ‰€æœ‰å†…å®¹ï¼Œåœ¨æµè§ˆæŸä¸ªé¡µé¢çš„æ—¶å€™ä¹Ÿå¹¶ä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰å†…å®¹ï¼Œåªéœ€è¦å½“å‰é¡µé¢çš„èµ„æºå³å¯ï¼Œæ­¤æ—¶å¯ä»¥å‚è€ƒæœ¬æ–‡æ¡£å®ç°é™æ€èµ„æºçš„åˆ‡å‰²åŠæŒ‰éœ€åŠ è½½ã€‚

ä»¥ä¸‹ç¤ºèŒƒ React.lazy() çš„ä½¿ç”¨ï¼š

	import React, {lazy, Suspense} from 'react';
	const OtherComponent = lazy(() => import('./OtherComponent'));

	function MyComponent() {
	  return (
	    <Suspense fallback={<div>Loading...</div>}>
	      <OtherComponent />
	    </Suspense>
	  );
	}

å‡½æ•°åŸå‹å‚è€ƒï¼š

    function lazy<T extends ComponentType<any>>(
        factory: () => Promise<{ default: T }>
    ): LazyExoticComponent<T>;


React.memo() å’Œ PureComponent å¾ˆç›¸ä¼¼ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬æ§åˆ¶ä½•æ—¶é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

	class Child extends React.PureComponent {
	    render(){
	        return (
	            <div>I am update at {Date.now()/1000}</div>
	        )
	    }
	}

	const MyFC = React.memo(function MyFC(props) {
	    return (
	        <div>I am update at {Date.now()/1000}, only if props change</div>
	    )
	});

æ³¨æ„ï¼ŒReact.memo() æ˜¯é«˜é˜¶å‡½æ•°ç»„ä»¶ HOCï¼Œç»è¿‡å®ƒå°é—­çš„å‡½æ•°ç»„ä»¶è¿˜æ˜¯å‡½æ•°ç»„ä»¶ï¼Œä½†ç»„ä»¶ä»…åœ¨å®ƒçš„ props å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨ç»„ä»¶æ ‘ä¸­ React ç»„ä»¶ï¼Œåªè¦æœ‰å˜åŒ–å°±ä¼šèµ°ä¸€éæ¸²æŸ“æµç¨‹ã€‚ä½†æ˜¯é€šè¿‡ PureComponent å’Œ React.memo()ï¼Œæˆ‘ä»¬æ§åˆ¶ç»„ä»¶çš„æ¸²æŸ“æµç¨‹ã€‚

React.memo() æ¥å—ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºçº¯å‡½æ•°çš„ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œç”¨äºå¯¹æ¯” props æ§åˆ¶æ˜¯å¦åˆ·æ–°ï¼Œä¸ shouldComponentUpdate() åŠŸèƒ½ç±»ä¼¼ï¼Œæ‰€ä»¥ React.memo å¯ä»¥çœ‹ä½œæ˜¯ PureComponent ä¸€æ ·çš„ç»„ä»¶ã€‚React.memo() å°è£…å‡½æ•°å¼ç»„ä»¶ï¼Œè¢«å°è£…çš„ç»„ä»¶ä¾æ—§ä¿æŒåŸæœ‰çš„å‡½æ•°ç‰¹æ€§ï¼Œè¿™å°±æ˜¯é«˜é˜¶å‡½æ•° HOC çš„æ„ä¹‰ã€‚

React.memo() å’Œ useMemo å‘½åä¸Šå¾ˆç›¸ä¼¼ï¼ŒåŠŸèƒ½ä¸Šå¾ˆæ˜¯ç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯æä¾›ç»„ä»¶ç¼“å­˜åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¯ä»¥ç»™ memo() çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªçŠ¶æ€æ¯”è¾ƒå‡½æ•°ï¼Œåˆ¤æ–­ç›¸åŒå°±ä¸é‡æ–°æ¸²æŸ“ï¼Œè€Œ useMemo() æœ¬èº«æœ‰æ¯”è¾ƒå‡½æ•°ï¼Œåªéœ€ä¼ å…¥ä¾èµ–çš„çŠ¶æ€æ•°æ®åˆ—è¡¨ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

	const Button = React.memo((props) => {
	  // your component
	});

	function Parent({ a, b }) {
	  // Only re-rendered if `a` changes:
	  const child1 = useMemo(() => <Child1 a={a} />, [a]);
	  // Only re-rendered if `b` changes:
	  const child2 = useMemo(() => <Child2 b={b} />, [b]);
	  return (
	    <>
	      {child1}
	      {child2}
	    </>
	  )
	}

å‚è€ƒ React.memo åŸå‹ï¼š

	export function memo<Props>(
	  type: React$ElementType,
	  compare?: (oldProps: Props, newProps: Props) => boolean,
	)

ä¸Šçº¿ä½“éªŒ https://codepen.io/jeango/full/XWjLaLO


## Components & Props ç»„ä»¶ä¸å±æ€§
- React Components, Elements, and Instances https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html

å‰é¢å·²ç»è§£æè¿‡ React ç»„ä»¶å¤§æ¦‚åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š

- HTML æ ‡ç­¾ï¼Œæ­£ç¡®æ¥è®²æ˜¯ Element ä¸æ˜¯ç»„ä»¶ï¼Œä½†å½“ä½œç»„ä»¶æ¥ä½¿ç”¨ä¹Ÿæ²¡ä»€ä¹ˆä¸å¯¹ï¼›
- FunctionComponent å‡½æ•°å¼ç»„ä»¶ï¼Œæˆ–ç§°æ— çŠ¶æ€ç»„ä»¶ï¼ŒåŒ…æ‹¬é«˜é˜¶å‡½æ•°ç»„ä»¶ HOC - High Order Componentsï¼›
- React.Component å’Œ PureComponent ä¸¤ç§æœ‰çŠ¶æ€çš„ç±»ç»„ä»¶ï¼Œå®ƒä»¬åŒ…å«å®Œæ•´çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼›

ä½¿ç”¨ç»„ä»¶æ¦‚å¿µçš„ç›®çš„å°±æ˜¯ä¸ºäº†æé«˜è½¯ä»¶çš„å¤ç”¨ï¼Œå¦‚æœä¸èƒ½é«˜æ•ˆå¾—åˆ©ç”¨ç»„ä»¶ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªå¤±è´¥çš„ç»„ä»¶ã€‚

React ç±»å‹å®šä¹‰ä¸­ï¼Œç±»ç»„ä»¶æ˜¯æ³›å‹å®ç°ï¼Œå…¶ä¸­ Pã€Sã€SS å‚æ•°å¯¹åº”çš„æ˜¯ Props, State å’Œ getSnapshotBeforeUpdate æ–¹æ³•ç›¸å…³çš„ SnapShotï¼š

    class Component<P, S> { ... }

    interface Component<P = {}, S = {}, SS = any> extends ComponentLifecycle<P, S, SS> { }
    interface ComponentLifecycle<P, S, SS = any> extends NewLifecycle<P, S, SS>, DeprecatedLifecycle<P, S> {...}


åœ¨ React ä¸­ï¼Œç»„ä»¶ä¸€èˆ¬æœ‰ä¸¤ç§å½¢å¼ï¼šå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ï¼Œå‰è€…å°±æ˜¯ä¸€ä¸ªå‡½æ•°å°±å¯ä»¥å½“ä¸€ä¸ªç»„ä»¶ã€‚

	// ç±»ç»„ä»¶
	class MyClassComp extends React.Component {
		render () {
			return <div className="my-comp"></div>
		}
	}

	// å‡½æ•°ç»„ä»¶
	const MyPureFuncComp = () => (
		<div className="my-comp"></div>
	)

åœ¨ React ç³»ç»Ÿå†…ï¼Œå‡½æ•°å³ç»„ä»¶ï¼React è¦ä½¿ç”¨å‡½æ•°ä½œä¸ºç»„ä»¶çš„æœ€å°å•å…ƒï¼Œå‡½æ•°å¼ç»„ä»¶æ²¡æœ‰è‡ªå·±çš„ State ï¼Œå› ä¸ºå‡½æ•°å¼ç»„ä»¶å…¶å®æ˜¯ä¸€ä¸ªåªå®ç°äº† render å‡½æ•°çš„ç»„ä»¶ã€‚


æ¯”å¦‚ï¼Œå®˜ç½‘æ–‡æ¡£ä¸­çš„ä¸€ä¸ªè¯„è®ºç»„ä»¶çš„åé¢ç¤ºèŒƒï¼š

	function Comment(props) {
	  return (
	    <div className="Comment">
	      <div className="UserInfo">
	        <img
	          className="Avatar"
	          src={props.author.avatarUrl}
	          alt={props.author.name}
	        />
	        <div className="UserInfo-name">
	          {props.author.name}
	        </div>
	      </div>
	      <div className="Comment-text">{props.text}</div>
	      <div className="Comment-date">
	        {formatDate(props.date)}
	      </div>
	    </div>
	  );
	}

å¯¹äºä¸€ä¸ªç»„ä»¶æ¥è¯´ï¼Œç»“æ„å¤ªå¤æ‚äº†ï¼Œéœ€è¦ç»†åŒ–ç»„ä»¶çš„åŠŸèƒ½ï¼Œå°½é‡åŠŸèƒ½ä¿æŒå•çº¯ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯éƒ¨åˆ†å°±å¯ä»¥å–ä½œä¸ºä¸¤ä¸ªç»„ä»¶æ¥å®ç°ï¼š

	function Avatar(props) {
	  return (
	    <img className="Avatar"
	      src={props.user.avatarUrl}
	      alt={props.user.name}
	    />
	  );
	}

	function UserInfo(props) {
	  return (
	    <div className="UserInfo">
	      <Avatar user={props.user} />
	      <div className="UserInfo-name">
	        {props.user.name}
	      </div>
	    </div>
	  );
	}

	function Comment(props) {
	  return (
	    <div className="Comment">
	      <UserInfo user={props.author} />
	      <div className="Comment-text">{props.text}</div>
	      <div className="Comment-date">
	        {formatDate(props.date)}
	      </div>
	    </div>
	  );
	}

å†ç»„åˆåï¼Œå°±æ„æˆå…¨åŠŸèƒ½çš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿˜å¯ä»¥ç”¨åœ¨å…¶å®ƒé¡µé¢ä¸Šï¼Œè¿™å°±æ˜¯ç»„ä»¶çš„å¤ç”¨ï¼Œè¿™ç§ç»„ä»¶ç»„åˆçš„æ€æƒ³æ˜¯ React çš„åŸºæœ¬è®¾è®¡ç†å¿µã€‚


React æä¾›äº†å‡½æ•°å¼ç»„ä»¶çš„å†…éƒ¨å®šä¹‰ï¼ŒReact 16.7 - React.SFC æ˜¯è¿‡æ—¶ APIï¼Œæœ€æ–°çš„æ˜¯ React.FCï¼Œå¯ä»¥æ›¿æ¢ä½¿ç”¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ Hooks å‡½æ•°ã€‚è¯·æ³¨æ„ React.SFC æ˜¯ React.StatelessComponent çš„åˆ«åï¼ŒReact.FC æ˜¯ React.FunctionComponent çš„åˆ«åã€‚ 

	const example: React.StatelessComponent<IProps> = ({props}) => ();
	const example: React.SFC<IProps> = ({props}) => ();

	const example: React.FunctionComponent<IProps> = ({props}) => ();
	const example: React.FC<IProps> = ({props}) => ();

å‡½æ•°ç»„ä»¶ä¹Ÿå«æ— çŠ¶æ€ç»„ä»¶ StatelessComponentï¼Œå¯ä»¥è¿”å›é™¤å¯¹è±¡ç±»å‹å¤–çš„ HTML æ ‡ç­¾ã€å­—ç¬¦ä¸²ã€æ•°å€¼ç­‰åŸºç¡€ç±»å‹æˆ–ç±»ç»„ä»¶ï¼Œæˆ–åŒ…å«è¿™äº›ç±»å‹çš„æ•°ç»„ï¼Œéƒ½æ˜¯æ­£ç¡®çš„ã€‚æ— çŠ¶æ€ç»„ä»¶æ¦‚å¿µ Stateless Component é™¤äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„å±æ€§ propsï¼Œå®ƒä¸åº”è¯¥å†ä¾èµ–å…¶ä»–çš„ä»»ä½•çš„å…¨å±€å˜é‡ï¼Œå®ƒä¸åº”è¯¥ç»´æŠ¤è‡ªå·±çš„ stateã€‚å› æ­¤æ— çŠ¶æ€ç»„ä»¶åŠ è½½åä¸åº”è¯¥å†æ›´æ”¹å…¶è§†å›¾ï¼Œä¸åº”è¯¥å¯¹æ— çŠ¶æ€ç»„ä»¶è¿›è¡Œé‡ç»˜ã€‚æˆ–è€…è¯´éœ€è¦é‡ç»˜çš„ç»„ä»¶å°±ä¸åº”è¯¥ä½¿ç”¨æ— çŠ¶æ€ç»„ä»¶ï¼Œè€Œåº”è¯¥ä½¿ç”¨ç±»ç»„ä»¶ã€‚

ä»¥ä¸‹ç±»å‹å®šä¹‰ä¿¡æ¯æ¥è‡ª @types/reactã€‚å¯ä»¥çœ‹åˆ° SFC æˆ– StatelessComponent å³æ— çŠ¶æ€ç»„ä»¶å·²ç»å¼ƒç”¨ï¼Œæ”¹ç”¨ FunctionComponentï¼š

    /**
     * @deprecated as of recent React versions, function components can no
     * longer be considered 'stateless'. Please use `FunctionComponent` instead.
     *
     * @see [React Hooks](https://reactjs.org/docs/hooks-intro.html)
     */
    type SFC<P = {}> = FunctionComponent<P>;

    /**
     * @deprecated as of recent React versions, function components can no
     * longer be considered 'stateless'. Please use `FunctionComponent` instead.
     *
     * @see [React Hooks](https://reactjs.org/docs/hooks-intro.html)
     */
    type StatelessComponent<P = {}> = FunctionComponent<P>;

    type FC<P = {}> = FunctionComponent<P>;

    interface FunctionComponent<P = {}> {
        (props: PropsWithChildren<P>, context?: any): ReactElement | null;
        propTypes?: WeakValidationMap<P>;
        contextTypes?: ValidationMap<any>;
        defaultProps?: Partial<P>;
        displayName?: string;
    }

æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥æ¥æ”¶ä»»æ„å±æ€§æ•°æ®ï¼Œé€šå¸¸ä½¿ç”¨å‘½åä¸º props çš„å˜é‡è¿›è¡Œä¼ é€’ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»„ä»¶å±æ€§æ•°æ®æ°¸è¿œæ˜¯å•å‘æµåŠ¨çš„ï¼Œä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶ã€‚å­ç»„ä»¶ä¿®æ”¹ props çš„æ•°æ®å¹¶ä¸ä¼šåé¦ˆåˆ°çˆ¶ç»„ä»¶ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œå°±åƒå‡½æ•°ä¼ å€¼è°ƒç”¨ä¸€æ ·ï¼Œæ‰€ä»¥ç»„ä»¶å¯¹ props å±æ€§çš„è®¿é—®æ˜¯åªè¯»çš„ Read-Onlyã€‚è™½ç„¶ï¼ŒJavaScript è¿™é‡Œä¼ é€’çš„æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œä½†æ˜¯åœ¨ React å†…éƒ¨å¹¶ä¸éš¾å°†è¿™ä¸ªå¼•ç”¨çš„å¯¹è±¡åšä¸€æ¬¡å®Œæ•´æ‹·è´ï¼Œä½¿åŸæ¥ä¼ å…¥çš„å¯¹è±¡å¼•ç”¨å¤±å»ä½œç”¨ï¼Œæ‰€ä»¥åœ¨å­ç»„ä»¶ä¸­ä¿®æ”¹ props åªåœ¨å­ç»„ä»¶ä¸­ç”Ÿæ•ˆã€‚

åœ¨é¡¹ç›®ä¸­ä¼šæœ‰ç»„ä»¶é—´çš„æ•°æ®é€šè®¯éœ€è¦ï¼Œåœ¨è¿™ç§å•å‘çš„æ•°æ®æµçº¦æŸä¸‹ï¼Œæœ‰ä¸åŒæƒ…å½¢åŠç›¸åº”çš„å¤„ç†ï¼š

+ çˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šä¿¡ï¼šç›´æ¥ç»™å­ç»„ä»¶ä¼ é€’ propsï¼›
+ å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡ï¼šå°†å›è°ƒå‡½æ•°é€šè¿‡ props ä¼ å…¥å­ç»„ä»¶ï¼›
+ è·¨çº§ç»„ä»¶é—´é€šä¿¡ï¼šä½¿ç”¨ Context å¯¹è±¡ï¼Œå‚è€ƒ Hooks API useContext()ï¼›
+ éåµŒå¥—ç»„ä»¶é—´é€šä¿¡ï¼šä½¿ç”¨äº‹ä»¶è®¢é˜…ç¼–ç¨‹æ¨¡å¼ EventBusï¼›
+ ä½¿ç”¨æµè§ˆå™¨æä¾›çš„ localStorageã€sessionStorage æœ¬åœ°å­˜å‚¨æœåŠ¡...

æµè§ˆå™¨æœ¬åœ°å­˜å‚¨æœåŠ¡å¤§çº¦æœ‰ 5MB å®¹é‡ï¼Œç¤ºèŒƒï¼š

	// å½“å‰ä¼šè¯æ•°æ®å­˜å‚¨æœåŠ¡
	sessionStorage.setItem("lastname", "Smith");
	sessionStorage.getItem("lastname");

	// æœ¬åœ°å­˜å‚¨å­˜å‚¨æœåŠ¡
	localStorage.setItem("lastname", "Smith");
	localStorage.getItem("lastname");


å’Œç»„ä»¶å±æ€§ç›¸å¯¹çš„æ˜¯çŠ¶æ€æ•°æ®ï¼Œå°±æ˜¯ç§°ä¸º state çš„çŠ¶æ€æ•°æ®ï¼Œå®ƒéœ€è¦é€šè¿‡ä¸“å±çš„ API æ¥è®¾ç½®æ‰èƒ½è§¦å‘ç»„ä»¶çŠ¶æ€çš„æ›´æ–°ã€‚

ç»„ä»¶å¯ä»¥é€‰æ‹©æŠŠå®ƒçš„ state ä½œä¸ºå­ç»„ä»¶çš„ props å‘ä¸‹ä¼ é€’åˆ°å®ƒçš„å­ç»„ä»¶ä¸­ï¼š

	<h2>It is {this.state.date.toLocaleTimeString()}.</h2>

è¿™å¯¹äºè‡ªå®šä¹‰ç»„ä»¶åŒæ ·é€‚ç”¨ï¼š

	<FormattedDate date={this.state.date} />

FormattedDate ç»„ä»¶ä¼šåœ¨å…¶ props ä¸­æ¥æ”¶å‚æ•° dateï¼Œä½†æ˜¯ç»„ä»¶æœ¬èº«æ— æ³•çŸ¥é“å®ƒæ˜¯æ¥è‡ªäº Clock çš„ state æˆ– propsï¼Œè¿˜æ˜¯æ‰‹åŠ¨è¾“å…¥çš„ï¼š

	function FormattedDate(props) {
	  return <h2>It is {props.date.toLocaleTimeString()}.</h2>;
	}


æœ€ç®€å•çš„å­ç»„ä»¶å‘çˆ¶çº§ä¼ é€’æ•°æ®çš„æ–¹æ³•ï¼Œæ˜¯åœ¨çˆ¶ç»„ä»¶ä¸­ç»™å­ç»„ä»¶å±æ€§ä¸­è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå³ React å®˜æ–¹æ–‡æ¡£ä¸­æ‰€è¯´çš„ç»„ä»¶çŠ¶æ€æå‡ Lifting State Upã€‚å®˜æ–¹æä¾›çš„ä¾‹å­æ¼”ç¤ºäº†æ‘„æ°åº¦ Celsius å’Œåæ°åº¦ Fahrenheit æ¢ç®—ï¼Œå­ç»„ä»¶é€šè¿‡è°ƒç”¨ onTemperatureChange è®¾ç½®çš„å›è°ƒå‡½æ•°å‘çˆ¶ç»„ä»¶æŠ¥å‘Šè¾“å…¥çš„æ¸©åº¦ã€‚

å» CodePen äº¤äº’ä½“éªŒ https://codepen.io/gaearon/pen/WZpxpz?editors=0010


## Without JSX then createClass() ç»„ä»¶åˆ›å»ºæ–¹å¼
- https://reactjs.org/docs/react-without-es6.html
- https://reactjs.org/docs/react-without-jsx.html
- https://babeljs.io/repl/

æœ€ç®€å•çš„ç»„ä»¶åˆ›å»ºå°±æ˜¯åœ¨ render() å‡½æ•°ä¸­ä¼ å…¥çš„ HTML æ ‡ç­¾ï¼š

```js
render() {
    return (<div className="demo">æš‚æ— æ•°æ®</div>);
}
```

å®é™…ä¸Š React å°†æ‰€å­—ç¬¦ä¸²ã€æ•°å€¼ã€åŒ…å«å­—ç¬¦ä¸²æˆ–æ•°å€¼çš„æ•°ç»„éƒ½çœ‹ä½œæ˜¯ç»„ä»¶ï¼Œè¿”å›è¿™äº›å†…å®¹çš„å‡½æ•°ä¹Ÿæ˜¯ç»„ä»¶ã€‚

```js
const e = React.createElement;

ReactDOM.render(
  e('div', null, 'Hello World'),
  document.getElementById('root')
);
```

é™¤äº†é€šè¿‡æ‰©å±• React.Component æˆ– PureComponent çš„æ–¹å¼ï¼Œå¦ä¸€åˆ›å»ºç±»ç»„ä»¶çš„æ–¹æ³•æ˜¯é€šè¿‡ React.createClass() å‡½æ•°ï¼š

```tsx
class Hello extends React.Component {
	render() {
		return <div>Hello {this.props.toWhat}</div>;
	}
}

ReactDOM.render(
	<Hello toWhat="World" />,
	document.getElementById('root')
);
```

ä»¥ä¸Šä»£ç ç»è¿‡ç¼–è¯‘åï¼Œå¾—åˆ°ä¸å« JSX çš„ä»£ç :

```ts
class Hello extends React.Component {
	render() {
		return React.createElement('div', null, `Hello ${this.props.toWhat}`);
	}
}

ReactDOM.render(
	React.createElement(Hello, {toWhat: 'World'}, null),
	document.getElementById('root')
);
```

createClass() è¿™ç§æ–¹æ³•æ˜¯ JSX è¯­æ³•ç»è¿‡ Babel ç¼–è¯‘åä½¿ç”¨çš„ï¼Œå¯ä»¥åœ¨çº¿å°è¯• Babel REPLã€‚

- React.createClass() æ–¹æ³•ç”¨äºç”Ÿæˆä¸€ä¸ªç»„ä»¶ç±»ï¼›
- æ‰€æœ‰ç»„ä»¶ç±»éƒ½å¿…é¡»æœ‰è‡ªå·±çš„ render æ–¹æ³•ï¼Œç”¨äºè¾“å‡ºç»„ä»¶ï¼›
- å‡å¦‚ç”Ÿæˆä¸€ä¸ªç»„ä»¶ç±» Helloï¼Œæ¨¡æ¿æ’å…¥`<Hello />`æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆç»„ä»¶ç±» Hello çš„ä¸€ä¸ªå®ä¾‹
- ç»„ä»¶ç±»çš„ç¬¬ä¸€ä¸ªå­—æ¯å¿…é¡»å¤§å†™ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ Helloï¼Œä¸èƒ½å†™æˆ helloï¼Œé¿å…è§£ææˆ html æ ‡ç­¾
- ç»„ä»¶ç±»é‡Œé¢åªèƒ½åŒ…å«ä¸€ä¸ªé¡¶å±‚æ ‡ç­¾ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå¤šä¸ªç»„ä»¶å¯ä»¥ä½¿ç”¨æ•°ç»„åŒ…è£…ï¼›
- ç»„ä»¶ç±»å¯¹åº”çš„æ ‡ç­¾çš„ç”¨æ³•å’Œ HTML æ ‡ç­¾çš„ç”¨æ³•å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥åŠ å…¥ä»»æ„çš„å±æ€§ï¼›
- ç»™ç»„ä»¶æ ‡ç­¾æ·»åŠ å±æ€§æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯æŠŠ class å±æ€§å†™æˆ classNameï¼Œfor å±æ€§å†™æˆ htmlForï¼Œè¿™æ˜¯å› ä¸º class å’Œ for æ˜¯ä¿ç•™å­—ï¼›

createClass æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œextends çš„æ–¹å¼æ›´åŠ æ¥è¿‘æœ€æ–°çš„ ES6 è§„èŒƒçš„å†™æ³•ï¼Œä¸¤ç§æ–¹å¼åœ¨è¯­æ³•ä¸Šçš„å·®åˆ«ä¸»è¦ä½“ç°åœ¨æ–¹æ³•çš„å®šä¹‰å’Œé™æ€å±æ€§çš„å£°æ˜ä¸Šã€‚

React.createClass å’Œ extends Component çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼š

- è¯­æ³•åŒºåˆ«ï¼Œæ‰©å±•ç±»ç»„ä»¶åœ¨ constructor æ„é€ å™¨æ¥æ„é€ é»˜è®¤çš„å±æ€§å’ŒçŠ¶æ€ã€‚
- propType å’Œ getDefaultProps
- çŠ¶æ€æ•°æ®å¯¹è±¡çš„å¤„ç†
- this ç»‘å®š
- Mixins æ··å…¥

å‡½æ•°æ–¹å¼ React.createClass åˆ›å»ºç»„ä»¶é€šè¿‡ propTypes å±æ€§å¯¹è±¡å’Œ getDefaultProps() æ–¹æ³•æ¥è®¾ç½®å’Œè·å–ç»„ä»¶ä¼ å…¥å‚æ•°ï¼š

```js
import React from 'react';

const Contacts = React.createClass({  
  propTypes: {
    name: React.PropTypes.string
  },
  getDefaultProps() {
    return {

    };
  },
  render() {
    return (
      <div></div>
    );
  }
});

export default Contacts;  
```

æ‰©å±• React.Component é€šè¿‡è®¾ç½®ä¸¤ä¸ªå±æ€§ propTypes å’Œ defaultProps

```ts
import React form 'react';
class TodoItem extends React.Component{
    static propTypes = { // as static property
        name: React.PropTypes.string
    };
    static defaultProps = { // as static property
        name: ''
    };
    constructor(props){
        super(props)
    }
    render(){
        return <div></div>
    }
}
```

React.createClass é€šè¿‡ getInitialState() æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«åˆå§‹å€¼çš„å¯¹è±¡

	import React from 'react';
	let TodoItem = React.createClass({
	    // return an object
	    getInitialState(){ 
	        return {
	            isEditing: false
	        }
	    }
	    render(){
	        return <div></div>
	    }
	})

React.Componentï¼šé€šè¿‡ constructor è®¾ç½®åˆå§‹çŠ¶æ€

	import React from 'react';
	class TodoItem extends React.Component{
	    constructor(props){
	        super(props);
	        this.state = { // define this.state in constructor
	            isEditing: false
	        } 
	    }
	    render(){
	        return <div></div>
	    }
	}

ä¸ºäº‹ä»¶ç»‘å®šå¤„ç†å‡½æ•°æ—¶ï¼Œæ ¹æ®ç»‘å®šæ–¹å¼ä¸åŒï¼Œå¤„ç†å‡½æ•°çš„ this æ˜¯æœ‰åŒºåˆ«çš„ã€‚

é€šå¸¸çš„ç»‘å®šæ–¹æ³•æœ‰ä¸‰ç§ï¼š

- Bind methods in the constructor.
- Use arrow functions, e.g. onClick={(e) => this.handleClick(e)}.
- Keep using createReactClass.

åœ¨ constructor ä¸­æ¥æ”¹å˜ this.handleClick æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œè¿™åº”è¯¥æ˜¯ç›¸å¯¹ä¸Šé¢ä¸€ç§æ¥è¯´æ›´å¥½çš„åŠæ³•ï¼Œä¸‡ä¸€æˆ‘ä»¬éœ€è¦æ”¹å˜è¯­æ³•ç»“æ„ï¼Œè¿™ç§æ–¹å¼å®Œå…¨ä¸éœ€è¦å»æ”¹åŠ¨ JSX çš„éƒ¨åˆ†ï¼š

	import React from 'react';

	class Contacts extends React.Component {  
	  constructor(props) {
	    super(props);
	    this.handleClick = this.handleClick.bind(this);
	  }
	  handleClick() {
	    console.log(this); // React Component instance
	  }
	  render() {
	    return (
	      <div onClick={this.handleClick}></div>
	    );
	  }
	}

	export default Contacts;  

React.createClass ä¼šæ­£ç¡®ç»‘å®š this å¼•ç”¨åˆ°ç»„ä»¶ã€‚ 

	import React from 'react';

	const Contacts = React.createClass({  
	  handleClick() {
	    console.log(this); // React Component instance
	  },
	  render() {
	    return (
	      <div onClick={this.handleClick}></div>//ä¼šåˆ‡æ¢åˆ°æ­£ç¡®çš„thisä¸Šä¸‹æ–‡
	    );
	  }
	});

	export default Contacts;  

å¦‚æœæ‰©å±• React.Componentï¼Œç”±äºä½¿ç”¨äº† ES6ï¼Œè¿™é‡Œä¼šæœ‰äº›å¾®ä¸åŒï¼Œå±æ€§å¹¶ä¸ä¼šè‡ªåŠ¨ç»‘å®šåˆ° React ç±»çš„å®ä¾‹ä¸Šã€‚

	import React from 'react';
	class TodoItem extends React.Component{
	    constructor(props){
	        super(props);
	    }
	    handleClick(){
	        console.log(this); // null
	    }
	    handleFocus(){  // manually bind this
	        console.log(this); // React Component Instance
	    }
	    // WARNING: this syntax is experimental!
	    // Using an arrow here binds the method:
	    handleBlur: () => {  // use arrow function
	        console.log(this); // React Component Instance
	    }
	    render(){
	        return <input onClick={this.handleClick} 
	                      onFocus={this.handleFocus.bind(this)}  
	                      onBlur={this.handleBlur}/>
	    }
	}

Mixins

ä½¿ç”¨ React.createClass çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºç»„ä»¶æ—¶æ·»åŠ ä¸€ä¸ªå«åš mixins çš„å±æ€§ï¼Œå¹¶å°†å¯ä¾›æ··åˆçš„ç±»çš„é›†åˆä»¥æ•°ç»„çš„å½¢å¼èµ‹ç»™ mixins å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ ES6 çš„æ–¹å¼æ¥åˆ›å»ºç»„ä»¶ï¼Œé‚£ä¹ˆ React mixins çš„ç‰¹æ€§å°†ä¸èƒ½è¢«ä½¿ç”¨äº†ã€‚

	import React from 'react';
	let MyMixin = {
	    doSomething(){}
	}
	let TodoItem = React.createClass({
	    mixins: [MyMixin], // add mixin
	    render(){
	        return <div></div>
	    }
	})



## State & Lifecycle ç»„ä»¶çŠ¶æ€ä¸ç”Ÿå‘½å‘¨æœŸ
- [State & ç”Ÿå‘½å‘¨æœŸ](https://react.docschina.org/docs/state-and-lifecycle.html)
- [Reactæºç åˆ†æ3 â€” Reactç”Ÿå‘½å‘¨æœŸè¯¦è§£](https://zhuanlan.zhihu.com/p/25882388)
- [React Lifecycle Diagram](http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)
- React Component https://react.docschina.org/docs/react-component.html
- Update on Async Rendering https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html
- React.Component æ–‡æ¡£è¾ƒå°‘ä½¿ç”¨çš„å‡ ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³• http://www.ptbird.cn/react-component-rarely-lifecycle-methods.html
- You Probably Don't Need Derived State https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html
- React PureComponent åŠæµ…æ¯”è¾ƒè¯¦è§£ https://juejin.cn/post/6844903784104067086
- Fetch API https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API

å‰é¢è§£æäº† PureComponent å’Œ Component ç±»ç»„ä»¶çš„ä¸»è¦å·®å¼‚åœ¨ shouldComponentUpdate æ–¹æ³•çš„å®ç°é€»è¾‘ä¸Šä¸ä¸€æ ·ï¼ŒComponent çš„å®ç°åªæ˜¯ç®€å•è¿”å› trueã€‚è€Œ PureComponent çš„å®ç°å¯¹ propsã€state è¿›è¡Œæµ…æ¯”è¾ƒ shallow comparisonï¼Œå¦‚æœç»„ä»¶çš„ props å’Œ state éƒ½æ²¡å‘ç”Ÿæ”¹å˜å°±ä¸æ‰§è¡Œæ¸²æŸ“ï¼ŒåŒ…æ‹¬ componentWillUpdate å’Œ componentDidUpdate å‡½æ•°éƒ½ä¸æ‰§è¡Œã€‚è¿™æ ·è¿‡æ»¤äº†ä¸å¿…è¦è¡Œä¸ºæ¥æé«˜æ€§èƒ½ï¼Œä½†è¯¥ç»„ä»¶ä¹Ÿå…·æœ‰ä¸€å®šçš„ç¼ºé™·ï¼Œå› ä¸ºå®ƒåªèƒ½è¿›è¡Œä¸€å±‚æµ…æ¯”è¾ƒã€‚ç®€å•æ¥è¯´ï¼Œå®ƒåªæ¯”è¾ƒ props å’Œ state çš„å†…å­˜åœ°å€ï¼Œå¦‚æœå†…å­˜åœ°å€ç›¸åŒï¼Œå°±è¿”å› false ä¸æ‰§è¡Œé‡ç»˜ã€‚

ç†è§£ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ‰èƒ½æ­£ç¡®ç®¡ç†ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€æ•°æ®ã€‚å®é™…ç”Ÿäº§å¼€å‘æ›´å¤šæ˜¯ä½¿ç”¨å…¶å†…éƒ¨å®šä¹‰çš„åŸºæœ¬ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°ï¼ŒcomponentDidMount å’Œ componentWillUnmount ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚


### â˜› State çŠ¶æ€æ•°æ®ç®¡ç†


åœ¨æ—§ç‰ˆæœ¬ React ä¸­ï¼Œæ— çŠ¶æ€ç»„ä»¶ä¸æ”¯æŒ refï¼Œå› ä¸ºåœ¨ React è°ƒç”¨åˆ°æ— çŠ¶æ€ç»„ä»¶çš„æ–¹æ³•ä¹‹å‰ï¼Œæ˜¯æ²¡æœ‰ä¸€ä¸ªå®ä¾‹åŒ–çš„è¿‡ç¨‹çš„ï¼Œå› æ­¤ä¹Ÿå°±æ²¡æœ‰æ‰€è°“çš„ refã€‚æ— çŠ¶æ€ç»„ä»¶å°±å‰©äº†ä¸€ä¸ª render æ–¹æ³•ï¼Œå› æ­¤ä¹Ÿå°±æ²¡æœ‰æ²¡æ³•å®ç°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚

ä½†æ˜¯ React 16 å‘å¸ƒå¼•å…¥äº† Hooks APIï¼Œå…¶ä¸­æœ‰ useState å’Œ useReducer ç­‰ï¼Œè¿™ä½¿å¾—å‡½æ•°ç»„ä»¶ä¹Ÿèƒ½å°è£…æˆæœ‰çŠ¶æ€ç»„ä»¶ï¼Œæ‰€ä»¥æœ‰çŠ¶æ€ç»„ä»¶æˆ–æ— çŠ¶æ€ç»„ä»¶çš„æ¦‚å¿µè¶Šæ¥è¶Šå¼±åŒ–äº†ã€‚è€Œ React æ–°å¼•å…¥çš„ Hooks API ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹è¶Šæ¥è¶Šä¾¿åˆ©ã€‚ï¼Œå¦‚ React.memo() å¯ä»¥å®ç°ç±»ä¼¼ PureComponent çš„å‡½æ•°å¼ç»„ä»¶ï¼Œå‡½æ•°å¼ç»„ä»¶ FunctionComponent å¯¹è±¡çš„å®ç°å°±æ˜¯åŸºäº props å±æ€§çš„ï¼Œä½†æ˜¯å’Œç±»ç»„ä»¶çš„åŠŸèƒ½è¶Šæ¥è¶Šç›¸ä¼¼ã€‚


å…³äº setState() ä½ åº”è¯¥äº†è§£ä¸è¦ç›´æ¥ä¿®æ”¹ Stateï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨ setState()ã€‚

	// Wrong
	this.state.comment = 'Hello';

	// Correct
	this.setState({comment: 'Hello'});

çŠ¶æ€æ•°æ®æ˜¯ Immutable Dataï¼Œä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½å†è¢«æ›´æ”¹çš„æ•°æ®ï¼Œå¯¹ Immutable å¯¹è±¡çš„ä»»ä½•ä¿®æ”¹æˆ–æ·»åŠ åˆ é™¤æ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Immutable å¯¹è±¡ã€‚Immutable å®ç°çš„åŸç†æ˜¯ Persistent Data Structure æŒä¹…åŒ–æ•°æ®ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨æ—§æ•°æ®åˆ›å»ºæ–°æ•°æ®æ—¶ï¼Œè¦ä¿è¯æ—§æ•°æ®åŒæ—¶å¯ç”¨ä¸”ä¸å˜ã€‚åŒæ—¶ä¸ºäº†é¿å… deepCopy æŠŠæ‰€æœ‰èŠ‚ç‚¹éƒ½å¤åˆ¶ä¸€éå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ŒImmutable ä½¿ç”¨äº† Structural Sharing ç»“æ„å…±äº«ï¼Œå³å¦‚æœå¯¹è±¡æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåªä¿®æ”¹è¿™ä¸ªèŠ‚ç‚¹å’Œå—å®ƒå½±å“çš„çˆ¶èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹åˆ™è¿›è¡Œå…±äº«ã€‚

React ç®¡ç†ç»„ä»¶å±æ€§æ•°æ®ä¹Ÿä¼šä½¿ç”¨ Immutable Dataï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼Œå¦‚æœç›´æ¥å°† css æ ·å¼å˜é‡ç»‘å®šåˆ°ç»„ä»¶å±æ€§å°†ä½¿ css å°è£…æˆåªè¯»æ•°æ®ï¼š 

	let css = {
	    display: 'block',
	    background: 'yellow',
	}

	const UseLayoutEffect: React.FC<any> = ({children}) => {
	    const box = useRef<HTMLDivElement>(null);
	    useLayoutEffect(() => {
	        let div = box.current!;
	        console.log('useLayoutEffect');
	        animate(box.current!.style, 'marginLeft', div.offsetLeft, 100, 'px');
	    }, []);
	    // css will be immutatble if bind to div.style directly.
	    css.background = 'yellow';
	    return (
	    <div id="useLayout" style={{...css, background: 'yellow'}} ref={box}>{children} </div>
	    );
	};


æ„é€ å‡½æ•°æ˜¯å”¯ä¸€å¯ä»¥ç»™ this.state èµ‹å€¼çš„åœ°æ–¹ã€‚å‡ºäºæ€§èƒ½è€ƒè™‘ï¼ŒReact å¯èƒ½ä¼šæŠŠå¤šä¸ª setState() è°ƒç”¨åˆå¹¶æˆä¸€ä¸ªè°ƒç”¨ã€‚ State çš„æ›´æ–°å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œthis.props å’Œ this.state å¯èƒ½ä¼šå¼‚æ­¥æ›´æ–°ï¼Œæ‰€ä»¥ä½ ä¸è¦ä¾èµ–ä»–ä»¬çš„å€¼æ¥æ›´æ–°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚

ä¾‹å¦‚ï¼Œæ­¤ä»£ç å¯èƒ½ä¼šæ— æ³•æ›´æ–°è®¡æ•°å™¨ï¼š

	// Wrong
	this.setState({
	  counter: this.state.counter + this.props.increment,
	});

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è®© setState() æ¥æ”¶ä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°ç”¨ä¸Šä¸€ä¸ª state ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°†æ­¤æ¬¡æ›´æ–°è¢«åº”ç”¨æ—¶çš„ props åšä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼š

	// Correct
	this.setState((state, props) => ({
	  counter: state.counter + props.increment
	}));

ä¸Šé¢ä½¿ç”¨äº†ç®­å¤´å‡½æ•°ï¼Œä¸è¿‡ä½¿ç”¨æ™®é€šçš„å‡½æ•°ä¹ŸåŒæ ·å¯ä»¥ï¼š

	// Correct
	this.setState(function(state, props) {
	  return {
	    counter: state.counter + props.increment
	  };
	});

State çš„æ›´æ–°ä¼šè¢«åˆå¹¶ï¼Œå½“ä½ è°ƒç”¨ setState() çš„æ—¶å€™ï¼ŒReact ä¼šæŠŠä½ æä¾›çš„å¯¹è±¡åˆå¹¶åˆ°å½“å‰çš„ stateã€‚

ä¾‹å¦‚ï¼Œä½ çš„ state åŒ…å«å‡ ä¸ªç‹¬ç«‹çš„å˜é‡ï¼š

	  constructor(props) {
	    super(props);
	    this.state = {
	      posts: [],
	      comments: []
	    };
	  }

é€šå¸¸ï¼ŒcomponentDidMount ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯ç”¨æ¥è·å–æ•°æ®çš„æœ€åˆé€‚åœºæ‰€ï¼Œç„¶åä½ å¯ä»¥åˆ†åˆ«è°ƒç”¨ setState() æ¥å•ç‹¬åœ°æ›´æ–°å®ƒä»¬ï¼š

	  componentDidMount() {
	    fetchPosts().then(response => {
	      this.setState({
	        posts: response.posts
	      });
	    });

	    fetchComments().then(response => {
	      this.setState({
	        comments: response.comments
	      });
	    });
	  }


### â˜› LifeCycle å‡½æ•°

æ•´ä¸ª React ç”Ÿå‘½å‘¨æœŸåˆ† 3 ä¸ªé˜¶æ®µï¼šåˆ›å»ºã€æ›´æ–°ã€å¸è½½ï¼Œæ¯ä¸ªé˜¶æ®µæœ‰å¯¹åº”çš„å·¥ä½œå’Œæ–¹æ³•ã€‚


	------------------------ Mounting ----------------  Updating ------------------- Unmounting --
	                            |                                                         |
	â€œRender phaseâ€          constructor()   New props   setState()  forceUpdate()         |
	Pure and has no             |               |           |             |               |
	side effects.           ===============getDerivedStateFromProps==============         |
	May be paused,              |                     |                                   |
	aborted orrestarted         |             shouldComponentUpdate                       |
	by React.                   |                     |                                   |
	                        =======================render========================         |
	----------------------------|------------------------------|--------------------------|-------
	                            |                              |                          |
	â€œPre-commit phaseâ€          |                     getSnapshotBeforeUpdate             |
	Can read the DOM.           |                              |                          |
	                        ===============React updates Â­DÂ­OÂ­M and refs============         |
	----------------------------|------------------------------|--------------------------|--------
	                            |                              |                          |
	â€œCommit phaseâ€          componentDidMount        componentDidUpdate        componentWillUnmount
	
	Can work with DOM, run side effects, schedule updates.
	-----------------------------------------------------------------------------------------------


	ç”Ÿå‘½å‘¨æœŸå‡½æ•°								è°ƒç”¨æ¬¡æ•°					èƒ½å¦ä½¿ç”¨setSate()
	constructor(props)						1(å®ä¾‹åŒ–æ—¶è°ƒç”¨)			  âœ—
	getDefaultProps()						1(creatClass()åˆå§‹åŒ–)	  âœ—
	getInitialState()						1(creatClass()åˆå§‹åŒ–)	  âœ—
	componentWillMount()					1(ç»„ä»¶åŠ è½½å‰)			âœ“
	getDerivedStateFromProps				>=1						  âœ—
	render()								>=1(ç»„ä»¶æ¸²æŸ“æ—¶)			  âœ—
	componentDidMount()						1(ç»„ä»¶åŠ è½½æ—¶)			âœ“
	componentWillReceiveProps(nextProps)	>=0(propsæ•°æ®æ›´æ–°)		âœ“
	shouldComponentUpdate(nextProps)		>=0						  âœ—
	componentWillUpdate(nextProps)			>=0						  âœ—
	getSnapshotBeforeUpdate					>=0						  âœ—
	componentDidUpdate(nextProps)			>=0						  âœ—
	componentWillUnmount()					1						  âœ—

React å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸæ¥å£ä¸»è¦ç”± ComponentLifecycle å’Œ NewLifecycleã€ DeprecatedLifecycle ä¸¤ä¸ªåŸºç¡€æ¥å£ç»„ä»¶ï¼Œåä¸¤è€…åˆ†åˆ«è¡¨ç¤ºæ–° API å’Œæ—§ API é›†åˆï¼ŒComponentLifecycle å®šä¹‰æœ€åŸºæœ¬çš„ç”Ÿå‘½å‘¨æœŸ APIï¼Œè¿™äº›ä»£ç ç»„ç»‡æ–¹å¼éƒ½åœ¨æ˜ç¡®å‘ŠçŸ¥å¼€å‘è€…è¯¥å¦‚ä½•å»ç”¨å¥½å®ƒä»¬ï¼š

    interface ComponentLifecycle<P, S, SS = any> extends NewLifecycle<P, S, SS>, DeprecatedLifecycle<P, S> {
        componentDidMount?(): void;
        shouldComponentUpdate?(nextProps: Readonly<P>, nextState: Readonly<S>, nextContext: any): boolean;
        componentWillUnmount?(): void;
        componentDidCatch?(error: Error, errorInfo: ErrorInfo): void;
    }

    interface NewLifecycle<P, S, SS> {
        getSnapshotBeforeUpdate?(prevProps: Readonly<P>, prevState: Readonly<S>): SS | null;
        componentDidUpdate?(prevProps: Readonly<P>, prevState: Readonly<S>, snapshot?: SS): void;
    }

    interface StaticLifecycle<P, S> {
        getDerivedStateFromProps?: GetDerivedStateFromProps<P, S>;
        getDerivedStateFromError?: GetDerivedStateFromError<P, S>;
    }

    type GetDerivedStateFromProps<P, S> =
        (nextProps: Readonly<P>, prevState: S) => Partial<S> | null;
    type GetDerivedStateFromError<P, S> =
        (error: any) => Partial<S> | null;

    interface DeprecatedLifecycle<P, S> {
        componentWillMount?(): void;
        UNSAFE_componentWillMount?(): void;
        componentWillReceiveProps?(nextProps: Readonly<P>, nextContext: any): void;
        UNSAFE_componentWillReceiveProps?(nextProps: Readonly<P>, nextContext: any): void;
        componentWillUpdate?(nextProps: Readonly<P>, nextState: Readonly<S>, nextContext: any): void;
        UNSAFE_componentWillUpdate?(nextProps: Readonly<P>, nextState: Readonly<S>, nextContext: any): void;
    }


è¿™äº›å†…å®¹åœ¨ ReactDom çš„ TypeScript ç±»å‹å£°æ˜æ–‡ä»¶ä¸­æœ‰æ˜ç¡®çš„è¯´æ˜ï¼Œä½¿ç”¨å¸¦æœ‰ UNSAFE å‰ç¼€çš„å‡½æ•°è¡¨ç¤ºå¼€å‘è€…æ˜ç™½åšä»€ä¹ˆï¼ŒReact ä¸ä¼šåœ¨æ§åˆ¶å°ä¸­ç»™æç¤ºä¿¡æ¯ã€‚å¦‚æœåœ¨ VSCode æˆ– Sublime ç­‰ç¼–è¾‘å™¨ä¸­å®‰è£…å¥½ TypeScript æ”¯æŒæ’ä»¶ï¼Œåœ¨ç¼–å†™è¿™æ ·æ–¹æ³•æ—¶ä¼šå°†æ³¨è§£çš„å†…å®¹æç¤ºå‡ºæ¥ï¼š

	@types\react-dom\node_modules\@types\react\index.d.ts

åƒ componentWillMount æˆ–è€… componentWillReceiveProps è¿™äº›è¿‡æ—¶ API å»ºè®®ä½¿ç”¨ getSnapshotBeforeUpdate æˆ–é™æ€è¯¥å½“ getDerivedStateFromProps æ›¿ä»£ã€‚


â˜› Lifecycle ç¬¬ä¸€é˜¶æ®µ

è¿™æ˜¯è™šæ‹Ÿ DOM åˆ›å»ºçš„é˜¶æ®µï¼Œä¼šä¾æ¬¡æ‰§è¡Œæ•°ä¸ªæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•é™¤äº† render æ–¹æ³•ï¼Œå…¶ä½™åŸºæœ¬ä¸Šåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªè°ƒç”¨ 1 æ¬¡ï¼Œè€Œä¸”ä¸€å®šä¼šè°ƒç”¨ 1 æ¬¡ï¼š

- **constructor()** æ‰§è¡Œç»„ä»¶æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å®ä¾‹å¯¹è±¡ï¼›
- **getDefaultProps()** ä»æ­¤æ–¹æ³•è·å–ç»„ä»¶é»˜è®¤å±æ€§è®¾ç½®ï¼Œå‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œå¯¹ createClass() åˆ›å»ºçš„ç»„ä»¶æœ‰æ•ˆï¼Œå¦åˆ™ä½¿ç”¨ defaultProps é™æ€æˆå‘˜è®¾ç½®é»˜è®¤å±æ€§å‚æ•°ï¼›
- **getInitialState()** ä»æ­¤æ–¹æ³•è·å–ç»„ä»¶çš„åˆå§‹çŠ¶æ€æ•°æ®ï¼Œå‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œå¯¹ createClass() åˆ›å»ºçš„ç»„ä»¶æœ‰æ•ˆï¼Œå¦åˆ™ä½¿ç”¨ state æˆå‘˜è®¾ç½®çŠ¶æ€æ•°æ®ï¼›
- **componentWillMount()** è¿‡æ—¶ APIï¼Œå¯ç”¨æ¥ä¿®æ”¹ stateã€‚React å…ˆè°ƒç”¨çˆ¶ç»„ä»¶çš„è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨å­ç»„ä»¶çš„è¿™ä¸ªå‡½æ•°ï¼›
- **render()** å¼€å§‹ç»„ä»¶æ¸²æŸ“å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹çš„è™šæ‹Ÿ DOMã€‚è¯¥å‡½æ•°ä¸­ä¸èƒ½åŒæ­¥çš„ä¿®æ”¹ç»„ä»¶çš„çŠ¶æ€(state)ã€‚
- **componentDidMount()** åœ¨ render æ¸²æŸ“ä¹‹åï¼Œé€šçŸ¥ç»„ä»¶å·²ç»åŠ è½½å®Œæˆã€‚React å…ˆè°ƒç”¨å­ç»„ä»¶çš„è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨çˆ¶ç»„ä»¶çš„è¿™ä¸ªå‡½æ•°ã€‚

æ‰§è¡Œåˆ›å»ºé˜¶æ®µçš„ä»»åŠ¡åï¼Œç»„ä»¶å°±å¯ä»¥å’Œå…¶ä»–æ¡†æ¶äº¤äº’äº†ï¼Œæ¯”å¦‚è®¾ç½®è®¡æ—¶å™¨æˆ–è€…å‘èµ·ç½‘ç»œè¯·æ±‚ç­‰ç­‰è€—æ—¶çš„æ“ä½œéƒ½å¯ä»¥åœ¨ componentDidMount() ä¸­è¿›è¡Œã€‚

DeprecatedLifecycle æ¥å£å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å·²ç»å¼ƒç”¨ï¼Œå»ºè®®è½¬æ¢åˆ°æ–°çš„ NewLifecycle APIã€‚

æ–° API çš„é™æ€å‡½æ•° getDerivedStateFromProps ä¼šåœ¨ç»„ä»¶å®ä¾‹åŒ–åï¼Œæ¸²æŸ“ä¹‹å‰æˆ–è€…æ›´æ–°æ¸²æŸ“ä¹‹å‰æ‰§è¡Œï¼Œè¦æ±‚å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–æ¥æ›´æ–° stateï¼Œæˆ–è€…è¿”å› null è¡¨ç¤ºæ–°çš„ props æ²¡æœ‰å¯ä»¥å¯æ–°çš„çŠ¶æ€æ•°æ®ã€‚æ— è®ºæ˜¯æ—§çš„ componentWillReceiveProps è¿˜æ˜¯æ–°çš„ getDerivedStateFromPropsï¼Œå®ƒä»¬éƒ½æ˜¯å¤æ‚çš„å‡½æ•°å®ç°ï¼Œå®é™…åº”ç”¨ä¸­å°½é‡é¿å…ä½¿ç”¨ã€‚

å”¯ä¸€ getDerivedStateFromProps å­˜åœ¨çš„ç†è§£æ˜¯ï¼Œç»„ä»¶å¯ä»¥æ ¹æ®ç»„ä»¶æ¥æ”¶åˆ°çš„å±æ€§æ•°æ®æ¥æ›´æ–°å…¶å†…éƒ¨çš„çŠ¶æ€æ•°æ®ï¼Œå³æ´¾ç”Ÿæ–¹æ¡ˆ Derived Stateã€‚ä¸æ¨èä½¿ç”¨æ´¾ç”Ÿ state æ–¹æ¡ˆï¼Œè¿™ä¼šå¯¼è‡´ä»£ç å†—é•¿ï¼Œå¹¶ä¸”ä¼šä½¿å¾—ç»„ä»¶å˜çš„éš¾ä»¥ç†è§£ã€‚

æ³¨æ„ï¼Œå‰é¢æåˆ°çš„é™æ€ç”Ÿå‘½å‘¨æœŸæ¥å£æä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€æ—¦åœ¨ç»„ä»¶ä¸­å®šä¹‰äº† StaticLifecycle æ¥å£ä¸­çš„ä»»æ„ä¸€ä¸ªå‡½æ•°ï¼Œå°±è¡¨ç¤ºä¸ä½¿ç”¨è¿‡æ—¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå³ DeprecatedLifecycle æ¥å£çš„æ‰€ä»¥å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚ä¸€æ—¦ä½¿ç”¨äº† NewLifecycle æ¥å£çš„å‡½æ•°ï¼Œå°±ä¸èƒ½ä½¿ç”¨ UNSAFE å‰ç¼€çš„è¿‡æ—¶å‡½æ•°ã€‚

å¦å¤– getSnapshotBeforeUpdate å’Œ componentDidUpdate åº”è¯¥ä¸€èµ·æ­é…ä½¿ç”¨ï¼Œå‰è€…åœ¨æœ€è¿‘ä¸€æ¬¡çš„ render å®Œå°†è¦ commit ç»™ DOM çš„æ—¶å€™ä¼šè°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿä½¿å¾—ç»„ä»¶å¯ä»¥åœ¨å¯èƒ½æ›´æ”¹ä¹‹å‰ä» DOM æ•è·ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æ»šåŠ¨çš„ä½ç½®ç­‰ç­‰ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›çš„ä»»ä½•å€¼ï¼Œéƒ½ä¼šä¼ é€’ç»™ componentDidUpdateï¼Œè¿™å‡ ä¸ªå‡½æ•°çš„åº”ç”¨å¯ä»¥å®Œå…¨æ›¿æ¢æ‰æ—§çš„ componentWillReceiveProps å‡½æ•°ã€‚

	class ScrollingList extends React.Component {
	  constructor(props) {
	    super(props);
	    this.listRef = React.createRef();
	  }

	  getSnapshotBeforeUpdate(prevProps, prevState) {
	    // æ•è·æ»šåŠ¨çš„ä½ç½®ï¼Œä»¥ä¾¿åé¢è¿›è¡Œæ»šåŠ¨ æ³¨æ„è¿”å›çš„å€¼
	    if (prevProps.list.length < this.props.list.length) {
	      const list = this.listRef.current;
	      return list.scrollHeight - list.scrollTop;
	    }
	    return null;
	  }

	  componentDidUpdate(prevProps, prevState, snapshot) {
	    // å¦‚æœæœ‰ snapshot ä¼šè¿›è¡Œæ»šåŠ¨çš„è°ƒæ•´ï¼Œè¿™æ ·å­å°±ä¸ä¼šç«‹å³å°†ä¹‹å‰çš„å†…å®¹ç›´æ¥å¼¹ä¸Šå»
	    if (snapshot !== null) {
	      const list = this.listRef.current;
	      list.scrollTop = list.scrollHeight - snapshot;
	    }
	  }

	  render() {
	    return (
	      <div ref={this.listRef}>{/* ...contents... */}</div>
	    );
	  }
	}


â˜› Lifecycle ç¬¬äºŒé˜¶æ®µ

æ­¤æ—¶è¯¥ç»„ä»¶å·²ç»è¿›å…¥äº†ç¨³å®šè¿è¡Œé˜¶æ®µï¼Œå¿…è¦æ—¶æ‰§è¡Œç»„ä»¶çŠ¶æ€æ›´æ–°æµç¨‹ï¼Œè¿™ä¸ªé˜¶æ®µç»„ä»¶å¯ä»¥å¤„ç†ç”¨æˆ·äº¤äº’ï¼Œæˆ–è€…æ¥æ”¶äº‹ä»¶æ›´æ–°ç•Œé¢ã€‚

ä»¥ä¸‹æ–¹æ³•åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å¯ä»¥æ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡ä¹Ÿä¸æ‰§è¡Œï¼š

- **componentWillReceiveProps()** è¿‡æ—¶ APIï¼Œå½“çˆ¶å®¹å™¨ä¸­å¯¹åº”çš„å‚æ•°æ”¹å˜å°†ä¼šè°ƒç”¨å­ç»„ä»¶çš„è¯¥å‡½æ•°ã€‚æ–°çš„ props å°†ä¼šä½œä¸ºå‚æ•°ä¼ é€’è¿›æ¥ï¼Œæ—§å±æ€§å¯ä»¥æ ¹æ® this.props æ¥è·å–ã€‚å¯ä»¥åœ¨è¯¥å‡½æ•°ä¸­å¯¹ state ä½œä¸€äº›å¤„ç†ï¼Œå¹¶ä¸”åœ¨è¯¥å‡½æ•°ä¸­æ›´æ–° state ä¸ä¼šå‘ç”ŸäºŒæ¬¡æ¸²æŸ“ï¼›
- **shouldComponentUpdate()** è¯¥å‡½æ•°ä¼ é€’è¿‡æ¥ä¸¤ä¸ªå‚æ•°ï¼Œæ–°çš„ state å’Œæ–°çš„ propsï¼ŒPureComponent å·²ç»å®ç°æµ…æ¯”è¾ƒï¼Œæ ¹æ®æ¯”å¯¹ç»“æœé€‰æ‹©æ›´æ–°æˆ–è€…ä¸æ›´æ–°ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚
- **componentWillUpdate()** ä¸ **componentWillMount()** ä¸¤ä¸ªç±»ä¼¼çš„è¿‡æ—¶ APIï¼Œéƒ½åœ¨ render ä¹‹å‰è§¦å‘ï¼Œupdate æ–¹æ³•ä¼šæ¥æ”¶åˆ°æ–°çš„ props æˆ–è€… stateï¼Œæ‰§è¡Œæ—¶æ­Œè¯æŠŠæ•°æ®æ›´æ–°åˆ° this.props å’Œ this.stateã€‚
- **componentDidUpdate()** ä¸ componentDidMount æ–¹æ³•ç±»ä¼¼ï¼Œåœ¨ render æ¸²æŸ“ä¹‹åè¢«è°ƒç”¨ï¼ŒçœŸå® DOM ç”Ÿæˆä¹‹åè°ƒç”¨è¯¥å‡½æ•°ã€‚ä¼ é€’è¿‡æ¥çš„å‚æ•°æ˜¯ä¹‹å‰çš„ props å’Œ stateã€‚

shouldComponentUpdate æ–¹æ³•åªæ˜¯èƒ½å¤Ÿç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œä¸èƒ½è¿‡åº¦ä¾èµ–å®ƒæ¥é˜»æ­¢ç»„ä»¶çš„æ¸²æŸ“ï¼Œå› ä¸ºé‡å†™ shouldComponentUpdate å¯èƒ½ä¼šå¯¼è‡´ bugï¼Œä¸å»ºè®®è¿›è¡Œæ·±å±‚æ¯”è¾ƒï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ JSON.stringifyï¼Œå› ä¸ºæ•ˆç‡å¾ˆä½ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¼•èµ·æ€§èƒ½é—®é¢˜ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨ PureComponentã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿ shouldComponent è¿”å›äº† falseï¼Œå­ç»„ä»¶çš„çŠ¶æ€æ›´æ–°å¼•èµ·çš„é‡æ–°æ¸²æŸ“æ˜¯ä¸ä¼šå—åˆ°å½±å“çš„ã€‚


â˜› Lifecycle ç¬¬ä¸‰é˜¶æ®µ

è¿™å°±æ˜¯æ¶ˆäº¡çš„é˜¶æ®µï¼Œä¸»è¦è¿›è¡Œå†…å­˜çš„æ¸…ç†å’Œé‡Šæ”¾çš„å·¥ä½œã€‚è¿™ä¸ªé˜¶æ®µåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…è°ƒç”¨ä¸”ä»…è°ƒç”¨ä¸€æ¬¡ã€‚

	componentWillUnmount()

å½“ç»„ä»¶è¦è¢«ä»ç•Œé¢ä¸Šç§»é™¤çš„æ—¶å€™ï¼ŒReactDOM.unmountComponentAtNode()ï¼Œå°±ä¼šè°ƒç”¨ componentWillUnmountã€‚åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›ç›¸å…³çš„é”€æ¯æ“ä½œï¼Œæ¯”å¦‚æ’¤é”€å®šæ—¶å™¨ï¼Œäº‹ä»¶ç›‘å¬ç­‰ç­‰ã€‚

å¦å¤–è¿˜æœ‰ä¸¤ä¸ªç”¨äºé”™è¯¯å¤„ç†çš„å‡½æ•° componentDidCatch å’Œ getDerivedStateFromErrorï¼ŒReact å¼•å…¥äº† Error Boundaries é”™è¯¯è¾¹ç•Œçš„æ¦‚å¿µï¼Œä¸¤ä¸ªæ–¹æ³•é…åˆä¸€èµ·ä½¿ç”¨ï¼Œä»¥å°†é”™è¯¯æ‹¦æˆªåœ¨è¾¹ç•Œç»„ä»¶ä¸Šï¼Œè€Œä¸æ˜¯ç ´åæ•´ä¸ªåº”ç”¨ã€‚


ä»¥ä¸‹æ˜¯å„ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ç¤ºèŒƒï¼š

	import React from 'react';

	interface Props {
	    record?:string[]
	    title?:string
	}
	interface State {
	    record: string[]
	}
	let getTime = ()=>{
	    return new Date().toISOString().substr(11,12)
	}

	export default class LifeCode extends React.Component<Props> {

	    props:Props
	    state:State

	    static record:string[] = []

	    constructor(props: Props){
	        super(props);
	        this.props = props;
	        LifeCode.record.push(getTime()+' Tip: LifeCode constructor');
	        this.state = {record: LifeCode.record};
	    }

	    static getDerivedStateFromProps(props: Props){
	        LifeCode.record.push(getTime()+' Tip: getDerivedStateFromProps');
	        props = {...props, title: 'getDerivedStateFromProps'};
	        return props;
	    }
	    shouldComponentUpdate(nextProps: Props, nextState: State, nextContext: any): boolean {
	        LifeCode.record.push(getTime()+' Tip: shouldComponentUpdate');
	        // check props & state ...
	        return true;
	    }
	    // UNSAFE_componentWillMount(){
	    //   LifeCode.record.push(getTime()+' Tip: componentWillMount');
	    // }
	    // UNSAFE_componentWillUpdate(pp:Props, ps:State){
	    //   LifeCode.record.push(getTime()+' Tip: componentWillUpdate');
	    // }
	    getSnapshotBeforeUpdate(pp:Props, ps:State){
	        LifeCode.record.push(getTime()+' Tip: getSnapshotBeforeUpdate');
	        return {...pp, ...ps}
	    }
	    componentDidMount(){
	        LifeCode.record.push(getTime()+' Tip: componentDidMount');
	    }
	    componentDidUpdate(){
	        LifeCode.record.push(getTime()+' Tip: componentDidUpdate');
	        fetch("https://api.leancloud.cn/1.1/classes/Counter")
	            .then(response => response.json())
	            .then(data => {
	                console.log(data);
	            })
	    }
	    componentWillUnmount(){
	        let msg = getTime()+' Tip: componentWillUnmount';
	        console.log(msg);
	        LifeCode.record.push(msg);
	    }

	    doSetState(ev:React.MouseEvent<HTMLElement, MouseEvent>){
	        LifeCode.record.push(getTime()+' Tip: setState');
	        this.setState({...this.state, title:'setState'});
	    }
	    doForceUpdate(ev:React.MouseEvent<HTMLElement, MouseEvent>){
	        LifeCode.record.push(getTime()+' Tip: forceUpdate');
	        this.forceUpdate();
	    }

	    render(){
	        // readonly props
	        // this.props = this.state;
	        return(
	            <ul>
	            <li>
	                <button onClick={ev => this.doSetState(ev)}>setState</button>
	                <button onClick={ev => this.doForceUpdate(ev)}>forceUpdate</button>
	            </li>
	            {LifeCode.record.map( (it, th) => <li key={th}>{th} - {it}</li>)}
	            </ul>
	        );
	    }
	}


### â˜› shouldComponentUpdate & Object.is

å†æ¥çœ‹çœ‹æºä»£ç ï¼ŒshouldComponentUpdate çš„å†…éƒ¨ä¸»è¦å®ç°åœ¨ react-reconciler æ¨¡å—ï¼Œä¸»è¦æ˜¯ shallowEqual å‡½æ•°è¿›è¡Œæ¯”è¾ƒæ“ä½œï¼š


	// react-17.0.0\packages\react-reconciler\src\ReactFiberClassComponent.new.js
	function checkShouldComponentUpdate(
	  workInProgress,
	  ctor,
	  oldProps,
	  newProps,
	  oldState,
	  newState,
	  nextContext,
	) {
	  const instance = workInProgress.stateNode;

	  // æ‰§è¡Œç”¨æˆ·çš„å®ç°
	  if (typeof instance.shouldComponentUpdate === 'function') {

	    // if (__DEV__) ....
	    const shouldUpdate = instance.shouldComponentUpdate(
	      newProps,
	      newState,
	      nextContext,
	    );

	    // if (__DEV__) ....
	    return shouldUpdate;
	  }

	  // æ‰§è¡Œå†…éƒ¨çš„å®ç°
	  if (ctor.prototype && ctor.prototype.isPureReactComponent) {
	    return (
	      !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)
	    );
	  }

	  return true;
	}

	// react-17.0.0\packages\shared\shallowEqual.js
	/**
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 *
	 * @flow
	 */

	import is from './objectIs';

	const hasOwnProperty = Object.prototype.hasOwnProperty;

	/**
	 * Performs equality by iterating through keys on an object and returning false
	 * when any key has values which are not strictly equal between the arguments.
	 * Returns true when the values of all keys are strictly equal.
	 */
	function shallowEqual(objA: mixed, objB: mixed): boolean {
	  if (is(objA, objB)) {
	    return true;
	  }

	  if (
	    typeof objA !== 'object' ||
	    objA === null ||
	    typeof objB !== 'object' ||
	    objB === null
	  ) {
	    return false;
	  }

	  const keysA = Object.keys(objA);
	  const keysB = Object.keys(objB);

	  if (keysA.length !== keysB.length) {
	    return false;
	  }

	  // Test for A's keys different from B.
	  for (let i = 0; i < keysA.length; i++) {
	    if (
	      !hasOwnProperty.call(objB, keysA[i]) ||
	      !is(objA[keysA[i]], objB[keysA[i]])
	    ) {
	      return false;
	    }
	  }

	  return true;
	}

	export default shallowEqual;

å…¶ä¸­ Object.is æ˜¯åŒä¸€å€¼æ¯”è¾ƒï¼Œè¿™å¯¹äº JavaScript è¿™æ ·çš„åŠ¨æ€è¯­è¨€æ˜¯ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ 1/0 == 1/-0 æˆ–è€… NaN == NaN éƒ½è¿”å› falseã€‚è€Œ "" == false æˆ–è€… "" == [] æ¯”è¾ƒè¿”å›éæœŸæœ›çš„ trueï¼Œå› ä¸ºæœ‰ç±»å‹è½¬æ¢ã€‚

	/**
	 * inlined Object.is polyfill to avoid requiring consumers ship their own
	 * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is
	 */
	function is(x: any, y: any) {
	  return (
	    (x === y && (x !== 0 || 1 / x === 1 / y)) || (x !== x && y !== y) // eslint-disable-line no-self-compare
	  );
	}

	const objectIs: (x: any, y: any) => boolean =
	  typeof Object.is === 'function' ? Object.is : is;

	export default objectIs;

Object.is ç®—æ³•è¦æ±‚ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š

- both undefined
- both null
- both true or both false
- both strings of the same length with the same characters in the same order
- both the same object (meaning both values reference the same object in memory)
- both numbers and
	- both +0
	- both -0
	- both NaN
	- or both non-zero and both not NaN and both have the same value

MDN ç»™å‡ºä¸€ä¸ªæ›´å®¹æ˜“ç†è§£çš„å†™æ³•ï¼š

	if (!Object.is) {
	  Object.defineProperty(Object, "is", {
	    value: function (x, y) {
	      // SameValue algorithm
	      if (x === y) { // Steps 1-5, 7-10
	        // Steps 6.b-6.e: +0 != -0
	        return x !== 0 || 1 / x === 1 / y;
	      } else {
	        // Step 6.a: NaN == NaN
	        return x !== x && y !== y;
	      }
	    }
	  });
	}



## Handling Events äº‹ä»¶å¤„ç†
- SyntheticEvent https://reactjs.org/docs/events.html
- W3C DOM Level 3 Events https://www.w3.org/TR/DOM-Level-3-Events/

React çš„äº‹ä»¶åä½¿ç”¨é©¼å³°æ–¹å¼ camelCaseï¼Œå¦‚ onClick è¡¨ç¤ºå•å‡»äº‹ä»¶ï¼Œåœ¨ JSX è¯­æ³•ä¸­è®¾ç½®äº‹ä»¶å¤„ç†å‡½æ•°æ—¶ï¼Œä¼ å…¥çš„æ˜¯ä»£ç è€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™ä¸ç›´æ¥ç¼–å†™ HTML æ˜¯æœ‰å·®åˆ«çš„:

	// HTML
	<button onclick="activateLasers()">
	  Activate Lasers
	</button>

	// React JSX
	<button onClick={activateLasers}>
	  Activate Lasers
	</button>

å¦ä¸€ä¸ªå·®åˆ«æ˜¯é˜»æ­¢äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºæ—¶ï¼Œéœ€è¦æ˜¾å¼æ‰§è¡Œ preventDefaultï¼Œè¿™ä¸ HTML å¯ä»¥ç›´æ¥è¿”å› false çš„å¤„ç†æ–¹æ³•ä¸åŒï¼š

	// HTML
	<a href="#" onclick="console.log('The link was clicked.'); return false">
	  Click me
	</a>

	// React JSX
	function ActionLink() {
	  function handleClick(e) {
	    e.preventDefault();
	    console.log('The link was clicked.');
	  }

	  return (
	    <a href="#" onClick={handleClick}> Click me </a>
	  );
	}

React ä½¿ç”¨çš„æ˜¯åˆæˆäº‹ä»¶å¯¹è±¡ SyntheticEventï¼Œå³å†…éƒ¨å¯¹åŸå§‹çš„ HTML äº‹ä»¶å¯¹è±¡è¿›è¡Œäº†ç»Ÿä¸€å°è£…ï¼Œæ‰€æœ‰äº‹ä»¶å®šä¹‰éƒ½éµå¾ª W3C DOM Level 3 äº‹ä»¶æ¨¡å‹ã€‚ä¸€äº›å¿…è¦çš„åŸç”Ÿæ–¹æ³•ï¼Œå¦‚ stopPropagation() å’Œ preventDefault() éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

äº‹ä»¶è§¦å‘æµç¨‹ä¹Ÿä¸‰ä¸ªæ ‡å‡†æµç¨‹ï¼š

- The capture phase: äº‹ä»¶å¯æ•æŠ“æœŸï¼Œäº‹ä»¶å¯¹è±¡ä»é¡¶çº§èŠ‚ç‚¹å¾€æœ«ç«¯è§¦å‘äº‹ä»¶èŠ‚ç‚¹çš„ä¸Šçº§æŸ¥è¯¢ captue æ–¹å¼æ³¨å†Œçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼›
- The target phase: å¦‚æœäº‹ä»¶æ²¡æœ‰è¢«æ•æŠ“å°±è¿›å…¥è§¦å‘äº‹ä»¶çš„ç›®æ ‡æ³¨å†Œçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼›
- The bubble phase: å¦‚æœæ²¡æœ‰å¤„ç†å‡½æ•°æˆ–è€…å¤„ç†å‡½æ•°æ²¡æœ‰æŒ‡æ˜ç¦æ­¢å†’æ³¡ï¼Œäº‹ä»¶å°±å¾€çˆ¶çº§è¿›è¡Œå†’æ³¡æµç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å…è®¸å…¶å®ƒçˆ¶çº§çš„èŠ‚ç‚¹æœ‰æœºä¼šå¤„ç†äº‹ä»¶ï¼›

ä»¥ä¸‹æ˜¯åˆæˆäº‹ä»¶å¯¹è±¡çš„éƒ¨åˆ†å±æ€§ï¼š

- boolean bubbles
- boolean cancelable
- DOMEventTarget currentTarget
- boolean defaultPrevented
- number eventPhase
- boolean isTrusted
- DOMEvent nativeEvent
- void preventDefault()
- boolean isDefaultPrevented()
- void stopPropagation()
- boolean isPropagationStopped()
- void persist()
- DOMEventTarget target
- number timeStamp
- string type

ç„¦ç‚¹äº‹ä»¶å¤„ç†çš„ä¾‹å­ï¼š

	function Example() {
	  return (
	    <div
	      tabIndex={1}
	      onFocus={(e) => {
	        if (e.currentTarget === e.target) {
	          console.log('focused self');
	        } else {
	          console.log('focused child', e.target);
	        }
	        if (!e.currentTarget.contains(e.relatedTarget)) {
	          // Not triggered when swapping focus between children
	          console.log('focus entered self');
	        }
	      }}
	      onBlur={(e) => {
	        if (e.currentTarget === e.target) {
	          console.log('unfocused self');
	        } else {
	          console.log('unfocused child', e.target);
	        }
	        if (!e.currentTarget.contains(e.relatedTarget)) {
	          // Not triggered when swapping focus between children
	          console.log('focus left self');
	        }
	      }}
	    >
	      <input id="1" />
	      <input id="2" />
	    </div>
	  );
	}

äº‹ä»¶åˆ†ç±»åŠå‚è€ƒï¼š

Clipboard Events

	Event names: onCopy onCut onPaste

	Properties:

	DOMDataTransfer clipboardData

Composition Events

	Event names: onCompositionEnd onCompositionStart onCompositionUpdate

	Properties:

	string data

Keyboard Events

	Event names: onKeyDown onKeyPress onKeyUp

	Properties:

	boolean altKey
	number charCode
	boolean ctrlKey
	boolean getModifierState(key)
	string key
	number keyCode
	string locale
	number location
	boolean metaKey
	boolean repeat
	boolean shiftKey
	number which


Focus Events

	Event names: onFocus onBlur

	Properties:

	DOMEventTarget relatedTarget

Form Events

	Event names: onChange onInput onInvalid onReset onSubmit


Generic Events

	Event names: onError onLoad


Mouse Events

	Event names: onClick onContextMenu onDoubleClick onDrag onDragEnd onDragEnter onDragExit

	onDragLeave onDragOver onDragStart onDrop onMouseDown onMouseEnter onMouseLeave
	onMouseMove onMouseOut onMouseOver onMouseUp

	Properties:

	boolean altKey
	number button
	number buttons
	number clientX
	number clientY
	boolean ctrlKey
	boolean getModifierState(key)
	boolean metaKey
	number pageX
	number pageY
	DOMEventTarget relatedTarget
	number screenX
	number screenY
	boolean shiftKey

CSS3 Pointer Events

	Event names: onPointerDown onPointerMove onPointerUp onPointerCancel onGotPointerCapture

	onLostPointerCapture onPointerEnter onPointerLeave onPointerOver onPointerOut

	Properties:

	number pointerId
	number width
	number height
	number pressure
	number tangentialPressure
	number tiltX
	number tiltY
	number twist
	string pointerType
	boolean isPrimary


Selection Events

	Event names: onSelect


Touch Events

	Event names: onTouchCancel onTouchEnd onTouchMove onTouchStart

	Properties:

	boolean altKey
	DOMTouchList changedTouches
	boolean ctrlKey
	boolean getModifierState(key)
	boolean metaKey
	boolean shiftKey
	DOMTouchList targetTouches
	DOMTouchList touches

UI Events

	Event names: onScroll

	Properties:

	number detail
	DOMAbstractView view

Wheel Events

	Event names: onWheel

	Properties:

	number deltaMode
	number deltaX
	number deltaY
	number deltaZ

Media Events

	Event names: onAbort onCanPlay onCanPlayThrough onDurationChange onEmptied onEncrypted

	onEnded onError onLoadedData onLoadedMetadata onLoadStart onPause onPlay
	onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend
	onTimeUpdate onVolumeChange onWaiting

Image Events

	Event names: onLoad onError


Animation Events

	Event names: onAnimationStart onAnimationEnd onAnimationIteration

	Properties:

	string animationName
	string pseudoElement
	float elapsedTime

Transition Events

	Event names: onTransitionEnd

	Properties:

	string propertyName
	string pseudoElement
	float elapsedTime

Other Events

	Event names: onToggle



## Conditional Rendering æŒ‰æ¡ä»¶æ¸²æŸ“

å¯ä»¥é€šè¿‡æ¡ä»¶è¯­å¥æ¥å†³å®šæ˜¯å¦æ¸²æŸ“æŒ‡å®šçš„ UI ç»„ä»¶ï¼Œè¿™å¾ˆå®¹æ˜“é€šè¿‡ if æˆ–è€… switch æµç¨‹æ§åˆ¶è¯­å¥æ¥å®ç°ã€‚

	function UserGreeting(props) {
	  return <h1>Welcome back!</h1>;
	}

	function GuestGreeting(props) {
	  return <h1>Please sign up.</h1>;
	}

	function Greeting(props) {
	  const isLoggedIn = props.isLoggedIn;
	  if (isLoggedIn) {
	    return <UserGreeting />;
	  }
	  return <GuestGreeting />;
	}

	ReactDOM.render(
	  // Try changing to isLoggedIn={true}:
	  <Greeting isLoggedIn={false} />,
	  document.getElementById('root')
	);

åœ¨çº¿è¿è¡Œ https://codepen.io/gaearon/pen/ZpVxNq?editors=0010

ä½¿ç”¨è¿‡æ»¤ï¼Œå°†ä¸éœ€è¦çš„ç»„ä»¶å‰”é™¤ï¼Œæˆ–è€…æŒ‘é€‰éœ€è¦æ¸²æŸ“çš„ç»„ä»¶éƒ½æ˜¯å¸¸è§çš„åšæ³•ï¼š

	import React, { useState, useEffect } from "react"

	let colors = ['salmon', 'tomato', 'yellow', 'pink', 'cornsilk', 'orchid'];

	let styles = {
	    background: '#333',
	    boxShadow: '2px 2px 3px #222',
	    color: 'white',
	    padding: 32,
	    margin: 32
	}

	function App() {
	    const [candy, setColors] = useState(colors)

	    function reset() {
	        setColors(() => colors)
	    }

	    function distribute(color:string) {
	        setColors((candy) => candy.filter(
	            (v,i) => v !== color
	        ))
	    }

	    return (
	        <div style={styles}>
	            <h1> Candy dispenser </h1>
	            {!candy.length && <button className="button-minimal" onClick={()=>reset()}>Reset</button>}
	            <ul>
	            {candy.map((v,i) => (
	                <li><button onClick={()=>distribute(v)} style={{background: v, padding: 4, margin: 4}}> Grab Candy </button></li>
	            ))}
	            </ul>
	        </div>
	    )
	}

	export default App

åœ¨çº¿è¿è¡Œ https://codepen.io/jeango/pen/BaLXKOY?editors=0010

ç¤ºä¾‹ï¼š

	class LoginControl extends React.Component {
	  constructor(props) {
	    super(props);
	    this.handleLoginClick = this.handleLoginClick.bind(this);
	    this.handleLogoutClick = this.handleLogoutClick.bind(this);
	    this.state = {isLoggedIn: false};
	  }

	  handleLoginClick() {
	    this.setState({isLoggedIn: true});
	  }

	  handleLogoutClick() {
	    this.setState({isLoggedIn: false});
	  }

	  render() {
	    const isLoggedIn = this.state.isLoggedIn;
	    let button;
	    if (isLoggedIn) {
	      button = <LogoutButton onClick={this.handleLogoutClick} />;
	    } else {
	      button = <LoginButton onClick={this.handleLoginClick} />;
	    }

	    return (
	      <div>
	        <Greeting isLoggedIn={isLoggedIn} />
	        {button}
	      </div>
	    );
	  }
	}

	ReactDOM.render(
	  <LoginControl />,
	  document.getElementById('root')
	);

åœ¨çº¿è¿è¡Œ https://codepen.io/gaearon/pen/QKzAgB?editors=0010


## Lists, Keys & Reconciliation åˆ—è¡¨ã€é”®å€¼ä¸åè°ƒå™¨
- Recursing On Children https://reactjs.org/docs/reconciliation.html#recursing-on-children

ä½¿ç”¨ JavaScript map() å‡½æ•°å¯ä»¥å¾ˆæ–¹ä¾¿å°†æ•°ç»„å†…å®¹æ˜ å°„åˆ°æ–°çš„å†…å®¹ï¼Œé€šå¸¸ç”¨å®ƒæ¥ç”Ÿæˆç»„ä»¶æˆ–å…ƒç´ åˆ—è¡¨ï¼š

	const numbers = [1, 2, 3, 4, 5];
	const listItems = numbers.map((number) =>
	  <li>{number}</li>
	);

	ReactDOM.render(
	  <ul>{listItems}</ul>,
	  document.getElementById('root')
	);

å†™æˆç»„ä»¶çš„å½¢å¼ï¼š

	function NumberList(props) {
	  const numbers = props.numbers;
	  const listItems = numbers.map((number) =>
	    <li>{number}</li>
	  );
	  return (
	    <ul>{listItems}</ul>
	  );
	}

	const numbers = [1, 2, 3, 4, 5];
	ReactDOM.render(
	  <NumberList numbers={numbers} />,
	  document.getElementById('root')
	);

è¿™ä¸ª key é€šå¸¸å¯ä»¥ç”¨æ•°æ®å¯¹è±¡çš„ idï¼Œå½“ç„¶ä¸é‡å¤çš„åºåˆ—å·ä¹Ÿå¯ä»¥ï¼š

	const todoItems = todos.map((todo) =>
	  <li key={todo.id}> {todo.text} </li>
	);

æ³¨æ„ï¼Œkey è¦è®¾ç½®åœ¨åˆ—è¡¨äº§ç”Ÿçš„ä½ç½®çš„æ¡ç›®ä¸Šï¼Œè€Œä¸å•å•æ˜¯åˆ—è¡¨æ¡ç›®ä¸Šï¼Œå‚è€ƒä»¥ä¸‹çš„ key è®¾ç½®ã€‚å°½ç®¡ Blog çš„åˆ—è¡¨å…ƒç´  sidebar å’Œ content å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ul åˆ—è¡¨ä¸­ï¼Œä½†æ˜¯åœ¨ React å†…éƒ¨å®ƒä»¬æ˜¯é€šè¿‡ map æ˜ å°„å¾—åˆ°çš„ä¸¤ä¸ªä¸åŒçš„åˆ—è¡¨ï¼š

	function Blog(props:{posts: typeof posts}) {
	  const sidebar = (
	    <ul>
	      {props.posts.map((post) =>
	        <li key={post.id}> {post.title} </li>
	        )}
	    </ul>
	  );
	  const content = props.posts.map((post) =>
	    <div key={post.id}>
	        <h3>{post.title}</h3>
	        <p>{post.content}</p>
	    </div>
	  );
	  return (
	    <>
	      {sidebar}
	      {content}
	    </>
	  );
	}

	const posts = [
	  {id: 1, title: 'Hello World', content: 'Welcome to learning React!'},
	  {id: 2, title: 'Installation', content: 'You can install React from npm.'}
	];

	export default function Posts(props:{posts?:(typeof posts[0])[]}) {
	  if(props.posts){
	    return ( <Blog posts={props.posts} /> );
	  }else{
	    return ( <Blog posts={posts} /> );
	  }
	}

æ³¨æ„ JSX çš„çº¯ç²¹çš„å°–æ‹¬å·å¯¹ä½œç”¨å’Œ Vue çš„ template æˆ–å¾®ä¿¡å°ç¨‹åºçš„ block å…ƒç´ ä¸€æ ·ï¼ŒæŒ‡ä¸éœ€è¦åœ¨ DOM æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚

JSX æ”¯æŒåœ¨å…ƒç´ ä¸­åµŒå…¥è„šæœ¬è¡¨è¾¾å¼ï¼š

	function NumberList(props) {
	  const numbers = props.numbers;
	  return (
	    <ul>
	      {numbers.map((number) =>
	        <ListItem key={number.toString()} value={number} />
	      )}
	    </ul>
	  );
	}

ç”Ÿæˆçš„è¿™äº›ç»„ä»¶åˆ—è¡¨åœ¨ React å†…éƒ¨çš„è™šæ‹Ÿ DOM ä¸­ç®¡ç†æ—¶ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼ŒReact ä¼šä¸æµè§ˆå™¨çš„ DOM èŠ‚ç‚¹è¿›è¡Œæ¯”å¯¹ï¼Œå¹¶å°½é‡åˆ©ç”¨å¥½ç°æœ‰çš„ DOM å¯¹è±¡ï¼Œé¿å…é‡å¤çš„é”€æ¯å’Œé‡å»ºï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªç¨³å®šä¸”åœ¨åŒä¸€åˆ—è¡¨ä¸­ä¸é‡å¤çš„ key å€¼æ¥æ ‡è®°ä¸€ä¸ªèŠ‚ç‚¹å’Œç»„ä»¶ä»¶çš„å¯¹åº”å…³ç³»ã€‚

key å€¼åªéœ€è¦åœ¨å½“å‰çš„åˆ—è¡¨ä¸­å”¯ä¸€ï¼Œä¸éœ€è¦åœ¨æ•´ä¸ªåº”ç”¨ä¸­å”¯ä¸€ï¼ŒReact å†…éƒ¨çš„ Fiber Reconciler è°ƒå’Œå™¨çŸ¥é“å¦‚ä½•é«˜æ•ˆåœ°å¤„ç†è™šæ‹Ÿ DOM èŠ‚ç‚¹æ ‘ã€‚åè°ƒç®—æ³•æ˜¯ React çš„ä¸€ä¸ªå®ç°ç»†èŠ‚ï¼ŒReact å¯ä»¥åœ¨æ¯ä¸ªæ“ä½œä¸Šé‡æ–°å¯åŠ¨æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œæœ€ç»ˆç»“æœæ˜¯ç›¸åŒçš„ã€‚è¦æ¸…æ¥šçš„æ˜¯ï¼Œåœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­é‡æ–°æ¸²æŸ“æ„å‘³ç€ä¸ºæ‰€æœ‰ç»„ä»¶è°ƒç”¨ renderï¼Œå¹¶ä¸æ„å‘³ç€ React è¦å°†å®ƒå¸è½½å¹¶é‡æ–°è£…è½½å®ƒä»¬ï¼Œè¿™å°±æ˜¯è™šæ‹Ÿ DOM çš„å¥½å¤„ã€‚

åœ¨å½“å‰çš„å®ç°ä¸­åè°ƒç®—æ³•ä¸­ï¼ŒDiffing Algorithm å·®å¼‚æ¯”è¾ƒç®—æ³•å¯ä»¥åˆ†è¾¨åŒä¸€ä¸ª key å€¼çš„ä¸åŒä½ç½®æ¥è¡¨ç¤ºå­æ ‘åœ¨å…¶åŒçº§ä¹‹é—´ä½ç½®ç§»åŠ¨ï¼Œä½†æ— æ³•åˆ¤æ–­å®ƒå·²ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ã€‚

è¯¥ç®—æ³•ä¸ä¼šå°è¯•åŒ¹é…ä¸åŒç»„ä»¶ç±»å‹çš„å­æ ‘ï¼Œå¦‚æœæ‚¨çœ‹åˆ°è‡ªå·±åœ¨ä¸¤ç§è¾“å‡ºéå¸¸ç›¸ä¼¼çš„ç»„ä»¶ç±»å‹ä¹‹é—´äº¤æ›¿ä½¿ç”¨ï¼Œåˆ™å¯èƒ½éœ€è¦å°†å…¶è®¾ç½®ä¸ºç›¸åŒçš„ç±»å‹ã€‚

è®¾ç½®çš„ key å€¼åº”è¯¥æ˜¯ç¨³å®šçš„ã€å¯é¢„æµ‹çš„å’Œå”¯ä¸€çš„ã€‚ä¸ç¨³å®š key å€¼ï¼Œå¦‚ Math.random() å°†å¯¼è‡´ä¸å¿…è¦åœ°é‡æ–°åˆ›å»ºè®¸å¤šç»„ä»¶å®ä¾‹å’Œ DOM èŠ‚ç‚¹ï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™å’Œå­ç»„ä»¶ä¸­çš„çŠ¶æ€ä¸¢å¤±ã€‚

å·®å¼‚æ¯”è¾ƒç®—æ³•æœ€åŸºæœ¬çš„æ¯”è¾ƒï¼Œå°±æ˜¯å¯¹ç»„ä»¶æ ‘æ ¹å…ƒç´ çš„æ¯”è¾ƒã€‚æ¯ä¸ªç»„ä»¶çš„ render è¿”å›çš„ç»„ä»¶æ ‘éƒ½æ˜¯åªæœ‰ä¸€ä¸ªæ ¹å…ƒç´ çš„ï¼Œä»¥æ•°ç»„æ–¹å¼è¿”å›çš„æƒ…å†µä¹Ÿç®—ï¼Œå°±æ˜¯å°†æ•°ç»„å¯¹è±¡å½“ä½œæ ¹å…ƒç´ ã€‚



## Fiber Reconciliation è°ƒå’Œå™¨
- React Fiber Reconciliation https://reactjs.org/docs/reconciliation.html
- React Fiber Architecture https://github.com/acdlite/react-fiber-architecture
- React æºç å…¨æ–¹ä½å‰–æ http://www.sosout.com/2018/08/12/react-source-analysis.html

ç®€å•ç†è§£ï¼Œfiber å°±æ˜¯æŒ‡ç»„ä»¶ä¸Šå°†è¦å®Œæˆæˆ–è€…å·²ç»å®Œæˆçš„ä»»åŠ¡ï¼Œæ¯ä¸ªç»„ä»¶å¯ä»¥å®‰æ’â¼€ä¸ªæˆ–è€…å¤šä¸ª fiberã€‚

React æä¾›äº†å£°æ˜å¼ APIï¼Œè¿™æ ·ä¸å¿…è€ƒè™‘æ¯æ¬¡æ›´æ–°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä½¿å¾—ç¼–å†™åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œåœ¨ React ä¸­å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„å°±æ˜¯ Fiber Reconciliation è°ƒå’Œå™¨ã€‚

å‰é¢è¿½è¸ªä»£ç åˆ° ReactDom.render() --> legacyRenderSubtreeIntoContainer() --> getPublicRootInstance()ï¼Œå†æ·±å…¥è¿½è¸ª Render çš„ä»£ç å°±æ¶‰åŠ React Fiber éƒ¨åˆ†äº†ï¼Œå¯ä»¥è¯´è¿™æ˜¯ React ç®—æ³•å®ç°çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå…¶ä¸­åŒ…å«äº†å¤§é‡çš„è®¡ç®—æœºç³»ç»ŸçŸ¥è¯†ï¼ŒåŒ…æ‹¬ä¸»è¦å·®åˆ«æ¯”è¾ƒç®—æ³• diffingã€‚React Firber å¹¶ä¸æ˜¯æ‰€è°“çš„çº¤ç¨‹ã€å¾®çº¿ç¨‹ã€åç¨‹ï¼Œè€Œæ˜¯ä¸€ç§åŸºäºæµè§ˆå™¨çš„å•çº¿ç¨‹è°ƒåº¦ç®—æ³•ã€‚

	import {
	  findHostInstanceWithNoPortals,
	  updateContainer,
	  unbatchedUpdates,
	  getPublicRootInstance,
	  findHostInstance,
	  findHostInstanceWithWarning,
	} from 'react-reconciler/src/ReactFiberReconciler';

ç”±äºæµè§ˆå™¨æ¸²æŸ“å¼•æ“æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨ React15.x åŠä¹‹å‰ç‰ˆæœ¬ï¼Œä» setState å¼€å§‹åˆ°æ¸²æŸ“å®Œæˆæ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸å—æ§åˆ¶ä¸”è¿ç»­ä¸ä¸­æ–­å®Œæˆçš„ï¼Œç”±äºè¯¥è¿‡ç¨‹å°†ä¼šå ç”¨æ•´ä¸ªçº¿ç¨‹ï¼Œåˆ™å…¶ä»–ä»»åŠ¡éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æ ·å¼è®¡ç®—ã€ç•Œé¢å¸ƒå±€ä»¥åŠè®¸å¤šæƒ…å†µä¸‹çš„ç»˜åˆ¶ç­‰ã€‚

å¦‚æœéœ€è¦æ¸²æŸ“çš„æ˜¯ä¸€ä¸ªå¾ˆå¤§ã€å±‚çº§å¾ˆæ·±çš„ç»„ä»¶ï¼Œè¿™å¯èƒ½å°±ä¼šä½¿ç”¨æˆ·æ„Ÿè§‰æ˜æ˜¾å¡é¡¿ï¼Œæ¯”å¦‚æ›´æ–°ä¸€ä¸ªç»„ä»¶éœ€è¦ 1 æ¯«ç§’ï¼Œå¦‚æœæœ‰ 200 ä¸ªç»„ä»¶å°±éœ€è¦ 200 æ¯«ç§’ã€‚åœ¨è¿™ä¸ªæ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å”¯ä¸€çš„ä¸»çº¿ç¨‹åœ¨ä¸“å¿ƒè¿è¡Œæ›´æ–°æ“ä½œï¼Œæ— æš‡å»åšå…¶ä»–ä»»ä½•äº‹æƒ…ã€‚ç”¨æˆ·çš„ UI äº¤äº’ï¼Œå¦‚å¾€ä¸€ä¸ª input å…ƒç´ ä¸­è¾“å…¥ç‚¹ä»€ä¹ˆï¼Œæ•²å‡»é”®ç›˜ä¹Ÿä¸ä¼šç«‹å³è·å¾—å“åº”ã€‚

è™½ç„¶æ¸²æŸ“è¾“å…¥æŒ‰é”®ç»“æœæ˜¯æµè§ˆå™¨ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œä½†æ˜¯æµè§ˆå™¨ä¸»çº¿ç¨‹è¢« React å ç”¨ï¼ŒæŠ½ä¸å‡ºç©ºï¼Œæœ€åçš„ç»“æœå°±æ˜¯ç”¨æˆ·æ•²äº†æŒ‰é”®çœ‹ä¸åˆ°ååº”ï¼Œç­‰ React æ›´æ–°è¿‡ç¨‹ç»“æŸä¹‹åï¼Œå’”å’”å’”é‚£äº›æŒ‰é”®ä¸€ä¸‹å­å‡ºç°åœ¨ input å…ƒç´ é‡Œäº†ã€‚

æ—§ç‰ˆæœ¬çš„è°ƒå’Œå™¨å¯ä»¥ç§°ä¸ºæ ˆè°ƒå’Œå™¨ Stack Reconcilerï¼Œä¸»è¦ç¼ºé™·å°±æ˜¯ä¸èƒ½æš‚åœæ¸²æŸ“ä»»åŠ¡ï¼Œä¹Ÿä¸èƒ½åˆ‡åˆ†ä»»åŠ¡ï¼Œæ›´æ— æ³•æœ‰æ•ˆå¹³è¡¡ç»„ä»¶æ›´æ–°æ¸²æŸ“ä¸åŠ¨ç”»ç›¸å…³ä»»åŠ¡é—´çš„æ‰§è¡Œé¡ºåºï¼Œå³ä¸èƒ½åˆ’åˆ†ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œè¿™æ ·å°±å¾ˆæœ‰å¯èƒ½å¯¼è‡´é‡è¦ä»»åŠ¡å¡é¡¿ï¼ŒåŠ¨ç”»æ‰å¸§ç­‰é—®é¢˜ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒReact å›¢é˜Ÿç»è¿‡ä¸¤å¹´å¤šçš„åŠªåŠ›ï¼Œæå‡ºäº†ä¸€ä¸ªæ›´å…ˆè¿›çš„ Fiber Reconciler è°ƒå’Œå™¨ï¼Œå®ƒå…è®¸æ¸²æŸ“è¿‡ç¨‹åˆ†æ®µå®Œæˆï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§å®Œæˆï¼Œåœ¨æ¸²æŸ“æœŸé—´å¯è¿”å›åˆ°ä¸»çº¿ç¨‹æ§åˆ¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚

é€šè¿‡è®¡ç®—éƒ¨åˆ†ç»„ä»¶æ ‘çš„å˜æ›´ï¼Œå¹¶æš‚åœæ¸²æŸ“æ›´æ–°ï¼Œè¯¢é—®ä¸»çº¿ç¨‹æ˜¯å¦æœ‰æ›´é«˜éœ€æ±‚çš„ç»˜åˆ¶æˆ–è€…æ›´æ–°ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œè¿™äº›é«˜éœ€æ±‚çš„ä»»åŠ¡å®Œæˆåå†é‡æ–°æ¸²æŸ“ã€‚è¿™ä¸€åˆ‡çš„å®ç°æ˜¯åœ¨ä»£ç å±‚å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„å¯¹è±¡ Fiberï¼Œæ¯ä¸€ä¸ªç»„ä»¶å®ä¾‹å¯¹åº”æœ‰ä¸€ä¸ª fiber å®ä¾‹ï¼Œæ­¤å®ä¾‹è´Ÿè´£ç®¡ç†ç»„ä»¶å®ä¾‹çš„æ›´æ–°ï¼Œæ¸²æŸ“ä»»åŠ¡åŠä¸å…¶ä»– fiber å®ä¾‹çš„é€šä¿¡ã€‚

çº¤ç»´è°ƒå’Œå™¨ Fiber Reconciler æä¾›çš„æ–°åŠŸèƒ½ä¸»è¦æœ‰ï¼š

- ä¸€ã€è°ƒåº¦ä»»åŠ¡ scheduleWorkï¼ŒæŠŠå¯ä¸­æ–­çš„ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡ï¼›
- äºŒã€å¯é‡ç”¨å„åˆ†é˜¶æ®µä»»åŠ¡ï¼Œå¯¹æ­£åœ¨åšçš„å·¥ä½œè°ƒæ•´ä¼˜å…ˆæ¬¡åºï¼›
- ä¸‰ã€å¯ä»¥åœ¨çˆ¶å­ç»„ä»¶ä»»åŠ¡é—´å‰è¿›åé€€åˆ‡æ¢ä»»åŠ¡ï¼Œä»¥æ”¯æŒReactæ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¸ƒå±€åˆ·æ–°ï¼›
- å››ã€æ”¯æŒ render æ–¹æ³•è¿”å›å¤šä¸ªå…ƒç´ ï¼›
- äº”ã€å¯¹å¼‚å¸¸è¾¹ç•Œå¤„ç†æä¾›äº†æ›´å¥½çš„æ”¯æŒï¼›


ä½¿ç”¨ React æ—¶ï¼Œåœ¨å•ä¸ªæ—¶é—´ç‚¹å¯ä»¥å°† render() å‡½æ•°è§†ä¸ºåˆ›å»º React å…ƒç´ æ ‘ã€‚åœ¨ä¸‹ä¸€ä¸ªçŠ¶æ€æˆ–é“å…·æ›´æ–°æ—¶ï¼Œrender() å‡½æ•°å°†è¿”å›ä¸åŒçš„ React Element Treeã€‚React åœ¨æ›´å‰ DOM æ ‘å‰ï¼Œéœ€è¦å¼„æ¸…æ¥šå¦‚ä½•é«˜æ•ˆåœ°æ›´æ–° UI ä»¥åŒ¹é…æœ€æ–°çš„ Element Treeã€‚

å¯¹äºè¿™ä¸ªç®—æ³•é—®é¢˜ï¼Œæœ‰ä¸€äº›é€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå³ç”Ÿæˆå°†ä¸€æ£µæ ‘è½¬æ¢ä¸ºå¦ä¸€æ£µæ ‘çš„æœ€å°æ“ä½œæ•°ã€‚ç„¶è€Œï¼Œç°æœ‰ç®—æ³•çš„å¤æ‚åº¦ä¸º O(n3)ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­çš„å…ƒç´ æ•°é‡ã€‚

å¦‚æœåœ¨ React ä¸­ä½¿ç”¨å®ƒï¼Œæ˜¾ç¤º 1000 ä¸ªå…ƒç´ å°†éœ€è¦ 10 äº¿æ¬¡æ¯”è¾ƒï¼Œè¿™ä¸ªæ—¶é—´æˆæœ¬å¤ªè´µäº†ã€‚ç›¸åï¼ŒReact åŸºäºä¸¤ä¸ªå‡è®¾å®ç°äº†ä¸€ä¸ªå¯å‘å¼ O(n) ç®—æ³•ï¼š

- ä¸¤ç§ä¸åŒç±»å‹çš„å…ƒç´ ä¼šäº§ç”Ÿä¸åŒçš„æ ‘ã€‚
- å¼€å‘è€…å¯ä»¥ç»™ç»„ä»¶æŒ‡å®šä¸€ä¸ªé”® key å±æ€§æç¤ºå“ªäº›å­å…ƒç´ åœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç¨³å®šçš„ã€‚
- å®é™…ä¸Šï¼Œè¿™äº›å‡è®¾å¯¹äºå‡ ä¹æ‰€æœ‰çš„å®é™…ç”¨ä¾‹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚


The Diffing Algorithm å·®å¼‚ç®—æ³•

å¯¹ä¸¤æ£µæ ‘è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ŒReact é¦–å…ˆæ¯”è¾ƒä¸¤ä¸ªæ ¹å…ƒç´ ï¼Œæ ¹å…ƒç´ çš„ç±»å‹ä¸åŒè¡Œä¸ºæ˜¯ä¸åŒçš„ã€‚


ğŸ‘‰ Root Elements Of Different Types

åœ¨æ ¹å…ƒç´ ä¸åŒçš„æƒ…å†µä¸‹ï¼Œå·®å¼‚æ¯”è¾ƒç®—æ³•ä¼šåœ¨ç»„ä»¶çš„æ ¹å…ƒç´ æ”¹å˜æ—¶é‡æ„ç»„ä»¶æ ‘ï¼Œæ‰€æœ‰ HTML æ ‡ç­¾å…ƒç´ éƒ½ä¼šè¢«é‡Šæ”¾ï¼Œå†é‡å»ºæ–°çš„ç»„ä»¶æ ‘ã€‚è¿™ä¼šæ¶ˆè€—ç›¸å½“çš„ CPU æ—¶é—´å»æ¸…ç†æµè§ˆå™¨ DOM æ ‘ä¸Šçš„æ—§èŠ‚ç‚¹ï¼ŒåŒæ—¶ï¼Œç»„ä»¶å®ä¾‹ä¼šæ”¶åˆ° componentWillUnmount() ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„è°ƒç”¨ã€‚å½“æ–°çš„ DOM èŠ‚ç‚¹æ’å…¥ï¼Œç»„ä»¶å®ä¾‹è¢«åˆ›å»ºï¼Œä¼šæ”¶åˆ° UNSAFE_componentWillMount() çš„è°ƒç”¨ï¼Œç„¶åæ˜¯ componentDidMount() ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚

æ¯”å¦‚ä»¥ä¸‹ä¸¤ä¸ªèŠ‚ç‚¹æ ‘å°±æ˜¯æ ¹å…ƒç´ ä¸åŒï¼š

	<div>
	  <Counter />
	</div>

	<span>
	  <Counter />
	</span>


ğŸ‘‰ DOM Elements Of The Same Type

åœ¨ç›¸åŒçš„ React DOM å…ƒç´ æ¯”è¾ƒä¸­ï¼Œä¼šä¿æŒåŸºæœ¬çš„èŠ‚ç‚¹å…ƒç´ ï¼Œå¹¶ä¸”åªæ›´æ–°æœ‰å·®å¼‚çš„å±æ€§éƒ¨åˆ†ï¼Œå¦‚ä»¥ä¸‹è¿™ç»„å·®å¼‚åªä¼šæ›´æ–°æ ·å¼ç±»ï¼š

	<div className="before" title="stuff" />

	<div className="after" title="stuff" />


å¦‚æœæ˜¯æ ·å¼æ›´æ–°ä¹Ÿå¦‚æ­¤å¤„ç†ï¼Œåªæ›´æ–°ä¸åŒçš„ color å€¼ï¼š

	<div style={{color: 'red', fontWeight: 'bold'}} />

	<div style={{color: 'green', fontWeight: 'bold'}} />

å¤„ç†å®Œä¸€ä¸ªèŠ‚ç‚¹åå†é€’å½’å¤„ç†å…¶å®ƒå­èŠ‚ç‚¹ã€‚


ğŸ‘‰ Component Elements Of The Same Type

å¯¹äºç›¸åŒçš„ç»„ä»¶ï¼Œä¼šä¿æŒåŸæœ‰å®ä¾‹ï¼Œç»„ä»¶çŠ¶æ€ä¹Ÿä¸€æ ·ä¿æŒã€‚React ä¼šæ›´æ–°ç»„ä»¶å±æ€§ propsï¼Œå¹¶è°ƒç”¨ UNSAFE_componentWillReceiveProps(), UNSAFE_componentWillUpdate() å’Œ componentDidUpdate() è¿™äº›ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ¥ç€æ‰§è¡Œ render() ï¼Œå·®å¼‚æ¯”è¾ƒç®—æ³•ä¼šå°†ç»„ä»¶çš„ç»“æœé€’å½’å¤„ç†ã€‚

DeprecatedLifecycle æ¥å£è¿™äº›è¿‡æ—¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°åº”è¯¥å°½é‡é¿å…ä½¿ç”¨ï¼š

    interface DeprecatedLifecycle<P, S> {
        componentWillMount?(): void;
        UNSAFE_componentWillMount?(): void;
        componentWillReceiveProps?(nextProps: Readonly<P>, nextContext: any): void;
        UNSAFE_componentWillReceiveProps?(nextProps: Readonly<P>, nextContext: any): void;
        componentWillUpdate?(nextProps: Readonly<P>, nextState: Readonly<S>, nextContext: any): void;
        UNSAFE_componentWillUpdate?(nextProps: Readonly<P>, nextState: Readonly<S>, nextContext: any): void;
    }

é€šå¸¸ï¼ŒReact åŒæ—¶ä¼šé€’å½’å¤„ç†åˆ—è¡¨å’Œå­èŠ‚ç‚¹ï¼Œä»¥ä¸‹è¿™ç»„å·®å¼‚ä¸­ï¼Œä¼šåŒ¹é…åˆ°å‰ä¸¤ä¸ªç›¸åŒçš„èŠ‚ç‚¹ï¼Œå¹¶å°†ç¬¬ä¸‰ä¸ªæ–°èŠ‚ç‚¹æ’å…¥ï¼š

	<ul>
	  <li>first</li>
	  <li>second</li>
	</ul>

	<ul>
	  <li>first</li>
	  <li>second</li>
	  <li>third</li>
	</ul>

ä½†æ˜¯ï¼Œå¦‚æœæ–°å¢åŠ çš„èŠ‚ç‚¹å‡ºç°åœ¨å‰é¢ï¼Œæ€§èƒ½ä¼šæ›´å·®ï¼š

	<ul>
	  <li>Duke</li>
	  <li>Villanova</li>
	</ul>

	<ul>
	  <li>Connecticut</li>
	  <li>Duke</li>
	  <li>Villanova</li>
	</ul>

React è®¤è¯†ä¸åˆ°å¯ä»¥ä¿ç•™è¿™ä¸¤ä¸ªåŸæœ‰çš„èŠ‚ç‚¹ï¼Œè€Œæ˜¯å˜æ›´æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯ä¸ºä½•è¦ç»™åˆ—è¡¨è®¾ç½® keyï¼Œè¿™å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚



## Forms Controlled vs Uncontrolled è¡¨å•å¤„ç†
- Uncontrolled Components https://reactjs.org/docs/uncontrolled-components.html
- Controlled and uncontrolled form inputs in React https://goshakkk.name/controlled-vs-uncontrolled-inputs-react/
- HTML Form tag https://www.w3school.com.cn/tags/tag_form.asp
- File API - Using files from web applications https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications
- Using Fetch API https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API
- XMLHttpRequest Living Standard https://xhr.spec.whatwg.org/
- [Upload ä¸Šä¼ ç»„ä»¶è®¾è®¡æ€è·¯ - é«˜æ‰©å±•](https://zhuanlan.zhihu.com/p/56684600)
- Fusion Upload Component https://fusion.design/pc/component/basic/upload?themeid=2
- ä¸ƒç‰›äº‘å­˜å‚¨ - JavaScript SDK https://developer.qiniu.com/kodo/1283/javascript


React ä¸­å¯¹ HTML è¡¨å•çš„å¤„ç†æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æŒ‰ HTML åŸæ ·ã€‚æ¯”å¦‚ä»¥ä¸‹è¿™ä¸ªè¡¨å•ï¼ŒæŒ‰ä¸‹ submit æŒ‰é’®å°±ä¼šè·³è½¬åˆ°è¡¨å•æ¥æ”¶é¡µé¢ï¼š

	<form>
	  <label>
	    Name:
	    <input type="text" name="name" />
	  </label>
	  <input type="submit" value="Submit" />
	</form>

è¿™å°±æ˜¯ä¸å—æ§æ–¹å¼ Uncontrolledï¼Œè¿™ç§åŸå§‹çš„å¤„ç†æ–¹å¼æ²¡æœ‰å®Œæ•´åˆ©ç”¨ React çš„åŠŸèƒ½ï¼Œä¸èƒ½å¯¹è¡¨å•è¿›è¡Œçµæ´»çš„è·Ÿè¸ªå’Œå¤„ç†ï¼ŒåŒ…æ‹¬è¾“å…¥çš„å†…å®¹å­—å¤„ç†æˆ–éªŒè¯ç­‰ã€‚

ç”±äºä¸å—æ§åˆ¶çš„ç»„ä»¶åœ¨ DOM ä¸­ä¿ç•™åŸæ ·åŠŸèƒ½ï¼Œå› æ­¤åœ¨ä½¿ç”¨ä¸å—æ§åˆ¶çš„ç»„ä»¶æ—¶ï¼Œæ›´å®¹æ˜“é›†æˆ React æˆ– non-React ä»£ç ï¼Œå®ƒä¹Ÿå¯ä»¥ç¨å¾®å°‘ä¸€äº›ä»£ç ã€‚å¦åˆ™ï¼Œéœ€è¦æ›´å¤šçš„åŠŸèƒ½æ§åˆ¶ï¼Œé€šå¸¸åº”ä½¿ç”¨å—æ§ç»„ä»¶ã€‚


ä»¥ä¸‹éå—æ§è¡¨å•æ¨¡æ‹Ÿäº† HTML è¡¨å•çš„å¤„ç†ï¼Œä½¿ç”¨ handleSubmit ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡å¼¹å‡ºå¯¹è¯æ¡†æ¥æ¨¡æ‹Ÿæäº¤åŠ¨ä½œï¼Œä½¿ç”¨ preventDefault() æ¥é˜»æ­¢é»˜è®¤çš„è¡Œä¸ºï¼Œäº‹å®ä¸Šè¿™ç§åšæ³•æœ¬èº«å°±ç®—æ˜¯å—æ§çš„æ¦‚å¿µï¼š

	class NameForm extends React.Component {

	  public input:React.RefObject<HTMLInputElement>

	  public method = "POST"
	  public action = "/some/page"

	  constructor(props:any) {
	    super(props);
	    this.handleSubmit = this.handleSubmit.bind(this);
	    this.input = React.createRef<HTMLInputElement>();
	  }

	  handleSubmit(event:React.FormEvent) {
	    let name = this.input.current!.value || "NOTHING"; // what ?? don't working?
	    // let name = this.input.current?.value ?? "NOTHING";
	    alert(`A name was submitted: ${name} to ${this.action} by ${this.method}`);
	    event.preventDefault();
	  }

	  render() {
	    return (
	      <form method={this.method} action={this.action} onSubmit={this.handleSubmit}>
	        <label>
	          Name:
	          <input type="text" ref={this.input} />
	        </label>
	        <input type="submit" value="Submit" />
	      </form>
	    );
	  }
	}

åœ¨å—æ§ç»„ä»¶ä¸Šè®¾ç½®å›ºå®šå€¼å¯ä»¥é˜²æ­¢è¢«æ”¹åŠ¨ï¼Œä»¥ä¸‹ä»£ç æ¼”ç¤ºé”å®š 3s æ—¶é—´å†…ä¸å¯ä¿®æ”¹è¾“å…¥æ¡†çš„å†…å®¹ï¼Œç›´åˆ°è¾“å…¥å€¼ä¸º undefined æˆ– nullï¼š

	ReactDOM.render(<input value="hi" />, mountNode);

	setTimeout(function() {
	  ReactDOM.render(<input value={null} />, mountNode);
	}, 3000);

è¯·è®°ä½ï¼Œè¿™é‡Œçœ‹åˆ°çš„ input å¹¶ä¸ç­‰äºæµè§ˆå™¨ DOM æ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œå®ƒéœ€è¦ç»è¿‡è™šæ‹Ÿ DOM çš„æ˜ å°„åˆ°çœŸå®çš„èŠ‚ç‚¹ä¸Šçš„ã€‚


é€šå¸¸ï¼Œä¸ä¼šç›´æ¥ç»™è¡¨å•æ§ä»¶è®¾ç½®ä¸€ä¸ªå›ºå®šå€¼ï¼Œè€Œæ˜¯ä½¿ç”¨ defaultValue å±æ€§ä¼ é€’ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿™æ ·åœ¨è£…å…¥ç»„ä»¶åæ›´æ”¹ defaultValue å±æ€§çš„å€¼ä¸ä¼šå¯¼è‡´ DOM ä¸­çš„å€¼å‘ç”Ÿä»»ä½•æ›´æ–°ã€‚ç±»ä¼¼ï¼Œcheckbox æˆ– radio ä½¿ç”¨ defaultChecked è®¾ç½®é€‰ä¸­çŠ¶æ€, select å’Œ textarea ä½¿ç”¨ defaultValueã€‚å¯¹äº select åœ¨å­é€‰é¡¹ option ä¸­è®¾ç½® selected å±æ€§è¡¨ç¤ºé€‰ä¸­çŠ¶æ€çš„åšæ³•ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼š

	<input defaultValue="Bob" type="text" ref={this.input} />

	<input defaultChecked="Bob" type="checkbox" ref={this.input} />
	<input defaultChecked="Bob" type="radio" ref={this.input} />

	<select name="gender" defaultValue="female">
		<option value="male">Male</option>
		<option selected={true} value="female">Female</option>
	</select>

	<select multiple={true} value={['B', 'C']}>
	<select value={this.state.value} onChange={this.handleChange}>

å•é€‰æˆ–å¤šé€‰è¾“å…¥æ¡† radio å„ checkbox éƒ½å¯ä»¥åœ¨ onChange äº‹ä»¶ä¸­ä½¿ç”¨ checked æ¥æ£€æŸ¥æ˜¯å¦å¤„äºé€‰ä¸­çŠ¶æ€ï¼ŒåŒæ—¶æ³¨æ„ {[name]: value } è¿™ç§è¡¨è¾¾æ–¹å¼ï¼Œå¯ä»¥æ–¹ä¾¿å¯¹å¤šä¸ªä¸åŒçš„è¾“å…¥æ§ä»¶è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼š

	handleInputChange(event) {
		const target = event.target;
		const value = target.type === 'checkbox' ? target.checked : target.value;
		const name = target.name;

		this.setState({
		  [name]: value
		});
	}


æ–‡æœ¬è¾“å…¥æ§ä»¶å’Œ select æˆ–è€…å¤šè¡Œæ–‡æœ¬ textarea å¾ˆç›¸ä¼¼çš„ï¼Œéƒ½ä½¿ç”¨ valueã€‚

	<textarea value={this.state.value} onChange={this.handleChange} />


HTML ä¸­çš„ input æ§ä»¶æ˜¯å¤šç”¨ç”¨é€”çš„ï¼Œå½“å®ƒä½œä¸ºæ–‡ä»¶è¾“å…¥æ§ä»¶æ—¶ï¼Œå°±æ˜¯éå—æ§çš„ï¼Œå› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨æœºåˆ¶è€ƒè™‘ï¼Œå®ƒæ€»æ˜¯ç”±ç”¨æˆ·é€‰æ‹©è¾“å…¥ä»€ä¹ˆæ–‡ä»¶ã€‚å¯¹äºå·²ç»é€‰å¥½çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ HTML5 File API è¿›è¡Œå¤„ç†ï¼š

	<input type="file" multiple={true} ref={this.fileInput} />


æäº¤è¡¨å•æ—¶ï¼Œä¸€ä¸ªè¯·æ±‚ä¼´éšç€ header è®¾ç½®ä¸åŒæ•°æ®æ ¼å¼ä¹Ÿä¸åŒï¼Œæ¯”å¦‚ application/json è¯·æ±‚æ•°æ®åŒ…çœ‹èµ·æ¥å¦‚ä¸‹ï¼š

	POST /api HTTP/1.1
	Content-Type: application/json

	{ "foo" : "bar", "name" : "John" }

è¿™æ˜¯æ­£å¸¸ AJAX è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šç®€å•çš„å°†ä½ æäº¤çš„å†…å®¹ä½œä¸º Request Payload å±•ç¤ºå‡ºæ¥ï¼Œè¿™å°±æ˜¯å®ƒæ‰€èƒ½åšçš„ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“æ•°æ®è¦åšä»€ä¹ˆç”¨ã€‚

å¦‚æœä»…ä»…æäº¤äº†ä¸€ä¸ª HTML è¡¨å•ï¼Œå¹¶ä¸”è®¾ç½®äº† application/x-www-form-urlencoded æˆ–è€… multipart/form-data é‚£ä¹ˆä½ çš„è¯·æ±‚å¯èƒ½é•¿è¿™ä¸ªæ ·ï¼š

	POST /api HTTP/1.1
	Content-Type: application/x-www-form-urlencoded

	foo=bar&bar=foo

è¿™é‡Œçš„ Form Data æµè§ˆå™¨çŸ¥é“æ›´å¤šï¼Œå®ƒçŸ¥é“ bar æ˜¯æäº¤è¡¨å•çš„è¾“å…¥å­—æ®µ foo çš„å€¼ã€‚


åœ¨å¤„ç†æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œå¦‚æœæœªæ‰‹åŠ¨æŒ‡å®šä»»ä½•å†…å®¹ç±»å‹ï¼Œæµè§ˆå™¨ä¼šè®¾ç½®æ­£ç¡®çš„æ ‡é¢˜ï¼ŒåŒ…æ‹¬ Content-type åº”è¯¥é™„å¸¦çš„å¤šéƒ¨åˆ†è¾¹ç•ŒæŒ‡ç¤º boundaryã€‚ä½†æ˜¯ï¼Œå¦‚ä¸‹è¿™æ ·æ‰‹åŠ¨æŒ‡å®šç±»å‹ä¿¡æ¯ä¸å®Œæ•´æ—¶ï¼ŒæœåŠ¡å™¨å°±æ— æ³•ç”¨ boundary è¿›è¡Œå¤šæ–‡ä»¶çš„åˆ†å‰²æå–æ“ä½œï¼Œä»è€ŒæŠ¥é”™ï¼š

	Header("Content-type", "multipart/form-data"); 

	PHP Warning:  Missing boundary in multipart/form-data POST data in Unknown on line 0

æ‰€ä»¥è®¾å®šçš„å¤´éƒ¨ä¿¡æ¯æ—¶ï¼Œéœ€è¦è¡¥å……å®Œæ•´çš„ boundary æ ‡è®°ï¼Œæˆ–è€…å­—ç¬¦ç¼–ç æ–¹æ¡ˆï¼š

	"Content-Type": "multipart/form-data; boundary=BB"+Date.now(),
	"Content-type": "multipart/form-data; charset=utf-8; boundary=" + Math.random().toString().substr(2)); 


ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ–‡ä»¶è¡¨è¡¨å•ç»„ä»¶ï¼š


	type Props = {uploadURL?: string};

	class FileForm extends React.Component {

	  public input:React.RefObject<HTMLInputElement>
	  public inputToken:React.RefObject<HTMLInputElement>
	  public props: Props
	  public state:{flag: number}
	  public fileInfo:{files:FileList|never[], nFiles?:number, sOutput?:string}
	  public tokenQiniu:{key:string, token:string}
	  public returnStatus:{status?:number, statusText?:string, text?:string}

	  constructor(props:Props) {
	    super(props);
	    this.handleSubmit = this.handleSubmit.bind(this);
	    this.input = React.createRef<HTMLInputElement>();
	    this.inputToken = React.createRef<HTMLInputElement>();
	    this.state = {flag: 0};
	    this.props = props;
	    this.fileInfo = {} as any;
	    this.tokenQiniu = {} as any;
	    this.returnStatus = {} as any;
	    console.log("FileForm");
	  }

	  fetchToken(){
	    let file = this.fileInfo.files[0];
	    if(!file) return 
	    let api = 'https://www.jianshu.com/upload_images/token.json?filename='+file.name;
	    window.open(api);
	  }

	  handleSubmit(event:React.FormEvent) {
	    let files = this.input.current?.files || [];
	    console.log(this.input.current?.files);
	    
	    this.tokenQiniu = JSON.parse(this.inputToken.current?.value||"{}");
	    const formData = new FormData()
	    // for qiniu upload service
	    formData.append("token", this.tokenQiniu.token);
	    formData.append("key",   this.tokenQiniu.key);
	    for (let id in files) {
	      formData.append('file', files[id]);
	    }
	    formData.append("x:protocol",   "https");

	    fetch(this.props.uploadURL ?? "https://upload.qiniup.com/",{ 
	        method :"POST",
	        body: formData,
	        headers:{
	          // Form Data
	          // 'Content-Type': 'application/x-www-form-urlencoded',
	          // Request Payload
	          // 'Content-Type': 'application/json',
	          // 'Content-Type': 'text/plain',
	          "Content-Type": "multipart/form-data; boundary=BB"+Date.now(),
	          'Referer': 'http://jssdk-v2.demo.qiniu.io/'
	        } 
	    })
	    .then((res) => {
	      console.log('Fetch Status', res);
	      this.returnStatus = {status: res.status, statusText: res.statusText};
	      return res.text();
	    })
	    .then((text) => {
	      this.returnStatus = {...this.returnStatus, text: text};
	      console.log('Fetch JSON', text);
	      this.setState({flag: Date.now()});
	    }).catch(function(e) {
	      console.log('Fetch Error',e);
	    });

	    event.preventDefault();
	  }

	  render() {
	    let {status, statusText, text} = this.returnStatus;
	    console.log("FileForm render", this.fileInfo, this.returnStatus);
	    return (
	      <>
	      <form className="board" onSubmit={this.handleSubmit}>
	        <label>
	          File:
	          <input type="file" multiple={true} ref={this.input} onChange={ev => this.updateSize(ev)} />
	        </label>
	        <input type="submit" value="Submit" />
	      </form>

	      {status &&
	      <div className="board">
	        <div>Server return {status} {statusText}</div>
	        <div>{text}</div>
	      </div>}

	      {this.fileInfo.nFiles &&
	      <div className="board">
	        <label>
	        Token: <input type="text" ref={this.inputToken} />
	        <button onClick={ev => this.fetchToken()}>Get One</button>
	        </label>
	        <div>{this.fileInfo.nFiles} {(this.fileInfo.nFiles!>1? "Files":"File")} {this.fileInfo.sOutput}</div>
	      </div>}
	      </>
	    );
	  }
	  // input.addEventListener("change", updateSize, false);
	  updateSize(ev:React.ChangeEvent<HTMLInputElement>) {
	    let files = ev.target.files ?? [];
	    let nBytes = 0,
	        oFiles = files,
	        nFiles = oFiles?.length || 0;
	    for (let nFileId = 0; nFileId < nFiles; nFileId++) {
	      nBytes += oFiles[nFileId].size;
	    }
	    let sOutput = nBytes + " bytes";

	    const aMultiples = ["KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "ZiB", "YiB"];
	    for (let nMultiple = 0, nApprox = nBytes / 1024; nApprox > 1; nApprox /= 1024, nMultiple++) {
	      sOutput = nApprox.toFixed(3) + " " + aMultiples[nMultiple] + " (" + nBytes + " bytes)";
	    }
	    this.fileInfo = {files, nFiles, sOutput};
	    this.setState({flag: Date.now()});
	    console.log('updateSize', this.fileInfo);
	  }
	}

å¦‚æœå®‰è£…äº† curl å¯ä»¥ç”¨å®ƒæ¥åšæ–‡ä»¶ä¸Šä¼ æµ‹è¯•ï¼š

    curl -H "Content-Type: multipart/form-data" -X POST http://localhost:80/upload.php -F "file=@C:\pictures\firework.png"
    curl -H "Content-Type: multipart/form-data" -X POST http://localhost:80/upload.php -F "files[]=@C:\pictures\firework.png"

ä½œä¸ºæµ‹è¯•æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ php è„šæœ¬ä½œä¸ºæœåŠ¡å™¨çš„ APIï¼Œå¯ä»¥ä½¿ç”¨ php å†…ç½®çš„ Web æœåŠ¡ï¼š

	php -S localhost:80 -t /path/to/this/script

	<?php

	class Dynamic extends stdClass{
	    protected $_imageFormats = [ 'image/png','image/jpg', 'image/jpeg', 'image/gif', 'image/bmp' ];
	    protected $_uploadFolder = ".";
	    protected $_CORS = false;
	    protected $out;

	    public function __destruct() {
	        echo json_encode($this->out, JSON_PRETTY_PRINT|JSON_UNESCAPED_UNICODE);
	    }

	    public function __construct($_CORS = false) {
	        $this->out = new stdClass();
	        $this->_CORS = $_CORS;
	        if($this->_CORS) $this->allowCORS();
	        file_put_contents('upload.json', json_encode($_FILES, JSON_PRETTY_PRINT|JSON_UNESCAPED_UNICODE));

	        if(isset($_FILES['file']) && !is_array($_FILES['file']['name'])){
	            $this->handleFileUpload($_FILES['file']);
	            // var_dump($_FILES['file']);
	        }elseif(isset($_FILES['file'])){ // <input name="file" multiple="true" />
	            $len = count($_FILES['file']['name']);
	            for ($i=0; $i < $len; $i++) {
	                $file =  [
	                    "name" => $_FILES['file']['name'][$i], 
	                    "type" => $_FILES['file']['type'][$i], 
	                    "tmp_name" => $_FILES['file']['tmp_name'][$i], 
	                    "error" => $_FILES['file']['error'][$i], 
	                    "size" => $_FILES['file']['size'][$i]
	                ];
	                $this->handleFileUpload($file);
	                // print_r($file);
	            }
	        }else{
	            $this->out->status = 1;
	            $this->out->message = "no any file was uploaded.";
	        }
	    }

	    public function __call($key,$params){
	        //print("Call to undefined method ".get_class($this)."::".$key."()");
	        $subject = $this->{$key};
	        call_user_func_array($subject, $params);
	    }
	    protected function get_current_uri($withQuery=false){
	        $uri = @$_SERVER['REQUEST_URI'];
	        $path = @$_SERVER['PATH_INFO'];
	        return $this->get_base_uri().( $withQuery? $uri:$path);
	    }
	    protected function get_base_uri(){
	        $protocol = @$_SERVER['REQUEST_SCHEME'];
	        $hostName = $_SERVER['HTTP_HOST']; // $_SERVER["SERVER_NAME"]
	        $port = $_SERVER["SERVER_PORT"];
	        $base = $protocol.'://'.$hostName.($port? $port:"");
	        return $base;
	    }
	    protected function allowCORS(){
	      header("Access-Control-Allow-Credentials: true");
	      header("Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept");
	      header("Access-Control-Allow-Origin: *");
	      header("Access-Control-Allow-Methods: PUT,POST,GET,DELETE,OPTIONS");
	    }
	    protected function handleFileUpload($file){
	        $temp = $file["tmp_name"];
	        $name = $file["name"];
	        $isImage = in_array( $file["type"], $this->_imageFormats);
	        if( $isImage ){
	            $dest = $_SERVER["DOCUMENT_ROOT"]."/".$this->_uploadFolder."/".$name;
	            $root = str_replace( @$_SERVER["PATH_INFO"], "", $this->get_current_uri());
	            $url = $root."/".$this->_uploadFolder."/".$name;
	            $isCopy = copy( $temp, $dest);
	            $this->out->status = $isCopy? 0:1;
	            $this->out->url = $url;
	            $this->out->location = $url;
	            die();
	        }else{
	            $this->out->status = 1;
	            $this->out->message = "åªæ”¯æŒ ".join(",", $this->_imageFormats);
	            die();
	        }
	    }
	}

	$dc = new Dynamic(true);



## Web Components

React çš„ Web ç»„ä»¶æ˜¯ä¸ºäº†è§£å†³ä¸åŒçš„é—®é¢˜è€Œæ„å»ºçš„ï¼Œæ¯”å¦‚å’Œç¬¬ä¸‰æ–¹åº“é›†æˆã€‚React æä¾›äº†ä¸€ä¸ªå£°æ˜æ€§åº“ï¼Œä½¿ DOM ä¸æ•°æ®ä¿æŒåŒæ­¥ï¼Œè¿™ä¸¤ä¸ªç›®æ ‡æ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå¯ä»¥åœ¨ Web ç»„ä»¶ä¸­è‡ªç”±ä½¿ç”¨ Reactï¼Œä¹Ÿå¯ä»¥åœ¨ React ä¸­è‡ªç”±ä½¿ç”¨ Web ç»„ä»¶ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¯ä»¥ã€‚

å¤§å¤šæ•°ä½¿ç”¨ React çš„äººä¸ä½¿ç”¨ Web ç»„ä»¶ï¼Œä½†æ˜¯æ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ Web ç»„ä»¶ç¼–å†™çš„ç¬¬ä¸‰æ–¹ UI ç»„ä»¶æ—¶ã€‚

ç¤ºèŒƒä½¿ç”¨ Web ç»„ä»¶ï¼š

	class HelloMessage extends React.Component {
	  render() {
	    return <div>Hello <x-search>{this.props.name}</x-search>!</div>;
	  }
	}

	function BrickFlipbox() {
	  return (
	    <brick-flipbox class="demo">
	      <div>front</div>
	      <div>back</div>
	    </brick-flipbox>
	  );
	}

ä¸€ä¸ªå®¹æ˜“æ··æ·†çš„æ˜¯ï¼ŒWeb ç»„ä»¶ç›´æ¥ä½¿ç”¨ class æŒ‡å®šæ ·å¼ç±»å‹ï¼Œè€Œä¸æ˜¯ classNameã€‚

Web Components é€šå¸¸ç”¨æ¥æš´éœ² imperative API å‘½ä»¤å¼ APIï¼Œæ¯”å¦‚ `video` ç»„ä»¶å¯èƒ½æš´éœ² play() å’Œ pause() ç­‰å‡½æ•°ï¼Œè¦è®¿é—®å‘½ä»¤å¼ API éœ€è¦ä½¿ç”¨ä¸€ä¸ª ref å¼•ç”¨ DOM èŠ‚ç‚¹æ¥ç›´æ¥äº¤äº’ï¼Œè¦ä¸ç¬¬ä¸‰æ–¹çš„ Web Components äº¤äº’ï¼Œæœ€å¥½æ˜¯ç”¨ä¸€ä¸ª React ç»„ä»¶å»åŒ…è£… Web ç»„ä»¶ã€‚

Events emitted by a Web Component may not properly propagate through a React render tree. You will need to manually attach event handlers to handle these events within your React components.

Web ç»„ä»¶å‘å‡ºçš„äº‹ä»¶å¯èƒ½æ— æ³•é€šè¿‡ React æ¸²æŸ“è¿‡ç¨‹æ­£ç¡®ä¼ æ’­ï¼Œéœ€è¦æ‰‹åŠ¨é™„åŠ äº‹ä»¶å¤„ç†å‡½æ•°æ¥å¤„ç†ã€‚

ä¸ºå‰é¢ä½¿ç”¨çš„ Web ç»„ä»¶æä¾› React APIï¼š

	class XSearch extends HTMLElement {
	  connectedCallback() {
	    const mountPoint = document.createElement('span');
	    this.attachShadow({ mode: 'open' }).appendChild(mountPoint);

	    const name = this.getAttribute('name');
	    const url = 'https://www.google.com/search?q=' + encodeURIComponent(name);
	    ReactDOM.render(<a href={url}>{name}</a>, mountPoint);
	  }
	}
	customElements.define('x-search', XSearch);

è¿™é‡Œçš„ customElements æ˜¯ Node å¼€å‘ç¯å¢ƒæä¾›çš„è‡ªå®šä¹‰å…ƒç´ æ³¨å†Œæ¥å£ï¼š

	interface CustomElementRegistry {
	    define(name: string, constructor: CustomElementConstructor, options?: ElementDefinitionOptions): void;
	    get(name: string): any;
	    upgrade(root: Node): void;
	    whenDefined(name: string): Promise<void>;
	}

	declare var CustomElementRegistry: {
	    prototype: CustomElementRegistry;
	    new(): CustomElementRegistry;
	};



## Lifting State Up çŠ¶æ€æå‡
- Lifting State Up https://reactjs.org/docs/lifting-state-up.html
- [React ç»„ä»¶çŠ¶æ€æå‡](https://react.docschina.org/docs/lifting-state-up.html)


è¿™æ˜¯æœ€ç®€å•çš„å­ç»„ä»¶å‘çˆ¶çº§ä¼ é€’æ•°æ®çš„æ–¹æ³•ï¼Œæ˜¯åœ¨çˆ¶ç»„ä»¶ä¸­ç»™å­ç»„ä»¶å±æ€§ä¸­è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå³ React å®˜æ–¹æ–‡æ¡£ä¸­æ‰€è¯´çš„ç»„ä»¶çŠ¶æ€æå‡ Lifting State Upã€‚å®˜æ–¹æä¾›çš„ä¾‹å­æ¼”ç¤ºäº†æ‘„æ°åº¦ Celsius å’Œåæ°åº¦ Fahrenheit æ¢ç®—ï¼Œå­ç»„ä»¶é€šè¿‡è°ƒç”¨ onTemperatureChange è®¾ç½®çš„å›è°ƒå‡½æ•°å‘çˆ¶ç»„ä»¶æŠ¥å‘Šè¾“å…¥çš„æ¸©åº¦ã€‚

	const scaleNames = {
	  c: 'Celsius',
	  f: 'Fahrenheit'
	};

	function toCelsius(fahrenheit) {
	  return (fahrenheit - 32) * 5 / 9;
	}

	function toFahrenheit(celsius) {
	  return (celsius * 9 / 5) + 32;
	}

	function tryConvert(temperature, convert) {
	  const input = parseFloat(temperature);
	  if (Number.isNaN(input)) {
	    return '';
	  }
	  const output = convert(input);
	  const rounded = Math.round(output * 1000) / 1000;
	  return rounded.toString();
	}

	function BoilingVerdict(props) {
	  if (props.celsius >= 100) {
	    return <p>The water would boil.</p>;
	  }
	  return <p>The water would not boil.</p>;
	}

	class TemperatureInput extends React.Component {
	  constructor(props) {
	    super(props);
	    this.handleChange = this.handleChange.bind(this);
	  }

	  handleChange(e) {
	    this.props.onTemperatureChange(e.target.value);
	  }

	  render() {
	    const temperature = this.props.temperature;
	    const scale = this.props.scale;
	    return (
	      <fieldset>
	        <legend>Enter temperature in {scaleNames[scale]}:</legend>
	        <input value={temperature}
	               onChange={this.handleChange} />
	      </fieldset>
	    );
	  }
	}

	class Calculator extends React.Component {
	  constructor(props) {
	    super(props);
	    this.handleCelsiusChange = this.handleCelsiusChange.bind(this);
	    this.handleFahrenheitChange = this.handleFahrenheitChange.bind(this);
	    this.state = {temperature: '', scale: 'c'};
	  }

	  handleCelsiusChange(temperature) {
	    this.setState({scale: 'c', temperature});
	  }

	  handleFahrenheitChange(temperature) {
	    this.setState({scale: 'f', temperature});
	  }

	  render() {
	    const scale = this.state.scale;
	    const temperature = this.state.temperature;
	    const celsius = scale === 'f' ? tryConvert(temperature, toCelsius) : temperature;
	    const fahrenheit = scale === 'c' ? tryConvert(temperature, toFahrenheit) : temperature;

	    return (
	      <div>
	        <TemperatureInput
	          scale="c"
	          temperature={celsius}
	          onTemperatureChange={this.handleCelsiusChange} />
	        <TemperatureInput
	          scale="f"
	          temperature={fahrenheit}
	          onTemperatureChange={this.handleFahrenheitChange} />
	        <BoilingVerdict
	          celsius={parseFloat(celsius)} />
	      </div>
	    );
	  }
	}

	ReactDOM.render(
	  <Calculator />,
	  document.getElementById('root')
	);

å» CodePen äº¤äº’ä½“éªŒ https://codepen.io/gaearon/pen/WZpxpz?editors=0010



## Composition vs Inheritance ç»„åˆ vs ç»§æ‰¿
- [Composition vs Inheritance](https://react.docschina.org/docs/composition-vs-inheritance.html)
- [ECMAScript 6 modules: the final syntax](https://2ality.com/2014/09/es6-modules-final.html)
- [ä¸ä½¿ç”¨ ES6 è¯­æ³•](https://react.docschina.org/docs/react-without-es6.html)
- [React Ways1â€”â€”å‡½æ•°å³ç»„ä»¶](https://juejin.im/post/5c8b830f5188257e826ab716)

React æœ‰ä¸€ä¸ªå¼ºå¤§çš„ç»„åˆæ¨¡å‹ï¼Œå¹¶å»ºè®®ä½¿ç”¨ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿æ¥é‡ç”¨ç»„ä»¶ä¹‹é—´çš„ä»£ç ï¼Œ React ä¸­æœ‰ä¸€ä¸ªç»å…¸çš„å…¬å¼ï¼š
	
	const View = f(data)

è¿™ä¸ªå…¬å¼é‡Œæˆ‘ä»¬å¯ä»¥æå–å‡ºä¸¤ä¸ªç‰¹ç‚¹ï¼š è§†å›¾ç”±å‡½æ•°å®šä¹‰â€”â€”å‡½æ•°å³ç»„ä»¶ï¼Œè§†å›¾çš„å±•ç¤ºä¸ data æœ‰å…³â€”â€”æ•°æ®é©±åŠ¨ï¼ä¸€ä¸ªç»„ä»¶æ•°æ®æºæœ‰ä¸¤ä¸ªï¼š æ¥è‡ªå¤–éƒ¨çš„å±æ€§ props å’Œæ¥è‡ªå†…éƒ¨çš„çŠ¶æ€ stateã€‚ 

çˆ¶ç»„ä»¶å¯ä»¥çœ‹ä½œæ˜¯å®¹å™¨ï¼Œå…·ä½“å®ç°ä»€ä¹ˆåŠŸèƒ½äº¤ç”±å­ç»„ä»¶å»åšï¼Œè¿™å°±æ˜¯ç»„ä»¶ç»„åˆçš„ä¾¿åˆ©ä¹‹å¤„ï¼š

	function SplitPane(props) {
	  return (
	    <div className="SplitPane">
	      <div className="SplitPane-left">
	        {props.left}
	      </div>
	      <div className="SplitPane-right">
	        {props.right}
	      </div>
	    </div>
	  );
	}

	function App() {
	  return (
	    <SplitPane left={ <Contacts /> } right={ <Chat /> } />
	  );
	}

æœ‰æ—¶ï¼Œéœ€è¦ä¸“ç”¨åŠŸèƒ½çš„ç»„ä»¶ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å…¶ä»–ç»„ä»¶çš„ç‰¹ä¾‹ï¼Œæ¯”å¦‚è¯´ WelcomeDialog æ˜¯ Dialog çš„ç‰¹ä¾‹ã€‚ä½†åŸºæœ¬éƒ¨åˆ†åœ¨ Dialog ä¸­ï¼Œé€šè¿‡åˆæˆæ–°çš„å®ç°çš„ï¼Œç‰¹å®šåŠŸèƒ½çš„ç»„ä»¶é€šè¿‡å‘ˆç°ä¸€ä¸ªæ›´é€šç”¨çš„ç»„ä»¶ï¼Œå¹¶ç”¨ props é…ç½®å®ƒï¼š

	function Dialog(props) {
	  return (
	    <FancyBorder color="blue">
	      <h1 className="Dialog-title">
	        {props.title}
	      </h1>
	      <p className="Dialog-message">
	        {props.message}
	      </p>
	    </FancyBorder>
	  );
	}

	function WelcomeDialog() {
	  return (
	    <Dialog
	      title="Welcome"
	      message="Thank you for visiting our spacecraft!" />
	  );
	}

	class SignUpDialog extends React.Component {
	  constructor(props) {
	    super(props);
	    this.handleChange = this.handleChange.bind(this);
	    this.handleSignUp = this.handleSignUp.bind(this);
	    this.state = {login: ''};
	  }

	  render() {
	    return (
	      <Dialog title="Mars Exploration Program"
	              message="How should we refer to you?">
	        <input value={this.state.login}
	               onChange={this.handleChange} />
	        <button onClick={this.handleSignUp}>
	          Sign Me Up!
	        </button>
	      </Dialog>
	    );
	  }

	  handleChange(e) {
	    this.setState({login: e.target.value});
	  }

	  handleSignUp() {
	    alert(`Welcome aboard, ${this.state.login}!`);
	  }
	}

å£°æ˜å¼ç¼–ç¨‹ Declarative Programmingï¼Œä¸å‘½ä»¤å¼ç¼–ç¨‹ç›¸å¯¹ç«‹ï¼ŒImperative vs Declarativeï¼Œå£°æ˜å¼ç¼–ç¨‹æ›´åŠ æ³¨é‡äºè¡¨ç°ä»£ç çš„é€»è¾‘ï¼Œè€Œä¸æ˜¯æè¿°å…·ä½“çš„è¿‡ç¨‹ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å£°æ˜å¼ç¼–ç¨‹çš„å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šçš„å‘ŠçŸ¥è®¡ç®—æœºæˆ‘ä»¬éœ€è¦ä»€ä¹ˆâ€”â€”æ¯”å¦‚è°ƒç”¨ä¸€ä¸ªå…·ä½“çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯ç”¨ä¸€äº›æŠ½è±¡çš„å…³é”®å­—æ¥ä¸€è¡Œä¸€è¡Œçš„å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚
åœ¨è¿™ä¸ªæ¨¡å‹ä¸‹ï¼Œæ•°æ®æ˜¯ä¸å¯å˜çš„ï¼Œè¿™å°±é¿å…å¦‚æ­»é”ç­‰å˜é‡æ”¹å˜å¸¦æ¥çš„é—®é¢˜ã€‚

å¦‚æ±‚ä¸€ä¸ª list é‡Œæ‰€æœ‰å€¼çš„å’Œä¾‹å­ï¼Œå¦‚ä¸‹ï¼š

	// å‘½ä»¤å¼ç¼–ç¨‹
	var numbers = [1,2,3,4,5]
	var total = 0;
	for(var i = 0; i < numbers.length; i++) {
	  total += numbers[i]
	}
	console.log(total) //=> 15
	
	 
	// å£°æ˜å¼ç¼–ç¨‹
	var numbers = [1,2,3,4,5]
	var total = numbers.reduce(function(sum, n) {
	  return sum + n
	}, 0); // 0æ˜¯åˆå§‹å€¼
	console.log(total); //=> 15


ç®€å•æ€»ç»“ä¸€ä¸‹å£°æ˜å¼ç¼–ç¨‹çš„ä¼˜ç‚¹ï¼š

+ å¤ç”¨æ€§ï¼šå°è£…æ˜¯å£°æ˜å¼ç¼–ç¨‹çš„ä¸€å¤§è¦ç‚¹ï¼Œè€Œå°è£…çš„ä¸»è¦ç›®çš„ä¹‹ä¸€å°±æ˜¯å¤ç”¨ä»£ç 
+ å®‰å…¨æ€§ï¼šæ˜ç¡®å…³æ³¨ç‚¹ï¼Œçœå»äº†ä¸å¿…è¦çš„å˜é‡å£°æ˜å’Œå¯¹è±¡å¼•ç”¨ï¼Œé˜²æ­¢å‰¯ä½œç”¨ã€‚
+ å¯è¯»æ€§ï¼šæ–¹æ³•çš„è°ƒç”¨ä»£æ›¿ç›´æ¥ç¼–å†™æµç¨‹ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç›´è§‚
+ é€»è¾‘æ€§ï¼šæ˜¾ç„¶é€šè¿‡è¯­ä¹‰åŒ–çš„æ–¹æ³•åèƒ½æ›´åŠ æ¸…æ¥šçš„ä½“ç°ä»£ç çš„é€»è¾‘


React è¿™ç§å¯ä»¥ä»»æ„ç»„åˆç»„ä»¶çš„ JSX èƒ½åŠ›ååˆ†å¼ºå¤§ï¼ŒåŒæ—¶ TypeScript çš„å®Œå¤‡ç±»åŠŸèƒ½å¯ä»¥å¾ˆä¾¿åˆ©çš„ç»§æ‰¿ç»„ä»¶ï¼Œä½†æ¨èä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿æ¥å®ç°ç»„ä»¶é—´çš„ä»£ç é‡ç”¨ã€‚

React å…ƒç´ æœ¬è´¨å°±æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥å‡½æ•°å¼ç»„ä»¶å’Œ Component ç»„ä»¶æ²¡æœ‰æ ¹æœ¬å·®åˆ«ï¼Œè¿™äº›å…ƒç´ å¯ä»¥å½“ä½œ props çš„å±æ€§ä¼ é€’ç»™åµŒå¥—ç»„ä»¶ï¼Œå°±åƒå…¶ä»–æ•°æ®ä¸€æ ·ä¼ é€’ã€‚å¦‚äº†è§£è¿‡ Vue ç»„ä»¶çš„æ’æ§½ slot åŠŸèƒ½ï¼Œè¿™ç§æ–¹æ³•å…¶å®æ›´ç®€å•æ˜“ç”¨äº†ï¼Œä½ å¯ä»¥å°†ä»»ä½•ä¸œè¥¿ä½œä¸º props è¿›è¡Œä¼ é€’ï¼Œç„¶ååœ¨ç»„ä»¶å†…éƒ¨æ”¾ç½®äºä»»æ„ä½ç½®ã€‚å¯¹äºç»„ä»¶å†…åµŒçš„å…ƒç´ ï¼Œåˆ™ä¼šé€šè¿‡ props.children ä¼ å…¥ã€‚

åœ¨ Facebookï¼Œæˆç™¾ä¸Šåƒä¸ªç»„ä»¶ä¸­ä½¿ç”¨ Reactï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ç»§æ‰¿æ¥æ„å»ºç»„ä»¶å±‚æ¬¡çš„æƒ…å†µã€‚Props å’Œç»„åˆä¸ºä½ æä¾›äº†æ¸…æ™°è€Œå®‰å…¨åœ°å®šåˆ¶ç»„ä»¶å¤–è§‚å’Œè¡Œä¸ºçš„çµæ´»æ–¹å¼ã€‚æ³¨æ„ï¼šç»„ä»¶å¯ä»¥æ¥å—ä»»æ„ propsï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒReact å…ƒç´ ä»¥åŠå‡½æ•°ã€‚

å¦‚æœè¦åœ¨ç»„ä»¶é—´å¤ç”¨é UI çš„åŠŸèƒ½ï¼Œå»ºè®®å°†å…¶æå–ä¸ºä¸€ä¸ªå•ç‹¬çš„ JavaScript æ¨¡å—ï¼Œå¦‚å‡½æ•°ã€å¯¹è±¡æˆ–è€…ç±»ã€‚ç»„ä»¶å¯ä»¥ç›´æ¥å¼•å…¥ï¼ˆimportï¼‰è€Œæ— éœ€é€šè¿‡ extend ç»§æ‰¿å®ƒä»¬ã€‚

ç»§æ‰¿ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿä»¥æˆ‘çš„å®è·µç»éªŒï¼Œè¿‡æ¸¡ä½¿ç”¨ç»§æ‰¿ï¼Œè™½ç„¶ç»™ç¼–ç å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®¹æ˜“å¯¼è‡´ä»£ç å¤±æ§ï¼Œç»„ä»¶è†¨èƒ€ï¼Œé™ä½ç»„ä»¶çš„å¤ç”¨æ€§ã€‚

æ¯”å¦‚ï¼šæœ‰ä¸€ä¸ªåˆ—è¡¨ç»„ä»¶ï¼Œå«å®ƒ ListView å§ï¼Œå¯ä»¥ä¸Šä¸‹æ»šåŠ¨æ˜¾ç¤ºä¸€ä¸ª item é›†ï¼š

- çªç„¶æœ‰ä¸€å¤©éœ€æ±‚å˜äº†ï¼ŒPM è¯´ï¼Œæˆ‘è¦è¿™ä¸ª ListView èƒ½åƒ iOS é‚£æ ·æœ‰ä¸ªå›å¼¹æ•ˆæœã€‚
- å¥½ï¼Œç”¨ç»§æ‰¿å¯¹è¿™ä¸ª ListViewè¿›è¡Œæ‰©å±•ï¼ŒåŠ å…¥äº†å›å¼¹æ•ˆæœï¼Œä»»åŠ¡ closedã€‚
- ç¬¬äºŒå¤©PMæ‰¾ä¸Šé—¨æ¥äº†ï¼Œå¸Œæœ›æ‰€æœ‰ä¸Šä¸‹æ»šåŠ¨çš„åœ°æ–¹éƒ½å¯ä»¥æ”¯æŒå›å¼¹æ•ˆæœï¼Œè¿™æ—¶å€™å°±æ‡µé€¼å•¦ï¼Œæ€ä¹ˆåŠï¼ŸæŠŠ ListView ä¸­å›å¼¹æ•ˆæœçš„ä»£ç  copy ä¸€éï¼Ÿè¿™å°±å’Œ DRY åŸåˆ™ç›¸æ‚–äº†ä¸æ˜¯ï¼Œè€Œä¸”æœ‰å¯èƒ½å—åˆ°å…¶ä»–åœ°æ–¹ä»£ç çš„å½±å“ï¼Œå¤„ç†å›å¼¹æ•ˆæœç•¥æœ‰ä¸åŒï¼Œè¦æ˜¯æœ‰ä¸€å¤©PMå¸Œæœ›å¯¹è¿™ä¸ªå›å¼¹æ•ˆæœåšå‡çº§ï¼Œé‚£å°±æœ‰å¾—æ”¹å•¦ã€‚åº”å¯¹è¿™ç§åœºæ™¯ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯å•¥ï¼Ÿ

ç”¨ç»„åˆï¼Œå°è£…ä¸€ä¸ªå¸¦å›å¼¹æ•ˆæœçš„ Scrollerï¼ŒListView çœ‹æˆæ˜¯ Scroller å’Œ item å®¹å™¨ç»„ä»¶çš„ç»„åˆï¼Œå…¶ä»–åœ°æ–¹éœ€è¦è¦ç”¨åˆ°æ»šåŠ¨çš„ï¼Œç›´æ¥å¥—ä¸€ä¸ª Scrollerï¼Œä»¥åä¸ç®¡å›å¼¹æ•ˆæœæ€ä¹ˆå˜ï¼Œæˆ‘åªè¦ç»´æŠ¤è¿™ä¸ª Scroller å°±å¥½äº†ã€‚å½“ç„¶ï¼Œæœ€ç†æƒ³çš„ï¼ŒæŠŠå›å¼¹æ•ˆæœä¹Ÿåšæˆä¸€ä¸ªç»„ä»¶ SpringBackEffectï¼Œä» Scroller åˆ†ç¦»å‡ºæ¥ï¼Œè¿™æ ·ï¼Œéœ€è¦ç”¨å›å¼¹æ•ˆæœçš„åœ°æ–¹å°±åŠ ä¸Š SpringBackEffect ç»„ä»¶å°±å¥½äº†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç»„åˆä¼˜å…ˆäºç»§æ‰¿çš„åŸå› ã€‚

å‡½æ•°ç»„ä»¶æ–¹å¼å’Œ React.Component ç»„ä»¶ç»§æ‰¿æ–¹å¼å¯ä»¥æ··åˆä½¿ç”¨ï¼Œè¿™ä¸¤ç§æ–¹å¼çš„å·®å¼‚å°±åœ¨äºå¯¼å‡ºçš„å‡½æ•°ç»„ä»¶æ—¶ä¸€ä¸ªè¿”å›è§†å›¾çš„ä¸»å‡½æ•°ï¼Œè€Œå¯¼å‡ºçš„ React.Component ç»„ä»¶åˆ™æ—¶åœ¨å…¶ `render()` æˆå‘˜æ–¹æ³•è¿”å›è§†å›¾ã€‚ç»„ä»¶çš„ `props` çš„ä¼ å…¥å£åˆ†åˆ«åœ¨ä¸»å‡½æ•°å’Œ Component æ„é€ å™¨ï¼Œå¹¶ä¸”åœ¨æ„é€ å™¨ä¸­å¿…é¡»å…ˆè°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ `super(props)`ã€‚

React 16 ç‰ˆæœ¬ä»¥åï¼Œå®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨ createclass çš„æ–¹å¼åˆ›å»ºç»„ä»¶äº†ï¼ŒåŒæ—¶ä¹Ÿå–æ¶ˆäº†ä»¥å‰ Mixin é‚£ä¸€å¥—ä¾µå…¥å¼å¤ç”¨ä»£ç çš„åšæ³•ï¼Œè½¬è€Œæ¨èå¤§å®¶ä½¿ç”¨é«˜é˜¶å‡½æ•°çš„æ–¹å¼æ¥å®ç°å¯¹ä»£ç çš„å¤ç”¨ã€‚ç»§æ‰¿çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªç»„ä»¶å¯ä»¥ç»§æ‰¿ä¸¤ä¸ªçˆ¶ç±» React.Component å’Œ React.PureComponentã€‚ä¸¤è€…é™¤äº†åœ¨ shouldComponentUpdate æ–¹æ³•çš„å®ç°é€»è¾‘ä¸Šä¸ä¸€æ ·ï¼Œå…¶ä»–è¡¨ç°éƒ½ä¸€æ ·ï¼ŒPureComponent ä½¿ç”¨äº† propsã€state çš„æµ…æ¯”è¾ƒã€‚

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹©ç»§æ‰¿ React.PureComponent ï¼Œå¯ä»¥ä¼˜åŒ–æˆ‘ä»¬çš„ç»„ä»¶æ€§èƒ½ï¼Œä¸è¿‡ç‰¹æ®Šæ—¶å€™ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ç»§æ‰¿ React.Componentï¼Œç„¶åè‡ªå·±å»å®ç° shouldComponentUpdate æ–¹æ³•çš„é€»è¾‘éƒ¨åˆ†ã€‚

TypeScript ç±»æˆå‘˜é»˜è®¤æ˜¯ public è®¿é—®è®¸å¯ï¼Œå¯ä»¥ä½¿ç”¨ protected å’Œ privateï¼Œstatic ä¿®é¥°ç¬¦å®šä¹‰é™æ€ç±»æˆå‘˜ã€‚å¦‚æœä½ è¿˜æœªä½¿ç”¨è¿‡ ES6ï¼Œä½ å¯ä»¥ä½¿ç”¨ create-react-class æ¨¡å—ï¼ŒES6 ä¸­çš„ class ä¸ createReactClass() æ–¹æ³•ååˆ†ç›¸ä¼¼ï¼Œä½†æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«å€¼å¾—æ³¨æ„ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ [ä¸ä½¿ç”¨ ES6 è¯­æ³•]ã€‚

	var createReactClass = require('create-react-class');
	var Greeting = createReactClass({
	  render: function() {
	    return <h1>Hello, {this.props.name}</h1>;
	  }
	});


é€šè¿‡å…³é”®å­— `import` å¯¼å…¥çš„æ¨¡å—ä¼šè‡ªåŠ¨å®šä½åˆ° index æ–‡ä»¶ï¼Œä¸éœ€è¦å¡«å†™è¿™éƒ¨åˆ†ã€‚å¦‚æœæ¨¡å—åå­—ä¸æ˜¯ index åˆ™éœ€è¦å¡«å†™æ–‡ä»¶åï¼Œæ‰©å±•åéƒ¨åˆ†å¯ä»¥çœç•¥ä¸å†™ã€‚è¿™é‡Œè§£æä»¥ä¸‹ `import` è¿™æ¡æŒ‡ä»¤ï¼š

	import React, {Component} from 'react';

è¿™æ¡æŒ‡ä»¤æ¶‰åŠåˆ°é»˜è®¤å¯¼å…¥å’Œå‘½åå¯¼å…¥ï¼Œé»˜è®¤å¯¼å…¥å¯¹åº”å¯¼å‡ºå†…å®¹å¦‚ä¸‹ï¼š

	import React from 'react'; // export default xxx

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¼å…¥æ—¶å¯ä»¥ä¸ºå®ƒæŒ‡å®šä»»æ„åç§°ï¼Œå¯¼å‡ºçš„ç¬¦å·å°±æ˜¯æ¨¡å—ä¸­ `export default` å¯¹åº”çš„é‚£ä¸ªã€‚è€Œå¯¹äº Reactï¼Œå®ƒéœ€è¦åœ¨ Babel ä¸­ä½¿ç”¨ï¼Œå·²ç»çº¦å®šä½¿ç”¨è¿™ä¸ªåå­—äº†ï¼Œä¸èƒ½è¿›è¡Œæ›´æ”¹ã€‚

è€Œå‘½åå¯¼å…¥åˆ™éœ€è¦åŠ èŠ±æ‹¬å·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `as` æ¥æ”¹å :

	import { A, A as Any } from './A'; // export const A = 42 or module.exports = {A:42}




## Thinking In React
- 21 Web Dev Tips for 2021 ğŸ‡ https://scrimba.com/learn/21tips


React æ˜¯ç”¨ JavaScript æ„å»ºå¤§å‹ã€å¿«é€Ÿ Web åº”ç”¨ç¨‹åºçš„ä¸€ç§æ–¹æ¡ˆï¼Œå¯¹äº Facebook å’Œ Instagram æ¥è®²æ˜¯æœ€é‡è¦çš„æŠ€æœ¯ï¼Œå…¶è¡¨ç°ä¹Ÿéå¸¸å‡ºè‰²ã€‚

React çš„è®¸å¤šé‡è¦éƒ¨åˆ†ä¹‹ä¸€ï¼Œæ˜¯å®ƒå¦‚ä½•è®©ä½ åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶æ€è€ƒå®ƒä»¬ï¼Œè¿™é‡Œå°†ä»¥ä¸€ä¸ªäº§å“æœç´¢é¢æ¿ä½œä¸ºä¸€ä¸ªåˆ†ææ¡ˆä¾‹ã€‚

Start With A Mock ä»æ¨¡ä»¿å…¥æ‰‹ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª JSON API å’Œ UI è®¾è®¡ï¼Œå¹¶ä¸” API å¯ä»¥è¿”å›å¦‚ä¸‹æ•°æ®ï¼š

	[
	  {category: "Sporting Goods", price: "$49.99", stocked: true, name: "Football"},
	  {category: "Sporting Goods", price: "$9.99", stocked: true, name: "Baseball"},
	  {category: "Sporting Goods", price: "$29.99", stocked: false, name: "Basketball"},
	  {category: "Electronics", price: "$99.99", stocked: true, name: "iPod Touch"},
	  {category: "Electronics", price: "$399.99", stocked: false, name: "iPhone 5"},
	  {category: "Electronics", price: "$199.99", stocked: true, name: "Nexus 7"}
	];

ä»¥ä¸‹å°†åˆ† 5 æ­¥å®Œæˆä¸€ä¸ªæ¨¡å‹åº”ç”¨çš„è®¾è®¡å¼€å‘ï¼š

- Step 1: åˆ†è§£ UI ä¸ºç»„ä»¶å±‚æ¬¡ç»“æ„ Break The UI Into A Component Hierarchy
- Step 2: ä¸ä½¿ç”¨çŠ¶æ€å»ºç«‹ä¸€ä¸ªé™æ€ç»„ä»¶ç‰ˆæœ¬ Build A Static Version in React
- Step 3: ç¡®å®šä¸€ä¸ªæœ€å°ä½†åŠŸèƒ½å®Œå¤‡çš„çŠ¶æ€ç®¡ç† Identify The Minimal (but complete) Representation Of UI State
- Step 4: ç¡®å®š State æ”¾åœ¨ä»€ä¹ˆç»„ä»¶ä¸Šè¿›è¡ŒçŠ¶æ€ç®¡ç† Identify Where Your State Should Live
- Step 5: æ·»åŠ åå‘çš„æ•°æ®æµ Add Inverse Data Flow
- And Thatâ€™s It

ä¸‹é¢æ­£å¼å¼€å§‹ã€‚

### ğŸ‘‰ Step 1: Break The UI Into A Component Hierarchy

åœ¨ UI ç•Œé¢çš„æ¯ä¸ªç»„ä»¶å‘¨å›´ç»˜åˆ¶æ¡†ï¼Œå¹¶ç»™å‡ºå®ƒä»¬çš„æ‰€æœ‰åç§°ã€‚å¦‚æœä½ å’Œä¸€ä¸ªè®¾è®¡å¸ˆä¸€èµ·å·¥ä½œï¼Œä»–ä»¬å¯èƒ½å·²ç»èµ·å¥½åå­—äº†ï¼Œæ‰€ä»¥å»å’Œä»–ä»¬è°ˆè°ˆå§ï¼ä»–ä»¬çš„ Photoshop å›¾å±‚åç§°æœ€ç»ˆä¼šå¯èƒ½æˆä¸ºæ‚¨çš„ React ç»„ä»¶çš„åç§°ï¼

å¦‚ä½•ç¡®å®šæŸéƒ¨åˆ† UI ç»„æˆç»„ä»¶å‘¢ï¼ŸæŠ€æœ¯ä¸Šåº”è¯¥ä»¥å•ä¸€åŠŸèƒ½ä¸ºåŸåˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç»„ä»¶åœ¨ç†æƒ³æƒ…å†µä¸‹åº”è¯¥åªåšä¸€ä»¶äº‹ã€‚å¦‚æœå®ƒçš„åŠŸèƒ½ä¿®æ”¹å¢é•¿äº†ï¼Œå®ƒåº”è¯¥åˆ†è§£æˆæ›´å°çš„å­ç»„ä»¶ã€‚

ç”±äºæ‚¨ç»å¸¸å‘ç”¨æˆ·æ˜¾ç¤º JSON æ•°æ®æ¨¡å‹ï¼Œå› æ­¤æ‚¨ä¼šå‘ç°ï¼Œå¦‚æœæ‚¨çš„æ¨¡å‹æ„å»ºæ­£ç¡®ï¼ŒUI ä»¥åŠç»„ä»¶ç»“æ„å°†å¾ˆå¥½åœ°åæ˜ å‡ºæ¥ã€‚è¿™æ˜¯å› ä¸º UI å’Œæ•°æ®æ¨¡å‹å€¾å‘äºéµå¾ªç›¸åŒçš„ä¿¡æ¯ä½“ç³»ç»“æ„ã€‚å°† UI åˆ’åˆ†ä¸ºå¤šä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶ä¸æ•°æ®æ¨¡å‹çš„ä¸€éƒ¨åˆ†ç›¸åŒ¹é…ã€‚

è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­æœ‰äº”ä¸ªç»„ä»¶ï¼Œã€‚æˆ‘ä»¬å·²ç»å°†æ¯ä¸ªç»„ä»¶ä»£è¡¨çš„æ•°æ®æ–œä½“åŒ–äº†ã€‚

- FilterableProductTable æ•´ä¸ªé¢æ¿ï¼›
- SearchBar æœç´¢ä¾‹ï¼Œæ¥æ”¶æ‰€æœ‰ç”¨æˆ·çš„è¾“å…¥ï¼›
- ProductTable äº§å“åˆ—è¡¨ï¼Œæ˜¾ç¤ºæŒ‰ç”¨æˆ·è¾“å…¥è¿‡æ»¤å¥½çš„ä¿¡æ¯ï¼›
- ProductCategoryRow äº§å“åˆ†ç±»ï¼Œæ˜¾ç¤ºåˆ†ç±»æ ‡é¢˜ï¼›
- ProductRow äº§å“ä¿¡æ¯ï¼Œæ¯è¡Œæ˜¾ç¤ºä¸€ä¸ªäº§å“ï¼›

ProductTable è¡¨å¤´åŒ…å« Name å’Œ Price æ ‡ç­¾ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯æ˜¯å±æ€§äº§å“çš„ï¼Œæœ¬ä¸æ˜¯å®ƒè‡ªå·±ç»„ä»¶çš„ã€‚è¿™æ˜¯ä¸€ä¸ªåå¥½çš„é—®é¢˜ï¼Œä»»ä½•ä¸€ç§æ–¹å¼éƒ½æœ‰ç†ç”±ã€‚å¯¹äºæœ¬ä¾‹ï¼Œæˆ‘ä»¬å°†å…¶ä½œä¸º ProductTable çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒæ˜¯ ProductTable è´Ÿè´£å‘ˆç°æ•°æ®é›†åˆçš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªå¤´å˜å¾—å¾ˆå¤æ‚ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¦æ·»åŠ ç”¨äºæ’åºçš„å¯ç¤ºï¼Œé‚£ä¹ˆè®©å®ƒæˆä¸ºè‡ªå·±çš„ ProductTableHeader ç»„ä»¶è‚¯å®šæ˜¯æœ‰æ„ä¹‰çš„ã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»åœ¨ mock ä¸­æ ‡è¯†äº†ç»„ä»¶ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬å°†å®ƒä»¬æ’åˆ—æˆä¸€ä¸ªå±‚æ¬¡ç»“æ„ï¼Œç»„ä»¶åœ¨ç»„ä»¶çš„å±‚æ¬¡ç»“æ„ä¸­æ˜¾ç¤ºä¸ºå­ç»„ä»¶ï¼š

	<FilterableProductTable />
	  +-- <SearchBar />
	  +-- <ProductTable />
	        +--  <ProductCategoryRow />
	        +--  <ProductRow />



### ğŸ‘‰ Step 2: Build A Static Version in React

åˆ›å»ºä¸€ä¸ªé™æ€ç‰ˆæœ¬ï¼Œä¸å«çŠ¶æ€ç®¡ç†çš„ç»„ä»¶å®ç°ï¼š

	class ProductCategoryRow extends React.Component {
	  render() {
	    const category = this.props.category;
	    return (
	      <tr>
	        <th colSpan="2"> {category} </th>
	      </tr>
	    );
	  }
	}

	class ProductRow extends React.Component {
	  render() {
	    const product = this.props.product;
	    const name = product.stocked ?
	      product.name :
	      <span style={{color: 'red'}}> {product.name} </span>;

	    return (
	      <tr>
	        <td>{name}</td>
	        <td>{product.price}</td>
	      </tr>
	    );
	  }
	}

	class ProductTable extends React.Component {
	  render() {
	    const rows = [];
	    let lastCategory = null;
	    
	    this.props.products.forEach((product) => {
	      if (product.category !== lastCategory) {
	        rows.push(
	          <ProductCategoryRow category={product.category} key={product.category} />
	        );
	      }
	      rows.push(
	        <ProductRow product={product} key={product.name} />
	      );
	      lastCategory = product.category;
	    });

	    return (
	      <table>
	        <thead>
	          <tr>
	            <th>Name</th>
	            <th>Price</th>
	          </tr>
	        </thead>
	        <tbody>{rows}</tbody>
	      </table>
	    );
	  }
	}

	class SearchBar extends React.Component {
	  render() {
	    return (
	      <form>
	        <input type="text" placeholder="Search..." />
	        <p> <input type="checkbox" /> {' '} Only show products in stock </p>
	      </form>
	    );
	  }
	}

	class FilterableProductTable extends React.Component {
	  render() {
	    return (
	      <div>
	        <SearchBar />
	        <ProductTable products={this.props.products} />
	      </div>
	    );
	  }
	}


	const PRODUCTS = [
	  {category: 'Sporting Goods', price: '$49.99', stocked: true, name: 'Football'},
	  {category: 'Sporting Goods', price: '$9.99', stocked: true, name: 'Baseball'},
	  {category: 'Sporting Goods', price: '$29.99', stocked: false, name: 'Basketball'},
	  {category: 'Electronics', price: '$99.99', stocked: true, name: 'iPod Touch'},
	  {category: 'Electronics', price: '$399.99', stocked: false, name: 'iPhone 5'},
	  {category: 'Electronics', price: '$199.99', stocked: true, name: 'Nexus 7'}
	];
	 
	ReactDOM.render(
	  <FilterableProductTable products={PRODUCTS} />,
	  document.getElementById('container')
	);


åœ¨çº¿è¿è¡Œ https://codepen.io/gaearon/pen/BwWzwm

ç°åœ¨æ‚¨å·²ç»æœ‰äº†ç»„ä»¶å±‚æ¬¡ç»“æ„ï¼Œé™æ€ç‰ˆæœ¬æ˜¯æ„å»ºåº”ç”¨æœ€ç®€å•çš„æ–¹æ³•ï¼Œé‡‡ç”¨æ•°æ®æ¨¡å‹å¹¶å‘ˆç° UI ä½†æ²¡æœ‰äº¤äº’æ€§çš„ç‰ˆæœ¬ã€‚æœ€å¥½å°†è¿™äº›è¿‡ç¨‹è§£è€¦ï¼Œå› ä¸ºæ„å»ºé™æ€ç‰ˆæœ¬åªéœ€è¦å¤§é‡çš„æ•²ä»£ç è¾“å…¥è€Œä¸éœ€è¦æ€è€ƒï¼Œè€Œæ·»åŠ äº¤äº’æ€§åˆ™éœ€è¦å¤§é‡çš„æ€è€ƒè€Œä¸éœ€è¦å¤§é‡çš„è¾“å…¥ã€‚

è¦æ„å»ºå‘ˆç°æ•°æ®æ¨¡å‹çš„åº”ç”¨ç¨‹åºçš„é™æ€ç‰ˆæœ¬ï¼Œéœ€è¦æ„å»ºé‡ç”¨å…¶ä»–ç»„ä»¶å¹¶ä½¿ç”¨ç»„ä»¶å±æ€§ä¼ é€’æ•°æ®çš„ç»„ä»¶ï¼ŒProps æ˜¯å°†æ•°æ®ä»çˆ¶å¯¹è±¡ä¼ é€’ç»™å­å¯¹è±¡çš„ä¸€ç§æ–¹å¼ã€‚å¦‚æœæ‚¨ç†Ÿæ‚‰çŠ¶æ€çš„æ¦‚å¿µï¼Œå°±ä¸è¦ä½¿ç”¨ State æ¥æ„å»ºè¿™ä¸ªé™æ€ç‰ˆæœ¬ã€‚çŠ¶æ€ä»…ä¿ç•™ç”¨äºäº¤äº’ï¼Œå³éšæ—¶é—´å˜åŒ–çš„æ•°æ®ï¼Œå¯¹äºä¸€ä¸ªé™æ€ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼Œä½ ä¸éœ€è¦å®ƒã€‚

æ‚¨å¯ä»¥è‡ªé¡¶å‘ä¸‹æˆ–è‡ªä¸‹è€Œä¸Šæ„å»ºï¼ŒTop-Down vs Buttom-Upï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä»æ„å»ºå±‚æ¬¡ç»“æ„ä¸­é¡¶å±‚ç»„ä»¶å¼€å§‹ï¼Œå³ä» FilterableProductTable å¼€å§‹ï¼Œä¹Ÿå¯ä»¥ä»æ„å»ºå±‚æ¬¡ç»“æ„ä¸­è¾ƒä½çš„ç»„ä»¶å¼€å§‹ ProductRowã€‚åœ¨æ›´ç®€å•çš„ä¾‹å­ä¸­ï¼Œè‡ªé¡¶å‘ä¸‹é€šå¸¸æ›´å®¹æ˜“ï¼Œè€Œåœ¨æ›´å¤§çš„é¡¹ç›®ä¸­ï¼Œè‡ªä¸‹è€Œä¸Šå’Œåœ¨æ„å»ºæ—¶ç¼–å†™æµ‹è¯•æ›´å®¹æ˜“ã€‚

åœ¨è¿™ä¸€æ­¥ç»“æŸæ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªå¯é‡ç”¨ç»„ä»¶åº“ï¼Œè¿™äº›ç»„ä»¶å‘ˆç°æ‚¨çš„æ•°æ®æ¨¡å‹ã€‚ç»„ä»¶å°†åªæœ‰ render() æ–¹æ³•ï¼Œå› ä¸ºè¿™æ˜¯åº”ç”¨ç¨‹åºçš„é™æ€ç‰ˆæœ¬ã€‚å±‚æ¬¡ç»“æ„é¡¶éƒ¨çš„ç»„ä»¶ FilterableProductTable å°†æŠŠæ•°æ®æ¨¡å‹ä½œä¸ºä¸€ä¸ª Props ä¼ é€’ç»™å­ç»„ä»¶ã€‚å¦‚æœæ‚¨æ›´æ”¹äº†åŸºç¡€æ•°æ®æ¨¡å‹å¹¶è°ƒç”¨ ReactDOM.render() å†æ¬¡æ›´æ–° UIã€‚ç»“åˆ State çŠ¶æ€ç®¡ç†å¯ä»¥çœ‹åˆ° UI æ˜¯å¦‚ä½•æ›´æ–°çš„ï¼Œä»¥åŠåœ¨ä½•å¤„è¿›è¡Œæ›´æ”¹ã€‚React çš„å•å‘æ•°æ®æµï¼Œä¹Ÿç§°ä¸ºå•å‘ç»‘å®šï¼Œone-way data flow æˆ–è€… one-way bindingï¼Œä½¿æ‰€æœ‰å†…å®¹ä¿æŒæ¨¡å—åŒ–å’Œå¿«é€Ÿã€‚

ç®€å•æ¥è¯´ï¼ŒProps vs Stateï¼Œè¿™æ˜¯ä¸¤ç§æ•°æ®æ¨¡å‹ï¼ŒProps è¡¨ç¤ºåªè¯»çš„å±æ€§æ•°æ®ï¼Œç”±ä¸Šå±‚å¾€ä¸‹å±‚ä¼ é€’ï¼ŒState è¡¨ç¤ºçŠ¶æ€ç®¡ç†æ•°æ®ï¼Œå¯ä»¥è¯»å†™ï¼Œä½†ä¸èƒ½ç›´æ¥å†™ï¼Œéœ€è¦é€šè¿‡ setState() æ–¹æ³•æ¥å†™å…¥ï¼Œè¿™æ ·åš React æ‰èƒ½æ­£ç¡®å¤„ç†ç»„ä»¶çŠ¶æ€åŠè§¦å‘é‡æ–°æ¸²æŸ“ã€‚



### ğŸ‘‰ Step 3: Identify The Minimal Representation Of UI State

è¦ä½¿ UI å…·æœ‰äº¤äº’æ€§ï¼Œéœ€è¦èƒ½å¤Ÿè§¦å‘å¯¹åº•å±‚æ•°æ®æ¨¡å‹çš„æ›´æ”¹ï¼Œç”¨çŠ¶æ€ State å’Œ setState() æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

è¦æ­£ç¡®æ„å»ºåº”ç”¨ç¨‹åºï¼Œé¦–å…ˆéœ€è¦è€ƒè™‘åº”ç”¨ç¨‹åºéœ€è¦çš„æœ€å°å¯å˜çŠ¶æ€é›†ã€‚è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œä¸è¦ DRY Code - Donâ€™t Repeat Yourselfï¼Œé‡å¤å†™é‡å¤è¿‡çš„ä»£ç ï¼Œåªä¼šå¢åŠ æ¶ˆè€—åŒæ—¶å¢åŠ å‡ºé”™çš„æ¦‚ç‡ã€‚
å¯¹äºæ¶ˆé™¤é‡å¤çš„ä»£ç æœ‰ä¸€ä¸ªä¸‰æ¬¡æ³•åˆ™ Rule of Threeï¼š

- ç¬¬ä¸€æ¬¡å…ˆå†™äº†ä¸€æ®µä»£ç ã€‚
- ç¬¬äºŒæ¬¡åœ¨å¦ä¸€ä¸ªåœ°æ–¹å†™äº†ä¸€æ®µç›¸åŒçš„ä»£ç ï¼Œä½ å·²ç»æœ‰æ¶ˆé™¤å’Œæå–é‡å¤ä»£ç çš„å†²åŠ¨äº†ã€‚
- å†æ¬¡åœ¨å¦ä¸€ä¸ªåœ°æ–¹å†™äº†åŒæ ·çš„ä»£ç ï¼Œä½ å·²å¿æ— å¯å¿ï¼Œç°åœ¨å¯ä»¥è€ƒè™‘æå–å’Œæ¶ˆé™¤é‡å¤ä»£ç äº†ã€‚

è¿™ä¸€æ³•åˆ™ä¹Ÿé€‚åº”äºå¯¹é‡æ„æ—¶æœºçš„æŠŠæ¡ï¼Œè¿‡æ—©çš„é‡æ„å¯èƒ½ä¼šå¼•å…¥æ–°çš„é—®é¢˜ï¼Œä¸‰æ¬¡æ³•åˆ™ç»™äº†ä½ ä¸€ä¸ªé‡æ„ä¾æ®ã€‚å½“ç„¶ï¼Œéšç€ä½ ç»éªŒçš„å¢é•¿ï¼Œä½ å¯èƒ½åœ¨ç¬¬äºŒé˜¶æ®µå·²ç»èƒ½éå¸¸æœ‰ä¿¡å¿ƒçš„é¢„æ–™åˆ°é—®é¢˜æ‰€åœ¨ã€‚

æ‰¾å‡ºåº”ç”¨ç¨‹åºæ‰€éœ€çŠ¶æ€çš„ç»å¯¹æœ€å°è¡¨ç¤ºï¼Œç„¶åæŒ‰éœ€è®¡ç®—æ‰€æœ‰å…¶ä»–éœ€è¦çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ª TODO åˆ—è¡¨ï¼Œè¯·ä¿ç•™ä¸€ä¸ª TODO é¡¹æ•°ç»„ï¼›ä¸è¦ä¸ºè®¡æ•°ä¿ç•™å•ç‹¬çš„çŠ¶æ€å˜é‡ã€‚ç›¸åï¼Œå½“æ‚¨è¦å‘ˆç° TODO è®¡æ•°æ—¶ï¼Œè¯·é‡‡ç”¨ TODO items æ•°ç»„çš„é•¿åº¦ã€‚

æƒ³æƒ³æˆ‘ä»¬ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰æ•°æ®ç‰‡æ®µï¼š

- åŸå§‹äº§å“æ¸…å•
- ç”¨æˆ·è¾“å…¥çš„æœç´¢æ–‡æœ¬
- å¤é€‰æ¡†çš„å€¼
- è¿‡æ»¤åçš„äº§å“åˆ—è¡¨

è®©æˆ‘ä»¬é€ä¸€æ£€æŸ¥ï¼Œæ‰¾å‡ºå“ªä¸€ä¸ªæ˜¯çŠ¶æ€ï¼Œå°±æ¯ä¸€æ¡æ•°æ®é—®ä¸‰ä¸ªé—®é¢˜ï¼š

- æ˜¯ä¸æ˜¯ Parent ç»„ä»¶é€šè¿‡ Props ä¼ è¿‡æ¥çš„ï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œå¾ˆå¯èƒ½ä¸æ˜¯ Stateã€‚
- å®ƒä¼šéšç€æ—¶é—´çš„æ¨ç§»ä¿æŒä¸å˜å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œå¾ˆå¯èƒ½ä¸æ˜¯ Stateã€‚
- ä½ èƒ½åŸºäºç»„ä»¶ä¸­çš„ä»»ä½•å…¶ä»–çŠ¶æ€æˆ–å±æ€§æ¥è®¡ç®—å®ƒå—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£å°±ä¸æ˜¯ Stateã€‚

äº§å“çš„åŸå§‹åˆ—è¡¨ä½œä¸º Props ä¼ é€’ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯çŠ¶æ€ã€‚æœç´¢æ–‡æœ¬å’Œå¤é€‰æ¡†ä¼¼ä¹æ˜¯çŠ¶æ€ï¼Œå› ä¸ºå®ƒä»¬éšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ï¼Œå¹¶ä¸”ä¸èƒ½ä»ä»»ä½•å†…å®¹è®¡ç®—å‡ºæ¥ã€‚æœ€åï¼Œè¿‡æ»¤åçš„äº§å“åˆ—è¡¨ä¸æ˜¯ Stateï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡å°†åŸå§‹äº§å“åˆ—è¡¨ä¸å¤é€‰æ¡†çš„æœç´¢æ–‡æœ¬å’Œå€¼ç›¸ç»“åˆæ¥è®¡ç®—ã€‚

æœ€åï¼Œæˆ‘ä»¬çš„çŠ¶æ€æ˜¯ï¼š

- ç”¨æˆ·è¾“å…¥çš„æœç´¢æ–‡æœ¬
- å¤é€‰æ¡†çš„å€¼


### ğŸ‘‰ Step 4: Identify Where Your State Should Live

è¿™é‡Œå·²ç»ç¡®å®šäº†åº”ç”¨ç¨‹åºçŠ¶æ€çš„æœ€å°é›†åˆæ˜¯ä»€ä¹ˆã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå“ªä¸ªç»„ä»¶å˜å¼‚æˆ–æ‹¥æœ‰è¿™ä¸ªçŠ¶æ€ã€‚

è®°ä½ï¼šReact å®Œå…¨æ˜¯å…³äºç»„ä»¶å±‚æ¬¡ç»“æ„ä¸­çš„å•å‘æ•°æ®æµã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œå¯èƒ½è¿˜ä¸æ¸…æ¥šå“ªä¸ªç»„ä»¶åº”è¯¥æ‹¥æœ‰ä»€ä¹ˆçŠ¶æ€ã€‚è¿™é€šå¸¸æ˜¯æœ€å…·æŒ‘æˆ˜æ€§çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥ç†è§£ã€‚

å¯¹äºåº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªçŠ¶æ€ï¼š

- è¯†åˆ«åŸºäºè¯¥çŠ¶æ€å‘ˆç°æŸäº›å†…å®¹çš„æ¯ä¸ªç»„ä»¶ã€‚
- æ‰¾åˆ°ä¸€ä¸ªå…¬å…±æ‰€æœ‰è€…ç»„ä»¶ï¼ˆå±‚æ¬¡ç»“æ„ä¸­éœ€è¦çŠ¶æ€çš„æ‰€æœ‰ç»„ä»¶ä¹‹ä¸Šçš„å•ä¸ªç»„ä»¶ï¼‰ã€‚
- å…¬å…±æ‰€æœ‰è€…æˆ–å±‚æ¬¡ç»“æ„ä¸­æ›´é«˜çº§åˆ«çš„å¦ä¸€ä¸ªç»„ä»¶åº”è¯¥æ‹¥æœ‰çŠ¶æ€ã€‚
- å¦‚æœæ‰¾ä¸åˆ°æ‹¥æœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œè¯·åˆ›å»ºä¸€ä¸ªä»…ç”¨äºä¿å­˜çŠ¶æ€çš„æ–°ç»„ä»¶ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å…¬å…±æ‰€æœ‰è€…ç»„ä»¶ä¹‹ä¸Šçš„å±‚æ¬¡ç»“æ„ä¸­çš„æŸä¸ªä½ç½®ã€‚

è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿è¡Œä»¥ä¸‹ç­–ç•¥ï¼š

- ProductTable éœ€è¦æ ¹æ®çŠ¶æ€ç­›é€‰äº§å“åˆ—è¡¨ï¼ŒSearchBar éœ€è¦æ˜¾ç¤ºæœç´¢æ–‡æœ¬å’Œé€‰ä¸­çŠ¶æ€ã€‚
- å…¬å…±æ‰€æœ‰è€…ç»„ä»¶æ˜¯ FilterableProductTableã€‚
- ä»æ¦‚å¿µä¸Šè®²ï¼ŒfilterText å’Œ checked å€¼å­˜åœ¨äº FilterableProductTable ä¸­æ˜¯æœ‰æ„ä¹‰çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬å†³å®š State åœ¨ FilterableProductTable ç»„ä»¶è¿™é‡Œï¼š

- é¦–å…ˆï¼Œæ·»åŠ ä¸€ä¸ªå®ä¾‹å±æ€§ this.state = {filterText:''ï¼ŒinStockOnly:false} åˆ° FilterableProductTable çš„æ„é€ å‡½æ•°ï¼Œä»¥åæ˜ åº”ç”¨ç¨‹åºçš„åˆå§‹çŠ¶æ€ã€‚
- ç„¶åï¼Œå°† filterText å’Œ inStockOnly ä½œä¸º props ä¼ é€’ç»™ ProductTable å’Œ SearchBarã€‚
- æœ€åï¼Œä½¿ç”¨è¿™äº›é“å…·è¿‡æ»¤ ProductTable ä¸­çš„è¡Œï¼Œå¹¶åœ¨ SearchBar ä¸­è®¾ç½®è¡¨å•å­—æ®µçš„å€¼ã€‚

åœ¨çº¿æµè§ˆ Thinking In React: Step 4 https://codepen.io/gaearon/pen/qPrNQZ

æ‚¨å¯ä»¥å¼€å§‹äº†è§£åº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼šå°†ç»„ä»¶çš„ filterText å±æ€§è®¾ç½®ä¸º ball å¹¶åˆ·æ–°åº”ç”¨ç¨‹åºï¼Œæ‚¨å°†çœ‹åˆ°æ•°æ®è¡¨å·²æ­£ç¡®æ›´æ–°ã€‚


	class ProductTable extends React.Component {
	  render() {
	    const filterText = this.props.filterText;
	    const inStockOnly = this.props.inStockOnly;

	    const rows = [];
	    let lastCategory = null;

	    this.props.products.forEach((product) => {
	      if (product.name.indexOf(filterText) === -1) {
	        return;
	      }
	      if (inStockOnly && !product.stocked) {
	        return;
	      }
	      if (product.category !== lastCategory) {
	        rows.push(
	          <ProductCategoryRow category={product.category} key={product.category} />
	        );
	      }
	      rows.push(
	        <ProductRow product={product} key={product.name} />
	      );
	      lastCategory = product.category;
	    });

	    return (
	      <table>
	        <thead>
	          <tr>
	            <th>Name</th>
	            <th>Price</th>
	          </tr>
	        </thead>
	        <tbody>{rows}</tbody>
	      </table>
	    );
	  }
	}

	class SearchBar extends React.Component {
	  render() {
	    const filterText = this.props.filterText;
	    const inStockOnly = this.props.inStockOnly;

	    return (
	      <form>
	        <input
	          type="text"
	          placeholder="Search..."
	          value={filterText} />
	        <p>
	          <input
	            type="checkbox"
	            checked={inStockOnly} />
	          {' '}
	          Only show products in stock
	        </p>
	      </form>
	    );
	  }
	}

	class FilterableProductTable extends React.Component {
	  constructor(props) {
	    super(props);
	    this.state = {
	      filterText: '',
	      inStockOnly: false
	    };
	  }

	  render() {
	    return (
	      <div>
	        <SearchBar
	          filterText={this.state.filterText}
	          inStockOnly={this.state.inStockOnly}
	        />
	        <ProductTable
	          products={this.props.products}
	          filterText={this.state.filterText}
	          inStockOnly={this.state.inStockOnly}
	        />
	      </div>
	    );
	  }
	}



### ğŸ‘‰ Step 5: Add Inverse Data Flow

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥æ ¹æ®ç»„ä»¶å±‚æ¬¡ç»“æ„ä¸­çš„ Props å’Œ State æ­£ç¡®å‘ˆç°ã€‚ç°åœ¨æ˜¯æ—¶å€™æ”¯æŒæ•°æ®ä»¥å¦ä¸€ç§æ–¹å¼æµåŠ¨äº†ï¼šå±‚æ¬¡ç»“æ„ä¸­çš„è¡¨å•ç»„ä»¶éœ€è¦æ›´æ–° FilterableProductTable ä¸­çš„çŠ¶æ€ã€‚

React ä½¿æ­¤æ•°æ®æµæ˜¾å¼åŒ–ï¼Œä»¥å¸®åŠ©æ‚¨äº†è§£ç¨‹åºçš„å·¥ä½œæ–¹å¼ï¼Œä½†å®ƒç¡®å®éœ€è¦æ¯”ä¼ ç»Ÿçš„åŒå‘æ•°æ®ç»‘å®šå¤šä¸€ç‚¹ä»£ç ã€‚

å¦‚æœæ‚¨å°è¯•åœ¨å½“å‰ç‰ˆæœ¬çš„ç¤ºä¾‹ä¸­é”®å…¥æˆ–é€‰ä¸­è¯¥æ¡†ï¼Œæ‚¨å°†çœ‹åˆ° React å¿½ç•¥æ‚¨çš„è¾“å…¥ã€‚è¿™æ˜¯æœ‰æ„çš„ï¼Œå› ä¸ºæˆ‘ä»¬å°†è¾“å…¥çš„å€¼ Props è®¾ç½®ä¸ºå§‹ç»ˆç­‰äºä» FilterableProductTable ä¼ å…¥çš„çŠ¶æ€ã€‚

è®©æˆ‘ä»¬æƒ³æƒ³æˆ‘ä»¬æƒ³è¦å‘ç”Ÿä»€ä¹ˆã€‚æˆ‘ä»¬å¸Œæœ›ç¡®ä¿æ¯å½“ç”¨æˆ·æ›´æ”¹è¡¨å•æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ›´æ–°çŠ¶æ€ä»¥åæ˜ ç”¨æˆ·çš„è¾“å…¥ã€‚ç”±äºç»„ä»¶åº”è¯¥åªæ›´æ–°å®ƒä»¬è‡ªå·±çš„çŠ¶æ€ï¼ŒFilterableProductTableä¼šå°†å›è°ƒä¼ é€’ç»™ SearchBarï¼Œæ¯å½“çŠ¶æ€éœ€è¦æ›´æ–°æ—¶å°±ä¼šè§¦å‘ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥ä¸Šä½¿ç”¨ onChange äº‹ä»¶æ¥é€šçŸ¥å®ƒã€‚FilterableProductTable ä¼ é€’çš„å›è°ƒå°†è°ƒç”¨ setState()ï¼Œåº”ç”¨ç¨‹åºå°†è¢«æ›´æ–°ã€‚

åœ¨ FilterableProductTable ç»„ä»¶ä¸­å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¹¶ä¼ å…¥ SearchBar çš„ onFilterTextChange å’Œ onInStockChange å±æ€§ï¼š

	class SearchBar extends React.Component {
	  constructor(props) {
	    super(props);
	    this.handleFilterTextChange = this.handleFilterTextChange.bind(this);
	    this.handleInStockChange = this.handleInStockChange.bind(this);
	  }
	  
	  handleFilterTextChange(e) {
	    this.props.onFilterTextChange(e.target.value);
	  }
	  
	  handleInStockChange(e) {
	    this.props.onInStockChange(e.target.checked);
	  }
	  
	  render() {
	    return (
	      <form>
	        <input
	          type="text"
	          placeholder="Search..."
	          value={this.props.filterText}
	          onChange={this.handleFilterTextChange}
	        />
	        <p>
	          <input
	            type="checkbox"
	            checked={this.props.inStockOnly}
	            onChange={this.handleInStockChange}
	          />
	          {' '}
	          Only show products in stock
	        </p>
	      </form>
	    );
	  }
	}

	class FilterableProductTable extends React.Component {
	  constructor(props) {
	    super(props);
	    this.state = {
	      filterText: 'ball',
	      inStockOnly: false
	    };
	    
	    this.handleFilterTextChange = this.handleFilterTextChange.bind(this);
	    this.handleInStockChange = this.handleInStockChange.bind(this);
	  }

	  handleFilterTextChange(filterText) {
	    this.setState({
	      filterText: filterText
	    });
	  }
	  
	  handleInStockChange(inStockOnly) {
	    this.setState({
	      inStockOnly: inStockOnly
	    })
	  }

	  render() {
	    return (
	      <div>
	        <SearchBar
	          filterText={this.state.filterText}
	          inStockOnly={this.state.inStockOnly}
	          onFilterTextChange={this.handleFilterTextChange}
	          onInStockChange={this.handleInStockChange}
	        />
	        <ProductTable
	          products={this.props.products}
	          filterText={this.state.filterText}
	          inStockOnly={this.state.inStockOnly}
	        />
	      </div>
	    );
	  }
	}


ğŸ‘‰ And Thatâ€™s It æœ€åå°±è¿™äº›ï¼Œè‡ªå·±åŠ¨æ‰‹è¯•è¯•ã€‚

å¸Œæœ›è¿™èƒ½è®©æ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨ React æ„å»ºç»„ä»¶å’Œåº”ç”¨ç¨‹åºã€‚è™½ç„¶å®ƒå¯èƒ½æ¯”æ‚¨ä¹ æƒ¯çš„è¦å¤šæ•²ä¸€äº›ä»£ç ï¼Œä½†è¯·è®°ä½ï¼Œä»£ç çš„é˜…è¯»é‡è¿œè¿œå¤§äºç¼–å†™çš„é‡ï¼Œè€Œä¸”é˜…è¯»è¿™ç§æ¨¡å—åŒ–çš„æ˜æ˜¾çš„ä»£ç éš¾åº¦è¾ƒå°ã€‚å½“æ‚¨å¼€å§‹æ„å»ºå¤§å‹çš„ç»„ä»¶åº“æ—¶ï¼Œæ‚¨å°†ä½“ä¼šåˆ°è¿™ç§æ˜ç¡®æ€§å’Œæ¨¡å—åŒ–ï¼Œå¹¶ä¸”éšç€ä»£ç é‡ç”¨ï¼Œæ‚¨çš„ä»£ç è¡Œå°†å¼€å§‹ç¼©å‡ã€‚:)

Thinking In React: Step 5 https://codepen.io/gaearon/pen/LzWZvb?editors=0010




# âš‘ Advanced é«˜çº§è¯é¢˜



## Web API Router

ç›‘å¬åœ°å€æ çš„å˜åŠ¨ï¼š

- requestAnimationFrame åŠ¨æ€ä¾¦æµ‹
- window.addEventListener("hashchange", handler);

åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ onhashchange äº‹ä»¶

	if (('onhashchange' in window) && ((typeof document.documentMode === 'undefined') || document.documentMode == 8)) {
	    window.onhashchange = function () {
		    console.log(location.hash);
		};
	}

ä¸»ç¨‹åºï¼Œæä¾› Blogã€UseEffectã€Passthrough ç­‰ä»»æ„ä¸ªç»„ä»¶ä»¥æµ‹è¯•ï¼š

	import React, {useState, useEffect} from "react"
	import ReactDOM from 'react-dom';

	import router from '/router.js';
	import Blog from '/cp/keyedList.js';
	import UseEffect from '/cp/useEffect.js';
	import Passthrough from '/cp/passthrough.js';

	let Category = () => {
	  const [n, setN] = React.useState(0);
	  return (
	    <>
	    <div className="grid">
	      <div className="col15">      
	      <h1>Router</h1>
	      <a href="#/start" onClick={router.start}>Start</a>
	      <a href="#/stop" onClick={router.stop}>Stop</a>
	      </div>
	      <div className="col15">
	      <h1>Module</h1>
	      <a onClick={ev => setN(n)} href="#/blog">Blog</a>
	      <a onClick={ev => setN(n)} href="#/useEffect">useEffect</a>
	      <a onClick={ev => setN(n)} href="#/hr">hr</a>
	      <a onClick={ev => setN(n)} href="#/Passthrough">Passthrough</a>
	      </div>
	    </div>
	    <div className="grid">
	      <router.Root>
	        <router.Route path="/hr" cp={<div style={{width:'100%'}}><hr />ğŸš©</div>} />
	        <router.Route path="/useEffect" cp={<UseEffect />} />
	        <router.Route path="/blog" cp={<Blog />} />
	        <router.Route path="/Passthrough" cp={<Passthrough />} />        
	      </router.Root>
	    </div>
	    </>
	  )
	}

	ReactDOM.render(
	  <Category />,
	  document.getElementById('root')
	);


router.js

	import React from 'react';

	// Polyfill
	window.requestAnimationFrame = (function () {
	    if (!window.cancelAnimationFrame) {
	        window.cancelAnimationFrame = function (id) {
	            clearTimeout(id);
	        };
	    }
	    return window.requestAnimationFrame ||
	        window.webkitRequestAnimationFrame ||
	        window.mozRequestAnimationFrame ||
	        window.oRequestAnimationFrame ||
	        window.msRequestAnimationFrame ||
	        function (callback) {
	            window.setTimeout(callback, 1000 / 60);
	        };
	})();

	let router = ((requestAnimationFrame,cancelAnimationFrame)=>{
	  let that, requestid, prev = {}, setS,
	  fs = ['host', 'hostname', 'href', 'origin', 'pathname', 'port', 'protocol', 'hash'];
	  fs.map(it=>prev[it]=location[it]);
	  
	  let monitor = () => {
	    if(prev.href !== location.href){
	      fs.map(it=>prev[it]=location[it]);
	      //console.log('change', location.hash);
	      setS && setS();
	    }
	    requestid = requestAnimationFrame(monitor);
	  }
	  let isMe = (path) => {
	    return '#'+path === location.hash;
	  }
	  return (that = {
	    start: ()=>{
	      that.stop()
	      monitor();
	    },
	    stop: ()=>{
	      cancelAnimationFrame(requestid);
	    },
	    Root: (props) => {
	      const [state, setState] = React.useState(false);
	      setS = () => setState(!state);
	      let found;
	      props.children && props.children.map(it => {
	        if(isMe(it.props.path)){
	            console.log('Root', isMe(it.props.path), it.props.path, it);
	            found = (<>{it.type(it.props)}</>);
	        }
	      })
	      return found;
	    },
	    Route: (props) => {
	      //console.log('Route', isMe(props.path), props.path, location.hash);
	      return( isMe(props.path)? <>{props.cp}</>:null );
	    }
	  });
	})(requestAnimationFrame,cancelAnimationFrame)

	router.start();

	export default router;


åœ¨çº¿è§‚çœ‹ https://scrimba.com/scrim/cB32EPsv



## React.memo vs PureComponent è°æ›´æœ‰æ•ˆç‡
- React v16.6.0: lazy, memo and contextType https://reactjs.org/blog/2018/10/23/react-v-16-6.html
- Hooks API Reference https://reactjs.org/docs/hooks-reference.html
- React on Github https://github.com/facebook/react/
- React Devtools on Github https://github.com/facebook/react-devtools/releases/tag/3.4.2
- Flow with React Components https://flow.org/en/docs/react/components/

React æ ¸å¿ƒå¼€å‘å›¢é˜Ÿä¸€ç›´éƒ½åŠªåŠ›åœ°è®© React å˜å¾—æ›´å¿«ï¼Œåœ¨ React ä¸­å¯ä»¥ç”¨æ¥ä¼˜åŒ–ç»„ä»¶æ€§èƒ½çš„æ–¹æ³•å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§:

- ç»„ä»¶æ‡’åŠ è½½ React.lazy(...) å’Œ <Suspense />
- ä½¿ç”¨ PureComponent æ›¿ä»£ç±»ç»„ä»¶ Componentï¼›
- å®šåˆ¶ shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä¸»åŠ¨æ§åˆ¶æ¸²æŸ“æ—¶æœºï¼›
- ä½¿ç”¨ React.memo é«˜é˜¶å‡½æ•°ç»„ä»¶ç­‰ï¼›

React v16.6.0 æä¾›çš„é«˜é˜¶å‡½æ•°ç»„ä»¶ React.memo()ï¼Œå¯ä»¥å®ç°å‡½æ•°ç»„ä»¶çš„æ¸²æŸ“æ§åˆ¶ï¼Œå°±åƒ PureComponent æˆ– shouldComponentUpdate æ§åˆ¶æ¸²æŸ“æ—¶æœºä¸€æ ·ã€‚


æŸ¥çœ‹ ReactMemo.js æºä»£ç å¯ä»¥å‘ç° React.memo çš„å®ç°å¾ˆç®€å•ï¼Œè¿‡æ»¤æ‰å¼€å‘é˜¶æ®µæ¶‰åŠçš„ä»£ç ï¼Œä½™ä¸‹çš„ä¸å¤šã€‚æ³¨æ„å…¶ç¬¬äºŒä¸ªå¯é€‰å‚æ•°ä¼ å…¥ä¸€ä¸ª compare æ¯”è¾ƒå‡½æ•°ï¼Œè¿”å›æ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰ï¼Œå†å†³å®šä½•æ—¶æ›´æ–°:

	/**
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */

	import {REACT_MEMO_TYPE} from 'shared/ReactSymbols';

	...

	export function memo<Props>(
	  type: React$ElementType,
	  compare?: (oldProps: Props, newProps: Props) => boolean,
	) {
	  // if (__DEV__){ ... }
	  const elementType = {
	    $$typeof: REACT_MEMO_TYPE,
	    type,
	    compare: compare === undefined ? null : compare,
	  };
	  // if (__DEV__) { ... 
	  return elementType;
	}

æ ¹æ®ä¼ å…¥çš„ compare å‡½æ•°æ¯”è¾ƒ prevProps å’Œ nextPropsï¼Œæœ€ç»ˆå†³å®šç”Ÿæˆå¯¹è±¡ï¼Œå¹¶å½±å“æ¸²æŸ“æ•ˆæœã€‚å…¶å®è¿™ä¸€åŠŸèƒ½å’Œç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° shouldComponentUpdate æ˜¯ç›¸åŒçš„åŠŸèƒ½ã€‚è€Œä¹‹æ‰€ä»¥å†å¢åŠ è¿™ä¸ª React.memoï¼Œç›®çš„å°±æ˜¯ React å›¢é˜Ÿä¸€ç›´åœ¨ç§‰æ‰¿çš„ä¿¡å¿µï¼Œé‚£å°±æ˜¯è®©ä¸€åˆ‡å˜å¾—æ›´åŠ å‡½æ•°å¼ã€‚

åˆ›å»ºç±»ç»„ä»¶æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼ŒReact.Component å’Œ React.PureComponentã€‚ä¸¤è€…é™¤äº†åœ¨ shouldComponentUpdate æ–¹æ³•çš„å®ç°é€»è¾‘ä¸Šä¸ä¸€æ ·ï¼Œå…¶ä»–è¡¨ç°éƒ½ä¸€æ ·ï¼Œå¹¶ä¸”ä¸å»ºè®®é‡å†™ PureComponent ç»„ä»¶çš„è¿™ä¸ªå‡½æ•°ã€‚å› ä¸º PureComponent ä½¿ç”¨äº† propsã€state çš„æµ…æ¯”è¾ƒï¼Œé€šè¿‡ shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ§åˆ¶å‡å°‘ render è°ƒç”¨æ¬¡æ•°æ¥å‡å°‘æ€§èƒ½æŸè€—çš„ã€‚ä½†è¯¥ç»„ä»¶ä¹Ÿå…·æœ‰ä¸€å®šçš„ç¼ºé™·ï¼Œå› ä¸ºå®ƒåªèƒ½è¿›è¡Œä¸€å±‚æµ…æ¯”è¾ƒï¼Œç®€å•æ¥è¯´ï¼Œå®ƒåªæ¯”è¾ƒ props å’Œ state çš„å†…å­˜åœ°å€ï¼Œå¦‚æœå†…å­˜åœ°å€ç›¸åŒï¼Œåˆ™ shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸå°±è¿”å› false ä¸æ‰§è¡Œé‡ç»˜ã€‚

ä»¥ä¸‹ Passthrough ç¤ºèŒƒäº†å„ç§ç»„ä»¶çš„é‡æ–°æ¸²æŸ“æµç¨‹ï¼Œè¦ç‚¹å¦‚ä¸‹ï¼š

	App - å‡½æ•°ç»„ä»¶ï¼Œé€šè¿‡ children å‘å„ä¸ªä¸€çº§å­ç»„ä»¶ä¼ å…¥ä¸€ä¸ª **Indicator** æŒ‡ç¤ºç»„ä»¶
	  +-- CDemo - ç±»ç»„ä»¶
	  |     +-- **Indicator** æŒ‡ç¤ºç»„ä»¶
	  +-- PDemo - çº¯ç±»ç»„ä»¶
	  |     +-- **Indicator** æŒ‡ç¤ºç»„ä»¶
	  +-- FDemo - å‡½æ•°ç»„ä»¶
	  |     +-- **Indicator** æŒ‡ç¤ºç»„ä»¶
	  |     +-- CDemo - ç±»ç»„ä»¶
	  |     |     +-- **Indicator** æŒ‡ç¤ºç»„ä»¶
	  |     +-- PDemo - çº¯ç±»ç»„ä»¶
	  |           +-- **Indicator** æŒ‡ç¤ºç»„ä»¶
	  +-- MDemo - ä½¿ç”¨ React.memo å°è£…çš„å‡½æ•°ç»„ä»¶
	        +-- **Indicator** æŒ‡ç¤ºç»„ä»¶

- Top é¡¶å±‚ App ç»„ä»¶é€è¿‡ children ä¼ å…¥å­ç»„ä»¶çš„éƒ¨åˆ†ä¸å—å­ç»„ä»¶çŠ¶æ€æ›´æ–°çš„å½±å“ï¼Œå¦‚ Top -> CDemo æˆ– Top -> PDemo è¿™äº›æŒ‡ç¤ºç»„ä»¶å°±ä¸ä¼šå— CDemo æˆ– PDemo çŠ¶æ€æ›´æ–°çš„å½±å“ï¼Œå¹¶ä¿æŒåŸçŠ¶æ€ã€‚
- ä½†æ˜¯ï¼Œé€šè¿‡ children ä¼ å…¥å­ç»„ä»¶çš„éƒ¨åˆ†æœ‰çŠ¶æ€æ›´æ–°æ—¶ï¼Œä¼šè§¦å‘å­ç»„ä»¶çš„æ›´æ–°ã€‚è¿™ä¸€ç‚¹é€šè¿‡ PDemo å¾ˆå¥½æµ‹è¯•ï¼Œç§»é™¤ç»„ä»¶æ ‘ä¸­ç¬¬ä¸€ä¸ª PDemo çš„ children ä¹‹åï¼Œå…¶çŠ¶æ€å°±ä¸å—é¡¶å±‚çš„æ›´æ–°å½±å“ï¼Œæˆ–è€…å‚è€ƒ FDemo å’Œ MDemo å­ç»„ä»¶ä¸‹çš„ PDemoã€‚
- React.memo å°è£…çš„å‡½æ•°ç»„ä»¶å¯ä»¥é€šè¿‡æ¯”è¾ƒå‡½æ•°è¿”å›å€¼æŒ‡ç¤ºæ˜¯å¦çŠ¶æ€ç»´æŒåŸæ ·ï¼Œæ¥æ§åˆ¶æ›´æ–°æ—¶æœºã€‚

ä»¥å•ä¸ªå‡½æ•°ç»„ä»¶æ¥çœ‹ï¼Œæœ‰ä¸¤ä¸ªæ›´æ–°æ•°æ®çš„æ–¹æ³• update å’Œ updateVarï¼Œä½†æ˜¯åè€…æ²¡æœ‰æ›´æ–°çŠ¶æ€æ•°æ®å°±ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚å¹¶ä¸”ï¼Œå¦‚æœå°† toc å˜é‡å®šä¹‰åœ¨ç»„ä»¶å‡½æ•°å†…éƒ¨ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“åï¼Œå®ƒå°†è¢«æ¸…ç©ºå¤åŸï¼Œè€Œå°†å®ƒå®šä¹‰åœ¨æ¨¡å—ä¸­ï¼Œå°±æˆä¸ºä¸€ä¸ªä¸å— React ç®¡ç†çš„å…¨å±€å˜é‡ï¼Œè¿™æ ·æ•°æ®å°±å¯ä»¥ä¿å­˜ä¸‹æ¥ï¼š

	let toc = "FDemo -> CDemo";
	let FDemo = (props:Props) => {
	    const [state, setState] = React.useState(false);
	    let update = (ev:any) => setState(!state);
	    let updateVar = (ev:any) => {toc += Date.now(); console.log(toc);};
	    return (
	        <div className={props.className}>
	        <Indicator text="FDemo">
	        <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	        <button className="button-minimal" onClick={ev => updateVar(ev)}>Update Var</button>
	        </Indicator>
	        {props.children}
	        <CDemo text={toc}/>
	        <PDemo text="FDemo -> PDemo"/>
	        </div>
	    );
	}

å„ç§ç»„ä»¶çš„æ›´æ–°æœºåˆ¶é€šè¿‡ä»¥ä¸‹ Passthrough ç¤ºèŒƒï¼š

	import React from "react";

	interface Props {
	    state?:boolean
	    children?:any
	    text?:string
	    className?:string
	}

	let Indicator = (props:Props) => {
	    return (
	        <div className="board">
	        {props.text} @<b>{new Date().toISOString().substr(14,10)}</b>
	        <div>{props.children}</div>
	        </div>
	    );
	}

	class CDemo extends React.Component<Props> {
	    props:Props
	    state:{ok: boolean}
	    constructor(props:Props){
	        super(props);
	        this.props = props;
	        this.state = {ok: false};
	    }
	    render(){
	        let update = (ev:any) => this.setState({ok:!this.state.ok});
	        return (
	            <div className={this.props.className}>
	            <Indicator text={this.props.text ?? "CDemo"}>
	                <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	            </Indicator>
	            {this.props.children}
	            </div>
	        );
	    }
	}

	class PDemo extends React.PureComponent<Props> {
	    props:Props
	    state:{ok: boolean}
	    constructor(props:Props){
	        super(props);
	        this.props = props;
	        this.state = {ok: false};
	    }
	    render(){
	        let update = (ev:any) => this.setState({ok:!this.state.ok});
	        return (
	            <div className={this.props.className}>
	            <Indicator text={this.props.text ?? "PDemo"}>
	                <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	            </Indicator>
	            {this.props.children}
	            </div>
	        );
	    }
	}

	let FDemo = (props:Props) => {
	    const [state, setState] = React.useState(false);
	    let update = (ev:any) => setState(!state);
	    return (
	        <div className={props.className}>
	        <Indicator text="FDemo">
	        <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	        </Indicator>
	        {props.children}
	        <CDemo text="FDemo -> CDemo"/>
	        <PDemo text="FDemo -> PDemo"/>
	        </div>
	    );
	}

	let compare = (prev: Props, next: Props) => {
	    return next.state ?? false; // does it no need rerender?
	}
	const MDemo = React.memo((props: Props)=>{
	    const ref = React.useRef<HTMLDivElement>(null)
	    animate(ref.current!);
	    const [state, setState] = React.useState(false);
	    let update = (ev:any) => setState(!state);
	    return (
	        <div ref={ref} className={props.className} >
	        <Indicator text="MDemo">
	            <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	        </Indicator>
	        {props.children}
	        </div>
	    );
	}, compare );

	let animate = (el:HTMLElement, timeout:number = 600) => {
	  if(!el) return ;
	  el.className = 'animate';
	  setTimeout(() => {
	    el.className = 'frozon';
	  }, timeout);
	}

	let App = (props:Props) => {
	    const [state, setState] = React.useState(false);
	    const [rm, setRm] = React.useState(false);
	    let update = (ev:any) => setState(!state);
	    let remove = (ev:any) => setRm(!rm);
	    return (
	        <div className="board bgGray grid">
	        <div className="col16">
	            <Indicator text="Top">
	                <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	            </Indicator>
	        </div>
	        <CDemo className="col16">
	            <Indicator text="Top -> CDemo">
	                <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	            </Indicator>
	        </CDemo>
	        <PDemo className="col16">
	            {!rm && (
	                <>
	                <Indicator text="Top -> PDemo">
	                <button className="button-minimal" onClick={ev => remove(ev)}>Hide 4 PDemo</button>
	                <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	                </Indicator>
	                </>)
	            }
	        </PDemo>
	        <FDemo className="col16">
	            <Indicator text="Top -> FDemo">
	                <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	            </Indicator>
	        </FDemo>
	        <MDemo state={state} >
	            <Indicator text="Top -> MDemo">
	                <button className="button-minimal" onClick={ev => update(ev)}>Update</button>
	            </Indicator>
	        </MDemo>
	        </div>
	    );
	}

	export default App;


CSS å®ç°çš„åŠ¨ç”»ï¼š

	.animate {
	    animation: bg-color 0.21s 3/* infinite */;
	    -webkit-animation: bg-color 0.21s 3/* infinite */;
	}

	@-webkit-keyframes bg-color {
	    0% { background-color: #eee; }
	    20% { background-color: #e0dbc4; }
	    60% { background-color: #e3e7ac; }
	    100% { background-color: #eee; } 
	}

	@keyframes bg-color {
	    0% { background-color: #eee; }
	    20% { background-color: #e0dbc4; }
	    60% { background-color: #e3e7ac; }
	    100% { background-color: #eee; } 
	}


åœ¨çº¿è¿è¡Œ Passthrough https://scrimba.com/scrim/cB32EPsv



## PropTypes éªŒè¯Reactç»„ä»¶å±æ€§
- https://reactjs.org/docs/forms.html
- https://reactjs.org/docs/events.html
- https://reactjs.org/docs/handling-events.html
- [ä½¿ç”¨ PropTypes è¿›è¡Œç±»å‹æ£€æŸ¥](https://react.docschina.org/docs/typechecking-with-proptypes.html)
- [Typechecking With PropTypes](https://reactjs.org/docs/typechecking-with-proptypes.html)

éšç€ä½ çš„åº”ç”¨ç¨‹åºä¸æ–­å¢é•¿ï¼Œä½ å¯ä»¥é€šè¿‡ç±»å‹æ£€æŸ¥æ•è·å¤§é‡é”™è¯¯ã€‚å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä½ å¯ä»¥ä½¿ç”¨ Flow æˆ– TypeScript ç­‰ JavaScript æ‰©å±•æ¥å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºåšç±»å‹æ£€æŸ¥ã€‚ä½†å³ä½¿ä½ ä¸ä½¿ç”¨è¿™äº›æ‰©å±•ï¼ŒReact ä¹Ÿå†…ç½®äº†ä¸€äº›ç±»å‹æ£€æŸ¥çš„åŠŸèƒ½ã€‚

PropTypes æä¾›ä¸€ç³»åˆ—éªŒè¯å™¨ï¼Œå¯ç”¨äºç¡®ä¿ç»„ä»¶æ¥æ”¶åˆ°çš„æ•°æ®ç±»å‹æ˜¯æœ‰æ•ˆçš„ã€‚åœ¨æœ¬ä¾‹ä¸­, æˆ‘ä»¬ä½¿ç”¨äº† PropTypes.stringã€‚å½“ä¼ å…¥çš„ prop å€¼ç±»å‹ä¸æ­£ç¡®æ—¶ï¼ŒJavaScript æ§åˆ¶å°å°†ä¼šæ˜¾ç¤ºè­¦å‘Šã€‚å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼ŒpropTypes ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿›è¡Œæ£€æŸ¥ã€‚

è‡ª React v15.5 èµ·ï¼ŒReact.PropTypes å·²ç§»å…¥å¦ä¸€ä¸ªåŒ…ä¸­ã€‚è¯·ä½¿ç”¨ prop-types åº“ ä»£æ›¿ã€‚ç”±äº TypeScript çš„å‡ºç°ï¼Œä½¿å¾— PropTypes æ˜¾å¾—ç›¸å½“è¿‡æ—¶äº†ã€‚

	// Before (15.4 and below)
	import React from 'react';

	class Component extends React.Component {
	  render() {
	    return <div>{this.props.text}</div>;
	  }
	}

	Component.propTypes = {
	  text: React.PropTypes.string.isRequired,
	}

	// After (15.5)
	import React from 'react';
	import PropTypes from 'prop-types';

	class Component extends React.Component {
	  render() {
	    return <div>{this.props.text}</div>;
	  }
	}

	Component.propTypes = {
	  text: PropTypes.string.isRequired,
	};

ä½¿ç”¨ JavaScript æ—¶è¦åœ¨ç»„ä»¶çš„ props ä¸Šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œä½ åªéœ€é…ç½®ç‰¹å®šçš„ propTypes å±æ€§ï¼š

	import React from 'react';
	import PropTypes from 'prop-types';

	class Greeting extends React.Component {
	    render() {
	    return (
	        <h1>Hello, {this.props.name}</h1>
	    );
	    }
	}

	Greeting.defaultProps = {
	    name: 'Stranger[default value]'
	};

	Greeting.propTypes = {
	    name: PropTypes.string
	};

	export default Greeting;

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ class ç»„ä»¶ï¼Œä½†æ˜¯åŒæ ·çš„åŠŸèƒ½ä¹Ÿå¯ç”¨äºå‡½æ•°ç»„ä»¶ï¼Œæˆ–è€…æ˜¯ç”± React.memo/React.forwardRef åˆ›å»ºçš„ç»„ä»¶ã€‚

åœ¨ TypeScript ä¸æ”¯æŒç›´æ¥é€šè¿‡ç±»è®¿é—® defaultProps æˆ–è€… propTypes æ¥èµ‹å€¼ä»¥è®¾ç½®é»˜è®¤å±æ€§ï¼Œå› ä¸º React.Component ç±»å‹ä¸Šå¹¶æ²¡æœ‰è¿™äº›å±æ€§ã€‚

	// ?Property 'defualtProps' does not exist on type 'typeof Greeting'.ts(2339)
	Greeting.defualtProps = {
	  name: "stranger",
	};

å¯ä»¥å°†è¿™äº›å±æ€§ç§»å…¥ Greeting ç»„ä»¶å†…éƒ¨ä½œä¸ºæˆå‘˜å®šä¹‰ï¼š

	public static defaultProps: {
	    name: "Demo Value"
	}

ä¸Šé¢è™½ç„¶å®ç°äº†é€šè¿‡ defaultProps æ¥æŒ‡å®šå±æ€§çš„é»˜è®¤å€¼ï¼Œä½†å’Œ Props æ²¡æœ‰å…³è”ä¸Šï¼Œä»¥è‡³äºå¯ä»¥åœ¨ defaultProps é‡Œé¢æ”¾ä»»ä½•å€¼ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸ç§‘å­¦çš„ã€‚

å¯ä»¥ä½¿ç”¨ Partial ç±»å‹å°† defaultProps å£°æ˜ä¸º Props ç±»å‹çš„å­é›†ï¼š

	interface Props {
	    name: string
	    more: boolean
	}

	public static defaultProps: Partial<Props> = {
	    more: true
	};


åœ¨ TypeScript ä¸­ä½¿ç”¨ PropTypes éªŒè¯ç»„ä»¶ç±»å±æ€§çš„å®Œæ•´ç¤ºèŒƒï¼š

	import React from 'react';
	import PropTypes from 'prop-types';

	interface IProps {
	    name: string
	}

	class Greeting extends React.Component<IProps, {}> {
	    static propTypes = {
	        name: PropTypes.oneOf(['Fox', 'Ape'])
	    }

	    static defaultProps: Partial<IProps> = { 
	        name: "world",
	        // age: "Dr."
	    }

	    render() {
	        return (
	            <h1>Hello, {this.props.name}</h1>
	        );
	    }
	}

	export default Greeting;

React æä¾›äº†å‡½æ•°å¼ç»„ä»¶çš„å†…éƒ¨å®šä¹‰ï¼ŒReact 16.7 - React.SFC æ˜¯è¿‡æ—¶ APIï¼ŒReact.FC ç›¸å¯¹ React.SFC æ˜¯æ›´æ–°çš„ APIï¼Œå¯ä»¥æ›¿æ¢ä½¿ç”¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ Hooks å‡½æ•°ã€‚è¯·æ³¨æ„ React.SFC æ˜¯ React.StatelessComponent çš„åˆ«åï¼ŒReact.FC æ˜¯ React.FunctionComponent çš„åˆ«åã€‚ 

	const example: React.StatelessComponent<IExample> = ({propsType}) => ();
	const example: React.SFC<IExample> = ({propsType}) => ();

	const example: React.FunctionComponent<IExample> = ({propsType}) => ();
	const example: React.FC<IExample> = ({propsType}) => ();

å‚è€ƒç»„ä»¶ç±»å‹å®šä¹‰æ–‡ä»¶ç›¸å…³éƒ¨åˆ†ï¼Œå…¶ä¸­ PropsWithChildren ä¼šç»™å‡½æ•°ç»„ä»¶ä¼ å…¥ children å³å­èŠ‚ç‚¹å‚æ•°ï¼š

    /**
     * @deprecated as of recent React versions, function components can no
     * longer be considered 'stateless'. Please use `FunctionComponent` instead.
     *
     * @see [React Hooks](https://reactjs.org/docs/hooks-intro.html)
     */
    type SFC<P = {}> = FunctionComponent<P>;

    /**
     * @deprecated as of recent React versions, function components can no
     * longer be considered 'stateless'. Please use `FunctionComponent` instead.
     *
     * @see [React Hooks](https://reactjs.org/docs/hooks-intro.html)
     */
    type StatelessComponent<P = {}> = FunctionComponent<P>;

    type FC<P = {}> = FunctionComponent<P>;

    interface FunctionComponent<P = {}> {
        (props: PropsWithChildren<P>, context?: any): ReactElement<any, any> | null;
        propTypes?: WeakValidationMap<P>;
        contextTypes?: ValidationMap<any>;
        defaultProps?: Partial<P>;
        displayName?: string;
    }

    type PropsWithChildren<P> = P & { children?: ReactNode };


ä½¿ç”¨æ–°å¼çš„ FunctionComponent å°±å¯ä»¥ç®€åŒ– defaultProps çš„ä½¿ç”¨ï¼š

	interface PageProps {
	  foo?: string;
	  bar: number;
	}

	const PageComponent: FunctionComponent<PageProps> = (props) => {
	  return (
	    <span>Hello, {props.foo}, {props.bar}</span>
	  );
	};

	PageComponent.defaultProps = {
	  foo: "default"
	};

ç»™å‡½æ•°å¼ç»„ä»¶è®¾ç½®å±æ€§ï¼š

	import React from 'react';
	import PropTypes from 'prop-types';

	interface IProps {
	  name?: string
	}

	// const App = ({name}: IProps) => {
	const App:React.FC<IProps> = ({ name }) => {
	  return (<div style={{fontSize: 32, textAlign: 'center'}}>Hi, {name}</div>);
	}

	App.displayName = 'App';
	App.defaultProps = {
	  name: "Applications",
	};
	App.propTypes = {
	    name: PropTypes.oneOf(["App", "Application"]),
	};

	export default App;

ä½¿ç”¨ ES6 çš„å¯¹è±¡æ‰©å±•è¿ç®—ç¬¦ ...rest ä¹Ÿå¯ä»¥å°†é»˜è®¤å‚æ•°å¯¹è±¡åˆå¹¶åˆ°å±æ€§ä¸­ï¼š

	props = { ...defaultProps, ...props }


prop-types å®šä¹‰æ–‡ä»¶å‚è€ƒï¼š

	// Type definitions for prop-types 15.7
	// Project: https://github.com/reactjs/prop-types, https://facebook.github.io/react
	// Definitions by: DovydasNavickas <https://github.com/DovydasNavickas>
	//                 Ferdy Budhidharma <https://github.com/ferdaber>
	//                 Sebastian Silbermann <https://github.com/eps1lon>
	// Definitions: https://github.com/DefinitelyTyped/DefinitelyTyped
	// TypeScript Version: 2.8

	export type ReactComponentLike =
	    | string
	    | ((props: any, context?: any) => any)
	    | (new (props: any, context?: any) => any);

	export interface ReactElementLike {
	    type: ReactComponentLike;
	    props: any;
	    key: string | number | null;
	}

	export interface ReactNodeArray extends Array<ReactNodeLike> {}

	export type ReactNodeLike =
	    | {}
	    | ReactElementLike
	    | ReactNodeArray
	    | string
	    | number
	    | boolean
	    | null
	    | undefined;

	export const nominalTypeHack: unique symbol;

	export type IsOptional<T> = undefined extends T ? true : false;

	export type RequiredKeys<V> = { [K in keyof V]-?: Exclude<V[K], undefined> extends Validator<infer T> ? IsOptional<T> extends true ? never : K : never }[keyof V];
	export type OptionalKeys<V> = Exclude<keyof V, RequiredKeys<V>>;
	export type InferPropsInner<V> = { [K in keyof V]-?: InferType<V[K]>; };

	export interface Validator<T> {
	    (props: { [key: string]: any }, propName: string, componentName: string, location: string, propFullName: string): Error | null;
	    [nominalTypeHack]?: {
	        type: T;
	    };
	}

	export interface Requireable<T> extends Validator<T | undefined | null> {
	    isRequired: Validator<NonNullable<T>>;
	}

	export type ValidationMap<T> = { [K in keyof T]?: Validator<T[K]> };

	export type InferType<V> = V extends Validator<infer T> ? T : any;
	export type InferProps<V> =
	    & InferPropsInner<Pick<V, RequiredKeys<V>>>
	    & Partial<InferPropsInner<Pick<V, OptionalKeys<V>>>>;

	export const any: Requireable<any>;
	export const array: Requireable<any[]>;
	export const bool: Requireable<boolean>;
	export const func: Requireable<(...args: any[]) => any>;
	export const number: Requireable<number>;
	export const object: Requireable<object>;
	export const string: Requireable<string>;
	export const node: Requireable<ReactNodeLike>;
	export const element: Requireable<ReactElementLike>;
	export const symbol: Requireable<symbol>;
	export const elementType: Requireable<ReactComponentLike>;
	export function instanceOf<T>(expectedClass: new (...args: any[]) => T): Requireable<T>;
	export function oneOf<T>(types: ReadonlyArray<T>): Requireable<T>;
	export function oneOfType<T extends Validator<any>>(types: T[]): Requireable<NonNullable<InferType<T>>>;
	export function arrayOf<T>(type: Validator<T>): Requireable<T[]>;
	export function objectOf<T>(type: Validator<T>): Requireable<{ [K in keyof any]: T; }>;
	export function shape<P extends ValidationMap<any>>(type: P): Requireable<InferProps<P>>;
	export function exact<P extends ValidationMap<any>>(type: P): Requireable<Required<InferProps<P>>>;

	/**
	 * Assert that the values match with the type specs.
	 * Error messages are memorized and will only be shown once.
	 *
	 * @param typeSpecs Map of name to a ReactPropType
	 * @param values Runtime values that need to be type-checked
	 * @param location e.g. "prop", "context", "child context"
	 * @param componentName Name of the component for error messages
	 * @param getStack Returns the component stack
	 */
	export function checkPropTypes(typeSpecs: any, values: any, location: string, componentName: string, getStack?: () => any): void;

	/**
	 * Only available if NODE_ENV=production
	 */
	export function resetWarningCache(): void;




## Code-Splitting & Lazy ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½
- Code-Splitting https://reactjs.org/docs/code-splitting.html#reactlazy
- Webpackâ€™s guide on code splitting https://webpack.js.org/guides/code-splitting/

å‡ ä¹æ‰€æœ‰æ‰“åŒ…å·¥å…·éƒ½æœ‰ Bundling æ‰“åŒ…çš„åŸºæœ¬æ¦‚å¿µï¼Œå¦‚ Webpack, Rollup æˆ– Browserifyï¼Œå°†æ‰€æœ‰ç›¸å…³å¯¼å…¥çš„èµ„æºæ•´åˆåˆ°ä¸€ä¸ªæ‰“åŒ…æ–‡ä»¶ä¸­ç®¡ç†ï¼Œå³ bundle æ–‡ä»¶ã€‚

ç”šè‡³æ•´ä¸ªåº”ç”¨éƒ½å¯ä»¥æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š

	// app.js
	import { add } from './math.js';

	console.log(add(16, 26)); // 42


	// math.js
	export function add(a, b) {
	  return a + b;
	}

æ‰“åŒ…æˆ Bundle:

	function add(a, b) {
	  return a + b;
	}

	console.log(add(16, 26)); // 42

å¯¹äºå°åº”ç”¨è¿™æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†å¤§å‹å·¥ç¨‹è¿™æ ·åšå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªåå‡ æˆ–å‡ å MB çš„æ–‡ä»¶ï¼Œè¿™ä¼šç»™åŠ è½½å¸¦æ¥æå¤§çš„é—®é¢˜ï¼Œå› æ­¤éœ€è¦è¿›è¡Œæ¨¡å—åˆ†å‰²å’Œå»¶ååŠ è½½ã€‚

ä» import() æ–¹æ³•å¯ä»¥è¾ƒå¥½ç†è§£å¦‚ä½•è¿›è¡Œä»£ç åˆ†å‰²ï¼š

	// Before:
	import { add } from './math';

	console.log(add(16, 26));


	// After:
	import("./math").then(module => {
	  console.log(module.add(16, 26));
	});

å¦‚æœå¯¼å‡ºä¸­ä½¿ç”¨äº†é»˜è®¤å¯¼å‡ºï¼Œé‚£ä¹ˆ import è·å–åˆ°çš„æ¨¡å—å°±ä¼šå¸¦æœ‰ module.default å±æ€§ï¼š

	export default let title:string = "Hi";


React æä¾›çš„ lazy æ–¹æ³•å¯ä»¥å®ç°å»¶ååŠ è½½ï¼Œé€šè¿‡å®ƒåŠ è½½é‚£äº›ä¸æ€¥ç€ä½¿ç”¨çš„ç»„ä»¶ï¼š

	import OtherComponent from './OtherComponent';

	const OtherComponent = React.lazy(() => import('./OtherComponent'));

è€Œè¿™äº›è¢«å»¶ååŠ è½½çš„ç»„ä»¶éœ€è¦ä½¿ç”¨ Suspense ç»„ä»¶åŒ…è£…èµ·æ¥ï¼Œè¡¨ç¤ºè¦å¯¹å®ƒä»¬è¿›è¡Œä»£ç åˆ†å‰²ï¼Œå®ƒä»¬å°†è¿›è¡Œç‹¬ç«‹æ‰“åŒ…ï¼š

	import React, { Suspense } from 'react';

	const OtherComponent = React.lazy(() => import('./OtherComponent'));
	const AnotherComponent = React.lazy(() => import('./AnotherComponent'));

	function MyComponent() {
	  return (
	    <>
	      <Suspense fallback={<div>Loading...</div>}>
	        <section>
	          <OtherComponent />
	          <AnotherComponent />
	        </section>
	      </Suspense>
	    </>
	  );
	}

å¯ä»¥ç»™ Suspense fallback å±æ€§ä¼ å…¥ä¸€ä¸ªç»„ä»¶ï¼Œç”¨æ¥å‘ˆç°åŠ è½½çš„ç­‰å¾…è¿‡ç¨‹ã€‚å¦å¤–ï¼Œå¦‚ä½•è¦ä½¿ç”¨ Error Boundary ç»„ä»¶è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¯·å°† Suspense æ”¾ç½®åœ¨é”™è¯¯è¾¹ç•Œç»„ä»¶å†…ã€‚

ä»£ç åˆ†å‰²è¿˜å¯ä»¥ç»“åˆ React Router è·¯ç”±ä½¿ç”¨ï¼š

	import React, { Suspense, lazy } from 'react';
	import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';

	const Home = lazy(() => import('./routes/Home'));
	const About = lazy(() => import('./routes/About'));

	const App = () => (
	  <Router>
	    <Suspense fallback={<div>Loading...</div>}>
	      <Switch>
	        <Route exact path="/" component={Home}/>
	        <Route path="/about" component={About}/>
	      </Switch>
	    </Suspense>
	  </Router>
	);

è®¾ç½®åˆ†å‰²ç‚¹åº”è¯¥åˆç†ï¼Œä¸èƒ½å°†ä¸€éƒ¨åˆ†åˆ†å‰²å¾—å¾ˆå¤§ï¼Œå¦ä¸€éƒ¨åˆå¾ˆå°ï¼Œè¿™æ ·ä¸èƒ½åˆç†åˆ©ç”¨åŠ è½½èƒ½åŠ›ã€‚

React.lazy ç›®å‰åªæ”¯æŒé»˜è®¤å¯¼å‡ºçš„å¯¹è±¡ï¼Œå¦‚æœè¦å¯¼å…¥å‘½åå¯¼å‡ºçš„å¯¹è±¡ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´æ¨¡å—ï¼Œå°†å…¶åŒ…è£…ä¸ºé»˜è®¤å¯¼å‡ºï¼š

	// ManyComponents.js
	export const MyComponent = /* ... */;
	export const MyUnusedComponent = /* ... */;

	// MyComponent.js
	export { MyComponent as default } from "./ManyComponents.js";

	// MyApp.js
	import React, { lazy } from 'react';
	const MyComponent = lazy(() => import("./MyComponent.js"));


React lazy æºä»£ç å®ç°å‚è€ƒ ReactLazy.js æ–‡ä»¶ï¼Œå…¶åœ¨å†…éƒ¨æ˜¯ä¸€ä¸ª LazyComponent ç»„ä»¶ã€‚

ExoticComponent å¤–æ„Ÿç»„ä»¶ï¼š

    interface ExoticComponent<P = {}> {
        /**
         * **NOTE**: Exotic components are not callable.
         */
        (props: P): (ReactElement|null);
        readonly $$typeof: symbol;
    }

    interface NamedExoticComponent<P = {}> extends ExoticComponent<P> {
        displayName?: string;
    }

    interface ProviderExoticComponent<P> extends ExoticComponent<P> {
        propTypes?: WeakValidationMap<P>;
    }


    // will show `Memo(${Component.displayName || Component.name})` in devtools by default,
    // but can be given its own specific name
    type MemoExoticComponent<T extends ComponentType<any>> = NamedExoticComponent<ComponentPropsWithRef<T>> & {
        readonly type: T;
    };

    function memo<P extends object>(
        Component: SFC<P>,
        propsAreEqual?: (prevProps: Readonly<PropsWithChildren<P>>, nextProps: Readonly<PropsWithChildren<P>>) => boolean
    ): NamedExoticComponent<P>;

    function memo<T extends ComponentType<any>>(
        Component: T,
        propsAreEqual?: (prevProps: Readonly<ComponentProps<T>>, nextProps: Readonly<ComponentProps<T>>) => boolean
    ): MemoExoticComponent<T>;

    type LazyExoticComponent<T extends ComponentType<any>> = ExoticComponent<ComponentPropsWithRef<T>> & {
        readonly _result: T;
    };

    function lazy<T extends ComponentType<any>>(
        factory: () => Promise<{ default: T }>
    ): LazyExoticComponent<T>;


## StrictMode ä¸¥æ ¼æ¨¡å¼
- https://reactjs.org/docs/strict-mode.html

ä¸¥æ ¼æ¨¡å¼æ˜¯ä½¿ç”¨ StrictMode ç»„ä»¶æ¥çªå‡ºæ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­æ½œåœ¨é—®é¢˜çš„å·¥å…·ï¼Œä¸ Fragment ç»„ä»¶ä¸€æ ·ï¼ŒStrictMode ç»„ä»¶ä¸ä¼šå‘ˆç°ä»»ä½•å¯è§çš„ UI å…ƒç´ ï¼Œå®ƒä¸ºå…¶å­ä»£æ¿€æ´»æ£€æŸ¥å’Œè­¦å‘ŠåŠŸèƒ½ï¼Œå¹¶ä¸”è¿™åŠŸèƒ½åªåœ¨å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ•ˆã€‚

	import React from 'react';

	function ExampleApplication() {
	  return (
	      <React.StrictMode>
	        <div>
	          <ComponentOne />
	          <ComponentTwo />
	        </div>
	      </React.StrictMode>
	  );
	}

StrictMode åªå¯¹å­ç»„ä»¶æœ‰æ•ˆï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯ ComponentOne å’Œ ComponentTwoï¼Œè¿˜åŒ…å«å®ƒä»¬çš„å­ç»„ä»¶ã€‚

StrictMode å½“å‰å®ç°çš„åŠŸèƒ½ï¼š

- Identifying components with unsafe lifecycles
- Warning about legacy string ref API usage
- Warning about deprecated findDOMNode usage
- Detecting unexpected side effects
- Detecting legacy context API

React çš„å‡çº§å¯¹ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç»“æ„è¿›è¡Œäº†è°ƒæ•´ï¼Œåœ¨æ¿€æ´»ä¸¥æ ¼æ¨¡å¼åï¼Œä¼šé’ˆå¯¹ä½¿ç”¨ä¸å½“çš„ Life Cycle å‡½æ•°è¿›è¡Œæé†’å’Œè­¦å‘Šã€‚


ä¸ºä½¿ç”¨ä¼ ç»Ÿ API æ—¶æä¾›è­¦å‘Šä¿¡æ¯ï¼Œå¦‚ string ref API å’Œ callback API ä¸¤ç§è¿‡æ—¶çš„å¼•ç”¨æ–¹æ³•ï¼Œå°½ç®¡å®ƒå®ƒä»¬ç”¨æ¥æ–¹ä¾¿ï¼Œä½†æ˜¯ä¸è‰¯ååº”å¤šï¼Œæ‰€ä»¥å®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨ React 16.3 å¤§é‡æ·»åŠ äº†ç¬¬ä¸‰ç§é€‰æ‹©æ¥æ›¿ä»£ä¼ ç»Ÿçš„ APIï¼š

```ts
class MyComponent extends React.Component {
  constructor(props) {
    super(props);

    this.inputRef = React.createRef();
  }

  render() {
    return <input type="text" ref={this.inputRef} />;
  }

  componentDidMount() {
    this.inputRef.current.focus();
  }
}
```


è¿‡å» React æ”¯æŒ findDOMNode æ¥å®ç°æŸ¥æ‰¾å’Œå¼•ç”¨ DOM æ ‘çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯è¿™ç§åšæ³•å¯¹æ•´ä¸ªåº”ç”¨çš„æŠ½è±¡ç»“æ„å¤„ç†ä¸å¥½ã€‚å®ƒåªæ˜¯ä¸€æ¬¡æ‰§è¡Œçš„æ–¹æ³•ï¼Œå¦‚æœèŠ‚ç‚¹æ›´æ–°ï¼Œé‚£æ²¡æœ‰åŠæ³•å¤„ç†è¿™ç§å˜åŠ¨ã€‚

æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨å¼•ç”¨è½¬å‘ ref forwardingï¼š

```s
class MyComponent extends React.Component {
  constructor(props) {
    super(props);
    this.wrapper = React.createRef();
  }
  render() {
    return <div ref={this.wrapper}>{this.props.children}</div>;
  }
}
```


åœ¨ä¾¦æµ‹æ„å¤–å‰¯ä½œç”¨ä¸Šé¢ï¼Œæ¦‚å¿µä¸Šï¼ŒReact æ¶‰åŠä¸¤æ–¹é¢çš„å·¥ä½œï¼š

- render æ¸²æŸ“è¿‡ç¨‹ï¼Œç¡®å®šä»€ä¹ˆå˜åŠ¨äº†ï¼ŒReact è°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œç„¶åå’Œå‰é¢çš„ render è¿”å›å€¼æ¯”è¾ƒå·®åˆ«ï¼›
- commit æäº¤è¿‡ç¨‹ï¼ŒReact æä¾›å˜åŠ¨æ—¶å‘ç”Ÿï¼Œä»¥ React DOM æ¥è¯´å°±æ˜¯ React æ‰§è¡Œ inserts, updates, removes ç­‰ DOM æ“ä½œã€‚

æäº¤è¿‡ç¨‹é€šå¸¸å¾ˆå¿«é€Ÿï¼Œè¿™ä¸€è¿‡ç¨‹ä¼šè°ƒç”¨ componentDidMount å’Œ componentDidUpdate ç­‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚

ä½†æ¸²æŸ“å¯èƒ½å¾ˆæ…¢ï¼Œå› æ­¤ï¼Œå³å°†åˆ°æ¥çš„å¹¶å‘æ¨¡å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹å°šæœªå¯ç”¨ï¼ŒReconciliation åè°ƒå™¨å°†æ¸²æŸ“å·¥ä½œåˆ†è§£ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œå¯ä»¥æš‚åœã€ç»§ç»­å·¥ä½œä»¥é¿å…é˜»å¡æµè§ˆå™¨ã€‚è¿™æ„å‘³ç€ React å¯èƒ½ä¼šåœ¨æäº¤ä¹‹å‰å¤šæ¬¡è°ƒç”¨å‘ˆç°é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨æ ¹æœ¬ä¸æäº¤çš„æƒ…å†µä¸‹è°ƒç”¨å®ƒä»¬ï¼Œç”±äºé”™è¯¯æˆ–æ›´é«˜ä¼˜å…ˆçº§çš„ä¸­æ–­ã€‚

Render é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¦‚ä¸‹ï¼š

- constructor
- componentWillMount (or UNSAFE_componentWillMount)
- componentWillReceiveProps (or UNSAFE_componentWillReceiveProps)
- componentWillUpdate (or UNSAFE_componentWillUpdate)
- getDerivedStateFromProps
- shouldComponentUpdate
- render
- setState updater functions (the first argument)

å› ä¸ºå®ƒä»¬å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œæ‰€ä»¥ä¸èƒ½æœ‰å‰¯ä½œç”¨ side-effectsï¼Œå¤šæ¬¡è°ƒç”¨ç»“æœåº”è¯¥ä¸€è‡´ã€‚å¿½ç•¥è¿™ä¸€ç‚¹å¯èƒ½å¯¼è‡´ä¸¥é‡é—®é¢˜ï¼Œå¦‚æœå†…å­˜æ³„æ¼å’Œæ— æ•ˆçš„åº”ç”¨çŠ¶æ€ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œå¾ˆéš¾å‘ç°è¿™äº›é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬å¾€å¾€æ˜¯ä¸ç¡®å®šçš„ã€‚StrictMode ä¹Ÿä¸èƒ½è‡ªåŠ¨ä¾¦æµ‹åˆ°å‰¯ä½œç”¨ï¼Œä½†å®ƒå¯ä»¥æé«˜ä¸€ç‚¹ç¡®å®šæ€§ä»¥å¸®åŠ©èšé›†é—®é¢˜ã€‚è¿™ä¸€è¿‡ç¨‹å¯èƒ½ä¼šæ­¤å¼•ç”¨ä»¥ä¸‹æ–¹æ³•çš„äºŒæ¬¡è°ƒç”¨ double-invokingï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä½•åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¤šæ¬¡æ‰§è¡Œæ„é€ å‡½æ•°çš„ç°è±¡ï¼š

- Class component constructor, render, and shouldComponentUpdate methods
- Class component static getDerivedStateFromProps method
- Function component bodies
- State updater functions (the first argument to setState)
- Functions passed to useState, useMemo, or useReducer

ç¤ºä¾‹ä»£ç ï¼š

```ts
class TopLevelRoute extends React.Component {
  constructor(props) {
    super(props);

    SharedApplicationState.recordEvent('ExampleComponent');
  }
}
```

ä¹ä¸€çœ‹ï¼Œè¿™æ®µä»£ç ä¼¼ä¹æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœ SharedApplicationState.recordEvent ä¸æ˜¯å¹‚ç­‰çš„ idempotentï¼Œåˆ™å¤šæ¬¡å®ä¾‹åŒ–æ­¤ç»„ä»¶å¯èƒ½ä¼šå¯¼è‡´æ— æ•ˆçš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚è¿™ç§å¾®å¦™çš„ bug å¯èƒ½ä¸ä¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¡¨ç°å‡ºæ¥ï¼Œå¯èƒ½ä¼šå‰åä¸ä¸€è‡´ï¼Œå› æ­¤è¢«å¿½ç•¥ã€‚é€šè¿‡æœ‰æ„åœ°åŒé‡è°ƒç”¨ç»„ä»¶æ„é€ å‡½æ•°è¿™æ ·çš„æ–¹æ³•ï¼ŒStrictMode ä½¿å¾—è¿™æ ·çš„é—®é¢˜æ›´å®¹æ˜“å‘ç°ã€‚

ä» React 17 å¼€å§‹è‡ªåŠ¨ä¿®æ”¹æ§åˆ¶å°æ–¹æ³•ï¼Œå¦‚ console.log() ä»¥åœ¨å¯¹ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ç¬¬äºŒæ¬¡è°ƒç”¨ä¸­å…³é—­æ—¥å¿—ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨å˜é€šæ–¹æ³•å¤„ç† console å¯¹è±¡ï¼Œåˆ™å¯èƒ½ä¼šæœ‰æœŸæœ›å¤–çš„è¡Œä¸ºã€‚


æ­¤å¤–ï¼Œä¸¥æ ¼æ¨¡å¼æ£€æŸ¥è¿‡æ—¶çš„ Context API æç¤ºï¼Œå› ä¸ºä¼ ç»Ÿçš„ä¸Šä¸‹æ–‡ API å®¹æ˜“å‡ºé”™ï¼Œä¼šåœ¨åæœŸä¸»è¦çš„ç‰ˆæœ¬ä¸­ç§»å»ï¼Œä½†åœ¨ 16.x å‘å¸ƒç‰ˆæœ¬ä¸­ä»å¯ä»¥ä½¿ç”¨ã€‚





## HOC é«˜é˜¶ç»„ä»¶
- [React é«˜é˜¶ç»„ä»¶](https://react.docschina.org/docs/higher-order-components.html)
- [reactè¿›é˜¶ç³»åˆ—ï¼šé«˜é˜¶ç»„ä»¶è¯¦è§£ï¼ˆä¸€ï¼‰](https://segmentfault.com/a/1190000009937019)
- [ä¸ºä»€ä¹ˆ withRouter é«˜é˜¶ç»„ä»¶åº”è¯¥ å¤„äºæœ€å¤–å±‚ï¼Ÿ](https://zhuanlan.zhihu.com/p/36895827)
- [æ·±å…¥ç†è§£ React é«˜é˜¶ç»„ä»¶](https://zhuanlan.zhihu.com/p/24776678)


é«˜é˜¶ç»„ä»¶ HOC - High Order Components æ˜¯ React ä¸­ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„ä¸€ç§é«˜çº§æŠ€å·§ã€‚HOC è‡ªèº«ä¸æ˜¯ React API çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäº React çš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„è®¾è®¡æ¨¡å¼ã€‚

å…·ä½“è€Œè¨€ï¼Œé«˜é˜¶ç»„ä»¶æ˜¯å‚æ•°ä¸ºç»„ä»¶ï¼Œè¿”å›å€¼ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°ï¼Œè¿™å°±æ˜¯é«˜é˜¶ç»„ä»¶ï¼Œå³ä¸ç®¡å‚æ•°è¾“å…¥ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œè¾“å‡ºä¿æŒåŒæ ·ç±»å‹æ•°æ®ã€‚

	const EnhancedComponent = higherOrderComponent(WrappedComponent);

ç»„ä»¶æ˜¯å°† Props è½¬æ¢ä¸º UIï¼Œè€Œé«˜é˜¶ç»„ä»¶æ˜¯å°†ç»„ä»¶è½¬æ¢ä¸ºå¦ä¸€ä¸ªç»„ä»¶ã€‚ä½ å¯ä»¥æƒ³è±¡ï¼Œåœ¨ä¸€ä¸ªå¤§å‹åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ç§è®¢é˜… DataSource å’Œè°ƒç”¨ setState çš„æ¨¡å¼å°†ä¸€æ¬¡åˆä¸€æ¬¡åœ°å‘ç”Ÿã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŠ½è±¡ï¼Œå…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰è¿™ä¸ªé€»è¾‘ï¼Œå¹¶åœ¨è®¸å¤šç»„ä»¶ä¹‹é—´å…±äº«å®ƒã€‚è¿™æ­£æ˜¯é«˜é˜¶ç»„ä»¶æ“…é•¿çš„åœ°æ–¹ã€‚

è¯·æ³¨æ„ï¼ŒHOC ä¸ä¼šä¿®æ”¹ä¼ å…¥çš„ç»„ä»¶ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨ç»§æ‰¿æ¥å¤åˆ¶å…¶è¡Œä¸ºã€‚ç›¸åï¼ŒHOC é€šè¿‡å°†ç»„ä»¶åŒ…è£…åœ¨å®¹å™¨ç»„ä»¶ä¸­æ¥ç»„æˆæ–°ç»„ä»¶ã€‚HOC æ˜¯çº¯å‡½æ•°ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ï¼Œå³é›¶è€¦åˆã€‚è¢«åŒ…è£…ç»„ä»¶æ¥æ”¶æ¥è‡ªå®¹å™¨ç»„ä»¶çš„æ‰€æœ‰ propï¼ŒåŒæ—¶ä¹Ÿæ¥æ”¶ä¸€ä¸ªæ–°çš„ç”¨äº render çš„ data propã€‚HOC ä¸éœ€è¦å…³å¿ƒæ•°æ®çš„ä½¿ç”¨æ–¹å¼æˆ–åŸå› ï¼Œè€Œè¢«åŒ…è£…ç»„ä»¶ä¹Ÿä¸éœ€è¦å…³å¿ƒæ•°æ®æ˜¯æ€ä¹ˆæ¥çš„ã€‚


é¢å‘åˆ‡é¢ç¼–ç¨‹ AOP - Aspect-Oriented Programming æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œä»–é€šè¿‡å…è®¸åˆ†ç¦»ç¨‹åºçš„äº¤å‰å…³æ³¨ç‚¹ Cross-Cutting Concernsï¼Œç”¨æ¥å¢å¼ºç¨‹åºçš„æ¨¡å—æ€§ï¼Œä»–æ˜¯å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è¡¥å……ã€‚é€šè¿‡ AOP æˆ‘ä»¬å¯ä»¥å‡å°‘ä»£ç çš„é‡å¤ï¼Œä½¿ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘æ¸…æ™°ï¼Œå‡å°‘ç³»ç»Ÿé—´çš„ä¾èµ–ã€‚é¢å‘åˆ‡é¢ç¼–ç¨‹éœ€è¦æŠŠç¨‹åºçš„ä¸šåŠ¡é€»è¾‘æ‹†åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†ï¼ˆdistinct partï¼‰ï¼Œè¿™äº›ä¸åŒçš„éƒ¨åˆ†ä¹Ÿå«å…³æ³¨ç‚¹ã€‚

HOC è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹é—®é¢˜ï¼Œæ—§å¼ä½¿ç”¨ mixins æ¥è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹ç›¸å…³çš„é—®é¢˜ï¼Œä½†è¦æ„è¯†åˆ° mixins ä¼šäº§ç”Ÿæ›´å¤šéº»çƒ¦ã€‚


ç»„ä»¶æ˜¯ React ä¸­ä»£ç å¤ç”¨çš„åŸºæœ¬å•å…ƒï¼Œä½†ä½ ä¼šå‘ç°æŸäº›æ¨¡å¼å¹¶ä¸é€‚åˆä¼ ç»Ÿç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ª CommentList ç»„ä»¶ï¼Œå®ƒè®¢é˜…å¤–éƒ¨æ•°æ®æºï¼Œç”¨ä»¥æ¸²æŸ“è¯„è®ºåˆ—è¡¨ï¼š

```ts
class CommentList extends React.Component {
  constructor(props) {
    super(props);
    this.handleChange = this.handleChange.bind(this);
    this.state = {
      // "DataSource" is some global data source
      comments: DataSource.getComments()
    };
  }

  componentDidMount() {
    // Subscribe to changes
    DataSource.addChangeListener(this.handleChange);
  }

  componentWillUnmount() {
    // Clean up listener
    DataSource.removeChangeListener(this.handleChange);
  }

  handleChange() {
    // Update component state whenever the data source changes
    this.setState({
      comments: DataSource.getComments()
    });
  }

  render() {
    return (
      <div>
        {this.state.comments.map((comment) => (
          <Comment comment={comment} key={comment.id} />
        ))}
      </div>
    );
  }
}
```

ç¨åï¼Œç¼–å†™äº†ä¸€ä¸ªç”¨äºè®¢é˜…å•ä¸ªåšå®¢å¸–å­çš„ç»„ä»¶ï¼Œè¯¥å¸–å­éµå¾ªç±»ä¼¼çš„æ¨¡å¼ï¼š

```ts
class BlogPost extends React.Component {
  constructor(props) {
    super(props);
    this.handleChange = this.handleChange.bind(this);
    this.state = {
      blogPost: DataSource.getBlogPost(props.id)
    };
  }

  componentDidMount() {
    DataSource.addChangeListener(this.handleChange);
  }

  componentWillUnmount() {
    DataSource.removeChangeListener(this.handleChange);
  }

  handleChange() {
    this.setState({
      blogPost: DataSource.getBlogPost(this.props.id)
    });
  }

  render() {
    return <TextBlock text={this.state.blogPost} />;
  }
}
```

`CommentList` å’Œ `BlogPost` ä¸åŒ - å®ƒä»¬åœ¨ `DataSource` ä¸Šè°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œä¸”æ¸²æŸ“ä¸åŒçš„ç»“æœã€‚ä½†å®ƒä»¬çš„å¤§éƒ¨åˆ†å®ç°éƒ½æ˜¯ä¸€æ ·çš„ï¼š

- åœ¨æŒ‚è½½æ—¶ï¼Œå‘ `DataSource` æ·»åŠ ä¸€ä¸ªæ›´æ”¹ä¾¦å¬å™¨ã€‚
- åœ¨ä¾¦å¬å™¨å†…éƒ¨ï¼Œå½“æ•°æ®æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨ setStateã€‚
- åœ¨å¸è½½æ—¶ï¼Œåˆ é™¤ä¾¦å¬å™¨ã€‚

ä½ å¯ä»¥æƒ³è±¡ï¼Œåœ¨ä¸€ä¸ªå¤§å‹åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ç§è®¢é˜… `DataSource` å’Œè°ƒç”¨ setState çš„æ¨¡å¼å°†ä¸€æ¬¡åˆä¸€æ¬¡åœ°å‘ç”Ÿã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŠ½è±¡ï¼Œå…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰è¿™ä¸ªé€»è¾‘ï¼Œå¹¶åœ¨è®¸å¤šç»„ä»¶ä¹‹é—´å…±äº«å®ƒï¼Œè¿™æ­£æ˜¯é«˜é˜¶ç»„ä»¶æ“…é•¿çš„åœ°æ–¹ã€‚


å¯¹äºè®¢é˜…äº† `DataSource` çš„ç»„ä»¶ï¼Œæ¯”å¦‚ `CommentList` å’Œ `BlogPost`ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåˆ›å»ºç»„ä»¶å‡½æ•°ã€‚è¯¥å‡½æ•°å°†æ¥å—ä¸€ä¸ªå­ç»„ä»¶ä½œä¸ºå®ƒçš„å…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å­ç»„ä»¶å°†è®¢é˜…æ•°æ®ä½œä¸º propã€‚

å‡å®šé«˜é˜¶å‡½æ•°å‘½åä¸º `withSubscription`ï¼š

```ts
const CommentListWithSubscription = withSubscription(
  CommentList,
  (DataSource) => DataSource.getComments()
);

const BlogPostWithSubscription = withSubscription(
  BlogPost,
  (DataSource, props) => DataSource.getBlogPost(props.id)
);
```

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«åŒ…è£…ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°é€šè¿‡ DataSource å’Œå½“å‰çš„ props è¿”å›æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚

å½“æ¸²æŸ“ç»è¿‡ HoC å°è£…çš„ `CommentListWithSubscription` å’Œ `BlogPostWithSubscription` æ—¶ï¼Œå°†å‘ `CommentList` å’Œ `BlogPost` ä¼ é€’ä¸€ä¸ª data propï¼Œå…¶ä¸­åŒ…å«ä» `DataSource` æ£€ç´¢åˆ°çš„æœ€æ–°æ•°æ®ï¼š


```ts
// This function takes a component...
function withSubscription(WrappedComponent, selectData) {
  // ...and returns another component...
  return class extends React.Component {
    constructor(props) {
      super(props);
      this.handleChange = this.handleChange.bind(this);
      this.state = {
        data: selectData(DataSource, props)
      };
    }

    componentDidMount() {
      // ... that takes care of the subscription...
      DataSource.addChangeListener(this.handleChange);
    }

    componentWillUnmount() {
      DataSource.removeChangeListener(this.handleChange);
    }

    handleChange() {
      this.setState({
        data: selectData(DataSource, this.props)
      });
    }

    render() {
      // ... and renders the wrapped component with the fresh data!
      // Notice that we pass through any additional props
      return <WrappedComponent data={this.state.data} {...this.props} />;
    }
  };
}
```

è¯·æ³¨æ„ï¼ŒHOC ä¸ä¼šä¿®æ”¹ä¼ å…¥çš„ç»„ä»¶ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨ç»§æ‰¿æ¥å¤åˆ¶å…¶è¡Œä¸ºã€‚ç›¸åï¼ŒHOC é€šè¿‡å°†ç»„ä»¶åŒ…è£…åœ¨å®¹å™¨ç»„ä»¶ä¸­æ¥ç»„æˆæ–°ç»„ä»¶ã€‚HOC æ˜¯çº¯å‡½æ•°ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ã€‚

è¢«åŒ…è£…ç»„ä»¶æ¥æ”¶æ¥è‡ªå®¹å™¨ç»„ä»¶çš„æ‰€æœ‰ propï¼ŒåŒæ—¶ä¹Ÿæ¥æ”¶ä¸€ä¸ªæ–°çš„ï¼Œç”¨äº render çš„ data propã€‚HOC ä¸éœ€è¦å…³å¿ƒæ•°æ®çš„ä½¿ç”¨æ–¹å¼æˆ–åŸå› ï¼Œè€Œè¢«åŒ…è£…ç»„ä»¶ä¹Ÿä¸éœ€è¦å…³å¿ƒæ•°æ®æ˜¯æ€ä¹ˆæ¥çš„ã€‚

å› ä¸º `withSubscription` æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦å¯¹å‚æ•°è¿›è¡Œå¢æ·»æˆ–è€…åˆ é™¤ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä½¿ data prop çš„åç§°å¯é…ç½®ï¼Œä»¥è¿›ä¸€æ­¥å°† HOC ä¸åŒ…è£…ç»„ä»¶éš”ç¦»å¼€æ¥ã€‚æˆ–è€…ä½ å¯ä»¥æ¥å—ä¸€ä¸ªé…ç½® `shouldComponentUpdate` çš„å‚æ•°ï¼Œæˆ–è€…ä¸€ä¸ªé…ç½®æ•°æ®æºçš„å‚æ•°ã€‚å› ä¸º HOC å¯ä»¥æ§åˆ¶ç»„ä»¶çš„å®šä¹‰æ–¹å¼ï¼Œè¿™ä¸€åˆ‡éƒ½å˜å¾—æœ‰å¯èƒ½ã€‚

ä¸ç»„ä»¶ä¸€æ ·ï¼Œ`withSubscription` å’ŒåŒ…è£…ç»„ä»¶ä¹‹é—´çš„å¥‘çº¦å®Œå…¨åŸºäºä¹‹é—´ä¼ é€’çš„ propsã€‚è¿™ç§ä¾èµ–æ–¹å¼ä½¿å¾—æ›¿æ¢ HOC å˜å¾—å®¹æ˜“ï¼Œåªè¦å®ƒä»¬ä¸ºåŒ…è£…çš„ç»„ä»¶æä¾›ç›¸åŒçš„ prop å³å¯ã€‚ä¾‹å¦‚ä½ éœ€è¦æ”¹ç”¨å…¶ä»–åº“æ¥è·å–æ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸€ç‚¹å°±å¾ˆæœ‰ç”¨ã€‚


### ğŸ‘‰ Donâ€™t Mutate the Original Component


ä¸è¦è¯•å›¾åœ¨ HOC ä¸­ä¿®æ”¹ç»„ä»¶åŸå‹ï¼Œæˆ–ä»¥å…¶ä»–æ–¹å¼æ”¹å˜å®ƒï¼Œè€Œåº”è¯¥ä½¿ç”¨ç»„åˆã€‚

```ts
function logProps(InputComponent) {
  InputComponent.prototype.componentDidUpdate = function(prevProps) {
    console.log('Current props: ', this.props);
    console.log('Previous props: ', prevProps);
  };
  // è¿”å›ä¿®æ”¹è¿‡çš„ç»„ä»¶
  return InputComponent;
}
// æ¯æ¬¡è°ƒç”¨ logProps æ—¶ï¼Œå¢å¼ºç»„ä»¶éƒ½ä¼šæœ‰ log è¾“å‡ºã€‚
const EnhancedComponent = logProps(InputComponent);
```

è¿™æ ·åšä¼šäº§ç”Ÿä¸€äº›ä¸è‰¯åæœï¼Œå…¶ä¸€æ˜¯è¾“å…¥ç»„ä»¶å†ä¹Ÿæ— æ³•åƒ HOC å¢å¼ºä¹‹å‰é‚£æ ·ä½¿ç”¨äº†ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œå¦‚æœä½ å†ç”¨å¦ä¸€ä¸ªåŒæ ·ä¼šä¿®æ”¹ componentDidUpdate çš„ HOC å¢å¼ºå®ƒï¼Œé‚£ä¹ˆå‰é¢çš„ HOC å°±ä¼šå¤±æ•ˆï¼åŒæ—¶ï¼Œè¿™ä¸ª HOC ä¹Ÿæ— æ³•åº”ç”¨äºæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°ç»„ä»¶ã€‚

ä¿®æ”¹ä¼ å…¥ç»„ä»¶çš„ HOC æ˜¯ä¸€ç§ç³Ÿç³•çš„æŠ½è±¡æ–¹å¼ï¼Œè°ƒç”¨è€…å¿…é¡»çŸ¥é“ä»–ä»¬æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥é¿å…ä¸å…¶ä»– HOC å‘ç”Ÿå†²çªã€‚


æ°å½“çš„åšæ³•æ˜¯ä½¿ç”¨ç»„åˆçš„æ–¹å¼ï¼Œé€šè¿‡å°†ç»„ä»¶åŒ…è£…åœ¨å®¹å™¨ç»„ä»¶ä¸­å®ç°åŠŸèƒ½ï¼š

```ts
function logProps(WrappedComponent) {
  return class extends React.Component {
    componentDidUpdate(prevProps) {
      console.log('Current props: ', this.props);
      console.log('Previous props: ', prevProps);
    }
    render() {
      // Wraps the input component in a container, without mutating it. Good!
      return <WrappedComponent {...this.props} />;
    }
  }
}
```

è¯¥ HOC çš„å®ç°æ¯”å‰é¢ä¿®æ”¹ä¼ å…¥ç»„ä»¶çš„ HOC è™½ç„¶åŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¯é¿å…äº†å‡ºç°å†²çªçš„æƒ…å†µï¼Œè€Œä¸”é€‚ç”¨äº class ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶ï¼Œè€Œä¸”å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå®ƒå¯ä»¥ä¸å…¶ä»– HOC ç»„åˆï¼Œç”šè‡³å¯ä»¥ä¸å…¶è‡ªèº«ç»„åˆã€‚

æ³¨æ„ HOC ä¸å®¹å™¨ç»„ä»¶æ¨¡å¼ä¹‹é—´æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œå®¹å™¨ç»„ä»¶æ‹…ä»»å°†é«˜çº§ã€ä½çº§å…³æ³¨ç‚¹åˆ†ç¦»çš„è´£ä»»ï¼Œç”±å®¹å™¨ç®¡ç†è®¢é˜…å’ŒçŠ¶æ€ï¼Œå¹¶å°† prop ä¼ é€’ç»™å¤„ç† UI çš„ç»„ä»¶ã€‚HOC ä½¿ç”¨å®¹å™¨ä½œä¸ºå…¶å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œä½ å¯ä»¥å°† HOC è§†ä¸ºå‚æ•°åŒ–å®¹å™¨ç»„ä»¶ã€‚


### ğŸ‘‰ Convention: Pass Unrelated Props Through to the Wrapped Component

çº¦å®šï¼šå°†ä¸ç›¸å…³çš„ props ä¼ é€’ç»™è¢«åŒ…è£¹çš„ç»„ä»¶ï¼Œè¿™ç§çº¦å®šä¿è¯äº† HOC çš„çµæ´»æ€§ä»¥åŠå¯å¤ç”¨æ€§ã€‚

HOC ä¸ºç»„ä»¶æ·»åŠ ç‰¹æ€§ï¼Œè‡ªèº«ä¸åº”è¯¥å¤§å¹…æ”¹å˜çº¦å®šï¼ŒHOC è¿”å›çš„ç»„ä»¶ä¸åŸç»„ä»¶åº”ä¿æŒç±»ä¼¼çš„æ¥å£ã€‚

HOC åº”è¯¥é€ä¼ ä¸è‡ªèº«æ— å…³çš„ propsã€‚

å¤§å¤šæ•° HOC éƒ½åº”è¯¥åŒ…å«ä¸€ä¸ªç±»ä¼¼äºä¸‹é¢çš„ render æ–¹æ³•ï¼š

```ts
render() {
  // Filter out extra props that are specific to this HOC and shouldn't be
  // passed through
  const { extraProp, ...passThroughProps } = this.props;

  // Inject props into the wrapped component. These are usually state values or
  // instance methods.
  const injectedProp = someStateOrInstanceMethod;

  // Pass props to wrapped component
  return (
    <WrappedComponent
      injectedProp={injectedProp}
      {...passThroughProps}
    />
  );
}
```

### ğŸ‘‰ Convention: Maximizing Composability

æ‰€æœ‰ HOC å¹¶ééƒ½ä¸€æ ·ï¼Œæœ‰æ—¶å€™å®ƒä»…æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¢«åŒ…è£¹çš„ç»„ä»¶ï¼š

	const NavbarWithRouter = withRouter(Navbar);

HOC é€šå¸¸å¯ä»¥æ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œæ¯”å¦‚åœ¨ Relay ä¸­ï¼ŒHOC é¢å¤–æ¥æ”¶äº†ä¸€ä¸ªé…ç½®å¯¹è±¡ç”¨äºæŒ‡å®šç»„ä»¶çš„æ•°æ®ä¾èµ–ï¼š

	const CommentWithRelay = Relay.createContainer(Comment, config);

æœ€å¸¸è§çš„ HOC ç­¾åå¦‚ä¸‹ï¼š

	// React Redux's `connect`
	const ConnectedComment = connect(commentSelector, commentActions)(CommentList);

è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå¦‚æœä½ æŠŠæ‹¬å·åˆ†å¼€ï¼Œå°±ä¼šæ›´å®¹æ˜“çœ‹å‡ºå‘ç”Ÿäº†ä¸¤æ¬¡å‡½æ•°è°ƒç”¨ã€‚

æ¢å¥è¯è¯´ï¼Œconnect æ˜¯ä¸€ä¸ªè¿”å›é«˜é˜¶ç»„ä»¶çš„é«˜é˜¶å‡½æ•°ï¼

è¿™ç§å½¢å¼å¯èƒ½çœ‹èµ·æ¥ä»¤äººå›°æƒ‘æˆ–ä¸å¿…è¦ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªæœ‰ç”¨çš„å±æ€§ã€‚ åƒ connect å‡½æ•°è¿”å›çš„å•å‚æ•° HOC å…·æœ‰ç­¾å Component => Componentã€‚ è¾“å‡ºç±»å‹ä¸è¾“å…¥ç±»å‹ç›¸åŒçš„å‡½æ•°å¾ˆå®¹æ˜“ç»„åˆåœ¨ä¸€èµ·ã€‚

è€Œä¸æ˜¯ä»¥ä¸‹è¿™æ ·ï¼š

	// Instead of doing this...
	const EnhancedComponent = withRouter(connect(commentSelector)(WrappedComponent))

ä½ å¯ä»¥ç¼–å†™ç»„åˆå·¥å…·å‡½æ•°

	// ... you can use a function composition utility
	// compose(f, g, h) is the same as (...args) => f(g(h(...args)))
	const enhance = compose(
	  // These are both single-argument HOCs
	  withRouter,
	  connect(commentSelector)
	)
	const EnhancedComponent = enhance(WrappedComponent)


ä½¿ç”¨å…ƒç¼–ç¨‹å…è®¸ connect å’Œå…¶ä»– HOC æ‰¿æ‹…è£…é¥°å™¨çš„è§’è‰²ï¼Œ@connect è¿™æ ·ç›´æ¥æ”¾åœ¨è¦è°ƒç”¨çš„å‡½æ•°å‰ä¸€è¡Œï¼Œè£…é¥°å™¨æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ JavaScript ææ¡ˆï¼Œä½†åœ¨å…¶å®ƒè¯­è¨€ç‰¹åˆ«æ˜¯ Javaã€Python ç­‰éå¸¸æµè¡Œã€‚

è®¸å¤šç¬¬ä¸‰æ–¹åº“éƒ½æä¾›äº† compose å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬ lodashï¼Œæ¯”å¦‚ lodash.flowRightï¼Œè¿˜æœ‰ Redux å’Œ Ramdaã€‚



### ğŸ‘‰ HoC å…¶å®ƒæ³¨æ„äº‹é¡¹


æç¤ºï¼Œå°† Display Name åŒ…è£…åœ¨ HoC ç»„ä»¶å†…ï¼Œè¿™æ ·å¯ä»¥æ˜¾ç¤ºåœ¨ DevTools é¢æ¿ä¸Šï¼Œæ–¹ä¾¿è°ƒè¯•ä½¿ç”¨ã€‚

```ts
function withSubscription(WrappedComponent) {
  class WithSubscription extends React.Component {/* ... */}
  WithSubscription.displayName = `WithSubscription(${getDisplayName(WrappedComponent)})`;
  return WithSubscription;
}

function getDisplayName(WrappedComponent) {
  return WrappedComponent.displayName || WrappedComponent.name || 'Component';
}
```


é«˜é˜¶ç»„ä»¶æœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¯¹äº React æ–°æ‰‹æ¥è¯´å¯èƒ½å¹¶ä¸å®¹æ˜“å‘ç°ã€‚

ä¸è¦åœ¨ render æ–¹æ³•ä¸­ä½¿ç”¨ HOCï¼Œ å› ä¸º React çš„ diff ç®—æ³•å³åè°ƒå™¨ä½¿ç”¨ç»„ä»¶æ ‡è¯†æ¥ç¡®å®šå®ƒæ˜¯åº”è¯¥æ›´æ–°ç°æœ‰å­æ ‘ï¼Œè¿˜æ˜¯å°†å…¶ä¸¢å¼ƒå¹¶æŒ‚è½½æ–°å­æ ‘ã€‚å¦‚æœä» render è¿”å›çš„ç»„ä»¶ä¸å‰ä¸€ä¸ªæ¸²æŸ“ä¸­çš„ç»„ä»¶ç›¸åŒï¼Œä½¿ç”¨ === æ¯”è¾ƒå¾—åˆ°å®Œå…¨ç›¸åŒï¼Œåˆ™ React é€šè¿‡å°†å­æ ‘ä¸æ–°å­æ ‘è¿›è¡ŒåŒºåˆ†æ¥é€’å½’æ›´æ–°å­æ ‘ã€‚ å¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ï¼Œåˆ™å®Œå…¨å¸è½½å‰ä¸€ä¸ªå­æ ‘ã€‚

é€šå¸¸ï¼Œä½ ä¸éœ€è¦è€ƒè™‘è¿™ç‚¹ã€‚ä½†å¯¹ HOC æ¥è¯´è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œæ¯æ¬¡è°ƒç”¨ render å‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œè¿™ä»£è¡¨ç€ä½ ä¸åº”åœ¨ç»„ä»¶çš„ render æ–¹æ³•ä¸­å¯¹ä¸€ä¸ªç»„ä»¶åº”ç”¨ HOCï¼š

```ts
render() {
  // EnhancedComponent1 !== EnhancedComponent2
  const EnhancedComponent = enhance(MyComponent);
  return <EnhancedComponent />;
}
```

è¿™ä¸ä»…ä»…æ˜¯æ€§èƒ½é—®é¢˜ - é‡æ–°æŒ‚è½½ç»„ä»¶ä¼šå¯¼è‡´è¯¥ç»„ä»¶åŠå…¶æ‰€æœ‰å­ç»„ä»¶çš„çŠ¶æ€ä¸¢å¤±ã€‚

å¦‚æœåœ¨ç»„ä»¶ä¹‹å¤–åˆ›å»º HOCï¼Œè¿™æ ·ä¸€æ¥ç»„ä»¶åªä¼šåˆ›å»ºä¸€æ¬¡ã€‚å› æ­¤ï¼Œæ¯æ¬¡ render æ—¶éƒ½ä¼šæ˜¯åŒä¸€ä¸ªç»„ä»¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™è·Ÿä½ çš„é¢„æœŸè¡¨ç°æ˜¯ä¸€è‡´çš„ã€‚

åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œä½ éœ€è¦åŠ¨æ€è°ƒç”¨ HOCã€‚ä½ å¯ä»¥åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æˆ–å…¶æ„é€ å‡½æ•°ä¸­è¿›è¡Œè°ƒç”¨ã€‚


åŠ¡å¿…å¤åˆ¶é™æ€æ–¹æ³•ï¼ 

æœ‰æ—¶åœ¨ React ç»„ä»¶ä¸Šå®šä¹‰é™æ€æ–¹æ³•å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼ŒRelay å®¹å™¨æš´éœ²äº†ä¸€ä¸ªé™æ€æ–¹æ³• getFragment ä»¥æ–¹ä¾¿ç»„åˆ GraphQL ç‰‡æ®µã€‚

ä½†æ˜¯ï¼Œå½“ä½ å°† HOC åº”ç”¨äºç»„ä»¶æ—¶ï¼ŒåŸå§‹ç»„ä»¶å°†ä½¿ç”¨å®¹å™¨ç»„ä»¶è¿›è¡ŒåŒ…è£…ï¼Œè¿™æ„å‘³ç€æ–°ç»„ä»¶æ²¡æœ‰åŸå§‹ç»„ä»¶çš„ä»»ä½•é™æ€æ–¹æ³•ã€‚

```ts
// Define a static method
WrappedComponent.staticMethod = function() {/*...*/}
// Now apply a HOC
const EnhancedComponent = enhance(WrappedComponent);

// The enhanced component has no static method
typeof EnhancedComponent.staticMethod === 'undefined' // true
```


è§£å†³æ–¹æ³•æ˜¯ï¼Œåœ¨è¿”å›ä¹‹å‰æŠŠè¿™äº›æ–¹æ³•æ‹·è´åˆ°å®¹å™¨ç»„ä»¶ä¸Šï¼š

```ts
function enhance(WrappedComponent) {
  class Enhance extends React.Component {/*...*/}
  // Must know exactly which method(s) to copy :(
  Enhance.staticMethod = WrappedComponent.staticMethod;
  return Enhance;
}
```


ä½†è¦è¿™æ ·åšï¼Œä½ éœ€è¦çŸ¥é“å“ªäº›æ–¹æ³•åº”è¯¥è¢«æ‹·è´ã€‚ä½ å¯ä»¥ä½¿ç”¨ hoist-non-react-statics è‡ªåŠ¨æ‹·è´æ‰€æœ‰é React é™æ€æ–¹æ³•:

```ts
import hoistNonReactStatic from 'hoist-non-react-statics';
function enhance(WrappedComponent) {
  class Enhance extends React.Component {/*...*/}
  hoistNonReactStatic(Enhance, WrappedComponent);
  return Enhance;
}

```


é™¤äº†å¯¼å‡ºç»„ä»¶ï¼Œå¦ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆæ˜¯å†é¢å¤–å¯¼å‡ºè¿™ä¸ªé™æ€æ–¹æ³•ã€‚

```js
// Instead of...
MyComponent.someFunction = someFunction;
export default MyComponent;

// ...export the method separately...
export { someFunction };

// ...and in the consuming module, import both
import MyComponent, { someFunction } from './MyComponent.js';
```


æ³¨æ„ï¼Œå¼•ç”¨ Refs ä¸ä¼šè¢«ä¼ é€’ï¼Œè™½ç„¶é«˜é˜¶ç»„ä»¶çš„çº¦å®šæ˜¯å°†æ‰€æœ‰ props ä¼ é€’ç»™è¢«åŒ…è£…ç»„ä»¶ï¼Œä½†è¿™å¯¹äº refs å¹¶ä¸é€‚ç”¨ã€‚å› ä¸º ref å®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ª prop - å°±åƒ key ä¸€æ ·ï¼Œå®ƒæ˜¯ç”± React ä¸“é—¨å¤„ç†çš„ã€‚å¦‚æœå°† ref æ·»åŠ åˆ° HOC çš„è¿”å›ç»„ä»¶ä¸­ï¼Œåˆ™ ref å¼•ç”¨æŒ‡å‘å®¹å™¨ç»„ä»¶ï¼Œè€Œä¸æ˜¯è¢«åŒ…è£…ç»„ä»¶ã€‚

è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ React 16.3 ä¸­å¼•å…¥çš„å¼•ç”¨è½¬å‘ React.forwardRef APIã€‚




### ğŸ‘‰ å…¶å®ƒæ¨¡å—çš„é«˜é˜¶å‡½æ•°ä»‹ç»

HOC åœ¨ React çš„ç¬¬ä¸‰æ–¹åº“ä¸­å¾ˆå¸¸è§ï¼Œä¾‹å¦‚ Redux çš„ connect å’Œ Relay çš„ createFragmentContainerã€‚

åœ¨ React è·¯ç”±ä¸­é«˜é˜¶ç»„ä»¶è¿˜æœ‰å…ƒç¼–ç¨‹ Meta Programming è¿™æ ·ä¸€ç§å†™æ³•ï¼Œ@withRouterï¼Œæ•ˆæœå°±æ˜¯æŠŠè·¯ç”±ç›¸å…³çš„æ–¹æ³•é€šè¿‡ Props ä¼ ç»™å®ƒåŒ…è£¹çš„ç»„ä»¶çš„ Props ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç¼–è¯‘è¿‡ç¨‹è‡ªåŠ¨å¤„ç†çš„ã€‚

è·Ÿ withRouter(component) æ˜¯ä¸€ä¸ªæ•ˆæœï¼Œå°±æ˜¯åŠ å±‚ç»„ä»¶å°è£…ï¼Œä»¥ä¸‹åˆ—å­è¡¨ç¤ºç»™ Demo ç»„ä»¶å¤–åŠ ä¸€ä¸ª withRouter ç»„ä»¶åŒ…è£¹èµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ Demo ç»„ä»¶ä¸­ä½¿ç”¨è·¯ç”±äº†ã€‚

	import { createHashHistory } from 'history';
	const history = createHashHistory();
	...
    <ConnectedRouter history={history}>{router()}</ConnectedRouter>

React åšå›½é™…åŒ–ï¼Œå¸¸ç”¨ React-intl , è¿™ä¸ªåº“æä¾›äº† React ç»„ä»¶å’ŒApiä¸¤ç§æ–¹å¼æ¥æ ¼å¼åŒ–æ—¥æœŸï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²ç­‰ã€‚

	import React, { Component } from 'react';
	import { Link, withRouter } from 'react-router-dom';
	import { FormattedMessage, injectIntl } from 'react-intl';

	@injectIntl
	@withRouter
	export default class Demo extends Component { 
		// User Component ... 

		constructor(props) {
			super(props);
			console.log('Demo constructor...', this.props);
			this.clickHandler = this.clickHandler.bind(this);
		}

		clickHandler = (e) => {
			// è·¯ç”±è·³è½¬
			this.props.history.push('/account/setting');
		}
	}

ä½¿ç”¨å…ƒç¼–ç¨‹ @withRouter è¿™ç§å†™æ³•ï¼Œéœ€è¦å®‰è£…ä¸€ä¸ªåŒ…ï¼š 

	cnpm i babel-plugin-transform-decorators-legacy -S

Redux æä¾›äº†ä¸¤ä¸ª HOCï¼Œconnect å’Œ compose

	connect([mapStateToProps], [mapDispatchToProps], [mergeProps],[options])

mapStateToProps è¿™é‡Œä¼ å…¥çš„å‡½æ•°å…è®¸æˆ‘ä»¬å°† store ä¸­çš„æ•°æ®ä½œä¸º props ç»‘å®šåˆ°ç»„ä»¶ä¸Šã€‚

ï¼ˆ1ï¼‰è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ Redux çš„ storeï¼Œæˆ‘ä»¬ä»ä¸­æ‘˜å–äº† count å±æ€§ã€‚ä½ ä¸å¿…å°† state ä¸­çš„æ•°æ®åŸå°ä¸åŠ¨åœ°ä¼ å…¥ç»„ä»¶ï¼Œå¯ä»¥æ ¹æ® state ä¸­çš„æ•°æ®ï¼ŒåŠ¨æ€åœ°è¾“å‡ºç»„ä»¶éœ€è¦çš„ï¼ˆæœ€å°ï¼‰å±æ€§ã€‚

ï¼ˆ2ï¼‰å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•° ownPropsï¼Œæ˜¯ç»„ä»¶è‡ªå·±çš„ propsã€‚æœ‰çš„æ—¶å€™ï¼ŒownProps ä¹Ÿä¼šå¯¹å…¶äº§ç”Ÿå½±å“ã€‚

å½“ state å˜åŒ–ï¼Œæˆ–è€… ownProps å˜åŒ–çš„æ—¶å€™ï¼ŒmapStateToProps éƒ½ä¼šè¢«è°ƒç”¨ï¼Œè®¡ç®—å‡ºä¸€ä¸ªæ–°çš„ statePropsï¼Œï¼ˆåœ¨ä¸ ownProps merge åï¼‰æ›´æ–°ç»™ç»„ä»¶ã€‚

connect çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ mapDispatchToPropsï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ï¼Œå°† action ä½œä¸º props ç»‘å®šåˆ°ç»„ä»¶ä¸Šï¼Œä¹Ÿä¼šæˆä¸º MyComp çš„ propsã€‚

ä¸ç®¡æ˜¯ stateProps è¿˜æ˜¯ dispatchPropsï¼Œéƒ½éœ€è¦å’Œ ownProps merge ä¹‹åæ‰ä¼šè¢«èµ‹ç»™ç»„ä»¶ã€‚connect çš„ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ç”¨æ¥åšè¿™ä»¶äº‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä¸ä¼ è¿™ä¸ªå‚æ•°ï¼Œconnect å°±ä¼šä½¿ç”¨ Object.assign æ›¿ä»£è¯¥æ–¹æ³•ã€‚

	import { connect } from 'react-redux';
	import { compose } from 'redux';

	// ...

	const mapDispatchToProps = {
	  userLogin,
	};

	const mapStateToProps = (state) => {
	  return { loginResult: state.login };
	};

	const withConnect = connect(
	  mapStateToProps,
	  mapDispatchToProps
	);

	const withReducer = injectReducer({ key: 'login', reducer });

	export default compose(
	  withReducer,
	  withConnect
	)(UserLogin);


## Render Prop æ¨¡å¼
- [Render Prop](https://reactjs.org/docs/render-props.html)
- [Render Prop](https://react.docschina.org/docs/render-props.html)
- [PropTypes ç±»å‹æ£€æŸ¥](https://react.docschina.org/docs/typechecking-with-proptypes.html)

å®ç°ç»„ä»¶å¯å¤ç”¨çš„æœ€å¥½æ–¹å¼ï¼Œæ˜¯å°†ç»„ä»¶çš„ children æ”¾åˆ°å‡½æ•°ä¸­å»ï¼Œæˆ–è€…åˆ©ç”¨ç»„ä»¶ render å±æ€§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Render å›è°ƒä¹Ÿè¢«ç§°ä¸ºå‡½æ•°å­ç»„ä»¶ã€‚

é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œrender å±æ€§æ˜¯å› ä¸ºè¿™ç§æ¨¡å¼æ‰è¢«ç§°ä¸º Render Prop æ¨¡å¼ï¼Œä¸ä¸€å®šè¦ç”¨åä¸º render çš„ prop æ¥ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚äº‹å®ä¸Šï¼Œ ä»»ä½•è¢«ç”¨äºå‘ŠçŸ¥ç»„ä»¶éœ€è¦æ¸²æŸ“ä»€ä¹ˆå†…å®¹çš„å‡½æ•°ï¼Œé€šè¿‡å±æ€§æ¥ä¼ å…¥ï¼Œè¿™åœ¨æŠ€æœ¯ä¸Šéƒ½å¯ä»¥è¢«ç§°ä¸º Render Propï¼Œå…¸å‹çš„ React Router å°±åœ¨ Route ç»„ä»¶ä½¿ç”¨è¿™æ ·çš„æŠ€æœ¯ã€‚

ä¹Ÿå¯ä»¥ç®€å•åœ°ä½¿ç”¨ children è¿™ä¸ªé»˜è®¤çš„ Slot æ’æ§½å±æ€§ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹å¼éƒ½æ˜¯å¯ä»¥çš„ï¼Œä¸€ä¸ªæ ‡ç­¾å†…åµŒçš„æ‰€æœ‰ç»„ä»¶éƒ½ä¼šé€šè¿‡ props.children å±æ€§ä¼ å…¥ï¼š

	<Mouse children={mouse => (
	  <Cat mouse={mouse} />
	)}/>

	<Mouse>
	  {mouse => (
	    <p>é¼ æ ‡çš„ä½ç½®æ˜¯ {mouse.x}ï¼Œ{mouse.y}</p>
	  )}
	</Mouse>

åœ¨ react-motion çš„ API ä¸­çœ‹åˆ°æ­¤æŠ€æœ¯çš„åº”ç”¨ã€‚ç”±äºè¿™ä¸€æŠ€æœ¯çš„ç‰¹æ®Šæ€§ï¼Œå½“ä½ åœ¨è®¾è®¡ä¸€ä¸ªç±»ä¼¼çš„ API æ—¶ï¼Œä½ æˆ–è®¸ä¼šè¦ä½¿ç”¨ PropTypes ç±»å‹æ£€æŸ¥ï¼Œå£°æ˜ children çš„ç±»å‹åº”ä¸ºä¸€ä¸ªå‡½æ•°ã€‚

	Mouse.propTypes = {
	  children: PropTypes.func.isRequired
	};

åƒ Flow å’Œ TypeScript ç­‰è¿™äº›é™æ€ç±»å‹æ£€æŸ¥å™¨ï¼Œå¯ä»¥åœ¨è¿è¡Œå‰è¯†åˆ«æŸäº›ç±»å‹çš„é—®é¢˜ã€‚ä»–ä»¬è¿˜å¯ä»¥é€šè¿‡å¢åŠ è‡ªåŠ¨è¡¥å…¨ç­‰åŠŸèƒ½æ¥æ”¹å–„å¼€å‘è€…çš„å·¥ä½œæµç¨‹ã€‚å»ºè®®åœ¨å¤§å‹ä»£ç åº“ä¸­ä½¿ç”¨ Flow æˆ– TypeScript æ¥ä»£æ›¿ PropTypesã€‚

Flow æ˜¯ä¸€ä¸ªé’ˆå¯¹ JavaScript ä»£ç çš„é™æ€ç±»å‹æ£€æµ‹å™¨ã€‚Flow ç”± Facebook å¼€å‘ï¼Œç»å¸¸ä¸ React ä¸€èµ·ä½¿ç”¨ã€‚Flow é€šè¿‡ç‰¹æ®Šçš„ç±»å‹è¯­æ³•ä¸ºå˜é‡ï¼Œå‡½æ•°ï¼Œä»¥åŠ React ç»„ä»¶æä¾›æ³¨è§£ï¼Œå¸®åŠ©ä½ å°½æ—©åœ°å‘ç°é”™è¯¯ã€‚

TypeScript æ˜¯ä¸€ç§ç”±å¾®è½¯å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ã€‚å®ƒæ˜¯ JavaScript çš„ä¸€ä¸ªç±»å‹è¶…é›†ï¼ŒåŒ…å«ç‹¬ç«‹çš„ç¼–è¯‘å™¨ã€‚ä½œä¸ºä¸€ç§ç±»å‹è¯­è¨€ï¼ŒTypeScript å¯ä»¥åœ¨æ„å»ºæ—¶å‘ç° bug å’Œé”™è¯¯ï¼Œè¿™æ ·ç¨‹åºè¿è¡Œæ—¶å°±å¯ä»¥é¿å…æ­¤ç±»é”™è¯¯ã€‚

å…³äº render prop ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…æ˜¯ä½ å¯ä»¥ä½¿ç”¨å¸¦æœ‰ render prop çš„å¸¸è§„ç»„ä»¶æ¥å®ç°å¤§å¤šæ•°é«˜é˜¶ç»„ä»¶ (HOC)ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨ withMouse HOC è€Œä¸æ˜¯ `<Mouse>` ç»„ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¸¦æœ‰ render prop çš„å¸¸è§„ `<Mouse>` è½»æ¾åˆ›å»ºä¸€ä¸ªï¼š

	// å¦‚æœä½ å‡ºäºæŸç§åŸå› çœŸçš„æƒ³è¦ HOCï¼Œé‚£ä¹ˆä½ å¯ä»¥è½»æ¾å®ç°
	// ä½¿ç”¨å…·æœ‰ render prop çš„æ™®é€šç»„ä»¶åˆ›å»ºä¸€ä¸ªï¼
	function withMouse(Component) {
	  return class extends React.Component {
	    render() {
	      return (
	        <Mouse render={mouse => (
	          <Component {...this.props} mouse={mouse} />
	        )}/>
	      );
	    }
	  }
	}

å°† Render Props ä¸ React.PureComponent ä¸€èµ·ä½¿ç”¨æ—¶è¦å°å¿ƒã€‚å¦‚æœä½ åœ¨ render æ–¹æ³•é‡Œåˆ›å»ºå‡½æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨ render prop ä¼šæŠµæ¶ˆä½¿ç”¨ React.PureComponent å¸¦æ¥çš„ä¼˜åŠ¿ã€‚å› ä¸ºæµ…æ¯”è¾ƒ props çš„æ—¶å€™æ€»ä¼šå¾—åˆ° falseï¼Œå¹¶ä¸”åœ¨è¿™ç§æƒ…å†µä¸‹æ¯ä¸€ä¸ª render å¯¹äº render prop å°†ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å€¼ã€‚æ¯æ¬¡ `<MouseTracker>` æ¸²æŸ“ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•°ä½œä¸º `<Mouse render>` çš„ propï¼Œå› è€Œåœ¨åŒæ—¶ä¹ŸæŠµæ¶ˆäº†ç»§æ‰¿è‡ª React.PureComponent çš„ `<Mouse>` ç»„ä»¶çš„æ•ˆæœï¼


ä»¥ä¸‹ä»£ç æ¥ä¹‹å®˜æ–¹æ–‡æ¡£ï¼Œ`Mouse` ç»„ä»¶å®ç°é¼ æ ‡åæ ‡çš„è·å–ï¼Œä¸ºäº†å°†è¿™ç§åæ ‡è·å–çš„èƒ½åŠ›åº”ç”¨åˆ°å…¶ä»–ç»„ä»¶ä¸Šï¼Œå¦‚ `Cat` è¿™ä¸ªç»„ä»¶ï¼Œä¸å¿…å°†è¿™äº›ç»„ä»¶ç¡¬ç¼–ç åˆ°ä¸€èµ·ï¼Œåªéœ€è¦åœ¨ä½¿ç”¨ `Mouse` ç»„ä»¶æ—¶åœ¨ä¸€å±æ€§æŒ‡å®šéœ€è¦æ¸²æŸ“çš„ç»„ä»¶ï¼Œåœ¨ `Mouse` ç»„ä»¶çš„ `render` å‡½æ•°å°†å…¶æ¸²æŸ“ã€‚React æ¨å´‡çš„ç»„åˆç¼–ç æ€æƒ³ï¼Œé€šè¿‡å°†ä¸åŒçš„ç»„ä»¶ä»¥çµæ´»çš„ç»„åˆæ–¹å¼è¿›è¡Œæ•´åˆï¼Œæ—¢æ–¹ä¾¿å¯¹ç›®æ ‡ç»„ä»¶çš„åŠŸèƒ½æ‰©å±•åˆæ–¹ä¾¿å¯¹ç»„ä»¶åŸæœ‰åŠŸèƒ½çš„ä¿®æ”¹ã€‚è¿™æ ·åœ¨åç»­çš„ `Dog`ã€`Pig` ç»„ä»¶å°±ä¸éœ€è¦å¯¹ `Mouse` è¿›è¡Œä¿®æ”¹äº†ã€‚

Render Prop çš„æ¥å†ï¼šæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªå¸¦æœ‰æ¸²æŸ“å‡½æ•°çš„ `<Mouse>` ç»„ä»¶ï¼Œå®ƒèƒ½å¤ŸåŠ¨æ€å†³å®šä»€ä¹ˆéœ€è¦æ¸²æŸ“çš„ï¼Œè€Œä¸æ˜¯å°† `<Cat>` ç¡¬ç¼–ç åˆ° `<Mouse>`ç»„ä»¶é‡Œï¼Œå¹¶æœ‰æ•ˆåœ°æ”¹å˜å®ƒçš„æ¸²æŸ“ç»“æœã€‚

	class Cat extends React.Component {
	  render() {
	    const mouse = this.props.mouse;
	    return (
	      <img src="/cat.jpg" style={{ position: 'absolute', left: mouse.x, top: mouse.y }} />
	    );
	  }
	}

	class Mouse extends React.Component {
	  constructor(props) {
	    super(props);
	    this.handleMouseMove = this.handleMouseMove.bind(this);
	    this.state = { x: 0, y: 0 };
	  }

	  handleMouseMove(event) {
	    this.setState({
	      x: event.clientX,
	      y: event.clientY
	    });
	  }

	  render() {
	    return (
	      <div style={{ height: '100%' }} onMouseMove={this.handleMouseMove}>
	        {/*
	          Instead of providing a static representation of what <Mouse> renders,
	          use the `render` prop to dynamically determine what to render.
	        */}
	        {this.props.render(this.state)}
	      </div>
	    );
	  }
	}

	class MouseTracker extends React.Component {
	  render() {
	    return (
	      <div>
	        <h1>ç§»åŠ¨é¼ æ ‡!</h1>
	        <Mouse render={mouse => (
	          <Cat mouse={mouse} />
	        )}/>
	      </div>
	    );
	  }
	}

è¿™é¡¹æŠ€æœ¯ä½¿æˆ‘ä»¬å…±äº«è¡Œä¸ºéå¸¸å®¹æ˜“ï¼Œè¦è·å¾—è¿™ä¸ªè¡Œä¸ºï¼Œåªè¦æ¸²æŸ“ä¸€ä¸ªå¸¦æœ‰ render prop çš„ `<Mouse>` ç»„ä»¶å°±èƒ½å¤Ÿå‘Šè¯‰å®ƒå½“å‰é¼ æ ‡åæ ‡ (x, y) è¦æ¸²æŸ“ä»€ä¹ˆã€‚


## Accessibility æ— éšœç¢è¾…åŠ©åŠŸèƒ½
- https://reactjs.org/docs/accessibility.html
- https://zh-hans.reactjs.org/docs/accessibility.html
- https://www.w3.org/WAI/intro/aria
- https://www.w3.org/WAI/intro/wcag

ç½‘ç»œæ— éšœç¢è¾…åŠ©åŠŸèƒ½ï¼ˆAccessibilityï¼Œä¹Ÿè¢«ç§°ä¸º a11yï¼Œå› ä¸ºä»¥ A å¼€å¤´ï¼Œä»¥ Y ç»“å°¾ï¼Œä¸­é—´ä¸€å…± 11 ä¸ªå­—æ¯ï¼‰æ˜¯ä¸€ç§å¯ä»¥å¸®åŠ©æ‰€æœ‰äººè·å¾—æœåŠ¡çš„è®¾è®¡å’Œåˆ›é€ ã€‚æ— éšœç¢è¾…åŠ©åŠŸèƒ½æ˜¯ä½¿å¾—è¾…åŠ©æŠ€æœ¯æ­£ç¡®è§£è¯»ç½‘é¡µçš„å¿…è¦æ¡ä»¶ã€‚

React å¯¹äºåˆ›å»ºå¯è®¿é—®ç½‘ç«™æœ‰ç€å…¨é¢çš„æ”¯æŒï¼Œè€Œè¿™é€šå¸¸æ˜¯é€šè¿‡æ ‡å‡† HTML æŠ€æœ¯å®ç°çš„ã€‚


ç½‘ç»œå†…å®¹æ— éšœç¢æŒ‡å—ï¼ˆWeb Content Accessibility Guidelinesï¼ŒWCAGï¼‰ ä¸ºå¼€å‘æ— éšœç¢ç½‘ç«™æä¾›äº†æŒ‡å—ã€‚

ä¸‹é¢çš„ WCAG æ£€æŸ¥è¡¨æä¾›äº†ä¸€äº›æ¦‚è§ˆï¼š

- Wuhcag æä¾›çš„ WCAG æ£€æŸ¥è¡¨ https://www.wuhcag.com/wcag-checklist/
- WebAIM æä¾›çš„ WCAG æ£€æŸ¥è¡¨ https://webaim.org/standards/wcag/checklist
- A11Y Project æä¾›çš„æ£€æŸ¥è¡¨ https://a11yproject.com/checklist.html


WAI-ARIA ç½‘ç»œæ— éšœç¢å€¡è®® - æ— éšœç¢äº’è”ç½‘åº”ç”¨ï¼ˆWeb Accessibility Initiative - Accessible Rich Internet Applicationsï¼‰ æ–‡ä»¶åŒ…å«äº†åˆ›å»ºå®Œå…¨æ— éšœç¢ JavaScript éƒ¨ä»¶æ‰€éœ€è¦çš„æŠ€æœ¯ã€‚

æ³¨æ„ï¼šJSX æ”¯æŒæ‰€æœ‰ HTML aria å±æ€§ã€‚è™½ç„¶å¤§å¤šæ•° React çš„ DOM å˜é‡å’Œå±æ€§å‘½åéƒ½ä½¿ç”¨é©¼å³°å‘½åï¼ˆcamelCasedï¼‰ï¼Œä½† aria åº”è¯¥åƒå…¶åœ¨ HTML ä¸­ä¸€æ ·ä½¿ç”¨å¸¦è¿å­—ç¬¦çš„å‘½åæ³•ï¼ˆä¹Ÿå«è¯¸å¦‚ hyphen-casedï¼Œkebab-caseï¼Œlisp-case)ã€‚

```html
<input
  type="text"
  aria-label={labelText}
  aria-required="true"
  onChange={onchangeHandler}
  value={inputValue}
  name="name"
/>
```

### ğŸ‘‰ Semantic HTML è¯­ä¹‰åŒ–

è¯­ä¹‰åŒ–çš„ HTML æ˜¯æ— éšœç¢è¾…åŠ©åŠŸèƒ½ç½‘ç»œåº”ç”¨çš„åŸºç¡€ã€‚ åˆ©ç”¨å¤šç§ HTML å…ƒç´ æ¥å¼ºåŒ–æ‚¨ç½‘ç«™ä¸­çš„ä¿¡æ¯é€šå¸¸å¯ä»¥ä½¿æ‚¨ç›´æ¥è·å¾—æ— éšœç¢è¾…åŠ©åŠŸèƒ½ã€‚

æœ‰æ—¶ï¼Œè¯­ä¹‰åŒ–çš„ HTML ä¼šè¢«ç ´åã€‚æ¯”å¦‚å½“åœ¨ JSX ä¸­ä½¿ç”¨ div å…ƒç´ æ¥å®ç° React ä»£ç åŠŸèƒ½çš„æ—¶å€™ï¼Œåˆæˆ–æ˜¯åœ¨ä½¿ç”¨åˆ—è¡¨ï¼ˆolï¼Œ ul å’Œ dlï¼‰å’Œ HTML table æ—¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ React Fragments æ¥ç»„åˆå„ä¸ªç»„ä»¶ï¼Œè€Œé¿å…é¢å¤–æ·»åŠ èŠ‚ç‚¹å…ƒç´ ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```ts
import React, { Fragment } from 'react';

function ListItem({ item }) {
  return (
    <Fragment>
      <dt>{item.term}</dt>
      <dd>{item.description}</dd>
    </Fragment>
  );
}

function Glossary(props) {
  return (
    <dl>
      {props.items.map(item => (
        <ListItem item={item} key={item.id} />
      ))}
    </dl>
  );
}
```


å’Œå…¶ä»–çš„å…ƒç´ ä¸€æ ·ï¼Œä½ å¯ä»¥æŠŠä¸€ç³»åˆ—çš„å¯¹è±¡æ˜ å°„åˆ°ä¸€ä¸ª fragment çš„æ•°ç»„ä¸­ã€‚

```ts
function Glossary(props) {
  return (
    <dl>
      {props.items.map(item => (
        // Fragments should also have a `key` prop when mapping collections
        <Fragment key={item.id}>
          <dt>{item.term}</dt>
          <dd>{item.description}</dd>
        </Fragment>
      ))}
    </dl>
  );
}
```


å½“ä½ ä¸éœ€è¦åœ¨ fragment æ ‡ç­¾ä¸­æ·»åŠ ä»»ä½• prop ä¸”ä½ çš„å·¥å…·æ”¯æŒçš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ çŸ­è¯­æ³•ï¼š

```ts
function ListItem({ item }) {
  return (
    <>
      <dt>{item.term}</dt>
      <dd>{item.description}</dd>
    </>
  );
}
```


### ğŸ‘‰ Accessible Forms æ— éšœç¢è¡¨å•



### ğŸ‘‰ Focus Control



### ğŸ‘‰ Mouse and pointer events



### ğŸ‘‰ More Complex Widgets



### ğŸ‘‰ Other Points for Consideration



### ğŸ‘‰ Development and Testing Tools






## Fragments ç‰‡æ®µå…ƒç´ 
- https://reactjs.org/docs/fragments.html


React ä¸­çš„ä¸€ä¸ªå¸¸è§æ¨¡å¼æ˜¯ä¸€ä¸ªç»„ä»¶è¿”å›å¤šä¸ªå…ƒç´ ï¼ŒFragments å…è®¸ä½ å°†å­åˆ—è¡¨åˆ†ç»„ï¼Œè€Œæ— éœ€å‘ DOM æ·»åŠ é¢å¤–èŠ‚ç‚¹ï¼Œå°±åƒ Vue çš„ Template æ ‡ç­¾æˆ–å¾®ä¿¡å°ç¨‹åºçš„ block æ ‡ç­¾ä¸€æ ·ï¼Œä¸æ¸²æŸ“ä»»ä½•çš„ UI å…ƒç´ ã€‚

```ts
render() {
  return (
    <React.Fragment>
      <ChildA />
      <ChildB />
      <ChildC />
    </React.Fragment>
  );
}
```

è¿˜æœ‰ä¸€ç§æ–°çš„çŸ­è¯­æ³•å¯ç”¨äºå£°æ˜å®ƒä»¬ã€‚

```ts
class Columns extends React.Component {
  render() {
    return (
      <>
      <ChildA />
      <ChildB />
      <ChildC />
      </>
    );
  }
}
```

ä½¿ç”¨æ˜¾å¼ <React.Fragment> è¯­æ³•å£°æ˜çš„ç‰‡æ®µå¯èƒ½å…·æœ‰ keyï¼Œä¸€ä¸ªä½¿ç”¨åœºæ™¯æ˜¯å°†ä¸€ä¸ªé›†åˆæ˜ å°„åˆ°ä¸€ä¸ª Fragments æ•°ç»„.

ä¸¾ä¸ªä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ªæè¿°åˆ—è¡¨ï¼š

```ts
function Glossary(props) {
  return (
    <dl>
      {props.items.map(item => (
        <React.Fragment key={item.id}>
          <dt>{item.term}</dt>
          <dd>{item.description}</dd>
        </React.Fragment>
      ))}
    </dl>
  );
}
```

key æ˜¯å”¯ä¸€å¯ä»¥ä¼ é€’ç»™ Fragment çš„å±æ€§ã€‚æœªæ¥æˆ‘ä»¬å¯èƒ½ä¼šæ·»åŠ å¯¹å…¶ä»–å±æ€§çš„æ”¯æŒï¼Œä¾‹å¦‚äº‹ä»¶ã€‚




## Portal ç»„ä»¶ç§»ä½è£…è½½
- https://reactjs.org/docs/portals.html
- W3C DOM Level 3 Events https://www.w3.org/TR/DOM-Level-3-Events/

Portal æä¾›äº†ä¸€ç§å°†å­èŠ‚ç‚¹æ¸²æŸ“åˆ°ç°å­˜çš„çˆ¶ç»„ä»¶ä»¥å¤– DOM èŠ‚ç‚¹çš„ä¸€æµæ–¹æ³•ã€‚

	ReactDOM.createPortal(child, container)

ç¬¬ä¸€ä¸ªå‚æ•° child æ˜¯ä»»ä½•å¯æ¸²æŸ“çš„å­å…ƒç´ ï¼Œä¾‹å¦‚ä¸€ä¸ª Elementï¼Œå­—ç¬¦ä¸²æˆ– Fragmentï¼Œç¬¬äºŒä¸ªå‚æ•° container æ˜¯ä¸€ä¸ª DOM å…ƒç´ ã€‚

é€šå¸¸æ¥è®²ï¼Œä»ç»„ä»¶çš„ render æ–¹æ³•è¿”å›ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä½œä¸ºå­èŠ‚ç‚¹æŒ‚è½½åˆ° DOM èŠ‚ç‚¹ä¸­ï¼Œå¹¶ç¦»å…¶ç»„ä»¶çˆ¶èŠ‚ç‚¹æœ€è¿‘ä½ç½®ï¼š

```js
render() {
  // React mounts a new div and renders the children into it
  return (
    <div>
      {this.props.children}
    </div>
  );
}
```

æœ‰æ—¶ï¼Œåœ¨ DOM ä¸åŒä½ç½®æ’å…¥å­èŠ‚ç‚¹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼š

```js
let domNode = document.getElementById("domNode");

render() {
  // React does *not* create a new div. It renders the children into `domNode`.
  // `domNode` is any valid DOM node, regardless of its location in the DOM.
  return ReactDOM.createPortal(
    this.props.children,
    domNode
  );
}
```

ä¸€ä¸ªå…¸å‹çš„ç”¨ä¾‹ï¼Œæ˜¯çˆ¶ç»„ä»¶æœ‰ overflow: hidden æˆ– z-index æ ·å¼æ—¶ï¼Œå­ç»„ä»¶ä¸èƒ½è¶…çˆ¶ç»„ä»¶èŒƒå›´æ˜¾ç¤ºã€‚æ‰€ä»¥ Portal å¯ä»¥å¸®åŠ©å­ç»„ä»¶åœ¨è§†è§‰ä¸Šè·³å‡ºå…¶çˆ¶ç»„ä»¶å®¹å™¨ã€‚

æ³¨æ„: å½“åœ¨ä½¿ç”¨ portal æ—¶, è®°ä½ç®¡ç†é”®ç›˜ç„¦ç‚¹å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚å¯¹äºæ¨¡æ€å¯¹è¯æ¡†ï¼Œé€šè¿‡éµå¾ª WAI-ARIA æ¨¡æ€å¼€å‘å®è·µï¼Œæ¥ç¡®ä¿æ¯ä¸ªäººéƒ½èƒ½å¤Ÿè¿ç”¨å®ƒã€‚

åœ¨ Portals ä¸­ä½¿ç”¨äº‹ä»¶å†’æ³¡ Event Bubblingï¼Œé¦–å…ˆè¦æ˜ç™½ DOM çš„äº‹ä»¶æµç¨‹æ¨¡å‹ï¼Œå‚è€ƒ React çš„äº‹ä»¶å¤„ç†ã€‚

æµè§ˆå™¨çš„ DOM äº‹ä»¶è§¦å‘æµç¨‹æœ‰ä¸‰ä¸ªæ ‡å‡†æµç¨‹ï¼š

- The capture phase: äº‹ä»¶å¯æ•æŠ“æœŸï¼Œäº‹ä»¶å¯¹è±¡ä»é¡¶çº§èŠ‚ç‚¹å¾€æœ«ç«¯è§¦å‘äº‹ä»¶èŠ‚ç‚¹çš„ä¸Šçº§æŸ¥è¯¢ captue æ–¹å¼æ³¨å†Œçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼›
- The target phase: å¦‚æœäº‹ä»¶æ²¡æœ‰è¢«æ•æŠ“å°±è¿›å…¥è§¦å‘äº‹ä»¶çš„ç›®æ ‡æ³¨å†Œçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼›
- The bubble phase: å¦‚æœæ²¡æœ‰å¤„ç†å‡½æ•°æˆ–è€…å¤„ç†å‡½æ•°æ²¡æœ‰æŒ‡æ˜ç¦æ­¢å†’æ³¡ï¼Œäº‹ä»¶å°±å¾€çˆ¶çº§è¿›è¡Œå†’æ³¡æµç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å…è®¸å…¶å®ƒçˆ¶çº§çš„èŠ‚ç‚¹æœ‰æœºä¼šå¤„ç†äº‹ä»¶ï¼›


å°½ç®¡ portal å¯ä»¥è¢«æ”¾ç½®åœ¨ DOM æ ‘ä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œä½†åœ¨å…¶ä»–æ–¹é¢çš„è¡Œä¸ºå’Œæ™®é€šçš„ React å­èŠ‚ç‚¹è¡Œä¸ºä¸€è‡´ã€‚ç”±äº Portal ç»„ä»¶ä»å­˜åœ¨äº React ç»„ä»¶æ ‘ä¸­ï¼Œä¸”ä¸ DOM æ ‘ä¸­çš„ä½ç½®æ— å…³ï¼Œé‚£ä¹ˆæ— è®ºå…¶å­èŠ‚ç‚¹æ˜¯å¦æ˜¯ Portalï¼Œåƒ Context API è¿™æ ·çš„åŠŸèƒ½ç‰¹æ€§éƒ½æ˜¯ä¸å˜çš„ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº‹ä»¶å†’æ³¡æµç¨‹ã€‚

ä¸€ä¸ªä» Portal ç»„ä»¶å†…éƒ¨è§¦å‘çš„äº‹ä»¶ï¼Œä¼šä¸€ç›´å†’æ³¡è‡³åŒ…å« React æ ‘çš„é¡¶å±‚ï¼Œå³ä¾¿è¿™äº›å…ƒç´ å¹¶ä¸æ˜¯ DOM æ ‘ä¸­çš„é¡¶å±‚ã€‚

å‡è®¾å­˜åœ¨å¦‚ä¸‹ HTML ç»“æ„ï¼š

```html
<html>
  <body>
    <div id="app-root"></div>
    <div id="modal-root"></div>
  </body>
</html>
```

åœ¨ #app-root é‡Œçš„ Parent ç»„ä»¶å³ body èŠ‚ç‚¹èƒ½å¤Ÿæ•è·åˆ°æœªè¢«æ•è·çš„ä»å…„å¼ŸèŠ‚ç‚¹ #modal-root å†’æ³¡ä¸Šæ¥çš„äº‹ä»¶ã€‚


å†’æ³¡äº‹ä»¶ç¤ºèŒƒï¼Œåœ¨çº¿è¿è¡Œç¤ºèŒƒç¨‹åº https://codepen.io/gaearon/pen/jGBWpE


```tsx
import React from 'react';
import ReactDOM from 'react-dom';

// These two containers are siblings in the DOM
const appRoot = document.getElementById('app-root');

// const modalRoot = document.getElementById('modal-root');
const modalRoot = document.createElement('div');
modalRoot.id = 'modal-root';
document.body.appendChild(modalRoot);

class Modal extends React.Component {
  el:HTMLElement
  constructor(props:any) {
    super(props);
    this.el = document.createElement('div');
  }

  componentDidMount() {
    // The portal element is inserted in the DOM tree after
    // the Modal's children are mounted, meaning that children
    // will be mounted on a detached DOM node. If a child
    // component requires to be attached to the DOM tree
    // immediately when mounted, for example to measure a
    // DOM node, or uses 'autoFocus' in a descendant, add
    // state to Modal and only render the children when Modal
    // is inserted in the DOM tree.
    modalRoot.appendChild(this.el);
  }

  componentWillUnmount() {
    modalRoot.removeChild(this.el);
  }

  render() {
    return ReactDOM.createPortal(
      this.props.children,
      this.el
    );
  }
}

class Parent extends React.Component<{}, {clicks:number}> {
  constructor(props:any) {
    super(props);
    this.state = {clicks: 0};
    this.handleClick = this.handleClick.bind(this);
  }

  handleClick() {
    // This will fire when the button in Child is clicked,
    // updating Parent's state, even though button
    // is not direct descendant in the DOM.
    this.setState(state => ({
      clicks: state.clicks + 1
    }));
  }

  render() {
    return (
      <div className="board bgDark cLight" onClick={this.handleClick}>
        <p>Number of clicks: {this.state.clicks}</p>
        <p>
          Open up the browser DevTools
          to observe that the button
          is not a child of the div
          with the onClick handler.
        </p>
        <Modal>
          <Child />
        </Modal>
      </div>
    );
  }
}

function Child() {
  // The click event on this button will bubble up to parent,
  // because there is no 'onClick' attribute defined
  return (
    <div className="modal board">
      <button>Click</button>
    </div>
  );
}

ReactDOM.render(<Parent />, appRoot);
```


å¯¹è¯æ¡†ã€æ‚¬æµ®å¡ä»¥åŠæç¤ºæ¡†ç¤ºèŒƒï¼Œåœ¨çº¿è¿è¡Œç¤ºèŒƒç¨‹åº https://codepen.io/gaearon/pen/yzMaBd?editors=0010

```jsx
// These two containers are siblings in the DOM
const appRoot = document.getElementById('app-root');
const modalRoot = document.getElementById('modal-root');

// Let's create a Modal component that is an abstraction around
// the portal API.
class Modal extends React.Component {
  constructor(props) {
    super(props);
    // Create a div that we'll render the modal into. Because each
    // Modal component has its own element, we can render multiple
    // modal components into the modal container.
    this.el = document.createElement('div');
  }

  componentDidMount() {
    // Append the element into the DOM on mount. We'll render
    // into the modal container element (see the HTML tab).
    modalRoot.appendChild(this.el);
  }

  componentWillUnmount() {
    // Remove the element from the DOM when we unmount
    modalRoot.removeChild(this.el);
  }
  
  render() {
    // Use a portal to render the children into the element
    return ReactDOM.createPortal(
      // Any valid React child: JSX, strings, arrays, etc.
      this.props.children,
      // A DOM element
      this.el,
    );
  }
}

// The Modal component is a normal React component, so we can
// render it wherever we like without needing to know that it's
// implemented with portals.
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {showModal: false};
    
    this.handleShow = this.handleShow.bind(this);
    this.handleHide = this.handleHide.bind(this);
  }

  handleShow() {
    this.setState({showModal: true});
  }
  
  handleHide() {
    this.setState({showModal: false});
  }

  render() {
    // Show a Modal on click.
    // (In a real app, don't forget to use ARIA attributes
    // for accessibility!)
    const modal = this.state.showModal ? (
      <Modal>
        <div className="modal">
          <div>
            With a portal, we can render content into a different
            part of the DOM, as if it were any other React child.
          </div>
          This is being rendered inside the #modal-container div.
          <button onClick={this.handleHide}>Hide modal</button>
        </div>
      </Modal>
    ) : null;

    return (
      <div className="app">
        This div has overflow: hidden.
        <button onClick={this.handleShow}>Show modal</button>
        {modal}
      </div>
    );
  }
}

ReactDOM.render(<App />, appRoot);
```




## Profiler æ€§èƒ½å‰–æç»„ä»¶
- https://reactjs.org/docs/profiler.html
- https://reactjs.org/docs/hooks-faq.html#how-to-memoize-calculations

Profiler æ€§èƒ½å‰–æç»„ä»¶ç”¨æ¥åˆ†æ React åº”ç”¨çš„æ€§èƒ½ï¼Œåˆ†ææ—¶é—´æ¶ˆè€—ï¼Œä¸»è¦ç”¨æ¥åœ¨æ€§èƒ½æœ‰é—®é¢˜çš„ç»„ä»¶ä¸Šã€‚

Profiler ä¼šå¢åŠ ä¸€äº›é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤åœ¨ç”Ÿäº§æ„å»ºä¸­æ˜¯ç¦ç”¨çš„ï¼Œè¦åœ¨æ„å»ºç‰ˆæœ¬ä½¿ç”¨å‰–æåŠŸèƒ½ï¼ŒReact æä¾›äº†ä¸€ä¸ªç‰¹åˆ«çš„ç”Ÿäº§ç‰ˆæœ¬ã€‚

åŸºæœ¬ç”¨æ³•ï¼š

```tsx
let profile:React.ProfilerOnRenderCallback = (id, 
	phase, actualDuration, baseDuration, commitTime, iteractions) => {
  console.log(id, phase, actualDuration, baseDuration, commitTime, iteractions);
}

let Appp = () => (
  <React.Profiler id="Navigation" onRender={profile}>
    <App />
  </React.Profiler>)
```

æ¯ä¸ª Profiler å¯ä»¥è®¾ç½®ä¸€ä¸ª onRender å›è°ƒå‡½æ•°æ¥æ¥æ”¶å‰–ææ•°æ®ï¼ŒåµŒå¥—çš„å°±æ˜¯è¦è¢«åˆ†æçš„ç»„ä»¶ã€‚

å¯ä»¥ä½¿ç”¨å¤šä¸ª Profiler å¯¹ä¸åŒçš„éƒ¨åˆ†è¿›è¡Œåˆ†æï¼Œæˆ–è€…è¿›è¡ŒåµŒå¥—çš„åˆ†æï¼š

```tsx
render(
  <App>
    <Profiler id="Panel" onRender={callback}>
      <Panel {...props}>
        <Profiler id="Content" onRender={callback}>
          <Content {...props} />
        </Profiler>
        <Profiler id="PreviewPane" onRender={callback}>
          <PreviewPane {...props} />
        </Profiler>
      </Panel>
    </Profiler>
  </App>
);
```

æ¥çœ‹çœ‹ onRender å›è°ƒå‡½æ•°ï¼Œå®ƒæ˜¯å¿…éœ€çš„ï¼Œå½“è¢«åˆ†æçš„ç»„ä»¶æœ‰ commits æˆ– update è¡Œä¸ºæ—¶ä¼šè°ƒç”¨ï¼Œå„ä¸ªå‚æ•°æ„ä¹‰å¦‚ä¸‹ï¼š

```ts
function onRenderCallback(
  id, // the "id" prop of the Profiler tree that has just committed
  phase, // either "mount" (if the tree just mounted) or "update" (if it re-rendered)
  actualDuration, // time spent rendering the committed update
  baseDuration, // estimated time to render the entire subtree without memoization
  startTime, // when React began rendering this update
  commitTime, // when React committed this update
  interactions // the Set of interactions belonging to this update
) {
  // Aggregate or log render timings...
}
```

- **id**: string - äº§ç”Ÿåˆ†æç»“æœçš„ Profiler çš„ id å±æ€§ï¼›
- **phase**: "mount" | "update" - ç¡®å®šåˆ†æå‘ç”Ÿçš„é˜¶æ®µï¼Œæ˜¯ç¬¬ä¸€æ¬¡åŠ è½½ mount æˆ–è€…åç»­æ›´æ–° updateï¼›
- **actualDuration**: number - å½“å‰åˆ†æç»„ä»¶æ›´æ–°è¿‡ç¨‹æ¶ˆè€—çš„æ—¶é—´ï¼Œé€šå¸¸åœ¨é¦–æ¬¡åŠ è½½åçš„æ•°æ®ä¼šä¸‹é™ï¼Œå¯ä»¥è¡¨æ˜ä½¿ç”¨ç¼“å­˜æ•ˆæœï¼Œå¦‚ React.memo, useMemo ç­‰ï¼›
- **baseDuration**: number - åœ¨ Profiler æ ‘ä¸­æœ€è¿‘ä¸€æ¬¡æ‰€æœ‰ç»„ä»¶çš„ render æŒç»­æ—¶é—´ã€‚
- **startTime**: number - å½“å‰æ¸²æŸ“åŠ¨ä½œå¼€å§‹çš„æ—¶é—´æˆ³ Timestampã€‚
- **commitTime**: number - æäº¤åŠ¨ä½œå‘ç”Ÿçš„æ—¶é—´æˆ³ Timestampã€‚
- **interactions**: Set - åŒ…å« interactions è¢«è¿½è¸ªçš„äº¤äº’é›†åˆï¼Œåœ¨æ›´æ–°ä»»åŠ¡å¤„äºè®¡åˆ’æ—¶ï¼Œå¦‚ render æˆ– setState è°ƒç”¨æ—¶ã€‚

Interactions èƒ½ç”¨æ¥è¯†åˆ«æ›´æ–°æ˜¯ç”±ä»€ä¹ˆå¼•èµ·çš„ï¼Œå°½ç®¡è¿™ä¸ªè¿½è¸ªæ›´æ–°çš„ API ä¾ç„¶æ˜¯å®éªŒæ€§è´¨çš„ã€‚



## Context API ç»„ä»¶é€šä¿¡
- [Context API](https://react.docschina.org/docs/context.html)

åœ¨ React 16.3 å¸¦æ¥äº† Context APIï¼Œé€šè¿‡å®ƒå®ç°åœ¨å¤šä¸ªç»„ä»¶è·å–åŒä¸€ç»„æ•°æ®, å¯ä»¥çœç•¥é€šè¿‡ä¸­é—´å…ƒç´ ä¼ é€’ Propsï¼Œç›´æ¥åœ¨éœ€è¦ä½¿ç”¨ Context æ•°æ®çš„æ·±å±‚å­ç»„ä»¶ä¸­æ¶ˆè´¹æ•°æ®ã€‚

Context ä¸»è¦åº”ç”¨åœºæ™¯åœ¨äºå¾ˆå¤šä¸åŒå±‚çº§çš„ç»„ä»¶éœ€è¦è®¿é—®åŒæ ·ä¸€äº›çš„æ•°æ®ã€‚ä½†è¯·è°¨æ…ä½¿ç”¨ï¼Œä¼šå¢åŠ ç»„ä»¶çš„è€¦åˆæ€§ï¼Œè¿™ä¼šä½¿å¾—ç»„ä»¶çš„å¤ç”¨æ€§å˜å·®ã€‚

å¦‚æœä½ åªæ˜¯æƒ³é¿å…å±‚å±‚ä¼ é€’ä¸€äº›å±æ€§ï¼Œå±‚å±‚ä¼ é€’è¿™ä¸ª Props å°±æ˜¾å¾—éå¸¸å†—ä½™ï¼Œç»„ä»¶ç»„åˆ Component Composition æœ‰æ—¶å€™æ˜¯ä¸€ä¸ªæ¯” Context æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚

åœ¨çº¿è¿è¡Œ 03 - Context API Demo https://scrimba.com/scrim/cB32EPsv

	import React from 'react';

	export let NamedColors = [
	    {hex: '#ffe4c4', hsl: 'hsl(255,228,196)', name: 'bisque'},
	    {hex: '#ffebcd', hsl: 'hsl(255,235,205)', name: 'blanchedalmond'},
	    {hex: '#deb887', hsl: 'hsl(222,184,135)', name: 'burlywood'},
	    {hex: '#ff7f50', hsl: 'hsl(255,127,80)' , name: 'coral'},
	    {hex: '#6495ed', hsl: 'hsl(100,149,237)', name: 'cornflowerblue'},
	    {hex: '#b8860b', hsl: 'hsl(184,134,11)' , name: 'darkgoldenrod'},
	    {hex: '#2f4f4f', hsl: 'hsl(47,79,79)'   , name: 'darkslategray'},
	    {hex: '#696969', hsl: 'hsl(105,105,105)', name: 'dimgrey'},
	    {hex: '#daa520', hsl: 'hsl(218,165,32)' , name: 'goldenrod'},
	];

	let setClipData = (ev: React.MouseEvent, color: typeof NamedColors[0]) => {
	    let {name} = color;
	    let css = `
	    .bg_${name} {background-color: ${name};}
	    .c_${name} {color: ${name};}
	    `;
	    navigator.clipboard.writeText(css);
	}

	export let ColorPad = (props:{
	    theme: typeof initTheme
	    className?: string, 
	}) =>{
	    let {hex, name, hsl} = props.theme.color;
	    let textColor = name==="black"? 'white':name;
	    let className = props.className ?? "colorPad col19 board bgLight";
	    return (
	        <div className={className} style={{background: name, margin:12, padding:12}}>
	            <div className="pad" onClick={ev => props.theme.update(props.theme.color)}
	                style={{backgroundColor: hex, cursor: 'pointer', color: textColor, padding: 32}}>&nbsp;</div>
	            <div>hex: {hex}</div>
	            <div>hsl: {hsl}</div>
	            <button className="button-minimal" onClick={(ev)=>setClipData(ev, props.theme.color)}>CC {name}</button>
	        </div>
	    );
	}

	class DeepCC extends React.PureComponent<Partial<Props>>{
	    constructor(props:Partial<Props>) {
	        super(props);
	        // Manually set context type for this.context
	        DeepCC.contextType = contextColor;
	    }

	    render(){
	        let colorValue:typeof initTheme.color = this.context;
	        return (
	        <context.Consumer>
	        {themeValue => (
	        <div className="board bgLight col14">
	            {this.props.children} {new Date().toISOString().substr(13, 9)}
	            <ColorPad theme={{...initTheme, color: colorValue}} className="colorPad" />
	        </div>
	        )}
	        </context.Consumer>
	        )
	    }
	}

	let DeepFC = (props:Partial<Props>) => {
	    return (
	        <context.Consumer>
	        {contextValue => (
	        <div className="board bgLight col15">
	            {props.children} {new Date().toISOString().substr(13, 9)}
	            <ColorPad theme={contextValue} className="colorPad" />
	        </div>
	        )}
	        </context.Consumer>
	    )
	}

	let DeepFcProps = (props:Props) => {
	    return (
	        <div className="board bgLight col15">
	        {props.children} {new Date().toISOString().substr(13, 9)}
	        <ColorPad theme={props.theme} className="colorPad" />
	        </div>
	    )
	}

	let PropsDemo = (props: Props) => {
	    return (
	        <DeepFcProps {...props}>
	        <b>PropsDemo</b>
	        </DeepFcProps>
	    )
	}

	let ContextDemo = (props: Partial<Props>) => {
	    return (
	        <>
	        <DeepFC> <b>ContextDemo 4 DeepFC</b> </DeepFC>
	        <DeepCC> <b>ContextDemo 4 DeepCC</b> </DeepCC>
	        </>
	    )
	}

	let randomColor = ():typeof NamedColors[0] => {
	    return NamedColors[Math.floor(Math.random()*NamedColors.length)];
	}

	type Props = {
	    theme: typeof initTheme
	    children?: any
	}

	const initTheme = {
	    color: {} as typeof NamedColors[0],
	    update: (color: typeof NamedColors[0]) => { console.log(color); }
	}
	const context = React.createContext(initTheme);
	const contextColor = React.createContext(NamedColors[0]);

	context.displayName = "MyRandomColor"; // set display name for DevTools

	let App = () => {
	    const [color, setColor] = React.useState(randomColor())
	    const [bg, setBG] = React.useState(randomColor())
	    const update = () => setColor(randomColor());
	    let theme: typeof initTheme = {color: color, update: (color) => { setBG(color); update(); }};
	    return (
	        <div className="grid">
	        <contextColor.Provider value={NamedColors[0]}>
	        <context.Provider value={theme}>
	            <div className="board col15" style={{color: color.name, background: bg.name}}>
	                <h1>App Panel</h1>
	                <button className="button-minimal" onClick={ ev => update()}>Fresh ChildNode</button>
	                <div>Font:{color.name} Background: {bg.name}</div>
	            </div>
	            <PropsDemo theme={theme} />
	            <ContextDemo />
	        </context.Provider>
	        </contextColor.Provider>
	        </div>
	    )
	}

	export default App;


### ğŸ‘‰ Contexts API

Context API

- React.createContext() åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ•°æ®æºï¼›
- Context.Provider ç»„ä»¶ä¸ºå­ç»„ä»¶æ³¨å…¥æ•°æ®ï¼›
- é€šè¿‡åœ¨å­ç»„ä»¶ä¸­è®¾ç½®ä¸Šä¸‹æ–‡å¯¹è±¡ç±»å‹ Class.contextType æ¥è®¿é—®ï¼›
- Context.Consumer ç»„ä»¶åœ¨å­ç»„ä»¶ä¸­æ¶ˆè´¹æ•°æ®ï¼›
- Context.displayName è®¾ç½®ä¸Šä¸‹æ–‡å¯¹è±¡åœ¨è°ƒè¯•å·¥å…·ä¸­æ˜¾ç¤ºçš„åå­—ï¼›

ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ useContext Hooks å‡½æ•°ä¹Ÿå¯ä»¥æ¶ˆè´¹ä¸Šä¸‹æ–‡ä¼ é€’çš„æ•°æ®ã€‚


åœ¨ä¸€ä¸ªå…¸å‹çš„ React åº”ç”¨ä¸­ï¼Œæ•°æ®æ˜¯é€šè¿‡ props å±æ€§è‡ªä¸Šè€Œä¸‹ï¼ˆç”±çˆ¶åŠå­ï¼‰è¿›è¡Œä¼ é€’çš„ï¼Œä½†è¿™ç§åšæ³•å¯¹äºå¤šå±‚çº§ç»„ä»¶ç±»å‹çš„å±æ€§è€Œè¨€æ˜¯æå…¶ç¹ççš„ï¼Œè¿™äº›å±æ€§æ˜¯åº”ç”¨ç¨‹åºä¸­æ·±å±‚ç»„ä»¶éƒ½éœ€è¦çš„ã€‚Context æä¾›äº†ä¸€ç§åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ­¤ç±»å€¼çš„æ–¹å¼ï¼Œè€Œä¸å¿…æ˜¾å¼åœ°é€šè¿‡ç»„ä»¶æ ‘çš„é€å±‚ä¼ é€’ Propsã€‚

[Context API] æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼ŒProvider å’Œ Consumerã€‚ å‰è€…å‘ç»„ä»¶æ ‘æä¾›ä¸€ä¸ªå…¨å±€çš„æ•°æ®æºï¼Œå­ç»„ä»¶å¯ä»¥è®¢é˜…å®ƒçš„æ•°æ®æºï¼Œå³æ˜¯ Cusumerï¼Œä¸è®ºèŠ‚ç‚¹åµŒå¥—å¤šæ·±éƒ½å¯ä»¥è·å–åˆ° Provider æä¾›çš„æ•°æ®ã€‚

	const MyContext = React.createContext(defaultValue);

åˆ›å»ºä¸€ä¸ª Context å¯¹è±¡ã€‚å½“ React æ¸²æŸ“ä¸€ä¸ªè®¢é˜…äº†è¿™ä¸ª Context å¯¹è±¡çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¼šä»ç»„ä»¶æ ‘ä¸­ç¦»è‡ªèº«æœ€è¿‘çš„é‚£ä¸ªåŒ¹é…çš„ Provider ä¸­è¯»å–åˆ°å½“å‰çš„ context å€¼ã€‚åªæœ‰å½“ç»„ä»¶æ‰€å¤„çš„æ ‘ä¸­æ²¡æœ‰åŒ¹é…åˆ° Provider æ—¶ï¼Œå…¶ defaultValue å‚æ•°æ‰ä¼šç”Ÿæ•ˆã€‚è¿™æœ‰åŠ©äºåœ¨ä¸ä½¿ç”¨ Provider åŒ…è£…ç»„ä»¶çš„æƒ…å†µä¸‹å¯¹ç»„ä»¶è¿›è¡Œæµ‹è¯•ã€‚

æ³¨æ„ï¼šå°† undefined ä¼ é€’ç»™ Provider æ—¶ï¼Œæ¶ˆè´¹ç»„ä»¶çš„ defaultValue ä¸ä¼šç”Ÿæ•ˆã€‚

	<MyContext.Provider value={/* æŸä¸ªå€¼ */}>


æ¯ä¸ª Context å¯¹è±¡éƒ½ä¼šè¿”å›ä¸€ä¸ª Provider React ç»„ä»¶ï¼Œå®ƒå…è®¸æ¶ˆè´¹ç»„ä»¶è®¢é˜… context çš„å˜åŒ–ã€‚Provider æ¥æ”¶ä¸€ä¸ª value å±æ€§ï¼Œä¼ é€’ç»™æ¶ˆè´¹ç»„ä»¶ã€‚ä¸€ä¸ª Provider å¯ä»¥å’Œå¤šä¸ªæ¶ˆè´¹ç»„ä»¶æœ‰å¯¹åº”å…³ç³»ã€‚å¤šä¸ª Provider ä¹Ÿå¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œé‡Œå±‚çš„ä¼šè¦†ç›–å¤–å±‚çš„æ•°æ®ã€‚

å½“ Provider çš„ value å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰æ¶ˆè´¹ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚Provider åŠå…¶å†…éƒ¨ consumer ç»„ä»¶éƒ½ä¸å—åˆ¶äº shouldComponentUpdate å‡½æ•°ï¼Œå› æ­¤å½“ consumer ç»„ä»¶åœ¨å…¶ç¥–å…ˆç»„ä»¶é€€å‡ºæ›´æ–°çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ›´æ–°ã€‚

	<MyContext.Consumer>
	  {value => /* åŸºäº context å€¼è¿›è¡Œæ¸²æŸ“*/}
	</MyContext.Consumer>

è¿™é‡Œï¼ŒReact ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶éƒ½å¯ä»¥è®¢é˜…åˆ° context å˜æ›´ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ªåŒ¿åå‡½æ•°å¼ç»„ä»¶ä½œä¸º Consumer å­å…ƒç´ æ¥æ¶ˆè´¹æ•°æ®ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶å½“å‰çš„ context å€¼ï¼Œè¿”å›ä¸€ä¸ª React èŠ‚ç‚¹ã€‚ä¼ é€’ç»™å‡½æ•°çš„ value å€¼ç­‰åŒäºç»„ä»¶æ ‘ä¸Šç¦»å¾—æœ€è¿‘çš„ Provider æä¾›çš„å€¼ã€‚å¦‚æœæ²¡æœ‰å¯¹åº”çš„ Providerï¼Œvalue å‚æ•°ç­‰åŒäºä¼ é€’ç»™ createContext() çš„ defaultValueã€‚

æ³¨æ„ ES6 çš„çœç•¥è¯­æ³•ï¼Œç®­å¤´å‡½æ•°è¯­æ³•çš„å¤šç§ç­‰ä»·è¡¨è¾¾ï¼š

    {a => <input {...props} value={a} />}
    {(a) => { return <input {...props} value={a} /> } }


å¯ä»¥é€šè¿‡è®¾ç½®ç±»ç»„ä»¶çš„ contextType æ¥å˜æ›´è¦å¼•ç”¨ Context å¯¹è±¡ï¼š

	class MyClass extends React.Component {
	  componentDidMount() {
	    let value = this.context;
	    /* perform a side-effect at mount using the value of MyContext */
	  }
	  componentDidUpdate() {
	    let value = this.context;
	    /* ... */
	  }
	  componentWillUnmount() {
	    let value = this.context;
	    /* ... */
	  }
	  render() {
	    let value = this.context;
	    /* render something based on the value of MyContext */
	  }
	}
	MyClass.contextType = MyContext;

è¿™èƒ½è®©ä½ ä½¿ç”¨ this.context æ¥æ¶ˆè´¹æœ€è¿‘ Context ä¸Šçš„é‚£ä¸ªå€¼ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®åˆ°å®ƒï¼ŒåŒ…æ‹¬ render å‡½æ•°ä¸­ã€‚æ³¨æ„ï¼šä½ åªé€šè¿‡è¯¥ API è®¢é˜…å•ä¸€ contextã€‚


ä½ å¯ä»¥ä½¿ç”¨ static contextType è¿™ä¸ªç±»å±æ€§æ¥åˆå§‹åŒ–ï¼š

	class MyClass extends React.Component {
	  static contextType = MyContext;
	  render() {
	    let value = this.context;
	    /* render something based on the value */
	  }
	}


åœ¨ä¸€äº›è½»é‡çº§çš„åº”ç”¨ä¸­ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ä½¿ç”¨ [Context API] è§£å†³å¤šçº§æ•°æ®å…±äº«çš„é—®é¢˜ã€‚å¦‚æœè¦æ›´å¼ºå¤§ï¼Œå¯ä»¥ä½¿ç”¨å…¶å®ƒç±»åº“ï¼Œå¦‚ Reduxã€‚


### ğŸ‘‰ Updating Context from Children

å¯ä»¥ä¿®æ”¹ Context å¯¹è±¡ï¼Œä½†ä¸åº”è¯¥ä¹Ÿä¸èƒ½ç›´æ¥æ”¹å˜ context å¯¹è±¡ä¸­çš„å±æ€§ï¼ŒåŒæ ·å¼å‡ºäºç»„ä»¶è€¦åˆåº¦çš„è€ƒè™‘ã€‚å‚è€ƒ React å®˜æ–¹æ–‡æ¡£ä¸­çš„ç¤ºèŒƒä¸­çš„åšæ³•ï¼Œåœ¨åˆ›å»º Context æ—¶ï¼Œä¸€å¹¶å®šä¹‰ç”¨äºæ›´æ–°çŠ¶æ€çš„å›è°ƒæ¥å£ï¼Œè¿™æ ·æ·±å±‚ç»„ä»¶å°±å¯ä»¥è·å¾—å›è°ƒæ¥æ‰§è¡Œè‡ªèº«çš„æ›´æ–°ã€‚è¿™æ˜¯å¾ˆå¥½çš„åšæ³•ï¼Œç›¸æ¯”ä½¿ç”¨å…¨å±€ä¿å­˜ä¸€ä¸ªçŠ¶æ€ç®¡ç†å‡½æ•°çš„åšæ³•æ›´å…·æœ‰ä½è€¦åˆé«˜å¯ç»´æŠ¤çš„ç‰¹ç‚¹ï¼š

	let State:string, setState:React.Dispatch<React.SetStateAction<string>>;

	let App = () => {
	    [State, setState] = React.useState(initialValue);
	}

å®˜æ–¹ç¤ºèŒƒï¼š

	// Make sure the shape of the default value passed to
	// createContext matches the shape that the consumers expect!
	export const ThemeContext = React.createContext({
	  theme: themes.dark,
	  toggleTheme: () => {},
	});

	function ThemeTogglerButton() {
	  // The Theme Toggler Button receives not only the theme
	  // but also a toggleTheme function from the context
	  return (
	    <ThemeContext.Consumer>
	      {({theme, toggleTheme}) => (
	        <button
	          onClick={toggleTheme}
	          style={{backgroundColor: theme.background}}>
	          Toggle Theme
	        </button>
	      )}
	    </ThemeContext.Consumer>
	  );
	}

	class App extends React.Component {
	  constructor(props) {
	    super(props);

	    this.toggleTheme = () => {
	      this.setState(state => ({
	        theme:
	          state.theme === themes.dark
	            ? themes.light
	            : themes.dark,
	      }));
	    };

	    // State also contains the updater function so it will
	    // be passed down into the context provider
	    this.state = {
	      theme: themes.light,
	      toggleTheme: this.toggleTheme,
	    };
	  }

	  render() {
	    // The entire state is passed to the provider
	    return (
	      <ThemeContext.Provider value={this.state}>
	        <ThemeTogglerButton />
	      </ThemeContext.Provider>
	    );
	  }
	}


### ğŸ‘‰ Consuming Multiple Contexts

ä¸ºäº†é‡æ–°æ¸²æŸ“æ›´å¿«ï¼ŒReact éœ€è¦å°†æ¯ä¸ª Consumer åˆ†ç¦»åˆ°èŠ‚ç‚¹æ ‘ä¸Šï¼Œä»¥ä¸‹æ˜¯æ¶ˆè´¹å¤šä¸ªä¸Šä¸‹æ–‡æ•°æ®å¯¹è±¡ç¤ºèŒƒï¼š

	// Theme context, default to light theme
	const ThemeContext = React.createContext('light');

	// Signed-in user context
	const UserContext = React.createContext({
	  name: 'Guest',
	});

	class App extends React.Component {
	  render() {
	    const {signedInUser, theme} = this.props;

	    // App component that provides initial context values
	    return (
	      <ThemeContext.Provider value={theme}>
	        <UserContext.Provider value={signedInUser}>
	          <Layout />
	        </UserContext.Provider>
	      </ThemeContext.Provider>
	    );
	  }
	}

	function Layout() {
	  return (
	    <div>
	      <Sidebar />
	      <Content />
	    </div>
	  );
	}

	// A component may consume multiple contexts
	function Content() {
	  return (
	    <ThemeContext.Consumer>
	      {theme => (
	        <UserContext.Consumer>
	          {user => (
	            <ProfilePage user={user} theme={theme} />
	          )}
	        </UserContext.Consumer>
	      )}
	    </ThemeContext.Consumer>
	  );
	}

### ğŸ‘‰ Contexts Caveats


å› ä¸º Context ä½¿ç”¨å¼•ç”¨æ ‡è¯†æ¥ç¡®å®šä½•æ—¶é‡æ–°å‘ˆç°ï¼Œæ‰€ä»¥å½“ Provider çš„çˆ¶çº§é‡æ–°æ¸²æŸ“æ—¶ï¼Œæœ‰äº›é™·é˜±å¯èƒ½ä¼šæ— æ„è§¦å‘æ¸²æŸ“ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å°†åœ¨æ¯æ¬¡ Provider çˆ¶çº§é‡æ–°æ¸²æŸ“æ—¶å¯¼è‡´ Consumer é‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºå§‹ç»ˆä¸ºå€¼åˆ›å»ºæ–°å¯¹è±¡ï¼š

	class App extends React.Component {
	  render() {
	    return (
	      <MyContext.Provider value={{something: 'something'}}>
	        <Toolbar />
	      </MyContext.Provider>
	    );
	  }
	}

è§£å†³æ–¹æ³•æ˜¯æå‡æ•°æ®åˆ° State ä¸­ç®¡ç†ï¼š

	class App extends React.Component {
	  constructor(props) {
	    super(props);
	    this.state = {
	      value: {something: 'something'},
	    };
	  }

	  render() {
	    return (
	      <Provider value={this.state.value}>
	        <Toolbar />
	      </Provider>
	    );
	  }
	}


## Hooks API ä¸å‡½æ•°ç»„ä»¶
- [Building Your Own Hooks](https://reactjs.org/docs/hooks-custom.html)
- [Hooks API Reference](https://reactjs.org/docs/hooks-reference.html)
- https://reactjs.org/docs/react-api.html#reactmemo
- http://www.ptbird.cn/react-hook-useMemo-purerender.html
- https://kentcdodds.com/blog/usememo-and-usecallback
- React on Github https://github.com/facebook/react/
- React.org on Github https://github.com/reactjs/reactjs.org/
- Flow é™æ€ç±»å‹æ£€æŸ¥å™¨ https://flow.org/en/docs/
- Flow è¯­æ³•æ£€æŸ¥å™¨åœ¨çº¿ AST æ”¯æŒ https://flow.org/try/
- React æºç å…¨æ–¹ä½å‰–æ http://www.sosout.com/2018/08/12/react-source-analysis.html

Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class ç»„ä»¶çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚å…·æœ‰åˆ‡ç‰‡ç¼–æˆçš„åŠŸèƒ½ AOP(Aspect Orient Programming)ï¼Œèƒ½å°†ä¾èµ–ä»£ç æ”¾åˆ°æ ¸å¿ƒä»£ç çš„å¤–éƒ¨ï¼Œå¢åŠ ç¼–ç çš„çµæ´»æ€§ã€‚

å¯ä»¥å‚è€ƒ Wordpress çš„ Action æœºåˆ¶ï¼Œæ˜¯åŒç±»çš„ç¼–ç¨‹æ¦‚å¿µã€‚é’©å­çš„å®ç°ï¼Œå¯ä»¥åŸºäºå›è°ƒï¼Œåœ¨ React æ ¸å¿ƒä»£ç çš„åˆé€‚ä½ç½®æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¹¶æä¾›ä¸€ä¸ªæ¥å£ä¾›å¼€å‘è€…æ¥è®¾ç½®å›è°ƒï¼Œåœ¨ React æ‰§è¡Œåˆ°å…³é”®ä½ç½®æ—¶å°±å¯ä»¥è§¦å‘å¼€å‘è€…è®¾ç½®çš„å›è°ƒä»£ç ã€‚

Hook å°±æ˜¯ JavaScript å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒä»¬ä¼šæœ‰ä¸¤ä¸ªé¢å¤–çš„è§„åˆ™ï¼š

+ åªèƒ½åœ¨å‡½æ•°æœ€å¤–å±‚è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨ã€‚
+ åªèƒ½åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hookã€‚

åŸºç¡€ Hooks API æœ‰ä¸‰ä¸ªï¼š

- **useState** ç”¨äºçŠ¶æ€æ•°æ®ç®¡ç†ï¼Œå¯ä»¥è®©å‡½æ•°ç»„ä»¶å®ç°çŠ¶æ€ç®¡ç†ï¼Œåº•å±‚å°±æ˜¯ useReducerï¼›
- **useEffect** æ‰§è¡Œé‚£äº›éœ€è¦åœ¨ render ä¹‹åæ‰§è¡Œçš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ç§°ä¹‹ä¸ºå‰¯ä½œç”¨ï¼Œå…¸å‹çš„æ˜¯ä¿®æ”¹ DOMï¼›
- **useContext** æ–¹ä¾¿ç»„ä»¶åµŒå¥—ä¼ é€’å±æ€§ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨å­ç»„ä»¶ä¸­è®¢é˜…çˆ¶ç»„ä»¶çš„ Context å±æ€§ï¼›

é™„åŠ  Hooks API 

- **useReducer** æ›´ä¸°å¯Œçš„çŠ¶æ€æ•°æ®ç®¡ç†ï¼Œå®ç°æ¯” useState æ›´å¤æ‚çš„çŠ¶æ€ç®¡ç†ï¼Œç±»ä¼¼ Redux çš„åŠŸèƒ½ï¼›
- **useCallback** ç¼“å­˜ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåªè¦å‚æ•°åˆ—è¡¨ä¸­æŒ‡å®šçš„æ•°ç»„å‚æ•°å†…å®¹ä¸å˜ï¼Œå°±ä¸ä¼šæ‰§è¡Œå°è£…åœ¨å†…éƒ¨çš„å›è°ƒå‡½æ•°ã€‚
- **useMemo** çŠ¶æ€è®°å¿†å‡½æ•°ç”¨æ¥ä¼˜åŒ–ç»„ä»¶åˆ·æ–°æµç¨‹ï¼Œåªè¦è¾“å…¥æ•°æ®æ²¡æœ‰å˜åŒ–å°±è¿”å›ç¼“å­˜çš„å†…å®¹ï¼›
- **useRef** åƒä¸€ä¸ªç›’å­ï¼Œåœ¨å…¶ current å‚æ•°ä¸­ä¿æŒå¼•ç”¨çš„ç»„ä»¶å¯¹è±¡ï¼›
- **useImperativeHandle** åœ¨å‡½æ•°ç»„ä»¶ä¸­å‘çˆ¶ç»„ä»¶æš´éœ²å€¼/æ–¹æ³•ï¼Œä»¥ä¾›å¼•ç”¨è°ƒç”¨ï¼›
- **useLayoutEffect** æ‰§è¡Œå¸ƒå±€å‰¯ä½œç”¨æ“ä½œï¼Œä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶ï¼›
- **useDebugValue** åœ¨ React DevTools å¼€å‘å·¥å…·é¢æ¿ä¸Šæ˜¾ç¤ºæ ‡ç­¾ï¼›

æ‰€æœ‰ Hooks API çš„æºä»£ç åœ¨ ReactHooks.js æ–‡ä»¶ï¼Œå…¶å†…éƒ¨æ‰§è¡Œçš„æ˜¯ Dispatcher çš„æ–¹æ³• ï¼š

	export function useState<S>(
	  initialState: (() => S) | S,
	): [S, Dispatch<BasicStateAction<S>>] {
	  const dispatcher = resolveDispatcher();
	  return dispatcher.useState(initialState);
	}

	export function useReducer<S, I, A>(
	  reducer: (S, A) => S,
	  initialArg: I,
	  init?: I => S,
	): [S, Dispatch<A>] {
	  const dispatcher = resolveDispatcher();
	  return dispatcher.useReducer(reducer, initialArg, init);
	}

	export function useRef<T>(initialValue: T): {|current: T|} {
	  const dispatcher = resolveDispatcher();
	  return dispatcher.useRef(initialValue);
	}

	export function useEffect(
	  create: () => (() => void) | void,
	  deps: Array<mixed> | void | null,
	): void {
	  const dispatcher = resolveDispatcher();
	  return dispatcher.useEffect(create, deps);
	}

React çš„æºç åˆ©ç”¨äº† Flow åšäº†é™æ€ç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥äº†è§£ Flow æœ‰åŠ©äºæˆ‘ä»¬é˜…è¯»æºç ï¼Œåƒ useRef çš„è¿”å›å€¼å°±ä½¿ç”¨äº† Flow è¯­æ³•ï¼Œä½†å’Œ TypeScript å¾ˆç›¸ä¼¼ã€‚

	/* @flow */

	function foo(x: ?number): {|v?: string, o: ?number|} {
	  if (x) {
	    return {o: x};
	  }
	  return {v:"default string", o: x};

	  // Cannot return object literal because property `more` is missing ... [prop-missing]
	  // return {v:"default string", o: x, more: 123};
	}

Flow çš„è¯­æ³•ä¸­ï¼ŒèŠ±æ‹¬å·å†…åŠ ç«–çº¿çš„ç±»å‹è¡¨ç¤ºä¸€ä¸ªä¸¥æ ¼ç±»å‹ï¼Œå³æˆå‘˜å…¨éƒ¨æ˜¾å¼å®šä¹‰ï¼Œè€Œä¸ä½¿ç”¨ç«–çº¿è¡¨ç¤ºå¯ä»¥æœ‰å…¶å®ƒå¯é€‰æˆå‘˜ã€‚

Flow æ˜¯ Facebook å¼€æºçš„é™æ€ä»£ç æ£€æŸ¥å·¥å…·ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åœ¨è¿è¡Œä»£ç ä¹‹å‰å¯¹ React ç»„ä»¶ä»¥åŠ Jsx è¯­æ³•è¿›è¡Œé™æ€ä»£ç çš„æ£€æŸ¥ä»¥å‘ç°ä¸€äº›å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚åœ¨ React v16 Fiber ä¸­çš„éƒ¨åˆ† TypeScript ä»£ç åªæ˜¯ç±»å‹å£°æ˜æ–‡ä»¶å’Œæµ‹è¯•ä»£ç ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº†æ–¹ä¾¿åˆ©ç”¨ TypeScript å†™åº”ç”¨çš„å¼€å‘è€…ä½¿ç”¨ Reactï¼Œç»™äº†æ¥å£å®šä¹‰å’Œæµ‹è¯•æ ·ä¾‹è€Œå·²ã€‚

React æºä»£ç æ˜¯ä½¿ç”¨ Lerna ç®¡ç†çš„ monorepoï¼Œè¿™ä¸ª repository åŒ…å«å¤šä¸ª npm æ¨¡å—ã€‚å®é™…ä¸Šï¼ŒReact åœ¨ npm ä¸Šå‘å¸ƒçš„å¤šä¸ªæ¨¡å—éƒ½æ¥è‡ªäºåŒä¸€ä¸ª codebaseï¼ŒåŒ…æ‹¬ reactã€react-domã€react-isâ€¦â€¦

monorepo VS multirepo é›†ä¸­ç®¡ç† vs å¤šå…ƒåŒ–ï¼Œè¿™æ˜¯ä¸¤ç§é¡¹ç›®ç®¡ç†ç†å¿µã€‚é€šå¸¸ï¼Œå½“æˆ‘ä»¬çš„é¡¹ç›®ä¸æ–­çš„è¿­ä»£æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®ä¸šåŠ¡æˆ–è€…æ˜¯åŠŸèƒ½åˆæˆ–è€…æ˜¯æ–¹ä¾¿å¤ç”¨æŸäº›ä»£ç æ¨¡å—ï¼ŒæŠŠä¸€ä¸ªå¤§çš„ codebase æ‹†æˆä¸€äº›ç‹¬ç«‹çš„ package æˆ– moduleï¼Œå†å°†è¿™äº›åŠŸèƒ½ç‹¬ç«‹çš„ package æŒ‰å•ç‹¬çš„ repository ç»´æŠ¤ï¼Œæ­¤æ–¹å¼å¯ä»¥ç®€å•åœ°ç§°ä¸º multiple repositoriesã€‚è€Œ React ä½¿ç”¨çš„ monorepo åˆ™æ˜¯ä¸€ç§ç›¸åçš„åšæ³•ï¼Œå®ƒæå€¡å°†æ‰€æœ‰çš„ç›¸å…³ package éƒ½æ”¾å…¥ä¸€ä¸ª repository æ¥ç®¡ç†ã€‚

monorepo ä¼˜ç‚¹

- ä¸€ã€å•ä¸ªçš„ lintï¼Œbuildï¼Œtest å’Œ release æµç¨‹ï¼›
- äºŒã€ç»Ÿä¸€çš„åœ°æ–¹å¤„ç†issueï¼›
- ä¸‰ã€ä¸ç”¨åˆ°å¤„å»æ‰¾è‡ªå·±é¡¹ç›®çš„repoï¼›
- å››ã€æ–¹ä¾¿ç®¡ç†ç‰ˆæœ¬å’Œdependenciesï¼›
- äº”ã€è·¨é¡¹ç›®çš„æ“ä½œå’Œä¿®æ”¹å˜å¾—å®¹æ˜“ï¼›
- å…­ã€æ–¹ä¾¿ç”Ÿæˆæ€»çš„changelogã€‚

monorepo ç¼ºç‚¹

- ä¸€ã€repo çš„ä½“ç§¯å˜å¾—å¾ˆå¤§ï¼›
- äºŒã€å®‰å…¨é—®é¢˜ï¼Œå¦‚ä½•ç®¡ç†æƒé™ã€‚



## â˜› useState çŠ¶æ€ç®¡ç†
- https://reactjs.org/docs/hooks-state.html

useState API å‚è€ƒï¼š

	// normal initial state
	const [state, setState] = useState(initialState);

	// Lazy initial state
	const [state, setState] = useState(() => {
	  const initialState = someExpensiveComputation(props);
	  return initialState;
	});

	setState(newState);

	setState(prevState => {
	  // Object.assign would also work
	  return {...prevState, ...updatedValues};
	});

ç”¨ä¸€ä¸ªè®¡æ•°å™¨ç¤ºèŒƒå¦‚ä½•ä½¿ç”¨ useStateï¼š

	import React from 'react';
	import PropTypes from 'prop-types';

	interface IProps {
	  initialCount?: number
	}

	// const App = ({initialCount}: IProps) => {
	const App:React.FC<IProps> = ({ initialCount }) => {
	  const [count, setCount] = React.useState(0)
	  const onClick = () => console.log(count)
	  return (
	    <>
	      Count: {count}
	      <button onClick={() => setCount(initialCount!)}>Reset</button>
	      <button onClick={() => setCount(prevCount => prevCount - 1)}>-</button>
	      <button onClick={() => setCount(prevCount => prevCount + 1)}>+</button>
	    </>
	  );
	}
	App.displayName = 'App';
	App.defaultProps = {
	  initialCount: 0,
	};
	App.propTypes = {
	  initialCount: PropTypes.oneOf([0, 1, 2, 3, 4, 5]),
	};

	export default App;

ä»¥ä¸‹å°† state çš„çŠ¶æ€æ•°æ®åœ¨å¯¹è±¡ä¸­ç®¡ç†ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ç®€å•çš„æ•°å€¼ï¼Œå¯ä»¥çœ‹åˆ°è®¾ç½®æ–¹æ³•çš„ä½¿ç”¨å·®åˆ«ï¼Œç›´æ¥ä¼ å…¥æ•°æ®å‚æ•°å’Œä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°æ˜¯ä¸¤ç§åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼š

	import React from 'react';

    interface IProps {
      initialState?: IState
    }

    interface IState {
      value: number
      tag: string
    }

    // const App = ({initialState}: IProps ) => {
    const App:React.FC<IProps> = ({ initialState }) => {
      const [state, setCount] = React.useState(initialState)
      let make = (pv: IState, v:number) => {
        console.log(pv, v);
        return {...pv, ...{value: pv.value + v}};
      }
      return (
        <>
          Count: {state!.value}
          <button onClick={() => setCount(initialState!)}>Reset</button>
          <button onClick={() => setCount(pv => make(pv!, -1))}>-</button>
          <button onClick={() => setCount(pv => make(pv!,  1))}>+</button>
        </>
      );
    }
    App.defaultProps = {
      initialState: {value: 10, tag:"Test"},
    };

	export default App;


æ¥ä¸‹æ¥ï¼Œè¦æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ useMemoã€‚ å…ˆæ¥è€ƒè™‘ä¸€ä¸ªæ€§èƒ½é—®é¢˜: å½“åœ¨ä¸€ä¸ªçˆ¶ç»„ä»¶ä¸­è°ƒç”¨ä¸€ä¸ªå­ç»„ä»¶çš„æ—¶å€™ï¼Œç”±äºçˆ¶ç»„ä»¶çš„ state å‘ç”Ÿæ”¹å˜å¯¼è‡´çˆ¶ç»„ä»¶æ›´æ–°ï¼Œè™½ç„¶å­ç»„ä»¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯ä¹Ÿä¼šè¿›è¡Œæ›´æ–°ï¼Œé€ æˆæ€§èƒ½æŸè€—ã€‚

ä½¿ç”¨ class ç»„ä»¶ï¼Œä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œç»å¸¸ä¼šé€‰æ‹©ä½¿ç”¨ PureComponentï¼Œæ¯æ¬¡å¯¹ props è¿›è¡Œä¸€æ¬¡æµ…æ¯”è¾ƒï¼Œæˆ–è€…åœ¨ shouldComponentUpdate ä¸­è¿›è¡Œæ›´æ·±å±‚æ¬¡çš„æ§åˆ¶ã€‚

åœ¨ Function ç»„ä»¶ä¸­ï¼ŒReact è´´å¿ƒçš„æä¾›äº† React.memo è¿™ä¸ª HOC é«˜é˜¶å‡½æ•°ç»„ä»¶ï¼Œä¸ PureComponent å¾ˆç›¸ä¼¼ã€‚ç›¸æ¯”äº PureComponentï¼ŒReact.memo() å¯ä»¥æ”¯æŒæŒ‡å®šä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ç›¸å½“äº shouldComponentUpdate çš„ä½œç”¨ï¼Œå› æ­¤ React.memo() ç›¸å¯¹äº PureComponent æ¥è¯´ï¼Œç”¨æ³•æ›´åŠ æ–¹ä¾¿ã€‚


## â˜› useEffect å‰¯ä½œç”¨
- https://reactjs.org/docs/hooks-effect.html

ä½•ä¸ºå‰¯ä½œç”¨ï¼Ÿä»¥ä¸‹è¿™äº›éƒ½æ˜¯ï¼š

- Network request æ•°æ®è·å–ï¼›
- Manual DOM manipulation æ‰‹åŠ¨æ›´æ”¹ DOMï¼›
- Event listeners or timeouts and intervals äº‹ä»¶ä¾¦å¬å’Œå®šæ—¶å™¨å¤„ç†ï¼›

ç”¨ä»¥ä¸‹è¿™ä¸ª Loading ç»„ä»¶ä¹Ÿè®¸æœ€èƒ½è¯´æ˜ä»€ä¹ˆæ˜¯ useEffectï¼š

```ts
import {useEffect, useRef} from 'react'

let timer = 0
let index = 0

export let Loading = (props) => {
  let indicator = ['ğŸŒ‘','ğŸŒ’','ğŸŒ“','ğŸŒ”','ğŸŒ','ğŸŒ•','ğŸŒ–','ğŸŒ—','ğŸŒ˜','ğŸŒš']
  const ref = useRef({})
  useEffect(() => {
    timer = setInterval(() => {
      index = (index+1)%indicator.length
      ref.current.innerHTML = indicator[index] + ' ' + props.text
    }, 300);
    return () => {
      clearInterval(timer)
    };
  })
  return <div ref={ref} className="loading">{indicator[index]} {props.text}</div>
}

export default Loading;
```

è¿™ä¸ªç¤ºä¾‹é€šè¿‡ useEffect è®¾ç½®å®šæ—¶å™¨æ¥å®ç°åŠ¨æ€çš„éç»„ä»¶çŠ¶æ€è§¦å‘çš„ UI æ›´æ–°ï¼Œå¹¶ä¸”åœ¨ç»„ä»¶æ¸…ç†é˜¶æ®µä¼šå°†å®šæ—¶å™¨æ¸…é™¤ã€‚

ä½¿ç”¨ useEffect çš„æ„ä¹‰å°±æ˜¯ï¼Œæ–¹ä¾¿æ‰§è¡Œé‚£äº›éœ€è¦åœ¨ render ä¹‹åæ‰§è¡Œçš„åŠŸèƒ½ã€‚åœ¨ç±»ç»„ä»¶ä¸­ï¼Œé€šå¸¸ä¼šåœ¨ componentDidMount æˆ–è€… componentDidUpdate ä¸­æ‰§è¡Œå‰¯ä½œç”¨ä»£ç ã€‚è€Œå¯¹äºå‡½æ•°å¼ç»„ä»¶ï¼Œåªæœ‰å€ŸåŠ© useEffect æ¥åšåŒæ ·çš„äº‹ã€‚

	import React, { useState, useEffect } from 'react';

	function FriendStatus(props) {
	  const [isOnline, setIsOnline] = useState(null);

	  useEffect(() => {
	    function handleStatusChange(status) {
	      setIsOnline(status.isOnline);
	    }
	    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
	    // Specify how to clean up after this effect:
	    return function cleanup() {
	      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
	    };
	  });

	  if (isOnline === null) {
	    return 'Loading...';
	  }
	  return isOnline ? 'Online' : 'Offline';
	}

å¸¸ç”¨ï¼Œå¹¶ä¸éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨çš„æ¸…ç†ï¼Œå¦‚æœè¦åšè¿™ä¸€æ­¥å·¥ä½œï¼Œå¯ä»¥åœ¨ç±»ç»„ä»¶çš„ componentWillUnmount äº‹ä»¶ä¸­æˆ–è€…åœ¨å‡½æ•°ç»„ä»¶ä¸­ç»™ useEffect æŒ‡å®šçš„å‡½æ•°è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ã€‚

å’Œ useCallback æˆ– useMemo ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªä¾èµ–æ•°ç»„ï¼ŒReact ä¼šåˆ†æ Hooks å‚æ•°æ‰€æ¥æ”¶çš„å‡½æ•°å†…éƒ¨ä¾èµ–äº†ä»€ä¹ˆæ•°æ®ï¼Œåªè¦æ•°æ®æ›´æ–°å°±å†æ¬¡æ‰§è¡Œï¼ŒuseEffect å¯ä»¥çœç•¥ä¾èµ–åˆ—è¡¨ï¼Œå…¶å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨ç©ºæ•°ç»„è¾¾åˆ°çœç•¥ç›®çš„ã€‚ä¹Ÿå¯ä»¥å°†å¯èƒ½ä¾èµ–çš„æ•°æ®ç§»åˆ°å‡½æ•°å¤–éƒ¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¾èµ–åˆ—è¡¨ä¸åŒ¹é…ã€‚

	import React, { useState, useEffect } from "react"

	let randomColor = () => {
	    let colors = ['salmon', 'tomato', 'yellow', 'pink', 'cornsilk', 'orchid'];
	    let index = Math.ceil(Math.random() * colors.length);
	    return colors[index];
	}

	let styles = {
	    background: '#333',
	    boxShadow: '2px 2px 3px #222',
	    color: 'white',
	    padding: 32,
	    margin: 32
	}

	function App() {
	    const [count, setCount] = useState(0)
	    const [color, setColor] = useState("")

	    function increment() {
	        setCount(prevCount => prevCount + 1)
	    }

	    function decrement() {
	        setCount(prevCount => prevCount - 1)
	    }

	    useEffect(() => {
	        setColor(randomColor())
	    }, [count])

	    return (
	        <div style={styles}>
	            <h1 style={{ color: color } }> { count } </h1>
	            <button onClick = { increment } > Increment </button>
	            <button onClick = { decrement } > Decrement </button>
	        </div>
	    )
	}

	export default App


## â˜› useContext ä¸Šä¸‹æ–‡ä¼ é€’
- https://reactjs.org/docs/context.html
- https://reactjs.org/docs/hooks-reference.html#usecontext

ä¸€èˆ¬åœ¨ç»„ä»¶å±‚æ¬¡ä¸­ä¼ é€’å‚æ•°é€šè¿‡ Props è®¾ç½®çš„å‚æ•°å®ç°ï¼Œå½“è¦ä¼ é€’çš„å±‚çº§å¾ˆï¼Œé‚£ä¹ˆå°±éœ€è¦è¿™ä¸ª API æ–¹ä¾¿ç»„ä»¶åµŒå¥—ä¼ é€’å±æ€§ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨å­ç»„ä»¶ä¸­è®¢é˜…çˆ¶ç»„ä»¶çš„ Context å±æ€§ã€‚

è¿™ä¸ª API éœ€è¦æ­é… createContext æ–¹æ³•ä½¿ç”¨ï¼Œå¹¶ä¸”éœ€è¦åœ¨ç»„ä»¶ä¸­åˆ›å»ºä¸€ä¸ª Provider ç»„ä»¶ï¼Œå¹¶ä¸”åœ¨ Provider ç»„ä»¶ä¸­è®¾ç½®è¦ä¼ é€’çš„å€¼ï¼š

	import { createContext, useContext } from 'react';

	const FooContext = createContext('foo');

	function MyProvider({ children }) {
	  return (
	    <FooContext.Provider value="foo">
	      {children}
	    </FooContext.Provider>
	  );
	}

	// Must be rendered inside a MyProvider instance:

	function MyConsumer() {
	  const foo = useContext(FooContext);

	  return <p>{foo}</p>;
	}

å¯¹äºå¤šä¸ª Context.Provider åµŒå¥—çš„æƒ…å½¢ï¼Œå¯ä»¥ç»™å†…éƒ¨çš„å­ç»„ä»¶è®¾ç½® contextType å±æ€§ä¸ºä¸€ä¸ªæŒ‡å®šçš„ Context å¯¹è±¡ï¼Œå³ç”± React.createContext() åˆ›å»ºçš„å¯¹è±¡ï¼Œç„¶åä¸­è¿™ä¸ªå¯¹è±¡çš„æ•°æ®å°±å¯ä»¥é€šè¿‡å­ç»„ä»¶çš„ this.context è®¿é—®ã€‚

	<FooContext.Consumer>
	  {value => /* render something based on the context value */}
	</FooContext.Consumer>


å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­çš„ä¿®æ”¹ï¼š

	import React, { useState, useContext } from "react";

	const themes = {
	  light: {
	    foreground: "#000000",
	    background: "#eeeeee"
	  },
	  dark: {
	    foreground: "#ffffff",
	    background: "#222222"
	  }
	};

	const ThemeContext = React.createContext(themes);

	function App() {
	  return (
	    <ThemeContext.Provider value={themes}>
	      <Toolbar />
	    </ThemeContext.Provider>
	  );
	}

    function Toolbar(props:any) {
      return (
        <div>
        {['snickers', 'skittles', 'twix', 'milky way'].map(it => (
          <ThemedButton caption={it} />
        ))}
        </div>
      );
    }
    interface IProps {
      caption: string
    }
    function ThemedButton({caption}:IProps) {
      const themes:any = useContext(ThemeContext);
      const [name, setTheme] = useState('dark')

      let toggle = () => {
        setTheme((name === 'dark')? 'light':'dark');
      };
      let theme = themes[name];
      return (
        <button onClick={toggle} style={{ background: theme.background, color: theme.foreground }}>
          {caption}
        </button>
      );
    }



API å‚è€ƒï¼š

	const MyContext = React.createContext(defaultValue);

	<MyContext.Provider value={/* some value */}>

	<MyContext.Consumer>
	  {value => /* render something based on the context value */}
	</MyContext.Consumer>

	// Class.contextType
	class MyClass extends React.Component {
	  componentDidMount() {
	    let value = this.context;
	    /* perform a side-effect at mount using the value of MyContext */
	  }
	  componentDidUpdate() {
	    let value = this.context;
	    /* ... */
	  }
	  componentWillUnmount() {
	    let value = this.context;
	    /* ... */
	  }
	  render() {
	    let value = this.context;
	    /* render something based on the value of MyContext */
	  }
	}
	MyClass.contextType = MyContext;



## â˜› useMemo ç¼“å­˜å¯¹è±¡
- https://reactjs.org/docs/hooks-reference.html#usememo

useMemo API å‚è€ƒï¼š

	const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);

React.memo() çš„ä½¿ç”¨æ–¹å¼ï¼š

	function MyComponent(props) {
	  /* render using props */
	}
	function areEqual(prevProps, nextProps) {
	  /*
	  return true if passing nextProps to render would return
	  the same result as passing prevProps to render,
	  otherwise return false
	  */
	}
	export default React.memo(MyComponent, areEqual);

ä»¥ä¸‹ç¤ºèŒƒ useMemo çš„åº”ç”¨ï¼Œåªè¦ä¸ç‚¹å‡» Refresh Memoryï¼Œå¢å‡æ•°å€¼ä¸ä¼šå¯¼è‡´ Board ç»„ä»¶çš„ useMemo åŒ…è£…çš„éƒ¨åˆ†æ‰§è¡Œã€‚è¿™é‡Œåªæ˜¯å±•ç¤º useMemo å¦‚ä½•é€šè¿‡æ¯”è¾ƒç¼“å­˜æ•°æ®æ¥å†³å®šæ‰§è¡Œæµç¨‹ï¼Œåªè¦ä¼ å…¥çš„æ•°æ®æ•°ç»„ä¸­æ²¡æœ‰å˜åŒ–å°±ä¸ä¼šæ‰§è¡Œæ²¡æœ‰å¿…è¦çš„æ“ä½œï¼Œç›´æ¥è¿”å›ç¼“å­˜å†…å®¹ï¼Œè¿˜å¯ä»¥ç”¨ useMemo å°è£…ç»„ä»¶ã€‚å‡è®¾å­ç»„ä»¶ä¸­çš„ log æ—¥å¿—æ‰“å°æ–¹æ³•æ˜¯éå¸¸è€—æ—¶çš„æ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥æœ‰æ•ˆåœ°æå‡äº†æ•ˆç‡ï¼š

	import React from 'react';

	const App = () => {
	  const [count, setCount] = React.useState(0);
	  const [msg, setMessage] = React.useState('button');
	  let update = (i:number) => setCount(prev => prev + i);
	  return (
	    <>
	    <h1>{count}</h1>
	    <button onClick={() => update(-1)} > - </button>
	    <button onClick={() => update(+1)} > + </button>
	    <button onClick={() => setMessage(prev=>"Refresh")}>Refresh Memory</button>
	    <Board count={count}>{msg}</Board>
	    </>
	  )
	}

	function Board({ count, children }:any) {
	  let log = (...msg:any)=>console.log(...msg);
	  log('without useMemo', children);
	  const wrap = React.useMemo(()=>log('with useMemo', children), [children]);

	  return (
	    <div><hr/>{count}{children}<hr/></div>
	  )
	}

	export default App;

é‡æ–°ç¼–å†™ï¼Œå°†å‡½æ•°ç»„ä»¶è¿”å›çš„ç»„ä»¶ç”¨ useMemo å°è£…ï¼Œå¹¶è®¾ç½®æ›´æ–°çš„æœ€é«˜é¢‘åº¦ä¸ºç§’ï¼š

	let Board = ({ count, children }:any) => {
	  let stamp = Math.ceil(Date.now()/1000);
	  let log = (...msg:any[])=>{
	    console.log(...msg);
	    return [...msg, stamp];
	  }
	  const wrap = React.useMemo(()=>log('with useMemo', children), [children]);
	  log('without useMemo', children, wrap, stamp);
	  return React.useMemo(()=>(
	    <div><hr/>{count}{wrap}<hr/></div>
	  ), [stamp])
	};

ä½ å¯ä»¥æŠŠ useMemo ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µï¼Œä½†ä¸è¦æŠŠå®ƒå½“æˆè¯­ä¹‰ä¸Šçš„ä¿è¯ã€‚å°†æ¥ï¼ŒReact å¯èƒ½ä¼šé€‰æ‹©â€œé—å¿˜â€ä»¥å‰çš„ä¸€äº› memoized å€¼ï¼Œå¹¶åœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶é‡æ–°è®¡ç®—å®ƒä»¬ï¼Œæ¯”å¦‚ä¸ºç¦»å±ç»„ä»¶é‡Šæ”¾å†…å­˜ã€‚å…ˆç¼–å†™åœ¨æ²¡æœ‰ useMemo çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ‰§è¡Œçš„ä»£ç ï¼Œä¹‹åå†åœ¨ä½ çš„ä»£ç ä¸­æ·»åŠ  useMemoï¼Œä»¥è¾¾åˆ°ä¼˜åŒ–æ€§èƒ½çš„ç›®çš„ã€‚



## â˜› useCallback å›è°ƒç¼“å­˜
- https://reactjs.org/docs/hooks-reference.html#usecallback

useCallback API å‚è€ƒï¼š

	function useCallback<T extends (...args: any[]) => any>(callback: T, deps: ReadonlyArray<any>): T;

useCallback ä½¿ç”¨ç¤ºèŒƒï¼š

	const memoizedCallback = useCallback(
	  () => {
	    doSomething(a, b);
	  },
	  [a, b],
	);

å®ƒè¿”å›ä¸€ä¸ªç¼“å­˜å¥½çš„å›è°ƒå‡½æ•°ï¼Œåªè¦å‚æ•°åˆ—è¡¨ä¸­æŒ‡å®šçš„æ•°ç»„å‚æ•°å†…å®¹ä¸å˜ï¼Œå°±ä¸ä¼šå¼•èµ·å°è£…åœ¨å†…éƒ¨çš„ doSomething æ‰§è¡Œã€‚åœ¨éœ€è¦ä¼ é€’å›è°ƒå‡½æ•°çš„ç»„ä»¶ä¸­ä¼˜åŒ–æ—¶ä½¿ç”¨ï¼Œä»¥é¿å…ä¸å¿…è¦çš„æ¸²æŸ“æ“ä½œï¼Œç±»ä¼¼ shouldComponentUpdateï¼Œä»¥ä¸‹æ˜¯ç­‰ä»·è¡¨è¾¾å¼ï¼Œæ³¨æ„ useMemo çš„å‚æ•°ä¸­çš„åŒ¿åå‡½æ•°è¿”å›äº† fn å‡½æ•°è€Œä¸æ˜¯æ‰§è¡Œå®ƒï¼š

	useCallback(fn, deps)
	useMemo(() => fn, deps)

ä¸ºäº†æ›´è¿›ä¸€æ­¥äº†è§£ useCallback çš„ä½¿ç”¨ï¼Œç»§ç»­çœ‹ä¸€ä¸ªå»æŠ–åŠ¨çš„ä¾‹å­ï¼š


	function jitter(this:any, func:any, delay = 200) {
	  let timer:any;

	  let cancel = function () {
	    if(timer) clearTimeout(timer);
	    timer = null;
	  }
	  let todo = (...args:any[]) => {
	    console.log("do", args);
	    cancel();
	    func.apply(this, ...args);
	    // func.apply({}, ...args);
	  }

	  let jitter = (...args:any[])=>{
	    if(timer) return;
	    timer = setTimeout(todo, delay, args);
	  }
	  return jitter;
	}

	function App() {
	  const [count, setCount] = React.useState(0);
	  const [tick, setTick] = React.useState(0);
	  const jitterLimit = jitter(setTick);

	  const handleMouseMove = () => {
	    setCount(count + 1);
	    jitterLimit(tick + 1);
	  };

	  return (
	    <div onMouseMove={handleMouseMove}
	      style={{padding: 64, background:'#eee' }}>
	      <p>å…‰æ ‡è¿åŠ¨: {count}</p>
	      <p>é˜²æŠ–å¤„ç†: {tick}</p>
	    </div>
	  )
	}

é¼ æ ‡çš„ onMouseMove è§¦å‘æ˜¯å¾ˆå¿«çš„ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ª HOC é«˜é˜¶å‡½æ•° jitter æ¥å°è£…çŠ¶æ€ä¿®æ”¹å‡½æ•°ï¼Œä»¥é™ä½è§¦å‘é€Ÿç‡ã€‚

ä½†æ˜¯ï¼Œè¿™ä¸ªä¾‹å­æ˜¯å¤±è´¥çš„ï¼Œå› ä¸º App ç»„ä»¶æ¯æ¬¡æ›´æ–°æ¸²æŸ“ï¼Œéƒ½ä¼šé€šè¿‡é˜¶å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ–°çš„ jitterLimitï¼Œè¿™ä¸ªé—®é¢˜ä¼šå¯¼è‡´ timer å®šæ—¶å™¨ä¸èƒ½è¢«æ­£ç¡®æ¸…é™¤ï¼Œæ—¶é—´è¿‡æ»¤åŠŸèƒ½å°±å®Œå…¨å¤±å»äº†æ„ä¹‰ã€‚

ä½¿ç”¨ useMemo æˆ– useCallback éƒ½å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦ç»™å®ƒä»¬çš„ä¾èµ–ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ï¼Œè¿™æ ·ä¿è¯ jitter åªæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åç¼“å­˜ä¸‹æ¥ä¾›åç»­ä½¿ç”¨ã€‚

	// const jitterLimit = jitter(setTick);
	// const jitterLimit = React.useCallback(jitter(setTick), []);
	const jitterLimit = React.useMemo(() => jitter(setTick), []);

å½“ç„¶ï¼Œå¦‚æœåªæ˜¯å»æŠ–åŠ¨ï¼Œå¹¶ä¸éœ€è¦åšå¾—è¿™æ ·å¤æ‚ï¼Œåªéœ€è¦ä½¿ç”¨æ—¶é—´çš„æ•°å€¼ä½œä¸º useMemo æˆ– useCallback çš„ä¾èµ–è¾“å…¥ï¼Œå³å¯è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚

ä¸ºäº†è§£å†³æ•°æ®åœ¨é‡æ–°æ¸²æŸ“è¿‡ç¨‹ä¸­å¤±æ•ˆé—®é¢˜ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ useRef å‡½æ•°æ¥æŒä¹…å¼•ç”¨åŒä¸€ä¸ªæ•°æ®ã€‚ä»¥ä¸‹ç¤ºèŒƒä½¿ç”¨ useRef æ¥å¾—åˆ°ä¸€ä¸ªæŒä¹…çš„è¯»ç§’è®°å½•ï¼Œç„¶åé€šè¿‡å®ƒæ¥æ“æ§ useMemo ä¸­çš„ hoc è§¦å‘æ—¶æœºï¼š

	import React from 'react';

	interface IProps {
	  initialState: Readonly<IState>
	}
	interface IState {
	  a: number
	  b: number
	}

	function App({initialState}: IProps  = {initialState: {a: 1, b: 1}}) {
	  const [state, setCount] = React.useState(initialState);
	  let stampRef = React.useRef(0);
	  let wrap = (value:number) => {
	    setCount(pv => { 
	      return {...pv, ...{a: pv.a + value}};
	    });
	  }
	  let hoc = () => {
	    console.log("hoc", stampRef);
	    return (v: number) => {
	      let stamp = Math.ceil(Date.now()/1000);
	      // console.log("doit", stampRef, stamp);
	      if(stamp !== stampRef.current) setCount(pv => {
	        stampRef.current = stamp;
	        return {...pv, ...{b: pv.b + v}};
	      });
	    };
	  }
	  const hocSetCountA = React.useCallback(wrap, []);
	  const hocSetCountB = React.useMemo(hoc, [stampRef.current]);

	  let style = { padding: 64, background:'#eee', boxShadow:'1px 1px 2px black', margin: 8 };
	  return (
	    <div>
	      <p onMouseMove={() => hocSetCountA(+1)} style={style}>ç§»åŠ¨æ¬¡æ•°[ç›´é€š]: {state.a}</p>
	      <p onMouseMove={() => hocSetCountB(+1)} style={style}>ç§»åŠ¨æ¬¡æ•°[è¿‡æ»¤]: {state.b}</p>
	    </div>
	  )
	}

	App.defaultProps = {
	  initialState: {a: 10, b: 1},
	};



## â˜› useReducer è¿›è¡ŒçŠ¶æ€ç®¡ç†
- https://reactjs.org/docs/hooks-reference.html#usereducer

å¦‚æœä½ æœ‰ä¸€ç³»åˆ—çš„æ•°æ®ï¼Œå¹¶ä¸”æƒ³å°†è¿™äº›ä¸œè¥¿æ‹¼åˆï¼Œå¯ä»¥ä½¿ç”¨ Array çš„ reduce å‡½æ•°ã€‚ 

ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ•°å­—æ•°ç»„å¹¶ä¸”æƒ³å¾—åˆ°æ•°ç»„ä¸­æ‰€æœ‰æ•°å­—çš„æ€»å’Œï¼Œå°±å¯ä»¥ç»™ reduce ä¼ å…¥ä¸€ä¸ªå‡½æ•°ç”¨äºæ­¤ç›®çš„ï¼Œè€Œè¿™ä¸ªä¼ å…¥çš„å‡½æ•°å°±å«åš reducerï¼š

	let numbers = [1, 2, 3];
	let sum = numbers.reduce((total, number) => {
	    return total + number;
	}, 0);

useReducer å‚æ•°ä¸ reduce ç›¸åŒï¼Œå¹¶ä¸”å·¥ä½œæ–¹å¼åŸºæœ¬ä¸€æ ·ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ª reducer å‡½æ•°æ¥ç®€åŒ–ä¸€äº›æ“ä½œã€‚

useReducer API å‚è€ƒï¼š

	const [state, dispatch] = useReducer(reducer, initialArg, init);

å¦‚ä½•åªæ˜¯ç”¨ useReducer æ¥è®¡æ•°å°±å¤ªå¤§æå°ç”¨äº†ï¼Œå¦‚æœè¦è¿™æ ·ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š

	const [sum, dispatch] = useReducer((state, acton) => {
	  return state + action
	}, 0);

	dispatch(1);
	dispatch(2);
	dispatch(3);

useReducer è¿”å›ä¸€ä¸ªåŒ…å« 2 ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œç±»ä¼¼äº useStateã€‚ ç¬¬ä¸€ä¸ªæ˜¯å½“å‰çŠ¶æ€ï¼Œç¬¬äºŒä¸ªæ˜¯ dispatch æ–¹æ³•ï¼Œç”¨æ¥æ‰§è¡Œ reducer å‡½æ•°ã€‚æ³¨æ„ï¼Œstate å¯ä»¥æ˜¯ä»»ä½•å€¼ï¼Œå®ƒä¸ä¸€å®šæ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–ä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥æ˜¯å…¶ä»–ä»»ä½•ç±»å‹ã€‚

å°½ç®¡ useReducer æ˜¯é™„åŠ çš„ Hooks APIï¼Œç›¸æ¯” useState å®ƒåŠŸèƒ½ä¸Šæ›´åŸç”Ÿï¼Œå®šåˆ¶æ€§æ›´çµæ´»ï¼Œæ¢ç§è¯´æ³•å°±æ˜¯ä½¿ç”¨å®ƒéœ€è¦æ›´å¤šæ‰‹ç»­ï¼Œä½ å¯ä»¥å°†ä»»ä½•ä½¿ç”¨ useState çš„åœ°æ–¹éƒ½æ›¿æ¢æˆä½¿ç”¨ useReducerã€‚

	const initialState = {count: 0};

	function reducer(state, action) {
	  switch (action.type) {
	    case 'increment':
	      return {count: state.count + 1};
	    case 'decrement':
	      return {count: state.count - 1};
	    default:
	      throw new Error();
	  }
	}

	function Counter() {
	  const [state, dispatch] = useReducer(reducer, initialState);
	  return (
	    <>
	      Count: {state.count}
	      <button onClick={() => dispatch({type: 'decrement'})}>-</button>
	      <button onClick={() => dispatch({type: 'increment'})}>+</button>
	    </>
	  );
	}


ä»¥ä¸‹æ˜¯ useState ç¤ºèŒƒä»£ç æ›¿æ¢ä¸º useReducer åçš„å†™æ³•ï¼š

	interface IAction {
	  type: string
	  value: number
	}

	let reducer = (state:number, action:IAction)=>{
	  switch (action.type) {
	    case 'add':
	      return state + action.value;
	    default:
	      throw new Error();
	  }
	};

	const App = () => {
	  const [count, dispatch] = React.useReducer(reducer, 0);
	  let update = (i:number) => dispatch({type:'add', value:i});
	  return (
	    <>
	    <h1>{count}</h1>
	    <button onClick={() => update(-1)} > - </button>
	    <button onClick={() => update(+1)} > + </button>
	    </>
	  )
	}



## â˜› useRef å¼•ç”¨å¯¹è±¡
- https://reactjs.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node
- https://reactjs.org/docs/hooks-reference.html#useref
- [Refs and the DOM](https://reactjs.org/docs/refs-and-the-dom.html)
- [React ref çš„å‰ä¸–ä»Šç”Ÿ](https://zhuanlan.zhihu.com/p/40462264)
- [React refs çš„å‰ä¸–ä»Šç”Ÿ](http://www.sosout.com/2018/11/30/react-refs.html)


useRef å‡½æ•°å¯ä»¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡å®ç°è·¨æ¸²æŸ“å‘¨æœŸæŒä¹…ä¿å­˜æ•°æ®ã€‚

useRef API å‚è€ƒï¼š

	const refContainer = useRef(initialValue);
	const refContainer = useRef<T>(initialValue);

useRef è¿”å›ä¸€ä¸ªå¯å˜çš„å¼•ç”¨å¯¹è±¡ä¿å­˜åœ¨ .current å±æ€§ä¸­ï¼Œå®ƒçš„åˆå€¼å°±æ˜¯ initialValueï¼Œè¿”å›çš„å¯¹è±¡åœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸéƒ½æœ‰æ•ˆã€‚

ä»¥ä¸‹ä¾‹å­ç»“åˆ HTML çš„ ref å±æ€§æ¥æŒä¹…å¼•ç”¨ input å…ƒç´ ï¼š

	function TextInputWithFocusButton() {
	  const inputEl = useRef(null);
	  const onButtonClick = () => {
	    // `current` points to the mounted text input element
	    let input = inputEl.current! as HTMLInputElement;
	    input.focus();
	  };
	  return (
	    <>
	      <input ref={inputEl} type="text" />
	      <button onClick={onButtonClick}>Focus the input</button>
	    </>
	  );
	}

ä»£ç ä¸­ç”¨ useRef åˆ›å»ºäº†ä¸€ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹ç»™äº† button çš„ ref å±æ€§ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ couterRef.current è®¿é—®åˆ° input å¯¹åº”çš„ DOM å¯¹è±¡ã€‚ç›¸ä¼¼çš„ createRef å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨ï¼Œè€Œ useRef æ¯æ¬¡éƒ½ä¼šè¿”å›ç›¸åŒçš„å¼•ç”¨ã€‚

React é€šè¿‡å£°æ˜å¼çš„æ¸²æŸ“æœºåˆ¶æŠŠå¤æ‚çš„ DOM æ“ä½œæŠ½è±¡æˆä¸ºç®€å•çš„ state ä¸ props æ“ä½œï¼Œå°†å‰ç«¯å·¥ç¨‹å¸ˆä»åŸå§‹çš„ DOM æ“ä½œä¸­æ‹¯æ•‘å‡ºæ¥ã€‚å°½ç®¡æˆ‘ä»¬ä¸€å†å¼ºè°ƒåœ¨ React å¼€å‘ä¸­å°½é‡é¿å… DOM æ“ä½œï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸­ä»ç„¶æ— æ³•é¿å…ã€‚å½“ç„¶ React å¹¶æ²¡æœ‰æŠŠè·¯å µæ­»ï¼Œå®ƒæä¾›äº† ref ç”¨äºè®¿é—®åœ¨ render æ–¹æ³•ä¸­åˆ›å»ºçš„ DOM å…ƒç´ æˆ–è€…æ˜¯ React ç»„ä»¶å®ä¾‹ã€‚

å¼•ç”¨ä¸€èˆ¬è¿˜æ¶‰åŠ DOM æˆ–å­ç»„ä»¶çš„äº¤äº’ï¼Œè°ƒç”¨ç±»ç»„ä»¶çš„å…¬å¼€æ–¹æ³•ã€‚å¦‚æœæ˜¯å‡½æ•°ç»„ä»¶ï¼Œéœ€è¦é…åˆ useImperativeHandle æ¥å…¬å¼€æ–¹æ³•ï¼Œä¾›çˆ¶ç»„ä»¶å¼•ç”¨è°ƒç”¨ï¼Œä¸€èˆ¬éœ€è¦é…ç½® forwardRef ä½¿ç”¨ã€‚

å¼•ç”¨ç»„ä»¶æˆ– DOM èŠ‚ç‚¹çš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š

- String Refsï¼Œè¿™ç§æ–¹å¼å°†è¢«åºŸå¼ƒï¼Œé€šè¿‡ç»„ä»¶ä¸­çš„ ref è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²æ¥è½¬æ¢æˆç±»ç»„ä»¶å¯¹åº”çš„å±æ€§ï¼›
- Callback Refsï¼Œå¯ä»¥ä½¿ç”¨ useCallbackã€useMemo ç­‰ API å°è£…å›è°ƒå‡½æ•°ï¼›
- React.createRefï¼Œä» React 16.3 å¼€å§‹ï¼›
- React.useRefï¼Œä» React 16.3 å¼€å§‹ï¼›

ç¤ºä¾‹ï¼š

	class MyComponent extends Component {
	  renderRow = (index) => {
	    // This won't work. Ref will get attached to DataTable rather than MyComponent:
	    return <input ref={'input-' + index} />;

	    // This would work though! Callback refs are awesome.
	    return <input ref={input => this['input-' + index] = input} />;
	  }
	 
	  render() {
	    return <DataTable data={this.props.data} renderRow={this.renderRow} />
	  }
	}


ä»¥ä¸‹ç¤ºèŒƒäº†å¦‚ä½•å¼•ç”¨å­ç»„ä»¶å¹¶æ‰§è¡Œå­ç»„ä»¶çš„å…¬å¼€æ–¹æ³•ï¼š

	import React from 'react';

	function App() {
	  const [height, setHeight] = React.useState(0);
	  const [reff, setElement] = React.useState<HTMLInputElement>();

	  const ref = React.useRef<HTMLInputElement>(null);
	  let refc = React.createRef<HTMLInputElement>();
	  
	  React.useEffect(() => {
	    console.log("useEffect", ref, refc, reff);
	    if(ref.current) ref.current.value = "by React.useRef<HTMLInputElement>(null)";
	    if(refc.current) refc.current.value = "by React.createRef<HTMLInputElement>()";
	    if(reff) reff.value = "by ref={functionRef}";
	  });

	  let functionRef = (node: HTMLInputElement) => {
	    setElement(node);
	  }

	  let childRef = (node: Child) => {
	    if(!node) return;
	    console.log('childRef', node);
	    node.setText("ABC");
	    ;
	  }

	  const measuredRef = React.useCallback(node => {
	    if (node !== null) {
	      setHeight(node.getBoundingClientRect().height);
	    }
	  }, []);

	  let style = { 
	    border: '2px solid #ddd', padding: 4, 
	    display: 'block', minWidth: 320, margin: 4, background:'#eee' };

	  return (
	    <>
	      <h1 ref={measuredRef}>Hello, world</h1>
	      <h2>The above header is {Math.round(height)}px tall, and set text below with ABC.</h2>
	      <Child ref={childRef} />
	      <input style={style} onChange={()=>{}} ref={ref} value="useRef(null)"/>
	      <input style={style} onChange={()=>{}} ref={refc} value="createRef"/>
	      <input style={style} onChange={()=>{}} ref={functionRef} value="functionRef"/>
	    </>
	  );
	}

	class Child extends React.Component {
	  state = { text: "" };
	  setText(text = "") {
	    this.setState({ text });
	  }
	  render() {
	    return <p>text: {this.state.text}</p>;
	  }
	}


## â˜› useImperativeHandle & forwardRef
- [Forwarding Refs](https://reactjs.org/docs/forwarding-refs.html)
- https://reactjs.org/docs/hooks-reference.html#useimperativehandle
- https://github.com/reactjs/rfcs/blob/master/text/0030-ref-forwarding.md

åœ¨å‡½æ•°ç»„ä»¶ä¸­éœ€è¦é…åˆ useImperativeHandle æ¥å…¬å¼€æ–¹æ³•ï¼Œä¾›çˆ¶ç»„ä»¶å¼•ç”¨è°ƒç”¨ï¼Œä¸€èˆ¬éœ€è¦é…ç½® forwardRef ä½¿ç”¨ï¼š

API å‚è€ƒï¼š

	useImperativeHandle(ref, createHandle, [deps])

ä½¿ç”¨ç¤ºèŒƒï¼Œåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å‘çˆ¶ç»„ä»¶æš´éœ²æ–¹æ³•ï¼š

	function FancyInput(props, ref) {
	  const inputRef = useRef();
	  useImperativeHandle(ref, () => ({
	    focus: () => {
	      inputRef.current.focus();
	    }
	  }));
	  return <input ref={inputRef} ... />;
	}

	FancyInput = forwardRef(FancyInput);

è¿™ä¸ªä¾‹å­ä¸­çš„å‡½æ•°ç»„ä»¶åœ¨åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨æ—¶ï¼Œå¦‚ `<FancyInput ref={inputRef} />` ï¼Œå¦‚ä½¿ç”¨ inputRef.current.focus() è·å¾—è®¿é—®ã€‚


	function Parent() {
	  const ref = useRef(null);

	  return (
	    <>
	      <FancyInput ref={ref} />
	      <button onClick={() => {ref.current && ref.current.focus()}} > Focus on </button>
	    </>
	  );
	}

ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ forwardRef å°è£…ç»„ä»¶ï¼š

	const FancyButton = React.forwardRef((props, ref) => (
	  <button ref={ref} className="FancyButton">
	    {props.children}
	  </button>
	));

	// You can now get a ref directly to the DOM button:
	const ref = React.createRef();
	<FancyButton ref={ref}>Click me!</FancyButton>;






## â˜› useLayoutEffect
- https://github.com/chenglou/react-motion

useLayoutEffect å’Œ useEffect å‡½æ•°ç­¾åæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯å®ƒä¼šåœ¨æ‰€æœ‰çš„ DOM å˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å– DOM å¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼ŒuseLayoutEffect å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶å‰è¿›è¡Œã€‚

æ‰€ä»¥å°½å¯èƒ½ä½¿ç”¨ useEffect ä»¥é¿å…é˜»å¡è§†è§‰æ›´æ–°ã€‚

å¦‚æœè¦ä»ç±»ç»„ä»¶è¿ç§»ä»£ç ï¼Œè¯·æ³¨æ„ useLayoutEffect ä¸ componentDidMountã€ componentDidUpdate åœ¨åŒä¸€é˜¶æ®µæ¿€å‘ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å»ºè®®é¦–å…ˆä» useEffect å¼€å§‹ï¼Œå¹¶ä¸”åªæœ‰åœ¨å¯¼è‡´é—®é¢˜æ—¶æ‰å°è¯•ä½¿ç”¨ useLayoutEffectã€‚

å¦‚æœä½¿ç”¨æœåŠ¡å™¨å‘ˆç°ï¼Œè¯·è®°ä½ï¼Œåœ¨ä¸‹è½½å®Œ JavaScript ä¹‹å‰ï¼ŒuseLayoutEffect å’Œ useEffect éƒ½ä¸èƒ½è¿è¡Œï¼Œè¿™æ˜¯è„šæœ¬åŒæ­¥åŠ è½½å¯¼è‡´çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æœåŠ¡å™¨å‘ˆç°çš„ç»„ä»¶åŒ…å« useLayoutEffect æ—¶ React ä¼šå‘å‡ºè­¦å‘Šã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¦ä¹ˆå°†è¯¥é€»è¾‘ç§»åˆ° useEffectï¼Œå¦‚æœä¸éœ€è¦ç¬¬ä¸€æ¬¡å‘ˆç°ã€‚è¦ä¹ˆå»¶è¿Ÿæ˜¾ç¤ºè¯¥ç»„ä»¶ï¼Œç›´åˆ°å®¢æˆ·ç«¯å‘ˆç°ä¹‹åï¼Œå¦‚æœåœ¨ useLayoutEffect è¿è¡Œä¹‹å‰ HTML é¡µé¢çœ‹èµ·æ¥å·²æŸåã€‚


å°†éœ€è¦ä»æœåŠ¡å™¨å‘ˆç°çš„ HTML å¸ƒå±€æ•ˆæœçš„ç»„ä»¶ä¸­æ’é™¤ï¼Œè¯·ä½¿ç”¨æœ‰æ¡ä»¶åœ°å‘ˆç°å®ƒï¼Œå¹¶ä½¿ç”¨ useEffect å»¶è¿Ÿæ˜¾ç¤ºå®ƒã€‚è¿™æ ·ï¼Œç”¨æˆ·ç•Œé¢å°±ä¸ä¼šåœ¨èåˆä¹‹å‰å‡ºç°ç ´æŸã€‚

	showChild && <Child />

	useEffect(() => { setShowChild(true); }, [])

æ€»ç»“è¦ç‚¹ï¼š

- useLayoutEffect å’Œ componentDidMountã€componentDidUpdate è§¦å‘æ—¶æœºä¸€è‡´ï¼Œéƒ½åœ¨åœ¨ DOM ä¿®æ”¹åä¸”æµè§ˆå™¨æ¸²æŸ“ä¹‹å‰ï¼›
- useLayoutEffect æ¯” useEffect æ›´æ—©çš„è§¦å‘æ‰§è¡Œï¼›
- useLayoutEffect ä¼šé˜»å¡æµè§ˆå™¨æ¸²æŸ“ï¼Œåˆ‡è®°æ‰§è¡ŒåŒæ­¥çš„è€—æ—¶æ“ä½œã€‚

ä¾‹å­æ¼”ç¤ºï¼š


	import React, { useEffect, useLayoutEffect, useRef } from "react";

	let style = {
	    display: 'block',
	    background: 'yellow',
	    padding: 24,
	    margin: 32,
	    marginRight: 'auto',
	    marginLeft: 'auto',
	    // clear: "both",
	    width: 240,
	    height: 140,
	}

	let animate = (obj:any, att: string, start:number, end:number, unit:string) => {
	    let fps = 1000/160, pos = start, diff = start - end, t = 100, dir = start>end? -1:1;
	    let last = Date.now();
	    (function closure(){
	        // time cost task!
	        while(Date.now()<last+fps) ;
	        // console.log("animate", pos, start, end, diff, t, dir);
	        last = Date.now();
	        pos = start - diff*(1 - t--/100);
	        obj[att] = pos+unit;
	        if((dir>0 && pos<end) || (dir<0 && pos>end) ) {
	            closure();
	        }
	    })();
	};

	const UseEffect: React.FC<any> = ({children}) => {
	    const box = useRef<HTMLDivElement>(null);
	    useEffect(() => {
	        let div = box.current!;
	        console.log('useEffect');
	        animate(box.current!.style, 'marginLeft', div.offsetLeft, 100, 'px');
	    }, []);
	    let css = {...style, background: 'cornflowerblue'};
	    return (
	    <div id="useEffect" style={css} ref={box}>
	        {children}
	    </div>
	    );
	};

	const UseLayoutEffect: React.FC<any> = ({children}) => {
	    const box = useRef<HTMLDivElement>(null);
	    useLayoutEffect(() => {
	        let div = box.current!;
	        console.log('useLayoutEffect');
	        animate(box.current!.style, 'marginLeft', div.offsetLeft, 100, 'px');
	    }, []);
	    // style will be immutatble if bind to div.style directly.
	    style.background = 'yellow';
	    return (
	    <div id="useLayout" style={{...style, background: 'yellow'}} ref={box}>{children} </div>
	    );
	};

	export default function App() {
	    return (
	    <div className="App">
	        <UseEffect>åˆ·æ–°è§‚å¯Ÿ useEffect æœ‰ç§»åŠ¨ï¼Œå› ä¸ºé‡ç»˜åæ‰æ‰§è¡Œå®šä½è®¾ç½®ã€‚</UseEffect>
	        <UseLayoutEffect>useLayoutEffect è§‚å¯Ÿä¸åˆ°ç§»åŠ¨ï¼Œå› ä¸ºé‡ç»˜å‰å®šä½è®¾ç½®æ‰§è¡Œå®Œæˆã€‚</UseLayoutEffect>
	    </div>
	    );
	}


é…å¥—çš„åŠ¨ç”»æ ·å¼ï¼š

	.animate {
	    /* background-color: #e74c3c; */
	    animation: bg-color 0.21s 3/* infinite */;
	    -webkit-animation: bg-color 0.21s 3/* infinite */;
	}

	@-webkit-keyframes bg-color {
	    0% { background-color: #eee; }
	    20% { background-color: #e0dbc4; }
	    60% { background-color: #e3e7ac; }
	    100% { background-color: #eee; } 
	}

	@keyframes bg-color {
	    0% { background-color: #eee; }
	    20% { background-color: #e0dbc4; }
	    60% { background-color: #e3e7ac; }
	    100% { background-color: #eee; } 
	}




## â˜› useDebugValue

useDebugValue å¯ä»¥ç”¨æ¥åœ¨ React DevTools å¼€å‘å·¥å…·é¢æ¿ä¸Šæ˜¾ç¤ºæ ‡ç­¾ï¼š

	useDebugValue(value)

ä¾‹å¦‚ä»¥ä¸‹ useFriendStatus ç»„ä»¶ï¼š

	function useFriendStatus(friendID) {
	  const [isOnline, setIsOnline] = useState(null);

	  // ...

	  // Show a label in DevTools next to this Hook
	  // e.g. "FriendStatus: Online"
	  useDebugValue(isOnline ? 'Online' : 'Offline');

	  return isOnline;
	}

useDebugValue è¿˜æ¥å—å»¶åæ ¼å¼åŒ–å‡½æ•°ä½œä¸ºå¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°åªæœ‰åœ¨ Hook è¢«æ£€æŸ¥æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚

	useDebugValue(date, date => date.toDateString());


## Refs & DOM
- Refs and the DOM https://reactjs.org/docs/refs-and-the-dom.html
- Forwarding Refs https://reactjs.org/docs/forwarding-refs.html

React çš„å¼•ç”¨ Refs æä¾›äº†ä¸€ä¸ªæ–¹æ³•æ©Ÿåˆ¶ï¼Œç”¨ä¾†è·å¾— DOM èŠ‚ç‚¹æˆ–è€…åœ¨ render æ–¹æ³•ä¸­åˆ›å»ºçš„ React å…ƒç´ ã€‚

åœ¨å…¸å‹çš„ React æ•°æ®æµä¸­ï¼Œprops æ˜¯å”¯ä¸€çš„çˆ¶ç»„ä»¶ä¸å®ƒä»¬çš„å­å…ƒç´ çš„é€šä¿¡æ–¹å¼ã€‚æ›´æ”¹å­å…ƒç´ ï¼Œä½ éœ€è¦ä½¿ç”¨æ–°çš„ props å»é‡æ–°æ¸²æŸ“å­å…ƒç´ ã€‚ä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹ä½ ç°åœ¨å…¸å‹æ•°æ®æµä¹‹å¤–å¼ºåˆ¶çš„æ›´æ”¹å…ƒç´ ã€‚è¢«æ›´æ”¹çš„å­å…ƒç´ å¯èƒ½æ˜¯ä¸€ä¸ª React ç»„ä»¶çš„å®ä¾‹ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª DOM å…ƒç´ ã€‚å¯¹æ‰€æœ‰è¿™äº›æƒ…å†µï¼ŒReact æä¾›äº†ä¸€ç§ç‰¹æ®Šæ–¹æ³•ï¼Œå®ƒå°±æ˜¯ Refsï¼š

- ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Refs

	ç®¡ç†ç„¦ç‚¹ã€æ–‡æœ¬é€‰æ‹©ã€åª’ä½“å›æ”¾
	è§¦å‘å¿…è¦åŠ¨ç”»ï¼›
	æ•´åˆç¬¬ä¸‰æ–¹ DOM åº“ï¼›
	é¿å…å¯¹ä»»ä½•å¯ä»¥å£°æ˜å¼è§£å†³çš„é—®é¢˜ä½¿ç”¨ Refsï¼› 
	æ¯”å¦‚ç›¸å¯¹äºæš´éœ²ä¸€ä¸ªå¯¹è¯æ¡†ç»„ä»¶çš„ open()ã€ close() æ–¹æ³•ï¼Œè¯·å„ªå…ˆä½¿ç”¨ isOpen propï¼

- ä¸è¦è¿‡åº¦ä½¿ç”¨ Refsï¼

    ä½ çš„ç¬¬ä¸€ä¸ªå€¾å‘å¯èƒ½æ˜¯ä½¿ç”¨ Refs å»å®ç°ä¸€äº›APPä¸­çš„ä¸œè¥¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·åœä¸‹æ¥ï¼Œä»”ç»†æƒ³æƒ³ state åº”è¯¥å­˜åœ¨çš„ç»„ä»¶å±‚æ¬¡ã€‚ç»å¸¸åœ°ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“åº”è¯¥ç”±æ›´é«˜çš„å±‚æ¬¡å»æ‹¥æœ‰ stateã€‚

- åˆ›å»º Refsï¼š

	å¯ä»¥é€šè¿‡ React.createRef() åˆ›å»º Refs å°è±¡å¹¶é€šè¿‡çµ„ä»¶æ¨™ç°½çš„ ref å±æ€§é—œè¯åˆ° React ç»„ä»¶ã€‚Refs é€šå¸¸å½“ç»„ä»¶è¢«å¯¦ä¾‹åŒ–åˆ›å»ºæ—¶è¢«åˆ†é…ç»™å®ä¾‹å˜é‡ï¼Œè¿™æ ·å®ƒä»¬å°±èƒ½åœ¨ç»„ä»¶ä¸­è¢«å¼•ç”¨ã€‚

		class MyComponent extends React.Component {
			constructor(props) {
				super(props);
				this.myRef = React.createRef();
			}
			render() {
				return <div ref={this.myRef} />;
			}
		}

- è®¿é—® Refsï¼š

	å½“ä¸€ä¸ª ref å°è±¡é€šè¿‡ render æ”¾å…¥ä¸€ä¸ªå…ƒç´ ä¸­ï¼Œä¸€ä¸ªå¯¹èŠ‚ç‚¹çš„å¼•ç”¨å¯ä»¥é€šè¿‡ ref çš„ current å±æ€§å¾—åˆ°ï¼›

		const node = this.myRef.current;

ref çš„å€¼æ ¹æ®èŠ‚ç‚¹ç±»å‹çš„ä¸åŒè€Œä¸åŒï¼š

- å½“ ref å±æ€§ç”¨äº HTML å…ƒç´ ï¼Œåœ¨æ„é€ å™¨ä¸­é€šè¿‡ React.createRef() å‡½æ•°åˆ›å»ºçš„ ref æ¥æ”¶åº•å±‚ DOM å…ƒç´ ä½œä¸ºå®ƒçš„ current å±æ€§ï¼›
- å½“ ref å±æ€§ç”¨äºä¼ ç»Ÿçš„ç±»ç»„ä»¶ï¼Œref å¯¹è±¡æ¥æ”¶æŒ‚è½½å¥½çš„ç»„ä»¶å®ä¾‹ä½œä¸ºå®ƒçš„ currentï¼›



## â˜› forwardRef å‘çˆ¶ç»„ä»¶æš´éœ² DOM
- https://zh-hans.reactjs.org/docs/forwarding-refs.html
- https://reactjs.org/docs/forwarding-refs.html

Forwarding Refs è½¬å‘æ˜¯ä¸€é¡¹å°† ref è‡ªåŠ¨åœ°é€šè¿‡ç»„ä»¶ä¼ é€’åˆ°å…¶ä¸€å­ç»„ä»¶çš„æŠ€å·§ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨ä¸­çš„ç»„ä»¶æ¥è¯´ï¼Œè¿™é€šå¸¸ä¸æ˜¯å¿…éœ€çš„ã€‚ä½†å…¶å¯¹æŸäº›ç»„ä»¶ï¼Œå°¤å…¶æ˜¯å¯é‡ç”¨çš„ç»„ä»¶åº“æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

åœ¨å¾ˆç½•è§çš„æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿè®¸æƒ³è¦ä»çˆ¶ç»„ä»¶è®¿é—®åˆ°å­å…ƒç´ çš„ DOM èŠ‚ç‚¹ã€‚é€šå¸¸æ¥è¯´æˆ‘ä»¬ä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºè¿™æ ·ç ´åäº†ç»„ä»¶çš„å°è£…æ€§ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å¯¹äºç±»ä¼¼ï¼šè§¦å‘èšç„¦ã€æ”¹å˜å­å…ƒç´  DOM èŠ‚ç‚¹çš„å¤§å°ã€ä½ç½®ç­‰æƒ…å†µéå¸¸æœ‰ç”¨ã€‚

ä½ å¯ä»¥å‘å­ç»„ä»¶å¢åŠ  refï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œä½ åªä¼šè·å¾—ä¸€ä¸ªç»„ä»¶å®ä¾‹è€Œä¸æ˜¯ DOM èŠ‚ç‚¹ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒå¯¹å‡½æ•°å¼ç»„ä»¶æ²¡ç”¨ï¼

React 16.3 æˆ–è€…æ›´é«˜çš„ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨å¼•ç”¨è½¬å‘ Ref forwarding ä¾†è®©ç»„ä»¶å¯ä»¥æœ‰é€‰æ‹©åœ°æš´éœ²å­ç»„ä»¶çš„ refã€‚

React 16.2 æˆ–è€…æ›´ä½çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨æ›¿ä»£æ–¹æ³•ï¼Œæ˜¾å¼çš„ä¼ å…¥ä¸€ä¸ª ref å½“åšä¸€ä¸ªä¸åŒå‘½åçš„ propã€‚

å¦‚æœå¯èƒ½ï¼Œä¸å»ºè®®æš´éœ² DOM èŠ‚ç‚¹ï¼Œä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹è¿˜æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•éœ€è¦ä½ å»åœ¨å­ç»„ä»¶ä¸­å¢åŠ ä¸€äº›ä»£ç ï¼Œå¦‚æœä½ å®Œå…¨æ²¡æœ‰å¯¹äºå­ç»„ä»¶å®ç°çš„æ§åˆ¶ï¼Œä½ æœ€åçš„é€‰æ‹©æ˜¯ä½¿ç”¨ findDOMNode() æ–¹æ³•ï¼Œå½“ç„¶ï¼Œä¹Ÿåªèƒ½è¿™æ ·äº†ã€‚

æ—§ç‰ˆæœ¬ä¸­å‡½æ•°ç»„ä»¶æ²¡æœ‰å®ä¾‹å¼•ç”¨çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ this ä¸Šä¸‹æ–‡ï¼Œä¸èƒ½é€šè¿‡ createRef() æ¥æ‹¿åˆ°å®ä¾‹ã€‚ä¸ºäº†è®©å‡½æ•°ç»„ä»¶è·å–å­ç»„ä»¶çš„ DOM å®ä¾‹ï¼ŒReact 16 å¼•å…¥ React.forwardRef() æ–¹æ³•ä»è€Œèƒ½åœ¨çˆ¶ç»„ä»¶è·å–åˆ°å­ç»„ä»¶çš„ DOM å®ä¾‹ï¼š

	import React from 'react'

	const Child = React.forwardRef((props, ref)=>{
	  return <div ref={ref}>child div</div>
	})
	
	export default class Parent extends React.Completed{
	  constructor(props){
	    super(props)
	    this.child = React.createRef()
	  }
	
	  componentDidMount(){
	    this.child.current.value='hahhaha'
	  }
	
	  render(){
	    return <Child ref={this.child} />
	  }
	
	}

å¼•ç”¨è½¬å‘ Ref forwading æ˜¯ä¸€ç§é€šè¿‡ç»„ä»¶å‘å­ç»„ä»¶è‡ªåŠ¨ä¼ é€’å¼•ç”¨ ref çš„æŠ€æœ¯ï¼Œå¯¹äºåº”ç”¨è€…çš„å¤§å¤šæ•°ç»„ä»¶æ¥è¯´æ²¡ä»€ä¹ˆä½œç”¨ã€‚ä½†æ˜¯å¯¹äºæœ‰äº›é‡å¤ä½¿ç”¨çš„ç»„ä»¶ï¼Œå¯èƒ½æœ‰ç”¨ã€‚ä¾‹å¦‚æŸäº› input ç»„ä»¶ï¼Œéœ€è¦æ§åˆ¶å…¶ focusï¼Œæœ¬æ¥æ˜¯å¯ä»¥ä½¿ç”¨ ref æ¥æ§åˆ¶ï¼Œä½†æ˜¯å› ä¸ºè¯¥ input å·²è¢«åŒ…è£¹åœ¨ç»„ä»¶ä¸­ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ forwardRef æ¥é€è¿‡ç»„ä»¶è·å¾—è¯¥ input çš„å¼•ç”¨ã€‚

åœ¨ä½¿ç”¨ forwardRef ä¹‹å‰ï¼Œå›é¡¾ä¸€ä¸‹ HOCï¼ˆhigher-order componentï¼‰åœ¨ ref ä½¿ç”¨ä¸Šçš„é—®é¢˜ï¼ŒHOC çš„ ref æ˜¯æ— æ³•é€šè¿‡ props è¿›è¡Œä¼ é€’çš„ï¼Œå› æ­¤æ— æ³•ç›´æ¥è·å–è¢«åŒ…è£¹ç»„ä»¶ WrappedComponentï¼Œéœ€è¦å®ç°é«˜é˜¶ç»„ä»¶çš„ getWrappedInstance æ–¹æ³•è¿›è¡Œä¸­è½¬è·å–ã€‚

åœ¨æ‹¥æœ‰ forwardRef ä¹‹åï¼Œå°±ä¸éœ€è¦å†é€šè¿‡äº†ï¼Œåˆ©ç”¨ forwardRef èƒ½ç›´æ¥ç©¿é€ HOCComponent è·å–åˆ° WrappedComponentã€‚

æ ¸å¿ƒæ–¹æ³•æ˜¯ React.forwardRefï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæœ‰é¢å¤– ref å‚æ•°ï¼Œå¹¶å°†æ­¤ ref å‚æ•°æ³¨å…¥åˆ°ç”Ÿæˆ React å‡½æ•°ç»„ä»¶ä¸­ï¼Œä¸è°ƒç”¨è¯¥æ–¹æ³•ï¼Œæ™®é€šçš„ç»„ä»¶å‡½æ•°ä¸ä¼šè·å¾—è¯¥ ref å‚æ•°ã€‚

React.forwardRef çš„åŸç†å…¶å®éå¸¸ç®€å•ï¼ŒforwardRef ä¼šç”Ÿæˆ React å†…éƒ¨ä¸€ç§è¾ƒä¸ºç‰¹æ®Šçš„ Componentã€‚å½“è¿›è¡Œåˆ›å»ºæ›´æ–°æ“ä½œæ—¶ï¼Œä¼šå°† forwardRef ç»„ä»¶ä¸Šçš„ props ä¸ ref ç›´æ¥ä¼ é€’ç»™æå‰æ³¨å…¥çš„ render å‡½æ•°æ¥ç”Ÿæˆ childrenã€‚



Ref è½¬å‘æ˜¯ä¸€ä¸ªå¯é€‰ç‰¹æ€§ï¼Œå…¶å…è®¸æŸäº›ç»„ä»¶æ¥æ”¶ refï¼Œå¹¶å°†å…¶å‘ä¸‹ä¼ é€’ç»™å­ç»„ä»¶ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è½¬å‘å®ƒã€‚

åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ`FancyButton` ä½¿ç”¨ `React.forwardRef` æ¥è·å–ä¼ é€’ç»™å®ƒçš„ refï¼Œç„¶åè½¬å‘åˆ°å®ƒæ¸²æŸ“çš„ DOM buttonï¼š

```ts
const FancyButton = React.forwardRef((props, ref) => (
  <button ref={ref} className="FancyButton">
    {props.children}
  </button>
));

// You can now get a ref directly to the DOM button:
const ref = React.createRef();
<FancyButton ref={ref}>Click me!</FancyButton>;
```

è¿™æ ·ï¼Œä½¿ç”¨ `FancyButton` çš„ç»„ä»¶å¯ä»¥è·å–åº•å±‚ DOM èŠ‚ç‚¹ button çš„ ref ï¼Œå¹¶åœ¨å¿…è¦æ—¶è®¿é—®ï¼Œå°±åƒå…¶ç›´æ¥ä½¿ç”¨ DOM button ä¸€æ ·ã€‚

ä¸Šè¿°ç¤ºä¾‹å‘ç”Ÿæƒ…å†µçš„é€æ­¥è§£é‡Šï¼š

- é€šè¿‡è°ƒç”¨ React.createRef åˆ›å»ºäº†ä¸€ä¸ª React ref å¼•ç”¨å¹¶å°†å…¶èµ‹å€¼ç»™ ref å¸¸é‡ã€‚
- é€šè¿‡ JSX ç»„ä»¶å±æ€§ ref å°†å…¶å‘ä¸‹ä¼ é€’ç»™ <FancyButton ref={ref}>ã€‚
- FancyButton å†…éƒ¨ï¼Œå³é€šè¿‡ forwardRef å‡½æ•°å°è£…çš„å†…å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ (props, ref) è¿™é‡Œé¢çš„å°è£…äº†è½¬å‘è¿‡ç¨‹ã€‚
- å†é€šè¿‡ JSX å±æ€§å‘ä¸‹è½¬å‘è¯¥ ref å‚æ•°åˆ° `<button ref={ref}>`ã€‚
- å½“ ref æŒ‚è½½å®Œæˆï¼Œref.current å°†æŒ‡å‘ DOM button èŠ‚ç‚¹ã€‚

ç¬¬äºŒä¸ªå‚æ•° ref åªåœ¨ä½¿ç”¨ React.forwardRef å°è£…åæ³¨å…¥ç»„ä»¶çš„ï¼Œå¸¸è§„å‡½æ•°å’Œ class ç»„ä»¶ä¸æ¥æ”¶ ref å‚æ•°ï¼Œä¸” props ä¸­ä¹Ÿä¸å­˜åœ¨ refã€‚

Ref è½¬å‘ä¸ä»…é™äº DOM ç»„ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥è½¬å‘ refs åˆ° class ç»„ä»¶å®ä¾‹ä¸­ã€‚


åœ¨ç»„ä»¶åº“ä¸­ä½¿ç”¨ forwardRef åº”å½“å°†å…¶è§†ä¸ºä¸€ä¸ªç ´åæ€§æ›´æ”¹ï¼Œå¹¶å‘å¸ƒåº“çš„ä¸€ä¸ªæ–°çš„ä¸»ç‰ˆæœ¬ã€‚è¿™æ˜¯å› ä¸ºä½ çš„åº“å¯èƒ½ä¼šæœ‰æ˜æ˜¾ä¸åŒçš„è¡Œä¸ºï¼Œä¾‹å¦‚ refs è¢«åˆ†é…ç»™äº†è°ï¼Œä»¥åŠå¯¼å‡ºäº†ä»€ä¹ˆç±»å‹ï¼Œå¹¶ä¸”è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä¾èµ–æ—§è¡Œä¸ºçš„åº”ç”¨å’Œå…¶ä»–åº“å´©æºƒã€‚

å‡ºäºåŒæ ·çš„åŸå› ï¼Œå½“ React.forwardRef å­˜åœ¨æ—¶æœ‰æ¡ä»¶åœ°ä½¿ç”¨å®ƒä¹Ÿæ˜¯ä¸æ¨èçš„ï¼šå®ƒæ”¹å˜äº†ä½ çš„åº“çš„è¡Œä¸ºï¼Œå¹¶åœ¨å‡çº§ React è‡ªèº«æ—¶ç ´åç”¨æˆ·çš„åº”ç”¨ã€‚


è½¬å‘ refs è¿™ä¸ªæŠ€å·§å¯¹é«˜é˜¶ç»„ä»¶ HOC ç‰¹åˆ«æœ‰ç”¨ï¼Œä»ä¸€ä¸ªè¾“å‡ºç»„ä»¶ props åˆ°æ§åˆ¶å°çš„ HOC ç¤ºä¾‹å¼€å§‹ï¼š

```ts
function logProps(WrappedComponent) {
  class LogProps extends React.Component {
    componentDidUpdate(prevProps) {
      console.log('old props:', prevProps);
      console.log('new props:', this.props);
    }

    render() {
      return <WrappedComponent {...this.props} />;
    }
  }

  return LogProps;
}
```

logProps HOC é€ä¼ æ‰€æœ‰ props åˆ°å…¶åŒ…è£¹çš„ç»„ä»¶ï¼Œæ‰€ä»¥æ¸²æŸ“ç»“æœå°†æ˜¯ç›¸åŒçš„ã€‚

éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨ logProps å°è£…å…¶å®ƒç»„ä»¶æ—¶ï¼Œrefs ä¸ä¼šé€ä¼ ä¸‹å»ï¼Œè¿™æ˜¯å› ä¸º ref ä¸æ˜¯ prop å±æ€§ã€‚å°±åƒ key ä¸€æ ·ï¼Œå…¶è¢« React è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ã€‚å¦‚æœä½ å¯¹ HOC æ·»åŠ  refï¼Œè¯¥ ref å°†å¼•ç”¨æœ€å¤–å±‚çš„å®¹å™¨ç»„ä»¶ï¼Œè€Œä¸æ˜¯è¢«åŒ…è£¹çš„ç»„ä»¶ã€‚


è¿™æ„å‘³ç€ç”¨äºæˆ‘ä»¬ FancyButton ç»„ä»¶çš„ refs å®é™…ä¸Šå°†è¢«æŒ‚è½½åˆ° LogProps ç»„ä»¶ï¼š


```js
let FancyButton = logProps(SomeButton);

const ref = React.createRef();

// The FancyButton component we imported is the LogProps HOC.
// Even though the rendered output will be the same,
// Our ref will point to LogProps instead of the inner FancyButton component!
// This means we can't call e.g. ref.current.focus()
<FancyButton label="Click Me" handleClick={handleClick} ref={ref} />;
```

è€Œé€šè¿‡ä½¿ç”¨ React.forwardRef API æ˜ç¡®åœ°å°† refs è½¬å‘åˆ°å†…éƒ¨çš„ FancyButton ç»„ä»¶ã€‚React.forwardRef æ¥å—ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œå…¶æ¥æ”¶ props å’Œ ref å‚æ•°å¹¶è¿”å›ä¸€ä¸ª React èŠ‚ç‚¹ã€‚

ä¾‹å¦‚ï¼š

```ts
function logProps(Component) {
  class LogProps extends React.Component {
    componentDidUpdate(prevProps) {
      console.log('old props:', prevProps);
      console.log('new props:', this.props);
    }

    render() {
      const {forwardedRef, ...rest} = this.props;

      // Assign the custom prop "forwardedRef" as a ref
      return <Component ref={forwardedRef} {...rest} />;
    }
  }

  // Note the second param "ref" provided by React.forwardRef.
  // We can pass it along to LogProps as a regular prop, e.g. "forwardedRef"
  // And it can then be attached to the Component.
  return React.forwardRef((props, ref) => {
    return <LogProps {...props} forwardedRef={ref} />;
  });
}
```

æ³¨æ„ï¼Œå› ä¸º ref æ˜¯ä¿ç•™å±æ€§å­—æ®µï¼Œåœ¨ LogProps ç»„ä»¶çš„ JSX å±æ€§ä¸­ä½¿ç”¨æ™®é€šçš„å­—æ®µ forwardedRef æ¥ä¼ é€’å¼•ç”¨ã€‚


ä¸ºæ–¹ä¾¿è°ƒè¯•è®¾ç½® displayName å±æ€§ï¼Œä»¥ä¸‹ç»„ä»¶å°†åœ¨ DevTools ä¸­æ˜¾ç¤ºä¸º ForwardRefï¼š

	const WrappedComponent = React.forwardRef((props, ref) => {
	  return <LogProps {...props} forwardedRef={ref} />;
	});

å¦‚æœä½ å‘½åäº†æ¸²æŸ“å‡½æ•°ï¼ŒDevTools å°†æ˜¾ç¤ºå…¶åç§°ï¼Œä¾‹å¦‚ ForwardRef(myFunction)ï¼š

	const WrappedComponent = React.forwardRef(
	  function myFunction(props, ref) {
	    return <LogProps {...props} forwardedRef={ref} />;
	  }
	);

ç”šè‡³å¯ä»¥ç›´æ¥è®¾ç½®å‡½æ•°çš„ displayName å±æ€§æ¥åŒ…å«è¢«åŒ…è£¹ç»„ä»¶çš„åç§°ï¼Œä¾‹å¦‚ ForwardRef(logProps(MyComponent))ï¼š

```ts
function logProps(Component) {
  class LogProps extends React.Component {
    // ...
  }

  function forwardRef(props, ref) {
    return <LogProps {...props} forwardedRef={ref} />;
  }
  const name = Component.displayName || Component.name;
  forwardRef.displayName = `logProps(${name})`;

  return React.forwardRef(forwardRef);
}
```



## â˜› Refs & ç±»ç»„ä»¶

å¦‚æœæˆ‘ä»¬æƒ³è¦åŒ…è£…ä¸Šé¢çš„ CustomTextInputï¼Œæ¨¡ä»¿æŒ‚è½½åè¢«ç‚¹å‡»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ ref å¾—åˆ°è‡ªå®šä¹‰çš„ Input ç»„ä»¶ï¼Œæ‰‹åŠ¨è°ƒç”¨å®ƒçš„ focusTextInput å‡½æ•°ã€‚æ³¨æ„ï¼åªæœ‰å½“ CustomTextInput è¢«å£°æ˜ä¸ºç±»çš„æ—¶å€™æ‰æœ‰ç”¨ï¼

	class AutoFocusTextInput extends React.Component {
	  constructor(props) {
	    super(props);
	    this.textInput = React.createRef();
	  }
	 
	  componentDidMount() {
	    this.textInput.current.focusTextInput();
	  }
	 
	  render() {
	    return (
	      <CustomTextInput ref={this.textInput} />
	    );
	  }
	}


ä¸‹é¢æ˜¯å¯¹åº”äºä¸åŒ ref çš„ä¾‹å­

	class CustomTextInput extends React.Component {
	  constructor(props) {
	    super(props);
	    // åˆ›å»ºä¸€ä¸ª ref å»å‚¨å­˜ textInput DOM å…ƒç´ 
	    this.textInput = React.createRef();
	    this.focusTextInput = this.focusTextInput.bind(this);
	  }
	
	  focusTextInput() {
	    // å¾ˆæ˜æ˜¾çš„ï¼Œè®© text input è·å¾—ç„¦ç‚¹ä½¿ç”¨äº†åŸç”Ÿçš„ DOM API
	    // æ³¨æ„ï¼šæˆ‘ä»¬é€šè¿‡ current å»è·å¾— DOM èŠ‚ç‚¹
	    this.textInput.current.focus();
	  }
	 
	  render() {
	    // å‘Šè¯‰ React æˆ‘ä»¬æƒ³è¦å°†ç•¶å‰çš„ <input> é€šé ref æŒ‡å®šçš„å®¹å™¨ï¼Œå³åœ¨æ„é€ å™¨ä¸­åˆ›å»ºçš„ textInput å­˜å„²ä¸€å€‹å¼•ç”¨
	    // åœ¨çµ„ä»¶å¯¦ä¾‹åŒ–éç¨‹ï¼ŒReact åŸ·è¡Œ render æ™‚å°±æœƒç”¨é€™å€‹ <intput[text]> å»å¡«å…… this.textInput å®¹å™¨ current
	    return (
	      <div>
	        <input
	          type="text"
	          ref={this.textInput} />
	 
	        <input
	          type="button"
	          value="Focus the text input"
	          onClick={this.focusTextInput}
	        />
	      </div>
	    );
	  }
	}

React å°†ä¼šå°†ä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶å°† DOM å…ƒç´ åˆ†é…ç»™ current å±æ€§ï¼Œå¹¶ä¸”åœ¨ç»„ä»¶è¢«å¸è½½æ—¶ï¼Œå°† current å±æ€§é‡ç½®ä¸º nullã€‚ref å°†ä¼šåœ¨ componentDidMount å’Œ componentDidUpdate ç”Ÿå‘½å‘¨æœŸé’©å­å‰è¢«æ›´æ–°ã€‚



## â˜› Refs & å‡½æ•°å¼ç»„ä»¶

æ²¡æœ‰ç”¨é€”çš„ç¤ºä¾‹ï¼š

	function MyFunctionalComponent() {
	  return <input />;
	}
	 
	class Parent extends React.Component {
	  constructor(props) {
	    super(props);
	    this.textInput = React.createRef();
	  }
	  render() {
	    // è¿™æ ·æ²¡ç”¨ï¼å‡½æ•°å¼ç»„ä»¶æ ¹æœ¬å°±æ²¡æœ‰å®ä¾‹ï¼
	    return (
	      <MyFunctionalComponent ref={this.textInput} />
	    );
	  }
	}

ä½†æ˜¯ï¼Œä½ å¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿ç”¨ ref å±æ€§ï¼Œå°±åƒä½ å¼•ç”¨ DOM å…ƒç´ å’Œç±»ç»„ä»¶ä¸€æ ·ã€‚

	function CustomTextInput(props) {
	  // textInput å¿…é¡»è¢«å£°æ˜åœ¨è¿™é‡Œ ref æ‰èƒ½é€‚ç”¨äºå®ƒ
	  let textInput = React.createRef();
	 
	  function handleClick() {
	    textInput.current.focus();
	  }
	 
	  return (
	    <div>
	      <input
	        type="text"
	        ref={textInput} />
	 
	      <input
	        type="button"
	        value="Focus the text input"
	        onClick={handleClick}
	      />
	    </div>
	  );
	}



## â˜› Callback Refs

React åŒæ ·æ”¯æŒå›è°ƒæ–¹å¼çš„ refs å»è®¾ç½® refsï¼Œå¯ä»¥ç»™æˆ‘ä»¬å¯¹ refs åˆ›å»ºå’Œé”€æ¯æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚

æ”¾å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç”±createRef()åˆ›å»ºçš„refå±æ€§ã€‚è¿™ä¸ªå‡½æ•°æ¥å—Reactç»„ä»¶å®ä¾‹ã€æˆ–è€…HTML DOMå…ƒç´ ä½œä¸ºå‚æ•°â€”â€”å¯ä»¥è¢«å‚¨å­˜å¹¶ä¸”åœ¨å…¶ä»–åœ°æ–¹è¢«è®¿é—®ã€‚

ä¸‹é¢çš„ä¾‹å­å®ç°äº†ä¸€ä¸ªé€šå¸¸çš„æ¨¡å¼ï¼šä½¿ç”¨refå›è°ƒå‚¨å­˜ä¸€ä¸ªDOMèŠ‚ç‚¹çš„åº”ç”¨åœ¨å®ä¾‹å˜é‡ä¸­ï¼š

	class CustomTextInput extends React.Component {
	  constructor(props) {
	    super(props);
	 
	    this.textInput = null;
	 
	    this.setTextInputRef = element => {
	      this.textInput = element;
	    };
	 
	    this.focusTextInput = () => {
	      // é€šè¿‡åŸç”ŸDOM APIèšç„¦æ–‡æœ¬
	      if (this.textInput) this.textInput.focus();
	    };
	  }
	 
	  componentDidMount() {
	    // åœ¨æŒ‚è½½æ—¶è‡ªåŠ¨èšç„¦
	    this.focusTextInput();
	  }
	 
	  render() {
	    // ä½¿ç”¨'ref'å›è°ƒå»åœ¨ä¸€ä¸ªå®ä¾‹åŸŸä¸­å‚¨å­˜æ–‡æœ¬è¾“å…¥DOMå…ƒç´ çš„å¼•ç”¨(æ¯”å¦‚, this.textInput).
	    return (
	      <div>
	        <input
	          type="text"
	          ref={this.setTextInputRef}
	        />
	        <input
	          type="button"
	          value="Focus the text input"
	          onClick={this.focusTextInput}
	        />
	      </div>
	    );
	  }
	}

React å°†ä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶ä½¿ç”¨ DOM å…ƒç´ è°ƒç”¨ ref å›è°ƒï¼Œåœ¨ç»„ä»¶å¸è½½æ—¶ä½¿ç”¨ null è°ƒç”¨ ref å›è°ƒã€‚ref å›è°ƒéƒ½ä¼šåœ¨ componentDidMount æˆ–è€… componentDidUpdate ç”Ÿå‘½å‘¨æœŸé’©å­ä¹‹å‰è¢«è°ƒç”¨ã€‚

ä½ å¯ä»¥åœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’å›è°ƒ refsï¼Œå°±åƒä½ å¯ä»¥å¯¹é€šè¿‡ React.createRef() åˆ›å»ºçš„å¯¹è±¡ refsä¸€æ ·ï¼š

	function CustomTextInput(props) {
	  return (
	    <div>
	      <input ref={props.inputRef} />
	    </div>
	  );
	}
	 
	class Parent extends React.Component {
	  render() {
	    return (
	      <CustomTextInput
	        inputRef={el => this.inputElement = el}
	      />
	    );
	  }
	}

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒParentç»„ä»¶å°†ä»–çš„refå›è°ƒä½œä¸ºinputRefè¿™ä¸ªå±æ€§ï¼ˆpropsï¼‰ä¼ å…¥CustomTextInputç»„ä»¶ï¼Œæ¥ç€CustomTextInputç»„ä»¶å°†åŒæ ·çš„å‡½æ•°ä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„refå±æ€§ï¼ˆattributeï¼‰ä¼ ç»™ `<input>`ã€‚ä»ç»“æœæ¥çœ‹ï¼ŒParentç»„ä»¶ä¸­çš„this.inputElementå°†ä¼šè¢«æ”¾åœ¨ä¸åœ¨CustomTextInputç»„ä»¶çš„ `<input>` å…ƒç´ ç›¸å…³çš„DOMèŠ‚ç‚¹ä¸­ã€‚



## â˜› å†å²é—ç•™ String Refs

ä¸ç”¨ç®¡ï¼Œä»¥åéƒ½è¦ç§»é™¤ï¼Œè§åˆ° `this.refs.textInput` é€™ç¨®å½¢å¼å°±ä½¿ç”¨ `React.createRef()` æˆ–è€…å›è°ƒæ¨¡å¼ä»£æ›¿ã€‚

å¦‚ React-Cropper æä¾›çš„é€™å€‹ä¾‹å­å°±æ˜¯ä½¿ç”¨å­—ç¬¦ä¸² Refs çš„æ–¹å¼

	// Demo from http://roadmanfong.github.io/react-cropper/
	var Demo = React.createClass({

	  _crop: function(){
	    var dataUrl = this.refs.cropper.getCroppedCanvas().toDataURL();
	    console.log(dataUrl);
	  },

	  render: function() {
	    return (
	      <Cropper
	        ref='cropper'
	        crop={this._crop} />
	    );
	  }
	})


å¦‚æœ ref å›è°ƒè¢«å®šä¹‰ä¸ºä¸€ä¸ªè¡Œå†…å‡½æ•°ï¼Œå½“ç»„ä»¶æ›´æ–°æ—¶ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ã€‚ç¬¬ä¸€æ¬¡è¢« null è°ƒç”¨ã€è€Œåè¢« DOM å…ƒç´ è°ƒç”¨ã€‚è¿™æ˜¯å› ä¸ºå‡½æ•°çš„æ–°å®ä¾‹ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™åˆ›å»ºï¼Œæ‰€ä»¥ React éœ€è¦æ¸…é™¤è€çš„ ref ç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ class ä¸­å®šä¹‰ä¸€ä¸ªç»‘å®šçš„ ref å›è°ƒæ–¹æ³•é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ³¨æ„ï¼Œè¿™ç§é—®é¢˜åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ²¡ä»€ä¹ˆå½±å“~




## Error Boundaries é”™è¯¯æ•æ‰
- Error Boundaries https://reactjs.org/docs/error-boundaries.html
- åœ¨çº¿ç¤ºä¾‹ https://codesandbox.io/s/lOo5AV12M
- Using an error boundary with React 16. https://codepen.io/gaearon/pen/wqvxGa

éƒ¨åˆ† UI çš„ JavaScript é”™è¯¯ä¸åº”è¯¥å¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒReact 16 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ Error Boundaries é”™è¯¯è¾¹ç•Œã€‚

åœ¨ç»„ä»¶çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ï¼Œæœ‰ä¸¤ä¸ªç”¨äºé”™è¯¯å¤„ç†çš„å‡½æ•° componentDidCatch å’Œ getDerivedStateFromErrorï¼Œåè€…å¥½ç†è§£ï¼Œå°±æ˜¯ä»æ•æ‰åˆ°çš„é”™è¯¯ä¿¡æ¯ä¸­æ´¾ç”Ÿå‡ºçŠ¶æ€æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡äº¤ç”± React æ¥è®¾ç½® stateï¼Œè¿”å› null è¡¨ç¤ºæ— çŠ¶æ€æ›´æ–°ã€‚React å¼•å…¥ Error Boundaries é”™è¯¯è¾¹ç•Œçš„æ¦‚å¿µï¼Œå¯ä»¥å°†é”™è¯¯æ‹¦æˆªåœ¨è¾¹ç•Œç»„ä»¶ä¸Šï¼Œè€Œä¸æ˜¯ç ´åæ•´ä¸ªåº”ç”¨ã€‚

ç»„ä»¶è¦æˆä¸ºä¸€ä¸ªè¾¹ç•Œç»„ä»¶ Error Boundaries åªéœ€è¦åœ¨ç»„ä»¶ä¸­å®šä¹‰ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° componentDidCatch(error, info)ï¼Œçœ‹å®˜æ–¹ç¤ºä¾‹ï¼š

	class ErrorBoundary extends React.Component {
	  constructor(props) {
	    super(props);
	    this.state = { hasError: false };
	  }

	  componentDidCatch(error, info) {
	    // Display fallback UI
	    this.setState({ hasError: true });
	    // You can also log the error to an error reporting service
	    logErrorToMyService(error, info);
	  }

	  render() {
	    if (this.state.hasError) {
	      // You can render any custom fallback UI
	      return <h1>Something went wrong.</h1>;
	    }
	    return this.props.children;
	  }
	}

ä¸Šè¿°çš„ ErrorBoundary å°±æ˜¯ä¸€ä¸ªé”™è¯¯è¾¹ç•Œç»„ä»¶ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨å®ƒï¼š

	<ErrorBoundary>
	  <MyWidget />
	</ErrorBoundary>

Erro Boundaries æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œé€šè¿‡å¢åŠ äº†æ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•° componentDidCatch ä½¿å…¶å˜æˆäº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè¿™ä¸ªç‰¹æ®Šç»„ä»¶å¯ä»¥æ•è·å…¶å­ç»„ä»¶æ ‘ä¸­çš„è„šæœ¬é”™è¯¯ä¿¡æ¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯æˆ–è€…åœ¨æŠ¥é”™æ¡ä»¶ä¸‹ï¼Œæ˜¾ç¤ºé»˜è®¤é”™è¯¯é¡µã€‚

é”™è¯¯è¾¹ç•Œå¯ä»¥å¤„ç†çš„é”™è¯¯åŒ…æ‹¬å…¶æœ¬èº«æ¸²æŸ“è¿‡ç¨‹ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œè¾¹ç•Œç»„ä»¶ä¸‹çº§çš„çš„ç»„ä»¶æ„é€ å‡½æ•°ä¸­äº§ç”Ÿçš„é”™è¯¯ï¼Œåœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œè¢«è¾¹ç•Œç»„ä»¶æˆåŠŸå¤„ç†çš„é”™è¯¯è¿˜æ˜¯ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œç›´æ¥æŒ‰ ESC é”®å°±å¯ä»¥éšè—è¿”å›åˆ°å·¥ä½œç•Œé¢ï¼Œè¿™äº›æ¶ˆæ¯ä¸ä¼šåœ¨å‘å¸ƒæ¨¡å¼ä¸‹æç¤ºã€‚

è‡ª React 16 å¼€å§‹ï¼Œä»»ä½•æœªè¢«é”™è¯¯è¾¹ç•Œæ•è·çš„é”™è¯¯å°†ä¼šå¸è½½æ•´ä¸ª React ç»„ä»¶æ ‘ã€‚å•ä¸€ç»„ä»¶å†…éƒ¨é”™è¯¯ï¼Œä¸åº”è¯¥å¯¼è‡´æ•´ä¸ªåº”ç”¨æŠ¥é”™å¹¶æ˜¾ç¤ºç©ºç™½é¡µï¼Œè€Œ Error Boundaries è§£å†³çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ã€‚


å¦‚æœéœ€è¦æŠ¥é”™ä¿¡æ¯æ˜¾ç¤ºé”™è¯¯ç»„ä»¶æ‰€åœ¨çš„å…·ä½“çš„è¡Œæ•°å’Œä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ babel-plugin-transform-react-jsx-source æ’ä»¶ã€‚

å› ä¸º Error Boundaries ä»…ä»…èƒ½ä¿è¯æ­£ç¡®çš„ renderï¼Œè€Œäº‹ä»¶å¤„ç†å‡½æ•°å¹¶ä¸ä¼šå‘ç”Ÿåœ¨ render è¿‡ç¨‹ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„å¼‚å¸¸ä¸èƒ½è¢«æ­£ç¡®å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ try/catch æ¥å¤„ç†äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„å¼‚å¸¸ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š

	class MyComponent extends React.Component {
	  constructor(props) {
	    super(props);
	    this.state = { error: null };
	  }

	  handleClick = () => {
	    try {
	      // Do something that could throw
	    } catch (error) {
	      this.setState({ error });
	    }
	  }

	  render() {
	    if (this.state.error) {
	      return <h1>Caught an error.</h1>
	    }
	    return <div onClick={this.handleClick}>Click Me</div>
	  }
	}


æ³¨æ„ï¼Œé”™è¯¯è¾¹ç•Œæ— æ³•æ•è·å¦‚ä¸‹é”™è¯¯:

- Event handlers äº‹ä»¶å¤„ç†å‡½æ•°è§¦å‘çš„é”™è¯¯
- Asynchronous code (e.g. setTimeout or requestAnimationFrame callbacks)  å¼‚æ­¥ä»£ç 
- Server side rendering æœåŠ¡ç«¯æ¸²æŸ“
- Errors thrown in the error boundary itself (rather than its children) è‡ªå·±äº§ç”Ÿçš„é”™è¯¯

TypeScript å®ä¾‹ï¼š

	import React, { ErrorInfo } from 'react';

	interface Props {
	    children?:any
	}
	interface State {
	    error: Error | boolean
	    info?: ErrorInfo
	}

	let styles = {
	    background: '#333',
	    boxShadow: '2px 2px 3px #222',
	    color: 'white',
	    padding: 32,
	    margin: 32
	}

	export class ErrorBoundary extends React.Component<Props> {
	    props:Props
	    state:State

	    constructor(props: Props){
	        super(props);
	        this.props = props;
	        this.state = {error: false};
	    }
	    static getDerivedStateFromError(error: Error, info:ErrorInfo){
	        let ds = {error, info};
	        return ds;
	    }
	    componentDidCatch(error: Error, info: React.ErrorInfo): void {
	        console.log("Error Boundaries Working...", error, info);
	        this.setState({error, info});
	    }
	    render(){
	        if(this.state.error){
	            let info = this.state.info?.componentStack;
	            return (
	            <div style={styles}>
	                <h1>âœ¨magicâœ¨Error Catched!</h1>;
	                {info && info.split("\n").map((i, t) => {
	                    return ( <div key={t}> {i} </div> );
	                })}
	            </div>
	            )
	        }
	        return (
	            <>
	            {this.props.children}
	            </>
	        )
	    }
	}

	let Broken = ()=>{
	    const [state, setState] = React.useState(false);
	    if(state) throw new Error("Try Throws Exception");
	    let ee = new Error("Try Event Exception");
	    console.log("May error with you ...", state);
	    return (
	        <>
	            <button onClick={ev => {throw ee}}>ğŸ†Event Exception</button>
	            <button onClick={ev => {setState(true)}}>ğŸ‡setState Exception</button>
	        </>
	        );
	}

	export default class LifeCode extends React.Component {

	    render(){
	        return(
	            <ErrorBoundary>
	                <Broken />
	            </ErrorBoundary>
	        );
	    }
	}



## React developers with TypeScript
- https://github.com/typescript-cheatsheets/react-typescript-cheatsheet/blob/master/ADVANCED.md
- https://github.com/typescript-cheatsheets/react-typescript-cheatsheet#basic-cheatsheet-table-of-contents
- https://github.com/typescript-cheatsheets/react-typescript-cheatsheet/blob/master/HOC.md

- Creating TypeScript node modules https://basarat.gitbook.io/typescript/library
- Angular library with typescript-starter https://github.com/bitjson/typescript-starter
- Zero-config CLI for TypeScript package development https://github.com/formium/tsdx

è¿™éƒ¨åˆ† Advanced Cheatsheet è§£æäº†å¦‚ä½•åœ¨ React ä¸­åº”ç”¨æ³›å‹ generic å¼€å‘ utilities/functions/render prop/higher order components å’Œ TS+React åº“ã€‚

- It also has miscellaneous tips and tricks for pro users.
- Advice for contributing to DefinitelyTyped
- The goal is to take full advantage of TypeScript.

åˆ›å»º React + TypeScript åº“æœ€å¥½ä½¿ç”¨ tsdxï¼Œä½¿ç”¨å®ƒçš„ react é€‰é¡¹ã€‚


### ğŸ‘‰ Props ä¸­ä½¿ç”¨ React.ReactNode

	export interface Props {
	  label?: React.ReactNode;
	  children: React.ReactNode;
	}
	export const Card = (props: Props) => {
	  return (
	    <div>
	      {props.label && <div>{props.label}</div>}
	      {props.children}
	    </div>
	  );
	};

	export interface Props {
	  children: (foo: string) => React.ReactNode;
	}


### ğŸ‘‰ typeGuard æ¡ä»¶æ¸²æŸ“ç»„ä»¶ä½¿ç”¨ç±»å‹å®ˆå«

	// Button props
	type ButtonProps = React.ButtonHTMLAttributes<HTMLButtonElement> & {
	  href?: undefined;
	};

	// Anchor props
	type AnchorProps = React.AnchorHTMLAttributes<HTMLAnchorElement> & {
	  href?: string;
	};

	// Input/output options
	type Overload = {
	  (props: ButtonProps): JSX.Element;
	  (props: AnchorProps): JSX.Element;
	};

	// Guard to check if href exists in props
	const hasHref = (props: ButtonProps | AnchorProps): props is AnchorProps =>
	  "href" in props;

	// Component
	const Button: Overload = (props: ButtonProps | AnchorProps) => {
	  // anchor render
	  if (hasHref(props)) return <a {...props} />;
	  // button render
	  return <button {...props} />;
	};

	// Usage
	function App() {
	  return (
	    <>
	      {/* ğŸ˜ All good */}
	      <Button target="_blank" href="https://www.google.com">
	        Test
	      </Button>
	      {/* ğŸ˜­ Error, `disabled` doesnt exist on anchor element */}
	      <Button disabled href="x">
	        Test
	      </Button>
	    </>
	  );
	}


### ğŸ‘‰ Props as ElementType

å£°æ˜ props å‚æ•°ä¼ å…¥çš„ `ElementType` ä¸ºç»„ä»¶ï¼Œå†ä¾› createElement å‡½æ•°å¤„ç†ã€‚


	function PassThrough(props: { as: React.ElementType<any> }) {
	  const { as: Component } = props;

	  return <Component />;
	}


### ğŸ‘‰ Generic Component æ³›å‹ç»„ä»¶


ä½¿ç”¨ç±»å‹æ„ŸçŸ¥ï¼Œå¯ä»¥åœ¨æ³›å‹ç»„ä»¶ä¸­è·å–è‰¯å¥½çš„ç±»å‹å®‰å…¨ã€‚

Generic Components ç¤ºèŒƒ

	interface Props<T> {
	  items: T[];
	  renderItem: (item: T) => React.ReactNode;
	}

	function List<T>(props: Props<T>) {
	  const { items, renderItem } = props;
	  const [state, setState] = React.useState<T[]>([]); // You can use type T in List function scope.
	  return (
	    <div>
	      {items.map(renderItem)}
	      <button onClick={() => setState(items)}>Clone</button>
	      {JSON.stringify(state, null, 2)}
	    </div>
	  );
	}

	ReactDOM.render(
	  <List
	    items={["a", "b"]} // type of 'string' inferred
	    renderItem={item => (
	      <li key={item}>
	        {item.toPrecision(3)} // Error: Property 'toPrecision' does not exist on
	        type 'string'.
	      </li>
	    )}
	  />,
	  document.body
	);


åœ¨ TypeScript 2.9 åï¼Œå¯ä»¥åœ¨ JSX ä¸­ä½¿ç”¨å°–æ‹¬å·ä¸ºæ³›å‹æä¾›ç±»å‹å‚æ•°ï¼Œä»¥ä½¿ç”¨ç±»å‹æ„ŸçŸ¥ã€‚


	ReactDOM.render(
	  <List<number>
	    items={["a", "b"]} // Error: Type 'string' is not assignable to type 'number'.
	    renderItem={item => <li key={item}>{item.toPrecision(3)}</li>}
	  />,
	  document.body
	);


åœ¨æ³›å‹ç±»å‹å‚æ•°ä¸­è¿˜å¯ä»¥ä½¿ç”¨ fat arrow function è¯­æ³•ï¼Œå³ç±»ä¼¼ä»¥ä¸‹ä½¿ç”¨ extendsã€‚


	interface Props<T> {
	  items: T[];
	  renderItem: (item: T) => React.ReactNode;
	}

	const List = <T extends unknown>(props: Props<T>) => {
	  const { items, renderItem } = props;
	  const [state, setState] = React.useState<T[]>([]); // You can use type T in List function scope.
	  return (
	    <div>
	      {items.map(renderItem)}
	      <button onClick={() => setState(items)}>Clone</button>
	      {JSON.stringify(state, null, 2)}
	    </div>
	  );
	};


åœ¨ç±»ç»„ä»¶ä¸­ä¸€æ ·ä½¿ç”¨ã€‚

	interface Props<T> {
	  items: T[];
	  renderItem: (item: T) => React.ReactNode;
	}

	interface State<T> {
	  items: T[];
	}

	class List<T> extends React.PureComponent<Props<T>, State<T>> {
	  // You can use type T inside List class.
	  state: Readonly<State<T>> = {
	    items: []
	  };
	  render() {
	    const { items, renderItem } = this.props;
	    // You can use type T inside List class.
	    const clone: T[] = items.slice(0);
	    return (
	      <div>
	        {items.map(renderItem)}
	        <button onClick={() => this.setState({ items: clone })}>Clone</button>
	        {JSON.stringify(this.state, null, 2)}
	      </div>
	    );
	  }
	}


ä½†æ˜¯ä¸èƒ½åœ¨é™æ€æˆå‘˜ä¸Šä½¿ç”¨ Generic Type Parametersã€‚


	class List<T> extends React.PureComponent<Props<T>, State<T>> {
	  // Static members cannot reference class type parameters.ts(2302)
	  static getDerivedStateFromProps(props: Props<T>, state: State<T>) {
	    return { items: props.items };
	  }
	}

è§£å†³æ–¹æ³•ï¼Œå°†é™æ€å‡½æ•°è½¬æ¢ä¸ºæ³›å‹å‡½æ•°ï¼Œå³ç±»å‹æ„ŸçŸ¥å‡½æ•°ã€‚

	class List<T> extends React.PureComponent<Props<T>, State<T>> {
	  static getDerivedStateFromProps<T>(props: Props<T>, state: State<T>) {
	    return { items: props.items };
	  }
	}


### ğŸ‘‰ Generic components with children

ä½œä¸º React åµŒå¥—å­ç»„ä»¶çš„ä¼ é€’å‚æ•°ï¼ŒProps ä¸­çš„ `children` é€šå¸¸æ²¡æœ‰å®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨ `props.children` ä¼šå‡ºé”™ã€‚

è§£å†³æ–¹æ³•ï¼Œä¸€æ˜¯æ·»åŠ  `children` ç±»å‹å®šä¹‰ï¼š

```tsx
interface WrapperProps<T> {
  item: T;
  renderItem: (item: T) => React.ReactNode;
  children: string; // The component will only accept a single string child
}

const Wrapper = <T extends {}>(props: WrapperProps<T>) => {
  return (
    <div>
      {props.renderItem(props.item)}
      {props.children}
    </div>
  );
};
```

äºŒæ˜¯ä½¿ç”¨ `React.PropsWithChildren` ç±»å‹å°è£…ï¼Œå¦‚ `React.FC<>` å†…ç½®å‡½æ•°ç»„ä»¶é‚£æ ·åšï¼š

```tsx
interface WrapperProps<T> {
  item: T;
  renderItem: (item: T) => React.ReactNode;
}

const Wrapper = <T extends {}>(
  props: React.PropsWithChildren<WrapperProps<T>>
) => {
  return (
    <div>
      {props.renderItem(props.item)}
      {props.children}
    </div>
  );
};
```

### ğŸ‘‰ Typing a Component that Accepts Different Props

é€šå¸¸æ³›å‹ Components å’Œ JSX å°±æ¨¡æ‹Ÿå‡½æ•°ï¼Œå¯ä»¥æ ¹æ® Props æ¥æ¸²æŸ“å­ç»„ä»¶ï¼Œå’Œé‡è½½å‡½æ•°éå¸¸ç›¸ä¼¼ã€‚

ç¤ºèŒƒï¼Œä½¿ç”¨ç±»å‹å®ˆå«å‡½æ•° isPropsForAnchorElement æ¥æ ¹æ® `href` å±æ€§åšä¸åŒçš„æ¸²æŸ“ï¼š

```
type ButtonProps = JSX.IntrinsicElements["button"];
type AnchorProps = JSX.IntrinsicElements["a"];

// optionally use a custom type guard
function isPropsForAnchorElement(
  props: ButtonProps | AnchorProps
): props is AnchorProps {
  return "href" in props;
}

function Clickable(props: ButtonProps | AnchorProps) {
  if (isPropsForAnchorElement(props)) {
    return <a {...props} />;
  } else {
    return <button {...props} />;
  }
}
```

è¿™æ ·åšï¼Œå°±ä¸éœ€è¦å®šä¹‰ä¸åŒçš„ Props ç±»å‹ï¼Œåªè¦å®ƒå­˜åœ¨å·®å¼‚å°±å¯ä»¥é€šè¿‡ç±»å‹å®ˆå«åˆ¤æ–­ã€‚

```tsx
type LinkProps = Omit<JSX.IntrinsicElements["a"], "href"> & { to?: string };

function RouterLink(props: LinkProps | AnchorProps) {
  if ("to" in props) {
    return <a {...props} />;
  } else {
    return <Link {...props} />;
  }
}
```

<details>
  <summary><b>Approach: Generic Components æ³›å‹ç»„ä»¶æ–¹æ³•</b></summary>

```tsx
interface LinkProps {}
type AnchorProps = React.AnchorHTMLAttributes<HTMLAnchorElement>;
type RouterLinkProps = Omit<NavLinkProps, "href">;

const Link = <T extends {}>(
  props: LinkProps & T extends RouterLinkProps ? RouterLinkProps : AnchorProps
) => {
  if ((props as RouterLinkProps).to) {
    return <NavLink {...(props as RouterLinkProps)} />;
  } else {
    return <a {...(props as AnchorProps)} />;
  }
};

<Link<RouterLinkProps> to="/">My link</Link>; // ok
<Link<AnchorProps> href="/">My link</Link>; // ok
<Link<RouterLinkProps> to="/" href="/">
  My link
</Link>; // error
```

</details>

<details>
  <summary><b>Approach: Composition ç»„åˆæ–¹æ³•</b></summary>

```tsx
type AnchorProps = React.AnchorHTMLAttributes<HTMLAnchorElement>
type RouterLinkProps = Omit<AnchorProps, 'href'>

interface Button {
  as: React.ComponentClass | 'a'
}

const Button: React.FunctionComponent<Button> = (props) => {
  const {as: Component, children, ...rest} = props
  return (
    <Component className="button" {...rest}>{children}</Component>
  )
}

const AnchorButton: React.FunctionComponent<AnchorProps> = (props) => (
  <Button as="a" {...props} />
)

const LinkButton: React.FunctionComponent<RouterLinkProps> = (props) => (
  <Button as={NavLink} {...props} />
)

<LinkButton to="/login">Login</LinkButton>
<AnchorButton href="/login">Login</AnchorButton>
<AnchorButton href="/login" to="/test">Login</AnchorButton> // Error: Property 'to' does not exist on type...
```

</details>

è¿˜å¯ä»¥ä½¿ç”¨ Discriminated Unions å¯è¾¨è¯†è”åˆç±»å‹ï¼š

```ts
type UserTextEvent = { value: string; target: HTMLInputElement };
type UserMouseEvent = { value: [number, number]; target: HTMLElement };
type UserEvent = UserTextEvent | UserMouseEvent;
function handle(event: UserEvent) {
  if (typeof event.value === "string") {
    event.value; // string
    event.target; // HTMLInputElement | HTMLElement (!!!!)
    return;
  }
  event.value; // [number, number]
  event.target; // HTMLInputElement | HTMLElement (!!!!)
}
```


ä½†æ˜¯ï¼Œå³ä½¿åŸºäº `event.value` çš„ç±»å‹æ”¶ç¼©ï¼Œé€»è¾‘ä¸Šç”±äºäº‹ä»¶å¯¹è±¡å¯ä»¥æ˜¯è”åˆç±»å‹ `UserTextEvent | UserMouseEvent`ï¼Œä¸¤ä¸ªå­ç±»å‹éƒ½åŒ…å«åŒæ ·çš„å€¼ï¼Œæ‰€ä»¥ TypeScript éœ€è¦æ›´å¥½çš„è§£å†³åŠæ³•ï¼šä½¿ç”¨å­—é¢é‡ç±»å‹ã€‚

ç¤ºèŒƒï¼Œå®šä¹‰ type ä¸ºå­—é¢é‡ç±»å‹ï¼Œç›´æ¥ç»™å®šäº†äº‹ä»¶ç±»å‹ï¼Œåˆ«æ— äºŒä¹‰ã€‚

```ts
type UserTextEvent = {
  type: "TextEvent";
  value: string;
  target: HTMLInputElement;
};
type UserMouseEvent = {
  type: "MouseEvent";
  value: [number, number];
  target: HTMLElement;
};
type UserEvent = UserTextEvent | UserMouseEvent;
function handle(event: UserEvent) {
  if (event.type === "TextEvent") {
    event.value; // string
    event.target; // HTMLInputElement
    return;
  }
  event.value; // [number, number]
  event.target; // HTMLElement
}
```

ç›¸ä¼¼çš„åšæ³•ï¼Œæ˜¯ä½¿ç”¨ **User-Defined Type Guards** ç”¨æˆ·å®šä¹‰ç±»å‹å®ˆå«çš„æ¦‚å¿µï¼Œæ³¨æ„ `a is string` è¿™ç§è¯­æ³•è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰å®ˆå«å‡½æ•°ï¼š

```ts
function isString(a: unknown): a is string {
  return typeof a === "string";
}
```

### ğŸ‘‰ Props: One or the Other but not Both

ä½¿ç”¨ `in` å…³é”®å­—ï¼Œé‡è½½å‡½æ•°å’Œè”åˆç±»å‹æ¥ç¼–å†™ç»„ä»¶ï¼Œå¯ä»¥åˆ¤æ–­ Props æ˜¯ A æˆ–è€…æ˜¯ B ç±»å‹ï¼Œä½†ä¸èƒ½æ˜¯ A åˆæ˜¯ B ç±»å‹ã€‚


```tsx
type Props1 = { foo: string };
type Props2 = { bar: string };

function MyComponent(props: Props1 | Props2) {
  if ("foo" in props) {
    // props.bar // error
    return <div>{props.foo}</div>;
  } else {
    // props.foo // error
    return <div>{props.bar}</div>;
  }
}
const UsageComponent: React.FC = () => (
  <div>
    <MyComponent foo="foo" />
    <MyComponent bar="bar" />
    {/* <MyComponent foo="foo" bar="bar"/> // invalid */}
  </div>
);
```

### ğŸ‘‰ Props: Must Pass Both

```tsx
type OneOrAnother<T1, T2> =
  | (T1 & { [K in keyof T2]?: undefined })
  | (T2 & { [K in keyof T1]?: undefined });

type Props = OneOrAnother<{ a: string; b: string }, {}>;

const a: Props = { a: "a" }; // error
const b: Props = { b: "b" }; // error
const ab: Props = { a: "a", b: "b" }; // ok
```

### ğŸ‘‰ Props: Can Optionally Pass One Only If the Other Is Passed

ç¼–å†™ä¸€ä¸ª Text componentï¼Œå¯ä»¥é€šè¿‡ `truncate` æˆ– `expanded` å±æ€§æ¥è¿›è¡Œè£å‰ªæˆ–åœ¨ç”¨æˆ·ç‚¹å‡»æ—¶æ‰©å±•æ˜¾ç¤ºã€‚

é‚£ä¹ˆ `expanded` å‚æ•°ä¼šåœ¨ä½¿ç”¨ `truncate` çš„æƒ…å½¢ä¸‹ä½¿ç”¨ï¼Œå¦åˆ™ä¸å¯ä½¿ç”¨ã€‚

```tsx
type CommonProps = {
  children: React.ReactNode;
  miscProps?: any;
};

type NoTruncateProps = CommonProps & { truncate?: false };

type TruncateProps = CommonProps & { truncate: true; expanded?: boolean };

// Function overloads to accept both prop types NoTruncateProps & TruncateProps
function Text(props: NoTruncateProps): JSX.Element;
function Text(props: TruncateProps): JSX.Element;
function Text(props: CommonProps & { truncate?: boolean; expanded?: boolean }) {
  const { children, truncate, expanded, ...otherProps } = props;
  const classNames = truncate ? ".truncate" : "";
  return (
    <div className={classNames} aria-expanded={!!expanded} {...otherProps}>
      {children}
    </div>
  );
}
```

ç¤ºèŒƒä½¿ç”¨ Text componentï¼š

```tsx
const App: React.FC = () => (
  <>
    {/* these all typecheck */}
    <Text>not truncated</Text>
    <Text truncate>truncated</Text>
    <Text truncate expanded>
      truncate-able but expanded
    </Text>
    {/* TS error: Property 'truncate' is missing in type '{ children: string; expanded: true; }' but required in type '{ truncate: true; expanded?: boolean | undefined; }'. */}
    <Text expanded>truncate-able but expanded</Text>
  </>
);
```

### ğŸ‘‰ Omit attribute from a type

ä»ä¸€ç§ç±»å‹ä¸­çœç•¥æŸå‚æ•°ï¼Œæœ‰æ—¶ä½¿ç”¨ Intersection Types äº¤å‰ç±»å‹æ—¶éœ€è¦è‡ªè¡Œå®šä¹‰çš„å±æ€§è€Œéäº¤å‰è€Œæ¥çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ç¼–å†™çš„ç»„ä»¶æœ‰ `label` å±æ€§ï¼Œä½†äº¤å‰å¯¼å…¥çš„ç±»å‹ä¹Ÿæœ‰ï¼Œä»¥ä¸‹ç¤ºèŒƒå¦‚ä½•ä½¿ç”¨ Omit æ¥çœç•¥æ‰å®ƒï¼š

```tsx
export interface Props {
  label: React.ReactNode; // this will conflict with the InputElement's label
}

// this comes inbuilt with TS 3.5
type Omit<T, K extends keyof T> = Pick<T, Exclude<keyof T, K>>;

// usage
export const Checkbox = (
  props: Props & Omit<React.HTMLProps<HTMLInputElement>, "label">
) => {
  const { label } = props;
  return (
    <div className="Checkbox">
      <label className="Checkbox-label">
        <input type="checkbox" {...props} />
      </label>
      <span>{label}</span>
    </div>
  );
};
```

å½“æœ‰å¤šä¸ªå‚æ•°é‡å¤æ—¶ï¼Œéœ€è¦ä½¿ç”¨ `keyof` ç±»å‹æ“ä½œæ¥æ’é™¤ï¼š

```tsx
export interface Props {
  label: React.ReactNode; // conflicts with the InputElement's label
  onChange: (text: string) => void; // conflicts with InputElement's onChange
}

export const Textbox = (
  props: Props & Omit<React.HTMLProps<HTMLInputElement>, keyof Props>
) => {
  // implement Textbox component ...
};
```

### ğŸ‘‰ Extracting Prop Types of a Component

ä»ç°æœ‰ç»„ä»¶ä¸­æå– Props ç±»å‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå¯ä»¥é¿å…é‡å¤å®šä¹‰ç›¸ä¼¼çš„ç±»å‹ï¼Œè€Œä¸”ä»¥ä¸‹è¿™ç§åšæ³•ä¸ç”¨äº‹å…ˆå¯¼å‡ºæ‰€æœ‰ç±»å‹ã€‚

```ts
import { ComponentProps, JSXElementConstructor } from "react";

// goes one step further and resolves with propTypes and defaultProps properties
type ApparentComponentProps<
  C extends keyof JSX.IntrinsicElements | JSXElementConstructor<any>
> = C extends JSXElementConstructor<infer P>
  ? JSX.LibraryManagedAttributes<C, P>
  : ComponentProps<C>;
```

å¦‚æœè‡ªå®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºä¸æ˜¯åœ¨è°ƒç”¨ä½ç½®æœ¬èº«ç¼–å†™çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ°å¼ºç±»å‹ï¼Œå¦‚ä¸‹ä½¿ç”¨ JSX å†…è” onSomeEvent å±æ€§ï¼š

```tsx
// my-inner-component.tsx
export function MyInnerComponent(props: {
  onSomeEvent(
    event: ComplexEventObj,
    moreArgs: ComplexArgs
  ): SomeWeirdReturnType;
}) {
  /* ... */
}

// my-consuming-component.tsx
export function MyConsumingComponent() {
  // event and moreArgs are contextually typed along with the return value
  const theHandler: Props<typeof MyInnerComponent>["onSomeEvent"] = (
    event,
    moreArgs
  ) => {};
  return <MyInnerComponent onSomeEvent={theHandler} />;
}
```

### ğŸ‘‰ Handling Exceptions

å½“åäº‹å‘ç”Ÿæ—¶ï¼Œå¯ä»¥é€‰æ‹©æä¾›æ›´å¥½çš„ä¿¡æ¯ï¼š

```ts
class InvalidDateFormatError extends RangeError {}
class DateIsInFutureError extends RangeError {}

/**
 * // optional docblock
 * @throws {InvalidDateFormatError} The user entered date incorrectly
 * @throws {DateIsInFutureError} The user entered date in future
 *
 */
function parse(date: string) {
  if (!isValid(date))
    throw new InvalidDateFormatError("not a valid date format");
  if (isInFuture(date)) throw new DateIsInFutureError("date is in the future");
  // ...
}

try {
  // call parse(date) somewhere
} catch (e) {
  if (e instanceof InvalidDateFormatError) {
    console.error("invalid date format", e);
  } else if (e instanceof DateIsInFutureError) {
    console.warn("date is in future", e);
  } else {
    throw e;
  }
}
```

æ™®é€šåšæ³•æ˜¯ä»¥ä¸Šè¿™ç§ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ä½†æ˜¯ TypeScript å¯ä»¥åšå¾—æ›´å¥½ï¼Œå€ŸåŠ©ç±»å‹å®ˆå«çš„åšæ³•æ¥å†³å®šå¦‚ä½•å¤„ç†é—®é¢˜ï¼š

```ts
function parse(
  date: string
): Date | InvalidDateFormatError | DateIsInFutureError {
  if (!isValid(date))
    return new InvalidDateFormatError("not a valid date format");
  if (isInFuture(date)) return new DateIsInFutureError("date is in the future");
  // ...
}

// now consumer *has* to handle the errors
let result = parse("mydate");
if (result instanceof InvalidDateFormatError) {
  console.error("invalid date format", result.message);
} else if (result instanceof DateIsInFutureError) {
  console.warn("date is in future", result.message);
} else {
  /// use result safely
}

// alternately you can just handle all errors
if (result instanceof Error) {
  console.error("error", result);
} else {
  /// use result safely
}
```

è¿˜å¯ä»¥ä½¿ç”¨ç‰¹å®šç”¨äºå¼‚å¸¸å¤„ç†çš„ç±»å‹ï¼Œå¦‚ (don't say monads...) `Try`, `Option`, `Maybe`, `Either` ...

```ts
interface Option<T> {
  flatMap<U>(f: (value: T) => None): None
  flatMap<U>(f: (value: T) => Option<U>): Option<U>
  getOrElse(value: T): T
}
class Some<T> implements Option<T> {
  constructor(private value: T) {}
  flatMap<U>(f: (value: T) => None): None
  flatMap<U>(f: (value: T) => Some<U>): Some<U>
  flatMap<U>(f: (value: T) => Option<U>): Option<U> {
    return f(this.value)
  }
  getOrElse(): T {
    return this.value
  }
}
class None implements Option<never> {
  flatMap<U>(): None {
    return this
  }
  getOrElse<U>(value: U): U {
    return value
  }
}

// now you can use it like:
let result = Option(6) // Some<number>
              .flatMap(n => Option(n*3)) // Some<number>
              .flatMap(n = new None) // None
              .getOrElse(7)

// or:
let result = ask() // Option<string>
              .flatMap(parse) // Option<Date>
              .flatMap(d => new Some(d.toISOString()) // Option<string>
              .getOrElse('error parsing string')
```


### ğŸ‘‰Section 2: Useful Patterns by TypeScript Version

TypeScript çš„ç‰ˆæœ¬æ›´æ–°ï¼Œæ€»æ˜¯å¸¦æ¥æ–°çš„åŠŸèƒ½ç‰¹æ€§ï¼Œåˆ©ç”¨å¥½è¿™äº›ç‰¹æ€§å¯ä»¥ä½¿ç”¨ç›¸åº”çš„ç¼–ç¨‹æ¨¡å¼ã€‚


ä½¿ç”¨ TypeScript 2.9 **template strings** æ¥å®ç°æ ¼å¼åŒ–ç»„ä»¶ï¼š

```tsx
export interface InputFormProps {
  foo: string; // this is understood inside the template string below
}

export const InputForm = styledInput<InputFormProps>`
    color:
        ${({ themeName }) => (themeName === "dark" ? "black" : "white")};
    border-color: ${({ foo }) => (foo ? "red" : "black")};
`;
```


ä½¿ç”¨ TypeScript 2.9 **JSX Generics**

```tsx
// instead of
<Formik render={(props: FormikProps<Values>) => ....}/>

// usage
<Formik<Values> render={props => ...}/>
<MyComponent<number> data={12} />
```


TypeScript 3.0 å‡çº§å¸¦æ¥è®¸å¤šåŠŸèƒ½ã€‚

åœ¨å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨å‰©ä½™å‚æ•° Typed rest parametersï¼š

```ts
// `rest` accepts any number of strings - even none!
function foo(...rest: string[]) {
  // ...
}

foo("hello"); // works
foo("hello", "world"); // also works
```

ä½¿ç”¨ JSX `LibraryManagedAttributes`æ”¯æŒ `propTypes` å’Œ `static defaultProps`

```tsx
export interface Props {
  name: string;
}

export class Greet extends React.Component<Props> {
  render() {
    const { name } = this.props;
    return <div>Hello ${name.toUpperCase()}!</div>;
  }
  static defaultProps = { name: "world" };
}

// Type-checks! No type assertions needed!
let el = <Greet />;
```


å¸¦æ¥æ¯” `any` æ›´å®‰å…¨çš„ `unknown` ç±»å‹ï¼š

```tsx
interface IComment {
  date: Date;
  message: string;
}

interface IDataService1 {
  getData(): any;
}

let service1: IDataService1;
const response = service1.getData();
response.a.b.c.d; // RUNTIME ERROR

// ----- compare with -------

interface IDataService2 {
  getData(): unknown; // ooo
}

let service2: IDataService2;
const response2 = service2.getData();
// response2.a.b.c.d; // COMPILE TIME ERROR if you do this

if (typeof response === "string") {
  console.log(response.toUpperCase()); // `response` now has type 'string'
}
```

ä¹Ÿå¯ä»¥åœ¨ `unknown` ç±»å‹ä¸Šä½¿ç”¨ç±»å‹å®ˆå« **type guard**ï¼Œè¿™ç§åšæ³•æ¯”ä½¿ç”¨ `any` æ›´å¥½ã€‚


TypeScript 3.0 è¿˜æ”¯æŒå·¥ç¨‹å¼•ç”¨ Project Referencesï¼Œå…è®¸ä¾èµ–å¤–éƒ¨ TypeScript å·¥ç¨‹ï¼Œåœ¨ tsconfig.json å¼•ç”¨å…¶å®ƒ tsconfig.json é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ºä»£ç å¸¦æ¥æ›´å¼ºå¤§çš„å¯ä¼¸ç¼©æ€§ codebases scaleï¼Œå°†ä»£ç åˆ†å‰²æˆå­å·¥ç¨‹ï¼Œä»è€Œä¸ç”¨é‡å¤ç¼–è¯‘ç›¸åŒçš„éƒ¨åˆ†ã€‚

åœ¨æ¯ä¸ªç›®å½•ä¸‹åˆ›å»º tsconfig.json åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```js
{
  "compilerOptions": {
    "composite": true, // tells TSC it is a subproject of a larger project
    "declaration": true, // emit .d.ts declaration files since project references dont have access to source ts files. important for project references to work!
    "declarationMap": true, // sourcemaps for .d.ts
    "rootDir": "." // specify compile it relative to root project at .
  },
  "include": [
    "./**/*.ts
  ],
  "references": [ // (optional) array of subprojects your subproject depends on
    {
      "path": "../myreferencedproject", // must have tsconfig.json
      "prepend": true // concatenate js and sourcemaps generated by this subproject, if and only if using outFile
    }
  ]
}
```

åœ¨é¡¶å±‚ç›®å½•åˆ›å»º `tsconfig.json` åŒ…å«å’Œå„ä¸ªé¡¶å±‚çº§åˆ«çš„å·¥ç¨‹ï¼š

```js
{
  "files: [],
  "references": [
    {"path": "./proj1"},
    {"path": "./proj2"},
  ]
}
```

ç„¶åä½¿ç”¨å‘½ä»¤ `tsc --build` æˆ– `tsc -b`ã€‚

å¯ä»¥ä¿å­˜é…ç½®æ–‡ä»¶æ ·ç‰ˆ tsconfig boilerplateï¼Œç„¶åä½¿ç”¨ `extends` é…ç½®é¡¹å¼•ç”¨ï¼š

```js
{
  "extends": "../tsconfig.base",
  // more stuff here
}
```


TypeScript 3.1 å¯ä»¥ä¸ºå‡½æ•°ç»„ä»¶å£°æ˜å±æ€§ Properties declarations

```tsx
export const FooComponent = ({ name }) => <div>Hello! I am {name}</div>;

FooComponent.defaultProps = {
  name: "swyx"
};
```


TypeScript 3.4 å¯ä»¥ä½¿ç”¨ `const` assertions å¸¸é‡æ–­è¨€ã€‚

```tsx
export function useLoading() {
  const [isLoading, setState] = React.useState(false);
  const load = (aPromise: Promise<any>) => {
    setState(true);
    return aPromise.finally(() => setState(false));
  };
  return [isLoading, load] as const; // infers [boolean, typeof load] instead of (boolean | typeof load)[]
}
```


TypeScript 3.5 å†…å»º `<Omit>` ç±»å‹ï¼Œä»æ³›å‹æ„é€ å‡½æ•°ä¸­æ„ŸçŸ¥é«˜é˜¶ç±»å‹ Higher order type inferenceã€‚

```tsx
type ComponentClass<P> = new (props: P) => Component<P>;
declare class Component<P> {
  props: P;
  constructor(props: P);
}

declare function myHoc<P>(C: ComponentClass<P>): ComponentClass<P>;

type NestedProps<T> = { foo: number; stuff: T };

declare class GenericComponent<T> extends Component<NestedProps<T>> {}

// type is 'new <T>(props: NestedProps<T>) => Component<NestedProps<T>>'
const GenericComponent2 = myHoc(GenericComponent);
```

### ğŸ‘‰ Full HOC Example

ä½¿ç”¨ HoC - Hight Order of Components é«˜é˜¶ç»„ä»¶çš„ä¸€ä¸ªç›®çš„å°±æ˜¯å‘ç»„ä»¶ Props æ³¨å…¥å±æ€§ï¼Œè€Œä¸æ˜¯ä¸€å±‚ä¸€çº§åœ°ä¼ é€’ Propsã€‚ç›¸æ¯”ä½¿ç”¨ Context APIï¼Œå®ƒé€šå¸¸åœ¨ `render` å‡½æ•°ä¸­ä½¿ç”¨ã€‚

**The injected props**

```ts
interface WithThemeProps {
  primaryColor: string;
}
```

**Usage in the component**

```ts
interface Props extends WithThemeProps {
  children: React.ReactNode;
}

class MyButton extends React.Component<Props> {
  public render() {
    // Render an the element using the theme and other props.
  }

  private someInternalMethod() {
    // The theme values are also available as props here.
  }
}

export default withTheme(MyButton);
```


**Consuming the Component**ï¼Œä½¿ç”¨ç»„ä»¶ï¼Œå¹¶ä¸”å¯ä»¥çœç•¥ `primaryColor` å±æ€§ï¼Œæˆ–åœ¨å­ç»„ä»¶ä¸­è¦†ç›–å®ƒã€‚

```tsx
<MyButton>Hello button</MyButton> // Valid
<MyButton primaryColor="#333">Hello Button</MyButton> // Also valid
```


**Declaring the HoC**

```tsx
export function withTheme<T extends WithThemeProps = WithThemeProps>(
  WrappedComponent: React.ComponentType<T>
) {
  // Try to create a nice displayName for React Dev Tools.
  const displayName =
    WrappedComponent.displayName || WrappedComponent.name || "Component";

  // Creating the inner component. The calculated Props type here is the where the magic happens.
  return class ComponentWithTheme extends React.Component<
    Optionalize<T, WithThemeProps>
  > {
    public static displayName = `withPages(${displayName})`;

    public render() {
      // Fetch the props you want inject. This could be done with context instead.
      const themeProps = getThemePropsFromSomeWhere();

      // this.props comes afterwards so the can override the default ones.
      return <WrappedComponent {...themeProps} {...(this.props as T)} />;
    }
  };
}
```

æ³¨æ„ `{...this.props as T}` æ–­è¨€æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º TS 3.2 æœ‰ä¸€ä¸ª bugï¼Œå‚è€ƒ TypeScript/issues/28938#issuecomment-450636046ã€‚

å¯¹äº `Optionalize` å·¥å…·ç±»å‹è¯·å‚è€ƒ [utility types section](https://github.com/typescript-cheatsheets/typescript-utilities-cheatsheet#utility-types).


ä»¥ä¸‹æ˜¯ä¸€ä¸ªé«˜çº§çš„åŠ¨æ€ HoC ç»„ä»¶ç¤ºèŒƒï¼ŒåŸºäºæŸäº› Props å±æ€§æ¥åŠ¨æ€å¤„ç†ï¼š

```tsx
// inject static values to a component so that they're always provided
export function inject<TProps, TInjectedKeys extends keyof TProps>(
  Component: React.JSXElementConstructor<TProps>,
  injector: Pick<TProps, TInjectedKeys>
) {
  return function Injected(props: Omit<TProps, TInjectedKeys>) {
    return <Component {...(props as TProps)} {...injector} />;
  };
}
```

åœ¨ HoC ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ React çš„æ–° API `forwardRef` æ¥å¢å¼ºç»„ä»¶çš„å¯é‡ç”¨æ€§ï¼Œå¯ä»¥è¿™æ ·åš `React.forwardRef<Ref, Props>`ï¼Œå®ƒæœ¬èº«å°±æ˜¯ HoCã€‚




## PureComponent vs Stateless Component

æ— çŠ¶æ€ç»„ä»¶å’Œç´”çµ„ä»¶éƒ½å¯ä»¥é€šè¿‡å‡å°‘ç»§æ‰¿ Component çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ©Ÿåˆ¶è€Œè¾¾åˆ°æ€§èƒ½ä¼˜åŒ–çš„æ•ˆæœã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ— çŠ¶æ€ç»„ä»¶å°±æ˜¯ä¸€ä¸ª render çº¯å‡½æ•°ï¼Œæ‰€ä»¥æ— çŠ¶æ€ç»„ä»¶çš„ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå®ƒæ²¡æœ‰ shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ‰€ä»¥çˆ¶çµ„ä»¶æ¯æ¬¡ state è§¸ç™¼çš„çµ„ä»¶é‡ç¹ªï¼Œå®ƒéƒ½ä¼šè·Ÿéš¨é‡ç»˜è€ŒåŸ·è¡Œ render å‡½æ•°ï¼Œä¸è«–æ˜¯ç„¡ç‹€æ…‹çµ„ä»¶é‚„æ˜¯ Component é¡çµ„ä»¶ï¼Œå¾Œé¢æœƒä½¿ç”¨ PureComponent ç´”çµ„ä»¶ä¾†é¿å…é€™å€‹å•é¡Œã€‚

ç¤ºä¾‹å¦‚ä¸‹ï¼Œæ¯æ¬¡é»æ“Šæ›´æ–°ä¸€å€‹ item æ•¸æ“šçš„é¸ä¸­ç‹€æ…‹æ™‚ï¼Œæ‰€æœ‰ items éƒ½æœƒä¸€å¹¶åŸ·è¡Œæ›´æ–°å‹•ä½œï¼Œå¦‚æœé€™å€‹ ListItem è¨­è¨ˆçš„å¾ˆè¤‡é›œï¼Œé‚£éº½å¸¶ä¾†çš„æ€§èƒ½å½±éŸ¿å°±ä¸èƒ½å¿½ç•¥äº†ï¼š


```ts
function ListItem(props){
	console.log("ListItem render", this)
	const {children, data} = props
	return <div {...data} className="item">
		<span {...data} className={+data.checked?"checked":"unchecked"} title="spin">{children} #{data.id} - </span>
		<span {...data} className="field">{data.name}</span>
		<span {...data} className="field">{data.value}PCS</span>
	</div>
}

function ListView(props){
	console.log("ListView render", this)
	return <div className="list" {...props}>
		{ props.items.map((it,joke)=>{
			let icons = [["âš«", "âšª"], ["âŒ", "â­•"], ["ğŸ‘â€ğŸ—¨", "ğŸ‘â€ğŸ—¨"][2];
			let icon = it.checked? icons[0]:icons[1]; 
			return <ListItem key={joke} data={it}>{icon}</ListItem>
		})}
	</div>
}

class TestSuite extends Component {
	constructor(props){
		super(props)
		this.state = {items: this.mockGenerate()}
		this.click.bind(this)
	}

	mockGenerate(){
		let foods = [
			"Apple", "Pineapple", "Strawberry", "grape", "Peach",
			"Pear", "Arbutus", "Blackberry", "Guava", "Honeymelon",
			"Lemon", "Lichee", "Longan", "Loquat", "Lotus nut",
			"Mango", "Olive", "Papaya", "Persimmon", "Pomelo",
			"Raspberry", "Water Caltrop", "Water-chestnut",
		];
		return foods.map((it,joke)=>{
			return {id: joke, name: it, value: parseInt(Math.random()*100), checked: Math.random()>0.8}; 
		});
	}
	click(evt){
		let id = evt.target.id;
		let title = evt.target.title;
		console.log("TestSuite clicked", this, evt, id,)
		if(title!=="spin") return;
		let items = this.state.items;
		items[id].checked = !items[id].checked;
		this.setState({items});
	}

	render(){
		console.log("TestSuite render", this)
		return <ListView onClick={ (evt)=>{this.click(evt);} } {...this.state}></ListView>
	}
}

let list = <TestSuite key="list001" />;
ReactDOM.render(list, mountNode);
console.log(list)
```

TestSuite çµ„ä»¶å¯¦ä¾‹ list è¿”å›é¡å‹é‚„æ˜¯ Symbol(react.element)ï¼Œåªæ˜¯çµ„ä»¶é¡å‹æ¨™è¨˜ type è¨­ç½®ç‚º TestSuite æ„é€ å‡½æ•°ã€‚

åœ¨çµ„ä»¶å¯¦ä¾‹å®Œæˆåˆå§‹åŒ–åå¾—åˆ°çš„æ‰æ˜¯çœŸæ­£é‹è¡Œä¸­çš„çµ„ä»¶å¯¦ä¾‹ï¼Œå³é€šéçµ„ä»¶ä¸Šä¸‹æ–‡é—œè¯çš„ TestSuite å°è±¡å¯¦åˆ—ï¼š

	context: {}
	props: {}
	refs: {}
	state: {items: Array(23)}
	updater: {isMounted: Æ’, enqueueSetState: Æ’, enqueueReplaceState: Æ’, enqueueForceUpdate: Æ’}
	_reactInternalFiber: FiberNode {tag: 1, key: "list001", stateNode: TestSuite, elementType: Æ’, type: Æ’, â€¦}
	_reactInternalInstance: {_processChildContext: Æ’}
	isMounted: (...)
	replaceState: (...)
	__proto__: Component

å¦å¤–ï¼ŒListView å’Œ ListItem æ˜¯ç„¡ç‹€æ…‹çµ„ä»¶ï¼Œæ²’æœ‰ this ä¸Šä¸‹æ–‡å°è±¡ï¼Œæ‰“å°å‡ºä¾†çš„ä¹Ÿé«”ç¾äº†é€™é»ï¼š

	ListView render undefined
	ListItem render undefined

åŸåˆ™ä¸Šï¼Œåªå…·æœ‰ render å‡½æ•°çš„ç»„ä»¶éƒ½å¯ä»¥å°è£…æˆæ— çŠ¶æ€ç»„ä»¶ï¼Œåœ¨ ListView é€™å€‹ä¾‹å­ä¸­ï¼Œè¾ƒä½³çš„ä½¿ç”¨åœºæ™¯åº”è¯¥æ˜¯åœ¨ ListView ç»„ä»¶çš„ renderRowå‡½æ•°å†…éƒ¨ï¼Œå› ä¸ºæ¯æ¬¡å¯¹ ListView ç»„ä»¶çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œéƒ½ä¼šä¸å¯é¿å…çš„è°ƒç”¨renderRowå‡½æ•°ï¼Œè€Œè¿™æ—¶æ— çŠ¶æ€ç»„ä»¶æ— ç”Ÿå‘½å‘¨æœŸçš„ç‰¹æ€§æ°å¥½èƒ½æœ‰æ•ˆçš„æ˜¾ç¤ºå‡ºæ¥ã€‚è™½ç„¶æ­¤æ—¶æ˜¯å¦å°†renderRowé‡Œé¢çš„ç»„ä»¶æ‹†åˆ†å‡ºæ¥åœ¨æ•ˆæœä¸Šéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç»„ä»¶çš„æ‹†åˆ†æœ‰åˆ©äºé™ä½è€¦åˆï¼Œä¹Ÿæœ‰åˆ©äºéš”ç¦»è¿™äº›å•å…ƒè¿›è¡Œç‹¬ç«‹æµ‹è¯•ã€‚

åˆ›å»ºç±»ç»„ä»¶æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼ŒReact.Component å’Œ React.PureComponentã€‚ä¸¤è€…é™¤äº†åœ¨ shouldComponentUpdate æ–¹æ³•çš„å®ç°é€»è¾‘ä¸Šä¸ä¸€æ ·ï¼Œå…¶ä»–è¡¨ç°éƒ½ä¸€æ ·ï¼ŒPureComponent ä½¿ç”¨äº† propsã€state çš„æµ…æ¯”è¾ƒã€‚PureComponent
çº¯ç»„ä»¶æ˜¯é€šè¿‡ shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ§åˆ¶å‡å°‘ render è°ƒç”¨æ¬¡æ•°æ¥å‡å°‘æ€§èƒ½æŸè€—çš„ã€‚ä½†è¯¥ç»„ä»¶ä¹Ÿå…·æœ‰ä¸€å®šçš„ç¼ºé™·ï¼Œå› ä¸ºå®ƒåªèƒ½è¿›è¡Œä¸€å±‚æµ…æ¯”è¾ƒï¼Œç®€å•æ¥è¯´ï¼Œå®ƒåªæ¯”è¾ƒ props å’Œ state çš„å†…å­˜åœ°å€ï¼Œå¦‚æœå†…å­˜åœ°å€ç›¸åŒï¼Œåˆ™ shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸå°±è¿”å› false ä¸æ‰§è¡Œé‡ç»˜ã€‚

PureComponent çš„ä½¿ç”¨åœºæ™¯åº”è¯¥æ˜¯å±€éƒ¨æ•°æ®å‘ç”Ÿæ”¹å˜çš„åœºæ™¯ï¼Œæ¯”å¦‚å¸¦æœ‰è¾“å…¥æ¡†ã€switch å¼€å…³ç­‰çš„ UI ç»„ä»¶å°±å¯ä»¥ä½¿ç”¨ PureComponent ç»„ä»¶å°è£…ã€‚PureComponent ä¸­å¦‚æœæœ‰æ•°æ®æ“ä½œæœ€å¥½é…åˆç¬¬ä¸‰æ–¹ç»„ä»¶ Immutable ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸º Immutable å¯ä»¥ä¿è¯æ•°æ®çš„ä¸å˜æ€§ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹©ç»§æ‰¿ React.PureComponent ï¼Œå¯ä»¥ä¼˜åŒ–æˆ‘ä»¬çš„ç»„ä»¶æ€§èƒ½ï¼Œä¸è¿‡ç‰¹æ®Šæ—¶å€™ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ç»§æ‰¿ React.Componentï¼Œç„¶åè‡ªå·±å»å®ç° shouldComponentUpdate æ–¹æ³•çš„é€»è¾‘ï¼Œç´”çµ„ä»¶ä¸èƒ½ä½¿ç”¨ shouldComponentUpdateã€‚

	class ListItem extends Component{
		shouldComponentUpdate(nextProps){
			console.log("shouldComponentUpdate", nextProps);
			const { data: dold } = this.props;
			const { data: dnew } = nextProps;
			let isNoChange = dold.id==dnew.id && dold.name==dnew.name && dold.checked==dnew.checked;
			return !isNoChange;
		}
		render(){
			let props = this.props;
			console.log("ListItem render", this)
			const {children, data} = props
			return <div {...data} className="item">
				<span {...data} className={+data.checked?"checked":"unchecked"} title="spin">{children} #{data.id} - </span>
				<span {...data} className="field">{data.name}</span>
				<span {...data} className="field">{data.value}PCS</span>
			</div>
		}
	}

å°†çµ„ä»¶æ”¹ç‚º PureComponent åï¼Œæ›´æ–°æ•¸æ“šæ˜¯å°±éœ€è¦ä¿è­‰å°è±¡æ˜¯å…¨æ–°æ§‹é€ ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹åŸæ•¸æ“šå°è±¡ï¼Œå¦å‰‡è¢« PureComponent çš„æ›´æ–°æ©Ÿåˆ¶å¿½ç•¥ï¼š

	let it = Object.assign({}, items[id]); // NOTICE: AN NEW OBJECT
	it.checked = !it.checked;
	items[id] = it;

	// let it = items[id]; // NOTICE: NEVER WORKING FOR PureComponent
	// it.checked = !it.checked;
	// items[id] = it;
	
	this.setState({items});

ç„¡ç‹€æ…‹çµ„ä»¶æ”¹å¯«ç‚ºé¡çµ„ä»¶æ¯”è¼ƒå®¹æ˜“ï¼Œç›´æ¥å°‡åŸæœ‰çš„å‡½æ•¸æ”¹åç‚º render()ï¼Œå†å°‡åƒæ•¸ props æ”¹çˆ² this.props å¼•ç”¨ï¼Œæœ€å¾Œæ·»åŠ  class extends éª¨æ¶å³å¯ï¼Œæ”¹é€ åçš„åˆ—è¡¨ç¨‹åºåœ¨ä¿®æ”¹é¸æ“‡ç‹€æ…‹æ™‚ä¸æœƒå°‡æ‰€æœ‰ ListItem é€²è¡Œé‡ç¹ªï¼Œè€Œæ˜¯æ›´ç¯€çœè³‡æºçš„é‡ç¹ª TestSuite -> ListView -> ä¿®æ”¹ç¯€é» ListItemï¼š


	class ListItem extends PureComponent{
		render(){
			let props = this.props;
			console.log("ListItem render", this)
			const {children, data} = props
			return <div {...data} className="item">
				<span {...data} className={+data.checked?"checked":"unchecked"} title="spin">{children} #{data.id} - </span>
				<span {...data} className="field">{data.name}</span>
				<span {...data} className="field">{data.value}PCS</span>
			</div>
		}
	}

	class ListView extends PureComponent{
		render(){
			let props = this.props;
			console.log("ListView render", this)
			return <div className="list" {...props}>
				{ props.items.map((it,joke)=>{
					let icons = [["âš«", "âšª"], ["âŒ", "â­•"], ["ğŸ‘â€ğŸ—¨", "ğŸ‘â€ğŸ—¨"]][2];
					let icon = it.checked? icons[0]:icons[1]; 
					return <ListItem key={joke} data={it}>{icon}</ListItem>
				})}
			</div>
		}
	}

	class TestSuite extends Component {
		constructor(props){
			super(props)
			this.state = {items: this.mockGenerate()}
			this.click.bind(this)
		}

		mockGenerate(){
			let foods = [
				"Apple", "Pineapple", "Strawberry", "grape", "Peach",
				"Pear", "Arbutus", "Blackberry", "Guava", "Honeymelon",
				"Lemon", "Lichee", "Longan", "Loquat", "Lotus nut",
				"Mango", "Olive", "Papaya", "Persimmon", "Pomelo",
				"Raspberry", "Water Caltrop", "Water-chestnut",
			];
			return foods.map((it,joke)=>{
				return {id: joke, name: it, value: parseInt(Math.random()*100), checked: Math.random()>0.8}; 
			});
		}
		click(evt){
			let id = evt.target.id;
			let title = evt.target.title;
			console.log("TestSuite clicked", this, evt, id,)
			if(title!=="spin") return;
			let items = this.state.items;

			let it = Object.assign({}, items[id]); // NOTICE: AN NEW OBJECT
			it.checked = !it.checked;
			items[id] = it;

			// let it = items[id]; // NOTICE: NEVER WORKING FOR PureComponent
			// it.checked = !it.checked;
			// items[id] = it;
			
			this.setState({items});
		}

		render(){
			console.log("TestSuite render", this)
			return <ListView onClick={ (evt)=>{this.click(evt);} } {...this.state}></ListView>
		}
	}
	
	let list = <TestSuite key="list001" />;
	ReactDOM.render(list, mountNode);
	console.log(list)


æ³¨æ„ ListView onClick äº‹ä»¶çš„ç¶å®šæ–¹å¼ï¼Œå„˜ç®¡å·²ç¶“åœ¨ TestSuite çš„æ§‹é€ å‡½æ•¸ä¸­ç¶å®šäº†ä¸Šä¸‹æ–‡å°è±¡ this.click.bind(this)ï¼Œåªæ˜¯ onClick çš„éŸ¿æ‡‰æœƒåœ¨å­çµ„ä»¶ä¸­é€²è¡Œï¼Œå­çµ„ä»¶å¹¶æ²’æœ‰ç‚º onClick ç¶å®šä¸Šä¸‹æ–‡å°è±¡ï¼Œå¦‚æœä½¿ç”¨ onClick={this.click} æ–¹å¼ç¶å®šäº‹ä»¶è™•ç†å‡½æ•¸ï¼Œé‚£éº½åœ¨å‡½æ•¸è¢«èª¿ç”¨æ˜¯å°±ç„¡æ³•ç²å¾—ç•¶å‰ä¸Šä¸‹æ–‡ï¼Œä¹Ÿè¨ªå•ä¸äº† TestSuite çµ„ä»¶ã€‚åœ¨è™•ç†å‡½æ•¸ click() ä¸­ï¼Œä¸»è¦é€šé Object.Asign() ä¾†æ‹·è²ä¸€å€‹æ•¸æ“šå‰¯æœ¬ï¼Œç•¶ç„¶å¯ä»¥ä¸ä½¿ç”¨é€™å€‹ APIï¼Œæ‰‹å‹•è³¦å€¼åˆ°ä¸€å€‹æ–°çš„å°è±¡ä¹Ÿå¯ä»¥ã€‚

äº‹ä»¶è™•ç†éç¨‹ä¸­ä½¿ç”¨äº†ä¸€å€‹å°æŠ€å·§ï¼Œé€šé `title="spin"` ä¾†åˆ¤æ–·æ˜¯å¦æ˜¯ç›®æ¨™ç¯€é»è§¸ç™¼çš„äº‹ä»¶ï¼Œå¦‚æœä¸æ˜¯å°±ç›´æ¥è·³éã€‚

éœ€è¦æ³¨æ„çš„æ˜¯çµ¦å­çµ„ä»¶å‚³éçš„å±¬æ€§æ•¸æ“šè¦ç›¡é‡å°‘è€Œå„ªåŒ–ï¼Œé€™æ¨£å¯ä»¥é¿å…è§¸ç™¼ä¸å¿…è¦çš„é‡ç¹ªæ¶ˆè€—ï¼ŒåŒæ™‚ï¼Œåœ¨ TestSuite çˆ¶çµ„ä»¶ä¸Šäº‹ä»¶è™•ç†å‡½æ•¸çš„ç¶å®šä¹Ÿè¦æ³¨æ„ï¼ŒHTML åŸç”Ÿäº‹ä»¶å¦‚ onClick ç­‰äº‹ä»¶åªè¦åœ¨ä»»æ„ä¸€å€‹ HMTL ç¯€é»ç¶å®šå°±å¯ä»¥åœ¨ React æ¥å—åˆ°æ­¤ HMTL èƒ½æ¥å—çš„äº‹ä»¶æµï¼Œæœƒè‡ªå‹•åœ¨çµ„ä»¶é–’å‚³éï¼Œä¸å¿…é€šéå±¤å±¤çµ„ä»¶çš„å±¬æ€§å»è¨­ç½®ã€‚

ä»¥ä¸€å€‹ handler è™•ç†å‡½æ•¸çˆ²ä¾‹ï¼š

	class TestSuite extends Component{
		// ...
		handler = (evt)=>{
			console.log("handler", this,)
			this.edit(evt);
		}

		render(){
			return <ListView 
				onClick={ (evt)=>{this.handler(evt);} } 
				onChange={ this.handler } 
			></ListView>
		}
	}

ä»£ç¢¼ä¸­çš„ onClick å’Œ onChange æ˜¯å…©ç¨®æˆªç„¶ä¸åŒçš„ç¶å®šæ–¹å¼ï¼ŒonClick æœƒåœ¨æ²’æ¬¡ render() åŸ·è¡Œæ™‚ç”Ÿæˆä¸€å€‹æ–°çš„äº‹ä»¶è™•ç†å‡½æ•¸é–‰åŒ…ï¼Œä¹Ÿå°±æ˜¯ä¸€å€‹æ–°çš„çš„æ•¸æ“šå°è±¡ã€‚è€Œ onChange ç¶å®šçš„æ˜¯ TestSuite çµ„ä»¶çš„ä¸€å€‹æˆå“¡å³ handlerï¼Œå®ƒä¹Ÿæ˜¯ä¸€å€‹é–‰åŒ…ï¼Œåªæ˜¯å®ƒéš¨çµ„ä»¶é¡ä¸€èµ·åˆå§‹åŒ–è¨­ç½®å¥½äº†ï¼Œä¸æœƒéš¨è‘—æ¯æ¬¡ render() çš„åŸ·è¡Œè€Œè®Šæ›´ã€‚

å› æ­¤ï¼Œä¸‹é¢ {...props} é€™ç¨®å°‡æ‰€æœ‰å±¬æ€§ç¶å®šåˆ°å­çµ„ä»¶çš„åšæ³•æ˜¯å¾ˆå®¹æ˜“å‡ºç¾æ€§èƒ½å•é¡Œçš„ï¼Œå¦‚æœ TestSuite çš„äº‹ä»¶ç¶å®šåˆæ˜¯ä½¿ç”¨ `onClick={ (evt)=>{this.handler(evt);} }` é€™ç¨®æ–¹å¼ï¼Œé‚£éº½åœ¨æ¯æ¬¡ render() åŸ·è¡Œéƒ½æœƒå°è‡´æ‰€æœ‰ ListItem å­çµ„ä»¶çš„é‡ç¹ªï¼ŒåŒ…æ‹¬ PuerComponent çµ„ä»¶ï¼š

	<ListItem {...props} key={joke} data={it}>{icon}</ListItem>

Vue çš„ template è¡¨ç¤ºæ¨¡æ¿ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ä¸€å€‹æ¨¡æ¿åŒ…è£¹å…ƒç´ ï¼Œæœ¬èº«ä¸åƒèˆ‡è¦–åœ–çš„æ¸²æŸ“ï¼Œå’Œå¾®ä¿¡å°ç¨‹åºçš„ Block ç¯€é»ä¸€æ¨£ï¼Œè€Œ React å¯ä»¥æ¸²æŸ“æ•°ç»„ï¼Œåªè¦æ•¸çµ„å…ƒç´ æ˜¯åˆæ³•çµ„ä»¶å³å¯ï¼Œæ›´éˆæ´»ï¼Œä½†æ³¨æ„è¦æ·»åŠ  key å±¬æ€§è®“ React åœ¨ç‹€æ…‹æ›´æ–°æ™‚é€²è¡Œæ¯”å°è­˜åˆ¥ã€‚å¯ä»¥æŠŠè¦æ¸²æŸ“çš„ä»»æ„ç»„ä»¶æ”¾å…¥æ•°ç»„ä¸­ï¼Œé€™ç¨®æ–¹å¼å¯ä»¥é¿å… DOM çµæ§‹çš„ç¯€é»å±¤ç´šéå¤šï¼Œç¾åœ¨å°±å¯ä»¥ç”¨åˆ°é€™å€‹ç‰¹æ€§ã€‚

ç¾åœ¨å®Œå–„ä¸€ä¸‹é€™å€‹åˆ—è¡¨ç¨‹åºï¼Œè®“å®ƒå…·æœ‰å¯¦ç”¨çš„æ•¸æ“šä¿®æ”¹åŠŸèƒ½ã€‚å®Œå–„åçš„åˆ—è¡¨ç¨‹åºå…·æœ‰ Online Editor çš„åŠŸèƒ½ï¼Œå…·æœ‰ ListItem çš„é¸ä¸­ç‹€æ…‹ç­‰ï¼š


	<!DOCTYPE html>
	<html>
		<head>
			<meta charset="utf-8"/>
			<title> Demo for React JSX! </title>
			<script src="./js/react.development.js"> </script>
			<script src="./js/react-dom.development.js"> </script>
			<script src="./js/babel.min.js"> </script>
			<script src="./js/jquery.min.js"></script>
			<!-- 
			<script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"> </script> 
			<script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"> </script>
			<script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"> </script>
			-->
			<style>
				.list { background: transparent; }
				.item { 
				    border: 1px solid rgba(39, 39, 39, 0.5);
					margin: 8px;
					padding: 2px;
					border-radius: 8px;
					background: radial-gradient(260% 100% at 50% 50%, white, rgba(0, 0, 0, 0.25));
				}
				.item .checked,
				.item .unchecked,
				.item .field { display: inline-block; min-width: 180px; }
				.item .field { display: inline-block; min-width: 180px; }
				.item .checked { cursor: pointer; min-width: 72px; color: rgba(40, 40, 40, 1.0);; }
				.item .unchecked { cursor: pointer; min-width: 72px; color: rgba(204, 204, 204, 0.25);; }
			</style>
		</head>
		<body class="half">

			<div id="example"> </div>

		</body>
	</html>

	<script>
		// import $ from "jquery";
		// import React from "react";
		// import {Component} from 'react';
		let Component = React.Component;
		let PureComponent = React.PureComponent;
		const mountNode = document.getElementById('example')
	</script>

	<script type="text/babel">

		class ListItem extends PureComponent{
			render(){
				let props = this.props;
				console.log("ListItem render", this)
				const {children, data} = props
				return <div {...data} className="item">
					<span {...data} className={+data.checked?"checked":"unchecked"} title="spin">{children} #{data.id} - </span>
					<span {...data} className="field">{data.name}</span>
					<span {...data} className="field">{data.value}PCS</span>
				</div>
			}
		}

		class ListView extends PureComponent{
			render(){
				let props = this.props;
				console.log("ListView render", this)
				return <div className="list" {...props}>
					{ props.items.map((it,joke)=>{
						let icons = [["âš«", "âšª"], ["âŒ", "â­•"], ["ğŸ‘â€ğŸ—¨", "ğŸ‘â€ğŸ—¨"]][2];
						let icon = it.checked? icons[0]:icons[1]; 
						return <ListItem key={joke} data={it}>{icon}</ListItem>
					})}
				</div>
			}
		}

		class TestSuite extends Component {
			constructor(props){
				super(props)
				this.state = {items: this.mockGenerate()}
				this.click.bind(this)
			}

			mockGenerate(){
				let foods = [
					"Apple", "Pineapple", "Strawberry", "grape", "Peach",
					"Pear", "Arbutus", "Blackberry", "Guava", "Honeymelon",
					"Lemon", "Lichee", "Longan", "Loquat", "Lotus nut",
					"Mango", "Olive", "Papaya", "Persimmon", "Pomelo",
					"Raspberry", "Water Caltrop", "Water-chestnut",
				];
				return foods.map((it,joke)=>{
					return {id: joke, name: it, value: parseInt(Math.random()*100), checked: Math.random()>0.8}; 
				});
			}
			click(evt){
				let id = evt.target.id;
				let title = evt.target.title;
				console.log("TestSuite clicked", this, evt, id,)
				if(title!=="spin") return;
				let items = this.state.items;

				let it = Object.assign({}, items[id]); // NOTICE: AN NEW OBJECT
				it.checked = !it.checked;
				items[id] = it;

				// let it = items[id]; // NOTICE: NEVER WORKING FOR PureComponent
				// it.checked = !it.checked;
				// items[id] = it;
				
				this.setState({items});
			}

			// onClick = (evt)=>this.click(evt)

			render(){
				console.log("TestSuite render", this)
				// return <ListView onClick={this.onClick} {...this.state}></ListView>
				return <ListView onClick={ (evt)=>{this.click(evt);} } {...this.state}></ListView>
			}
		}
		
		let list = <TestSuite key="list001" />;
		ReactDOM.render(list, mountNode);
		console.log(list)
		
	</script>


# âš‘ React SSR & Server Components 
- https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html
- https://github.com/reactjs/server-components-demo
- https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html
- https://reactrouter.com/web/guides/server-rendering
- Vue.js æœåŠ¡å™¨ç«¯æ¸²æŸ“æŒ‡å— https://ssr.vuejs.org/zh/

é¦–å…ˆï¼Œææ¸…æ¥šä»€ä¹ˆæ˜¯ SSR è¿™ä¸ªæ¦‚å¿µï¼ŒSSR - Server Side Rendering æœåŠ¡ç«¯æ¸²æŸ“ï¼ŒæŒ‡é¡µé¢çš„æ¸²æŸ“å’Œç”Ÿæˆæ˜¯åœ¨æœåŠ¡ç«¯å®Œæˆçš„ï¼Œå¹¶å°†æ¸²æŸ“å¥½çš„é¡µé¢è¿”å›å®¢æˆ·ç«¯ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªä»€ä¹ˆæ–°æŠ€æœ¯ï¼Œæ—©æœŸçš„ Web åº”ç”¨éƒ½æ˜¯ SSRï¼Œåƒ PHP çš„æœåŠ¡ç«¯è„šæœ¬ï¼Œæ‰§è¡Œæ¨¡æ¿ä¸­çš„ä»£ç ï¼Œç„¶åæ‹¼æ¥æˆä¸€ä¸ª HTML é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

è€Œç°ä»£çš„ SSR æ˜¯åŸºäºç»„ä»¶åŒ–è¿™ä¸ªæ½®æµä¹‹ä¸Šçš„ï¼Œä¸ä¼ ç»Ÿçš„åšæ³•å¤§ä¸ç›¸åŒï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ä¸€ä¸ªåŸºäºç»„ä»¶åŒ–å¼€å‘çš„å‰ç«¯æ¡†æ¶ï¼Œå¦‚ Reactã€Angularã€Vue ç­‰ï¼Œç„¶åå†åˆ©ç”¨ç‰¹å®šçš„ API åœ¨æœåŠ¡ç«¯è¿è¡Œä»¥ç”Ÿæˆå…·æœ‰åŒæ ·äº¤äº’èƒ½åŠ›çš„åº”ç”¨ã€‚

è¿™é‡Œä¸»è¦æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼šå…·æœ‰äº¤äº’èƒ½åŠ›çš„ç»„ä»¶åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ç”Ÿæˆ HTML åå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å…·æœ‰åŒæ ·çš„äº¤äº’èƒ½åŠ›ã€‚è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯å¯¹ä¸€ä¸ªç”Ÿå‘½è¿›è¡Œè„±æ°´ä¿é²œï¼Œå†è¿è¾“åˆ°ç›®çš„åœ°ï¼Œå† `hydrate()` æµ¸æ°´å¤æ´»çš„ã€‚

åŸºæœ¬æµç¨‹ï¼š

- æœåŠ¡å™¨æ¸²æŸ“ç»„ä»¶ï¼Œå¹¶å°†ç»„ä»¶ç”Ÿæˆçš„ HTML å‘å¾€æµè§ˆå™¨ï¼›
- åœ¨æµè§ˆçš„äº¤äº’ä¸­ï¼Œè¯·æ±‚æ–°çš„åœ°å€å‘å›æœåŠ¡å™¨ï¼›
- æœåŠ¡å™¨é€šè¿‡ä¼šè¯ã€è·¯ç”±é…ç½®è§£æç›¸åº”çš„ç»„ä»¶ï¼Œé‡æ–°æ‰§è¡Œç¬¬ä¸€æ­¥æµç¨‹ã€‚

åœ¨åç«¯è°ƒç”¨ renderToString() çš„æ–¹æ³•ï¼ŒæŠŠæ•´ä¸ªé¡µé¢æ¸²æŸ“æˆå­—ç¬¦ä¸²ã€‚ç„¶åå‰ç«¯è°ƒç”¨ hydrate() æ–¹æ³•ï¼ŒæŠŠåç«¯ä¼ é€’çš„å­—ç¬¦ä¸²å’Œè‡ªå·±çš„å®ä¾‹æ··åˆèµ·æ¥ï¼Œä¿ç•™ HTML å¹¶é™„ä¸Šäº‹ä»¶ç›‘å¬ï¼Œå¹¶å¤åŸäº¤äº’åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹å°±åƒæœ‰è„±æ°´ä¿æŒæ´»æ€§ï¼Œè½¬ç§»åˆ°å®¢æˆ·ç«¯åå†æ³¨æ°´æ´»åŒ–ã€‚è¿™å°±æ˜¯ Next.js å®ç° SSR çš„ä¸»è¦æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åç«¯ä¼šæ¸²æŸ“ HTML, å‰ç«¯æ·»åŠ ç›‘å¬ã€‚å‰ç«¯ä¹Ÿä¼šæ¸²æŸ“ä¸€æ¬¡ï¼Œä»¥ç¡®ä¿å‰åç«¯æ¸²æŸ“ç»“æœä¸€è‡´ã€‚å¦‚æœç»“æœä¸ä¸€è‡´ï¼Œæ§åˆ¶å°ä¼šæŠ¥é”™æé†’æˆ‘ä»¬ã€‚

React æœåŠ¡ç«¯æ¸²æŸ“å¾—åˆ°çš„å­—ç¬¦ä¸²å¹¶ä¸ä¼šä»¥ <div onclick="xxx" /> è¿™ç§å†…è”äº‹ä»¶å½¢æ€å‡ºç°ã€‚æ‰€ä»¥ï¼ŒReactDOMServer æ¸²æŸ“çš„å†…å®¹åœ¨ã€Œç»“æ„-æ ·å¼-è¡Œä¸ºã€é“ä¸‰è§’å…³ç³»é‡Œï¼Œç¼ºå¤±äº†ã€Œè¡Œä¸ºã€ã€‚

React v15 ç‰ˆæœ¬çš„ ReactDOM.render æ–¹æ³•å¯ä»¥æ ¹æ® data-react-checksum çš„æ ‡è®°ï¼Œå¤ç”¨ ReactDOMServer çš„æ¸²æŸ“ç»“æœï¼Œä¸é‡å¤æ¸²æŸ“ï¼Œè€Œæ˜¯æ ¹æ® data-reactid å±æ€§ï¼Œæ‰¾åˆ°éœ€è¦ç»‘å®šçš„äº‹ä»¶å…ƒç´ ï¼Œè¿›è¡Œäº‹ä»¶ç»‘å®šçš„å¤„ç†ã€‚è¡¥å®Œã€Œç»“æ„-æ ·å¼-è¡Œä¸ºã€ã€‚

React v16 ç‰ˆæœ¬é‡Œï¼ŒReactDOMServer æ¸²æŸ“çš„å†…å®¹ä¸å†æœ‰ data-react çš„å±æ€§ï¼Œè€Œæ˜¯å°½å¯èƒ½å¤ç”¨ SSR çš„ HTML ç»“æ„ã€‚è¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼ŒReactDOM.render ä¸å†èƒ½å¤Ÿç®€å•åœ°ç”¨ data-react-checksum çš„å­˜åœ¨æ€§æ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥å°è¯•å¤ç”¨ï¼Œå¦‚æœæ¯æ¬¡ ReactDOM.render éƒ½è¦å°½å¯èƒ½å°è¯•å¤ç”¨ï¼Œæ€§èƒ½å’Œè¯­ä¹‰éƒ½ä¼šå‡ºç°é—®é¢˜ã€‚æ‰€ä»¥ï¼Œ ReactDOM æä¾›äº†ä¸€ä¸ªæ–°çš„ APIï¼Œ ReactDOM.hydrate() ã€‚


åœ¨ç»„ä»¶åŒ–çš„æŠ€æœ¯æ½®æµä¸‹ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ç„•å‘æ–°çš„ç”Ÿæœºï¼Œå’Œæ—§å¼çš„ JSPã€PHP ç­‰æœ‰ç€å·¨å¤§å·®åˆ«ã€‚

ç†è®ºä¸Šï¼ŒSSR æˆ–ä¼ ç»Ÿçš„æœåŠ¡ç«¯æ¸²æŸ“æœ€å¤§çš„ç“¶é¢ˆå°±æ˜¯æœåŠ¡ç«¯çš„æ€§èƒ½ï¼Œè€Œæ•°æ®åº“åˆ™æ˜¯æ‰€æœ‰èƒ½åŠ›çš„ç“¶é¢ˆï¼Œä½†æ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„ä¼˜åŠ¿ä¹Ÿæ˜æ˜¾ï¼š

- é¦–å±åŠ è½½å¿«ï¼Œç›¸æ¯”SPAå•é¡µåº”ç”¨è¿˜è¦æœ‰ä¼˜åŠ¿ã€‚
- SEO ä¼˜åŒ– åˆ©äºçˆ¬è™«ï¼Œçˆ¬å–æ•°æ®ã€‚

å¦‚æœç”¨æˆ·è§„æ¨¡å¤§ï¼ŒSPA ä½œä¸ºä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå……åˆ†åˆ©ç”¨ç”¨æˆ·çš„è®¾å¤‡å»è¿è¡Œ App çš„è¿ç®—ï¼ŒSSR åˆ™æ˜¯æŠŠè¿™äº›å·¥ä½œåŒ…æ½åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚æ‰€ä»¥å¯¹äºéœ€è¦å¤§é‡è®¡ç®—ï¼Œå¦‚å›¾è¡¨ç‰¹åˆ«å¤šï¼Œè€Œä¸”ç”¨æˆ·é‡å·¨å¤§çš„é¡µé¢ï¼Œå¹¶ä¸å¤ªé€‚åˆï¼Œåº”è¯¥é€‚å½“å°†è¿ç®—èƒ½åŠ›åˆ†æ•£åˆ°å®¢æˆ·ç«¯å»å®Œæˆã€‚ä½† SSR ä½œä¸ºé™æ€å†…å®¹çš„å±•ç¤ºï¼Œè¿˜æ˜¯éå¸¸é€‚åˆçš„ï¼Œèƒ½æ»¡è¶³å¤§éƒ¨åˆ†çš„å†…å®¹å±•ç¤ºé¡µé¢ï¼Œæˆ–å•†ä¸šç«™ç‚¹ã€‚

ä½¿ç”¨ SSR ä½¿é¡¹ç›®å¤æ‚åº¦å¢åŠ ï¼Œéœ€è¦å‰ç«¯å›¢é˜Ÿæœ‰è¾ƒé«˜çš„æŠ€æœ¯ç´ å…»ã€‚ä¸ºäº†åŒæ„ï¼Œè¦å¤„å¤„å…¼å®¹ Node.js çš„æ‰§è¡Œç¯å¢ƒï¼Œä¸èƒ½æœ‰æµè§ˆå™¨ç›¸å…³çš„åŸç”Ÿä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå‰ç«¯ä»£ç ä½¿ç”¨çš„ window åœ¨ node ç¯å¢ƒæ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥è¦å¯¹å®¢æˆ·ç«¯è¿›è¡Œ mock windowï¼Œè·å–å…¶ä¸­æœ€é‡è¦çš„æ˜¯ cookieï¼ŒuserAgentï¼Œlocation ç­‰å±æ€§æ•°æ®ã€‚

ä»¥ä¸‹æ˜¯åŸºäº Deno ç¼–å†™çš„ React SSR åº”ç”¨ç¤ºèŒƒï¼Œä¸ºäº†ç®€åŒ–èµ·è§ï¼ŒæœåŠ¡å™¨ç«¯çš„ HelloSSR æ˜¯ç®€åŒ–å Hello ç»„ä»¶ï¼Œå®ƒä»¬ç”Ÿæˆçš„åˆå§‹å†…å®¹å¿…é¡»ä¸€è‡´ï¼Œå¦‚æœä½¿ç”¨ hydrateRoot()ã€‚SSR æ¸²æŸ“ç›®çš„æ˜¯å‘æµè§ˆå™¨åœ¨å‘å‡ºé¡µé¢è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥æä¾›ä¸€ä¸ªå…·æœ‰å®Œæ•´ HTML ç»“æ„çš„é¡µé¢ï¼Œè¿™æ ·åšçš„ç›®çš„å¯ä»¥æ˜¯å‡ºäº SEO æœç´¢å¼•æ“ä¼˜åŒ–éœ€è¦ã€‚

æµè§ˆå™¨è·å–åˆ° SSR é¡µé¢åï¼Œå°±æ‰§è¡Œå®¢æˆ·ç«¯çš„è„šæœ¬ï¼ŒReactDOM.hydrate() åˆ™æ ¹æ®å¯¹åº”ç»„ä»¶ç”Ÿæˆçš„ HTML ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ¢å¤ç»„ä»¶çš„äº¤äº’èƒ½åŠ›ã€‚dydrate() ç›¸æ¯” render() å¯ä»¥è·³è¿‡ç»„ä»¶ HTML ç»“æ„å¤„ç†è¿‡ç¨‹ï¼Œå› ä¸º HTML å·²ç»ç”±æœåŠ¡ç”Ÿæˆå¹¶å·²ç»åœ¨é¡µé¢ä¸­ï¼Œè¿™æ ·ä»¥è·å¾—éå¸¸é«˜æ•ˆçš„é¦–æ¬¡åŠ è½½ä½“éªŒï¼ŒReact SSR ä¼šä½¿ç”¨é¡¹ç›®å¤æ‚åŒ–ã€‚

SSR æ˜¯ JSPã€PHP æ—¶ä»£å°±å­˜åœ¨çš„å¤è€çš„æŠ€æœ¯ï¼Œåªä¸è¿‡ä¹‹å‰æ˜¯é€šè¿‡æ¨¡ç‰ˆå¼•æ“ã€‚React SSR åˆ™æ˜¯åŸºäºæ¸²æŸ“ç»„ä»¶å¾—åˆ° HTMLï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å†æ¬¡æ¸²æŸ“ï¼Œè¿™ç§å«åšåŒæ„æ¸²æŸ“çš„æ¨¡å¼ã€‚

SSR å­˜åœ¨çš„ä¸»è¦ç›®çš„é™¤äº† SEO ä¼˜åŒ–ï¼Œè¿˜æœ‰å°±æ˜¯è§£å†³ Client-Side Render (CSR) é¡¹ç›®çš„åˆæ¬¡åŠ è½½æ—¶é—´é•¿çš„é—®é¢˜ï¼ŒTTFPï¼ˆTime To First Pageï¼‰æ—¶é—´æ¯”è¾ƒé•¿ã€‚CSR æ¸²æŸ“æ¨¡å¼ä¸‹ï¼Œé¦–å…ˆè¦åŠ è½½ HTML æ–‡ä»¶ï¼Œä¹‹åè¦ä¸‹è½½é¡µé¢æ‰€éœ€çš„ JavaScript æ–‡ä»¶ï¼Œç„¶å JavaScript æ–‡ä»¶æ¸²æŸ“ç”Ÿæˆé¡µé¢ã€‚

```ts,ignore
/// <reference types="npm:@types/node" />

import os from "node:os";
import chalk from "npm:chalk@5";
// @deno-types="npm:@types/express@^4.17"
import express, {Request, Response} from "npm:express@^4.17";
// import express from "https://esm.sh/express@4.18.2";
import React from "https://esm.sh/react@18.2.0";
import ReactDOM from "https://esm.sh/react-dom@18.2.0";
import ReactDOMServer from "https://esm.sh/react-dom@18.2.0/server";


class HelloSSR extends React.Component {
  render () {
    console.log("ssr render", HelloSSR);
    let fakeTick = 1;
    return (<div>Hello, SSR! {fakeTick} </div>)
  }
}

const ssr = ReactDOMServer.renderToString( <HelloSSR /> );

const html = `
  <!doctype html>
  <html>
    <body>
    <div id="container">${ssr}</div>
      <script src="https://cdn.staticfile.org/babel-standalone/7.22.10/babel.min.js"></script>
      <script type="text/babel" data-type="module">
        import React from "https://esm.sh/react@18.2.0";
        import ReactDOM from "https://esm.sh/react-dom@18.2.0";
        import ReactDOMServer from "https://esm.sh/react-dom@18.2.0/server";

class Hello extends React.Component {
  static tick = 0;
  constructor() {
    super({});
    this.handleClick = this.handleClick.bind(this);
  }
  handleClick(e){ 
    console.log("onclick", {t: this, e}); 
    fetch("/react-ssr")
    .then(res=>res.text())
    .then(res=>console.log({res}));
    this.forceUpdate();
  }
  render () {
    Hello.tick++;
    console.log("render", Hello.name, Hello.tick);
    return (<div onClick={this.handleClick}>Hello, SSR! {Hello.tick} </div>)
  }
}
        let container = document.querySelector("#container");
        // ReactDOM.render(<Hello />, container);
        // ReactDOM.hydrate(<Hello />, container);
        ReactDOM.hydrateRoot(container, <Hello />);
      </script>
      <script type="module">
      </script>
    </body>
  </html>
  `;


const app = express();

app.get("/", (req:Request, res:Response) => {
  res.send(html);
});

app.get("/react-ssr", (req:Request, res:Response) => {
  const ssr = ReactDOMServer.renderToString( <HelloSSR /> );
  res.send(ssr);
});

app.listen(3000);
console.log(chalk.green("listening on http://localhost:3000/"), `home dir: ${os.homedir}`);
```


## SSR with ReactDOMServer
æµ…æReact 18 Streaming SSR https://juejin.cn/post/7064759195710521381

ä½¿ç”¨ ReactDOMServer è¿›è¡ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ç¤ºèŒƒå¯ä»¥å‚è€ƒ server-components-demoã€‚

React ReactDOMServer æ¨¡å—æä¾›çš„ SSR API æœ‰ä¸¤ä¸ªï¼š

- `renderToString()` æ–¹æ³•æ¸²æŸ“çš„æ—¶å€™å¸¦æœ‰ data-reactid å±æ€§ï¼Œåœ¨æµè§ˆå™¨è®¿é—®é¡µé¢çš„æ—¶å€™èƒ½è¯†åˆ«åˆ° HTML çš„å†…å®¹ï¼Œä¸ä¼šæ‰§è¡Œ `createElement` äºŒæ¬¡åˆ›å»º DOMã€‚
- `renderToStaticMarkup()` åˆ™æ²¡æœ‰ data-reactid å±æ€§ï¼Œé¡µé¢çœ‹ä¸Šå»å¹²å‡€ç‚¹ã€‚åœ¨æµè§ˆå™¨è®¿é—®é¡µé¢çš„æ—¶å€™ä¸èƒ½è¯†åˆ«åˆ° HTML å†…å®¹ï¼Œä¼šæ‰§è¡Œ `createElement` æ–¹æ³•é‡æ–°åˆ›å»º DOMã€‚
- `renderToNodeStream()` æ”¯æŒç›´æ¥æ¸²æŸ“åˆ°èŠ‚ç‚¹æµï¼Œæ¸²æŸ“åˆ°æµå¯ä»¥å‡å°‘å†…å®¹ç¬¬ä¸€ä¸ªå­—èŠ‚ TTFB çš„æ—¶é—´ï¼Œåœ¨æ–‡æ¡£çš„ä¸‹ä¸€éƒ¨åˆ†ç”Ÿæˆä¹‹å‰ï¼Œå°†æ–‡æ¡£çš„å¼€å¤´è‡³ç»“å°¾å‘é€åˆ°æµè§ˆå™¨ã€‚ å½“å†…å®¹ä»æœåŠ¡å™¨æµå¼ä¼ è¾“æ—¶ï¼Œæµè§ˆå™¨å°†å¼€å§‹è§£æ HTML æ–‡æ¡£ã€‚é€Ÿåº¦æ˜¯ `renderToString` çš„ä¸‰å€å·¦å³ï¼Œå®˜æ–¹æ˜¯è¿™ä¹ˆè¯´ã€‚
- `renderToStaticNodeStream()` å¾ˆåƒå‰é¢ä¸€ä¸ª APIï¼Œåªæ˜¯æ²¡æœ‰é¢å¤–çš„ DOM å±æ€§ï¼Œå¯ä»¥èŠ‚çœæ•°æ®ã€‚React å†…éƒ¨ä½¿ç”¨ï¼Œå¦‚`data-reactroot`ï¼Œåœ¨åªç”Ÿæˆé™æ€é¡µé¢æ—¶éå¸¸æœ‰ç”¨ã€‚è¿”å›æ•°æ®å’Œ`renderToStaticMarkup`æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœéœ€è¦äº¤äº’å°±ä¸èƒ½ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œè€Œåº”è¯¥åœ¨æœåŠ¡ç«¯ä½¿ç”¨`renderToNodeStream`ï¼Œåœ¨å®¢æˆ·ç«¯ä½¿ç”¨`ReactDOM.hydrate()`ã€‚

TFFBï¼šTime To First Byteï¼Œå‘å‡ºé¡µé¢è¯·æ±‚åˆ°æ¥æ”¶åˆ°åº”ç­”æ•°æ®ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€èŠ±è´¹çš„æ¯«ç§’æ•°ã€‚

å‰é¢ä¸¤ä¸ª String API èƒ½è·¨ Node.jsã€æµè§ˆå™¨ç¯å¢ƒè¿è¡Œï¼šrenderToString()ã€renderToStaticMarkup()

åé¢ä¸¤ä¸ª Stream API åªèƒ½åœ¨ Node.js ç¯å¢ƒè¿è¡Œï¼šrenderToNodeStream()ã€renderToStaticNodeStream()

å…¶ä¸­ renderToString(element) æ˜¯æœ€åŸºç¡€çš„ SSR APIï¼Œè¾“å…¥ React ç»„ä»¶ï¼ˆReactElementï¼‰ï¼Œè¾“å‡ºæ— äº¤äº’æ€§çš„ HTML å­—ç¬¦ä¸²ã€‚ç”±å®¢æˆ·ç«¯ hydrate API ç»™å®ƒé™„åŠ ä¸Šäº¤äº’è¡Œä¸ºï¼Œå¹¶å®Œæˆé¡µé¢æ¸²æŸ“ã€‚

ç±»ä¼¼çš„ renderToStaticMarkup åªç”¨äºçº¯å±•ç¤ºï¼ˆæ²¡æœ‰äº‹ä»¶äº¤äº’ï¼Œä¸éœ€è¦ hydrateï¼‰çš„åœºæ™¯ã€‚åªç”Ÿæˆå¹²å‡€çš„ HTMLï¼Œä¸å¸¦é¢å¤–çš„ DOM å±æ€§ï¼Œå¦‚ data-reactrootï¼Œå“åº”ä½“ç§¯ä¸Šæœ‰äº›å¾®çš„ä¼˜åŠ¿ã€‚

This is useful if you want to use React as a simple static page generator, as stripping away the extra attributes can save some bytes. If you plan to use React on the client to make the markup interactive, do not use this method. Instead, use renderToString on the server and ReactDOM.hydrate() on the client.

React 16 æ”¹ç”¨å•èŠ‚ç‚¹æ ¡éªŒæ¥å¤ç”¨ï¼ˆæœåŠ¡ç«¯è¿”å›çš„ï¼‰HTML èŠ‚ç‚¹ï¼Œä¸å†ç”Ÿæˆ data-reactidã€data-react-checksum ç­‰ä½“ç§¯å ç”¨å¤§æˆ·ï¼Œä¸¤ä¸ª API æ¸²æŸ“ç»“æœçš„ä½“ç§¯å·®å¼‚å˜å¾—å¾®ä¹å…¶å¾®ã€‚

æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆServer side renderingï¼‰æŠ€æœ¯æ¶‰åŠå‰ç«¯ã€åç«¯ä¸¤æ–¹é¢çš„ API é…åˆï¼ŒReact å¯¹åº”æä¾›çš„ SSR API å¯¹åº”ä¸ºé¢å‘æœåŠ¡ç«¯çš„ ReactDOMServer å’Œå®¢æˆ·ç«¯æ‰§è¡Œçš„ ReactDOMï¼ŒåŸºæœ¬å·¥ä½œæµç¨‹ï¼š

åœ¨ç”¨æˆ·è®¿é—®æ—¶ï¼ŒReact SSR åœ¨æœåŠ¡å™¨å°† React ç»„ä»¶æ¸²æŸ“æˆ HTML å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·å®¢æˆ·ç«¯èƒ½å¤Ÿåœ¨ JavaScript æ¸²æŸ“å®Œæˆå‰å±•ç¤ºåŸºæœ¬çš„é™æ€ HTML å†…å®¹ï¼Œå‡å°‘ç™½å±ç­‰å¾…çš„æ—¶é—´ã€‚

ç„¶ååœ¨ JavaScript åŠ è½½å®Œæˆåå¯¹å·²æœ‰çš„ HTML ç»„ä»¶è¿›è¡Œ React äº‹ä»¶é€»è¾‘ç»‘å®šï¼ˆä¹Ÿå°±æ˜¯ Hydration è¿‡ç¨‹ï¼‰ï¼ŒHydration å®Œæˆåæ‰æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ React åº”ç”¨ã€‚

```js
// https://react.dev/reference/react-dom/server
ReactDOMServer.renderToString(reactNode)
ReactDOMServer.renderToStaticMarkup(reactNode)
ReactDOMServer.renderToNodeStream(reactNode) // Deprecated
ReactDOMServer.renderToReadableStream(reactNode, options?) 
ReactDOMServer.renderToStaticNodeStream(reactNode)

// https://react.dev/reference/react-dom
ReactDOM.hydrate(element, container, callback?) // Deprecated
ReactDOM.hydrateRoot(domNode, reactNode, options?)
ReactDOM.render(element, container, callback?) // Deprecated
ReactDOM.createRoot(domNode, options?)
```

ä½†æ˜¯è¿™ç±» SSR å­˜åœ¨å¼Šç«¯ï¼š

1. æœåŠ¡ç«¯éœ€è¦å‡†å¤‡å¥½æ‰€æœ‰ç»„ä»¶çš„ HTML æ‰èƒ½è¿”å›ã€‚å¦‚æœæŸä¸ªç»„ä»¶éœ€è¦çš„æ•°æ®è€—æ—¶è¾ƒä¹…ï¼Œå°±ä¼šé˜»å¡æ•´ä¸ª HTML çš„ç”Ÿæˆã€‚
2. Hydration æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œç”¨æˆ·éœ€è¦ç­‰å¾…å®¢æˆ·ç«¯åŠ è½½æ‰€æœ‰ç»„ä»¶çš„ JavaScript å¹¶ Hydrated å®Œæˆåæ‰èƒ½å’Œä»»ä¸€ç»„ä»¶äº¤äº’ã€‚ï¼ˆæ¸²æŸ“é€»è¾‘å¤æ‚æ—¶ï¼Œé¡µé¢é¦–æ¬¡æ¸²æŸ“åˆ°å¯äº¤äº’ä¹‹é—´å¯èƒ½å­˜åœ¨è¾ƒé•¿çš„ä¸å¯äº¤äº’æ—¶é—´ï¼‰
3. åœ¨ React SSR ä¸­ä¸æ”¯æŒå®¢æˆ·ç«¯æ¸²æŸ“å¸¸ç”¨çš„ä»£ç åˆ†å‰²ç»„åˆ React.lazy å’Œ Suspenseã€‚

React 18 ä¸­æ–°çš„ SSR æ¶æ„ React Fizz å¸¦æ¥äº†ä¸¤ä¸ªä¸»è¦æ–°ç‰¹æ€§æ¥è§£å†³ä¸Šè¿°çš„ç¼ºé™·ï¼š

1. Streaming HTMLï¼ˆæµå¼æ¸²æŸ“ï¼‰
2. Selective Hydrationï¼ˆé€‰æ‹©æ€§æ³¨æ°´ï¼‰


å®‰è£…ä¾èµ–ï¼š

	npm install --save-dev  koa babel-core babel-polyfill babel-preset-latest-node babel-preset-stage-2 babel-preset-react
	# or
	yarn add -dev  koa babel-core babel-polyfill babel-preset-latest-node babel-preset-stage-2 babel-preset-react


å¯åŠ¨æ–‡ä»¶ start.jsï¼š

```js
// start.js
require('babel-core/register')({
    ignore: [/node_modules/],
    presets: [
        'stage-2',
        'react',
        [
            "latest-node",
            { "target": "current" }
        ]
    ]
});

require('babel-polyfill');
require('./../index');
```


å…¥å£æ–‡ä»¶ index.js

```js
// index.js
import Koa from 'koa';
import React from 'react';
import ReactDOMServer from 'react-dom/server';

const { renderToString } = ReactDOMServer;

const app = new Koa();

app.use(ctx => {
ctx.body = renderToString(
    <div>
        <h1>Helloï¼ŒWorld</h1>
    </div>
);
});

app.listen(3000, () => {
console.log('server run in 3000');
});
```

æ‰§è¡Œ npm start å¯åŠ¨é¡¹ç›®

```js
"scripts": {
	"start": "node ./src/start.js"
},

```



# âš‘ Redux Demo çŠ¶æ€ç®¡ç†ä»“åº“
[Redux å…¥é—¨æ•™ç¨‹ï¼ˆä¸€ï¼‰ï¼šåŸºæœ¬ç”¨æ³•](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html)
[Redux å…¥é—¨æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šä¸­é—´ä»¶ä¸å¼‚æ­¥æ“ä½œ](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html)
[Redux å…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰ï¼šReact-Redux çš„ç”¨æ³•](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html)
[Getting Started with Redux](https://redux.js.org/introduction/getting-started)
[Getting Started with React-Redux](https://react-redux.js.org/introduction/quick-start)
[Redux æ ¸å¿ƒæ¦‚å¿µ](https://www.redux.org.cn/docs/introduction/CoreConcepts.html)
[Array.reduce()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)
[Reducers](http://cn.redux.js.org/docs/basics/Reducers.html)
[Reduxä¸­çš„reduceråˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä¸ºä»€ä¹ˆå«reducerï¼Ÿ](https://zhuanlan.zhihu.com/p/25863768)
[Redux Counter Example](https://github.com/reduxjs/redux/tree/master/examples/counter)


å¯¹äºå¤§å‹çš„å¤æ‚åº”ç”¨æ¥è¯´ï¼Œè¿™ä¸¤æ–¹é¢æ°æ°æ˜¯æœ€å…³é”®çš„ã€‚å› æ­¤ï¼Œåªç”¨ React æ²¡æ³•å†™å¤§å‹åº”ç”¨ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ2014å¹´ Facebook æå‡ºäº† Flux æ¶æ„çš„æ¦‚å¿µï¼Œå¼•å‘äº†å¾ˆå¤šçš„å®ç°ã€‚2015å¹´ï¼ŒRedux å‡ºç°ï¼Œå°† Flux ä¸å‡½æ•°å¼ç¼–ç¨‹ç»“åˆä¸€èµ·ï¼Œå¾ˆçŸ­æ—¶é—´å†…å°±æˆä¸ºäº†æœ€çƒ­é—¨çš„å‰ç«¯æ¶æ„ã€‚

é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼ŒRedux æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ¶æ„ï¼Œä½†ä¸æ˜¯éç”¨ä¸å¯ã€‚äº‹å®ä¸Šï¼Œå¤§å¤šæ•°æƒ…å†µï¼Œä½ å¯ä»¥ä¸ç”¨å®ƒï¼Œåªç”¨ React å°±å¤Ÿäº†ã€‚

æ›¾ç»æœ‰äººè¯´è¿‡è¿™æ ·ä¸€å¥è¯ã€‚

"å¦‚æœä½ ä¸çŸ¥é“æ˜¯å¦éœ€è¦ Reduxï¼Œé‚£å°±æ˜¯ä¸éœ€è¦å®ƒã€‚"

Redux çš„åˆ›é€ è€… Dan Abramov åˆè¡¥å……äº†ä¸€å¥ã€‚

"åªæœ‰é‡åˆ° React å®åœ¨è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œä½ æ‰éœ€è¦ Redux ã€‚"

ç®€å•è¯´ï¼Œå¦‚æœä½ çš„UIå±‚éå¸¸ç®€å•ï¼Œæ²¡æœ‰å¾ˆå¤šäº’åŠ¨ï¼ŒRedux å°±æ˜¯ä¸å¿…è¦çš„ï¼Œç”¨äº†åè€Œå¢åŠ å¤æ‚æ€§ã€‚

Redux çš„è®¾è®¡æ€æƒ³å¾ˆç®€å•ï¼Œå°±ä¸¤å¥è¯ã€‚

ï¼ˆ1ï¼‰Web åº”ç”¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œè§†å›¾ä¸çŠ¶æ€æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚
ï¼ˆ2ï¼‰æ‰€æœ‰çš„çŠ¶æ€ï¼Œä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚

ä¸ºäº†é¿å…ä»£ç å¯¹çŠ¶æ€æ•°æ®çš„éšæ„ä¿®æ”¹ï¼Œå¼•å…¥ Redux æ¥ç®¡ç†çŠ¶æ€æ•°æ®ï¼Œä»¥ä¸€ç§è§„èŒƒåŒ–æ–¹å¼æ¥è¯»å†™çŠ¶æ€æ•°æ®ã€‚ Reduxæœ‰3å¤§æ ¸å¿ƒæ¦‚å¿µï¼š Action Reducer Storeï¼Œè§¦å‘ Action å‡½æ•°å°±ç›¸å½“è§¦å‘å†™åŠ¨ä½œã€‚Store å°±æ˜¯ä¿å­˜æ•°æ®çš„åœ°æ–¹ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªå®¹å™¨ï¼Œæ•´ä¸ªåº”ç”¨åªèƒ½æœ‰ä¸€ä¸ª Storeã€‚Redux æä¾› `createStore()` è¿™ä¸ªå‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Storeã€‚

Store å¯¹è±¡åŒ…å«æ‰€æœ‰æ•°æ®ã€‚å¦‚æœæƒ³å¾—åˆ°æŸä¸ªæ—¶ç‚¹çš„æ•°æ®ï¼Œå°±è¦å¯¹ Store ç”Ÿæˆå¿«ç…§ã€‚è¿™ç§æ—¶ç‚¹çš„æ•°æ®é›†åˆï¼Œå°±å«åš `State`ã€‚å½“å‰æ—¶åˆ»çš„ Stateï¼Œå¯ä»¥é€šè¿‡ `store.getState()` æ‹¿åˆ°ã€‚

Redux è§„å®šï¼Œ ä¸€ä¸ª State å¯¹åº”ä¸€ä¸ª Viewã€‚åªè¦ State ç›¸åŒï¼ŒView å°±ç›¸åŒã€‚ä½ çŸ¥é“ Stateï¼Œå°±çŸ¥é“ View æ˜¯ä»€ä¹ˆæ ·ï¼Œåä¹‹äº¦ç„¶ã€‚State çš„å˜åŒ–ï¼Œä¼šå¯¼è‡´ View çš„å˜åŒ–ã€‚ä½†æ˜¯ï¼Œç”¨æˆ·æ¥è§¦ä¸åˆ° Stateï¼Œåªèƒ½æ¥è§¦åˆ° Viewã€‚æ‰€ä»¥ï¼ŒState çš„å˜åŒ–å¿…é¡»æ˜¯ View å¯¼è‡´çš„ã€‚Action å°±æ˜¯ View å‘å‡ºçš„é€šçŸ¥ï¼Œè¡¨ç¤º State åº”è¯¥è¦å‘ç”Ÿå˜åŒ–äº†ã€‚è¿™é‡Œçš„å¼•å…¥ Action å°±æ˜¯ç”¨æ¥çº¦æŸç”¨æˆ·å¯¹çŠ¶æ€æ•°æ®çš„è§„èŒƒåŒ–å†™å…¥è¡Œä¸ºï¼Œå°±æ˜¯ Redux å®ç°çš„çŠ¶æ€æ•°æ®ç®¡ç†çš„è§„èŒƒåŒ–ã€‚

å¯ä»¥äº†è§£Mutabilit(å¯å˜æ€§)å’ŒImmutability(ä¸å˜æ€§)è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ã€Œä¸å¯å˜ã€å°±ä»£è¡¨æŸäº›æ•°æ®æ˜¯ä¸å¯ä¿®å˜çš„ï¼Œå¦‚æœæƒ³è¦æ”¹å˜ä¸å¯å˜çš„æ•°æ®ï¼Œé‚£ä¹ˆåªèƒ½å»å¤åˆ¶æ—§çš„æ•°æ®ï¼Œå†äº§ç”Ÿæ–°çš„æ•°æ®æ¥å–ä»£æ—§çš„æ•°æ®ï¼Œæˆ‘ä»¬æ°¸è¿œä¸è¦å»ä¿®æ”¹æ—§çš„æ•°æ®ã€‚å’ŒVueæ¡†æ¶ä½œä¸ºå¯¹æ¯”ï¼ŒVue çš„ç¼–ç¨‹è§‚å¿µåå‘å‰è€…ï¼ŒReact åå‘åè€…ã€‚

Action æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„ `type` å±æ€§æ˜¯å¿…é¡»çš„ï¼Œè¡¨ç¤º Action çš„åç§°ã€‚å…¶ä»–å±æ€§å¯ä»¥è‡ªç”±è®¾ç½®ï¼Œç¤¾åŒºæœ‰ä¸€ä¸ªè§„èŒƒå¯ä»¥å‚è€ƒã€‚

	const action = {
	  type: 'ADD_TODO',
	  payload: 'Learn Redux'
	};

ä¸Šé¢ä»£ç ä¸­ï¼ŒAction çš„åç§°æ˜¯ ADD_TODOï¼Œå®ƒæºå¸¦çš„ä¿¡æ¯æ˜¯å­—ç¬¦ä¸² Learn Reduxã€‚View è¦å‘é€å¤šå°‘ç§æ¶ˆæ¯ï¼Œå°±ä¼šæœ‰å¤šå°‘ç§ Actionã€‚å¦‚æœéƒ½æ‰‹å†™ï¼Œä¼šå¾ˆéº»çƒ¦ã€‚å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆ Actionï¼Œè¿™ä¸ªå‡½æ•°å°±å« `Action Creator`ã€‚

å¯ä»¥è¿™æ ·ç†è§£ï¼ŒAction å¯¹è±¡æè¿°å½“å‰å‘ç”Ÿçš„äº‹æƒ…ã€‚æ”¹å˜ State çš„å”¯ä¸€åŠæ³•ï¼Œå°±æ˜¯ä½¿ç”¨ Actionã€‚é€šè¿‡ `store.dispatch()` æ–¹æ³•å°† Action è¿é€æ•°æ®åˆ° Storeã€‚Store æ”¶åˆ° Action ä»¥åï¼Œå¿…é¡»ç»™å‡ºä¸€ä¸ªæ–°çš„ Stateï¼Œè¿™æ · View æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™ç§ State çš„è®¡ç®—è¿‡ç¨‹å°±å«åš `Reducer`ã€‚Reducer å¯ä»¥çœ‹ä½œä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—å½“å‰ State å’Œä¸€ä¸ª Action ä½œä¸ºå‚æ•°ï¼Œé€šå¸¸ä¼šæ ¹æ® Action æŒ‡å®šçš„ type è¿”å›ä¸€ä¸ªæ–°çš„ Stateã€‚

	const reducer = function (state, action) {
	  // TODO: return a new state;
	};

è¿™ä¸ªå‡½æ•°å«åš `Reducer` å’Œæ•°ç»„çš„ reduce æ–¹æ³•æœ‰ä¸€å®šå…³ç³»ï¼ŒReducer å‡½æ•°æœ€é‡è¦çš„ç‰¹å¾æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ˜¯åŒæ ·çš„è¾“å…¥ï¼Œå¿…å®šå¾—åˆ°åŒæ ·çš„è¾“å‡ºã€‚çº¯å‡½æ•°æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼Œå¿…é¡»éµå®ˆä»¥ä¸‹ä¸€äº›çº¦æŸã€‚

+ ä¸å¾—æ”¹å†™å‚æ•°
+ ä¸èƒ½è°ƒç”¨ç³»ç»Ÿ I/O çš„API
+ ä¸èƒ½è°ƒç”¨Date.now()æˆ–è€…Math.random()ç­‰ä¸çº¯çš„æ–¹æ³•ï¼Œå› ä¸ºæ¯æ¬¡ä¼šå¾—åˆ°ä¸ä¸€æ ·çš„ç»“æœ

ç”±äº Reducer æ˜¯çº¯å‡½æ•°ï¼Œå°±å¯ä»¥ä¿è¯åŒæ ·çš„Stateï¼Œå¿…å®šå¾—åˆ°åŒæ ·çš„ Viewã€‚ä½†ä¹Ÿæ­£å› ä¸ºè¿™ä¸€ç‚¹ï¼ŒReducer å‡½æ•°é‡Œé¢ä¸èƒ½æ”¹å˜ Stateï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚

Reducer å‡½æ•°è´Ÿè´£ç”Ÿæˆ Stateã€‚ç”±äºæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ª State å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰æ•°æ®ï¼Œå¯¹äºå¤§å‹åº”ç”¨æ¥è¯´ï¼Œè¿™ä¸ª State å¿…ç„¶ååˆ†åºå¤§ï¼Œå¯¼è‡´ Reducer å‡½æ•°ä¹Ÿååˆ†åºå¤§ã€‚Redux æä¾›äº†ä¸€ä¸ª `combineReducers` æ–¹æ³•ï¼Œç”¨äº Reducer çš„æ‹†åˆ†ã€‚ä½ åªè¦å®šä¹‰å„ä¸ªå­ Reducer å‡½æ•°ï¼Œç„¶åç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°†å®ƒä»¬åˆå¹¶åˆ°ä¸€èµ·å½¢æˆæœ€ç»ˆçš„ Reducer å‡½æ•°ã€‚å‚è€ƒä»¥ä¸‹ä¸¤ç»„ç­‰ä»·å†™æ³•ï¼Œå¦‚æœ State çš„å±æ€§åå¿…é¡»ä¸å­ Reducer å‡½æ•°åŒåè¿˜å¯ä»¥ä½¿ç”¨ ES6 çš„ç®€åŒ–å†™æ³•ã€‚

	const reducer = combineReducers({
	  a: doSomethingWithA,
	  b: doSomethingWithB,
	  c: doSomethingWithC
	})

	function reducer(state = {}, action) {
	  return {
	    a: doSomethingWithA(state.a, action),
	    b: doSomethingWithB(state.b, action),
	    c: doSomethingWithC(state.c, action)
	  }
	}

Store å…è®¸ä½¿ç”¨ `store.subscribe()` æ–¹æ³•è®¾ç½®ç›‘å¬å‡½æ•°ï¼Œä¸€æ—¦ State å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚store.subscribe æ–¹æ³•è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥è§£é™¤ç›‘å¬ã€‚


	import { createStore } from 'redux';
	const store = createStore(reducer);

	let unsubscribe = store.subscribe(() =>
	  console.log(store.getState())
	);

	// unsubscribe();

æ˜¾ç„¶ï¼Œåªè¦æŠŠ View çš„æ›´æ–°å‡½æ•°æ”¾å…¥listenï¼Œå°±ä¼šå®ç° View çš„è‡ªåŠ¨æ¸²æŸ“ã€‚å¯¹äº React é¡¹ç›®ï¼Œå°±æ˜¯ç»„ä»¶çš„è§†å›¾æ›´æ–°å‡½æ•°renderæ–¹æ³•æˆ–setStateæ–¹æ³•ã€‚

ä¸‹é¢æ˜¯ç»è¿‡ä¿®æ”¹çš„å®˜æ–¹è®¡æ•°å™¨å®ä¾‹[Redux Counter Example]ï¼Œå¯ä»¥ç›´æ¥ä¿å­˜ä¸º html æ–‡ä»¶è¿è¡Œã€‚

	<!DOCTYPE html>
	<html>
	    <head>
	        <meta charset="utf-8"/>
	        <title> Hello React! </title>
	        <script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"> </script>
	        <script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"> </script>
	        <script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"> </script>
	        <script src="https://cdn.staticfile.org/redux/4.0.1/redux.min.js"></script>
	        <script src="https://cdn.staticfile.org/react-redux/6.0.1/react-redux.min.js"></script>
	        <script src="https://cdn.staticfile.org/prop-types/15.7.2/prop-types.js"></script>
	    </head>
	    <body>
	        <div id="example">
	        </div>
	    </body>
	</html>

	<script type="text/babel">
	let Component = React.Component

	// Counter Component
	class Counter extends Component {
	  constructor(props) {
	    super(props);
	    this.incrementAsync = this.incrementAsync.bind(this);
	    this.incrementIfOdd = this.incrementIfOdd.bind(this);
	  }

	  incrementIfOdd() {
	    if (this.props.value % 2 !== 0) {
	      this.props.onIncrement()
	    }
	  }

	  incrementAsync() {
	    setTimeout(this.props.onIncrement, 1000)
	  }

	  render() {
	    const { value, onIncrement, onDecrement } = this.props
	    return (
	      <p>
	        Clicked: {value} times
	        <button onClick={onIncrement}> + </button>
	        <button onClick={onDecrement}> - </button>
	        <button onClick={this.incrementIfOdd}> Increment if odd </button>
	        <button onClick={this.incrementAsync}> Increment async </button>
	      </p>
	    )
	  }
	}

	Counter.propTypes = {
	  value: PropTypes.number.isRequired,
	  onIncrement: PropTypes.func.isRequired,
	  onDecrement: PropTypes.func.isRequired
	}

	// Reducer 
	const reducer = (state = 0, action) => {
	  switch (action.type) {
	    case 'INCREMENT':
	      return state + 1
	    case 'DECREMENT':
	      return state - 1
	    default:
	      return state
	  }
	}

	// index.js
	let createStore = Redux.createStore;

	const store = createStore(reducer)
	const rootEl = document.getElementById('example')

	const render = () => ReactDOM.render(
	  <Counter
	    value={store.getState()}
	    onIncrement={() => store.dispatch({ type: 'INCREMENT' })}
	    onDecrement={() => store.dispatch({ type: 'DECREMENT' })}
	  />,
	  rootEl
	)

	render()
	store.subscribe(render)
	</script>

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæœ‰ä¸€ä¸ªå…³é”®é—®é¢˜æ²¡æœ‰è§£å†³ï¼šå¼‚æ­¥æ“ä½œæ€ä¹ˆåŠï¼ŸAction å‘å‡ºä»¥åï¼ŒReducer ç«‹å³ç®—å‡º Stateï¼Œè¿™å«åšåŒæ­¥ï¼›Action å‘å‡ºä»¥åï¼Œè¿‡ä¸€æ®µæ—¶é—´å†æ‰§è¡Œ Reducerï¼Œè¿™å°±æ˜¯å¼‚æ­¥ã€‚æ€ä¹ˆæ‰èƒ½ Reducer åœ¨å¼‚æ­¥æ“ä½œç»“æŸåè‡ªåŠ¨æ‰§è¡Œå‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ°æ–°çš„å·¥å…·ï¼šä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰ã€‚

åœ¨ `store.dispatch()` æ–¹æ³•æ‰§è¡Œå‰æ’å…¥ä¸­é—´ä»¶ä»£ç æ˜¯ä¸ªå¥½çš„åˆ‡å…¥ç‚¹ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œè¦æ·»åŠ æ—¥å¿—åŠŸèƒ½ï¼ŒæŠŠ Action å’Œ State æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥å¯¹ `store.dispatch()` è¿›è¡Œæ”¹é€ :

	let next = store.dispatch;
	store.dispatch = function dispatchAndLog(action) {
	  console.log('dispatching', action);
	  next(action);
	  console.log('next state', store.getState());
	}

ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹ store.dispatch è¿›è¡Œäº†é‡å®šä¹‰ï¼Œåœ¨å‘é€ Action å‰åæ·»åŠ äº†æ‰“å°åŠŸèƒ½ã€‚è¿™å°±æ˜¯ä¸­é—´ä»¶çš„é›å½¢ã€‚åœ¨å‘å‡º Action å’Œæ‰§è¡Œ Reducer è¿™ä¸¤æ­¥ä¹‹é—´ï¼Œæ·»åŠ äº†å…¶ä»–åŠŸèƒ½ï¼Œè¿™é‡Œç›®çš„å°±æ˜¯è¦æ·»åŠ  AJAX åŠŸèƒ½ï¼ŒRedux è‡ªå¸¦ applyMiddleware ä¸­é—´ä»¶ã€‚

	import { applyMiddleware, createStore } from 'redux';
	import createLogger from 'redux-logger';
	const logger = createLogger();

	const store = createStore(
	  reducer,
	  applyMiddleware(logger)
	);

createStoreæ–¹æ³•å¯ä»¥æ¥å—æ•´ä¸ªåº”ç”¨çš„åˆå§‹çŠ¶æ€ä½œä¸ºå‚æ•°ï¼Œé‚£æ ·çš„è¯ï¼ŒapplyMiddleware å°±æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°äº†ã€‚

	const store = createStore(
	  reducer,
	  initial_state,
	  applyMiddleware(logger)
	);

applyMiddleware å®ƒæ˜¯ Redux çš„åŸç”Ÿæ–¹æ³•ï¼Œä½œç”¨æ˜¯å°†æ‰€æœ‰ä¸­é—´ä»¶ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¾æ¬¡æ‰§è¡Œã€‚



# âš‘ React-Redux Demo

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒRedux çš„ä½œè€…å°è£…äº†ä¸€ä¸ª React ä¸“ç”¨çš„åº“ React-Reduxï¼Œç›¸å¯¹ç›´æ¥ä½¿ç”¨ Reduxï¼Œä½¿ç”¨ React-Redux æ›´ä¾¿åˆ©ï¼Œä½†æ˜¯éœ€è¦æŒæ¡é¢å¤–çš„ APIï¼Œå¹¶ä¸”è¦éµå®ˆå®ƒçš„ç»„ä»¶æ‹†åˆ†è§„èŒƒã€‚

React-Redux å°†æ‰€æœ‰ç»„ä»¶åˆ†æˆä¸¤å¤§ç±»ï¼šUI ç»„ä»¶ï¼ˆpresentational componentï¼‰å’Œå®¹å™¨ç»„ä»¶ï¼ˆcontainer componentï¼‰ã€‚

	const Title = value => <h1>{value}</h1>;

UI ç»„ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ã€‚

* åªè´Ÿè´£ UI çš„å‘ˆç°ï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘
* æ²¡æœ‰çŠ¶æ€ï¼ˆå³ä¸ä½¿ç”¨this.stateè¿™ä¸ªå˜é‡ï¼‰
* æ‰€æœ‰æ•°æ®éƒ½ç”±å‚æ•°ï¼ˆthis.propsï¼‰æä¾›
* ä¸ä½¿ç”¨ä»»ä½• Redux çš„ API
* ä¸‹é¢å°±æ˜¯ä¸€ä¸ª UI ç»„ä»¶çš„ä¾‹å­ã€‚

å› ä¸ºä¸å«æœ‰çŠ¶æ€ï¼ŒUI ç»„ä»¶åˆç§°ä¸º"çº¯ç»„ä»¶"ï¼Œå³å®ƒçº¯å‡½æ•°ä¸€æ ·ï¼Œçº¯ç²¹ç”±å‚æ•°å†³å®šå®ƒçš„å€¼ã€‚

å®¹å™¨ç»„ä»¶çš„ç‰¹å¾æ°æ°ç›¸åï¼Œè´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£ UI çš„å‘ˆç°ï¼Œå¸¦æœ‰å†…éƒ¨çŠ¶æ€ï¼Œä½¿ç”¨ Redux çš„ APIã€‚

æ€»ä¹‹ï¼Œåªè¦è®°ä½ä¸€å¥è¯å°±å¯ä»¥äº†ï¼šUI ç»„ä»¶è´Ÿè´£ UI çš„å‘ˆç°ï¼Œå®¹å™¨ç»„ä»¶è´Ÿè´£ç®¡ç†æ•°æ®å’Œé€»è¾‘ã€‚

ä½ å¯èƒ½ä¼šé—®ï¼Œå¦‚æœä¸€ä¸ªç»„ä»¶æ—¢æœ‰ UI åˆæœ‰ä¸šåŠ¡é€»è¾‘ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿå›ç­”æ˜¯ï¼Œå°†å®ƒæ‹†åˆ†æˆä¸‹é¢çš„ç»“æ„ï¼šå¤–é¢æ˜¯ä¸€ä¸ªå®¹å™¨ç»„ä»¶ï¼Œé‡Œé¢åŒ…äº†ä¸€ä¸ªUI ç»„ä»¶ã€‚å‰è€…è´Ÿè´£ä¸å¤–éƒ¨çš„é€šä¿¡ï¼Œå°†æ•°æ®ä¼ ç»™åè€…ï¼Œç”±åè€…æ¸²æŸ“å‡ºè§†å›¾ã€‚

React-Redux è§„å®šï¼Œæ‰€æœ‰çš„ UI ç»„ä»¶éƒ½ç”±ç”¨æˆ·æä¾›ï¼Œå®¹å™¨ç»„ä»¶åˆ™æ˜¯ç”± React-Redux è‡ªåŠ¨ç”Ÿæˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·è´Ÿè´£è§†è§‰å±‚ï¼ŒçŠ¶æ€ç®¡ç†åˆ™æ˜¯å…¨éƒ¨äº¤ç»™å®ƒã€‚

React-Redux æä¾›connectæ–¹æ³•ï¼Œç”¨äºä» UI ç»„ä»¶ç”Ÿæˆå®¹å™¨ç»„ä»¶ã€‚connectçš„æ„æ€ï¼Œå°±æ˜¯å°†è¿™ä¸¤ç§ç»„ä»¶è¿èµ·æ¥ã€‚ä¸ºäº†å®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ç»™å‡ºä¸‹é¢ä¸¤æ–¹é¢çš„ä¿¡æ¯ã€‚

0 è¾“å…¥é€»è¾‘ï¼šå¤–éƒ¨çš„æ•°æ®ï¼ˆå³stateå¯¹è±¡ï¼‰å¦‚ä½•è½¬æ¢ä¸º UI ç»„ä»¶çš„å‚æ•°
0 è¾“å‡ºé€»è¾‘ï¼šç”¨æˆ·å‘å‡ºçš„åŠ¨ä½œå¦‚ä½•å˜ä¸º Action å¯¹è±¡ï¼Œä» UI ç»„ä»¶ä¼ å‡ºå»ã€‚

	import { connect } from 'react-redux'

	const VisibleTodoList = connect(
	  mapStateToProps,
	  mapDispatchToProps
	)(TodoList)

ä¸Šé¢ä»£ç ä¸­ï¼Œconnect æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š`mapStateToProps` å’Œ `mapDispatchToProps`ã€‚å®ƒä»¬å®šä¹‰äº† UI ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘ã€‚å‰è€…è´Ÿè´£è¾“å…¥é€»è¾‘ï¼Œå³å°†stateæ˜ å°„åˆ° UI ç»„ä»¶çš„å‚æ•°ï¼ˆpropsï¼‰ï¼Œåè€…è´Ÿè´£è¾“å‡ºé€»è¾‘ï¼Œå³å°†ç”¨æˆ·å¯¹ UI ç»„ä»¶çš„æ“ä½œæ˜ å°„æˆ Actionã€‚å°½ç®¡æœ€ç»ˆä»–ä»¬éƒ½æ˜¯åˆå¹¶åˆ° props å±æ€§ä¸­çš„ï¼Œåè€…é€»è¾‘ä¸Šå¼ºè°ƒæ˜¯ Action åŠ¨ä½œï¼Œæ˜¯æ–¹æ³•å‡½æ•°ã€‚

`mapStateToProps` ä¼šè®¢é˜… Storeï¼Œæ¯å½“stateæ›´æ–°çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œé‡æ–°è®¡ç®— UI ç»„ä»¶çš„å‚æ•°ï¼Œä»è€Œè§¦å‘ UI ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯stateå¯¹è±¡ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»£è¡¨å®¹å™¨ç»„ä»¶çš„propså¯¹è±¡ã€‚

	const mapStateToProps = (state, ownProps) => {
	  return {
	    active: ownProps.filter === state.visibilityFilter
	  }
	}

`mapDispatchToProps` æ˜¯connectå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥å»ºç«‹ UI ç»„ä»¶çš„å‚æ•°åˆ° `store.dispatch` æ–¹æ³•çš„æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå®šä¹‰äº†å“ªäº›ç”¨æˆ·çš„æ“ä½œåº”è¯¥å½“ä½œ Actionï¼Œä¼ ç»™ Storeã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚

å¦‚æœ `mapDispatchToProps` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šå¾—åˆ° `dispatch` å’Œ `ownProps` ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å®¹å™¨ç»„ä»¶çš„ props å¯¹è±¡ã€‚

	const mapDispatchToProps = ( dispatch, ownProps ) => {
	  return {
	    onClick: () => {
	      dispatch({
	        type: 'SET_VISIBILITY_FILTER',
	        filter: ownProps.filter
	      });
	    }
	  };
	}

`mapDispatchToProps` ä½œä¸º Action å‡½æ•°å®šä¹‰ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„æ¯ä¸ªé”®å€¼å¯¹éƒ½æ˜¯ä¸€ä¸ªæ˜ å°„ï¼Œå®šä¹‰äº† UI ç»„ä»¶çš„å‚æ•°æ€æ ·é€šè¿‡ dispatch å‘å‡º Actionï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨äº†ä¸€ä¸ªå¯¹è±¡ï¼Œçœç•¥äº† Action creator çš„å®šä¹‰ã€‚

å¦‚æœmapDispatchToPropsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„æ¯ä¸ªé”®åä¹Ÿæ˜¯å¯¹åº” UI ç»„ä»¶çš„åŒåå‚æ•°ï¼Œé”®å€¼åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šè¢«å½“ä½œ Action creator ï¼Œè¿”å›çš„ Action ä¼šç”± Redux è‡ªåŠ¨å‘å‡ºã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šé¢çš„mapDispatchToPropså†™æˆå¯¹è±¡å°±æ˜¯ä¸‹é¢è¿™æ ·ã€‚

	const mapDispatchToProps = {
	  onClick: (filter) => {
	    type: 'SET_VISIBILITY_FILTER',
	    filter: filter
	  };
	}

connect æ–¹æ³•ç”Ÿæˆå®¹å™¨ç»„ä»¶ä»¥åï¼Œéœ€è¦è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ° state å¯¹è±¡ï¼Œæ‰èƒ½ç”Ÿæˆ UI ç»„ä»¶çš„å‚æ•°ã€‚

ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å°†stateå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥å®¹å™¨ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšæ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ˜¯å®¹å™¨ç»„ä»¶å¯èƒ½åœ¨å¾ˆæ·±çš„å±‚çº§ï¼Œä¸€çº§çº§å°†stateä¼ ä¸‹å»å°±å¾ˆéº»çƒ¦ã€‚

React-Redux æä¾› `Provider` ç»„ä»¶ï¼Œå¯ä»¥è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ° stateã€‚Provider åœ¨æ ¹ç»„ä»¶å¤–é¢åŒ…äº†ä¸€å±‚ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒApp çš„æ‰€æœ‰å­ç»„ä»¶å°±é»˜è®¤éƒ½å¯ä»¥æ‹¿åˆ° state äº†ã€‚å®ƒçš„åŸç†æ˜¯ React ç»„ä»¶çš„ Context APIï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚


ä»¥ä¸‹æ˜¯ä¸€ä¸ªè®¡æ•°å™¨çš„ä¾‹å­ï¼š

	<!DOCTYPE html>
	<html>
	    <head>
	        <meta charset="utf-8"/>
	        <title> Hello React! </title>
	        <script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"> </script>
	        <script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"> </script>
	        <script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"> </script>
	        <script src="https://cdn.staticfile.org/redux/4.0.1/redux.min.js"></script>
	        <script src="https://cdn.staticfile.org/react-redux/6.0.1/react-redux.min.js"></script>
	        <script src="https://cdn.staticfile.org/prop-types/15.7.2/prop-types.js"></script>
	    </head>
	    <body>
	        <div id="example">
	        </div>
	    </body>
	</html>

	<script type="text/babel">

	// /component/Counter.tsx
	// import {Component} from 'react';
	let Component = React.Component;

	class Counter extends Component {
	  render() {
	    const { value, onIncreaseClick } = this.props
	    return (
	      <div>
	        <span>{value}</span>
	        <button onClick={onIncreaseClick}>Increase</button>
	      </div>
	    )
	  }
	}

	Counter.propTypes = {
	  value: PropTypes.number.isRequired,
	  onIncreaseClick: PropTypes.func.isRequired
	}

	// /conponent/localStorage.tsx
	// import { Component } from 'react';
	// import { connect } from 'react-redux';

	// import Counter from '../components/Counter';
	// import PropTypes from 'prop-types'
	// import { increment } from '../actionsCreators';
	// import { createStore } from 'redux'
	// import { Provider, connect } from 'react-redux'

	let connect = ReactRedux.connect;
	let Provider = ReactRedux.Provider;
	let createStore = Redux.createStore;

	// Action
	const increaseAction = { type: 'increase' }

	// Reducer
	function counter(state = { count: 0 }, action) {
	  const count = state.count
	  switch (action.type) {
	    case 'increase':
	      return { count: count + 1 }
	    default:
	      return state
	  }
	}

	// Store
	const store = createStore(counter)

	// Map Redux state to component props
	function mapStateToProps(state) {
	  return {
	    value: state.count
	  }
	}

	// Map Redux actions to component props
	function mapDispatchToProps(dispatch) {
	  return {
	    onIncreaseClick: () => dispatch(increaseAction)
	  }
	}

	// Connected Component
	const App = connect(
	  mapStateToProps,
	  mapDispatchToProps
	)(Counter)

	ReactDOM.render(
	  <Provider store={store}>
	    <App />
	  </Provider>,
	  document.getElementById('example')
	)
	</script>


# âš‘ React Router è·¯ç”±ç»„ä»¶
- [React Router æŒ‡å—](http://www.ruanyifeng.com/blog/2016/05/react_router.html)
- [React Router Tutorial](https://github.com/reactjs/react-router-tutorial/tree/master/lessons)
- [React Router](https://reacttraining.com/react-router/)
- [React Training react-router](https://github.com/ReactTraining/react-router)
- [Rote API](https://reactrouter.com/web/api/Route)
- [React Router 4 Tutorial](https://www.techiediaries.com/react-router-dom-v4/)
- [React Router Dom](https://www.npmjs.com/package/react-router-dom)
- [React Router 3 Documentation](https://github.com/ReactTraining/react-router/tree/v3/docs)
- [React Router 2 Documentation](https://github.com/ReactTraining/react-router/tree/v2.8.1/docs)

ä½ ä¼šå‘ç°ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªåº“ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œè€Œæ˜¯ä¸€ä¸ªåºå¤§çš„ä½“ç³»ã€‚æƒ³è¦å‘æŒ¥å®ƒçš„å¨åŠ›ï¼Œæ•´ä¸ªæŠ€æœ¯æ ˆéƒ½è¦é…åˆå®ƒæ”¹é€ ã€‚ä½ è¦å­¦ä¹ ä¸€æ•´å¥—è§£å†³æ–¹æ¡ˆï¼Œä»åç«¯åˆ°å‰ç«¯ï¼Œéƒ½æ˜¯å…¨æ–°çš„åšæ³•ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼ŒReact ä¸ä½¿ç”¨ HTMLï¼Œè€Œä½¿ç”¨ JSX ã€‚å®ƒæ‰“ç®—æŠ›å¼ƒ DOMï¼Œè¦æ±‚å¼€å‘è€…ä¸è¦ä½¿ç”¨ä»»ä½• DOM æ–¹æ³•ã€‚å®ƒç”šè‡³è¿˜æŠ›å¼ƒäº† SQL ï¼Œè‡ªå·±å‘æ˜äº†ä¸€å¥—æŸ¥è¯¢è¯­è¨€ GraphQL ã€‚å½“ç„¶ï¼Œè¿™äº›ä½ éƒ½å¯ä»¥ä¸ç”¨ï¼ŒReact ç…§æ ·è¿è¡Œï¼Œä½†æ˜¯å°±å‘æŒ¥ä¸å‡ºå®ƒçš„æœ€å¤§å¨åŠ›ã€‚

è¿™æ ·è¯´å§ï¼Œä½ åªè¦ç”¨äº† Reactï¼Œå°±ä¼šå‘ç°åˆç†çš„é€‰æ‹©å°±æ˜¯ï¼Œé‡‡ç”¨å®ƒçš„æ•´ä¸ªæŠ€æœ¯æ ˆã€‚

æœ¬æ–‡ä»‹ç» React ä½“ç³»çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼šè·¯ç”±åº“React-Routerã€‚å®ƒæ˜¯å®˜æ–¹ç»´æŠ¤çš„ï¼Œäº‹å®ä¸Šä¹Ÿæ˜¯å”¯ä¸€å¯é€‰çš„è·¯ç”±åº“ã€‚å®ƒé€šè¿‡ç®¡ç† URLï¼Œå®ç°ç»„ä»¶çš„åˆ‡æ¢å’ŒçŠ¶æ€çš„å˜åŒ–ï¼Œå¼€å‘å¤æ‚çš„åº”ç”¨å‡ ä¹è‚¯å®šä¼šç”¨åˆ°ã€‚

å®˜æ–¹çš„ç¤ºä¾‹åº“éå¸¸æ£’ï¼Œç”±æµ…å…¥æ·±ï¼Œåˆ†æˆ14æ­¥ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰è¯¦ç»†çš„ä»£ç è§£é‡Šã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ å…ˆè·Ÿç€åšä¸€éï¼Œç„¶åå†çœ‹ä¸‹é¢çš„APIè®²è§£ã€‚[è¯´æ˜] æœ¬æ–‡å†™ä½œæ—¶ï¼ŒReact-router æ˜¯ 2.x ç‰ˆï¼Œæœ¬æ–‡çš„å†…å®¹åªé€‚åˆè¿™ä¸ªç‰ˆæœ¬ï¼Œä¸æœ€æ–°çš„ 4.x ç‰ˆä¸å…¼å®¹ã€‚ç›®å‰ï¼Œå®˜æ–¹åŒæ—¶ç»´æŠ¤ 2.x å’Œ 4.x ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥å‰è€…ä¾ç„¶å¯ä»¥ç”¨åœ¨é¡¹ç›®ä¸­ã€‚2017å¹´3æœˆã€‚

å®˜æ–¹æ–‡æ¡£å’Œå®ä¾‹å…‹éš†ï¼š

	git clone https://github.com/reactjs/react-router-tutorial/tree/master/lessons

	git clone https://github.com/ReactTraining/react-router.git

React Router v4 åˆ†æˆå››ä¸ªæ¨¡å—ï¼š

- **react-router**: common core components between dom and native versions.
- **react-router-dom**: the dom version designed for browsers or web apps.
- **react-router-native**: the native version designed for react-native mobile apps.

React-Router Installation

	$ npm install --save react-router

React Router æ¨¡å—åªæä¾›æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œå¦‚æœè¦ä½¿ç”¨å…¶å®ƒç»„ä»¶éœ€è¦å®‰è£… react-router-domï¼Œå¯¹åº”çš„ï¼ŒReact Native åº”ç”¨å®‰è£… react-router-nativeï¼Œå®ƒä»¬éƒ½ä¼šä¾èµ–å®‰è£… react-routerã€‚

Then with a module bundler like webpack, use as you would anything else:

	// using ES6 modules
	import { Router, Route, Switch } from "react-router";
	 
	// using CommonJS modules
	var Router = require("react-router").Router;
	var Route = require("react-router").Route;
	var Switch = require("react-router").Switch;

The UMD build is also available on unpkg:

	<script src="https://unpkg.com/react-router/umd/react-router.min.js"></script>


React-Router-Dom Installation

	$ npm install --save react-router-dom

Then with a module bundler like webpack, use as you would anything else:

	// using ES6 modules
	import { BrowserRouter, Route, Link } from "react-router-dom";
	 
	// using CommonJS modules
	const BrowserRouter = require("react-router-dom").BrowserRouter;
	const Route = require("react-router-dom").Route;
	const Link = require("react-router-dom").Link;

The UMD build is also available on unpkg:

	<script src="https://unpkg.com/react-router-dom/umd/react-router-dom.min.js"></script>

You can find the library on window.ReactRouterDOM.


## React-Router åŸºæœ¬ä½¿ç”¨

1). å®‰è£…

	npm install react-router --save

2). å®šä¹‰å„ä¸ªè·¯ç”±ç»„ä»¶

	// index.jsæ³¨å†Œè·¯ç”±
	import {BrowserRouter} from 'react-router-dom'

	ReactDOM.render((
	    <BrowserRouter>
	        <App/>
	    </BrowserRouter>
	), document.getElementById('root'));


å…ˆåœ¨ç»„ä»¶ä¸­å¼•å…¥è·¯ç”±ç»„ä»¶ï¼Œæ·»åŠ è·¯ç”±é“¾æ¥ï¼Œå¯ä»¥ä½¿ç”¨ Link æˆ–è€… NavLinkï¼ŒåŒºåˆ«æ˜¯ NavLink æœ‰ä¸ª active çš„çŠ¶æ€ç±»åï¼Œå¯ä»¥é€šè¿‡ activeClassName æ¥è®¾ç½®å…¶æ ·å¼ï¼Œå¦‚ä¸‹ä»£ç ç›´æ¥åœ¨ css æ–‡ä»¶ä¸­è®¾ç½® selected çš„æ ·å¼å³å¯ï¼ˆtoåé¢æ˜¯è¦å±•ç¤ºçš„è·¯ç”±åœ°å€ï¼‰

	import {NavLink, Switch, Route, Redirect} from 'react-router-dom'

	<ul>
	  <li>
	      <NavLink to='/home/news'  activeClassName="selected">news</NavLink>
	  </li>
	  <li>
	      <NavLink to='/home/message' activeClassName="selected">message</NavLink>
	  </li>
	</ul>

è·¯ç”±ç»„ä»¶å±•ç¤ºï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªç»„ä»¶è¦å±•ç¤ºç›´æ¥å†™ä¸€ä¸ª`<Route>`æ ‡ç­¾è¿›è¡Œå±•ç¤ºå³å¯ã€‚éœ€è¦è®¾ç½®ä¸¤ä¸ªå±æ€§ï¼Œpath å’Œ componentï¼Œpath æ˜¯è®¾ç½®è·¯ç”±åœ°å€ï¼Œcomponentæ˜¯ç›¸å¯¹åº”è¦å±•ç¤ºçš„ç»„ä»¶

	<Route path='/home/news' component={News}></Route>

å¦‚æœæœ‰å¤šä¸ªç»„ä»¶æ ¹æ®ç‚¹å‡»ç›¸åº”çš„è·¯ç”±å±•ç¤ºï¼Œå°±éœ€è¦ç”¨åˆ° Switch ç»„ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œè¿™é‡Œå¤šæ•°æƒ…å†µä¸‹éœ€è¦æŒ‡å®šä¸€ä¸ªé»˜è®¤è·¯ç”±åœ°å€ï¼ˆå¦‚æœæœªåŒ¹é…åˆ°ä»»ä½•å¯ç”¨çš„è·¯ç”±åœ°å€å°±ä½¿ç”¨è¿™ä¸ªåœ°å€è¿›è¡Œå±•ç¤ºï¼‰ï¼Œä½¿ç”¨ Redirect é‡å®šå‘ç»„ä»¶ï¼ŒRedirect å’Œ Route ä¸€æ ·éœ€è¦è®¾ç½®è·¯ç”±åœ°å€å’Œç›¸å¯¹åº”çš„ç»„ä»¶ï¼Œä¸åŒçš„æ˜¯å®ƒçš„åœ°å€éœ€è¦ä½¿ç”¨toå±æ€§æ¥è®¾ç½®

	<Switch>
	  <Route path='/home/news' component={News}></Route>
	  <Route path='/home/message' component={Message}></Route>
	  <Redirect to='/home/news' component={News} />
	</Switch>

æ³¨æ„ï¼ŒåŸç”Ÿçš„é“¾æ¥æ ‡ç­¾ a.href å’Œ NavLink.to è®¾ç½®åŒæ ·çš„å€¼ï¼Œè¡¨ç°æ˜¯ä¸ä¸€æ ·çš„ï¼š

	<a to="/play">Play Pacman</a>
	<NavLink to="/play">Play Pacman</NavLink>

ä½¿ç”¨åŸç”Ÿæ ‡ç­¾å°±æ˜¯ä½¿ç”¨æµè§ˆå™¨çš„åœ°å€è½¬åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œè€Œ NavLink å´ä¼šæ ¹æ®è·¯ç”± history å±æ€§é…ç½®ç”Ÿæˆå¯¹åº”çš„åœ°å€ã€‚


3).è·¯ç”±ä¼ å‚

è·¯ç”±ä¼ å‚å°±æ˜¯åœ¨Routeç»„ä»¶æŒ‡å®špathçš„æ—¶å€™ï¼Œpathä¸æ˜¯å›ºå®šçš„æ˜¯æ ¹æ®æŸä¸ªå€¼å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦ä¼ ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å†™åœ¨å†’å·åé¢ï¼Œå‚æ•°åå¯ä»¥è‡ªå·±å®šä¹‰ï¼Œå‚æ•°å€¼å¯ä»¥åœ¨ props.match.params æˆ– props.computedMatch.params ä¸­æ‰¾åˆ°ä¸‹é¢ä»£ç ä¸­ä¸º id æ‰€ä¼ å‚æ•°

	<Route path='/home/message/messagedetail/:id' component={MsgDetail} />

4).æ“ä½œè·¯ç”±å†å²è®°å½• history

history å¯¹è±¡å¯ä»¥åœ¨ props é‡Œé¢æŸ¥çœ‹, history æœ‰å‡ ä¸ªæ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ï¼Œåˆ†åˆ«æ˜¯

1.pushæ·»åŠ ä¸€æ¡å†å²è®°å½•

	this.props.history.push(`/home/message/messagedetail/1`)

2.æ›¿æ¢ä¸€æ¡å†å²è®°å½•ï¼Œæ›¿æ¢çš„æ–¹æ³•ä¼šåœ¨å†å²è®°å½•ä¸­åˆ é™¤å½“å‰æ‰€åœ¨è·¯ç”±çš„å†å²è®°å½•æ¢æˆè·³è½¬çš„

	this.props.history.replace(`/home/about`)

3.å‰è¿›

	this.props.history.goForward()

4.åé€€

	this.props.history.goBack()


ä½¿ç”¨æ—¶ï¼Œè·¯ç”±å™¨`Router`ç»„ä»¶æœ¬èº«åªæ˜¯ä¸€ä¸ªè·¯ç”±å®¹å™¨ç»„ä»¶ï¼Œè·¯ç”±è§„åˆ™è¦é€šè¿‡`Route`ç»„ä»¶å®šä¹‰ã€‚

	import { Router, Route, hashHistory } from 'react-router';

	render((
	  <Router history={hashHistory}>
	    <Route path="/" component={App}/>
	  </Router>
	), document.getElementById('app'));

ä¸Šé¢ä»£ç ä¸­ï¼Œç”¨æˆ·è®¿é—®æ ¹è·¯ç”±ï¼Œæ¯”å¦‚`http://www.example.com/`ï¼Œç»„ä»¶APPå°±ä¼šåŠ è½½åˆ°`document.getElementById('app')`ã€‚`Router`ç»„ä»¶æœ‰ä¸€ä¸ªå‚æ•°`history`èµ‹å€¼ä¸º`hashHistory`ï¼Œè¡¨ç¤ºè·¯ç”±çš„åˆ‡æ¢ç”±URLçš„hashå˜åŒ–å†³å®šï¼Œå³URLçš„`#`åçš„éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ã€‚Routeç»„ä»¶å®šä¹‰äº†URLè·¯å¾„ä¸ç»„ä»¶çš„å¯¹åº”å…³ç³»ï¼Œ`path`è§„åˆ™åŒ¹é…æ—¶å°±ä¼šæ‰§è¡Œ`component`æŒ‡å®šå¾—ç»„ä»¶ã€‚å¦‚ä¾‹å­ï¼Œç”¨æˆ·è®¿é—®`http://localhost:8080/#/about`æ—¶ï¼ŒåŠ è½½`About`ç»„ä»¶ã€‚è·¯ç”±åŒ¹é…è§„åˆ™æ˜¯ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼Œä¸€æ—¦å‘ç°åŒ¹é…ï¼Œå°±ä¸å†å…¶ä½™çš„è§„åˆ™äº†ã€‚

	<Router history={hashHistory}>
	  <Route path="/" component={App}/>
	  <Route path="/repos" component={Repos}/>
	  <Route path="/about" component={About}/>
	</Router>

æ–°ç‰ˆ React çš„ history ä½¿ç”¨æ–¹æ³•ï¼š

	import React from "react";
	import ReactDOM from "react-dom";
	import { Router } from "react-router";
	import { createBrowserHistory } from "history";

	const history = createBrowserHistory();

	ReactDOM.render(
	  <Router history={history}>
	    <App />
	  </Router>,
	  node
	);


## histroy è®¾ç½®å·¥ä½œæ–¹æ³•

Routerç»„ä»¶çš„`history`å±æ€§ï¼Œç”¨æ¥ç›‘å¬æµè§ˆå™¨åœ°å€æ çš„å˜åŒ–ï¼Œå¹¶å°† URL è§£ææˆä¸€ä¸ªåœ°å€å¯¹è±¡ï¼Œä¾› React Router åŒ¹é…ã€‚

ä¸€å…±å¯ä»¥è®¾ç½®ä¸‰ç§å·¥ä½œæ–¹å¼ï¼š

	browserHistory
	hashHistory
	createMemoryHistory

å¦‚æœè®¾ä¸º`hashHistory`ï¼Œè·¯ç”±å°†é€šè¿‡URLçš„`hash`éƒ¨åˆ†åˆ‡æ¢ï¼Œ`#` å·åçš„éƒ¨åˆ†ï¼ŒURLçš„å½¢å¼ç±»ä¼¼`example.com/#/some/path`ã€‚

	import { hashHistory } from 'react-router'

	render(
	  <Router history={hashHistory} routes={routes} />,
	  document.getElementById('app')
	)

å¦‚æœè®¾ä¸º`browserHistory`ï¼Œæµè§ˆå™¨çš„è·¯ç”±å°±ä¸å†é€šè¿‡`Hash`å®Œæˆäº†ï¼Œè€Œæ˜¾ç¤ºæ­£å¸¸çš„è·¯å¾„`example.com/some/path`ï¼ŒèƒŒåè°ƒç”¨çš„æ˜¯æµè§ˆå™¨çš„`History API`ï¼Œæ–°ä¸€ä»£æµè§ˆå™¨APIæ”¯æŒä¿®æ”¹URLåœ°å€è€Œä¸åˆ·æ–°é¡µé¢ã€‚

	import { browserHistory } from 'react-router'

	render(
	  <Router history={browserHistory} routes={routes} />,
	  document.getElementById('app')
	)

ä½†æ˜¯ï¼Œè¿™ç§æƒ…å†µéœ€è¦å¯¹æœåŠ¡å™¨æ”¹é€ ã€‚å¦åˆ™ç”¨æˆ·ç›´æ¥å‘æœåŠ¡å™¨è¯·æ±‚æŸä¸ªå­è·¯ç”±ï¼Œä¼šæ˜¾ç¤ºç½‘é¡µæ‰¾ä¸åˆ°çš„404é”™è¯¯ã€‚

å¦‚æœå¼€å‘æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯`webpack-dev-server`ï¼ŒåŠ ä¸Š`--history-api-fallback`å‚æ•°å°±å¯ä»¥äº†ã€‚

	$ webpack-dev-server --inline --content-base . --history-api-fallback

`createMemoryHistory`ä¸»è¦ç”¨äºæœåŠ¡å™¨æ¸²æŸ“ã€‚å®ƒåˆ›å»ºä¸€ä¸ªå†…å­˜ä¸­çš„`history`å¯¹è±¡ï¼Œä¸ä¸æµè§ˆå™¨URLäº’åŠ¨ã€‚

	const history = createMemoryHistory(location)

æ–°çš„ API æŒ‰ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š

	import { createBrowserHistory as createHistory } from "history";
	import { createHashHistory as createHistory } from "history";
	const history = createHistory();

Hash çš„æ–¹å¼ï¼š

	export type HashType = 'hashbang' | 'noslash' | 'slash';

	export interface HashHistoryBuildOptions {
	    basename?: string;
	    hashType?: HashType;
	    getUserConfirmation?: typeof getConfirmation;
	}

SPA - Single Page Application åº”ç”¨çš„æµè¡Œè‡ªç„¶ç¦»ä¸å¼€å‰ç«¯ Route çš„å…´èµ·ï¼Œç°åœ¨æµè¡Œçš„ MVVM æ¡†æ¶éƒ½æ˜¯ç”±å‰ç«¯æ§åˆ¶è·¯ç”±åˆ†å‘ï¼Œç”¨ AJAX å’Œ å‰ç«¯ Route èƒ½å¸¦ç»™ç”¨æˆ·å¾ˆå¥½çš„ä½“éªŒã€‚ä½†æ˜¯å¯¹äº SEO æœç´¢å¼•æ“ä¼˜åŒ–å°±æ˜¯ä¸€åœºè«å¤§çš„ç¾éš¾ï¼Œå› ä¸º AJAX åº”ç”¨ä¸ä¼šç•™ä¸‹å†å²è®°å½•ã€‚

Hashbang è¿™æ˜¯ ç”± Google æå‡ºçš„ï¼Œè¿™ç§é£æ ¼å½¢åœ¨åœ°å€æ ä½¿ç”¨ #! ç¬¦å·ï¼š

	http://lcoalhost:8080#!woshihashbang
	http://localhost:8080/#!/user/login

è™½ç„¶ # åé¢çš„ Hash å†…å®¹é»˜è®¤ä¸ä¼šè¢«çˆ¬è™«çˆ¬åˆ°ï¼Œä½†æ˜¯å¦‚æœæ˜¯ Hashbangï¼Œé‚£ä¹ˆçˆ¬è™«ä¼šè®¤ä¸ºçˆ¬åˆ°çš„æ˜¯ä¸ª SPA åº”ç”¨ï¼Œå› æ­¤ï¼Œå®ƒä¼šè‡ªåŠ¨çˆ¬å»åˆ° hash é‡Œçš„å†…å®¹ï¼Œç°åœ¨çŸ¥é“äº†ï¼Œhashbang å°±æ˜¯ä¸ºäº†è§£å†³ AJAX åº”ç”¨çš„ SEO é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚

slash æ–¹å¼å°±æ˜¯ä½¿ç”¨ #/ ç¬¦å·ï¼Œç›¸æ¯”åŸæœ¬çš„ Hash å¤šäº†ä¸€ä¸ªæ–œæ ã€‚


## React Router åµŒå¥—è·¯ç”±

	<Router history={hashHistory}>
	  <Route path="/" component={App}>
	    <Route path="/repos" component={Repos}/>
	    <Route path="/about" component={About}/>
	  </Route>
	</Router>

ä¸Šé¢ä»£ç ä¸­ï¼Œç”¨æˆ·è®¿é—®`/repos`æ—¶ï¼Œä¼šå…ˆåŠ è½½`App`ç»„ä»¶ï¼Œç„¶ååœ¨å®ƒçš„å†…éƒ¨å†åŠ è½½`Repos`ç»„ä»¶ã€‚

	<App>
	  <Repos/>
	</App>

Appç»„ä»¶è¦å†™æˆä¸‹é¢çš„æ ·å­ã€‚

	export default React.createClass({
	  render() {
	    return <div>
	      {this.props.children}
	    </div>
	  }
	})

ä¸Šé¢ä»£ç ä¸­ï¼Œ`App`ç»„ä»¶çš„`this.props.children`å±æ€§å°±æ˜¯å­ç»„ä»¶ï¼Œè¿™é‡Œå°±æ˜¯`Repos`å‘ˆç°çš„ä½ç½®ã€‚ å­è·¯ç”±ä¹Ÿå¯ä»¥ä¸å†™åœ¨`Router`ç»„ä»¶é‡Œé¢ï¼Œå•ç‹¬ä¼ å…¥`Router`ç»„ä»¶çš„`routes`å±æ€§ã€‚

	let routes = <Route path="/" component={App}>
				  <Route path="/repos" component={Repos}/>
				  <Route path="/about" component={About}/>
				</Route>;

	<Router routes={routes} history={browserHistory}/>

## path å±æ€§

Routeç»„ä»¶çš„`path`å±æ€§æŒ‡å®šè·¯ç”±çš„åŒ¹é…è§„åˆ™ï¼Œçœç•¥æ—¶è¡¨ç¤ºæ€»æ˜¯åŠ è½½æŒ‡å®šç»„ä»¶ã€‚

	<Route path="inbox" component={Inbox}>
	   <Route path="messages/:id" component={Message} />
	</Route>

ä¸Šé¢ä»£ç ä¸­ï¼Œ`:id`è¡¨ç¤ºä¸€ä¸ªå‚æ•°å ä½ç¬¦ï¼Œå½“ç”¨æˆ·è®¿é—®`/inbox/messages/123`æ—¶ï¼Œä¼šåŠ è½½ä¸‹é¢çš„ç»„ä»¶ã€‚ç›¸å½“çœç•¥å¤–å±‚ Route çš„`path`å‚æ•°ï¼Œå†™æˆä¸‹é¢çš„æ ·å­ã€‚

	<Route component={Inbox}>
	  <Route path="inbox/messages/:id" component={Message} />
	</Route>

ç°åœ¨ç”¨æˆ·è®¿é—®/inbox/messages/:idæ—¶ï¼Œç»„ä»¶åŠ è½½è¿˜æ˜¯åŸæ¥çš„æ ·å­ã€‚

	<Inbox>
	  <Message/>
	</Inbox>

## path é€šé…ç¬¦


>:paramName â€“ matches a URL segment up to the next /, ?, or #. The matched string is called a param
>() â€“ Wraps a portion of the URL that is optional. You may escape parentheses if you want to use them in a url using a backslash \
>* â€“ Matches all characters (non-greedy) up to the next character in the pattern, or to the end of the URL if there is none, and creates a splat param
>** - Matches all characters (greedy) until the next /, ?, or # and creates a splat param

	<Route path="/hello/:name">         // matches /hello/michael and /hello/ryan
	<Route path="/hello/:name?">       // matches /hello, /hello/michael, and /hello/ryan
	<Route path="/files/*.*">           // matches /files/hello.jpg and /files/hello.html
	<Route path="/**/*.jpg">            // matches /files/hello.jpg and /files/path/to/file.jpg
	<Route path="/hello\\(:name\\)">    // matches /hello(michael)

`:name`å˜é‡å ä½ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª`/`ã€`?`ã€`#`ä¸ºæ­¢ã€‚è¿™ä¸ªè·¯å¾„å‚æ•°å¯ä»¥é€šè¿‡ this.props.params.paramName å–å‡ºï¼Œå¦‚æœæ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œåˆ™é€šè¿‡å‡½æ•°å‚æ•° props.match.params.paramName è·å–ã€‚åŒ¹é…ç±»ä¼¼URL `/hello/michael` å’Œ `/hello/ryan`ã€‚

`(/:name)`åŠ åœ†æ‹¬å·è¡¨ç¤ºå¯ä»¥é€‰å‚æ•°åŒ¹é…ï¼Œ`/hello`ã€ `/hello/michael` å’Œ `/hello/ryan`
`*`æ˜Ÿå·è¡¨ç¤ºä»»æ„çº§è·¯å¾„ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªé€šé…ç¬¦ï¼ŒåŒ¹é… `/hello/` å’Œ `/hello/ryan/html` ç­‰ç­‰
`**`æ˜Ÿå·è¡¨ç¤ºä»»æ„çº§è·¯å¾„ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª`/`ã€`?`ã€`#`ä¸ºæ­¢ã€‚åŒ¹é… `/hello/` å’Œ `/hello/ryan/html` ç­‰ç­‰
`*.*`æ˜Ÿå·ç‚¹æ˜Ÿå·è¡¨ç¤ºæ–‡ä»¶åï¼ŒåŒ¹é… `/hello/michael.jpg` å’Œ `/hello/ryan.html`

	<Route path="/hello/:name">
	<Route path="/hello(/:name)">
	<Route path="/files/*.*">
	<Route path="/files/*">
	<Route path="/**/*.jpg">


pathå±æ€§ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆä¸ä»¥/å¼€å¤´ï¼‰ï¼ŒåŒ¹é…æ—¶å°±ä¼šç›¸å¯¹äºçˆ¶ç»„ä»¶çš„è·¯å¾„ï¼Œå¯ä»¥å‚è€ƒä¸Šä¸€èŠ‚çš„ä¾‹å­ã€‚åµŒå¥—è·¯ç”±å¦‚æœæƒ³æ‘†è„±è¿™ä¸ªè§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨ç»å¯¹è·¯ç”±ã€‚

	<Router>
	  <Route path="/:userName/:id" component={UserPage}/>
	  <Route path="/about/me" component={About}/>
	</Router>

ä¸Šé¢ä»£ç ä¸­ï¼Œç”¨æˆ·è®¿é—®/about/meæ—¶ï¼Œä¸ä¼šè§¦å‘ç¬¬äºŒä¸ªè·¯ç”±è§„åˆ™ï¼Œå› ä¸ºå®ƒä¼šåŒ¹é…/:userName/:idè¿™ä¸ªè§„åˆ™ã€‚å› æ­¤ï¼Œå¸¦å‚æ•°çš„è·¯å¾„ä¸€èˆ¬è¦å†™åœ¨è·¯ç”±è§„åˆ™çš„åº•éƒ¨ã€‚

æ­¤å¤–ï¼ŒURLçš„æŸ¥è¯¢å­—ç¬¦ä¸²/foo?bar=bazï¼Œå¯ä»¥ç”¨this.props.location.query.barè·å–ã€‚


## IndexRoute ç»„ä»¶

ä¸‹é¢çš„ä¾‹å­ï¼Œä½ ä¼šä¸ä¼šè§‰å¾—æœ‰ä¸€ç‚¹é—®é¢˜ï¼Ÿ

	<Router>
	  <Route path="/" component={App}>
	    <Route path="accounts" component={Accounts}/>
	    <Route path="statements" component={Statements}/>
	  </Route>
	</Router>

ä¸Šé¢ä»£ç ä¸­ï¼Œè®¿é—®æ ¹è·¯å¾„`/`ï¼Œä¸ä¼šåŠ è½½ä»»ä½•å­ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`App`ç»„ä»¶çš„`this.props.children`ï¼Œè¿™æ—¶æ˜¯`undefined`ã€‚

å› æ­¤ï¼Œé€šå¸¸ä¼šé‡‡ç”¨`{this.props.children || <Home/>}`è¿™æ ·çš„å†™æ³•ã€‚è¿™æ—¶ï¼Œ`Home`æ˜æ˜æ˜¯`Accounts`å’Œ`Statements`çš„åŒçº§ç»„ä»¶ï¼Œå´æ²¡æœ‰å†™åœ¨`Route`ä¸­ã€‚

`IndexRoute`å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ˜¾å¼æŒ‡å®š`Home`æ˜¯æ ¹è·¯ç”±çš„å­ç»„ä»¶ï¼Œå³æŒ‡å®šé»˜è®¤æƒ…å†µä¸‹åŠ è½½çš„å­ç»„ä»¶ã€‚ä½ å¯ä»¥æŠŠ`IndexRoute`æƒ³è±¡æˆæŸä¸ªè·¯å¾„çš„`index.html`ã€‚æ³¨æ„ï¼ŒIndexRouteç»„ä»¶æ²¡æœ‰è·¯å¾„å‚æ•°pathã€‚

	<Router>
	  <Route path="/" component={App}>
	    <IndexRoute component={Home}/>
	    <Route path="accounts" component={Accounts}/>
	    <Route path="statements" component={Statements}/>
	  </Route>
	</Router>

è¿™ç§ç»„ä»¶ç»“æ„å°±å¾ˆæ¸…æ™°äº†ï¼šAppåªåŒ…å«ä¸‹çº§ç»„ä»¶çš„å…±æœ‰å…ƒç´ ï¼Œæœ¬èº«çš„å±•ç¤ºå†…å®¹åˆ™ç”±Homeç»„ä»¶å®šä¹‰ã€‚è¿™æ ·æœ‰åˆ©äºä»£ç åˆ†ç¦»ï¼Œä¹Ÿæœ‰åˆ©äºä½¿ç”¨React Routeræä¾›çš„å„ç§APIã€‚


## IndexRedirect ç»„ä»¶

IndexRedirectç»„ä»¶ç”¨äºè®¿é—®æ ¹è·¯ç”±çš„æ—¶å€™ï¼Œå°†ç”¨æˆ·é‡å®šå‘åˆ°æŸä¸ªå­ç»„ä»¶ã€‚

	<Route path="/" component={App}>
	  ï¼œIndexRedirect to="/welcome" />
	  <Route path="welcome" component={Welcome} />
	  <Route path="about" component={About} />
	</Route>

ä¸Šé¢ä»£ç ä¸­ï¼Œç”¨æˆ·è®¿é—®æ ¹è·¯å¾„æ—¶ï¼Œå°†è‡ªåŠ¨é‡å®šå‘åˆ°å­ç»„ä»¶welcomeã€‚

## Redirect ç»„ä»¶

<Redirect>ç»„ä»¶ç”¨äºè·¯ç”±çš„è·³è½¬ï¼Œå³ç”¨æˆ·è®¿é—®ä¸€ä¸ªè·¯ç”±ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°å¦ä¸€ä¸ªè·¯ç”±ã€‚

	<Route path="inbox" component={Inbox}>
	  ï¼œRedirect from="messages/:id" to="/messages/:id" />
	</Route>

ç°åœ¨è®¿é—®`/inbox/messages/5`ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°`/messages/5`ã€‚

## Link ç»„ä»¶

Linkç»„ä»¶ç”¨äºå–ä»£`<a>`å…ƒç´ ï¼Œç”Ÿæˆä¸€ä¸ªé“¾æ¥ï¼Œå…è®¸ç”¨æˆ·ç‚¹å‡»åè·³è½¬åˆ°å¦ä¸€ä¸ªè·¯ç”±ã€‚å®ƒåŸºæœ¬ä¸Šå°±æ˜¯`<a>`å…ƒç´ çš„React ç‰ˆæœ¬ï¼Œå¯ä»¥æ¥æ”¶Routerçš„çŠ¶æ€ã€‚

	render() {
	  return <div>
	    <ul role="nav">
	      <li><Link to="/about">About</Link></li>
	      <li><Link to="/repos">Repos</Link></li>
	    </ul>
	  </div>
	}

å¦‚æœå¸Œæœ›å½“å‰çš„è·¯ç”±ä¸å…¶ä»–è·¯ç”±æœ‰ä¸åŒæ ·å¼ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨Linkç»„ä»¶çš„`activeStyle`å±æ€§ã€‚

	<Link to="/about" activeStyle={{color: 'red'}}>About</Link>
	<Link to="/repos" activeStyle={{color: 'red'}}>Repos</Link>

å¦ä¸€ç§åšæ³•æ˜¯ï¼Œä½¿ç”¨`activeClassName`æŒ‡å®šå½“å‰è·¯ç”±çš„Classã€‚

	<Link to="/about" activeClassName="active">About</Link>
	<Link to="/repos" activeClassName="active">Repos</Link>

ä¸Šé¢ä»£ç ä¸­ï¼Œå½“å‰é¡µé¢çš„é“¾æ¥çš„`class`ä¼šåŒ…å«`active`ã€‚

åœ¨Routerç»„ä»¶ä¹‹å¤–ï¼Œå¯¼èˆªåˆ°è·¯ç”±é¡µé¢ï¼Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„History APIï¼Œåƒä¸‹é¢è¿™æ ·å†™ã€‚

	import { browserHistory } from 'react-router';
	browserHistory.push('/some/path');


## IndexLink ç»„ä»¶

å¦‚æœé“¾æ¥åˆ°æ ¹è·¯ç”±`/`ï¼Œä½¿ç”¨`IndexLink`ç»„ä»¶ï¼Œä¸è¦ä½¿ç”¨Linkç»„ä»¶ã€‚

è¿™æ˜¯å› ä¸ºå¯¹äºæ ¹è·¯ç”±æ¥è¯´ï¼Œ`activeStyle`å’Œ`activeClassName`ä¼šå¤±æ•ˆï¼Œæˆ–è€…è¯´æ€»æ˜¯ç”Ÿæ•ˆï¼Œå› ä¸º`/`ä¼šåŒ¹é…ä»»ä½•å­è·¯ç”±ã€‚è€Œ`IndexLink`ç»„ä»¶ä¼šä½¿ç”¨è·¯å¾„çš„ç²¾ç¡®åŒ¹é…ã€‚

	<IndexLink to="/" activeClassName="active">
	  Home
	</IndexLink>

ä¸Šé¢ä»£ç ä¸­ï¼Œæ ¹è·¯ç”±åªä¼šåœ¨ç²¾ç¡®åŒ¹é…æ—¶ï¼Œæ‰å…·æœ‰`activeClassName`ã€‚

å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨`Link`ç»„ä»¶çš„`onlyActiveOnIndex`å±æ€§ï¼Œä¹Ÿèƒ½è¾¾åˆ°åŒæ ·æ•ˆæœã€‚

	<Link to="/" activeClassName="active" onlyActiveOnIndex={true}>
	  Home
	</Link>

å®é™…ä¸Šï¼Œ`IndexLink`å°±æ˜¯å¯¹`Link`ç»„ä»¶çš„`onlyActiveOnIndex`å±æ€§çš„åŒ…è£…ã€‚


## è¡¨å•å¤„ç†

Link ç»„ä»¶ç”¨äºæ­£å¸¸çš„ç”¨æˆ·ç‚¹å‡»è·³è½¬ï¼Œä½†æ˜¯æœ‰æ—¶è¿˜éœ€è¦è¡¨å•è·³è½¬ã€ç‚¹å‡»æŒ‰é’®è·³è½¬ç­‰æ“ä½œã€‚è¿™äº›æƒ…å†µæ€ä¹ˆè·ŸReact Routerå¯¹æ¥å‘¢ï¼Ÿ

	<form onSubmit={this.handleSubmit}>
	  <input type="text" placeholder="userName"/>
	  <input type="text" placeholder="repo"/>
	  <button type="submit">Go</button>
	</form>

ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨`browserHistory.push`

	import { browserHistory } from 'react-router'

	// ...
	  handleSubmit(event) {
	    event.preventDefault()
	    const userName = event.target.elements[0].value
	    const repo = event.target.elements[1].value
	    const path = `/repos/${userName}/${repo}`
	    browserHistory.push(path)
	  },

ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨contextå¯¹è±¡ã€‚

	export default React.createClass({

	  // ask for `router` from context
	  contextTypes: {
	    router: React.PropTypes.object
	  },

	  handleSubmit(event) {
	    // ...
	    this.context.router.push(path)
	  },
	})


## è·¯ç”±çš„é’©å­

æ¯ä¸ªè·¯ç”±éƒ½æœ‰ Enter å’Œ Leave é’©å­ï¼Œç”¨æˆ·è¿›å…¥æˆ–ç¦»å¼€è¯¥è·¯ç”±æ—¶è§¦å‘ã€‚

	<Route path="inbox" component={Inbox}>
	  <Route
	    path="messages/:id"
	    onEnter={
	      ({params}, replace) => replace(`/messages/${params.id}`)
	    } 
	  />
	</Route>

onEnteré’©å­è¿˜å¯ä»¥ç”¨æ¥åšè®¤è¯ã€‚

	const requireAuth = (nextState, replace) => {
	    if (!auth.isAdmin()) {
	        // Redirect to Home page if not an Admin
	        replace({ pathname: '/' })
	    }
	}
	export const AdminRoutes = () => {
	  return (
	     <Route path="/admin" component={Admin} onEnter={requireAuth} />
	  )
	}

ä¸‹é¢æ˜¯ä¸€ä¸ªé«˜çº§åº”ç”¨ï¼Œå½“ç”¨æˆ·ç¦»å¼€ä¸€ä¸ªè·¯å¾„çš„æ—¶å€™ï¼Œè·³å‡ºä¸€ä¸ªæç¤ºæ¡†ï¼Œè¦æ±‚ç”¨æˆ·ç¡®è®¤æ˜¯å¦ç¦»å¼€ã€‚

	const Home = withRouter(
	  React.createClass({
	    componentDidMount() {
	      this.props.router.setRouteLeaveHook(
	        this.props.route, 
	        this.routerWillLeave
	      )
	    },

	    routerWillLeave(nextLocation) {
	      // è¿”å› false ä¼šç»§ç»­åœç•™å½“å‰é¡µé¢ï¼Œ
	      // å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šæ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œè®©å…¶è‡ªå·±å†³å®š
	      if (!this.state.isSaved)
	        return 'ç¡®è®¤è¦ç¦»å¼€ï¼Ÿ';
	    },
	  })
	)

ä¸Šé¢ä»£ç ä¸­ï¼ŒsetRouteLeaveHookæ–¹æ³•ä¸ºLeaveé’©å­æŒ‡å®šrouterWillLeaveå‡½æ•°ã€‚è¯¥æ–¹æ³•å¦‚æœè¿”å›falseï¼Œå°†é˜»æ­¢è·¯ç”±çš„åˆ‡æ¢ï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæç¤ºç”¨æˆ·å†³å®šæ˜¯å¦è¦åˆ‡æ¢ã€‚



# âš‘  SCSS & SASS Color é¢œè‰²å‡½æ•°ç”¨æ³•
[SCSS Tutorial](http://www.softwhy.com/article-8800-1.html)

CSS ä¸æ˜¯ä¸€ç§çœŸæ­£æ„ä¹‰ä¸Šçš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸å…·æœ‰ç¼–ç¨‹è¯­è¨€çš„å˜é‡ã€å¾ªç¯ã€éå†å’Œç»§æ‰¿ç­‰ç‰¹æ€§ã€‚ ä¸ºäº†è§£å†³ CSS çš„è¿™äº›ç¼ºç‚¹ï¼Œèƒ½å¤Ÿå¯¹ CSS è¿›è¡Œé¢„å¤„ç†çš„"ä¸­é—´è¯­è¨€"å°±äº§ç”Ÿäº†ï¼Œä»¥æ­¤æ¥å®ç°æŸäº›ç¼–ç¨‹ç‰¹æ€§ã€‚ 

SASS æ˜¯æœ€æ—©çš„ CSS é¢„å¤„ç†è¯­è¨€ä¹‹ä¸€ã€‚ ä¸ºäº†é€‚åº”ç¼–ç¨‹é£æ ¼çš„éœ€æ±‚ï¼ŒSASS åœ¨ç¼–ç¨‹é£æ ¼ä¸Šåšäº†ä¸€äº›ä¿®æ”¹ï¼Œç°åœ¨ç§°ä¹‹ä¸º SCSSï¼Œå¢åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œå¢å¼ºäº†å¯¹ CSS3 çš„æ”¯æŒï¼Œå…¶è¯­æ³•å®Œå…¨å…¼å®¹ CSS3ï¼Œå¹¶ä¸”ç»§æ‰¿äº† SASS çš„å¼ºå¤§åŠŸèƒ½ã€‚

ä»»ä½•æ ‡å‡†çš„ CSS3 æ ·å¼è¡¨éƒ½æ˜¯å…·æœ‰ç›¸åŒè¯­ä¹‰çš„æœ‰æ•ˆçš„ SCSS æ–‡ä»¶ã€‚å¦å¤–ï¼ŒSCSS è¿˜èƒ½è¯†åˆ«å¤§éƒ¨åˆ† css hacks å’Œç‰¹å®šäºæµè§ˆå™¨çš„è¯­æ³•ï¼Œä¾‹å¦‚:å¤è€çš„ IE filterã€‚ç”±äº SCSS æ˜¯ CSS çš„æ‰©å±•ï¼Œå› æ­¤ï¼Œæ‰€æœ‰åœ¨ CSS ä¸­å·¥ä½œçš„ä»£ç ä¹Ÿèƒ½åœ¨ SCSS ä¸­æ­£å¸¸å·¥ä½œã€‚

SASS æ˜¯æœ€åˆå®šä¹‰çš„è¯­æ³•ï¼Œä¸€ä¸ªä¸»è¦çš„ç‰¹å¾æ˜¯å¯¹ç¼©è¿›æ•æ„Ÿã€‚

ä¸è¿‡å¾ˆå¿«ï¼Œå¼€å‘è€…å†³å®šé‡‡ç”¨ä¸€ç§å«åš SCSS çš„è¯­æ³•ï¼Œå¼±åŒ–äº† SASS ä¸ CSS ä¹‹é—´çš„è¯­æ³•åŒºåˆ«ã€‚

SASS ä»£ç å¦‚ä¸‹:

	#sidebar
	  width: 30%
	  background-color: #faa

è€Œ SCSS ä½¿ç”¨æ›´ä¸ºæ¥è¿‘ CSS çš„è¯­æ³•æ ¼å¼:

	#sidebar {
	  width: 30%;
	  background-color: #faa;
	}

åªè¦æ·»åŠ å¤§æ‹¬å·å’Œåˆ†å·å°±å¯ä»¥è½¬æ¢ä¸º SCSSã€‚

åŒæ—¶ SCSS å¯¹ç©ºç™½ç¬¦ä¸æ•æ„Ÿï¼Œä¸Šé¢çš„ä»£ç è¿˜å¯ä»¥ä¿®æ”¹ä¸ºå¦‚ä¸‹æ ¼å¼:

	#sidebar {
		width: 30%; 
		background-color: #faa
	}

SCSS å‡½æ•°è¯­æ³•å‚è€ƒï¼š


	rgb($red,$green,$blue)
	rgba($red,$green,$blue,$alpha)

	red($color)
	green($color)
	blue($color)

	mix($color-1,$color-2,[$weight])

	hsl($hue,$saturation,$lightness)
	hsla($hue,$saturation,$lightness,$alpha)

	saturation($color)
	lightness($color)
	adjust-hue($color,$degrees)
	lighten($color,$amount)
	darken($color,$amount)

	alpha($color)
	opacity($color)

	rgba($color,$alpha)
	opacify($color, $amount) / fade-in($color, $amount) å‡å°é€æ˜åº¦
	transparentize($color, $amount) / fade-out($color, $amount) å¢åŠ é€æ˜åº¦




## rgba() 

èƒ½çœæ‰æ‰‹å·¥è½¬æ¢ hex åˆ° rgb æ ¼å¼çš„å·¥ä½œï¼Œå¦‚ä»¥ä¸‹ SCSS ä»£ç 

	$linkColor: #20a0ff;

	.box{
	  box-shadow: 0 2px 6px 0 rgba($linkColor, 0.3);
	  background-color: $linkColor;
	}

ç”Ÿæˆçš„ CSS ä»£ç 

	.box{
	  box-shadow:0 2px 6px 0 rgba(32,160,255,.3);
	  background-color:#20a0ff;
	}

è¿˜å¯ä»¥é€šè¿‡ opacify å¢åŠ ï¼Œé€šè¿‡ transparentize æ¥å‡å°‘é€æ˜åº¦å€¼ï¼Œå¦‚ï¼š

	>> opacify(rgba(125,125,125, 0.6), 0.2)
	rgba(125,125,125, 0.8)

	>> transparentize(green, 0.5)
	rgba(0, 255, 0, 0.5)
	 

## lighten / darken / saturate / desaturate 

lighten / darken æ˜¯åŸºäº HSL æ˜åº¦å˜æ¢ï¼Œè¿™ä¸ªæ¯”è¾ƒé€‚åˆ button æŒ‰é’®çš„ normal æ€å’Œ hover æ€å˜æ¢ï¼Œ

saturate / desaturate æ˜¯åŸºäº HSL é¥±å’Œåº¦ å˜æ¢ï¼Œ

æ•ˆæœå¯ä»¥å‚è€ƒè¿™ä¸ªåœ¨çº¿å·¥å…· http://scg.ar-ch.org/

ç„¶è€Œç”Ÿæˆçš„é¢œè‰²å¾ˆä¸‘ï¼Œä¸å®ç”¨ã€‚

 

## tint / shade

é˜¿é‡Œçš„ Ant Design æ—©æœŸç‰ˆæœ¬ä½¿ç”¨äº† tint / shade è‰²å½©ç®—æ³•ï¼Œé€šè¿‡å¢åŠ  ç™½è‰²ï¼ˆtintï¼‰ å’Œ é»‘è‰²ï¼ˆshadeï¼‰ çš„å æ¯”æ¥ç”Ÿæˆç³»åˆ—è‰²ã€‚

	.demo{
	  tint( $base-color, 10% )
	  shade( $base-color, 10% )
	}


è¿™ä¸ªåœ¨é¡¹ç›®ä¸­ä¼šæ›´åŠ å®ç”¨ï¼Œä¸è¿‡è¦æ³¨æ„æ–°ç”Ÿæˆçš„é¢œè‰²ä¸æ–‡æœ¬å¯¹æ¯”åº¦éœ€æ»¡è¶³ WCAG 2.0 å¯¹æ¯”åº¦è¦æ±‚ã€‚

åœ¨çº¿ checkerï¼šhttp://webaim.org/resources/contrastchecker/

 
## complement è¡¥è‰²

åœ¨è‰²å½©ç†è®ºä¸­ï¼Œå¦‚æœä¸€ç§é¢œè‰²ä¸å¦ä¸€ç§é¢œè‰²æ··åˆåï¼Œå‘ˆç°ä¸­æ€§çš„ç°é»‘è‰²ï¼Œé‚£ä¹ˆè¿™ä¸¤ç§é¢œè‰²å°±äº’ä¸ºè¡¥è‰²ã€‚

å¥½è±åç”µå½±æ¯”è¾ƒå¸¸ç”¨è¡¥è‰²åæœŸæ‰‹æ³•ï¼Œå¼ºçƒˆçš„äº’è¡¥è‰²å¯¹æ¯”ï¼Œèƒ½æ¸²æŸ“å‡ºæ¯”è¾ƒå†²å‡»çš„è§†è§‰ç³»æ°›å›´ã€‚å¦‚ä¸‹å›¾ã€Šå¤©ä½¿çˆ±ç¾ä¸½ã€‹æµ·æŠ¥çš„çº¢ç»¿äº’è¡¥ã€‚




# âš‘ momentjs æ—¥æœŸå¤„ç†åŒ…
[momentjs](http://momentjs.com/)

è·å–æ—¶é—´ Start of Time

moment().startOf(String)

	moment().startOf('day')  // è·å–ä»Šå¤©0æ—¶0åˆ†0ç§’
	moment().startOf('week')  // è·å–æœ¬å‘¨ç¬¬ä¸€å¤©(å‘¨æ—¥)0æ—¶0åˆ†0ç§’
	moment().startOf('isoWeek')  // è·å–æœ¬å‘¨å‘¨ä¸€0æ—¶0åˆ†0ç§’
	moment().startOf('month')  // è·å–å½“å‰æœˆç¬¬ä¸€å¤©0æ—¶0åˆ†0ç§’

moment().endOf(String)

	moment().endOf('day')  // è·å–ä»Šå¤©23æ—¶59åˆ†59ç§’
	moment().endOf('week')  // è·å–æœ¬å‘¨æœ€åä¸€å¤©(å‘¨å…­)23æ—¶59åˆ†59ç§’
	moment().endOf('isoWeek')  // è·å–æœ¬å‘¨å‘¨æ—¥23æ—¶59åˆ†59ç§’
	moment().endOf('month')  // è·å–å½“å‰æœˆæœ€åä¸€å¤©23æ—¶59åˆ†59ç§’

Days in Month

moment().daysInMonth()

	moment().daysInMonth() // è·å–å½“å‰æœˆçš„æ€»å¤©æ•°

Timestamp 

	moment().format('X') // è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ è·å–æ—¶é—´æˆ³(ä»¥ç§’ä¸ºå•ä½)
	moment().unix() // è¿”å›å€¼ä¸ºæ•°å€¼å‹
	moment().format('x') // è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ è·å–æ—¶é—´æˆ³(ä»¥æ¯«ç§’ä¸ºå•ä½)
	moment().valueOf() // è¿”å›å€¼ä¸ºæ•°å€¼å‹

Get Time

	moment().year()  // è·å–å¹´ä»½
	moment().get('year')
	moment().month() (0~11, 0: January, 11: December)  // è·å–æœˆä»½
	moment().get('month')
	moment().date()  // è·å–ä¸€ä¸ªæœˆä¸­çš„æŸä¸€å¤©
	moment().get('date')

	moment().day() (0~6, 0: Sunday, 6: Saturday) // è·å–ä¸€ä¸ªæ˜ŸæœŸä¸­çš„æŸä¸€å¤©
	moment().weekday() (0~6, 0: Sunday, 6: Saturday)
	moment().isoWeekday() (1~7, 1: Monday, 7: Sunday)
	moment().get('day')
	mment().get('weekday')
	moment().get('isoWeekday')

	moment().hours() // è·å–å°æ—¶
	moment().get('hours')
	moment().minutes() // è·å–åˆ†é’Ÿ
	moment().get('minutes')
	moment().seconds() // è·å–ç§’æ•°
	moment().get('seconds')
	moment().toArray() // [years, months, date, hours, minutes, seconds, milliseconds]
	moment().toObject() // {years: xxxx, months: x, date: xx ...}

è®¾ç½®æ—¶é—´ Set Time

	moment().year(Number), moment().month(Number)...
	moment().set(String, Int)
	moment().set(Object)
	moment().year(2019) // è®¾ç½®å¹´ä»½
	moment().set('year', 2019)
	moment().set({year: 2019})
	moment().month(11) (0~11, 0: January, 11: December)  // è®¾ç½®æœˆä»½
	moment().set('month', 11) 
	moment().date(15)  /// è®¾ç½®æŸä¸ªæœˆä¸­çš„æŸä¸€å¤©
	moment().set('date', 15)
	moment().weekday(0) // è®¾ç½®æ—¥æœŸä¸ºæœ¬å‘¨ç¬¬ä¸€å¤©ï¼ˆå‘¨æ—¥ï¼‰
	moment().isoWeekday(1) // è®¾ç½®æ—¥æœŸä¸ºæœ¬å‘¨å‘¨ä¸€
	moment().set('weekday', 0)
	moment().set('isoWeekday', 1)
	moment().hours(12)  // è®¾ç½®å°æ—¶
	moment().set('hours', 12)
	moment().minutes(30)  // è®¾ç½®åˆ†é’Ÿ
	moment().set('minutes', 30)
	moment().seconds(30)  // è®¾ç½®ç§’æ•°
	moment().set('seconds', 30)

Add Time

	moment().add(Number, String)
	moment().add(Object)
	moment().add(1, 'years')  // è®¾ç½®å¹´ä»½
	moment().add({years: 1})
	moment().add(1, 'months')  // è®¾ç½®æœˆä»½
	moment().add(1, 'days')  // è®¾ç½®æ—¥æœŸ
	moment().add(1, 'weeks')  // è®¾ç½®æ˜ŸæœŸ
	moment().add(1, 'hours')  // è®¾ç½®å°æ—¶
	moment().add(1, 'minutes')  // è®¾ç½®åˆ†é’Ÿ
	moment().add(1, 'seconds')  // è®¾ç½®ç§’æ•°

Subtract Time

	moment().subtract(Number, String)
	moment().subtract(Object)
	moment().subtract(1, 'years')  // è®¾ç½®å¹´ä»½
	moment().subtract({years: 1})
	moment().subtract(1, 'months')  // è®¾ç½®æœˆä»½
	moment().subtract(1, 'days')  // è®¾ç½®æ—¥æœŸ
	moment().subtract(1, 'weeks')  // è®¾ç½®æ˜ŸæœŸ
	moment().subtract(1, 'hours')  // è®¾ç½®å°æ—¶
	moment().subtract(1, 'minutes')  // è®¾ç½®åˆ†é’Ÿ
	moment().subtract(1, 'seconds')  // è®¾ç½®ç§’æ•°

æ ¼å¼åŒ–æ—¶é—´ Format Time

	moment().format()
	moment().format(String)
	moment().format('YYYYå¹´MMæœˆDDæ—¥')  // æ ¼å¼åŒ–å¹´æœˆæ—¥ï¼š 'xxxxå¹´xxæœˆxxæ—¥'
	moment().format('YYYY-MM-DD')  // æ ¼å¼åŒ–å¹´æœˆæ—¥ï¼š 'xxxx-xx-xx'
	moment().format('HHæ—¶mmåˆ†ssç§’')  // æ ¼å¼åŒ–æ—¶åˆ†ç§’(24å°æ—¶åˆ¶)ï¼š 'xxæ—¶xxåˆ†xxç§’'
	moment().format('hh:mm:ss a') // æ ¼å¼åŒ–æ—¶åˆ†ç§’(12å°æ—¶åˆ¶)ï¼š'xx:xx:xx am/pm'
	moment().format('X') // è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ æ ¼å¼åŒ–æ—¶é—´æˆ³(ä»¥ç§’ä¸ºå•ä½)
	moment().format('x') // è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ æ ¼å¼åŒ–æ—¶é—´æˆ³(ä»¥æ¯«ç§’ä¸ºå•ä½)

æ¯”è¾ƒæ—¶é—´ Difference

	moment().diff(Moment|String|Number|Date|Array)

è·å–ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„æ—¶é—´å·®

	let start_date = moment().subtract(1, 'weeks')
	let end_date = moment()

	end_date.diff(start_date) // è¿”å›æ¯«ç§’æ•°

	end_date.diff(start_date, 'months') // 0
	end_date.diff(start_date, 'weeks') // 1
	end_date.diff(start_date, 'days') // 7
	start_date.diff(end_date, 'days') // -7

Formatting dates

	moment().format('MMMM Do YYYY, h:mm:ss a');
	moment().format('dddd');
	moment().format("MMM Do YY");
	moment().format('YYYY [escaped] YYYY');
	moment().format();

	April 17th 2013, 4:06:00 pm
	Wednesday
	Apr 17th 13
	2013 escaped 2013
	2013-04-17T16:06:00+08:00

Timeago

	moment("20111031", "YYYYMMDD").fromNow();
	moment("20120620", "YYYYMMDD").fromNow();
	moment().startOf('day').fromNow();
	moment().endOf('day').fromNow();
	moment().startOf('hour').fromNow();

	a year ago
	10 months ago
	16 hours ago
	in 8 hours
	6 minutes ago

Calendar Time

	moment().subtract('days', 10).calendar();
	moment().subtract('days', 6).calendar();
	moment().subtract('days', 3).calendar();
	moment().subtract('days', 1).calendar();
	moment().calendar();
	moment().add('days', 1).calendar();
	moment().add('days', 3).calendar();
	moment().add('days', 10).calendar();

	04/07/2013
	last Thursday at 4:06 PM
	last Sunday at 4:06 PM
	Yesterday at 4:06 PM
	Today at 4:06 PM
	Tomorrow at 4:06 PM
	Saturday at 4:06 PM
	04/27/2013


Internationalization

	moment().format('L');
	moment().format('LL');
	moment().format('LLL');
	moment().format('LLLL');

	04/17/2013
	April 17 2013
	April 17 2013 4:06 PM

Mutability

	var a = moment('2016-01-01'); 
	var b = a.clone().add(1, 'week'); 
	a.format();
	"2016-01-01T00:00:00-06:00"

datetime math

	moment('2016-03-12 13:00:00').add(1, 'day').format('LLL')
	"March 13, 2016 1:00 PM"

	moment('2016-03-12 13:00:00').add(24, 'hours').format('LLL')
	"March 13, 2016 2:00 PM"
	Due to leap years, one year may not equal 365 days:

	moment('2016-01-01').add(1, 'year').format('LL')
	"January 1, 2017"
	moment('2016-01-01').add(365, 'day').format('LL')
	"December 31, 2016"

	moment().add(1.5, 'days') == moment().add(2, 'days')
	moment().add(-1.5, 'days') == moment().add(-2, 'days') == moment().subtract(1.5, 'days') == moment().subtract(2, 'days')
	moment().add(2.3, 'months') == moment().add(2, 'months')
	moment().add(-2.3, 'months') == moment().add(-2, 'months') == moment().subtract(2.3, 'months') == moment().subtract(2, 'months')

Quarters and years are converted to months, and then absolute value/rounded.

	moment().add(1.5, 'years') == moment().add(18, 'months')
	moment().add(.8, 'years') == moment().add(9.6, 'months') == moment().add(10, 'months')
	moment().add(1.5, 'quarters') == moment().add(4.5, 'months') == moment().add(5, 'months')


è¿˜æœ‰å¤šç§è¯­è¨€å¯ä»¥é€‰æ‹©ï¼ˆåŒ…æ‹¬ç®€ä½“ä¸­æ–‡å’Œç¹ä½“ä¸­æ–‡å“¦ï¼‰

# âš‘ Path-to-regexp æ¨¡å—
[Path-to-regexp](https://www.npmjs.com/package/path-to-regexp)

	npm install path-to-regexp --save

è¯¥å¯¹è±¡ä¸ŠæŒ‚è½½äº† 3 ä¸ªæ–¹æ³•ï¼š

	var pathToRegexp, { parse, compile } = require('path-to-regexp')

	pathToRegexp(path, keys, options)
	pathToRegexp.parse(path)
	pathToRegexp.compile(path)


åŸºæœ¬å‚æ•°ä¸ºï¼š

+ path: è‡ªå®šä¹‰çš„åŒ¹é…è·¯ç”±
+ keys: é€šè¿‡åˆ†ç»„è·å¾—çš„ç›¸å…³å€¼
+ options: åŸºæœ¬åŒ¹é…é€‰é¡¹
+ sensitive: å¤§å°å†™ç²¾ç¡®åŒ¹é…ï¼ˆdefault: falseï¼Œä¸æ˜¯ï¼‰
+ strict: æœ«å°¾æ–œæ æ˜¯å¦ç²¾ç¡®åŒ¹é…ï¼ˆdefault: falseï¼Œä¸æ˜¯ï¼‰
+ end: æ˜¯å¦æ˜¯å…¨å±€åŒ¹é…ï¼Œç›¸å½“äºï¼Œå¸¦ä¸å¸¦ /g æ ‡è¯†ç¬¦ã€‚(defualt: trueï¼Œå¸¦ /g)ï¼Œ
+ delimiter: è®¾ç½®é‡å¤å‚æ•°çš„åˆ†å‰²ç¬¦ï¼Œé»˜è®¤ä¸º /ã€‚å¯¹äº pathname åŒ¹é…æ—¶ï¼Œä½¿ç”¨é»˜è®¤å°±å¥½ã€‚

ä¾‹å¦‚ï¼š

	var keys = []
	var re = pathToRegexp('/foo/:bar', keys)
	// re = /^\/foo\/([^\/]+?)\/?$/i
	// keys = [{ name: 'bar', prefix: '/', delimiter: '/', optional: false, repeat: false, pattern: '[^\\/]+?' }]

åŒ¹é…å‚æ•°ï¼Œåˆ†ç»„åå¯ä»¥é€šè¿‡å®ƒè‡ªå®šä¹‰çš„ç›¸å…³åŒ¹é…è¯­æ³•æ¥å®Œæˆã€‚

	var re = pathToRegexp('/:foo/:bar', keys)
	// keys = [{ name: 'foo', prefix: '/', ... }, { name: 'bar', prefix: '/', ... }]

	re.exec('/test/route')
	//=> ['/test/route', 'test', 'route']

é‚£ä¹ˆ keys ä¸­çš„ foo å°±æ˜¯ä¸€ä¸ªåˆ†ç»„åçš„åŒ¹é…å€¼ã€‚

æ­£åˆ™è¡¨è¾¾å¼é‡è¯å­—ç¬¦

å¯é€‰å‚æ•° ï¼Ÿ

	var re = pathToRegexp('/:foo/:bar?', keys)
	// keys = [{ name: 'foo', ... }, { name: 'bar', delimiter: '/', optional: true, repeat: false }]

	re.exec('/test')
	//=> ['/test', 'test', undefined]

	re.exec('/test/route')
	//=> ['/test', 'test', 'route']

åŒ¹é…ä»»æ„ä¸ª *

	var re = pathToRegexp('/:foo*', keys)
	// keys = [{ name: 'foo', delimiter: '/', optional: true, repeat: true }]

	re.exec('/')
	//=> ['/', undefined]

	re.exec('/bar/baz')
	//=> ['/bar/baz', 'bar/baz']

åŒ¹é…ä¸€ä¸ªä»¥ä¸Š +

	var re = pathToRegexp('/:foo+', keys)
	// keys = [{ name: 'foo', delimiter: '/', optional: false, repeat: true }]

	re.exec('/')
	//=> null

	re.exec('/bar/baz')
	//=> ['/bar/baz', 'bar/baz']

å¦‚æœæƒ³åŒ¹é…å¤šä¸ªè·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ * è¿›è¡ŒåŒ¹é…ï¼š

	var re = pathToRegexp('/foo/*', keys)
	// keys = [{ name: '0', ... }]

	re.exec('/foo/bar/baz')
	//=> ['/foo/bar/baz', 'bar/baz']

ä¸è¿‡æ³¨æ„ï¼Œ* å’Œ >=0 æ•ˆæœçš„åŒºåˆ«ï¼š

	var re = pathToRegexp('/:foo/(.*)', keys)
	// keys = [{ name: 'foo', ... }, { name: 0, ... }]

	re.exec('/test/route')
	//=> ['/test/route', 'test', 'route']


## Unnamed Parameters

It is possible to write an unnamed parameter that only consists of a matching group. It works the same as a named parameter, except it will be numerically indexed.

	const regexp = pathToRegexp('/:foo/(.*)')
	// keys = [{ name: 'foo', ... }, { name: 0, ... }]
	 
	regexp.exec('/test/route')
	//=> ['/test/route', 'test', 'route']


## Custom Matching Parameters

All parameters can have a custom regexp, which overrides the default match ([^/]+). For example, you can match digits or names in a path:

	const regexpNumbers = pathToRegexp('/icon-:foo(\\d+).png')
	// keys = [{ name: 'foo', ... }]
	 
	regexpNumbers.exec('/icon-123.png')
	//=> ['/icon-123.png', '123']
	 
	regexpNumbers.exec('/icon-abc.png')
	//=> null
	 
	const regexpWord = pathToRegexp('/(user|u)')
	// keys = [{ name: 0, ... }]
	 
	regexpWord.exec('/u')
	//=> ['/u', 'u']
	 
	regexpWord.exec('/users')
	//=> null

Tip: Backslashes need to be escaped with another backslash in JavaScript strings.

## Parse

The parse function is exposed via pathToRegexp.parse. This will return an array of strings and keys.

	const tokens = pathToRegexp.parse('/route/:foo/(.*)')
	 
	console.log(tokens[0])
	//=> "/route"
	 
	console.log(tokens[1])
	//=> { name: 'foo', prefix: '/', delimiter: '/', optional: false, repeat: false, pattern: '[^\\/]+?' }
	 
	console.log(tokens[2])
	//=> { name: 0, prefix: '/', delimiter: '/', optional: false, repeat: false, pattern: '.*' }

Note: This method only works with strings.

## Compile ("Reverse" Path-To-RegExp)

Path-To-RegExp exposes a compile function for transforming a string into a valid path.

	const toPath = pathToRegexp.compile('/user/:id')
	 
	toPath({ id: 123 }) //=> "/user/123"
	toPath({ id: 'cafÃ©' }) //=> "/user/caf%C3%A9"
	toPath({ id: '/' }) //=> "/user/%2F"
	 
	toPath({ id: ':/' }) //=> "/user/%3A%2F"
	toPath({ id: ':/' }, { encode: (value, token) => value }) //=> "/user/:/"
	 
	const toPathRepeated = pathToRegexp.compile('/:segment+')
	 
	toPathRepeated({ segment: 'foo' }) //=> "/foo"
	toPathRepeated({ segment: ['a', 'b', 'c'] }) //=> "/a/b/c"
	 
	const toPathRegexp = pathToRegexp.compile('/user/:id(\\d+)')
	 
	toPathRegexp({ id: 123 }) //=> "/user/123"
	toPathRegexp({ id: '123' }) //=> "/user/123"
	toPathRegexp({ id: 'abc' }) //=> Throws `TypeError`.
	Note: The generated function will throw on invalid input. It will do all necessary checks to ensure the generated path is valid. This method only works with strings.



# âš‘ React åŸä»£ç ç›®å½•ç»“æ„
- [React æºç è§£æä¹‹ ReactElement](https://www.jianshu.com/p/6c0ed359936d)
- [ã€ŠReactæºç è§£æã€‹](https://react.jokcy.me/)]
- [react16 æºç é˜…è¯»å­¦ä¹ è®°å½•](https://github.com/jsonz1993/react-source-learn/)

åœ¨ renderers ä¸­ï¼Œreconcilerï¼ˆåè°ƒå™¨ï¼‰æ˜¯æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒåŒ…å«Reactä¸­è‡ªå®šä¹‰ç»„ä»¶çš„å®ç°ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæœºåˆ¶ã€setStateæœºåˆ¶ã€DOM diffç®—æ³•ç­‰ã€‚

ä¸ºä»€ä¹ˆreconcileræ˜¯æ ¸å¿ƒï¼Ÿ

å› ä¸ºreconcileræ˜¯å®ç°Virtual DOMçš„æœ€ä¸»è¦ä»£ç ï¼šåœ¨webå¼€å‘ä¸­ï¼Œè¦å°†æ›´æ–°çš„æ•°æ®å®æ—¶ååº”åˆ°UIä¸Šï¼Œå°±ä¸å¯é¿å…çš„éœ€è¦å¯¹DOMè¿›è¡Œæ“ä½œï¼Œè€Œå¯¹DOMçš„å¤æ‚é¢‘ç¹çš„æ“ä½œå°†å¯¼è‡´å¼€é”€å·¨å¤§ã€æ€§èƒ½ä¸‹é™ã€‚ä¸ºæ­¤ï¼ŒReactå¼•å…¥äº†VirtualDOMæœºåˆ¶ï¼Œè¿™ä¹Ÿæ­£æ˜¯Reactçš„æ ¸å¿ƒä¸ç²¾é«“ã€‚

åœ¨åŸºäºReactè¿›è¡Œå¼€å‘æ—¶ï¼Œæ‰€æœ‰çš„DOMæ ‘éƒ½æ˜¯é€šè¿‡VirtualDOMåˆ›é€ çš„ã€‚Reactåœ¨VirtualDOMä¸Šå®ç°äº†DOM diffç®—æ³•ã€‚å½“æ•°æ®æ›´æ–°æ—¶ï¼Œä¼šé€šè¿‡è¯¥ç®—æ³•æ‰¾åˆ°éœ€è¦å˜æ›´çš„DOMèŠ‚ç‚¹ï¼Œå¹¶åªå¯¹å˜åŒ–çš„éƒ¨åˆ†è¿›è¡ŒDOMæ›´æ–°ï¼Œè€Œä¸æ˜¯é‡æ–°æ¸²æŸ“æ•´ä¸ªDOMæ ‘ã€‚

React ç»„ä»¶åŒ–ä¸æ¸²æŸ“å¹³å°æ˜¯åˆ†ç¦»çš„ï¼Œå¹³æ—¶æˆ‘ä»¬å†™Reactï¼Œéƒ½è¦å¼•å…¥å¤šä¸€ä¸ª 'react-dom'ï¼Œå°†ç»„ä»¶ReactElementé€šè¿‡ ReactDOM.render æ¸²æŸ“åˆ° DOM Tree ä¸­ã€‚

ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¼•å…¥çš„Reactè´Ÿè´£ReactElementç»„ä»¶ç›¸å…³çš„ä¸œè¥¿ï¼Œæ¸²æŸ“å±‚é¢æŠ½å‡ºæ¥äº¤ç»™ ReactDOMã€ ReactNativeï¼Œè¿™ç§åˆ†ç¦»è¿™ä¹Ÿèµ‹äºˆäº†Reactè·¨ç»ˆç«¯æ¸²æŸ“çš„èƒ½åŠ›ã€‚

ReactDOM.render é¦–å…ˆä¼šè°ƒç”¨ legacyCreateRootFromDOMContainer åˆ›å»ºä¸€ä¸ªReactRootçš„å®ä¾‹ï¼Œæˆ‘ä»¬å«ä»–rootã€‚è°ƒç”¨ requestCurrentTime è·å–å½“å‰å·²ç»èŠ±è´¹çš„æ—¶é—´ï¼Œ ç„¶åè°ƒç”¨computeExpirationForFiberæ¥ç¡®å®šæˆ‘ä»¬çš„ä¼˜å…ˆçº§ï¼Œ computeExpirationForFiber ä¼šæ ¹æ®æˆ‘ä»¬å½“å‰çš„å·¥ä½œç±»å‹ï¼Œæ¯”å¦‚isWorking, isCommit, isAsync ç­‰ç­‰æ¥è¿”å›å¯¹åº”çš„ä¼˜å…ˆçº§ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“é»˜è®¤éƒ½æ˜¯Syncçš„æƒ…å†µã€‚å¦‚æœä¸æ˜¯åŒæ­¥æ¸²æŸ“çš„æƒ…å†µï¼Œæ—¢Interactive æˆ–è€… Asyncï¼Œè¿™æ—¶å€™ä¼šæ ¹æ®æˆ‘ä»¬ å‰é¢requestCurrentTimeè·å–çš„å·²èŠ±è´¹æ—¶é—´ è°ƒç”¨ç›¸åº”çš„ç®—æ³•æ¥ç¡®å®šä¼˜å…ˆçº§ã€‚Reactçš„æ›´æ–°ä¼˜å…ˆçº§æœ‰ Syncã€Interactiveã€Asyncã€offscreenç­‰ç­‰ï¼Œå¯ä»¥ç»†åˆ†ï¼š

	synchronous ä¸ä¹‹å‰çš„Stack reconcileræ“ä½œä¸€æ ·ï¼ŒåŒæ­¥æ‰§è¡Œ
	task åœ¨next tickä¹‹å‰æ‰§è¡Œ
	animation ä¸‹ä¸€å¸§ä¹‹å‰æ‰§è¡Œ
	high åœ¨ä¸ä¹…çš„å°†æ¥ç«‹å³æ‰§è¡Œ
	low ç¨å¾®å»¶è¿Ÿï¼ˆ100-200msï¼‰æ‰§è¡Œä¹Ÿæ²¡å…³ç³»
	offscreen ä¸‹ä¸€æ¬¡renderæ—¶æˆ–scrollæ—¶æ‰æ‰§è¡Œ

React æ¸²æŸ“è¿‡ç¨‹å¤§æ¦‚å°±æ˜¯ JSX -> ReactElement -> ReactRoot -> fiberTreeRoot  -> DOM Treeã€‚



## EventBus

è¿˜æœ‰ä½¿ç”¨äº‹ä»¶æ€»çº¿æ¨¡å¼ä¹Ÿæ˜¯å¸¸ç”¨çš„è§£å†³åŠæ³•ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°éåµŒå¥—ç»„ä»¶é—´çš„é€šä¿¡ï¼Œéœ€è¦ä½¿ç”¨ events åŒ…ï¼š

	npm install events --save

æ–°å»ºä¸€ä¸ª EventBus.jsï¼Œå¼•å…¥ events åŒ…ï¼Œå¹¶å‘å¤–æä¾›ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œä¾›é€šä¿¡æ—¶ä½¿ç”¨ï¼š

	import { EventBus } from "events";
	export default new EventBus();

ç„¶åå°±æ˜¯ä½¿ç”¨äº‹ä»¶æ€»çº¿æ¥è¿›è¡Œå¤šæ–¹å‘çš„é€šè®¯ï¼Œéœ€è¦æ¥å—æ•°æ®æ–¹æ³¨å†Œäº‹ä»¶ç›‘å¬å‡½æ•°å¹¶è´Ÿè´£åœ¨ç»„ä»¶é”€æ¯æ—¶è§£é™¤ç›‘å¬å‡½æ•°ï¼Œéœ€è¦å‘é€æ•°æ®æ–¹è´Ÿè´£è§¦å‘äº‹ä»¶ï¼š

	import EventBus from "./EventBus"

	// æ³¨å†Œäº‹ä»¶ç›‘å¬å‡½æ•°
	EventBus.addListener("callMe",(msg)=>{
		this.setState({msg})
	});

	// ç»„ä»¶é”€æ¯å‰ç§»é™¤äº‹ä»¶ç›‘å¬
	EventBus.removeListener(handler...);

	// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
	EventBus.emit("callMe","Hello")

è‡ªå·±å®ç°ç»„ä»¶é—´çš„é€šä¿¡è¿˜æ˜¯å¤ªéš¾ä»¥ç®¡ç†äº†ï¼Œå› æ­¤å‡ºç°äº†å¾ˆå¤šçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¦‚ fluxã€redux ç­‰ï¼Œä½¿ç”¨è¿™äº›å·¥å…·ä½¿å¾—ç»„ä»¶é—´çš„é€šä¿¡æ›´å®¹æ˜“è¿½è¸ªå’Œç®¡ç†ã€‚

## åŒå…¶ä»–å¤–éƒ¨åº“é€šä¿¡

å¦‚æœä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ—¢æœ‰Reactï¼Œåˆæœ‰jQueryï¼Œåˆæœ‰Vueæ€ä¹ˆåŠï¼Ÿ

å¦‚æœæŠŠè¿™ä¸ªåœºæ™¯æŠ½è±¡ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸‰ç§ä¸åŒçš„ç»„ä»¶éœ€è¦ç›¸äº’é€šä¿¡ï¼Œå®ƒä»¬å¯¹æ•°æ®çš„è¦æ±‚ä¸ä¸€æ ·ï¼Œæ•°æ®æ ¼å¼ä¸åŒï¼Œä½†æ˜¯ä¸€æ—¦æ•°æ®æ‰“åˆ°å„è‡ªçš„ç»„ä»¶å†…ï¼Œå…¶å®æ•°æ®æµå°±ä¸éœ€è¦æˆ‘ä»¬å…³å¿ƒäº†ã€‚
æ‰€ä»¥å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå…¬å…±çš„æ•°æ®é›†å¸‚ï¼Œæ‰€æœ‰äººéƒ½ä»æ•°æ®é›†å¸‚é‡Œå–æ•°æ®ï¼Œä¹Ÿå‘æ•°æ®é›†å¸‚ä¸­å‘æ•°æ®ï¼Œæ•°æ®é›†å¸‚æ˜¯ä¸€ä¸ªå…¬å¼€çš„å‘å¸ƒè€…ï¼Œå„ç»„ä»¶ä¸ºè®¢é˜…è€…ã€‚

ä½†æ˜¯ç›®å‰ï¼Œåœ¨Reactä½“ç³»ä¸­ï¼ŒReduxæ˜¯ç»•ä¸å¼€çš„ã€‚



# âš‘ Events System
- [React Event Handling](https://react.docschina.org/docs/handling-events.html)
- [SyntheticEvent](https://reactjs.org/docs/events.html)
- [React Form](https://react.docschina.org/docs/forms.html)
- [Reactäº‹ä»¶æœºåˆ¶](https://zhuanlan.zhihu.com/p/49067231)
- [Reactåˆæˆäº‹ä»¶](https://react.docschina.org/docs/events.html)

reactçš„äº‹ä»¶æ˜¯åˆæˆäº‹ä»¶((Synethic event)ï¼Œä¸æ˜¯åŸç”Ÿäº‹ä»¶

	<button onClick={this.handleClick}></button> 
	<input value={this.state.name} onChange={this.handleChange} />

åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶çš„åŒºåˆ«

1. å†™æ³•ä¸åŒï¼Œåˆé€‚äº‹ä»¶æ˜¯é©¼å³°å†™æ³•ï¼Œè€ŒåŸç”Ÿäº‹ä»¶æ˜¯å…¨éƒ¨å°å†™
2. æ‰§è¡Œæ—¶æœºä¸åŒï¼Œåˆé€‚äº‹ä»¶å…¨éƒ¨å§”æ‰˜åˆ°documentä¸Šï¼Œè€ŒåŸç”Ÿäº‹ä»¶ç»‘å®šåˆ°DOMå…ƒç´ æœ¬èº«
3. åˆæˆäº‹ä»¶ä¸­å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œæ¯”å¦‚ `this.handleClick` è¿™ä¸ªå‡½æ•°ï¼Œè€ŒåŸç”Ÿäº‹ä»¶ä¸­åªèƒ½æ˜¯å­—ç¬¦ä¸²

Reactäº‹ä»¶å¹¶æ²¡æœ‰åŸç”Ÿçš„ç»‘å®šåœ¨çœŸå®çš„DOMä¸Šï¼Œè€Œæ˜¯ä½¿ç”¨äº†è¡Œä¸ºå§”æ‰˜æ–¹å¼å®ç°äº‹ä»¶æœºåˆ¶ã€‚

æµè§ˆå™¨äº‹ä»¶çš„è§¦å‘å®è´¨ä¸Šæ˜¯è¦ç»è¿‡ä¸‰ä¸ªé˜¶æ®µ:äº‹ä»¶æ•è·ã€ç›®æ ‡å¯¹è±¡æœ¬èº«çš„äº‹ä»¶å¤„ç†å’Œäº‹ä»¶å†’æ³¡ï¼Œå‡è®¾åœ¨ DOM å¯¹è±¡çš„ click äº‹ä»¶è§¦å‘äº†ï¼Œé¦–å…ˆç»å†æ•è·é˜¶æ®µä¼šç”±çˆ¶çº§å…ƒç´ å°†äº‹ä»¶ä¸€ç›´ä¼ é€’åˆ°äº‹ä»¶å‘ç”Ÿçš„å…ƒç´ ï¼Œæ‰§è¡Œå®Œç›®æ ‡äº‹ä»¶æœ¬èº«çš„å¤„ç†äº‹ä»¶åï¼Œç„¶åç»å†å†’æ³¡é˜¶æ®µï¼Œå°†äº‹ä»¶ä»å­å…ƒç´ å‘çˆ¶å…ƒç´ å†’æ³¡ã€‚æ­£å› ä¸ºäº‹ä»¶åœ¨DOMçš„ä¼ é€’ç»å†è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œä»è€Œä¸ºè¡Œä¸ºå§”æ‰˜æä¾›äº†å¯èƒ½ã€‚

é€šä¿—åœ°è®²ï¼Œè¡Œä¸ºå§”æ‰˜çš„å®è´¨å°±æ˜¯å°†å­å…ƒç´ äº‹ä»¶çš„å¤„ç†å§”æ‰˜ç»™çˆ¶çº§å…ƒç´ å¤„ç†ã€‚Reactä¼šå°†æ‰€æœ‰çš„äº‹ä»¶éƒ½ç»‘å®šåœ¨æœ€å¤–å±‚(document)ï¼Œä½¿ç”¨ç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬ï¼Œå¹¶åœ¨å†’æ³¡é˜¶æ®µå¤„ç†äº‹ä»¶ï¼Œå½“æŒ‚è½½æˆ–è€…å¸è½½ç»„ä»¶æ—¶ï¼Œåªéœ€è¦åœ¨é€šè¿‡çš„åœ¨ç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬ä½ç½®å¢åŠ æˆ–è€…åˆ é™¤å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥æé«˜æ•ˆç‡ã€‚

å¹¶ä¸”Reactå¹¶æ²¡æœ‰ä½¿ç”¨åŸç”Ÿçš„æµè§ˆå™¨äº‹ä»¶ï¼Œè€Œæ˜¯åœ¨åŸºäº Virtual DOM çš„åŸºç¡€ä¸Šå®ç°äº†åˆæˆäº‹ä»¶(SyntheticEvent)ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºæ¥æ”¶åˆ°çš„æ˜¯SyntheticEventçš„å®ä¾‹ã€‚SyntheticEventå®Œå…¨ç¬¦åˆW3Cçš„æ ‡å‡†ï¼Œå› æ­¤åœ¨äº‹ä»¶å±‚æ¬¡ä¸Šå…·æœ‰æµè§ˆå™¨å…¼å®¹æ€§ï¼Œä¸åŸç”Ÿçš„æµè§ˆå™¨äº‹ä»¶ä¸€æ ·æ‹¥æœ‰åŒæ ·çš„æ¥å£ï¼Œå¯ä»¥é€šè¿‡stopPropagation()å’ŒpreventDefault()ç›¸åº”çš„ä¸­æ–­ã€‚å¦‚æœéœ€è¦è®¿é—®å½“åŸç”Ÿçš„äº‹ä»¶å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨nativeEventè·å¾—ã€‚

Reactä¸­çš„äº‹ä»¶æœºåˆ¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:äº‹ä»¶æ³¨å†Œå’Œäº‹ä»¶è§¦å‘:

åœ¨ç»„ä»¶åŠ è½½ `mount` å’Œæ›´æ–° `update` æ—¶,å…¶ä¸­çš„ `ReactDOMComponent` ä¼šå¯¹ä¼ å…¥çš„äº‹ä»¶å±æ€§è¿›è¡Œå¤„ç†ï¼Œå¯¹ç›¸å…³äº‹ä»¶è¿›è¡Œæ³¨å†Œå’Œå­˜å‚¨ã€‚`document` ä¸­æ³¨å†Œçš„äº‹ä»¶ä¸å¤„ç†å…·ä½“çš„äº‹ä»¶ï¼Œä»…å¯¹äº‹ä»¶è¿›è¡Œåˆ†å‘ã€‚`ReactBrowserEventEmitter` ä½œä¸ºäº‹ä»¶æ³¨å†Œå…¥å£ï¼Œæ‹…è´Ÿç€äº‹ä»¶æ³¨å†Œå’Œäº‹ä»¶è§¦å‘ã€‚æ³¨å†Œäº‹ä»¶çš„å›è°ƒå‡½æ•°ç”± `EventPluginHub` æ¥ç»Ÿä¸€ç®¡ç†ï¼Œæ ¹æ®äº‹ä»¶çš„ç±»å‹å’Œç»„ä»¶æ ‡è¯† `_rootNodeID` ä¸ºå”¯ä¸€æ ‡è¯†äº‹ä»¶å¹¶è¿›è¡Œå­˜å‚¨ã€‚

äº‹ä»¶æ‰§è¡Œæ—¶ï¼Œ`document` ä¸Šç»‘å®šäº‹ä»¶ `ReactEventListener.dispatchEvent` ä¼šå¯¹äº‹ä»¶è¿›è¡Œåˆ†å‘ï¼Œæ ¹æ®ä¹‹å‰å­˜å‚¨çš„ç±»å‹å’Œç»„ä»¶æ ‡è¯†æ‰¾åˆ°è§¦å‘äº‹ä»¶çš„ç»„ä»¶ã€‚`ReactEventEmitter` åˆ©ç”¨ `EventPluginHub` ä¸­æ³¨å…¥çš„äº‹ä»¶æ’ä»¶ï¼Œä¾‹å¦‚:`SimpleEventPlugin`ã€`EnterLeaveEventPlugin` ä¼šå°†åŸç”Ÿçš„DOMäº‹ä»¶è½¬åŒ–æˆåˆæˆçš„äº‹ä»¶ï¼Œç„¶åæ‰¹é‡æ‰§è¡Œå­˜å‚¨çš„å›è°ƒå‡½ï¼Œå›è°ƒå‡½æ•°çš„æ‰§è¡Œåˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯å°†æ‰€æœ‰çš„åˆæˆäº‹ä»¶æ”¾åˆ°äº‹ä»¶é˜Ÿåˆ—é‡Œé¢ï¼Œç¬¬äºŒæ­¥æ˜¯é€ä¸ªæ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæµè§ˆå™¨åŸç”Ÿä¼šä¸ºæ¯ä¸ªäº‹ä»¶çš„æ¯ä¸ªç›‘å¬å‡½æ•°åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œå¯ä»¥ä»è¿™ä¸ªäº‹ä»¶å¯¹è±¡è·å–åˆ°äº‹ä»¶çš„å¼•ç”¨ã€‚è¿™ä¼šé€ æˆé«˜é¢çš„å†…å­˜åˆ†é…ï¼ŒReactåœ¨å¯åŠ¨æ—¶å°±ä¼šä¸ºæ¯ç§å¯¹è±¡åˆ†é…å†…å­˜æ± ï¼Œç”¨åˆ°æŸä¸€ä¸ªäº‹ä»¶å¯¹è±¡æ—¶å°±å¯ä»¥ä»è¿™ä¸ªå†…å­˜æ± è¿›è¡Œå¤ç”¨ï¼ŒèŠ‚çœå†…å­˜ã€‚

	handleClick(e) {
	    if (e.target && e.target.matches('div.code')) {
	      return;
	    }
	    let event = e.nativeEvent;
	    let dom = e.target;
	    e.stopPropagation();
	    e.preventDefault();
	}

## Keyboard API 

å½“æˆ‘ä»¬ç‚¹å‡»è¾“å…¥æ¡†æ—¶ï¼Œæ‰‹æœºçš„è½¯é”®ç›˜ä¼šè‡ªåŠ¨å¼¹å‡ºï¼Œä»¥ä¾¿ç”¨æˆ·è¿›è¡Œè¾“å…¥ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬æƒ³åœ¨é”®ç›˜å¼¹å‡ºæ—¶å¯¹é¡µé¢å¸ƒå±€åšä¸ªè°ƒæ•´ï¼Œæˆ–è€…åœ¨ç¨‹åºä¸­ä½¿ç”¨ä»£ç æ”¶èµ·è¿™ä¸ªè½¯é”®ç›˜ï¼Œè¿™äº›å€ŸåŠ© React Native æ¡†æ¶æä¾›çš„Keyboard API å°±å¯ä»¥å®ç°ã€‚

Keyboard API æä¾›å¦‚ä¸‹çš„é™æ€å‡½æ•°ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚

`addListener(eventName, callback)` è¿™ä¸ªå‡½æ•°ç”¨æ¥åŠ è½½ä¸€ä¸ªæŒ‡å®šäº‹ä»¶çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œå‡½æ•°ä¸­çš„ eventName å¯ä»¥æ˜¯å¦‚ä¸‹å€¼ï¼š

	keyboardWillShowï¼šè½¯é”®ç›˜å°†è¦æ˜¾ç¤º
	keyboardDidShowï¼šè½¯é”®ç›˜æ˜¾ç¤ºå®Œæ¯•
	keyboardWillHideï¼šè½¯é”®ç›˜å°†è¦æ”¶èµ·
	keyboardDidHideï¼šè½¯é”®ç›˜æ”¶èµ·å®Œæ¯•
	keyboardWillChangeFrameï¼šè½¯ä»¶ç›˜çš„ frame å°†è¦æ”¹å˜
	keyboardDidChangeFrameï¼šè½¯ä»¶ç›˜çš„ frame æ”¹å˜å®Œæ¯•

è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä¿å­˜è¿™ä¸ªå¯¹è±¡ï¼Œåœ¨éœ€è¦é‡Šæ”¾äº‹ä»¶ç›‘å¬å™¨æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ remove æ–¹æ³•ã€‚

`removeListener(eventName, callback)` è¿™ä¸ªå‡½æ•°ç”¨æ¥é‡Šæ”¾ä¸€ä¸ªç‰¹å®šçš„é”®ç›˜äº‹ä»¶ç›‘å¬å™¨ã€‚

`removeAllListener(eventName)` è¿™ä¸ªå‡½æ•°ç”¨æ¥é‡Šæ”¾ä¸€ä¸ªæŒ‡å®šé”®ç›˜äº‹ä»¶çš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ã€‚

`dissmiss()` è¿™ä¸ªæ–¹æ³•è®©æ“ä½œç³»ç»Ÿæ”¶èµ·è½¯é”®ç›˜ã€‚

æ‰€æœ‰çš„é”®ç›˜äº‹ä»¶å¤„ç†å‡½æ•°éƒ½èƒ½æ”¶åˆ°ä¸€ä¸ª event å‚æ•°ï¼Œä¸è¿‡åœ¨ä¸åŒå¹³å°ä¸‹ event å‚æ•°å¯ä»¥å–åˆ°çš„å€¼ä¸å¤ªä¸€æ ·ã€‚

1ï¼ŒAndroid å¹³å°å¯ä»¥å–åˆ°çš„å€¼

	event.endCoordinates.screenX
	event.endCoordinates.screenY
	event.endCoordinates.width
	event.endCoordinates.height

2ï¼ŒiOS å¹³å°å¯ä»¥å–åˆ°çš„å€¼

	event.easingï¼šè¿™ä¸ªå€¼å§‹ç»ˆæ˜¯ keyboard
	evnet.durationï¼šè®°å½•è½¯é”®ç›˜å¼¹å‡ºåŠ¨ç”»çš„æŒç»­äº‹ä»¶ï¼Œå•ä½æ˜¯æ¯«ç§’
	event.startCoordinates.screenX
	event.startCoordinates.screenY
	event.startCoordinates.width
	event.startCoordinates.height
	event.endCoordinates.screenX
	event.endCoordinates.screenY
	event.endCoordinates.width
	event.endCoordinates.height


# âš‘ React AJAX æœ€ä½³å®è·µ

## Root Component æ ¹ç»„ä»¶æ–¹æ³•
https://facebook.github.io/react/tutorial/tutorial.html

è¿™æ˜¯ä¸€ç§æœ€ç®€å•çš„æ–¹æ³•ï¼Œå› æ­¤å®ƒé€‚ç”¨äºç®€å•æˆ–å°å‹çš„åº”ç”¨ã€‚

é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œä½ å¯ä»¥å»ºç«‹å•ä¸€æ ¹ç»„ä»¶ï¼ˆçˆ¶å±‚ç»„ä»¶ï¼‰å»åˆ†å‘æ‰€æœ‰AJAXè¯·æ±‚ï¼Œç„¶åå®ƒä¼šæŠŠAJAXå“åº”æ•°æ®å­˜å‚¨è¿›stateé‡Œï¼Œä»¥propsæ–¹å¼ä¼ é€’åˆ°å­ç»„ä»¶ã€‚å¯ä»¥å‚è€ƒä¸‹å®˜æ–¹æ•™ç¨‹ä¸Šçš„å®ä¾‹ã€‚

æ­¤å®ä¾‹ä¸­çš„ CommentBox ç»„ä»¶å°±æ˜¯ä¸ªåˆ†å‘æ‰€æœ‰AJAXè¯·æ±‚çš„æ ¹ç»„ä»¶ã€‚

ä¸è¿‡ï¼Œæˆ‘ä¸å¤§å–œæ¬¢å®˜æ–¹æ•™ç¨‹å®ä¾‹ä¸­çš„ä¸€ç‚¹ï¼šå®ƒä½¿ç”¨äº†jQueryå»å‘é€AJAXè¯·æ±‚ã€‚

	loadCommentsFromServer: function() {
	    $.ajax({
	        url: this.props.url,
	        dataType: 'json',
	        cache: false,
	        success: function(data) {
	            this.setState({data: data});   // æ³¨æ„è¿™é‡Œ
	        }.bind(this),
	        error: function(xhr, status, err) {
	            console.error(this.props.url, status, err.toString());
	        }.bind(this)
	    });
	}


## fetch() API
https://github.com/github/fetch

Fetch æ˜¯ä¸ªæ–°çš„ã€ç®€å•çš„ã€æ ‡å‡†åŒ–çš„APIï¼Œæ—¨åœ¨ç»Ÿä¸€Webé€šä¿¡æœºåˆ¶ï¼Œå¹¶æ›¿ä»£ XMLHttpRequestã€‚å®ƒå·²ç»è¢«ä¸»æµæµè§ˆå™¨æ‰€æ”¯æŒï¼Œé’ˆå¯¹è¾ƒæ—§çš„æµè§ˆå™¨ä¹Ÿæœ‰äº†ä¸€ä¸ª polyfill ï¼ˆBenzä¹±å…¥ï¼špolyfill ç›´è¯‘æ˜¯å¡«å……å·¥å…·ï¼Œå°±æ˜¯æ—§æµè§ˆå™¨æœ¬æ¥ä¸æ”¯æŒæŸä¸ªæ–°çš„ JS APIï¼Œå¼•å…¥ä¸€æ®µjsä»£ç åå°±æ”¯æŒäº†ï¼Œè¿™ä¸€æ®µjsä»£ç ç»™æ—§æµè§ˆå™¨â€å¡«å……â€œäº†ä¸€ä¸ªAPIã€‚è¿™ä¸ªå•è¯æˆ‘å®åœ¨ä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ ï¼Œæ„Ÿè§‰åè€Œä¿ç•™åŸå•è¯ä¸ç¿»è¯‘æ›´èƒ½è®©è¯»è€…ç†è§£ã€‚ï¼‰ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ Node.js ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ node-fetch æ¥ä½¿ Node.js æ”¯æŒ Fetchã€‚

å½“å‘ç”Ÿè·¨åŸŸè¯·æ±‚æ—¶ï¼Œfetch ä¼šå…ˆå‘é€ä¸€ä¸ª OPTIONS è¯·æ±‚ï¼Œæ¥ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦å…è®¸æ¥å—è¯·æ±‚ã€‚æœåŠ¡å™¨åŒæ„åï¼Œæ‰ä¼šå‘é€çœŸæ­£çš„è¯·æ±‚ã€‚


è‹¥æŠŠä¸Šè¿°ç”¨ jQuery $.ajax çš„ä»£ç æ®µæ”¹æˆ fetch å®ç°çš„è¯ï¼Œä»£ç åº”è¯¥é•¿è¿™æ ·å­ï¼š

	loadCommentsFromServer: function() {
	    fetch(this.props.url).then(function(response){
	        // åœ¨è¿™å„¿å®ç° setState
	    });
	}    

	// Post form
	var form = document.querySelector('form')

	fetch('/users', {
	  method: 'POST',
	  body: new FormData(form)
	})

	// Post JSON
	fetch('/users', {
	  method: 'POST',
	  headers: {
	    'Content-Type': 'application/json'
	  },
	  body: JSON.stringify({
	    name: 'Hubot',
	    login: 'hubot',
	  })
	})

	// get json
	fetch('/users.json')
	  .then(function(response) {
	    // return response.text()
	    // return response.blob()
	    return response.json()
	  }).then(function(json) {
	    console.log('parsed json', json)
	  }).catch(function(ex) {
	    console.log('parsing failed', ex)
	  })
	}

	// File upload
	var input = document.querySelector('input[type="file"]')

	var data = new FormData()
	data.append('file', input.files[0])
	data.append('user', 'hubot')

	fetch('/avatars', {
	  method: 'POST',
	  body: data
	})


## Axios 
https://github.com/axios/axios

Axios æ˜¯ä¸€ä¸ªåŸºäº promise å¯¹è±¡ï¼ˆBenz ä¹±å…¥ï¼šè¿™ä¸ªé“¾æ¥ä¹Ÿæ˜¯æˆ‘åŠ çš„ï¼‰çš„ HTTP å®¢æˆ·ç«¯ã€‚ä¸ fetch å’Œ superagent ä¸€æ ·ï¼Œå®ƒåŒæ—¶æ”¯æŒæµè§ˆå™¨ç«¯å’Œ Node.js ç«¯ã€‚å¦å¤–ä½ å¯ä»¥åœ¨å…¶ Github ä¸»é¡µä¸Šå‘ç°ï¼Œå®ƒæœ‰å¾ˆå¤šå¾ˆå®ç”¨çš„é«˜çº§åŠŸèƒ½ã€‚

è¿™æ˜¯ Axios çš„å¤§æ¦‚ç”¨æ³•ï¼š

	loadCommentsFromServer: function() {
	    axios.get(this.props.url).then(function(response){
	        // åœ¨è¿™å„¿å®ç° setState
	    }).catch(function(error){
	        // å¤„ç†è¯·æ±‚å‡ºé”™çš„æƒ…å†µ
	    });
	}

## Request
https://github.com/request/request

è‹¥ä¸ä»‹ç»è¿™ä¸ª request åº“ï¼Œæ„Ÿè§‰ä¸Šæœ¬æ–‡ä¼šä¸å¤ªå®Œæ•´ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨æ€æƒ³ä¸Šè¿½æ±‚æç®€è®¾è®¡çš„JSåº“ï¼Œåœ¨ Github ä¸Šæ‹¥æœ‰è¶…è¿‡ 12k çš„ star ï¼ˆBenz ä¹±å…¥ï¼šæˆ‘ç¿»è¯‘è¿™æ–‡ç« æ—¶å·²ç» 16k+ star äº†ï¼‰ã€‚å®ƒä¹Ÿæ˜¯æœ€æµè¡Œçš„ Node.js æ¨¡å—ä¹‹ä¸€ã€‚è¿›å…¥å®ƒçš„ GitHub ä¸»é¡µ äº†è§£æ›´å¤šã€‚

ç”¨æ³•ç¤ºä¾‹ï¼š

	loadCommentsFromServer: function() {
	    request(this.props.url, function(err, response, body){
	        // åœ¨è¿™å„¿å®ç° setState
	    });
	}

# âš‘ React.Component API

æœ¬ç« èŠ‚æä¾›äº† React class ç»„ä»¶çš„è¯¦ç»† API å‚è€ƒã€‚æœ¬ç« èŠ‚é»˜è®¤ä½ å·²ç†Ÿæ‚‰åŸºæœ¬çš„ React æ¦‚å¿µï¼Œä¾‹å¦‚ ç»„ä»¶ & Propsï¼Œä»¥åŠ State & ç”Ÿå‘½å‘¨æœŸç­‰ã€‚å¦‚æœä½ è¿˜æœªç†Ÿæ‚‰ï¼Œè¯·å…ˆé˜…è¯»ä¹‹å‰ç« èŠ‚è¿›è¡Œå­¦ä¹ ã€‚

React çš„ç»„ä»¶å¯ä»¥å®šä¹‰ä¸º class æˆ–å‡½æ•°çš„å½¢å¼ã€‚class ç»„ä»¶ç›®å‰æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å°†åœ¨æ­¤ç« èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚å¦‚éœ€å®šä¹‰ class ç»„ä»¶ï¼Œéœ€è¦ç»§æ‰¿ React.Componentï¼š

	class Welcome extends React.Component {
	  render() {
	    return <h1>Hello, {this.props.name}</h1>;
	  }
	}

åœ¨ React.Component çš„å­ç±»ä¸­æœ‰ä¸ªå¿…é¡»å®šä¹‰çš„ render() å‡½æ•°ã€‚æœ¬ç« èŠ‚ä»‹ç»å…¶ä»–æ–¹æ³•å‡ä¸ºå¯é€‰ã€‚

æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ä¸è¦åˆ›å»ºè‡ªå·±çš„ç»„ä»¶åŸºç±»ã€‚ åœ¨ React ç»„ä»¶ä¸­ï¼Œä»£ç é‡ç”¨çš„ä¸»è¦æ–¹å¼æ˜¯ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿ã€‚

æ³¨æ„:

React å¹¶ä¸ä¼šå¼ºåˆ¶ä½ ä½¿ç”¨ ES6 çš„ class è¯­æ³•ã€‚å¦‚æœä½ å€¾å‘äºä¸ä½¿ç”¨å®ƒï¼Œä½ å¯ä»¥ä½¿ç”¨ create-react-class æ¨¡å—æˆ–ç±»ä¼¼çš„è‡ªå®šä¹‰æŠ½è±¡æ¥ä»£æ›¿ã€‚è¯·æŸ¥é˜…ä¸ä½¿ç”¨ ES6 äº†è§£æ›´å¤šã€‚

ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ
æ¯ä¸ªç»„ä»¶éƒ½åŒ…å«â€œç”Ÿå‘½å‘¨æœŸæ–¹æ³•â€ï¼Œä½ å¯ä»¥é‡å†™è¿™äº›æ–¹æ³•ï¼Œä»¥ä¾¿äºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç‰¹å®šçš„é˜¶æ®µæ‰§è¡Œè¿™äº›æ–¹æ³•ã€‚ä½ å¯ä»¥ä½¿ç”¨æ­¤ç”Ÿå‘½å‘¨æœŸå›¾è°±ä½œä¸ºé€ŸæŸ¥è¡¨ã€‚åœ¨ä¸‹è¿°åˆ—è¡¨ä¸­ï¼Œå¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¼šè¢«åŠ ç²—ã€‚å…¶ä½™ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ä½¿ç”¨åˆ™ç›¸å¯¹ç½•è§ã€‚

å½“ç»„ä»¶å®ä¾‹è¢«åˆ›å»ºå¹¶æ’å…¥ DOM ä¸­æ—¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸè°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼š

	constructor()
	static getDerivedStateFromProps()
	render()
	componentDidMount()


æ³¨æ„:ä¸‹è¿°ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å³å°†è¿‡æ—¶ï¼Œåœ¨æ–°ä»£ç ä¸­åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ï¼š

	UNSAFE_componentWillMount()

å½“ç»„ä»¶çš„ props æˆ– state å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘æ›´æ–°ã€‚ç»„ä»¶æ›´æ–°çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼š

	static getDerivedStateFromProps()
	shouldComponentUpdate()
	render()
	getSnapshotBeforeUpdate()
	componentDidUpdate()

æ³¨æ„:ä¸‹è¿°æ–¹æ³•å³å°†è¿‡æ—¶ï¼Œåœ¨æ–°ä»£ç ä¸­åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ï¼š

	UNSAFE_componentWillUpdate()
	UNSAFE_componentWillReceiveProps()

å½“ç»„ä»¶ä» DOM ä¸­ç§»é™¤æ—¶ä¼šè°ƒç”¨å¦‚ä¸‹å¸è½½æ–¹æ³•ï¼š

	componentWillUnmount()

å½“æ¸²æŸ“è¿‡ç¨‹ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œæˆ–å­ç»„ä»¶çš„æ„é€ å‡½æ•°ä¸­æŠ›å‡ºé”™è¯¯æ—¶ï¼Œä¼šè°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œå…¶ä¸­ componentDidCatch æ˜¯ ErrorBoundary é”™è¯¯æ•æ‰ï¼š

	static getDerivedStateFromError()
	componentDidCatch(err, info)

ç»„ä»¶è¿˜æä¾›äº†ä¸€äº›é¢å¤–çš„ APIï¼š

	setState()
	forceUpdate()

class å±æ€§

	defaultProps
	displayName

å®ä¾‹å±æ€§

	props
	state

## render()

	render()

render() æ–¹æ³•æ˜¯ class ç»„ä»¶ä¸­å”¯ä¸€å¿…é¡»å®ç°çš„æ–¹æ³•ã€‚

å½“ render è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ this.props å’Œ this.state çš„å˜åŒ–å¹¶è¿”å›ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š

* React å…ƒç´ ã€‚é€šå¸¸é€šè¿‡ JSX åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œ`<div />`ã€ `<MyComponent />` ä¼šè¢« React åˆ†åˆ«æ¸²æŸ“ä¸º DOM èŠ‚ç‚¹ã€è‡ªå®šä¹‰ç»„ä»¶ï¼Œå®ƒä»¬å‡ä¸º React å…ƒç´ ï¼Œå¯ä»¥ç›¸äº’åµŒå¥—ã€‚
* æ•°ç»„æˆ– fragmentsã€‚ ä½¿å¾— render æ–¹æ³•å¯ä»¥è¿”å›å¤šä¸ªå…ƒç´ ã€‚æ¬²äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… fragments æ–‡æ¡£ã€‚
* Portalsã€‚å¯ä»¥æ¸²æŸ“å­èŠ‚ç‚¹åˆ°ä¸åŒçš„ DOM å­æ ‘ä¸­ã€‚
* å­—ç¬¦ä¸²æˆ–æ•°å€¼ç±»å‹ã€‚å®ƒä»¬åœ¨ DOM ä¸­ä¼šè¢«æ¸²æŸ“ä¸ºæ–‡æœ¬èŠ‚ç‚¹
* å¸ƒå°”ç±»å‹æˆ– nullã€‚ä»€ä¹ˆéƒ½ä¸æ¸²æŸ“ã€‚ï¼ˆä¸»è¦ç”¨äºæ”¯æŒè¿”å› test && `<Child />` çš„æ¨¡å¼ï¼Œå…¶ä¸­ test ä¸ºå¸ƒå°”ç±»å‹ã€‚)

render() å‡½æ•°åº”è¯¥ä¸ºçº¯å‡½æ•°ï¼Œè¿™æ„å‘³ç€åœ¨ä¸ä¿®æ”¹ç»„ä»¶ state çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶éƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œå¹¶ä¸”å®ƒä¸ä¼šç›´æ¥ä¸æµè§ˆå™¨äº¤äº’ã€‚

å¦‚éœ€ä¸æµè§ˆå™¨è¿›è¡Œäº¤äº’ï¼Œè¯·åœ¨ componentDidMount() æˆ–å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ‰§è¡Œä½ çš„æ“ä½œã€‚ä¿æŒ render() ä¸ºçº¯å‡½æ•°ï¼Œå¯ä»¥ä½¿ç»„ä»¶æ›´å®¹æ˜“æ€è€ƒã€‚

æ³¨æ„

å¦‚æœ shouldComponentUpdate() è¿”å› falseï¼Œåˆ™ä¸ä¼šè°ƒç”¨ render()ã€‚


## constructor()

	constructor(props)

å¦‚æœä¸åˆå§‹åŒ– state æˆ–ä¸è¿›è¡Œæ–¹æ³•ç»‘å®šï¼Œåˆ™ä¸éœ€è¦ä¸º React ç»„ä»¶å®ç°æ„é€ å‡½æ•°ã€‚

åœ¨ React ç»„ä»¶æŒ‚è½½ä¹‹å‰ï¼Œä¼šè°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°ã€‚åœ¨ä¸º React.Component å­ç±»å®ç°æ„é€ å‡½æ•°æ—¶ï¼Œåº”åœ¨å…¶ä»–è¯­å¥ä¹‹å‰å‰è°ƒç”¨ super(props)ã€‚å¦åˆ™ï¼Œthis.props åœ¨æ„é€ å‡½æ•°ä¸­å¯èƒ½ä¼šå‡ºç°æœªå®šä¹‰çš„ bugã€‚

é€šå¸¸ï¼Œåœ¨ React ä¸­ï¼Œæ„é€ å‡½æ•°ä»…ç”¨äºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š

+ é€šè¿‡ç»™ this.state èµ‹å€¼å¯¹è±¡æ¥åˆå§‹åŒ–å†…éƒ¨ stateã€‚
+ ä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ç»‘å®šå®ä¾‹

åœ¨ constructor() å‡½æ•°ä¸­ä¸è¦è°ƒç”¨ setState() æ–¹æ³•ã€‚å¦‚æœä½ çš„ç»„ä»¶éœ€è¦ä½¿ç”¨å†…éƒ¨ stateï¼Œè¯·ç›´æ¥åœ¨æ„é€ å‡½æ•°ä¸­ä¸º this.state èµ‹å€¼åˆå§‹ stateï¼š

	constructor(props) {
	  super(props);
	  // ä¸è¦åœ¨è¿™é‡Œè°ƒç”¨ this.setState()
	  this.state = { counter: 0 };
	  this.handleClick = this.handleClick.bind(this);
	}

åªèƒ½åœ¨æ„é€ å‡½æ•°ä¸­ç›´æ¥ä¸º this.state èµ‹å€¼ã€‚å¦‚éœ€åœ¨å…¶ä»–æ–¹æ³•ä¸­èµ‹å€¼ï¼Œä½ åº”ä½¿ç”¨ this.setState() æ›¿ä»£ã€‚

è¦é¿å…åœ¨æ„é€ å‡½æ•°ä¸­å¼•å…¥ä»»ä½•å‰¯ä½œç”¨æˆ–è®¢é˜…ã€‚å¦‚é‡åˆ°æ­¤åœºæ™¯ï¼Œè¯·å°†å¯¹åº”çš„æ“ä½œæ”¾ç½®åœ¨ componentDidMount ä¸­ã€‚

æˆå‘˜å‡½æ•°ç»‘å®šå®ä¾‹åæ‰å¯ä»¥ä½¿ç”¨ `setStae()`ï¼Œå¹¶ä¸”é€šè¿‡ this.state è®¿é—®çŠ¶æ€æ•°æ®ã€‚æ²¡æœ‰ç»‘å®šåˆ°å®ä¾‹æ—¶ï¼Œthis æŒ‡å‘ç»„ä»¶çš„ state å¯¹è±¡ã€‚

æ³¨æ„

é¿å…å°† props çš„å€¼å¤åˆ¶ç»™ stateï¼è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ï¼š

	constructor(props) {
	 super(props);
	 // ä¸è¦è¿™æ ·åš
	 this.state = { color: props.color };
	}

å¦‚æ­¤åšæ¯«æ— å¿…è¦ï¼ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ this.props.colorï¼‰ï¼ŒåŒæ—¶è¿˜äº§ç”Ÿäº† bugï¼ˆæ›´æ–° prop ä¸­çš„ color æ—¶ï¼Œå¹¶ä¸ä¼šå½±å“ stateï¼‰ã€‚

åªæœ‰åœ¨ä½ åˆ»æ„å¿½ç•¥ prop æ›´æ–°çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚æ­¤æ—¶ï¼Œåº”å°† prop é‡å‘½åä¸º initialColor æˆ– defaultColorã€‚å¿…è¦æ—¶ï¼Œä½ å¯ä»¥ä¿®æ”¹å®ƒçš„ keyï¼Œä»¥å¼ºåˆ¶â€œé‡ç½®â€å…¶å†…éƒ¨ stateã€‚

è¯·å‚é˜…å…³äºé¿å…æ´¾ç”ŸçŠ¶æ€çš„åšæ–‡ï¼Œä»¥äº†è§£å‡ºç° state ä¾èµ– props çš„æƒ…å†µè¯¥å¦‚ä½•å¤„ç†ã€‚


## componentDidMount()

	componentDidMount()
	
componentDidMount() ä¼šåœ¨ç»„ä»¶æŒ‚è½½åï¼ˆæ’å…¥ DOM æ ‘ä¸­ï¼‰ç«‹å³è°ƒç”¨ã€‚ä¾èµ–äº DOM èŠ‚ç‚¹çš„åˆå§‹åŒ–åº”è¯¥æ”¾åœ¨è¿™é‡Œã€‚å¦‚éœ€é€šè¿‡ç½‘ç»œè¯·æ±‚è·å–æ•°æ®ï¼Œæ­¤å¤„æ˜¯å®ä¾‹åŒ–è¯·æ±‚çš„å¥½åœ°æ–¹ã€‚

è¿™ä¸ªæ–¹æ³•æ˜¯æ¯”è¾ƒé€‚åˆæ·»åŠ è®¢é˜…çš„åœ°æ–¹ã€‚å¦‚æœæ·»åŠ äº†è®¢é˜…ï¼Œè¯·ä¸è¦å¿˜è®°åœ¨ componentWillUnmount() é‡Œå–æ¶ˆè®¢é˜…

ä½ å¯ä»¥åœ¨ componentDidMount() é‡Œå¯ä»¥ç›´æ¥è°ƒç”¨ setState()ã€‚å®ƒå°†è§¦å‘é¢å¤–æ¸²æŸ“ï¼Œä½†æ­¤æ¸²æŸ“ä¼šå‘ç”Ÿåœ¨æµè§ˆå™¨æ›´æ–°å±å¹•ä¹‹å‰ã€‚å¦‚æ­¤ä¿è¯äº†å³ä½¿åœ¨ render() ä¸¤æ¬¡è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°ä¸­é—´çŠ¶æ€ã€‚è¯·è°¨æ…ä½¿ç”¨è¯¥æ¨¡å¼ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚é€šå¸¸ï¼Œä½ åº”è¯¥åœ¨ constructor() ä¸­åˆå§‹åŒ– stateã€‚å¦‚æœä½ çš„æ¸²æŸ“ä¾èµ–äº DOM èŠ‚ç‚¹çš„å¤§å°æˆ–ä½ç½®ï¼Œæ¯”å¦‚å®ç° modals å’Œ tooltips ç­‰æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ­¤æ–¹å¼å¤„ç†



## componentDidUpdate()

	componentDidUpdate(prevProps, prevState, snapshot)

componentDidUpdate() ä¼šåœ¨æ›´æ–°åä¼šè¢«ç«‹å³è°ƒç”¨ã€‚é¦–æ¬¡æ¸²æŸ“ä¸ä¼šæ‰§è¡Œæ­¤æ–¹æ³•ã€‚

å½“ç»„ä»¶æ›´æ–°åï¼Œå¯ä»¥åœ¨æ­¤å¤„å¯¹ DOM è¿›è¡Œæ“ä½œã€‚å¦‚æœä½ å¯¹æ›´æ–°å‰åçš„ props è¿›è¡Œäº†æ¯”è¾ƒï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åœ¨æ­¤å¤„è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚ï¼ˆä¾‹å¦‚ï¼Œå½“ props æœªå‘ç”Ÿå˜åŒ–æ—¶ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼‰ã€‚

	componentDidUpdate(prevProps) {
	  // å…¸å‹ç”¨æ³•ï¼ˆä¸è¦å¿˜è®°æ¯”è¾ƒ propsï¼‰ï¼š
	  if (this.props.userID !== prevProps.userID) {
	    this.fetchData(this.props.userID);
	  }
	}

ä½ ä¹Ÿå¯ä»¥åœ¨ componentDidUpdate() ä¸­ç›´æ¥è°ƒç”¨ setState()ï¼Œä½†è¯·æ³¨æ„å®ƒå¿…é¡»è¢«åŒ…è£¹åœ¨ä¸€ä¸ªæ¡ä»¶è¯­ä»¶é‡Œï¼Œæ­£å¦‚ä¸Šè¿°çš„ä¾‹å­é‚£æ ·è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚å®ƒè¿˜ä¼šå¯¼è‡´é¢å¤–çš„é‡æ–°æ¸²æŸ“ï¼Œè™½ç„¶ç”¨æˆ·ä¸å¯è§ï¼Œä½†ä¼šå½±å“ç»„ä»¶æ€§èƒ½ã€‚ä¸è¦å°† props â€œé•œåƒâ€ç»™ stateï¼Œè¯·è€ƒè™‘ç›´æ¥ä½¿ç”¨ propsã€‚ æ¬²äº†è§£æ›´å¤šæœ‰å…³å†…å®¹ï¼Œè¯·å‚é˜…ä¸ºä»€ä¹ˆ props å¤åˆ¶ç»™ state ä¼šäº§ç”Ÿ bugã€‚

å¦‚æœç»„ä»¶å®ç°äº† getSnapshotBeforeUpdate() ç”Ÿå‘½å‘¨æœŸï¼ˆä¸å¸¸ç”¨ï¼‰ï¼Œåˆ™å®ƒçš„è¿”å›å€¼å°†ä½œä¸º componentDidUpdate() çš„ç¬¬ä¸‰ä¸ªå‚æ•° â€œsnapshotâ€ å‚æ•°ä¼ é€’ã€‚å¦åˆ™æ­¤å‚æ•°å°†ä¸º undefinedã€‚

æ³¨æ„

å¦‚æœ shouldComponentUpdate() è¿”å›å€¼ä¸º falseï¼Œåˆ™ä¸ä¼šè°ƒç”¨ componentDidUpdate()ã€‚



## componentWillUnmount()

	componentWillUnmount()

componentWillUnmount() ä¼šåœ¨ç»„ä»¶å¸è½½åŠé”€æ¯ä¹‹å‰ç›´æ¥è°ƒç”¨ã€‚åœ¨æ­¤æ–¹æ³•ä¸­æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œï¼Œä¾‹å¦‚ï¼Œæ¸…é™¤ timerï¼Œå–æ¶ˆç½‘ç»œè¯·æ±‚æˆ–æ¸…é™¤åœ¨ componentDidMount() ä¸­åˆ›å»ºçš„è®¢é˜…ç­‰ã€‚

componentWillUnmount() ä¸­ä¸åº”è°ƒç”¨ setState()ï¼Œå› ä¸ºè¯¥ç»„ä»¶å°†æ°¸è¿œä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚ç»„ä»¶å®ä¾‹å¸è½½åï¼Œå°†æ°¸è¿œä¸ä¼šå†æŒ‚è½½å®ƒã€‚


## setState()

	setState(updater[, callback])

setState() å°†å¯¹ç»„ä»¶ state çš„æ›´æ”¹æ’å…¥é˜Ÿåˆ—ï¼Œå¹¶é€šçŸ¥ React éœ€è¦ä½¿ç”¨æ›´æ–°åçš„ state é‡æ–°æ¸²æŸ“æ­¤ç»„ä»¶åŠå…¶å­ç»„ä»¶ã€‚å°† setState() è§†ä¸ºè¯·æ±‚è€Œä¸æ˜¯ç«‹å³æ›´æ–°ç»„ä»¶çš„å‘½ä»¤ã€‚ä¸ºäº†æ›´å¥½çš„æ„ŸçŸ¥æ€§èƒ½ï¼ŒReact ä¼šå»¶è¿Ÿè°ƒç”¨å®ƒï¼Œç„¶åé€šè¿‡ä¸€æ¬¡ä¼ é€’æ›´æ–°å¤šä¸ªç»„ä»¶ã€‚React å¹¶ä¸ä¼šä¿è¯ state çš„å˜æ›´ä¼šç«‹å³ç”Ÿæ•ˆã€‚

setState() å¹¶ä¸æ€»æ˜¯ç«‹å³æ›´æ–°ç»„ä»¶ã€‚å®ƒä¼šæ‰¹é‡æ¨è¿Ÿæ›´æ–°ã€‚è¿™ä½¿å¾—åœ¨è°ƒç”¨ setState() åç«‹å³è¯»å– this.state æˆä¸ºäº†éšæ‚£ã€‚ä¸ºäº†æ¶ˆé™¤éšæ‚£ï¼Œè¯·ä½¿ç”¨ componentDidUpdate æˆ–è€…çš„å›è°ƒå‡½æ•° `callback`ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä¿è¯åœ¨åº”ç”¨æ›´æ–°åè§¦å‘ã€‚å¦‚éœ€åŸºäºä¹‹å‰çš„ state æ¥è®¾ç½®å½“å‰çš„ stateï¼Œè¯·é˜…è¯»ä¸‹è¿°å…³äºå‚æ•° `updater` çš„å†…å®¹ã€‚

é™¤é shouldComponentUpdate() è¿”å› falseï¼Œå¦åˆ™ setState() å°†å§‹ç»ˆæ‰§è¡Œé‡æ–°æ¸²æŸ“æ“ä½œã€‚å¦‚æœå¯å˜å¯¹è±¡è¢«ä½¿ç”¨ï¼Œä¸”æ— æ³•åœ¨ shouldComponentUpdate() ä¸­å®ç°æ¡ä»¶æ¸²æŸ“ï¼Œé‚£ä¹ˆä»…åœ¨æ–°æ—§çŠ¶æ€ä¸ä¸€æ—¶è°ƒç”¨ setState()å¯ä»¥é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

å‚æ•°ä¸€ä¸ºå¸¦æœ‰å½¢å¼å‚æ•°çš„ `updater` å‡½æ•°ï¼š

	(state, props) => stateChange

state æ˜¯å¯¹åº”ç”¨å˜åŒ–æ—¶ç»„ä»¶çŠ¶æ€çš„å¼•ç”¨ã€‚å½“ç„¶ï¼Œå®ƒä¸åº”ç›´æ¥è¢«ä¿®æ”¹ã€‚ä½ åº”è¯¥ä½¿ç”¨åŸºäº state å’Œ props æ„å»ºçš„æ–°å¯¹è±¡æ¥è¡¨ç¤ºå˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³æ ¹æ® props.step æ¥å¢åŠ  stateï¼š

	this.setState((state, props) => {
	  return {counter: state.counter + props.step};
	});

`updater` å‡½æ•°ä¸­æ¥æ”¶çš„ state å’Œ props éƒ½ä¿è¯ä¸ºæœ€æ–°ã€‚`updater` çš„è¿”å›å€¼ä¼šä¸ state è¿›è¡Œæµ…åˆå¹¶ã€‚

setState() çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå®ƒå°†åœ¨ setState å®Œæˆåˆå¹¶å¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶åæ‰§è¡Œã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ componentDidUpdate() æ¥ä»£æ›¿æ­¤æ–¹å¼ã€‚

setState() çš„ç¬¬ä¸€ä¸ªå‚æ•°é™¤äº†æ¥å—å‡½æ•°å¤–ï¼Œè¿˜å¯ä»¥æ¥å—å¯¹è±¡ç±»å‹ï¼š

	setState(stateChange[, callback])

stateChange ä¼šå°†ä¼ å…¥çš„å¯¹è±¡æµ…å±‚åˆå¹¶åˆ°æ–°çš„ state ä¸­ï¼Œä¾‹å¦‚ï¼Œè°ƒæ•´è´­ç‰©è½¦å•†å“æ•°ï¼š

	this.setState({quantity: 2})

è¿™ç§å½¢å¼çš„ setState() ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”åœ¨åŒä¸€å‘¨æœŸå†…ä¼šå¯¹å¤šä¸ª setState è¿›è¡Œæ‰¹å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨åŒä¸€å‘¨æœŸå†…å¤šæ¬¡è®¾ç½®å•†å“æ•°é‡å¢åŠ ï¼Œåˆ™ç›¸å½“äºï¼š

	Object.assign(
	  previousState,
	  {quantity: state.quantity + 1},
	  {quantity: state.quantity + 1},
	  ...
	)

åè°ƒç”¨çš„ setState() å°†è¦†ç›–åŒä¸€å‘¨æœŸå†…å…ˆè°ƒç”¨ setState çš„å€¼ï¼Œå› æ­¤å•†å“æ•°ä»…å¢åŠ ä¸€æ¬¡ã€‚å¦‚æœåç»­çŠ¶æ€å–å†³äºå½“å‰çŠ¶æ€ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ updater å‡½æ•°çš„å½¢å¼ä»£æ›¿ï¼š

	this.setState((state) => {
	  return {quantity: state.quantity + 1};
	});


## forceUpdate()

	component.forceUpdate(callback)

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç»„ä»¶çš„ state æˆ– props å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»„ä»¶å°†é‡æ–°æ¸²æŸ“ã€‚å¦‚æœ render() æ–¹æ³•ä¾èµ–äºå…¶ä»–æ•°æ®ï¼Œåˆ™å¯ä»¥è°ƒç”¨ forceUpdate() å¼ºåˆ¶è®©ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

è°ƒç”¨ forceUpdate() å°†è‡´ä½¿ç»„ä»¶è°ƒç”¨ render() æ–¹æ³•ï¼Œæ­¤æ“ä½œä¼šè·³è¿‡è¯¥ç»„ä»¶çš„ shouldComponentUpdate()ã€‚ä½†å…¶å­ç»„ä»¶ä¼šè§¦å‘æ­£å¸¸çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒåŒ…æ‹¬ shouldComponentUpdate() æ–¹æ³•ã€‚å¦‚æœæ ‡è®°å‘ç”Ÿå˜åŒ–ï¼ŒReact ä»å°†åªæ›´æ–° DOMã€‚

é€šå¸¸ä½ åº”è¯¥é¿å…ä½¿ç”¨ forceUpdate()ï¼Œå°½é‡åœ¨ render() åªä½¿ç”¨ this.props å’Œ this.state



## defaultProps ç»„ä»¶å®ä¾‹å±æ€§

defaultProps å¯ä»¥ä¸º Class ç»„ä»¶æ·»åŠ é»˜è®¤ propsã€‚è¿™ä¸€èˆ¬ç”¨äº props æœªèµ‹å€¼ï¼Œä½†åˆä¸èƒ½ä¸º null çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š

	class CustomButton extends React.Component {
	  // ...
	}

	CustomButton.defaultProps = {
	  color: 'blue'
	};

å¦‚æœæœªæä¾› props.colorï¼Œåˆ™é»˜è®¤è®¾ç½®ä¸º 'blue'

	render() {
	  return <CustomButton /> ; // props.color å°†è®¾ç½®ä¸º 'blue'
	}

å¦‚æœ props.color è¢«è®¾ç½®ä¸º nullï¼Œåˆ™å®ƒå°†ä¿æŒä¸º null

	render() {
	  return <CustomButton color={null} /> ; // props.color å°†ä¿æŒæ˜¯ null
	}


## displayName ç»„ä»¶å®ä¾‹å±æ€§

displayName å­—ç¬¦ä¸²å¤šç”¨äºè°ƒè¯•æ¶ˆæ¯ã€‚é€šå¸¸ï¼Œä½ ä¸éœ€è¦è®¾ç½®å®ƒï¼Œå› ä¸ºå®ƒå¯ä»¥æ ¹æ®å‡½æ•°ç»„ä»¶æˆ– class ç»„ä»¶çš„åç§°æ¨æ–­å‡ºæ¥ã€‚å¦‚æœè°ƒè¯•æ—¶éœ€è¦æ˜¾ç¤ºä¸åŒçš„åç§°æˆ–åˆ›å»ºé«˜é˜¶ç»„ä»¶ï¼Œè¯·å‚é˜…ä½¿ç”¨ displayname è½»æ¾è¿›è¡Œè°ƒè¯•äº†è§£æ›´å¤šã€‚



## props ç»„ä»¶å®ä¾‹å±æ€§

this.props åŒ…æ‹¬è¢«è¯¥ç»„ä»¶è°ƒç”¨è€…å®šä¹‰çš„ propsã€‚æ¬²äº†è§£ props çš„è¯¦ç»†ä»‹ç»ï¼Œè¯·å‚é˜…ç»„ä»¶ & Propsã€‚

éœ€ç‰¹åˆ«æ³¨æ„ï¼Œthis.props.children æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ propï¼Œé€šå¸¸ç”± JSX è¡¨è¾¾å¼ä¸­çš„å­ç»„ä»¶ç»„æˆï¼Œè€Œéç»„ä»¶æœ¬èº«å®šä¹‰ã€‚

## state ç»„ä»¶å®ä¾‹å±æ€§

ç»„ä»¶ä¸­çš„ state åŒ…å«äº†éšæ—¶å¯èƒ½å‘ç”Ÿå˜åŒ–çš„æ•°æ®ã€‚state ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€š JavaScript å¯¹è±¡ã€‚

å¦‚æœæŸäº›å€¼æœªç”¨äºæ¸²æŸ“æˆ–æ•°æ®æµï¼ˆä¾‹å¦‚ï¼Œè®¡æ—¶å™¨ IDï¼‰ï¼Œåˆ™ä¸å¿…å°†å…¶è®¾ç½®ä¸º stateã€‚æ­¤ç±»å€¼å¯ä»¥åœ¨ç»„ä»¶å®ä¾‹ä¸Šå®šä¹‰ã€‚

æ¬²äº†è§£å…³äº state çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… State & ç”Ÿå‘½å‘¨æœŸã€‚

æ°¸è¿œä¸è¦ç›´æ¥æ”¹å˜ this.stateï¼Œå› ä¸ºåç»­è°ƒç”¨çš„ setState() å¯èƒ½ä¼šæ›¿æ¢æ‰ä½ çš„æ”¹å˜ã€‚è¯·æŠŠ this.state çœ‹ä½œæ˜¯ä¸å¯å˜çš„ã€‚



# âš‘ React Top-Level API
- https://reactjs.org/docs/react-api.html#reactjs.org\content\docs\reference-react.md


## React API Overview

- Components {#components}

	- [`React.Component`](#reactcomponent)
	- [`React.PureComponent`](#reactpurecomponent)

	- [`React.memo`](#reactmemo)

- Creating React Elements {#creating-react-elements}

	- [`createElement()`](#createelement)
	- [`createFactory()`](#createfactory)

- Transforming Elements {#transforming-elements}

	- [`cloneElement()`](#cloneelement)
	- [`isValidElement()`](#isvalidelement)
	- [`React.Children`](#reactchildren)

- Fragments {#fragments}

	- [`React.Fragment`](#reactfragment)

- Refs {#refs}

	- [`React.createRef`](#reactcreateref)
	- [`React.forwardRef`](#reactforwardref)

- Suspense {#suspense}

	- [`React.lazy`](#reactlazy)
	- [`React.Suspense`](#reactsuspense)

- Hooks {#hooks}

	- [Basic Hooks](/docs/hooks-reference.html#basic-hooks)
	  - [`useState`](/docs/hooks-reference.html#usestate)
	  - [`useEffect`](/docs/hooks-reference.html#useeffect)
	  - [`useContext`](/docs/hooks-reference.html#usecontext)
	- [Additional Hooks](/docs/hooks-reference.html#additional-hooks)
	  - [`useReducer`](/docs/hooks-reference.html#usereducer)
	  - [`useCallback`](/docs/hooks-reference.html#usecallback)
	  - [`useMemo`](/docs/hooks-reference.html#usememo)
	  - [`useRef`](/docs/hooks-reference.html#useref)
	  - [`useImperativeHandle`](/docs/hooks-reference.html#useimperativehandle)
	  - [`useLayoutEffect`](/docs/hooks-reference.html#uselayouteffect)
	  - [`useDebugValue`](/docs/hooks-reference.html#usedebugvalue)


## Component API Overview

Extend `React.Component`:

```js
class Welcome extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>;
  }
}
```

`React.Component` å­ç±»å”¯ä¸€å¿…éœ€å®ç°çš„æ˜¯ [`render()`](#render) å‡½æ•°ï¼Œå…¶å®ƒéƒ½æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯å¼ºçƒˆæ¨èå®ç°è‡ªå·±çš„åŸºç¡€ç»„ä»¶ç±»ã€‚

- The Component Lifecycle {#the-component-lifecycle}

	Each component has several "lifecycle methods" that you can override to run code at particular times in the process. **You can use [this lifecycle diagram](https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/) as a cheat sheet.** In the list below, commonly used lifecycle methods are marked as **bold**. The rest of them exist for relatively rare use cases.

- Mounting {#mounting}

	These methods are called in the following order when an instance of a component is being created and inserted into the DOM:

	- [**`constructor()`**](#constructor)
	- [`static getDerivedStateFromProps()`](#static-getderivedstatefromprops)
	- [**`render()`**](#render)
	- [**`componentDidMount()`**](#componentdidmount)

	>Note:
	>
	>These methods are considered legacy and you should [avoid them](/blog/2018/03/27/update-on-async-rendering.html) in new code:
	>
	>- [`UNSAFE_componentWillMount()`](#unsafe_componentwillmount)

- Updating {#updating}

	An update can be caused by changes to props or state. These methods are called in the following order when a component is being re-rendered:

	- [`static getDerivedStateFromProps()`](#static-getderivedstatefromprops)
	- [`shouldComponentUpdate()`](#shouldcomponentupdate)
	- [**`render()`**](#render)
	- [`getSnapshotBeforeUpdate()`](#getsnapshotbeforeupdate)
	- [**`componentDidUpdate()`**](#componentdidupdate)

	>Note:
	>
	>These methods are considered legacy and you should [avoid them](/blog/2018/03/27/update-on-async-rendering.html) in new code:
	>
	>- [`UNSAFE_componentWillUpdate()`](#unsafe_componentwillupdate)
	>- [`UNSAFE_componentWillReceiveProps()`](#unsafe_componentwillreceiveprops)

- Unmounting {#unmounting}

	This method is called when a component is being removed from the DOM:

	- [**`componentWillUnmount()`**](#componentwillunmount)

- Error Handling {#error-handling}

	These methods are called when there is an error during rendering, in a lifecycle method, or in the constructor of any child component.

	- [`static getDerivedStateFromError()`](#static-getderivedstatefromerror)
	- [`componentDidCatch()`](#componentdidcatch)

- Other APIs {#other-apis}

	Each component also provides some other APIs:

	  - [`setState()`](#setstate)
	  - [`forceUpdate()`](#forceupdate)

	### Class Properties {#class-properties}

	  - [`defaultProps`](#defaultprops)
	  - [`displayName`](#displayname)

	### Instance Properties {#instance-properties}

	  - [`props`](#props)
	  - [`state`](#state)



# âš‘ ReactDOM API
- https://reactjs.org/docs/react-dom.html#reference-react-dom.md

## ReactDOM API Overview

å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ª `<script>` æ ‡ç­¾å¼•å…¥ Reactï¼Œæ‰€æœ‰çš„é¡¶å±‚ API éƒ½èƒ½åœ¨å…¨å±€ ReactDOM ä¸Šè°ƒç”¨ã€‚å¦‚æœä½ ä½¿ç”¨ npm å’Œ ES6/ES5ï¼Œä½ å¯ä»¥åˆ†åˆ«ä½¿ç”¨ï¼š 

	import ReactDOM from 'react-dom'    //ES6
	var ReactDOM = require('react-dom') // ES5

react-dom çš„ package æä¾›äº†å¯åœ¨åº”ç”¨é¡¶å±‚ä½¿ç”¨çš„ DOMï¼ˆDOM-specificï¼‰æ–¹æ³•ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œä½ å¯ä»¥æŠŠè¿™äº›æ–¹æ³•ç”¨äº React æ¨¡å‹ä»¥å¤–çš„åœ°æ–¹ã€‚ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†ç»„ä»¶éƒ½ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å—ã€‚

The `react-dom` package provides DOM-specific methods that can be used at the top level of your app and as an escape hatch to get outside of the React model if you need to. Most of your components should not need to use this module.

- [`render()`](#render)
- [`hydrate()`](#hydrate)
- [`unmountComponentAtNode()`](#unmountcomponentatnode)
- [`findDOMNode()`](#finddomnode)
- [`createPortal()`](#createportal)

React æ”¯æŒæ‰€æœ‰çš„ç°ä»£æµè§ˆå™¨ï¼ŒåŒ…æ‹¬ IE9 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œä½†æ˜¯éœ€è¦ä¸ºæ—§ç‰ˆæµè§ˆå™¨æ¯”å¦‚ IE9 å’Œ IE10 å¼•å…¥ç›¸å…³çš„ polyfills ä¾èµ–ã€‚

æ³¨æ„ï¼š

æˆ‘ä»¬ä¸æ”¯æŒé‚£äº›ä¸å…¼å®¹ ES5 æ–¹æ³•çš„æ—§ç‰ˆæµè§ˆå™¨ï¼Œä½†å¦‚æœä½ çš„åº”ç”¨åŒ…å«äº† polyfillï¼Œä¾‹å¦‚ es5-shim å’Œ es5-sham ä½ å¯èƒ½ä¼šå‘ç°ä½ çš„åº”ç”¨ä»ç„¶å¯ä»¥åœ¨è¿™äº›æµè§ˆå™¨ä¸­æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯å¦‚æœä½ é€‰æ‹©è¿™ç§æ–¹æ³•ï¼Œä½ ä¾¿éœ€è¦å­¤å†›å¥‹æˆ˜äº†ã€‚


## render()

	ReactDOM.render(element, container[, callback])

åœ¨æä¾›çš„ container é‡Œæ¸²æŸ“ä¸€ä¸ª React å…ƒç´ ï¼Œå¹¶è¿”å›å¯¹è¯¥ç»„ä»¶çš„å¼•ç”¨ï¼ˆæˆ–è€…é’ˆå¯¹æ— çŠ¶æ€ç»„ä»¶è¿”å› nullï¼‰ã€‚

å¦‚æœ React å…ƒç´ ä¹‹å‰å·²ç»åœ¨ container é‡Œæ¸²æŸ“è¿‡ï¼Œè¿™å°†ä¼šå¯¹å…¶æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå¹¶ä»…ä¼šåœ¨å¿…è¦æ—¶æ”¹å˜ DOM ä»¥æ˜ å°„æœ€æ–°çš„ React å…ƒç´ ã€‚

å¦‚æœæä¾›äº†å¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå°†åœ¨ç»„ä»¶è¢«æ¸²æŸ“æˆ–æ›´æ–°ä¹‹åè¢«æ‰§è¡Œã€‚

æ³¨æ„ï¼š

**ReactDOM.render()**ä¼šæ§åˆ¶ä½ ä¼ å…¥å®¹å™¨èŠ‚ç‚¹é‡Œçš„å†…å®¹ã€‚å½“é¦–æ¬¡è°ƒç”¨æ—¶ï¼Œå®¹å™¨èŠ‚ç‚¹é‡Œçš„æ‰€æœ‰ DOM å…ƒç´ éƒ½ä¼šè¢«æ›¿æ¢ï¼Œåç»­çš„è°ƒç”¨åˆ™ä¼šä½¿ç”¨ React çš„ DOM å·®åˆ†ç®—æ³•ï¼ˆDOM diffing algorithmï¼‰è¿›è¡Œé«˜æ•ˆçš„æ›´æ–°ã€‚

**ReactDOM.render()**ä¸ä¼šä¿®æ”¹å®¹å™¨èŠ‚ç‚¹ï¼ˆåªä¼šä¿®æ”¹å®¹å™¨çš„å­èŠ‚ç‚¹ï¼‰ã€‚å¯ä»¥åœ¨ä¸è¦†ç›–ç°æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œå°†ç»„ä»¶æ’å…¥å·²æœ‰çš„ DOM èŠ‚ç‚¹ä¸­ã€‚

**ReactDOM.render()**ç›®å‰ä¼šè¿”å›å¯¹æ ¹ç»„ä»¶ ReactComponent å®ä¾‹çš„å¼•ç”¨ã€‚ ä½†æ˜¯ï¼Œç›®å‰åº”è¯¥é¿å…ä½¿ç”¨è¿”å›çš„å¼•ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯å†å²é—ç•™ä¸‹æ¥çš„å†…å®¹ï¼Œè€Œä¸”åœ¨æœªæ¥ç‰ˆæœ¬çš„ React ä¸­ï¼Œç»„ä»¶æ¸²æŸ“åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šæ˜¯å¼‚æ­¥çš„ã€‚ å¦‚æœä½ çœŸçš„éœ€è¦è·å¾—å¯¹æ ¹ç»„ä»¶ ReactComponent å®ä¾‹çš„å¼•ç”¨ï¼Œé‚£ä¹ˆæ¨èä¸ºæ ¹å…ƒç´ æ·»åŠ  callback refã€‚

ä½¿ç”¨ ReactDOM.render() å¯¹æœåŠ¡ç«¯æ¸²æŸ“å®¹å™¨è¿›è¡Œ hydrate æ“ä½œçš„æ–¹å¼å·²ç»è¢«åºŸå¼ƒï¼Œå¹¶ä¸”ä¼šåœ¨ React 17 è¢«ç§»é™¤ã€‚ä½œä¸ºæ›¿ä»£ï¼Œè¯·ä½¿ç”¨ hydrate()ã€‚



## hydrate()

	ReactDOM.hydrate(element, container[, callback])

ä¸ render() ç›¸åŒï¼Œä½†å®ƒç”¨äºåœ¨ ReactDOMServer æ¸²æŸ“çš„å®¹å™¨ä¸­å¯¹ HTML çš„å†…å®¹è¿›è¡Œ hydrate æ“ä½œã€‚React ä¼šå°è¯•åœ¨å·²æœ‰æ ‡è®°ä¸Šç»‘å®šäº‹ä»¶ç›‘å¬å™¨ã€‚

React å¸Œæœ›æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯æ¸²æŸ“çš„å†…å®¹å®Œå…¨ä¸€è‡´ã€‚React å¯ä»¥å¼¥è¡¥æ–‡æœ¬å†…å®¹çš„å·®å¼‚ï¼Œä½†æ˜¯ä½ éœ€è¦å°†ä¸åŒ¹é…çš„åœ°æ–¹ä½œä¸º bug è¿›è¡Œä¿®å¤ã€‚åœ¨å¼€å‘è€…æ¨¡å¼ä¸‹ï¼ŒReact ä¼šå¯¹ hydration æ“ä½œè¿‡ç¨‹ä¸­çš„ä¸åŒ¹é…è¿›è¡Œè­¦å‘Šã€‚ä½†å¹¶ä¸èƒ½ä¿è¯åœ¨ä¸åŒ¹é…çš„æƒ…å†µä¸‹ï¼Œä¿®è¡¥å±æ€§çš„å·®å¼‚ã€‚ç”±äºæ€§èƒ½çš„å…³ç³»ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå› ä¸ºå¤§å¤šæ˜¯åº”ç”¨ä¸­ä¸åŒ¹é…çš„æƒ…å†µå¾ˆå°‘è§ï¼Œå¹¶ä¸”éªŒè¯æ‰€æœ‰æ ‡è®°çš„æˆæœ¬éå¸¸æ˜‚è´µã€‚

å¦‚æœå•ä¸ªå…ƒç´ çš„å±æ€§æˆ–è€…æ–‡æœ¬å†…å®¹ï¼Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´æœ‰æ— æ³•é¿å…å·®å¼‚ï¼ˆæ¯”å¦‚ï¼šæ—¶é—´æˆ³ï¼‰ï¼Œåˆ™å¯ä»¥ä¸ºå…ƒç´ æ·»åŠ  suppressHydrationWarning={true} æ¥æ¶ˆé™¤è­¦å‘Šã€‚è¿™ç§æ–¹å¼åªåœ¨ä¸€çº§æ·±åº¦ä¸Šæœ‰æ•ˆï¼Œåº”åªä½œä¸ºä¸€ç§åº”æ€¥æ–¹æ¡ˆï¼ˆescape hatchï¼‰ã€‚è¯·ä¸è¦è¿‡åº¦ä½¿ç”¨ï¼é™¤éå®ƒæ˜¯æ–‡æœ¬å†…å®¹ï¼Œå¦åˆ™ React ä»ä¸ä¼šå°è¯•ä¿®è¡¥å·®å¼‚ï¼Œå› æ­¤åœ¨æœªæ¥çš„æ›´æ–°ä¹‹å‰ï¼Œä»ä¼šä¿æŒä¸ä¸€è‡´ã€‚

å¦‚æœä½ æ‰§æ„è¦åœ¨æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯æ¸²æŸ“ä¸åŒå†…å®¹ï¼Œä½ å¯ä»¥é‡‡ç”¨åŒé‡ï¼ˆtwo-passï¼‰æ¸²æŸ“ã€‚åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸åŒå†…å®¹çš„ç»„ä»¶å¯ä»¥è¯»å–ç±»ä¼¼äº this.state.isClient çš„ state å˜é‡ï¼Œä½ å¯ä»¥åœ¨ componentDidMount() é‡Œå°†å®ƒè®¾ç½®ä¸º trueã€‚è¿™ç§æ–¹å¼åœ¨åˆå§‹æ¸²æŸ“è¿‡ç¨‹ä¸­ä¼šä¸æœåŠ¡ç«¯æ¸²æŸ“ç›¸åŒçš„å†…å®¹ï¼Œä»è€Œé¿å…ä¸åŒ¹é…çš„æƒ…å†µå‡ºç°ï¼Œä½†åœ¨ hydration æ“ä½œä¹‹åï¼Œä¼šåŒæ­¥è¿›è¡Œé¢å¤–çš„æ¸²æŸ“æ“ä½œã€‚æ³¨æ„ï¼Œå› ä¸ºè¿›è¡Œäº†ä¸¤æ¬¡æ¸²æŸ“ï¼Œè¿™ç§æ–¹å¼ä¼šä½¿å¾—ç»„ä»¶æ¸²æŸ“å˜æ…¢ï¼Œè¯·å°å¿ƒä½¿ç”¨ã€‚

è®°å¾—ä¿è¯å¼±ç½‘ç¯å¢ƒä¸‹çš„ç”¨æˆ·ä½“éªŒã€‚JavaScript ä»£ç çš„åŠ è½½è¦æ¯”æœ€åˆçš„ HTML æ¸²æŸ“æ™šçš„å¤šã€‚å› æ­¤å¦‚æœä½ åªåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸åŒçš„å†…å®¹ï¼Œå…¶è½¬æ¢å¯èƒ½ä¼šä¸ç¨³å®šã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‰§è¡Œé¡ºåˆ©ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯è´Ÿè´£æ¸²æŸ“çš„ shell ä¼šå¯¹æ¸²æŸ“æä¾›å¸®åŠ©ï¼Œå¹¶ä¸”åªæ˜¾ç¤ºå®¢æˆ·ç«¯ä¸Šé¢å¤–çš„å°ç»„ä»¶ã€‚æ¬²äº†è§£å¦‚ä½•åœ¨ä¸å‡ºç°æ ‡è®°ä¸åŒ¹é…çš„æƒ…å†µä¸‹æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·å‚è€ƒä¸Šä¸€æ®µçš„è§£é‡Šã€‚


## unmountComponentAtNode()

	ReactDOM.unmountComponentAtNode(container)

ä» DOM ä¸­å¸è½½ç»„ä»¶ï¼Œä¼šå°†å…¶äº‹ä»¶å¤„ç†å™¨ï¼ˆevent handlersï¼‰å’Œ state ä¸€å¹¶æ¸…é™¤ã€‚å¦‚æœæŒ‡å®šå®¹å™¨ä¸Šæ²¡æœ‰å¯¹åº”å·²æŒ‚è½½çš„ç»„ä»¶ï¼Œè¿™ä¸ªå‡½æ•°ä»€ä¹ˆä¹Ÿä¸ä¼šåšã€‚å¦‚æœç»„ä»¶è¢«ç§»é™¤å°†ä¼šè¿”å› trueï¼Œå¦‚æœæ²¡æœ‰ç»„ä»¶å¯è¢«ç§»é™¤å°†ä¼šè¿”å› falseã€‚

## findDOMNode()

æ³¨æ„: findDOMNode æ˜¯ä¸€ä¸ªè®¿é—®åº•å±‚ DOM èŠ‚ç‚¹çš„åº”æ€¥æ–¹æ¡ˆï¼ˆescape hatchï¼‰ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸æ¨èä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¼šç ´åç»„ä»¶çš„æŠ½è±¡ç»“æ„ã€‚ä¸¥æ ¼æ¨¡å¼ä¸‹è¯¥æ–¹æ³•å·²å¼ƒç”¨ã€‚

	ReactDOM.findDOMNode(component)

å¦‚æœç»„ä»¶å·²ç»è¢«æŒ‚è½½åˆ° DOM ä¸Šï¼Œæ­¤æ–¹æ³•ä¼šè¿”å›æµè§ˆå™¨ä¸­ç›¸åº”çš„åŸç”Ÿ DOM å…ƒç´ ã€‚æ­¤æ–¹æ³•å¯¹äºä» DOM ä¸­è¯»å–å€¼å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚è·å–è¡¨å•å­—æ®µçš„å€¼æˆ–è€…æ‰§è¡Œ DOM æ£€æµ‹ï¼ˆperforming DOM measurementsï¼‰ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç»‘å®šä¸€ä¸ª ref åˆ° DOM èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥å®Œå…¨é¿å…ä½¿ç”¨ findDOMNodeã€‚

å½“ç»„ä»¶æ¸²æŸ“çš„å†…å®¹ä¸º null æˆ– false æ—¶ï¼ŒfindDOMNode ä¹Ÿä¼šè¿”å› nullã€‚å½“ç»„ä»¶æ¸²æŸ“çš„æ˜¯å­—ç¬¦ä¸²æ—¶ï¼ŒfindDOMNode è¿”å›çš„æ˜¯å­—ç¬¦ä¸²å¯¹åº”çš„ DOM èŠ‚ç‚¹ã€‚ä» React 16 å¼€å§‹ï¼Œç»„ä»¶å¯èƒ½ä¼šè¿”å›æœ‰å¤šä¸ªå­èŠ‚ç‚¹çš„ fragmentï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒfindDOMNode ä¼šè¿”å›ç¬¬ä¸€ä¸ªéç©ºå­èŠ‚ç‚¹å¯¹åº”çš„ DOM èŠ‚ç‚¹ã€‚

æ³¨æ„:

findDOMNode åªåœ¨å·²æŒ‚è½½çš„ç»„ä»¶ä¸Šå¯ç”¨ï¼ˆå³ï¼Œå·²ç»æ”¾ç½®åœ¨ DOM ä¸­çš„ç»„ä»¶ï¼‰ã€‚å¦‚æœä½ å°è¯•è°ƒç”¨æœªæŒ‚è½½çš„ç»„ä»¶ï¼ˆä¾‹å¦‚åœ¨ä¸€ä¸ªè¿˜æœªåˆ›å»ºçš„ç»„ä»¶ä¸Šè°ƒç”¨ render() ä¸­çš„ findDOMNode()ï¼‰å°†ä¼šå¼•å‘å¼‚å¸¸ã€‚

æ³¨æ„ï¼šfindDOMNode ä¸èƒ½ç”¨äºå‡½æ•°ç»„ä»¶ã€‚


## createPortal()

	ReactDOM.createPortal(child, container)

åˆ›å»º portalã€‚Portal å°†æä¾›ä¸€ç§å°†å­èŠ‚ç‚¹æ¸²æŸ“åˆ° DOM èŠ‚ç‚¹ä¸­çš„æ–¹å¼ï¼Œè¯¥èŠ‚ç‚¹å­˜åœ¨äº DOM ç»„ä»¶çš„å±‚æ¬¡ç»“æ„ä¹‹å¤–ã€‚


# âš‘ ReactDOMServer API
- https://react.docschina.org/docs/react-dom-server.html
- https://reactjs.bootcss.com/docs/react-dom-server.html
- https://reactjs.org/docs/react-dom-server.html


## Overview {#overview}

ReactDOMServer å¯¹è±¡å…è®¸ä½ å°†ç»„ä»¶æ¸²æŸ“æˆé™æ€æ ‡è®°ã€‚é€šå¸¸ï¼Œå®ƒè¢«ä½¿ç”¨åœ¨ Node æœåŠ¡ç«¯ä¸Šï¼š

	// ES modules
	import ReactDOMServer from 'react-dom/server';
	// CommonJS
	var ReactDOMServer = require('react-dom/server');

ä¸‹è¿°æ–¹æ³•å¯ä»¥è¢«ä½¿ç”¨åœ¨æœåŠ¡ç«¯å’Œæµè§ˆå™¨ç¯å¢ƒã€‚

- [`renderToString()`](#rendertostring)
- [`renderToStaticMarkup()`](#rendertostaticmarkup)


ä¸‹è¿°é™„åŠ æ–¹æ³•ä¾èµ– stream å¹¶ä¸”åªèƒ½åœ¨æœåŠ¡ç«¯ä½¿ç”¨çš„ï¼Œå®ƒä»¬åœ¨æµè§ˆå™¨ä¸­ä¸èµ·ä½œç”¨ã€‚

- [`renderToNodeStream()`](#rendertonodestream)
- [`renderToStaticNodeStream()`](#rendertostaticnodestream)



## renderToString()

	ReactDOMServer.renderToString(element)

å°† React å…ƒç´ æ¸²æŸ“ä¸ºåˆå§‹ HTMLã€‚React å°†è¿”å›ä¸€ä¸ª HTML å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•åœ¨æœåŠ¡ç«¯ç”Ÿæˆ HTMLï¼Œå¹¶åœ¨é¦–æ¬¡è¯·æ±‚æ—¶å°†æ ‡è®°ä¸‹å‘ï¼Œä»¥åŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œå¹¶å…è®¸æœç´¢å¼•æ“çˆ¬å–ä½ çš„é¡µé¢ä»¥è¾¾åˆ° SEO ä¼˜åŒ–çš„ç›®çš„ã€‚

å¦‚æœä½ åœ¨å·²æœ‰æœåŠ¡ç«¯æ¸²æŸ“æ ‡è®°çš„èŠ‚ç‚¹ä¸Šè°ƒç”¨ ReactDOM.hydrate() æ–¹æ³•ï¼ŒReact å°†ä¼šä¿ç•™è¯¥èŠ‚ç‚¹ä¸”åªè¿›è¡Œäº‹ä»¶å¤„ç†ç»‘å®šï¼Œä»è€Œè®©ä½ æœ‰ä¸€ä¸ªéå¸¸é«˜æ€§èƒ½çš„é¦–æ¬¡åŠ è½½ä½“éªŒã€‚

## renderToStaticMarkup()

	ReactDOMServer.renderToStaticMarkup(element)

æ­¤æ–¹æ³•ä¸ renderToString ç›¸ä¼¼ï¼Œä½†æ­¤æ–¹æ³•ä¸ä¼šåœ¨ React å†…éƒ¨åˆ›å»ºçš„é¢å¤– DOM å±æ€§ï¼Œä¾‹å¦‚ data-reactrootã€‚å¦‚æœä½ å¸Œæœ›æŠŠ React å½“ä½œé™æ€é¡µé¢ç”Ÿæˆå™¨æ¥ä½¿ç”¨ï¼Œæ­¤æ–¹æ³•ä¼šéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå»é™¤é¢å¤–çš„å±æ€§å¯ä»¥èŠ‚çœä¸€äº›å­—èŠ‚ã€‚

å¦‚æœä½ è®¡åˆ’åœ¨å‰ç«¯ä½¿ç”¨ React ä»¥ä½¿å¾—æ ‡è®°å¯äº¤äº’ï¼Œè¯·ä¸è¦ä½¿ç”¨æ­¤æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨æœåŠ¡ç«¯ä¸Šä½¿ç”¨ renderToString æˆ–åœ¨å‰ç«¯ä¸Šä½¿ç”¨ ReactDOM.hydrate() æ¥ä»£æ›¿æ­¤æ–¹æ³•ã€‚

## renderToNodeStream()

	ReactDOMServer.renderToNodeStream(element)

å°†ä¸€ä¸ª React å…ƒç´ æ¸²æŸ“æˆå…¶åˆå§‹ HTMLã€‚è¿”å›ä¸€ä¸ªå¯è¾“å‡º HTML å­—ç¬¦ä¸²çš„å¯è¯»æµã€‚é€šè¿‡å¯è¯»æµè¾“å‡ºçš„ HTML å®Œå…¨ç­‰åŒäº ReactDOMServer.renderToString è¿”å›çš„ HTMLã€‚ä½ å¯ä»¥ä½¿ç”¨æœ¬æ–¹æ³•åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆ HTMLï¼Œå¹¶åœ¨åˆå§‹è¯·æ±‚æ—¶å°†æ ‡è®°ä¸‹å‘ï¼Œä»¥åŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œå¹¶å…è®¸æœç´¢å¼•æ“æŠ“å–ä½ çš„é¡µé¢ä»¥è¾¾åˆ° SEO ä¼˜åŒ–çš„ç›®çš„ã€‚

å¦‚æœä½ åœ¨å·²æœ‰æœåŠ¡ç«¯æ¸²æŸ“æ ‡è®°çš„èŠ‚ç‚¹ä¸Šè°ƒç”¨ ReactDOM.hydrate() æ–¹æ³•ï¼ŒReact å°†ä¼šä¿ç•™è¯¥èŠ‚ç‚¹ä¸”åªè¿›è¡Œäº‹ä»¶å¤„ç†ç»‘å®šï¼Œä»è€Œè®©ä½ æœ‰ä¸€ä¸ªéå¸¸é«˜æ€§èƒ½çš„é¦–æ¬¡åŠ è½½ä½“éªŒã€‚

æ³¨æ„:

è¿™ä¸ª API ä»…å…è®¸åœ¨æœåŠ¡ç«¯ä½¿ç”¨ã€‚ä¸å…è®¸åœ¨æµè§ˆå™¨ä½¿ç”¨ã€‚

é€šè¿‡æœ¬æ–¹æ³•è¿”å›çš„æµä¼šè¿”å›ä¸€ä¸ªç”± utf-8 ç¼–ç çš„å­—èŠ‚æµã€‚å¦‚æœä½ éœ€è¦å¦ä¸€ç§ç¼–ç çš„æµï¼Œè¯·æŸ¥çœ‹åƒ iconv-lite è¿™æ ·çš„é¡¹ç›®ï¼Œå®ƒä¸ºè½¬æ¢æ–‡æœ¬æä¾›äº†è½¬æ¢æµã€‚

## renderToStaticNodeStream()

	ReactDOMServer.renderToStaticNodeStream(element)

æ­¤æ–¹æ³•ä¸ renderToNodeStream ç›¸ä¼¼ï¼Œä½†æ­¤æ–¹æ³•ä¸ä¼šåœ¨ React å†…éƒ¨åˆ›å»ºçš„é¢å¤– DOM å±æ€§ï¼Œä¾‹å¦‚ data-reactrootã€‚å¦‚æœä½ å¸Œæœ›æŠŠ React å½“ä½œé™æ€é¡µé¢ç”Ÿæˆå™¨æ¥ä½¿ç”¨ï¼Œæ­¤æ–¹æ³•ä¼šéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå»é™¤é¢å¤–çš„å±æ€§å¯ä»¥èŠ‚çœä¸€äº›å­—èŠ‚ã€‚

é€šè¿‡å¯è¯»æµè¾“å‡ºçš„ HTMLï¼Œå®Œå…¨ç­‰åŒäº ReactDOMServer.renderToStaticMarkup è¿”å›çš„ HTMLã€‚

å¦‚æœä½ è®¡åˆ’åœ¨å‰ç«¯ä½¿ç”¨ React ä»¥ä½¿å¾—æ ‡è®°å¯äº¤äº’ï¼Œè¯·ä¸è¦ä½¿ç”¨æ­¤æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨æœåŠ¡ç«¯ä¸Šä½¿ç”¨ renderToNodeStream æˆ–åœ¨å‰ç«¯ä¸Šä½¿ç”¨ ReactDOM.hydrate() æ¥ä»£æ›¿æ­¤æ–¹æ³•ã€‚

æ³¨æ„:

æ­¤ API ä»…é™äºæœåŠ¡ç«¯ä½¿ç”¨ï¼Œåœ¨æµè§ˆå™¨ä¸­æ˜¯ä¸å¯ç”¨çš„ã€‚

é€šè¿‡æœ¬æ–¹æ³•è¿”å›çš„æµä¼šè¿”å›ä¸€ä¸ªç”± utf-8 ç¼–ç çš„å­—èŠ‚æµã€‚å¦‚æœä½ éœ€è¦å¦ä¸€ç§ç¼–ç çš„æµï¼Œè¯·æŸ¥çœ‹åƒ iconv-lite è¿™æ ·çš„é¡¹ç›®ï¼Œå®ƒä¸ºè½¬æ¢æ–‡æœ¬æä¾›äº†è½¬æ¢æµã€‚




# âš‘ DOM Element
- [cross-site scripting (XSS)](https://en.wikipedia.org/wiki/Cross-site_scripting) 
- [`ReactDOM.hydrate()` documentation](/docs/react-dom.html#hydrate)

React çš„å®ç°ä¸ä¾èµ–äºæµè§ˆå™¨ DOM çš„ç³»ç»Ÿï¼Œå½“åº”ç”¨éœ€è¦ä½¿ç”¨ DOM çš„æŸäº›å±æ€§æ—¶ï¼Œè¦ä½¿ç”¨é©¼å³°å‘½åæ–¹å¼è®¿é—®ï¼Œå¦‚ `tabindex` å±æ€§å¯¹åº”çš„é©¼å³°è¡¨è¾¾ `tabIndex`ã€‚ä½†æ˜¯æ‰€æœ‰ç”¨äºè¾…åŠ©è®¿é—®çš„å±æ€§ `aria-*` å’Œ `data-*` éƒ½è½¬æ¢æˆå°å†™ï¼Œæ¯”å¦‚ `aria-label` å¯¹åº”è¡¨è¾¾ `aria-label`ã€‚

è¾“å…¥æ¡†çš„é€‰ä¸­çŠ¶æ€ä½¿ç”¨ `checked` å±æ€§ï¼ŒåŒ…æ‹¬ `checkbox` æˆ– `radio` ç±»å‹ï¼Œå¦å¤– `defaultChecked` ç”¨äºè®¾ç½®é»˜è®¤çŠ¶æ€ï¼Œåªåœ¨åˆå§‹åŠ è½½æ—¶è®¾å®šï¼Œä½œä¸ºéæ§åˆ¶ç»„ä»¶ä½¿ç”¨ã€‚

è¦æŒ‡å®š CSS æ ·å¼ç±»å±æ€§ï¼Œä½¿ç”¨ `className` å±æ€§ï¼Œå¯¹æ‰€æœ‰ DOM å’Œ SVG å…ƒç´ é€‚ç”¨ï¼Œå¦‚ `<div>`, `<a>` ç­‰ç­‰ã€‚

ä½†æ—¶ï¼Œä½¿ç”¨ Web Components å³åŸç”Ÿç»„ä»¶è¿˜æ˜¯ä½¿ç”¨ `class` å±æ€§ï¼Œè¿™ç§åšæ³•è¿˜å¸¸ç”¨ã€‚

ä½¿ç”¨ `dangerouslySetInnerHTML` å±æ€§æ¥æ›¿ä»£ `innerHTML` æ–¹æ³•è®¾ç½®åŸæ · HTML æ ‡ç­¾ï¼Œé€šå¸¸è¿™æ ·åšæœ‰é£é™©ï¼Œéœ€è¦é¢„é˜²è„šæœ¬æ³¨å…¥æˆ–è·¨ç«™è„šæœ¬æ”»å‡» XSS - Cross Site Scriptingã€‚

```js
function createMarkup() {
  return {__html: 'First &middot; Second'};
}

function MyComponent() {
  return <div dangerouslySetInnerHTML={createMarkup()} />;
}
```

ç”±äº `for` æ˜¯ JavaScript å…³é”®å­—ï¼ŒReact elements ä½¿ç”¨ `htmlFor` æ›¿ä»£ã€‚

è¾“å…¥äº‹ä»¶  `onChange` å’Œæ­£å¸¸è¾“å…¥ä¸€æ ·ï¼Œæœ‰æ•°æ®å˜åŠ¨å°±è§¦å‘ï¼Œä½†æ˜¯ React å†…éƒ¨ä¸æ˜¯ç›´æ¥åŸºäºæµè§ˆå™¨çš„ onChange äº‹ä»¶ï¼Œå› ä¸ºæè¿°ä¸å½“ misnomerï¼ŒReact æ˜¯å®æ—¶å¤„ç†è¾“å…¥äº‹ä»¶ã€‚

æ ‡è®°ä¸€ä¸ª `<option>` ä¸º `selected` æ—¶ï¼Œå®ƒçš„å€¼ `value` å°±è¢« `<select>` å¼•ç”¨ã€‚

å¯¹äº `style` å±æ€§å¯ä»¥åŠ¨æ€è®¾ç½®ä¸€ä¸ªå«æœ‰æ ·å¼å€¼çš„å¯¹è±¡ï¼Œé€šå¸¸ä¼šä¼˜å…ˆä½¿ç”¨ className æ¥è®¾ç½®æ ·å¼ï¼Œé€šè¿‡ DOM `style` å±æ€§çš„åšæ³•å°±æ˜¯ä½¿ç”¨ JavaScript ä¿®æ”¹æ ·å¼å±æ€§ï¼Œè¿˜èƒ½é˜²æ­¢ XSS å®‰å…¨é—®é¢˜ã€‚

```js
const divStyle = {
  color: 'blue',
  backgroundImage: 'url(' + imgUrl + ')',
};

function HelloWorldComponent() {
  return <div style={divStyle}>Hello World!</div>;
}
```

æ³¨æ„ï¼Œä¸ä¼šè‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†ï¼š

```js
const divStyle = {
  WebkitTransition: 'all', // note the capital 'W' here
  msTransition: 'all' // 'ms' is the only lowercase vendor prefix
};

function ComponentWithTransition() {
  return <div style={divStyle}>This should work cross-browser</div>;
}
```

Style å±æ€§çš„é”®å€¼é€šå¸¸ä½¿ç”¨é©¼å³°è¡¨è¾¾ï¼Œä½†æ˜¯å¯¹äºæµè§ˆå™¨å‰ç¼€éœ€è¦ä½¿ç”¨å¤§å†™é¦–å­—æ¯ `WebkitTransition`ï¼Œåªæ˜¯ ms é™¤å¤–ã€‚

React ä¼šè‡ªåŠ¨ç»™æ•°å€¼åç¼€ "px" å•ä½ï¼Œå¦‚æœä¸å¸Œæœ›ä½¿ç”¨è¿™ä¸ªå•ä½ï¼Œè¯·ç”¨å­—ç¬¦ä¸²è®¾ç½®ã€‚

```js
// Result style: '10px'
<div style={{ height: 10 }}>
  Hello World!
</div>

// Result style: '10%'
<div style={{ height: '10%' }}>
  Hello World!
</div>
```

å½“ç„¶ï¼Œå¯¹äºç‰¹å®šçš„å±æ€§ï¼Œå¦‚ `zoom`, `order`, `flex` æ˜¯ä¸ä¼šæ·»åŠ åƒç´ å•ä½çš„ã€‚

é•‡å‹å†…å®¹ç¼–è¾‘è­¦å‘Š suppressContentEditableWarningï¼Œé€šå¸¸å°†å¸¦æœ‰å­èŠ‚ç‚¹çš„ç»„ä»¶è®¾ç½®ä¸º `contentEditable` å¯ä»¥ç¼–è¾‘çŠ¶æ€å°±ä¼šæ”¶åˆ°è­¦å‘Šï¼Œå› ä¸ºè¿™ä¸ä¼šæ­£å¸¸å·¥ä½œã€‚ä¸è¦é•‡å‹è­¦å‘Šä¿¡æ¯ï¼Œé™¤éæ˜¯å¼€å‘ç»„ä»¶åº“ï¼Œå¦‚ [Draft.js](https://facebook.github.io/draft-js/) ç¼–è¾‘å™¨å°±éœ€è¦ä½¿ç”¨ `contentEditable`ã€‚

ä½¿ç”¨ server-side rendering æ—¶ï¼Œé€šå¸¸ä¼šè­¦å‘ŠæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¸²æŸ“çš„å†…å®¹æœ‰å·®å¼‚ï¼Œå°½ç®¡å¾ˆå°‘è§ï¼Œä½†æ˜¯å¾ˆéš¾åšåˆ°å®Œå…¨ä¸€è‡´ã€‚

å¦‚æœé€šè¿‡ `suppressHydrationWarning` è®¾ç½®ä¸º `true` é•‡å‹è­¦å‘Šï¼ŒReact å°†å®ƒä½œä¸ºæ·±å±‚çš„é€ƒç”Ÿèˆ±å£ä½¿ç”¨ï¼Œä¸è¦è¿‡åº¦ä½¿ç”¨å®ƒã€‚

Hydrate å°±æ˜¯æ³¨æ°´ï¼Œå°±æ˜¯æŠŠå­—ç¬¦ä¸²å˜æˆå¯ç”¨ç»„ä»¶æ¸²æŸ“åˆ°æµè§ˆå™¨ã€‚Dehydrate æ˜¯è„±æ°´ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œå‡†å¤‡çº¯æ•°æ®çš„è¿‡ç¨‹ï¼Œè¿™äº›æ•°æ®éš HTML ä¸€èµ·å‘ç»™æµè§ˆå™¨ã€‚å› ä¸º React éœ€è¦ç”¨è¿™äº›æ•°æ®é‡æ–°æ¸²æŸ“ä¸€éï¼ŒReact v16 ä¹‹å‰æ˜¯è¿™æ ·ï¼Œåœ¨æµè§ˆå™¨ç«¯ï¼Œæ ¹æ®è¿™äº›æ•°æ®é‡æ–°æ¸²æŸ“ä¸€éçš„è¿‡ç¨‹ï¼Œå°±å«åš Rehydrateã€‚

æ‰€æœ‰æ”¯æŒ `value` å±æ€§çš„è¾“å…¥å…ƒç´ åŒ…æ‹¬ `<input>`, `<select>` å’Œ `<textarea>` ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è®¾ç½®å€¼ï¼Œåœ¨ç¼–å†™å¯æ§ç»„ä»¶æ—¶å¾ˆå¸¸ç”¨ã€‚è¿˜æœ‰ `defaultValue` æ˜¯ç»™éå—æ§ç»„ä»¶åœ¨åŠ è½½æ—¶è®¾ç½®åˆå§‹å€¼çš„ã€‚

åˆ° React 16 ä¸ºæ­¢ï¼Œæ‰€æœ‰æ ‡å‡† DOM å±æ€§éƒ½å·²ç»å®Œå…¨æ”¯æŒï¼ŒReact æ€»æ˜¯æä¾›ä»¥ JavaScript ä¸ºä¸­å¿ƒçš„ APIã€‚ç”±äº React ç»„ä»¶ç»å¸¸è‡ªå·±å®šä¹‰å±æ€§æˆ– DOM ç›¸å…³çš„å±æ€§ï¼ŒReact ä½¿ç”¨é©¼å³° `camelCase` è¡¨è¾¾ DOM APIsï¼š

```js
<div tabIndex={-1} />      // Just like node.tabIndex DOM API
<div className="Button" /> // Just like node.className DOM API
<input readOnly={true} />  // Just like node.readOnly DOM API
```

éƒ¨åˆ† React æ”¯æŒçš„ DOM å±æ€§å¦‚ä¸‹ï¼š

```
accept acceptCharset accessKey action allowFullScreen alt async autoComplete
autoFocus autoPlay capture cellPadding cellSpacing challenge charSet checked
cite classID className colSpan cols content contentEditable contextMenu controls
controlsList coords crossOrigin data dateTime default defer dir disabled
download draggable encType form formAction formEncType formMethod formNoValidate
formTarget frameBorder headers height hidden high href hrefLang htmlFor
httpEquiv icon id inputMode integrity is keyParams keyType kind label lang list
loop low manifest marginHeight marginWidth max maxLength media mediaGroup method
min minLength multiple muted name noValidate nonce open optimum pattern
placeholder poster preload profile radioGroup readOnly rel required reversed
role rowSpan rows sandbox scope scoped scrolling seamless selected shape size
sizes span spellCheck src srcDoc srcLang srcSet start step style summary
tabIndex target title type useMap value width wmode wrap
```

æ‰€æœ‰ SVG å±æ€§è€…æ”¯æŒï¼š

```
accentHeight accumulate additive alignmentBaseline allowReorder alphabetic
amplitude arabicForm ascent attributeName attributeType autoReverse azimuth
baseFrequency baseProfile baselineShift bbox begin bias by calcMode capHeight
clip clipPath clipPathUnits clipRule colorInterpolation
colorInterpolationFilters colorProfile colorRendering contentScriptType
contentStyleType cursor cx cy d decelerate descent diffuseConstant direction
display divisor dominantBaseline dur dx dy edgeMode elevation enableBackground
end exponent externalResourcesRequired fill fillOpacity fillRule filter
filterRes filterUnits floodColor floodOpacity focusable fontFamily fontSize
fontSizeAdjust fontStretch fontStyle fontVariant fontWeight format from fx fy
g1 g2 glyphName glyphOrientationHorizontal glyphOrientationVertical glyphRef
gradientTransform gradientUnits hanging horizAdvX horizOriginX ideographic
imageRendering in in2 intercept k k1 k2 k3 k4 kernelMatrix kernelUnitLength
kerning keyPoints keySplines keyTimes lengthAdjust letterSpacing lightingColor
limitingConeAngle local markerEnd markerHeight markerMid markerStart
markerUnits markerWidth mask maskContentUnits maskUnits mathematical mode
numOctaves offset opacity operator order orient orientation origin overflow
overlinePosition overlineThickness paintOrder panose1 pathLength
patternContentUnits patternTransform patternUnits pointerEvents points
pointsAtX pointsAtY pointsAtZ preserveAlpha preserveAspectRatio primitiveUnits
r radius refX refY renderingIntent repeatCount repeatDur requiredExtensions
requiredFeatures restart result rotate rx ry scale seed shapeRendering slope
spacing specularConstant specularExponent speed spreadMethod startOffset
stdDeviation stemh stemv stitchTiles stopColor stopOpacity
strikethroughPosition strikethroughThickness string stroke strokeDasharray
strokeDashoffset strokeLinecap strokeLinejoin strokeMiterlimit strokeOpacity
strokeWidth surfaceScale systemLanguage tableValues targetX targetY textAnchor
textDecoration textLength textRendering to transform u1 u2 underlinePosition
underlineThickness unicode unicodeBidi unicodeRange unitsPerEm vAlphabetic
vHanging vIdeographic vMathematical values vectorEffect version vertAdvY
vertOriginX vertOriginY viewBox viewTarget visibility widths wordSpacing
writingMode x x1 x2 xChannelSelector xHeight xlinkActuate xlinkArcrole
xlinkHref xlinkRole xlinkShow xlinkTitle xlinkType xmlns xmlnsXlink xmlBase
xmlLang xmlSpace y y1 y2 yChannelSelector z zoomAndPan
```




# âš‘ Element UI
https://element.eleme.cn/#/zh-CN/component/installation
https://elemefe.github.io/element-react/#/zh-CN/quick-start

## Element React

å®‰è£…
æ¨èä½¿ç”¨ npm çš„æ–¹å¼å®‰è£…ï¼Œå®ƒèƒ½æ›´å¥½åœ°å’Œwebpackæ‰“åŒ…å·¥å…·é…åˆä½¿ç”¨ã€‚

	npm i element-react --save

ä¸»é¢˜
å¼€å§‹å‰, ä½ è¿˜éœ€è¦ä¸€ä¸ªä¸»é¢˜åŒ…, è¿™é‡Œæˆ‘ä»¬æ¨èä½¿ç”¨element-theme-default.

	npm install element-theme-default --save

ä½¿ç”¨

	import React from 'react';
	import ReactDOM from 'react-dom';
	import { Button } from 'element-react';

	import 'element-theme-default';

	ReactDOM.render(<Button type="primary">Hello</Button>, document.getElementById('app'));

## Element Vue

Â¶npm å®‰è£…
æ¨èä½¿ç”¨ npm çš„æ–¹å¼å®‰è£…ï¼Œå®ƒèƒ½æ›´å¥½åœ°å’Œ webpack æ‰“åŒ…å·¥å…·é…åˆä½¿ç”¨ã€‚

	npm i element-ui -S

Quick Start

	import Vue from 'vue'
	import Element from 'element-ui'

	Vue.use(Element)

	// or
	import {
	  Select,
	  Button
	  // ...
	} from 'element-ui'

	Vue.component(Select.name, Select)
	Vue.component(Button.name, Button)


Â¶CDN
ç›®å‰å¯ä»¥é€šè¿‡ unpkg.com/element-ui è·å–åˆ°æœ€æ–°ç‰ˆæœ¬çš„èµ„æºï¼Œåœ¨é¡µé¢ä¸Šå¼•å…¥ js å’Œ css æ–‡ä»¶å³å¯å¼€å§‹ä½¿ç”¨ã€‚

	<!-- å¼•å…¥æ ·å¼ -->
	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	<!-- å¼•å…¥ç»„ä»¶åº“ -->
	<script src="https://unpkg.com/element-ui/lib/index.js"></script>

æˆ‘ä»¬å»ºè®®ä½¿ç”¨ CDN å¼•å…¥ Element çš„ç”¨æˆ·åœ¨é“¾æ¥åœ°å€ä¸Šé”å®šç‰ˆæœ¬ï¼Œä»¥å…å°†æ¥ Element å‡çº§æ—¶å—åˆ°éå…¼å®¹æ€§æ›´æ–°çš„å½±å“ã€‚é”å®šç‰ˆæœ¬çš„æ–¹æ³•è¯·æŸ¥çœ‹ unpkg.comã€‚

Â¶Hello world

é€šè¿‡ CDN çš„æ–¹å¼æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ Element å†™å‡ºä¸€ä¸ª Hello world é¡µé¢ã€‚åœ¨çº¿æ¼”ç¤º https://codepen.io/ziyoung/pen/rRKYpd

	<!DOCTYPE html>
	<html>
	<head>
	  <meta charset="UTF-8">
	  <!-- import CSS -->
	  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	</head>
	<body>
	  <div id="app">
	    <el-button @click="visible = true">Button</el-button>
	    <el-dialog :visible.sync="visible" title="Hello world">
	      <p>Try Element</p>
	    </el-dialog>
	  </div>
	</body>
	  <!-- import Vue before Element -->
	  <script src="https://unpkg.com/vue/dist/vue.js"></script>
	  <!-- import JavaScript -->
	  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
	  <script>
	    new Vue({
	      el: '#app',
	      data: function() {
	        return { visible: false }
	      }
	    })
	  </script>
	</html>

å¦‚æœæ˜¯é€šè¿‡ npm å®‰è£…ï¼Œå¹¶å¸Œæœ›é…åˆ webpack ä½¿ç”¨ï¼Œè¯·é˜…è¯»ä¸‹ä¸€èŠ‚ï¼šå¿«é€Ÿä¸Šæ‰‹ã€‚


## Element Quick Start
ä½¿ç”¨ vue-cli@3
æˆ‘ä»¬ä¸ºæ–°ç‰ˆçš„ vue-cli å‡†å¤‡äº†ç›¸åº”çš„ Element æ’ä»¶ï¼Œä½ å¯ä»¥ç”¨å®ƒä»¬å¿«é€Ÿåœ°æ­å»ºä¸€ä¸ªåŸºäº Element çš„é¡¹ç›®ã€‚

Â¶ä½¿ç”¨ Starter Kit
æˆ‘ä»¬æä¾›äº†é€šç”¨çš„é¡¹ç›®æ¨¡æ¿ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å¯¹äº Laravel ç”¨æˆ·ï¼Œæˆ‘ä»¬ä¹Ÿå‡†å¤‡äº†ç›¸åº”çš„æ¨¡æ¿ï¼ŒåŒæ ·å¯ä»¥ç›´æ¥ä¸‹è½½ä½¿ç”¨ã€‚

å¦‚æœä¸å¸Œæœ›ä½¿ç”¨æˆ‘ä»¬æä¾›çš„æ¨¡æ¿ï¼Œè¯·ç»§ç»­é˜…è¯»ã€‚

Â¶å¼•å…¥ Element
ä½ å¯ä»¥å¼•å…¥æ•´ä¸ª Elementï¼Œæˆ–æ˜¯æ ¹æ®éœ€è¦ä»…å¼•å…¥éƒ¨åˆ†ç»„ä»¶ã€‚æˆ‘ä»¬å…ˆä»‹ç»å¦‚ä½•å¼•å…¥å®Œæ•´çš„ Elementã€‚

Â¶å®Œæ•´å¼•å…¥
åœ¨ main.js ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

	import Vue from 'vue';
	import ElementUI from 'element-ui';
	import 'element-ui/lib/theme-chalk/index.css';
	import App from './App.vue';

	Vue.use(ElementUI);

	new Vue({
	  el: '#app',
	  render: h => h(App)
	});

ä»¥ä¸Šä»£ç ä¾¿å®Œæˆäº† Element çš„å¼•å…¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ·å¼æ–‡ä»¶éœ€è¦å•ç‹¬å¼•å…¥ã€‚

Â¶æŒ‰éœ€å¼•å…¥

å€ŸåŠ© babel-plugin-componentï¼Œæˆ‘ä»¬å¯ä»¥åªå¼•å…¥éœ€è¦çš„ç»„ä»¶ï¼Œä»¥è¾¾åˆ°å‡å°é¡¹ç›®ä½“ç§¯çš„ç›®çš„ã€‚

é¦–å…ˆï¼Œå®‰è£… babel-plugin-componentï¼š

	npm install babel-plugin-component -D

ç„¶åï¼Œå°† .babelrc ä¿®æ”¹ä¸ºï¼š

	{
	  "presets": [["es2015", { "modules": false }]],
	  "plugins": [
	    [
	      "component",
	      {
	        "libraryName": "element-ui",
	        "styleLibraryName": "theme-chalk"
	      }
	    ]
	  ]
	}

æ¥ä¸‹æ¥ï¼Œå¦‚æœä½ åªå¸Œæœ›å¼•å…¥éƒ¨åˆ†ç»„ä»¶ï¼Œæ¯”å¦‚ Button å’Œ Selectï¼Œé‚£ä¹ˆéœ€è¦åœ¨ main.js ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

	import Vue from 'vue';
	import { Button, Select } from 'element-ui';
	import App from './App.vue';

	Vue.component(Button.name, Button);
	Vue.component(Select.name, Select);
	/* æˆ–å†™ä¸º
	 * Vue.use(Button)
	 * Vue.use(Select)
	 */

	new Vue({
	  el: '#app',
	  render: h => h(App)
	});

å®Œæ•´ç»„ä»¶åˆ—è¡¨å’Œå¼•å…¥æ–¹å¼ï¼ˆå®Œæ•´ç»„ä»¶åˆ—è¡¨ä»¥ components.json ä¸ºå‡†ï¼‰

	import Vue from 'vue';
	import {
	  Pagination,
	  Dialog,
	  Autocomplete,
	  Dropdown,
	  DropdownMenu,
	  DropdownItem,
	  Menu,
	  Submenu,
	  MenuItem,
	  MenuItemGroup,
	  Input,
	  InputNumber,
	  Radio,
	  RadioGroup,
	  RadioButton,
	  Checkbox,
	  CheckboxButton,
	  CheckboxGroup,
	  Switch,
	  Select,
	  Option,
	  OptionGroup,
	  Button,
	  ButtonGroup,
	  Table,
	  TableColumn,
	  DatePicker,
	  TimeSelect,
	  TimePicker,
	  Popover,
	  Tooltip,
	  Breadcrumb,
	  BreadcrumbItem,
	  Form,
	  FormItem,
	  Tabs,
	  TabPane,
	  Tag,
	  Tree,
	  Alert,
	  Slider,
	  Icon,
	  Row,
	  Col,
	  Upload,
	  Progress,
	  Spinner,
	  Badge,
	  Card,
	  Rate,
	  Steps,
	  Step,
	  Carousel,
	  CarouselItem,
	  Collapse,
	  CollapseItem,
	  Cascader,
	  ColorPicker,
	  Transfer,
	  Container,
	  Header,
	  Aside,
	  Main,
	  Footer,
	  Timeline,
	  TimelineItem,
	  Link,
	  Divider,
	  Image,
	  Calendar,
	  Backtop,
	  PageHeader,
	  CascaderPanel,
	  Loading,
	  MessageBox,
	  Message,
	  Notification
	} from 'element-ui';

	Vue.use(Pagination);
	Vue.use(Dialog);
	Vue.use(Autocomplete);
	Vue.use(Dropdown);
	Vue.use(DropdownMenu);
	Vue.use(DropdownItem);
	Vue.use(Menu);
	Vue.use(Submenu);
	Vue.use(MenuItem);
	Vue.use(MenuItemGroup);
	Vue.use(Input);
	Vue.use(InputNumber);
	Vue.use(Radio);
	Vue.use(RadioGroup);
	Vue.use(RadioButton);
	Vue.use(Checkbox);
	Vue.use(CheckboxButton);
	Vue.use(CheckboxGroup);
	Vue.use(Switch);
	Vue.use(Select);
	Vue.use(Option);
	Vue.use(OptionGroup);
	Vue.use(Button);
	Vue.use(ButtonGroup);
	Vue.use(Table);
	Vue.use(TableColumn);
	Vue.use(DatePicker);
	Vue.use(TimeSelect);
	Vue.use(TimePicker);
	Vue.use(Popover);
	Vue.use(Tooltip);
	Vue.use(Breadcrumb);
	Vue.use(BreadcrumbItem);
	Vue.use(Form);
	Vue.use(FormItem);
	Vue.use(Tabs);
	Vue.use(TabPane);
	Vue.use(Tag);
	Vue.use(Tree);
	Vue.use(Alert);
	Vue.use(Slider);
	Vue.use(Icon);
	Vue.use(Row);
	Vue.use(Col);
	Vue.use(Upload);
	Vue.use(Progress);
	Vue.use(Spinner);
	Vue.use(Badge);
	Vue.use(Card);
	Vue.use(Rate);
	Vue.use(Steps);
	Vue.use(Step);
	Vue.use(Carousel);
	Vue.use(CarouselItem);
	Vue.use(Collapse);
	Vue.use(CollapseItem);
	Vue.use(Cascader);
	Vue.use(ColorPicker);
	Vue.use(Transfer);
	Vue.use(Container);
	Vue.use(Header);
	Vue.use(Aside);
	Vue.use(Main);
	Vue.use(Footer);
	Vue.use(Timeline);
	Vue.use(TimelineItem);
	Vue.use(Link);
	Vue.use(Divider);
	Vue.use(Image);
	Vue.use(Calendar);
	Vue.use(Backtop);
	Vue.use(PageHeader);
	Vue.use(CascaderPanel);

	Vue.use(Loading.directive);

	Vue.prototype.$loading = Loading.service;
	Vue.prototype.$msgbox = MessageBox;
	Vue.prototype.$alert = MessageBox.alert;
	Vue.prototype.$confirm = MessageBox.confirm;
	Vue.prototype.$prompt = MessageBox.prompt;
	Vue.prototype.$notify = Notification;
	Vue.prototype.$message = Message;

Â¶å…¨å±€é…ç½®
åœ¨å¼•å…¥ Element æ—¶ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªå…¨å±€é…ç½®å¯¹è±¡ã€‚è¯¥å¯¹è±¡ç›®å‰æ”¯æŒ size ä¸ zIndex å­—æ®µã€‚size ç”¨äºæ”¹å˜ç»„ä»¶çš„é»˜è®¤å°ºå¯¸ï¼ŒzIndex è®¾ç½®å¼¹æ¡†çš„åˆå§‹ z-indexï¼ˆé»˜è®¤å€¼ï¼š2000ï¼‰ã€‚æŒ‰ç…§å¼•å…¥ Element çš„æ–¹å¼ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š

å®Œæ•´å¼•å…¥ Elementï¼š

	import Vue from 'vue';
	import Element from 'element-ui';
	Vue.use(Element, { size: 'small', zIndex: 3000 });

æŒ‰éœ€å¼•å…¥ Elementï¼š

	import Vue from 'vue';
	import { Button } from 'element-ui';

	Vue.prototype.$ELEMENT = { size: 'small', zIndex: 3000 };
	Vue.use(Button);
æŒ‰ç…§ä»¥ä¸Šè®¾ç½®ï¼Œé¡¹ç›®ä¸­æ‰€æœ‰æ‹¥æœ‰ size å±æ€§çš„ç»„ä»¶çš„é»˜è®¤å°ºå¯¸å‡ä¸º 'small'ï¼Œå¼¹æ¡†çš„åˆå§‹ z-index ä¸º 3000ã€‚

Â¶å¼€å§‹ä½¿ç”¨
è‡³æ­¤ï¼Œä¸€ä¸ªåŸºäº Vue å’Œ Element çš„å¼€å‘ç¯å¢ƒå·²ç»æ­å»ºå®Œæ¯•ï¼Œç°åœ¨å°±å¯ä»¥ç¼–å†™ä»£ç äº†ã€‚å„ä¸ªç»„ä»¶çš„ä½¿ç”¨æ–¹æ³•è¯·å‚é˜…å®ƒä»¬å„è‡ªçš„æ–‡æ¡£ã€‚

Â¶ä½¿ç”¨ Nuxt.js
æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Nuxt.jsï¼šhttps://nuxtjs.org/




# âš‘ React for Vue developers
[React for Vue developers](https://sebastiandedeyne.com/react-for-vue-developers/)

## React vs Vue template

Vue çš„ template è¡¨ç¤ºæ¨¡æ¿ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ä¸€å€‹æ¨¡æ¿åŒ…è£¹å…ƒç´ ï¼Œæœ¬èº«ä¸åƒèˆ‡è¦–åœ–çš„æ¸²æŸ“ï¼Œå’Œå¾®ä¿¡å°ç¨‹åºçš„ Block ç¯€é»ä¸€æ¨£ï¼Œè€Œ React å¯ä»¥æ¸²æŸ“æ•°ç»„ï¼Œåªè¦æ•¸çµ„å…ƒç´ æ˜¯åˆæ³•çµ„ä»¶å³å¯ï¼Œæ›´éˆæ´»ï¼Œä½†æ³¨æ„è¦æ·»åŠ  key å±¬æ€§è®“ React åœ¨ç‹€æ…‹æ›´æ–°æ™‚é€²è¡Œæ¯”å°è­˜åˆ¥ã€‚å¯ä»¥æŠŠè¦æ¸²æŸ“çš„ä»»æ„ç»„ä»¶æ”¾å…¥æ•°ç»„ä¸­ï¼Œé€™ç¨®æ–¹å¼å¯ä»¥é¿å… DOM çµæ§‹çš„ç¯€é»å±¤ç´šéå¤šã€‚

	<!-- Greeter.vue -->
	<template>
	  <p>Hello, {{ name }}!</p>
	</template>

	<script>
	export default {
	  props: ['name']
	};
	</script>


	// React uses JSX, which is an extension of ECMAScript.
	export default function Greeter({ name }) {
	  return ["WOo!", <p>Hello, {name}!</p>];
	}


## Rect vs Vue v-if-else

Vue uses v-if, v-else and v-else-if directives to conditionally render parts of a template.

	<!-- Awesome.vue -->
	<template>
	  <article>
	    <h1 v-if="awesome">Vue is awesome!</h1>
	  </article>
	</template>

	<script>
	export default {props: ['awesome'] };
	</script>

React doesnâ€™t support directives, so you need to use the language to conditionally return parts of a template.

The && operator provides a succinct way to write an if statement.

	export default function Awesome({ awesome }) {
	  return (
	    <article>
	      {awesome && <h1>React is awesome!</h1>};
	    </article>
	  );
	}

If you need an else clause, use a ternary statement instead.

	export default function Awesome({ awesome }) {
	  return (
	    <article>
	      {awesome ? (
	        <h1>React is awesome!</h1>
	      ) : (
	        <h1>Oh no ğŸ˜¢</h1>
	      )};
	    </article>
	}

You could also opt to keep the two branches completely separated, and use an early return instead.

	export default function Awesome({ awesome }) {
	  if (!awesome) {
	    return (
	      <article>
	        <h1>Oh no ğŸ˜¢</h1>
	      </article>
	    );
	  }

	  return (
	    <article>
	      <h1>React is awesome!</h1>
	    </article>
	  );
	}


## Rect vs Vue v-for List rendering

React alternative: Array.map

Vue uses the v-for directive to loop over arrays and objects.

	<!-- Recipe.vue -->
	<template>
	  <ul>
	    <li v-for="(ingredient, index) in ingredients" :key="index">
	      {{ ingredient }}
	    </li>
	  </ul>
	</template>

	<script>
	export default {
	  props: ['ingredients']
	};
	</script>

With React, you can â€œmapâ€ the array to a set of elements using the built in Array.map function.

	export default function Recipe({ ingredients }) {
	  return (
	    <ul>
	      {ingredients.map((ingredient, index) => (
	        <li key={index}>{ingredient}</li>
	      ))}
	    </ul>
	  );
	}

Iterating objects is a bit trickier. Vue allows you to use the same v-for directive for keys & values.

	<!-- KeyValueList.vue -->
	<template>
	  <ul>
	    <li v-for="(value, key) in object" :key="key">
	      {{ key }}: {{ value }}
	    </li>
	  </ul>
	</template>

	<script>
	export default {
	  props: ['object'] // E.g. { a: 'Foo', b: 'Bar' }
	};
	</script>

I like to use the built in Object.entries function with React to iterate over objects.

	export default function KeyValueList({ object }) {
	  return (
	    <ul>
	      {Object.entries(object).map(([key, value]) => (
	        <li key={key}>{value}</li>
	      ))}
	    </ul>
	  );
	}


## Rect vs Vue Class and style bindings

React alternative: Manually pass props

Vue automatically binds class and style props to the outer HTML element of a component.

	<!-- Post.vue -->

	<template>
	  <article>
	    <h1>{{ title }}</h1>
	  </article>
	</template>

	<script>
	export default {props: ['title'], };
	</script>

	<!-- <post :title="About CSS" class="margin-bottom" style="color: red" /> -->

With React, you need to manually pass className and style props. Note that style must be an object with React, strings are not supported.

	export default function Post({ title, className, style }) {
	  return (
	    <article className={className} style={style}>
	      {title}
	    </article>
	  );
	}

	{/* <Post title="About CSS" className="margin-bottom" style={{ color: 'red' }} /> */}

If you want to pass down all remaining props, the object rest spread operator comes in handy.

	export default function Post({ title, ...props }) {
	  return (
	    <article {...props}>
	      {title}
	    </article>
	  );
	}

If you miss Vueâ€™s excellent class API, look into [Jed Watsonâ€™s classnames library](https://github.com/JedWatson/classnames).


## Rect vs Vue Props

React alternative: Props

Props behave pretty much the same way in React as Vue. One minor difference: React components wonâ€™t inherit unknown attributes.

	<!-- Post.vue -->

	<template>
	  <h1>{{ title }}</h1>
	</template>

	<script>
	export default {
	  props: ['title'],
	};
	</script>

React style:

	export default function Post({ title }) {
	  return <h3>{title}</h3>;
	}

Using expressions as props in Vue is possible with a : prefix, which is an alias for the v-bind directive. React uses curly braces for dynamic values.

	<!-- Post.vue -->

	<template>
	  <post-title :title="title" />
	</template>

	<script>
	export default {
	  props: ['title'],
	};
	</script>

React style:

	export default function Post({ title }) {
	  return <PostTitle title={title} />;
	}


## React vs Vue Data

React alternative: The useState hook

In Vue the data option is used to store local component state.

	<!-- ButtonCounter.vue -->

	<template>
	  <button @click="count++">
	    You clicked me {{ count }} times.
	  </button>
	</template>

	<script>
	export default {
	  data() {
	    return {
	      count: 0
	    }
	  }
	};
	</script>

React exposes a useState hook which returns a two-element array containing the current state value and a setter function.

	import { useState } from 'react';

	export default function ButtonCounter() {
	  const [count, setCount] = useState(0);

	  return (
	    <button onClick={() => setCount(count + 1)}>
	      {count}
	    </button>
	  );
	}

You can choose whether you prefer to distribute state between multiple useState calls, or keep it in a single object.

	import { useState } from 'react';

	export default function ProfileForm() {
	  const [name, setName] = useState('Sebastian');
	  const [email, setEmail] = useState('sebastian@spatie.be');
	  // ...
	}
	import { useState } from 'react';

	export default function ProfileForm() {
	  const [values, setValues] = useState({
	    name: 'Sebastian',
	    email: 'sebastian@spatie.be'
	  });
	  // ...
	}

## Rect vs Vue v-model

v-model is a convenient Vue directive that combines passing down a value prop with listening to an input event. This makes it look like Vue does two-way binding, while itâ€™s still just â€œprops down, events upâ€ under the hood.

	<!-- Profile.vue -->

	<template>
	  <input type="text" v-model="name" />
	</template>

	<script>
	export default {
	  data() {
	    return {
	      name: 'Sebastian'
	    }
	  }
	};
	</script>

Vue expands the v-model directive to the following:

	<template>
	  <input
	    type="text"
	    :value="name"
	    @input="name = $event.target.value"
	  />
	</template>

React doesnâ€™t have a v-model equivalent. You always need to be explicit:

	import { useState } from 'react';

	export default function Profile() {
	  const [name, setName] = useState('Sebastian');

	  return (
	    <input
	      type="text"
	      value={name}
	      onChange={event => setName(event.target.name)}
	    />
	  );
	}


## Rect vs Vue Computed properties

React alternative: Variables, optionally wrapped in useMemo

Vue has computed properties for two reasons: to avoid mixing logic and markup in templates, and to cache complex computations in a component instance.

Without computed properties:

	<!-- ReversedMessage.vue -->

	<template>
	  <p>{{ message.split('').reverse().join('') }}</p>
	</template>

	<script>
	export default {
	  props: ['message']
	};
	</script>

React Style:

	export default function ReversedMessage({ message }) {
	  return <p>{message.split('').reverse().join('')}</p>;
	}

With React, you can extract the computation from the template by assigning the result to a variable.

	<!-- ReversedMessage.vue -->

	<template>
	  <p>{{ reversedMessage }}</p>
	</template>

	<script>
	export default {
	  props: ['message'],

	  computed: {
	    reversedMessage() {
	      return this.message.split('').reverse().join('');
	    }
	  }
	};
	</script>

React Style:

	export default function ReversedMessage({ message }) {
	  const reversedMessage = message.split('').reverse().join('');

	  return <p>{reversedMessage}</p>;
	}

If performance is a concern, the computation can be wrapped in a useMemo hook. useMemo requires a callback that returns a computed result, and an array of dependencies.

In the following example, reversedMessage will only be recomputed if the message dependency changes.

	import { useMemo } from 'react';

	export default function ReversedMessage({ message }) {
	  const reversedMessage = useMemo(() => {
	    return message.split('').reverse().join('');
	  }, [message]);

	  return <p>{reversedMessage}</p>;
	}


## Rect vs Vue Methods

React alternative: Functions

Vue has a methods option to declare functions that can be used throughout the component.

	<!-- ImportantButton.vue -->

	<template>
	  <button onClick="doSomething">
	    Do something!
	  </button>
	</template>

	<script>
	export default {
	  methods: {
	    doSomething() {
	      // ...
	    }
	  }
	};
	</script>

In React you can declare plain functions inside our component.

	export default function ImportantButton() {
	  function doSomething() {
	    // ...
	  }

	  return (
	    <button onClick={doSomething}>
	      Do something!
	    </button>
	  );
	}



## Rect vs Vue Events

React alternative: Callback props

Events are essentially callbacks that are called when something happened in the child component. Vue sees events as a first-class citizen, so you can â€œlistenâ€ to them with @, which is shorthand for the v-on directive.

	<!-- PostForm.vue -->

	<template>
	  <form>
	    <button type="button" @click="$emit('save')">
	      Save
	    </button>
	    <button type="button" @click="$emit('publish')">
	      Publish
	    </button>
	  </form>
	</template>

Events donâ€™t have any special meaning in React, theyâ€™re just callback props will be called by the child component.

	export default function PostForm({ onSave, onPublish }) {
	  return (
	    <form>
	      <button type="button" onClick={onSave}>
	        Save
	      </button>
	      <button type="button" onClick={onPublish}>
	        Publish
	      </button>
	    </form>
	  );
	}



## Rect vs Vue Event modifiers

React alternative: Higher order functions if you really want

Vue has a few modifiers like prevent and stop to change the way an event is handled without touching itâ€™s handler.

	<!-- AjaxForm.vue -->

	<template>
	  <form @submit.prevent="submitWithAjax">
	    <!-- ... -->
	  </form>
	</template>

	<script>
	export default {
	  methods: {
	    submitWithAjax() {
	      // ...
	    }
	  }
	};
	</script>

Thereâ€™s no modifier syntax in React. Preventing defaults and stopping propagation is mostly handled in the callback.

	export default function AjaxForm() {
	  function submitWithAjax(event) {
	    event.preventDefault();
	    // ...
	  }

	  return (
	    <form onSubmit={submitWithAjax}>
	      {/* ... */}
	    </form>
	  );
	}

If you really want to have something modifier-like, you could use a higher order function.

	function prevent(callback) {
	  return (event) => {
	      event.preventDefault();
	      callback(event);
	  };
	}

	export default function AjaxForm() {
	  function submitWithAjax(event) {
	    // ...
	  }

	  return (
	    <form onSubmit={prevent(submitWithAjax)}>
	      {/* ... */}
	    </form>
	  );
	}



## Rect vs Vue Lifecycle methods

React alternative: The useEffect hook

DISCLAIMER

With class components, React has a very similar API to Vue when it comes to the component lifecycle. With hooks, most lifecycle-related problems can be solved with useEffect. Effects and lifecycle methods are completely different paradigms, so they're hard to compare. In turn, this section is limited to a few practical examples, as effects deserve their own article.

A common case for lifecycle methods is to set up and tear down third party libraries.

	<template>
	  <input type="text" ref="input" />
	</template>

	<script>
	import DateTimePicker from 'awesome-date-time-picker';

	export default {
	  mounted() {
	   this.dateTimePickerInstance =
	     new DateTimePicker(this.$refs.input);
	  },

	  beforeDestroy() {
	    this.dateTimePickerInstance.destroy();
	  }
	};
	</script>

With useEffect, you can declare a â€œside effectâ€ that needs to run after a render. When you return a callback from useEffect, it will be invoked when the effect gets cleaned up. In this case, when the component is destroyed.

	import { useEffect, useRef } from 'react';
	import DateTimePicker from 'awesome-date-time-picker';

	export default function Component() {
	  const dateTimePickerRef = useRef();

	  useEffect(() => {
	    const dateTimePickerInstance =
	      new DateTimePicker(dateTimePickerRef.current);

	    return () => {
	      dateTimePickerInstance.destroy();
	    };
	  }, []);

	  return <input type="text" ref={dateTimePickerRef} />;
	}

This looks similar to registering a beforeDestroy listener in mounted in a Vue component.

	<script>
	export default {
	  mounted() {
	    const dateTimePicker =
	      new DateTimePicker(this.$refs.input);

	    this.$once('hook:beforeDestroy', () => {
	      dateTimePicker.destroy();
	    });
	  }
	};
	</script>

Similar to useMemo, useEffect accepts an array of dependencies as a second parameter.

Without any specified dependencies, the effect will run after every render, and will clean up before every next render. This functionality is similar to a combination of mounted, updated, beforeUpdate and beforeDestroy.

	useEffect(() => {
	    // Happens after every render

	    return () => {
	        // Optional; clean up before next render
	    };
	});

If you specify that the effect has no dependencies, the effect will only run when the component renders the first time, because it has no reason to update. This functionality is similar to a combination of mounted, and beforeDestroyed.

	useEffect(() => {
	    // Happens on mount

	    return () => {
	        // Optional; clean up before unmount
	    };
	}, []);

If you specify a dependency, the effect will only run when the dependency changes. Weâ€™ll get back to this in the watchers section.

	const [count, setCount] = useState(0);

	useEffect(() => {
	    // Happens when `count` changes

	    return () => {
	        // Optional; clean up when `count` changed
	    };
	}, [count]);

Trying to directly translating lifecycle hooks to useEffect calls is generally a bad idea. Itâ€™s better to rethink things as a set of declarative side effects. When the effect is called is an implementation detail.

As Ryan Florence sums it up:

The question is not â€œwhen does this effect runâ€ the question is â€œwith which state does this effect synchronize withâ€

	useEffect(fn) // all state
	useEffect(fn, []) // no state
	useEffect(fn, [these, states])

@ryanflorence on Twitter



## Rect vs Vue Watchers

React alternative: The useEffect hook

Watchers are conceptually similar to lifecycle hooks: â€œWhen X happens, do Yâ€. Watchers donâ€™t exist in React, but you can achieve the same with useEffect.

	<!-- AjaxToggle.vue -->

	<template>
	  <input type="checkbox" v-model="checked" />
	</template>

	<script>
	export default {
	  data() {
	    return {
	      checked: false
	    }
	  },

	  watch: {
	    checked(checked) {
	      syncWithServer(checked);
	    }
	  },

	  methods: {
	    syncWithServer(checked) {
	      // ...
	    }
	  }
	};
	</script>

React Style:

	import { useEffect, useState } from 'react';

	export default function AjaxToggle() {
	  const [checked, setChecked] = useState(false);

	  function syncWithServer(checked) {
	    // ...
	  }

	  useEffect(() => {
	    syncWithServer(checked);
	  }, [checked]);

	  return (
	    <input
	      type="checkbox"
	      checked={checked}
	      onChange={() => setChecked(!checked)}
	    />
	  );
	}

Note that useEffect will also run in the first render. This is the same as using the immediate parameter in a Vue watcher.

If you donâ€™t want the effect to run on the first render, youâ€™ll need to create a ref to store whether or not the first render has happened yet or not.

	import { useEffect, useRef, useState } from 'react';

	export default function AjaxToggle() {
	  const [checked, setChecked] = useState(false);
	  const firstRender = useRef(true);

	  function syncWithServer(checked) {
	    // ...
	  }

	  useEffect(() => {
	    if (firstRender.current) {
	      firstRender.current = false;
	      return;
	    }
	    syncWithServer(checked);
	  }, [checked]);

	  return (
	    <input
	      type="checkbox"
	      checked={checked}
	      onChange={() => setChecked(!checked)}
	    />
	  );
	}



## Rect vs Vue Slots & scoped slots

React alternative: JSX props or render props

If you render a template inside between a componentâ€™s opening and closing tags, React passes it as a children prop.

With Vue, you need to declare a `<slot />` tag where inner contents belong. With React, you render the children prop.

	<!-- RedParagraph.vue -->

	<template>
	  <p style="color: red">
	    <slot />
	  </p>
	</template>

React Style:

	export default function RedParagraph({ children }) {
	  return (
	    <p style={{ color: 'red' }}>
	      {children}
	    </p>
	  );
	}

Since â€œslotsâ€ are just props in React, we donâ€™t need to declare anything in our templates. We can just accept props with JSX, and render them where and when we want.

	<!-- Layout.vue -->

	<template>
	  <div class="flex">
	    <section class="w-1/3">
	        <slot name="sidebar" />
	    </section>
	    <main class="flex-1">
	        <slot />
	    </main>
	  </div>
	</template>

	<!-- In use: -->

	<layout>
	  <template #sidebar>
	    <nav>...</nav>
	  </template>
	  <template #default>
	    <post>...</post>
	  </template>
	</layout>

React Style:

	export default function RedParagraph({ sidebar, children }) {
	  return (
	    <div className="flex">
	      <section className="w-1/3">
	        {sidebar}
	      </section>
	      <main className="flex-1">
	        {children}
	      </main>
	    </div>
	  );
	}

	// In use:

	return (
	  <Layout sidebar={<nav>...</nav>}>
	    <Post>...</Post>
	  </Layout>
	);

Vue has scoped slots to pass data to the slot that will be rendered. The key part of scoped slots is will be rendered.

Regular slots are rendered before they get passed to the parent component. The parent component then decides what to do with the rendered fragment.

Scoped slots canâ€™t be rendered before the parent component, because they rely on data theyâ€™ll receive from the parent component. In a way, scoped slots are lazily evaluated slots.

Lazily evaluating something in JavaScript is rather straightforward: wrap it in a function and call it when needed. If you need a scoped slot with React, pass a function that will render a template when called.

For a scoped slots, we can once again use children, or any other prop for named scoped slots. However, weâ€™ll pass down a function instead of declaring a template.

	<!-- CurrentUser.vue -->

	<template>
	  <span>
	    <slot :user="user" />
	  </span>
	</template>

	<script>
	export default {
	  inject: ['user']
	};
	</script>

	<!-- In use: -->

	<template>
	  <current-user>
	    <template #default="{ user }">
	      {{ user.firstName }}
	    </template>
	  </current-user>
	</template>

React Style:

	import { useContext } from 'react';
	import UserContext from './UserContext';

	export default function CurrentUser({ children }) {
	  const { user } = useContext(UserContext);

	  return (
	    <span>
	      {children(user)}
	    </span>
	  );
	}

	// In use:

	return (
	  <CurrentUser>
	    {user => user.firstName}
	  </CurrentUser>
	);



## Rect vs Vue Provide / inject

React alternative: createContext and the useContext hook

Provide / inject allows a component to share state with its subtree. React has a similar feature called context.

	<!-- MyProvider.vue -->

	<template>
	  <div><slot /></div>
	</template>

	<script>
	export default {
	  provide: {
	    foo: 'bar'
	  },
	};
	</script>

	<!-- Must be rendered inside a MyProvider instance: -->

	<template>
	  <p>{{ foo }}</p>
	</template>

	<script>
	export default {
	  inject: ['foo']
	};
	</script>

React Style:

	import { createContext, useContext } from 'react';

	const fooContext = createContext('foo');

	function MyProvider({ children }) {
	  return (
	    <FooContext.Provider value="foo">
	      {children}
	    </FooContext.Provider>
	  );
	}

	// Must be rendered inside a MyProvider instance:

	function MyConsumer() {
	  const foo = useContext(FooContext);

	  return <p>{foo}</p>;
	}

## Rect vs Vue Custom directives

React alternative: Components

Directives donâ€™t exist in React. However, most problems that directives solve can be solved with components instead.

	<div v-tooltip="Hello!">
	  <p>...</p>
	</div>

React Style:

	return (
	  <Tooltip text="Hello">
	    <div>
	      <p>...</p>
	    </div>
	  </Tooltip>
	);

## Rect vs Vue Transitions

React alternative: Third party libraries

React doesnâ€™t have any built in transition utilities. If youâ€™re looking for something similar to Vue, a library that doesnâ€™t actually animates anything but orchestrates animations with classes, look into react-transition-group.

If you prefer a library that does more heavy lifting for you, look into Pose.




# âš‘ Testing Library æµ‹è¯•
- React Testing Library https://testing-library.com/docs/react-testing-library/example-intro
- React Testing Library - NPM https://www.npmjs.com/org/testing-library
- React Testing Library - Github https://github.com/testing-library/react-testing-library
- Other Utilities - Simulate https://reactjs.org/docs/test-utils.html#simulate

`@testing-library` ç³»åˆ—è½¯ä»¶åŒ…å¯ä»¥å¸®åŠ©æ‚¨ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„æ–¹å¼æµ‹è¯• UI ç»„ä»¶ï¼Œç›®å‰æœ‰ 17 ä¸ªæ¨¡å—ï¼Œè¦†ç›–äº†å½“å‰æµè¡Œå’Œå„ä¸ªå‰ç«¯æ¡†æ¶ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨é¢çš„ React DOM æµ‹è¯•æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªæ¯” Airbnb Enzyme æ›´å¥½çš„æµ‹è¯•æ¡†æ¶ã€‚

ç¼–å†™å¯ç»´æŠ¤çš„æµ‹è¯•ï¼Œä½¿æ‚¨å¯¹ç»„ä»¶æ˜¯å¦ä¸ºç”¨æˆ·å·¥ä½œæœ‰å¾ˆé«˜çš„ä¿¡å¿ƒã€‚åŒæ—¶é¿å…åŒ…å«å®ç°ç»†èŠ‚ï¼Œè¿™æ ·ç»„ä»¶çš„é‡æ„ï¼Œå¯¹å®ç°çš„æ›´æ”¹è€Œä¸æ˜¯åŠŸèƒ½çš„æ›´æ”¹ï¼Œå°±ä¸ä¼šç ´åæ‚¨çš„æµ‹è¯•ï¼Œå¹¶é™ä½æ‚¨å’Œæ‚¨çš„å›¢é˜Ÿçš„é€Ÿåº¦ã€‚

ä½ çš„æµ‹è¯•è¶Šåƒä½ çš„è½¯ä»¶çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±è¶Šèƒ½ç»™ä½ ä¿¡å¿ƒã€‚

å‚è€ƒä¸€ä¸ªç¤ºèŒƒï¼Œä»¥ä¸‹å±•ç¤ºäº†å¦‚ä½• Mock Fetch API å®ç° AJAX è¯·æ±‚çš„ç›‘è§†æµ‹è¯•ï¼Œå¹¶ä¸”æ¿€å‘ Input èŠ‚ç‚¹é”®ç›˜äº‹ä»¶å®Œæˆè¿™ä¸€è¯·æ±‚åŠ¨ä½œï¼š

```js
test('click test', () => {
  const fakeUserResponse = {token: 'fake_user_token'}
  let fetch = window.fetch;

  render(<App />);
  let input = screen.getByPlaceholderText(/Type Block Hash Here/i);

  jest.spyOn(window, 'fetch').mockImplementationOnce((url, ...args) => {
    let hash = url.indexOf(input.value)>-1;
    // console.log("fetch args", hash, input.value)
    expect(hash).toBe(true);
    return fetch(args)
  });
  
  fireEvent.keyDown( input, { key: 'Enter', code: 'Enter' } )
});
```

## react-testing-library ä»‹ç»

- Introducing the react-testing-library https://kentcdodds.com/blog/introducing-the-react-testing-library/

æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ª `HiddenMessage` ç»„ä»¶ï¼Œå®ƒä¼šå°†ç•Œé¢ä¸­çš„ä¸€äº›å­—ç¬¦ä¸²éšè—ï¼Œé…åˆ `userEvent` æ¿€å‘äº‹ä»¶æµ‹è¯•å®ƒæ˜¯ä¸æ˜¯çœŸçš„å¯ä»¥éšè—ï¼š

```js
import '@testing-library/jest-dom/extend-expect'
// NOTE: jest-dom adds handy assertions to Jest and is recommended, but not required
import {render, screen} from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import * as React from 'react'

import HiddenMessage from '../hidden-message'

test('shows the children when the checkbox is checked', () => {
  const testMessage = 'Test Message'
  render(<HiddenMessage>{testMessage}</HiddenMessage>)
  // query* functions will return the element or null if it cannot be found
  // get* functions will return the element or throw an error if it cannot be found
  expect(screen.queryByText(testMessage)).toBeNull()
  // the queries can accept a regex to make your selectors more resilient to content tweaks and changes.
  userEvent.click(screen.getByLabelText(/show/i))
  // .toBeInTheDocument() is an assertion that comes from jest-dom
  // otherwise you could use .toBeDefined()
  expect(screen.getByText(testMessage)).toBeInTheDocument()
})
```


åˆæ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ª `Login` ç»„ä»¶ï¼Œå®ƒä¼šä½¿ç”¨ fetch è¯·æ±‚ç™»å½•ï¼Œç„¶åä½¿ç”¨ `localStorage` æœ¬åœ°å­˜å‚¨æœåŠ¡ä¿å­˜ç™»å½•å‡­è¯ï¼š

	window.localStorage.setItem('token', user.token)

ä½¿ç”¨ `fetch` è¯·æ±‚æ•°æ®ç±»ä¼¼å¦‚ä¸‹æ“ä½œï¼š

	export function loadBlock(hash, setV = ()=>{}, onError = ()=>{}) {
	  // https://www.blockchain.com/api/blockchain_api
	  return fetch("https://blockchain.info/rawblock/"+hash+"?cors=true")
	  .then(res => {
	    return res.json();
	  })
	  .then(json => {
	    setV(json);
	    return json;
	  })
	  .catch(ex => {
	    onError(ex)
	    console.log(ex);
	  });
	}

é‚£ä¹ˆï¼Œä½¿ç”¨ mock æ¥å°è£… Fetch API è¿›è¡Œæµ‹è¯•ï¼š

```js
import '@testing-library/jest-dom/extend-expect'
import {render, screen} from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import * as React from 'react'

import Login from '../login'

test('allows the user to login successfully', async () => {
  // mock out window.fetch for the test
  const fakeUserResponse = {token: 'fake_user_token'}
  jest.spyOn(window, 'fetch').mockImplementationOnce(() => {
    return Promise.resolve({
      json: () => Promise.resolve(fakeUserResponse),
    })
  })
  render(<Login />)
  // fill out the form
  userEvent.type(screen.getByLabelText(/username/i), 'chuck')
  userEvent.type(screen.getByLabelText(/password/i), 'norris')
  userEvent.click(screen.getByText(/submit/i))
  // just like a manual tester, we'll instruct our test to wait for the alert
  // to show up before continuing with our assertions.
  const alert = await screen.findByRole('alert')
  // .toHaveTextContent() comes from jest-dom's assertions
  // otherwise you could use expect(alert.textContent).toMatch(/congrats/i)
  // but jest-dom will give you better error messages which is why it's recommended
  expect(alert).toHaveTextContent(/congrats/i)
  expect(window.localStorage.getItem('token')).toEqual(fakeUserResponse.token)
})
```

æˆ–è€…ä½¿ç”¨ Mock Service Workerï¼ˆMSWï¼‰åˆ›å»ºæµ‹è¯•ç”¨ Web æœåŠ¡å™¨ï¼š

```js
// __tests__/login.js
// again, these first two imports are something you'd normally handle in
// your testing framework configuration rather than importing them in every file.
import '@testing-library/jest-dom'
import * as React from 'react'
// import API mocking utilities from Mock Service Worker.
import {rest} from 'msw'
import {setupServer} from 'msw/node'
// import testing utilities
import {render, fireEvent, screen} from '@testing-library/react'
import Login from '../login'

const fakeUserResponse = {token: 'fake_user_token'}
const server = setupServer(
  rest.post('/api/login', (req, res, ctx) => {
    return res(ctx.json(fakeUserResponse))
  }),
)

beforeAll(() => server.listen())
afterEach(() => {
  server.resetHandlers()
  window.localStorage.removeItem('token')
})
afterAll(() => server.close())

test('allows the user to login successfully', async () => {
  render(<Login />)

  // fill out the form
  fireEvent.change(screen.getByLabelText(/username/i), {
    target: {value: 'chuck'},
  })
  fireEvent.change(screen.getByLabelText(/password/i), {
    target: {value: 'norris'},
  })

  fireEvent.click(screen.getByText(/submit/i))

  // just like a manual tester, we'll instruct our test to wait for the alert
  // to show up before continuing with our assertions.
  const alert = await screen.findByRole('alert')

  // .toHaveTextContent() comes from jest-dom's assertions
  // otherwise you could use expect(alert.textContent).toMatch(/congrats/i)
  // but jest-dom will give you better error messages which is why it's recommended
  expect(alert).toHaveTextContent(/congrats/i)
  expect(window.localStorage.getItem('token')).toEqual(fakeUserResponse.token)
})

test('handles server exceptions', async () => {
  // mock the server error response for this test suite only.
  server.use(
    rest.post('/api/login', (req, res, ctx) => {
      return res(ctx.status(500), ctx.json({message: 'Internal server error'}))
    }),
  )

  render(<Login />)

  // fill out the form
  fireEvent.change(screen.getByLabelText(/username/i), {
    target: {value: 'chuck'},
  })
  fireEvent.change(screen.getByLabelText(/password/i), {
    target: {value: 'norris'},
  })

  fireEvent.click(screen.getByText(/submit/i))

  // wait for the error message
  const alert = await screen.findByRole('alert')

  expect(alert).toHaveTextContent(/internal server error/i)
  expect(window.localStorage.getItem('token')).toBeNull()
})
```


é•‡å‹ä¸å¿…è¦çš„ React DOM 16.8 è­¦å‘Šä¿¡æ¯ï¼š

Warning: An update to ComponentName inside a test was not wrapped in act(...).

```js
// this is just a little hack to silence a warning that we'll get until we
// upgrade to 16.9. See also: https://github.com/facebook/react/pull/14853
const originalError = console.error
beforeAll(() => {
  console.error = (...args) => {
    if (/Warning.*not wrapped in act/.test(args[0])) {
      return
    }
    originalError.call(console, ...args)
  }
})

afterAll(() => {
  console.error = originalError
})
```

è­¦å‘Šï¼šæµ‹è¯•ä¸­å¯¹ ComponentName çš„æ›´æ–°æœªåŒ…è£…åœ¨ `act(...)`ã€‚


## DOM Testing Library
- https://testing-library.com/docs/dom-testing-library/intro
- https://testing-library.com/docs/dom-testing-library/cheatsheet
- https://testing-library.com/docs/dom-testing-library/api-async
- https://testing-library.com/docs/dom-testing-library/api-events

API æ¦‚è¦ï¼š

- `Simulate`: a re-export from the Simulate utility from thereact-dom/test-utilsSimulateobject.
- `wait`: allows you to wait for a non-deterministic period of time in your tests. Normally you should mock out API requests or animations, but even if you're dealing with immediately resolved promises, you'll need your tests to wait for the next tick of the event loop and wait is really good for that. (Big shout out to Åukasz Gozda Gandecki who introduced this as a replacement for the (now deprecated)flushPromises API).
- `render`: This is the meat of the library. It's fairly simple. It creates a divwith document.createElement, then uses ReactDOM.render to render to that div.
The render function returns the following objects and utilities:
- `container`: The div your component was rendered to
- `unmount`: A simple wrapper over ReactDOM.unmountComponentAtNodeto unmount your component (to facilitate easier testing of componentWillUnmount for example).


æ ¹æ®æ–‡æ¡£å±‚æ¬¡ç»“æ„ï¼Œä»¥ä¸‹ Screen API å¯å¸®åŠ©æ‚¨ä»ä¸åŒçš„æŸ¥è¯¢æ–¹æ³•è·å–æµ‹è¯• UI ç›®æ ‡ï¼š

- `screen.getByLabelText()` ï¼ˆè·å– label å…³è”è¡¨å•å…ƒç´ ï¼‰
- `screen.getByPlaceholderText()` ï¼ˆä»…å½“æ‚¨çš„è¾“å…¥æ²¡æœ‰æ ‡ç­¾å…³è”æ—¶ä½¿ç”¨ placeholder å±æ€§æ¥è·å–å…ƒç´ ï¼ï¼‰
- `screen.getByText()` ï¼ˆæ ¹æ®å†…å®¹è·å–ï¼‰
- `screen.getByAltText()` ï¼ˆæ ¹æ® Alt å†…å®¹è·å–å›¾ç‰‡ï¼‰
- `screen.getByTestId()` ï¼ˆè·å– data-testid å…³è”å…ƒç´ æˆ–å…¶ä»–å¥‡æ€ªå…ƒç´ ï¼‰ 

è¿™äº›æ–¹æ³•åœ¨æ²¡æœ‰æƒ³åˆ°ç›¸åº”çš„å…ƒç´ æ—¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéå¸¸æœ‰ç”¨ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åŒ¹é…æ¨¡å¼ï¼š

- ä¸åˆ†å¤§å°å†™çš„éƒ¨åˆ†åŒ¹é…ï¼Œ`lo world` å¯ä»¥åŒ¹é… `Hello World`ï¼›
- æ­£åˆ™åŒ¹é…ï¼Œ`/^Hello World$/` åŒ¹é… `Hello World`ï¼›
- ä¸€ä¸ªæ¥æ”¶ text æˆ– element çš„å›è°ƒå‡½æ•°: `(text, el) => el.tagName === 'SPAN' && text.startsWith('Hello')`ï¼Œæ ¹æ®è¿”å›æ¡ä»¶åŒ¹é…ï¼›

è¿˜æœ‰ç±»ä¼¼çš„ `query*` APIï¼Œå®ƒä»¬å°†è¿”å› nullï¼Œè€Œä¸æ˜¯æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™å¯¹äºæ–­è¨€å…ƒç´ ä¸åœ¨ DOM ä¸­å¾ˆæœ‰ç”¨ã€‚

è¦æ„Ÿè°¢ Anto Aravinth Belgin Rayenï¼Œä»–ä»¬å®ç°äº†ä»¥ä¸‹è¿™ä¸¤ä¸ªæ–¹ä¾¿çš„æµ‹è¯• APIï¼š

- `toBeInTheDOM`: Assert whether an element present in the DOM or not.
- `toHaveTextContent`: Check whether the given element has a text content or not.


### ğŸ‘‰ Appearance and Disappearance

èŠ‚ç‚¹æ•°é‡åˆ¤æ–­

```js
const submitButton = screen.queryByText('submit')
expect(submitButton).toBeNull() // it doesn't exist

const submitButtons = screen.queryAllByText('submit')
expect(submitButtons).toHaveLength(0) // expect no elements
```


æ˜¾ç¤ºä¸éšè—èŠ‚ç‚¹åˆ¤æ–­

```ts
test('movie title appears', async () => {
  // element is initially not present...

  // wait for appearance inside an assertion
  await waitFor(() => {
    expect(getByText('the lion king')).toBeInTheDocument()
  })
})
```

```ts
test('movie title no longer present in DOM', async () => {
  // element is removed
  await waitForElementToBeRemoved(() => queryByText('the mummy'))
})
```

```ts
import '@testing-library/jest-dom/extend-expect'
// use `queryBy` to avoid throwing an error with `getBy`
const submitButton = screen.queryByText('submit')
expect(submitButton).not.toBeInTheDocument()
```

### ğŸ‘‰ Queries API

	|            | No Match | 1 Match | 1+ Match | Await? |
	|------------|----------|---------|----------|--------|
	| getBy      | throw    | return  | throw    | No     |
	| findBy     | throw    | return  | throw    | Yes    |
	| queryBy    | null     | return  | throw    | No     |
	| getAllBy   | throw    | array   | array    | No     |
	| findAllBy  | throw    | array   | array    | Yes    |
	| queryAllBy | []       | array   | array    | No     |

	| By label or aria-label | By input placeholder value | By element text | By form element value  |
	|------------------------|----------------------------|-----------------|------------------------|
	| getByLabelText         | getByPlaceholderText       | getByText       | getByDisplayValue      |
	| queryByLabelText       | queryByPlaceholderText     | queryByText     | queryByDisplayValue    |
	| getAllByLabelText      | getAllByPlaceholderText    | getAllByText    | getAllByDisplayValue   |
	| queryAllByLabelText    | queryAllByPlaceholderText  | queryAllByText  | queryAllByDisplayValue |
	| findByLabelText        | findByPlaceholderText      | findByText      | findByDisplayValue     |
	| findAllByLabelText     | findAllByPlaceholderText   | findAllByText   | findAllByDisplayValue  |

	| By img alt attribute | By title or svg title tag |  By aria role  | By data-testid attribute |
	|----------------------|---------------------------|----------------|--------------------------|
	| getByAltText         | getByTitle                | getByRole      | getByTestId              |
	| queryByAltText       | queryByTitle              | queryByRole    | queryByTestId            |
	| getAllByAltText      | getAllByTitle             | getAllByRole   | getAllByTestId           |
	| queryAllByAltText    | queryAllByTitle           | queryAllByRole | queryAllByTestId         |
	| findByAltText        | findByTitle               | findByRole     | findByTestId             |
	| findAllByAltText     | findAllByTitle            | findAllByRole  | findAllByTestId          |


### ğŸ‘‰ Async

å¼‚æ­¥å‚è€ƒ Async APIï¼Œè®°å¾—åœ¨æµ‹è¯•æ–¹æ³•ä¸­ä½¿ç”¨ await or .then()ã€‚

- waitFor (Promise) retry the function within until it stops throwing or times out
- waitForElementToBeRemoved (Promise) retry the function until it no longer returns a DOM node

Deprecated since v7.0.0:

- wait (Promise) retry the function within until it stops throwing or times
- waitForElement (Promise) retry the function until it returns an element or an array of elements
- findBy and findAllBy queries are async and retry until either a timeout or if the query returns successfully; they wrap waitForElement
- waitForDomChange (Promise) retry the function each time the DOM is changed

å¼‚æ­¥æŸ¥è¯¢ç¤ºèŒƒï¼š

```js
const button = screen.getByRole('button', { name: 'Click Me' })
fireEvent.click(button)
await screen.findByText('Clicked once')
fireEvent.click(button)
await screen.findByText('Clicked twice')
```

ä½¿ç”¨ waitFor å®ç°å¼‚æ­¥ï¼š

```ts
function waitFor<T>(
  callback: () => T | Promise<T>,
  options?: {
    container?: HTMLElement
    timeout?: number
    interval?: number
    onTimeout?: (error: Error) => Error
    mutationObserverOptions?: MutationObserverInit
  }
): Promise<T>

// ...
// Wait until the callback does not throw an error. In this case, that means
// it'll wait until the mock function has been called once.
await waitFor(() => expect(mockAPI).toHaveBeenCalledTimes(1))
// ...
```

ä½¿ç”¨ waitForElementToBeRemoved æŸ¥è¯¢

```ts
function waitForElementToBeRemoved<T>(
  callback: (() => T) | T,
  options?: {
    container?: HTMLElement
    timeout?: number
    interval?: number
    onTimeout?: (error: Error) => Error
    mutationObserverOptions?: MutationObserverInit
  }
): Promise<void>


const el = document.querySelector('div.getOuttaHere')
waitForElementToBeRemoved(document.querySelector('div.getOuttaHere')).then(() =>
  console.log('Element no longer in DOM')
)

el.setAttribute('data-neat', true)
// other mutations are ignored...

el.parentElement.removeChild(el)
// logs 'Element no longer in DOM'
```

### ğŸ‘‰ Events

- fireEvent trigger DOM event: fireEvent(node, event)
- fireEvent.* helpers for default event types
	- click fireEvent.click(node)

è¯­æ³•å‚è€ƒï¼š

	fireEvent(node: HTMLElement, event: Event)
	fireEvent[eventName](node: HTMLElement, eventProperties: Object)
	createEvent[eventName](node: HTMLElement, eventProperties: Object)

	fireEvent.mouseOver(element)
	fireEvent.mouseMove(element)
	fireEvent.mouseDown(element)
	element.focus()
	fireEvent.mouseUp(element)
	fireEvent.click(element)

	fireEvent.keyDown(domNode, { key: 'Enter', code: 'Enter' })
	fireEvent.keyDown(domNode, { key: 'A', code: 'KeyA' })

	// <button>Submit</button>
	fireEvent(
	  getByText(container, 'Submit'),
	  new MouseEvent('click', {
	    bubbles: true,
	    cancelable: true,
	  })
	)

å®Œæ•´ä¾‹å­å‚è€ƒï¼š

```ts
import { render, screen, fireEvent } from '@testing-library/react'

const Button = ({ onClick, children }) => (
  <button onClick={onClick}>{children}</button>
)

test('calls onClick prop when clicked', () => {
  const handleClick = jest.fn()
  render(<Button onClick={handleClick}>Click Me</Button>)
  fireEvent.click(screen.getByText(/click me/i))
  expect(handleClick).toHaveBeenCalledTimes(1)
})
```

```ts
const myEvent = createEvent.click(node, { button: 2 })
fireEvent(node, myEvent)
// myEvent.timeStamp can be accessed just like any other properties from myEvent

// simulate the 'input' event on a file input
fireEvent(
  input,
  createEvent('input', input, {
    target: { files: inputFiles },
    ...init,
  })
)
```

React ç¤ºä¾‹ï¼Œä½¿ç”¨ Jest å‡½æ•°æ¨¡æ‹Ÿï¼š

```ts
import { render, screen, fireEvent } from '@testing-library/react'

const Button = ({ onClick, children }) => (
  <button onClick={onClick}>{children}</button>
)

test('calls onClick prop when clicked', () => {
  const handleClick = jest.fn()
  render(<Button onClick={handleClick}>Click Me</Button>)
  fireEvent.click(screen.getByText(/click me/i))
  expect(handleClick).toHaveBeenCalledTimes(1)
})
```

Other#

- åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­æŸ¥è¯¢å…¶å†…éƒ¨èŠ‚ç‚¹: within(node).getByText("hello")
- é…ç½®å…¨å±€é€‰é¡¹: configure({testIdAttribute: 'my-data-test-id'})


### ğŸ‘‰ Text Match Options

Given the following HTML:

	<div>Hello World</div>

Will find the div:

```js
// Matching a string:
getByText(container, 'Hello World') // full string match
getByText(container, 'llo Worl', { exact: false }) // substring match
getByText(container, 'hello world', { exact: false }) // ignore case

// Matching a regex:
getByText(container, /World/) // substring match
getByText(container, /world/i) // substring match, ignore case
getByText(container, /^hello world$/i) // full string match, ignore case
getByText(container, /Hello W?oRlD/i) // advanced regex

// Matching with a custom function:
getByText(container, (content, element) => content.startsWith('Hello'))
```

Given a button that updates the page after some time:

```js
test('loads items eventually', async () => {
  // Click button
  fireEvent.click(getByText(node, 'Load'))

  // Wait for page to update with query text
  const items = await findByText(node, /Item #[0-9]: /)
  expect(items).toHaveLength(10)
})
```



# âš‘ Serverless äº‘å‡½æ•°ç®¡ä¸­çª¥è±¹
- Serverless æ•™çˆ¶ï¼šäº‘è®¡ç®—çš„ä¸‰æ¬¡æµªæ½® https://zhuanlan.zhihu.com/p/338098414
- Serverless Framework è…¾è®¯äº‘å¼€å‘æ¡†æ¶ https://github.com/serverless/serverless/blob/master/README_CN.md
- è…¾è®¯äº‘ SDK ä¸­å¿ƒ https://cloud.tencent.com/document/sdk
- è…¾è®¯äº‘ API Explorer https://console.cloud.tencent.com/api/explorer
- API å¯†é’¥ç®¡ç† https://console.cloud.tencent.com/cam/capi
- äº‘å‡½æ•°å…è´¹é¢åº¦è¯´æ˜ https://cloud.tencent.com/document/product/583/12282
- https://www.linkedin.com/pulse/20140730172610-9679881-pizza-as-a-service/
- ä¿¡æ¯è®º - ç†µã€äº’ä¿¡æ¯ã€ç›¸å¯¹ç†µ https://zhuanlan.zhihu.com/p/36192699

è¿™é‡Œå»¶ä¼¸ä¸€ä¸‹æˆ‘å¯¹ä¿¡æ¯ç†µçš„ç†è§£ï¼Œå›é¡¾å†å²ï¼ŒIT ç¥–å¸ˆçˆ·æ˜¯æœ‰å®šè®ºçš„ï¼Œå…‹åŠ³å¾·Â·é¦™å†œ Claude Shannon å€Ÿé‰´äº†çƒ­åŠ›å­¦çš„æ¦‚å¿µï¼ŒæŠŠä¿¡æ¯ä¸­æ’é™¤äº†å†—ä½™åçš„å¹³å‡ä¿¡æ¯é‡ç§°ä¸ºä¿¡æ¯ç†µï¼Œå¹¶ç»™å‡ºäº†è®¡ç®—ä¿¡æ¯ç†µçš„æ•°å­¦è¡¨è¾¾å¼ã€‚

é¦™å†œç”¨ä¿¡æ¯ç†µçš„æ¦‚å¿µæè¿°ä¿¡æºçš„ä¸ç¡®å®šåº¦ï¼Œä¿¡æ¯ç†µå®šä¹‰ä¿¡æ¯çš„åŸºæœ¬ä½œç”¨å°±æ˜¯æ¶ˆé™¤äººä»¬å¯¹äº‹ç‰©çš„ä¸ç¡®å®šæ€§ã€‚ä¿¡æ¯è®ºä¸­ç†µä¸ç‰©ç†çƒ­åŠ›å­¦ç†µ Entropy çš„æ¦‚å¿µæœ‰ç€ç´§å¯†çš„è”ç³»ï¼Œçƒ­åŠ›å­¦ä¸­çš„çƒ­ç†µæ˜¯è¡¨ç¤ºåˆ†å­çŠ¶æ€æ··ä¹±ç¨‹åº¦çš„ç‰©ç†é‡ï¼Œå¹¶ä¸”äº‹ç‰©æ€»æ˜¯å‘ç€ç†µå¢çš„æ–¹å‘å‘å±•ã€‚é€šå¸¸ï¼Œä¸€ä¸ªä¿¡æºå‘é€å‡ºä»€ä¹ˆç¬¦å·æ˜¯ä¸ç¡®å®šçš„ï¼Œè¡¡é‡å®ƒå¯ä»¥æ ¹æ®å…¶å‡ºç°çš„æ¦‚ç‡æ¥åº¦é‡ã€‚æ¦‚ç‡å¤§ï¼Œå‡ºç°æœºä¼šå¤šï¼Œä¸ç¡®å®šæ€§å°ï¼›åä¹‹ä¸ç¡®å®šæ€§å°±å¤§ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå½“ä¸€ç§ä¿¡æ¯å‡ºç°æ¦‚ç‡æ›´é«˜çš„æ—¶å€™ï¼Œè¡¨æ˜å®ƒè¢«ä¼ æ’­å¾—æ›´å¹¿æ³›ï¼Œæˆ–è€…è¯´ï¼Œè¢«å¼•ç”¨çš„ç¨‹åº¦æ›´é«˜ã€‚ä»ä¿¡æ¯ä¼ æ’­çš„è§’åº¦æ¥çœ‹ï¼Œä¿¡æ¯ç†µå¯ä»¥è¡¨ç¤ºä¿¡æ¯çš„ä»·å€¼ã€‚

ä¾‹å¦‚ï¼ŒæŠ›ä¸€æšæœ‰å‡åŒ€æ­£åé¢çš„ç¡¬å¸å’Œæ·ä¸€ä¸ªå‡åŒ€å…­é¢çš„éª°å­ï¼Œæ˜¾ç„¶è‰²å­çš„ç†µæ›´å¤§ä¿¡æ¯é‡æ›´å¤šã€‚è€Œæ¶ˆé™¤ç†µçš„è¿‡ç¨‹å°±æ˜¯è·å–ä¿¡æ¯çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚æˆ‘è¯´æˆ‘æŠ›å‡ºçš„ç¡¬å¸ä¸æ˜¯æ­£é¢ï¼Œåœ¨åªæœ‰ä¸¤ç§çŠ¶æ€çš„æƒ…å¢ƒä¸­ç«‹åˆ»å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ä¿¡æ¯ã€‚è€Œå¦‚æœè¯´æˆ‘æŠ›çš„è‰²å­å°äº 3ï¼Œè¿™æ—¶è¿˜æ²¡æœ‰å®Œå…¨æ¶ˆé™¤ä¿¡æ¯ç†µï¼Œæ‰€ä»¥ä¸å®šæ€§è¿˜è¶³å¤Ÿå¤§ä»¥è‡´ä½ ä¸èƒ½çŸ¥é“çœŸæ­£çš„ä¿¡æ¯ã€‚

ä¸€ä¸ªéšæœºå˜é‡çš„ç†µè¶Šå¤§ï¼Œæ„å‘³ç€ä¸ç¡®å®šæ€§è¶Šå¤§ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥éšæœºå˜é‡åŒ…å«çš„ä¿¡æ¯é‡è¶Šå¤§ã€‚ä¿¡æ¯é‡æ˜¯ä»€ä¹ˆå‘¢ï¼ŸæŠ›ä¸€æšç¡¬å¸çš„ä¿¡æ¯é‡å°±æ˜¯ï¼Œæ­£é¢æœä¸Šï¼Œåé¢æœä¸Šï¼Œè¿™é‡ŒåŒ…å«çš„ 2 ç§çŠ¶æ€å°±æ˜¯ä¿¡æ¯é‡ã€‚

ä»å¤ä»£çš„çƒ½ç«å°å¼€å§‹ï¼Œåˆ°è«æ–¯å¯†ç ï¼Œå†åˆ°ç°ä»£çš„æ— çº¿ç”µé€šä¿¡ï¼Œéƒ½æ˜¯åœ¨ä¿¡æ¯ç†µå¢é•¿è¿™æ¡é“è·¯ä¸Šæ‘¸ç´¢å‰è¡Œã€‚çƒ½ç«å°çƒ§ä¸çƒ§ç«ï¼Œçƒ§å‡ºä»€ä¹ˆçƒŸï¼Œæˆ–ä»€ä¹ˆæ—¶é—´çƒ§è¿™äº›éƒ½æ˜¯æœ‰é™çš„çŠ¶æ€ï¼Œå’Œäº‹å…ˆçº¦å®šçš„å«ä¹‰æ˜¯å…³è”çš„ï¼Œèƒ½ä¼ é€’çš„ä¿¡æ¯ä¹Ÿå°±æ˜¯çº¦å®šå¥½çš„ï¼Œä¼ é€’ä¸€ä¸ªç®€å•çš„ä¿¡æ¯ä¹Ÿéœ€è¦å¥½å‡ å¤©å‡ ä¸ªæœˆæ—¶é—´ã€‚

ä¿¡æ¯ç†µçš„è®¡ç®—å…¬å¼å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œä¸€ä¸ªä¿¡æ¯æœ‰ N ç§å¯èƒ½çš„æƒ…å†µï¼Œé‚£ä¹ˆä¿¡æ¯é‡ä¸º log2(N) bit ã€‚

ç»å…¸é—®é¢˜ï¼š25 æ¡¶æ°´ï¼Œå…¶ä¸­ä¸€æ¡¶æœ‰æ¯’ï¼ŒçŒªå–æ¯’æ°´åä¼šåœ¨ 15 åˆ†é’Ÿå†…æ­»å»ï¼Œæƒ³ç”¨ä¸€ä¸ªå°æ—¶æ‰¾åˆ°è¿™æ¡¶æ¯’æ°´ï¼Œè‡³å°‘éœ€è¦å‡ å¤´çŒªï¼Ÿ

é™åˆ¶æ¡ä»¶ï¼š

- ä¸€æ»´æ¯’æ°´è¶³ä»¥å¯¼è‡´ä¸€å¤´çŒªçš„æ­»äº¡ã€‚
- æ­»äº¡æ—¶é—´ä¸º 15 åˆ†é’Ÿå†…ä¸ç¡®å®šçš„æŸä¸ªæ—¶é—´ç‚¹ã€‚
- å…¶æ­»äº¡åªæ˜¯æ¯’æ°´å¯¼è‡´çš„ï¼Œä¸ä¼šæœ‰å…¶ä»–å› ç´ å¯¼è‡´æ­»äº¡ã€‚
- çŒªçš„æ‰¿æ°´é‡æ— ç©·å¤§ï¼Œä¸”å‡è®¾é¥®ä¸€æ¡¶èŠ±è´¹æ—¶é—´ä¸ºé›¶ã€‚
- æ¯æ¡¶æ°´çš„é‡æ— ç©·å¤§ã€‚

ä¿¡æ¯åˆ†æï¼Œæ¯’æ°´å¯èƒ½å‡ºç°åœ¨ä»»æ„ä¸€æ¡¶ï¼Œè¦ç¡®å®šæ˜¯é‚£ä¸€æ¡¶éœ€è¦çš„ä¿¡æ¯é‡ä¸º log2(25) â‰ˆ 4.64 bitã€‚çŒªå–æ¯’æ°´åä¼šåœ¨ 15 åˆ†é’Ÿå†…æ­»å»ï¼Œæƒ³ç”¨ä¸€ä¸ªå°æ—¶æ‰¾åˆ°è¿™æ¡¶æ¯’æ°´ã€‚å¦‚æœå……åˆ†åˆ©ç”¨ä¿¡æ¯ï¼Œä»å¼€å§‹å–‚æ°´åˆ°çŒªçš„æ­»äº¡æ—¶é—´ä¸º 15ï¼Œ30ï¼Œ45ï¼Œ60 åˆ†è¿™å››ä¸ªèŠ‚ç‚¹å¯ä»¥å¾—åˆ°æ­»äº¡ä¸ä¸æ­»ä¸¤ç§ä¿¡æ¯ã€‚ä¸€å¤´çŒªæ´»åˆ°æœ€åèƒ½æä¾›çš„ä¿¡æ¯ä¸º 5 ç§ï¼Œlog2(5) â‰ˆ 2.32 bitã€‚

ä»ä¿¡æ¯çš„è§’åº¦è®¡ç®—ï¼Œä¸€å¤´çŒªèƒ½æä¾›çš„ä¿¡æ¯ä¸º 2.32 bitï¼Œéœ€è¦ 4.64 bit ä¿¡æ¯æ‰èƒ½ç¡®å®šæ¯’æ°´ä½ç½®ï¼Œé‚£ä¹ˆæœ€å°‘éœ€è¦ 4.64/2.32 = 2 å¤´çŒªã€‚

ç®—æ³•è®¾è®¡ï¼š

- æŠŠæ°´ç“¶åˆ†ä¸º 5 è¡Œ 5 åˆ—çŸ©é˜µã€‚
- åœ¨ 0ï¼Œ15ï¼Œ30ï¼Œ45 è¿™å››ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œåˆ†åˆ«è®© A çŒªå– 1ï¼Œ2ï¼Œ3ï¼Œ4 è¡Œçš„æŠ½æ ·ï¼ŒB çŒªå– 1ï¼Œ2ï¼Œ3ï¼Œ4 åˆ—çš„æŠ½æ ·ã€‚
- å¦‚æœçŒªæ­»äº¡ï¼Œé‚£ä¹ˆä»£è¡¨è¡Œæˆ–åˆ—ä¸ºæ¯’æ°´ã€‚å¦‚æœçŒªæ²¡æœ‰æ­»äº¡ï¼Œåˆ™ä»£è¡¨æœ€åä¸€ç“¶ä¸ºæ¯’æ°´ã€‚
- å‡è®¾ A çŒªåœ¨ 15 å†…æ­»äº¡ï¼Œé‚£ä¹ˆæ¯’æ°´ä¸€å®šåœ¨ç¬¬ä¸€è¡Œã€‚B çŒªæ²¡æœ‰æ­»äº¡ï¼Œé‚£ä¹ˆæ¯’æ°´ä¸€å®šåœ¨å 4 åˆ—ã€‚

ç®—æ³•åŸç†åˆ†ææ˜¾ç¤ºï¼Œå› ä¸º A B çš„äº¤é›†åªæœ‰ä¸€ç“¶ï¼Œå¦‚æœåŒæœŸæ­»å°±å½“ä¸‹è¡¨æ˜æ¯’æ°´æ˜¯å“ªç“¶ã€‚å°±ç®—å…ˆæ­»å…¶ä¸€ï¼Œé‚£ä¹ˆä½™ä¸‹çš„ç›®æ ‡æ‰€åœ¨è¡Œæˆ–åˆ—æ˜¯ç¡®å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä» 4 ç“¶ä¸­ç¡®è®¤ï¼Œè¿˜æœ‰ä¸‰ä¸ªæ—¶é—´ç¡®è®¤çª—å£æ˜¯è¶³å¤Ÿçš„ã€‚æ•´ä¸ªç®—æ³•çš„åŸç†éƒ½å›´ç»•åœ¨ä¸¤ä¸ªå…ƒç´ é›†åˆçš„äº¤é›†ï¼Œè®©æ¯å¤´çŒªï¼Œæ¯æ¬¡å–çš„æ°´ä¹‹é—´äº¤é›†å˜å°,æ¯å¤´çŒªä¼šä»æ‰€æœ‰çš„æ°´ä¸­è·å–ä¸€æ¬¡ä¿¡æ¯ã€‚


éšç€å„å¤§äº‘è®¡ç®—å‚å•†çº·çº·æ¨å‡ºäº†å„è‡ªçš„ Serverless äº§å“ä½¿å¾—è¿™ä¸€æ¦‚å¿µæµè¡Œèµ·æ¥ï¼Œä»£è¡¨æ€§çš„æœ‰ AWS lambdaã€Azure Functionã€Google Cloud Functionsã€é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ç­‰ã€‚

ç”¨ä¸€å¥è¯ç®€å•è§£æä¸€ä¸‹ä»€ä¹ˆæ˜¯äº‘å‡½æ•°ï¼Œå½“æœåŠ¡å™¨å¤„ä¸åœ¨æ—¶ï¼Œå°±æ— éœ€æœåŠ¡å™¨äº†ï¼Serverless æ— æœåŠ¡å™¨çœŸæ­£çš„å‡½æ•°ä¹‰å¹¶ä¸æ˜¯æ²¡æœ‰æœåŠ¡å™¨ï¼Œè€Œæ˜¯åœ¨äº‘å¹³å°ä¸‹ï¼ŒæœåŠ¡å™¨æˆä¸ºåŸºå»ºè®¾æ–½ï¼Œå¼€å‘è€…å®Œå…¨ä¸ç”¨å…³å¿ƒå®ƒçš„å­˜åœ¨ã€‚

æœåŠ¡å™¨äº‘ç«¯åŒ–å°†æ— çŠ¶æ€çš„å‡½æ•°ç¨‹åºè¿ç§»åˆ°äº‘ç«¯çš„æœåŠ¡ä¸­ï¼Œç»Ÿä¸€ç®¡ç†ï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯ç›´æ¥ç æ‰ç§æœ‰æœåŠ¡å™¨çš„è¿ç»´æˆæœ¬å’Œç›´æ¥æé«˜äº†å¼€å‘æ•ˆèƒ½ Time to Marketã€‚ç›¸æ¯”ä¼ ç»Ÿçš„æœåŠ¡å™¨éƒ¨ç½²ï¼Œé€šå¸¸è¦ä¸ºäº†å¯¹ä»˜åº”ç”¨çš„æ€§èƒ½å³°å€¼è€Œé…ç½®é«˜æ ‡å‡†çš„ç¡¬ä»¶ï¼Œä½†æ˜¯å¹³æ—¶çš„åº”ç”¨çŠ¶æ€æ˜¯å¤„äºä½æ•ˆèƒ½è¿è¡Œçš„ï¼Œè¿™å°±æ˜¯ç¡¬ä»¶æµªè´¹ï¼Œè€Œäº‘å‡½æ•°è¿™ç§æ¨¡å¼ä¸‹ï¼ŒNo Pay for Idleï¼Œå¯ä»¥å®ç°æŒ‰ä½¿ç”¨ç‡æ”¶è´¹ï¼Œç›´æ¥é™ä½ä¼ä¸šçš„æˆæœ¬ã€‚ä»ä¼šè®¡å­¦çš„è§’åº¦ï¼ŒServerless è®©è®¡ç®—èµ„æºä»å›ºå®šæˆæœ¬å˜æˆäº†å¯å˜æˆæœ¬ã€‚

äº‘å‡½æ•°å¯ä»¥ä¸ºä¼ä¸šå’Œå¼€å‘è€…æä¾›æ— æœåŠ¡å™¨æ‰§è¡Œç¯å¢ƒï¼Œæ— éœ€è´­ä¹°å’Œç®¡ç†æœåŠ¡å™¨çš„æƒ…å†µä¸‹è¿è¡Œä»£ç ç›´æ¥ä½¿ç”¨å¹³å°æ”¯æŒçš„è¯­è¨€ç¼–å†™æ ¸å¿ƒä»£ç å¹¶è®¾ç½®ä»£ç è¿è¡Œçš„æ¡ä»¶ï¼Œå³å¯åœ¨äº‘åŸºç¡€è®¾æ–½ä¸Šå¼¹æ€§ã€å®‰å…¨åœ°è¿è¡Œä»£ç ï¼Œæ˜¯å®æ—¶æ–‡ä»¶å¤„ç†å’Œæ•°æ®å¤„ç†ç­‰åœºæ™¯ä¸‹ç†æƒ³çš„è®¡ç®—å¹³å°ã€‚

Serverless æ¶æ„ç›¸å…³çš„æ¦‚å¿µè¿˜æœ‰ï¼š

- å‡½æ•°å³æœåŠ¡ FaaS - Functions as a Service
- åç«¯å³æœåŠ¡ BasS - Backend as a Sevice

æ€»çš„æ¥è¯´å°±æ˜¯å¼€å‘è€…ç›´æ¥äº«ç”¨æœåŠ¡ï¼Œè€Œä¸éœ€è¦ç†ä¼šç¡¬ä»¶è®¾æ–½ã€‚

ä¸ä¹‹ç›¸å‘¼åº”çš„å¤§æ¦‚å¿µæ˜¯ä»¥ä¸‹ä¸‰ä¸ªï¼š

- IaaS - Infrastructure-as-a-service åŸºç¡€è®¾æ–½æœåŠ¡
- PaaS - Platform-as-a-service å¹³å°æœåŠ¡
- SaaS - Software-as-a-service è½¯ä»¶æœåŠ¡

å®ƒä»¬åœ¨ä¸åŒè§„æ¨¡ä¸Šå®šä¹‰èµ„æºä¸æœåŠ¡çš„å…³ç³»ï¼Œå®ƒä»¬éƒ½æ˜¯ä»¥æœåŠ¡ä¸ºç›®æ ‡å¯¼å‘çš„æ¶æ„ SOA - Service-Orient Architectureï¼Œä¸ºç”¨æˆ·ç®€åŒ–å„ç§ä¸ä¸»è¦ä¸šåŠ¡ä¸ç›¸å…³çš„é—®é¢˜ã€‚

IBM çš„è½¯ä»¶æ¶æ„å¸ˆ Albert Barron æ›¾ç»ä½¿ç”¨ Pizza as a Service ä½œä¸ºæ¯”å–»è§£é‡Šè¿™ä¸ªé—®é¢˜ã€‚David Ng è¿›ä¸€æ­¥å¼•ç”³ï¼ŒSaaS PaaS and IaaS Explained in One Graphic å˜å¾—æ›´å‡†ç¡®æ˜“æ‡‚ã€‚

è¯·è®¾æƒ³ä½ æ˜¯ä¸€ä¸ªé¤é¥®ä¸šè€…ï¼Œæ‰“ç®—åšæŠ«è¨ç”Ÿæ„ã€‚ä¸€ä¸ªåŸå§‹çš„æ–¹æ¡ˆæ˜¯å¯ä»¥ä»å¤´åˆ°å°¾å…¨ç¨‹å‚ä¸ï¼Œè‡ªå·±åšé¢é¥¼ã€é¦…æ–™ã€çƒ˜ç„™ã€åŒ…è£…ç­‰ç­‰ï¼Œç”šè‡³å¨æˆ¿å’Œè®¾å¤‡éƒ½éœ€è¦è‡ªå·±è´­ç½®ã€‚

ç°åœ¨æœ‰äº†ä¸€ä¸ªæ–°çš„ IaaS æ–¹æ¡ˆï¼Œæœ‰å…¬å¸å¯ä»¥å‡ºç§Ÿè®¾å¤‡å’Œå¨æˆ¿ç­‰ç”Ÿäº§å·¥å…·ï¼Œè¿™æ ·ä½ å°±ä¸“ä¸šåˆ¶ä½œä¸»è¥çš„æŠ«è¨å°±å¥½äº†ã€‚

éšç€ç”Ÿæ„è¶Šæ¥è¶Šå¥½ï¼Œå®Œå…¨åšä¸ä¸Šæ¥å–ï¼Œè¿™æ—¶å€™å°±éœ€è¦ PaaS æ–¹æ¡ˆäº†ï¼Œé™¤äº†å‰é¢çš„åŸºç¡€è®¾æ–½å¤–ï¼Œå¹³å°æœåŠ¡è¿˜æä¾›çš„æŠ«è¨çš„é¢é¥¼åŸæ–™å’ŒåŒ…è£…æœåŠ¡ï¼Œä½ åªéœ€ä¿è¯æŠ«è¨å‘³é“å¥½åƒï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¤§ç¨‹åº¦æå‡ç”Ÿäº§æ•ˆç‡ã€‚

ç„¶åå‡ºåäº†ï¼Œä½ å‘ç°åªè¦æœ‰è´§å°±ä¸æ„å–çš„ï¼Œè¿™é‡Œèµ¶ç´§ä¸Š SaaS æ–¹æ¡ˆï¼Œæ‰€æœ‰æŠ«è¨ç”Ÿäº§æœåŠ¡æ‰“åŒ…ç»™æœåŠ¡å¹³å°ï¼Œä½ æ‰‹ä¸Šçš„å·¥ä½œå°±æ˜¯è®¾è®¡å¥½æŠ«è¨å£å‘³å’ŒåŒ…è£…ï¼ŒæœåŠ¡å•†ç›´æ¥é€è´§åˆ°åº—ã€‚

æ‰€ä»¥ï¼Œæœ¬è´¨ä¸Šæ‰€æœ‰è¿™ä¸€åˆ‡é¢å‘æœåŠ¡çš„æ¦‚å¿µéƒ½æ˜¯åœ¨è§£å†³**è½¯ä»¶å¤ç”¨æŠ€æœ¯**ï¼Œæå‡æ•ˆèƒ½è¿™ä¸€å¤§é—®é¢˜ã€‚



SCF åœ¨äº‹ä»¶è§¦å‘æ—¶æ‰§è¡Œï¼Œæ ¹æ®é…ç½®ï¼Œå¦‚å†…å­˜å¤§å°ç­‰è¿›è¡Œèµ„æºåˆ†é…ï¼Œå¹¶å¯åŠ¨å’Œç®¡ç†å®¹å™¨ï¼Œå³å‡½æ•°çš„æ‰§è¡Œç¯å¢ƒã€‚æ¶‰åŠåˆ°å‡½æ•°è¿è¡Œå®¹å™¨çš„åˆ›å»ºã€ç®¡ç†å’Œåˆ é™¤æ¸…ç†æ“ä½œã€‚è¿™æ„å‘³ç€å®¹å™¨å¯åŠ¨éœ€è¦ä¸€äº›æ—¶é—´ï¼Œè¿™ä¼šä½¿æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶å¢åŠ ä¸€äº›å»¶è¿Ÿã€‚ä½†é€šå¸¸ä»…åœ¨é¦–æ¬¡è°ƒç”¨å‡½æ•°ã€æ›´æ–°å‡½æ•°æˆ–é•¿æ—¶é—´æœªè°ƒç”¨æ—¶é‡æ–°è°ƒç”¨å‡½æ•°æ—¶æ‰ä¼šå¯Ÿè§‰åˆ°å»¶è¿Ÿã€‚å¹³å°ä¼šå°è¯•é‡ç”¨å®¹å™¨ï¼Œåœ¨è°ƒç”¨å‡½æ•°åå®¹å™¨ä¼šå­˜ç•™ä¸€æ®µæ—¶é—´ï¼Œé¢„æœŸç”¨äºä¸‹æ¬¡è°ƒç”¨ï¼Œåœ¨æ­¤æ—¶é—´æ®µå†…çš„è°ƒç”¨ä¼šç›´æ¥é‡ç”¨è¯¥å®¹å™¨ã€‚

éšç€äº‘æœåŠ¡çš„çš„å‘å±•ä¸æ™®åŠï¼Œè®¡ç®—èµ„æºé«˜åº¦æŠ½è±¡åŒ–ï¼Œç°ä»£äº‘å¹³å°å¯ä»¥ä»ç‰©ç†æœåŠ¡å™¨åˆ°äº‘å‡½æ•°å’Œæ¨ªè·¨å„ç§æŠ½è±¡ç¨‹åº¦ä¸ºç”¨æˆ·æä¾›æ‰€éœ€è¦çš„è®¡ç®—èµ„æºã€‚

ä»¥è…¾è®¯äº‘ä¸ºä¾‹ï¼Œè®¡ç®—èµ„æºçš„ç®¡ç†æŒ‰ä»¥ä¸‹å‡ ç§ä¸åŒç²’åº¦æä¾›æœåŠ¡ï¼š

- **é»‘çŸ³ç‰©ç†æœåŠ¡å™¨** CPM - Cloud Physical Machineï¼šä»¥ç‰©ç†æœºä¸ºæ‰©å±•å•ä½ï¼Œç”¨æˆ·å®Œå…¨æ‹¥æœ‰æ•´å°å®ä½“è®¡ç®—èµ„æºï¼Œå®‰å…¨æ€§æœ€å¥½ã€‚
- **äº‘æœåŠ¡å™¨** CVM - Cloud Virtual Machineï¼šä»¥äº‘æœåŠ¡å™¨ä¸ºæ‰©å±•å•ä½ï¼Œè™šæ‹ŸåŒ–ç¡¬ä»¶è®¾å¤‡ã€‚ç”¨æˆ·å’Œå…¶ä»–ç§Ÿæˆ·å…±äº«ç‰©ç†æœºèµ„æºï¼Œä»å¯è‡ªè¡Œé…ç½® CVM çš„å„é¡¹æŒ‡æ ‡ï¼Œå¦‚ CPUã€å†…å­˜ã€ç¡¬ç›˜ã€ç½‘ç»œã€å®‰å…¨ç­‰ç­‰ã€‚å¹¶å¯ä»¥åœ¨éœ€æ±‚å‘ç”Ÿå˜åŒ–æ—¶è½»æ¾åœ°è°ƒæ•´ï¼Œç›¸å¯¹éƒ¨ç½²å’Œè¿­ä»£æ›´åŠ ç®€å•ã€‚
- **å®¹å™¨åŒ–** TKE - Tencent Kubernetes Engineï¼šåŸºäº K8s ä»¥å†…å®¹ç¼–æ’å®¹å™¨æœåŠ¡ä¸ºæ‰©å±•å•ä½ï¼Œè™šæ‹ŸåŒ–æ“ä½œç³»ç»Ÿã€‚ä½¿ç”¨ Docker é•œåƒéƒ¨ç½²å¾®æœåŠ¡ï¼Œå®ç°æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´ï¼Œæµ‹è¯•å’Œéƒ¨ç½²éå¸¸è½»æ¾ã€‚
- **äº‘å‡½æ•°** SCF - Serverless Cloud Function ï¼šä»¥å‡½æ•°ä¸ºæ‰©å±•å•ä½ï¼Œè™šæ‹ŸåŒ–è¿è¡Œæ—¶ç¯å¢ƒï¼ˆRuntimeï¼‰ã€‚æ˜¯ç°æœ‰è®¡ç®—èµ„æºçš„æœ€å°å•ä½ï¼Œå…·æœ‰å®Œå…¨è‡ªåŠ¨ã€ä¸€é”®éƒ¨ç½²ã€é«˜åº¦å¯æ‰©å±•ç­‰ç‰¹ç‚¹ï¼Œæ˜¯è½»é‡çº§æœåŠ¡éƒ¨ç½²éå¸¸å¥½çš„é€‰æ‹©ã€‚


Serverless Framework ç‰¹æ€§ï¼š

- æ”¯æŒ Node.js, Python, Java, Go,å’Œ PHP ç­‰è¯­è¨€
- å…¨ç”Ÿå‘½å‘¨æœŸçš„ Serverless åº”ç”¨ç®¡ç†ï¼ˆæ„å»ºï¼Œéƒ¨ç½²ï¼Œæ›´æ–°ï¼Œåˆ é™¤ï¼‰
- é€šè¿‡äº‘å‚å•†æä¾›çš„èƒ½åŠ›ï¼Œå®‰å…¨ã€å¿«é€Ÿçš„éƒ¨ç½²å‡½æ•°ã€äº‹ä»¶å’Œç›¸å…³èµ„æº
- é€šè¿‡æœåŠ¡çš„ç»´åº¦å¯¹å‡½æ•°åˆ†ç»„ï¼Œæ›´å¥½çš„ç®¡ç†ä»£ç ã€å‡½æ•°å’Œéƒ¨ç½²æµç¨‹ï¼Œæ”¯æŒå¤§å‹é¡¹ç›®å¼€å‘å’Œè·¨å›¢é˜Ÿçš„åä½œã€‚
- æç®€é…ç½®ï¼Œæä¾›å®Œæ•´çš„è„šæ‰‹æ¶
- å†…ç½®å¤šä¸ªé˜¶æ®µçš„æ”¯æŒï¼Œæ–¹ä¾¿ç¯å¢ƒéš”ç¦»
- é’ˆå¯¹ CI/CD å·¥ä½œæµè¿›è¡Œäº†ä¼˜åŒ–
- è‡ªåŠ¨åŒ–ã€éƒ¨ç½²é€Ÿåº¦ä¼˜åŒ–ã€å¹¶æä¾›æœ€ä½³å®è·µ
- 100% å¯æ‰©å±•ï¼šæ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•æˆ–è€…ä¿®æ”¹ Serverless Framework
- è‰¯å¥½çš„ Serverless æ’ä»¶ï¼ŒæœåŠ¡å’Œç»„ä»¶çš„ç”Ÿæ€

å®‰è£…æˆ–è€…æ›´æ–° CLI å·¥å…·ï¼Œå¹¶åˆ›å»ºæ¨¡æ¿è¯•ç”¨ï¼š

    npm install -g serverless
    npm update -g serverless
    serverless create --template tencent-nodejs --path severless-service
    cd severless-service
    npm install

æ¡†æ¶ä½¿ç”¨äº†äº‘å‡½æ•°å¼€å‘è€…å·¥å…·ï¼Œè¿˜æœ‰ FSEvents æ¨¡å—ï¼Œå®ƒç”¨æ¥è®¿é—® MacOS å¹³å°åº•å±‚ API æ³¨å†Œç›®å½•æ ‘çŠ¶æ€æ”¹å˜é€šçŸ¥äº‹ä»¶å¤„ç†ç¨‹åºã€‚å¦‚æœåœ¨ Windows å¹³å°ï¼Œå¯ä»¥ä½¿ç”¨ -f è¿›è¡Œå¼ºåˆ¶å®‰è£…ã€‚

ä¿®æ”¹ serverless.yml é…ç½®å‡½æ•°ã€äº‹ä»¶æˆ–è€…å…¶ä»–èµ„æºï¼Œæˆ–è€…ä½ åªæ˜¯å¸Œæœ›æŠŠæœåŠ¡çš„æ›´æ”¹éƒ½æ›´æ–°åˆ°äº‘ç«¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œéƒ¨ç½²ã€‚æˆ–è€…å¿«é€Ÿéƒ¨ç½²å¹¶ä¸”è¦†ç›–äº‘ç«¯çš„ SCF äº‘å‡½æ•°ï¼Œå¹¶ä¸”éƒ¨ç½²å•ä¸ªå‡½æ•°çš„é€Ÿåº¦æ›´å¿«ã€‚

    serverless deploy -v
    serverless deploy function -f hello_world

ä¸Šä¼ å‰éœ€è¦ç™»å½•å¹³å°ï¼Œå½“å‰æ”¯æŒå¾®ä¿¡æ‰«ç ç™»å½•æˆæƒã€‚å¯ä»¥é…ç½®æŒä¹…çš„ç¯å¢ƒå˜é‡/å¯†é’¥ä¿¡æ¯ï¼Œå‚è€ƒè…¾è®¯äº‘è´¦å·é…ç½®æ–‡æ¡£ã€‚

è°ƒç”¨è…¾è®¯äº‘äº‘å‡½æ•° SCFï¼Œå¯ä»¥åœ¨å¦ä¸€çª—å£æ‰“å¼€å®æ—¶æ—¥å¿—ç›‘æµ‹ï¼š

    serverless invoke -f hello_world -l
    serverless logs -f hello_world -t

æœ€åä»äº‘ç«¯è´¦å·ä¸­ç§»é™¤æ‰€æœ‰çš„å‡½æ•°ã€äº‹ä»¶ä»¥åŠèµ„æºã€‚

    serverless remove

å¯ä»¥ä» Github ä¸Šä¸‹è½½å®‰è£…å·²æœ‰æœåŠ¡æ¨¡æ¿ï¼š

    serverless install -u https://github.com/your-url-to-the-serverless-service

ç›®å‰ï¼Œè…¾è®¯äº‘å‡½æ•°æä¾›å¤šç§ SDKï¼Œä»¥ Node.js SDK ä½¿ç”¨ä¸ºä¾‹ï¼š

    npm install tencentcloud-sdk-nodejs --save

ä½¿ç”¨ Node.js SDK å‰éœ€è¦å…ˆå‰å¾€ API å¯†é’¥ç®¡ç†ä¸­å¿ƒè·å–å®‰å…¨å‡­è¯ï¼Œåœ¨è…¾è®¯äº‘æ§åˆ¶å°ä¸Šç”³è¯·å®‰å…¨å‡­è¯åŒ…æ‹¬ `SecretId` å’Œ `SecretKey`ï¼Œåˆ†åˆ«ç”¨äºæ ‡è¯† API è°ƒç”¨è€…çš„èº«ä»½ï¼Œå’ŒåŠ å¯†ç­¾åå­—ç¬¦ä¸²ã€æœåŠ¡å™¨ç«¯éªŒè¯ç­¾åå­—ç¬¦ä¸²ï¼ŒSecretKey å¿…é¡»ä¸¥æ ¼ä¿ç®¡ï¼Œé¿å…æ³„éœ²ã€‚

```js
// Depends on tencentcloud-sdk-nodejs version 4.0.3 or higher
const tencentcloud = require("tencentcloud-sdk-nodejs")

 const clientConfig = {
  credential: {
    secretId:  "*******************",
    secretKey: "*******************",
  },
  region: "ap-guangzhou",
  profile: { // optional
    // signMethod: "HmacSHA256",
    // httpProfile: {
    //   endpoint: "scf.tencentcloudapi.com",
    //   reqMethod: "POST",
    //   reqTimeout: 60,
    // },
  },
}

// CVM client modelsã€‚
const CvmClient = tencentcloud.cvm.v20170312.Client
const cvmClient = new CvmClient(clientConfig)
cvmClient.DescribeZones({/*params*/}).then(
  (data) => {
    console.log("DescribeZones", data)
  },
  (err) => {
    console.error("error", err)
  }
)

// SCF client modelsã€‚
const ScfClient = tencentcloud.scf.v20180416.Client;
const models = tencentcloud.scf.v20180416.Models;

const scfClient = new ScfClient(clientConfig);
const params = {};
scfClient.ListFunctions(params).then(
  (data) => {
    console.log("ListFunctions", data, models);
  },
  (err) => {
    console.error("error", err);
  }
);
```



# âš‘ Travis CI æŒç»­é›†æˆ
- Travis CI æ•™ç¨‹ http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html
- æŒç»­é›†æˆæ˜¯ä»€ä¹ˆï¼Ÿ http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html
- Travis CI Tutorial https://docs.travis-ci.com/user/tutorial/
- SSH deploys with Travis CI https://oncletom.io/2016/travis-ssh-deploy/
- Guide to Continuous Delivery and DevOps https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/
- Installing Dependencies https://docs.travis-ci.com/user/installing-dependencies/
- Job Lifecycle https://docs.travis-ci.com/user/job-lifecycle/
- Deployment https://docs.travis-ci.com/user/deployment/
- Travis CI APIs https://docs.travis-ci.com/user/developer/
- Encryption keys https://docs.travis-ci.com/user/encryption-keys/

ç‰¹æ‹‰ç»´æ–¯ Travis CI æ˜¯ä¸€ä¸ªå…è´¹çš„ï¼Œå‹å¥½é›†æˆ Github æœåŠ¡çš„æŒç»­é›†æˆå·¥å…·ã€‚

ç¼–å†™ä»£ç åªæ˜¯è½¯ä»¶å¼€å‘çš„å…¶ä¸­ä¸€é“å·¥åºï¼Œæ›´å¤šçš„æ—¶é—´å¾€å¾€èŠ±åœ¨æ„å»ºï¼ˆbuildï¼‰å’Œæµ‹è¯•ï¼ˆtestï¼‰ï¼ŒTravis CI å°±æ˜¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ä¹‹ä¸­ï¼Œå¸‚åœºä»½é¢æœ€å¤§çš„ä¸€ä¸ªã€‚

Travis CI åªæ”¯æŒ Githubï¼Œä¸æ”¯æŒå…¶ä»–ä»£ç æ‰˜ç®¡æœåŠ¡ï¼Œå¿…é¡»å°†é¡¹ç›®æ‰˜ç®¡åˆ° GitHub æ‰èƒ½ä½¿ç”¨ Travis CIã€‚

ä½¿ç”¨ Github è´¦æˆ·ç™»å…¥ Travis CI å°±ä¼šåˆ—å‡ºæ‰€æœ‰ä»“åº“ï¼Œä»¥åŠä½ æ‰€å±äºçš„ç»„ç»‡ã€‚åªè¦é€‰æ‹©ä½ éœ€è¦ Travis è‡ªåŠ¨æ„å»ºçš„ä»“åº“ï¼Œæ‰“å¼€ä»“åº“æ—è¾¹çš„å¼€å…³ã€‚ä¸€æ—¦æ¿€æ´»äº†ä¸€ä¸ªä»“åº“ï¼ŒTravis ä¼šç›‘å¬è¿™ä¸ªä»“åº“çš„æ‰€æœ‰å˜åŒ–ã€‚

Travis è¦æ±‚é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œå¿…é¡»æœ‰ä¸€ä¸ª `.travis.yml` é…ç½®æ–‡ä»¶ï¼Œä¸€æ—¦ä»£ç ä»“åº“æœ‰æ–°çš„ Commitï¼ŒTravis å°±ä¼šå»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œé‡Œé¢çš„å‘½ä»¤ã€‚

æŒ‰ç…§ Travis Getting started æ•™ç¨‹åŒæ­¥ GitHub ä»“åº“åº“ï¼Œå¯èƒ½éœ€è¦åœ¨é…ç½®æ–‡ä»¶é¡µä¸­æ‰‹åŠ¨åˆå§‹åŒ–æŸäº›è®¾ç½®ã€‚

æ·»åŠ ä¸€ä¸ª `.travis.yml` é…ç½®æ–‡ä»¶åˆ° Git ä»“åº“ï¼š

```yaml
language: node_js
node_js:
  - 8
cache:
  directories:
    - node_modules
script:
  - npm run build
  - npm test
env:
  - DB=postgres
  - SH=bash
  - PACKAGE_VERSION="1.0.*"
```

ä¸»è¦é…ç½®æ¡ç›®ï¼š

- `language` å­—æ®µæŒ‡å®šäº†é»˜è®¤è¿è¡Œç¯å¢ƒï¼Œè¿™é‡Œè®¾å®šä½¿ç”¨ Node.js ç¯å¢ƒï¼Œåé¢æŒ‡å®šäº†ç‰ˆæœ¬å·ä¸º 8ã€‚
- `script` å­—æ®µæŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼Œè¿™é‡ŒæŒ‡å®šäº† shell è„šæœ¬å‘½ä»¤ã€‚
- `env` å­—æ®µå¯ä»¥å®šä¹‰ç¯å¢ƒå˜é‡ã€‚

åœ¨æ‰§è¡Œ git push æäº¤ä»£ç æ—¶ï¼Œå°±ä¼šè§¦å‘ Travis CI çš„æ„å»ºåŠ¨ä½œï¼Œæ ¹æ®éœ€è¦å®šåˆ¶æ„å»ºè„šæœ¬ï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

Travis çš„è¿è¡Œæµç¨‹åˆ†ä¸ºè®¸å¤šé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥å®šåˆ¶è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œä»»ä½•é¡¹ç›®éƒ½ä¼šç»è¿‡ä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µï¼š

- install é˜¶æ®µï¼šå®‰è£…ä¾èµ–ã€‚
- script é˜¶æ®µï¼šè¿è¡Œè„šæœ¬ã€‚

å®‰è£…é˜¶æ®µæŒ‡å®šå®‰è£…è„šæœ¬æ–‡ä»¶æˆ–è€…å‘½ä»¤ï¼Œæ³¨æ„ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå¤±è´¥ï¼Œæ•´ä¸ªæ„å»ºå°±ä¼šåœä¸‹æ¥ï¼Œä¸å†å¾€ä¸‹è¿›è¡Œã€‚å¦‚æœä¸éœ€è¦å®‰è£…ï¼Œå³è·³è¿‡å®‰è£…é˜¶æ®µï¼Œå°±ç›´æ¥è®¾ä¸º trueã€‚

æŒ‡å®šæ„å»ºæˆ–æµ‹è¯•è„šæœ¬ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå¤±è´¥ï¼Œä¸å½±å“å…¶å®ƒè„šæœ¬å‘½ä»¤ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯ï¼Œæ•´ä¸ªæ„å»ºé˜¶æ®µçš„çŠ¶æ€æ˜¯å¤±è´¥ã€‚

å¦‚æœéœ€è¦æˆåŠŸåæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå°±ä½¿ç”¨é€»è¾‘ç¬¦å·æ‹¼æ¥ï¼Œå†™æˆä¸‹é¢è¿™æ ·ï¼š

	script: command1 && command2

Travis é»˜è®¤æä¾›çš„è¿è¡Œç¯å¢ƒï¼Œç›®å‰ä¸€å…±æ”¯æŒå‡ åç§ä¸»æµè¯­è¨€ï¼Œä»¥åè¿˜ä¼šä¸æ–­å¢åŠ ã€‚

è„šæœ¬æ‰§è¡Œé˜¶æ®µç»“æŸä»¥åï¼Œè¿˜å¯ä»¥è®¾ç½®é€šçŸ¥ notification å’Œéƒ¨ç½² deployment æ­¥éª¤ï¼Œå®ƒä»¬ä¸æ˜¯å¿…é¡»çš„ã€‚

éƒ¨ç½²çš„è„šæœ¬å¯ä»¥åœ¨ script é˜¶æ®µæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Travis ä¸ºå‡ åç§å¸¸è§æœåŠ¡æä¾›çš„å¿«æ·éƒ¨ç½²åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œè¦éƒ¨ç½²åˆ° Github Pagesï¼š

```yaml
deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN # Set in travis-ci.org dashboard
  on:
    branch: master
```

éœ€è¦ä¿å¯†çš„ä¿¡æ¯æ˜æ–‡å­˜åœ¨ Travis çš„ç½‘ç«™æ€•ä¸å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ Travis æä¾›çš„åŠ å¯†åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œå®‰è£… Ruby çš„åŒ… travisï¼Œç„¶åä½¿ç”¨ travis encrypt å‘½ä»¤åŠ å¯†ä¿¡æ¯ã€‚

	$ gem install travis
	$ travis encrypt SOMEVAR=secretvalue
	$ travis encrypt SOMEVAR=secretvalue --add

ä¸Šé¢å‘½ä»¤ä¸­ï¼ŒSOMEVAR æ˜¯è¦åŠ å¯†çš„å˜é‡åï¼Œsecretvalue æ˜¯è¦åŠ å¯†çš„å˜é‡å€¼ï¼Œå±å¹•ä¸Šä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š

	secure: ".... encrypted data ...."

ç°åœ¨ï¼ŒæŠŠè¿™ä¸€è¡ŒåŠ å…¥ `.travis.yml` ç¯å¢ƒé…ç½®ä¸­ï¼š

	env:
	  global:
	    - secure: ".... encrypted data ...."

ç„¶åï¼Œè„šæœ¬é‡Œé¢å°±å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ $SOMEVAR äº†ï¼ŒTravis ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨å¯¹å®ƒè§£å¯†ã€‚

å¯ä»¥ä½¿ç”¨ `--add` å‚æ•°ï¼Œä¼šè‡ªåŠ¨å†™å…¥ç»“æœåˆ° `.travis.yml`ï¼Œçœæ‰äº†ä¿®æ”¹ env å­—æ®µçš„æ­¥éª¤ã€‚

Travis æä¾›äº†åŠ å¯†æ–‡ä»¶åŠŸèƒ½ï¼Œè¦åŠ å¯†çš„æ˜¯æ–‡ä»¶ï¼Œæ¯”å¦‚ç§é’¥ï¼Œå®‰è£…å‘½ä»¤è¡Œå®¢æˆ·ç«¯ä»¥åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç™»å…¥ Travis CIï¼Œè¿›å…¥é¡¹ç›®çš„æ ¹ç›®å½•è¿›è¡Œæ–‡ä»¶åŠ å¯†ï¼š

	$ travis login 
	$ travis encrypt-file bacon.txt
	$ travis encrypt-file bacon.txt --add

å¯¹æ–‡ä»¶ bacon.txt è¿›è¡ŒåŠ å¯†åç”Ÿæˆ bacon.txt.encï¼Œè¯¥æ–‡ä»¶éœ€è¦æäº¤åˆ°ä»£ç åº“ã€‚æ­¤å¤–ï¼Œè¿˜ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶è§£å¯†æ—¶ç”¨åˆ°çš„ç¯å¢ƒå˜é‡ $encrypted_0a6446eb3ae3_keyï¼Œä¿å­˜å¯†é’¥ï¼Œå‚¨å­˜åœ¨ Travis CIã€‚ä½ éœ€è¦æŠŠè§£å¯†æ‰€éœ€çš„ OpenSSL å‘½ä»¤å†™åœ¨ `.travis.yml` çš„ before_install å­—æ®µé‡Œé¢ï¼Œå‘½ä»¤è¡Œæœ‰æç¤ºã€‚


å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œçš„æ­¥éª¤å¦‚ä¸‹ï¼š

- before_install
- install
- before_script
- script
- after_failure
- after_success
- [OPTIONAL] before_deploy
- [OPTIONAL] deploy
- [OPTIONAL] after_deploy
- after_script

æœ€åï¼ŒTravis æ¯æ¬¡è¿è¡Œï¼Œå¯èƒ½ä¼šè¿”å›å››ç§çŠ¶æ€ã€‚

- `passed`ï¼šè¿è¡ŒæˆåŠŸï¼Œæ‰€æœ‰æ­¥éª¤çš„é€€å‡ºç éƒ½æ˜¯ 0
- `canceled`ï¼šç”¨æˆ·å–æ¶ˆæ‰§è¡Œ
- `errored`ï¼šbefore_installã€installã€before_script æœ‰éé›¶é€€å‡ºç ï¼Œè¿è¡Œä¼šç«‹å³åœæ­¢
- `failed` ï¼šscript æœ‰éé›¶çŠ¶æ€ç  ï¼Œä¼šç»§ç»­è¿è¡Œ


ä»¥ä¸‹ä¸‰ä¸ªæ˜¯å½“ä¸‹æµè¡Œçš„è½¯ä»¶å·¥ç¨‹æ¦‚å¿µã€‚

- CI - Continuous Integration æŒç»­é›†æˆ
- CD - Continuous Delivery æŒç»­äº¤ä»˜
- CD - Continuous Deployment æŒç»­éƒ¨ç½²

ä¸€ä¸ªå…¸å‹çš„æ¡ˆä¾‹ä¸»æ˜¯ä½¿ç”¨ Next.js æ¡†æ¶å¼€å‘ React åº”ç”¨ï¼Œä½¿ç”¨ Github æ‰˜ç®¡ä»£ç å’Œ vercel.app è‡ªåŠ¨åŒ–éƒ¨ç½²æœåŠ¡ã€‚åªéœ€è¦å°† Github å·¥ç¨‹ä»“åº“æˆæƒä¸ Vercelï¼Œåœ¨æ¯æ¬¡æäº¤ä»£ç æ—¶ï¼Œéƒ½ä¼šè§¦å‘çº¿ä¸Šçš„æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ç­‰è‡ªåŠ¨åŒ–è¿‡ç¨‹ã€‚

ä¸ DevOPs æ–¹æ³•è®ºä¸€æ ·ï¼ŒDevOps å°±æ˜¯ Developers ç»“åˆ Operatorsï¼Œå³å¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿä¸€ä½“åŒ–ï¼Œç›®çš„å°±æ˜¯æé«˜é¡¹ç›®å¼€å‘çš„æ•ˆç‡ã€‚

ä¸€ä¸ªè½¯ä»¶ä»é›¶å¼€å§‹åˆ°æœ€ç»ˆäº¤ä»˜ï¼Œå¤§æ¦‚åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼šè§„åˆ’ã€ç¼–ç ã€æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒã€éƒ¨ç½²å’Œç»´æŠ¤ï¼ŒDevOps æ ¸å¿ƒå°±æ˜¯è®©æ•´ä¸ªé¡¹ç›®ç›¸å…³çš„å›¢é˜Ÿæˆå‘˜èƒ½åŒæ—¶å‚ä¸è¿›æ¥ã€‚ç›®çš„æ˜¯ä¿ƒè¿›å¼€å‘ã€æŠ€æœ¯è¿è¥å’Œè´¨é‡ä¿éšœ QA éƒ¨é—¨ä¹‹é—´çš„æ²Ÿé€šã€åä½œä¸æ•´åˆï¼Œåœ¨é—®é¢˜å‡ºç°çš„æœ€å¼€å§‹å°±åº”è¯¥è¢«é‡è§†èµ·æ¥ï¼Œä¸ä¹‹ç›¸å…³çš„æ¦‚å¿µå°±æ˜¯æ•æ·å¼€å‘ Agile Developmentï¼Œè€Œè¿™ä¸€åˆ‡åˆä¸è™šæ‹ŸåŒ–ã€å®¹å™¨ã€å¾®æœåŠ¡å¯†åˆ‡å…³è”ã€‚

è¦å®ç°è¿™ä¹ˆé«˜åº¦è‡ªåŠ¨çš„æµæ°´çº¿è½¯ä»¶ç”Ÿäº§ï¼Œå°±å¿…å®šç¦»ä¸å¼€å„ç§å·¥å…·ã€‚

- åä½œå¼€å‘ 
	- æ„å»ºï¼šç‰ˆæœ¬æ§åˆ¶ã€ä»£ç åˆå¹¶ã€æ„å»ºçŠ¶æ€
- æŒç»­é›†æˆ 
	- æµ‹è¯•ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•åŠæµ‹è¯•æŠ¥å‘Š
	- æ‰“åŒ…ï¼šäºŒè¿›åˆ¶ä»“åº“ã€Docker é•œåƒä»“åº“
- éƒ¨ç½²å·¥å…· 
	- å®¹å™¨ï¼šå®¹å™¨æ˜¯è½»é‡çº§çš„è™šæ‹ŸåŒ–ç»„ä»¶ï¼Œå®ƒä»¥éš”ç¦»çš„æ–¹å¼è¿è¡Œåº”ç”¨è´Ÿè½½ã€‚å®ƒä»¬åŸºäºæ“ä½œç³»ç»Ÿæ‰€è™šæ‹ŸåŒ–æŠ€æœ¯è¿è¡Œè‡ªå·±çš„è¿›ç¨‹ã€æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œæ ˆã€‚
	- å‘å¸ƒï¼šå˜æ›´ç®¡ç†ã€è‡ªåŠ¨å‘å¸ƒ
	- ç¼–æ’ï¼šå½“è€ƒè™‘å¾®æœåŠ¡ã€é¢å‘æœåŠ¡çš„æ¶æ„ã€èåˆå¼åŸºç¡€è®¾æ–½ã€è™šæ‹ŸåŒ–å’Œèµ„æºå‡†å¤‡æ—¶ï¼Œè®¡ç®—ç³»ç»Ÿä¹‹é—´çš„åä½œå’Œé›†æˆå°±ç§°ä¸ºç¼–æ’ã€‚é€šè¿‡åˆ©ç”¨å·²å®šä¹‰çš„è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œç¼–æ’ä¿è¯äº†ä¸šåŠ¡éœ€æ±‚æ˜¯å’Œä½ çš„åŸºç¡€è®¾æ–½èµ„æºç›¸åŒ¹é…çš„
	- é…ç½®ç®¡ç†ï¼šåŸºç¡€è®¾æ–½é…ç½®å’Œç®¡ç†ï¼Œç»´æŠ¤ç¡¬ä»¶å’Œè½¯ä»¶æœ€æ–°çš„ã€ç»†èŠ‚çš„è®°å½•-åŒ…æ‹¬ç‰ˆæœ¬ã€éœ€æ±‚ã€ç½‘ç»œåœ°å€ã€è®¾è®¡å’Œè¿ç»´ä¿¡æ¯
	- ç›‘è§†ï¼šæ€§èƒ½ç›‘è§†ã€ç”¨æˆ·è¡Œä¸ºåé¦ˆ
- è­¦å‘Š&åˆ†æï¼Œç»´æŠ¤å·¥å…·ç­‰



æŒç»­ä¸€è¯ç”¨äºæè¿°å·¥ç¨‹æµç¨‹å®è·µï¼Œå¹¶ä¸æ„å‘³ç€â€œä¸€ç›´åœ¨è¿è¡Œâ€ï¼Œè€Œæ˜¯â€œéšæ—¶å¯è¿è¡Œâ€ã€‚

åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µ/æœ€ä½³å®è·µï¼š

- `é¢‘ç¹å‘å¸ƒ`ï¼šæŒç»­å®è·µèƒŒåçš„ç›®æ ‡æ˜¯èƒ½å¤Ÿé¢‘ç¹åœ°äº¤ä»˜é«˜è´¨é‡çš„è½¯ä»¶ã€‚
- `è‡ªåŠ¨åŒ–æµç¨‹`ï¼šå®ç°æ­¤é¢‘ç‡çš„å…³é”®æ˜¯ç”¨è‡ªåŠ¨åŒ–æµç¨‹æ¥ç”Ÿäº§è½¯ä»¶äº§å“ï¼Œè¿™åŒ…æ‹¬æ„å»ºã€æµ‹è¯•ã€åˆ†æã€ç‰ˆæœ¬æ§åˆ¶ï¼Œä»¥åŠåœ¨æŸäº›æƒ…å†µä¸‹çš„éƒ¨ç½²ã€‚
- `å¯é‡å¤`ï¼šè‡ªåŠ¨åŒ–æµç¨‹åœ¨ç»™å®šç›¸åŒè¾“å…¥çš„æƒ…å†µä¸‹å§‹ç»ˆå…·æœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œè¿™ä¸ªè¿‡ç¨‹åº”è¯¥æ˜¯å¯é‡å¤çš„ã€‚
- `å¿«é€Ÿè¿­ä»£`ï¼šå¿«é€Ÿåœ¨è¿™é‡Œæ˜¯ä¸ªç›¸å¯¹æœ¯è¯­ï¼Œä½†æ— è®ºè½¯ä»¶æ›´æ–°ã€å‘å¸ƒçš„é¢‘ç‡å¦‚ä½•ï¼Œé¢„æœŸçš„æŒç»­è¿‡ç¨‹éƒ½ä¼šä»¥é«˜æ•ˆçš„æ–¹å¼å°†æºä»£ç è½¬æ¢ä¸ºäº¤ä»˜ç‰©ã€‚

æŒç»­é›†æˆçš„æµç¨‹ï¼š

- å¼€å‘äººå‘˜æäº¤ä»£ç åˆ° Source Repositoryï¼› 
- å¹¶é€šè¿‡ git hook ç­‰è§¦å‘ CI Server æŒç»­é›†æˆæœåŠ¡å™¨çš„ç›¸å…³åŠŸèƒ½ï¼Œå…¸å‹çš„æ˜¯æ‰§è¡Œç¼–è¯‘ -> æµ‹è¯• -> è¾“å‡ºç»“æœï¼›
- å‘å¼€å‘äººå‘˜åé¦ˆç»“æœçš„ reportï¼›

`æŒç»­é›†æˆ`çš„æ ¸å¿ƒåœ¨äºé€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ç¡®ä¿æ–°å¢çš„ä»£ç èƒ½å¤Ÿä¸åŸå…ˆä»£ç æ­£ç¡®çš„é›†æˆï¼Œä¸åç»­çš„æŒç»­äº¤ä»˜ã€æŒç»­éƒ¨ç½²ç›¸è”æ¥ï¼Œå…¶æœ€ä¸»è¦çš„å·®åˆ«ä¹Ÿå°±åœ¨äºå…¶ç›®æ ‡ä¸åŒã€‚

æŒç»­é›†æˆçš„æµç¨‹å¹¶ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼ŒBuild -> Test æˆ–è€… Test -> Build å¯¹æŒç»­æ€§æ ¸å¿ƒæ¦‚å¿µå¹¶ä¸å†²çªã€‚æŒç»­é›†æˆæœ¬èº«ä½œä¸ºä¸€ç§è½¯ä»¶å·¥ç¨‹çš„æ–¹æ³•æˆ–è€…ç­–ç•¥ï¼Œå…¶å¹¶ä¸è§„å®šå…·ä½“çš„å®ç°ã€‚åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œè¿˜æ˜¯éœ€è¦ç»“åˆå…·ä½“çš„å¼€å‘è¯­è¨€æˆ–è€…å·¥å…·æ¥å®šã€‚

æŒç»­é›†æˆçš„ä¼˜åŠ¿ï¼š

- æ˜“äºå®šä½é”™è¯¯ï¼šæŒç»­é›†æˆé¢‘ç¹çš„æµ‹è¯•æ“ä½œæ— å¼‚å°†å¤æ‚çš„ä»£ç é€»è¾‘åˆ‡å‰²ä¸ºäº†å°å—ï¼Œä½¿å¾—æ¯ä¸€æ¬¡æµ‹è¯•ä¸­é‡åˆ°çš„é”™è¯¯èƒ½å¤Ÿæ›´åŠ å®¹æ˜“çš„è¢«å®šä½ï¼›
- æ˜“äºæ§åˆ¶å¼€å‘æµç¨‹ï¼šæ›´ä¸ºç»†è‡´çš„å·¥ä½œæäº¤ä¹Ÿå°±æ„å‘³ç€æ›´å®¹æ˜“åˆ¤æ–­å½“å‰çš„å·¥ä½œè¿›åº¦ï¼Œè¿™å¯ä»¥ä¸ºç®¡ç†è€…ã€å¼€å‘äººå‘˜çœä¸‹äº†æ±‡æŠ¥äº¤æ¥å·¥ä½œçš„æ—¶é—´ï¼›
- æ˜“äº CodeReviewï¼šå¯¹äºå¤§å—å·¥ä½œçš„åˆ‡åˆ†è‡ªç„¶ä¹Ÿæœ‰åŠ©äºåš CodeReviewï¼›
- æ˜“äºå‡å°‘ä¸å¿…è¦çš„å·¥ä½œï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ„å»ºå¤§å¤§èŠ‚çº¦æ—¶é—´ã€‚

`æŒç»­äº¤ä»˜`æŒ‡çš„æ˜¯ï¼šä¸€ç§èƒ½å¤Ÿä½¿å¾—è½¯ä»¶åœ¨è¾ƒçŸ­çš„å¾ªç¯ä¸­å¯é çš„å‘å¸ƒçš„è½¯ä»¶å·¥ç¨‹æ–¹æ³•ã€‚ä¸æŒç»­é›†æˆç›¸æ¯”ï¼ŒæŒç»­äº¤ä»˜çš„ä¾§é‡ç‚¹åœ¨äº äº¤ä»˜ï¼Œå…¶æ ¸å¿ƒå¯¹è±¡ä¸åœ¨äºä»£ç ï¼Œè€Œåœ¨äºå¯äº¤ä»˜çš„äº§ç‰©ã€‚ç”±äºæŒç»­é›†æˆä»…ä»…é’ˆå¯¹äºæ–°æ—§ä»£ç çš„é›†æˆè¿‡ç¨‹æ‰§è¡Œäº†ä¸€å®šçš„æµ‹è¯•ï¼Œå…¶å˜åŠ¨åˆ°æŒç»­äº¤ä»˜åè¿˜éœ€è¦ä¸€äº›é¢å¤–çš„æµç¨‹ã€‚

ä¸æŒç»­é›†æˆç›¸æ¯”è¾ƒï¼ŒæŒç»­äº¤ä»˜çš„æµç¨‹æ˜¯ Test -> Staging -> Production ä¹Ÿå°±æ˜¯ä¸ºæ–°å¢çš„ä»£ç æ·»åŠ äº†ä¸€ä¸ªä¿è¯ï¼Œç¡®ä¿æ–°å¢çš„ä»£ç åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯å¯ç”¨çš„ã€‚

`æŒç»­éƒ¨ç½²`æ„å‘³ç€ï¼šé€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²çš„æ‰‹æ®µå°†è½¯ä»¶åŠŸèƒ½é¢‘ç¹çš„è¿›è¡Œäº¤ä»˜ã€‚ä¸æŒç»­äº¤ä»˜ä»¥åŠæŒç»­é›†æˆç›¸æ¯”ï¼ŒæŒç»­éƒ¨ç½²å¼ºè°ƒäº†é€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²çš„æ‰‹æ®µï¼Œå¯¹æ–°çš„è½¯ä»¶åŠŸèƒ½è¿›è¡Œé›†æˆã€‚

å¯ä»¥çœ‹åˆ°ï¼ŒåŒ æŒç»­äº¤ä»˜ ç›¸æ¯” æŒç»­é›†æˆ çš„åŒºåˆ«ä½“ç°åœ¨å¯¹ Production çš„è‡ªåŠ¨åŒ–ã€‚ä»å¼€å‘äººå‘˜æäº¤ä»£ç åˆ°ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„å…¨æµç¨‹ä¸éœ€è¦äººå·¥çš„å¹²é¢„ï¼Œå®Œå…¨é€šè¿‡è‡ªåŠ¨åŒ–çš„æ–¹å¼æ‰§è¡Œã€‚è¿™ä¸€ç­–ç•¥åŠ å¿«äº†ä»£ç æäº¤åˆ°åŠŸèƒ½ä¸Šçº¿çš„é€Ÿåº¦ï¼Œä¿è¯æ–°çš„åŠŸèƒ½èƒ½å¤Ÿç¬¬ä¸€æ—¶é—´éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå¹¶è¢«ä½¿ç”¨ã€‚



# âš‘ Jest Test æµ‹è¯•
- https://jestjs.io/zh-Hans/
- http://www.ruanyifeng.com/blog/2016/02/react-testing-tutorial.html
- https://jestjs.io/blog/2016/03/11/javascript-unit-testing-performance.html
- https://reactjs.org/docs/test-utils.html
- https://create-react-app.dev/docs/running-tests

Jest æµ‹è¯• JavaScript (å…¥é—¨ç¯‡)

1 ä»€ä¹ˆæ˜¯ Jest?

	Jest æ˜¯ Facebook çš„ä¸€å¥—å¼€æºçš„ JavaScript æµ‹è¯•æ¡†æ¶ï¼Œ å®ƒè‡ªåŠ¨é›†æˆäº†æ–­è¨€ã€JSDomã€è¦†ç›–ç‡æŠ¥å‘Šç­‰å¼€å‘è€…æ‰€éœ€è¦çš„æ‰€æœ‰æµ‹è¯•å·¥å…·ï¼Œæ˜¯ä¸€æ¬¾å‡ ä¹é›¶é…ç½®çš„æµ‹è¯•æ¡†æ¶ã€‚å¹¶ä¸”å®ƒå¯¹åŒæ ·æ˜¯ Facebook çš„å¼€æºå‰ç«¯æ¡†æ¶ React çš„æµ‹è¯•ååˆ†å‹å¥½ã€‚

2 å®‰è£… Jest

åˆå§‹åŒ– package.jsonï¼Œå¹¶å®‰è£… Jest åŠç›¸å…³ä¾èµ–

	npm init -y

	npm install -D jest babel-jest babel-core babel-preset-env regenerator-runtime

ä½¿ç”¨ Babel å¯ä»¥å®ç° ES6 çš„è¯­æ³•ç‰¹æ€§è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œæä¾›çš„ import æ¥å¯¼å…¥æ¨¡å—çš„æ–¹å¼ã€‚

æ·»åŠ  Babel é…ç½®æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ·»åŠ  .babelrc æ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹:

	{
	  "presets": ["env"]
	}
	
åœ¨ package.json ä¸­æ·»åŠ çš„ test è„šæœ¬è®¾ç½®ï¼Œæ–¹ä¾¿é€šè¿‡ npm test æ‰§è¡Œï¼š

	"scripts": {
	  "test": "jest"
	}

ä½¿ç”¨ TypeScript

	yarn add --dev typescript
	tsc --init

	yarn add --dev @babel/preset-typescript @types/jest

	npm install babel-preset-react-app @babel/core @babel/plugin-proposal-decorators

é…ç½® Bebelï¼Œé”™è¯¯é…ç½®å¯èƒ½å¯¼è‡´ Jest æ— æ³•æµ‹è¯•ç±»å¯¹è±¡çš„ç»§æ‰¿å…³ç³»ï¼š

	// babel.config.js
	module.exports = {
	  presets: [
	    ['@babel/preset-env', {targets: {node: 'current'}}],
	     '@babel/preset-typescript',
	  ],
	};

å°† jest çš„è¿è¡ŒèŒƒå›´é™å®šåœ¨ test æ–‡ä»¶å¤¹ä¸‹ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ï¼Œæ‰€ä»¥åœ¨ package.json ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š

	 "jest": {
	    "testRegex": "/test/.*.test.jsx?$"
	 }


3 ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ªJestæµ‹è¯•

åˆ›å»º src å’Œ test ç›®å½•åŠç›¸å…³æ–‡ä»¶

- åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º src ç›®å½•ï¼Œå¹¶åœ¨ç›®å½•ä¸‹æ·»åŠ  functions.js æ–‡ä»¶
- åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º test ç›®å½•ï¼Œå¹¶åœ¨ç›®å½•ä¸‹åˆ›å»º functions.test.js æ–‡ä»¶

æŒ‰è¿™ç§æ–‡ä»¶å‘½åè§„åˆ™ï¼ŒJest ä¼šè‡ªåŠ¨æ‰¾åˆ°é¡¹ç›®ä¸­æ‰€æœ‰ä½¿ç”¨ .spec.js æˆ– .test.js æ–‡ä»¶å‘½åçš„æµ‹è¯•æ–‡ä»¶å¹¶æ‰§è¡Œã€‚

	// src/functions.js
	export default {
	  sum(a, b) {
	    return a + b;
	  }
	}
	

	// test/functions.test.js
	import functions  from '../src/functions';

	test('sum(2 + 2) ç­‰äº 4', () => {
	  expect(functions.sum(2, 2)).toBe(4);
	})

	// or
	describe('sum', () => {
	  it('works', () => {
	    expect(sum(5, 4)).toEqual(9);
	  });
	});


è¿è¡Œ npm run test åœ¨ shell ä¸­ä¼šæ‰“å°å‡ºä»¥ä¸‹æµ‹è¯•æŠ¥å‘Šï¼š

	 PASS  test/functions.test.js
	  âˆš sum(2 + 2) ç­‰äº 4 (7ms)

	Test Suites: 1 passed, 1 total
	Tests:       1 passed, 1 total
	Snapshots:   0 total
	Time:        4.8s

4 å¸¸ç”¨çš„å‡ ä¸ª Jest æ–­è¨€

å‰é¢ä½¿ç”¨äº†ä¸€æ¡æµ‹è¯•æ–­è¨€ `expect(sth.).toBe(sth.)`ï¼ŒJest æä¾›äº† expect å‡½æ•°ç”¨æ¥åŒ…è£…è¢«æµ‹è¯•çš„æ–¹æ³•å¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå†…å«ä¸€ç³»åˆ—çš„æ¡ä»¶åŒ¹é…å™¨ï¼Œ`toBe()` å‡½æ•°å³ä¸ºä¸€ä¸ªåŒ¹é…å™¨ï¼Œå®ƒçš„å«ä¹‰æ˜¯æœŸå¾…ç›¸ç­‰ã€‚

ğŸ‘‰ `.not` å…è®¸ä½ æµ‹è¯•ç»“æœä¸ç­‰äºæŸä¸ªå€¼çš„æƒ…å†µï¼Œè¿™å’Œè‹±è¯­çš„è¯­æ³•å‡ ä¹å®Œå…¨ä¸€æ ·ï¼Œå¾ˆå¥½ç†è§£ã€‚

	//functions.test.js
	import functions  from '../src/functions'

	test('sum(2, 2) not equal to 5', () => {
	  expect(functions.sum(2, 2)).not.toBe(5);
	})

ğŸ‘‰ `.toEqual()` åŒ¹é…å™¨ä¼šé€’å½’çš„æ£€æŸ¥å¯¹è±¡æ‰€æœ‰å±æ€§å’Œå±æ€§å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ‰€ä»¥å¦‚æœè¦è¿›è¡Œåº”ç”¨ç±»å‹çš„æ¯”è¾ƒæ—¶ï¼Œè¯·ä½¿ç”¨.toEqualåŒ¹é…å™¨è€Œä¸æ˜¯.toBeã€‚

	// functions.js
	export default {
	  getAuthor() {
	    return {
	      name: 'LITANGHUI',
	      age: 24,
	    }
	  }
	}

	// functions.test.js
	import functions  from '../src/functions';

	test('getAuthor() deeply equal to', () => {
	  expect(functions.getAuthor()).toEqual(functions.getAuthor());
	})

	test('getAuthor() deeply not equal to', () => {
	  expect(functions.getAuthor()).not.toBe(functions.getAuthor());
	})

ğŸ‘‰ `.toHaveLength()` å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”¨æ¥æµ‹è¯•å­—ç¬¦ä¸²å’Œæ•°ç»„ç±»å‹çš„é•¿åº¦æ˜¯å¦æ»¡è¶³é¢„æœŸã€‚


	// functions.js
	export default {
	  getIntArray(num) {
	    if (!Number.isInteger(num)) {
	      throw Error('"getIntArray"åªæ¥å—æ•´æ•°ç±»å‹çš„å‚æ•°');
	    }

	    let result = [];
	    for (let i = 0, len = num; i < len; i++) {
	      result.push(i);
	    }
	    
	    return result;
	  }
	}
	// functions.test.js
	import functions  from '../src/functions';

	test('getIntArray(3)è¿”å›çš„æ•°ç»„é•¿åº¦åº”è¯¥ä¸º3', () => {
	  expect(functions.getIntArray(3)).toHaveLength(3);
	})

ğŸ‘‰ `.toThorw()` å¯èƒ½å¤Ÿè®©æˆ‘ä»¬æµ‹è¯•è¢«æµ‹è¯•æ–¹æ³•æ˜¯å¦æŒ‰ç…§é¢„æœŸæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå‡½æ•°å°†å°†è¢«æµ‹è¯•çš„å‡½æ•°åšä¸€ä¸ªåŒ…è£…ï¼Œæ­£å¦‚ä¸Šé¢getIntArrayWrapFnæ‰€åšçš„é‚£æ ·ï¼Œå¦åˆ™ä¼šå› ä¸ºå‡½æ•°æŠ›å‡ºå¯¼è‡´è¯¥æ–­è¨€å¤±è´¥ã€‚

	// functions.test.js
	import functions  from '../src/functions';

	test('getIntArray(3.3)åº”è¯¥æŠ›å‡ºé”™è¯¯', () => {
	  function getIntArrayWrapFn() {
	    functions.getIntArray(3.3);
	  }
	  expect(getIntArrayWrapFn).toThrow('"getIntArray"åªæ¥å—æ•´æ•°ç±»å‹çš„å‚æ•°');
	})

ğŸ‘‰ `.toMatch()` ä¼ å…¥ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬ç”¨æ¥è¿›è¡Œå­—ç¬¦ä¸²ç±»å‹çš„æ­£åˆ™åŒ¹é…ã€‚


	// functions.test.js
	import functions  from '../src/functions';

	test('getAuthor().nameåº”è¯¥åŒ…å«"li"è¿™ä¸ªå§“æ°', () => {
	  expect(functions.getAuthor().name).toMatch(/li/i);
	})

5 æµ‹è¯•å¼‚æ­¥å‡½æ•°

	è¿™é‡Œä½¿ç”¨æœ€å¸¸ç”¨çš„ axios æ¥è¿›è¡Œ HTTP è¯·æ±‚

	npm install axios

	ä½¿ç”¨ç”± JSONPlaceholder æä¾›çš„ mock è¯·æ±‚åœ°å€

	// functions.js
	import axios from 'axios';

	export default {
	  fetchUser() {
	    return axios.get('http://jsonplaceholder.typicode.com/users/1')
	      .then(res => res.data)
	      .catch(error => console.log(error));
	  }
	}


	// functions.test.js
	import functions  from '../src/functions';

	test('fetchUser()', () => {
	  expect.assertions(1);
	  return functions.fetchUser()
	    .then(data => {
	      expect(data.name).toBe('Leanne Graham');
	    });
	})

expect.assertions(1)ï¼Œå®ƒèƒ½ç¡®ä¿åœ¨å¼‚æ­¥çš„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæœ‰ä¸€ä¸ªæ–­è¨€ä¼šåœ¨å›è°ƒå‡½æ•°ä¸­è¢«æ‰§è¡Œï¼Œè¿™åœ¨è¿›è¡Œå¼‚æ­¥ä»£ç çš„æµ‹è¯•ä¸­ååˆ†æœ‰æ•ˆã€‚

ä½¿ç”¨ async å’Œ await ç²¾ç®€å¼‚æ­¥ä»£ç 

	test('fetchUser()', async () => {
	  expect.assertions(1);
	  const data =  await functions.fetchUser();
	  expect(data.name).toBe('Leanne Graham')
	})

å®‰è£…äº† Babelï¼Œä½¿ç”¨ async å’Œ await çš„è¯­æ³•æ¥ç²¾ç®€å¼‚æ­¥æµ‹è¯•ä»£ç ï¼Œä½†æ˜¯åˆ«å¿˜è®°éƒ½éœ€è¦è°ƒç”¨ expect.assertions() æ–¹æ³•

å’Œä¹‹å‰ä»‹ç»çš„ mocha å’Œ chai çš„åŠŸèƒ½å¾ˆåƒï¼Œç”šè‡³å¯ä»¥å…¼å®¹éƒ¨åˆ† mocha å’Œ chai çš„è¯­æ³•ã€‚å¯ä»¥è¿™ä¹ˆå†™

	import React from 'react'
	import { shallow } from 'enzyme'
	import CommentItem from './commentItem'

	describe('æµ‹è¯•è¯„è®ºåˆ—è¡¨é¡¹ç»„ä»¶', () => {
	  // è¿™æ˜¯mochaçš„ç©æ³•ï¼Œjestå¯ä»¥ç›´æ¥å…¼å®¹
	  it('æµ‹è¯•è¯„è®ºå†…å®¹å°äºç­‰äº200æ—¶ä¸å‡ºç°å±•å¼€æ”¶èµ·æŒ‰é’®', () => {
	    const propsData = {
	      name: 'hj',
	      content: 'æµ‹è¯•æ ‡é¢˜'
	    }
	    const item = shallow(<CommentItem {...propsData} />)
	    // è¿™é‡Œçš„æ–­è¨€å®é™…ä¸Šå’Œchaiçš„expectæ˜¯å¾ˆåƒçš„
	    expect(item.find('.btn-expand').length).toBe(0);
	  })
	  // è¿™æ˜¯jestçš„ç©æ³•ï¼Œæ¨èç”¨è¿™ç§
	  test('ä¸¤æ•°ç›¸åŠ ç»“æœä¸ºä¸¤ä¸ªæ•°å­—çš„å’Œ', () => {
	    expect(3).toBe(3);
	  });
	}
	
	jest ä¸ eslint æ£€æµ‹
	å¦‚æœçœ‹äº†ä¸Šé¢çš„ä»£ç ä¼šå‘ç°æˆ‘æ²¡æœ‰å¼•ç”¨ä»»ä½•ç±»ä¼¼äº

	import *  from 'jest'
	
	çš„ä»£ç ï¼Œè€Œé‚£ä¸ª expect æ˜¯æ²¡æœ‰å®šä¹‰çš„ã€‚
	è¿™æ®µä»£ç ç›´æ¥è¿è¡Œ jest å‘½ä»¤æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯ eslint ä¼šæ£€æµ‹å‡ºé”™ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥åœ¨ eslint é…ç½®æ–‡ä»¶ .eslintrc ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š

	"env": {
	    "jest": true
	},
	
Jest æ–­è¨€ï¼š

	expect({a:1}).toBe({a:1})					// åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰
	expect(1).not.toBe(2);						// åˆ¤æ–­ä¸ç­‰
	expect(n).toBeNull(); 						// åˆ¤æ–­æ˜¯å¦ä¸ºnull
	expect(n).toBeUndefined(); 					// åˆ¤æ–­æ˜¯å¦ä¸ºundefined
	expect(n).toBeDefined(); 					// åˆ¤æ–­ç»“æœä¸toBeUndefinedç›¸å
	expect(n).toBeTruthy(); 					// åˆ¤æ–­ç»“æœä¸ºtrue
	expect(n).toBeFalsy(); 						// åˆ¤æ–­ç»“æœä¸ºfalse
	expect(value).toBeGreaterThan(3); 			// å¤§äº3
	expect(value).toBeGreaterThanOrEqual(3.5); 	// å¤§äºç­‰äº3.5
	expect(value).toBeLessThan(5); 				// å°äº5
	expect(value).toBeLessThanOrEqual(4.5); 	// å°äºç­‰äº4.5
	expect(value).toBeCloseTo(0.3); 			// æµ®ç‚¹æ•°åˆ¤æ–­ç›¸ç­‰
	expect('Christoph').toMatch(/stop/); 		// æ­£åˆ™è¡¨è¾¾å¼åˆ¤æ–­
	expect(['one','two']).toContain('one'); 	// ä¸è§£é‡Š

	function compileAndroidCode() {
	  throw new ConfigError('you are using the wrong JDK');
	}

	test('compiling android goes as expected', () => {
	  expect(compileAndroidCode).toThrow();
	  expect(compileAndroidCode).toThrow(ConfigError); //åˆ¤æ–­æŠ›å‡ºå¼‚å¸¸
	}ï¼‰

æ›´å¤šæ–­è¨€ç©æ³•

	ä»‹ç»äº†jestæ›¿ä»£mochaå’Œchaiçš„éƒ¨åˆ†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±çœ‹çœ‹å¦‚ä½•æ›¿ä»£sinonã€‚
	ä¸‹é¢æ˜¯å®˜ç½‘çš„ç¤ºä¾‹ï¼š

	function forEach(items, callback) {
	  for (let index = 0; index < items.length; index++) {
	   callback(items[index]);
	  }
	}

	const mockCallback = jest.fn();
	forEach([0, 1], mockCallback);

	// åˆ¤æ–­æ˜¯å¦è¢«æ‰§è¡Œä¸¤æ¬¡
	expect(mockCallback.mock.calls.length).toBe(2);

	// åˆ¤æ–­å‡½æ•°è¢«é¦–æ¬¡æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå½¢å‚ä¸º0
	expect(mockCallback.mock.calls[0][0]).toBe(0);

	// åˆ¤æ–­å‡½æ•°ç¬¬äºŒæ¬¡è¢«æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå½¢å‚ä¸º1
	expect(mockCallback.mock.calls[1][0]).toBe(1);

ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°è¿™ç§ç©æ³•å¾ˆç±»ä¼¼äºsinonçš„ sinon.spy()ã€‚å½“ç„¶ä¹Ÿæœ‰ç±»ä¼¼äºstubè¿”å›å€¼çš„é‚£ç§ç©æ³•ï¼Œæ›´å¤šçš„è¯·å‚è€ƒ jest mockçš„æ›´å¤šç©æ³•

mock æ–‡ä»¶å’Œ css module çš„é—®é¢˜

	å¦‚æœjsæ–‡ä»¶ä¸­å¼•ç”¨äº†cssæˆ–è€…æœ¬åœ°å…¶ä»–æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯èƒ½æµ‹è¯•å¤±è´¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†æé«˜æµ‹è¯•æ•ˆç‡ï¼š

	"jest": {
	    "moduleNameMapper": {
	     "\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$": "<rootDir>/test/config/fileMock.js",
	     "\\.(css|less)$": "identity-obj-proxy"
	 }
	
	è€ŒfileMock.jsæ–‡ä»¶å†…å®¹ä¸ºï¼š

	module.exports = 'test-file-stub';
	
	ç„¶åå®‰è£…identity-obj-proxyå³å¯ï¼š

	npm install --save-dev identity-obj-proxy
	
åœ¨webpackä¸­ç»å¸¸ä¼šç”¨åˆ°åˆ«åï¼Œè€Œjestæµ‹è¯•æ—¶ï¼Œå¦‚æœæ–‡ä»¶ä¸­å¼•ç”¨äº†åˆ«åä¼šå‡ºç°æ‰¾ä¸åˆ°æ–‡ä»¶çš„é—®é¢˜ã€‚æ¯•ç«Ÿjestæµ‹è¯•æ—¶æ²¡æœ‰ç»è¿‡webpackå¤„ç†ã€‚å¯¹äºä»¥ä¸‹ç©æ³•

	resolve: {  
	    alias: {  
	        common: path.resolve(__dirname, 'plugins/common/')  
	    }  
	} 
	
	å¯ä»¥é€šè¿‡

	"jest": {
	    "testRegex": "./src/test/.*.test.js$",
	    "moduleNameMapper": {
	      "^common(.*)$": "<rootDir>/plugins/common$1",
	    }
	}
	
	è¿™ä¸ªå’Œä¹‹å‰ mockæ–‡ä»¶å’Œcss moduleçš„é—®é¢˜ ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†moduleNameMapperè¿™ä¸ªå±æ€§

	ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
	åªéœ€è¦åœ¨jestå‘½ä»¤ååŠ å…¥ --coverageå³å¯

	jest --coverage
