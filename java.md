
# ğŸš© Book Ref

Java æŠ€æœ¯ä¹¦ç±å¤§å…¨ PDF (https://github.com/dahuoyzs/javapdf)

	Head First Java(ç¬¬2ç‰ˆ)ä¸­æ–‡ç‰ˆ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1s6OL72c4HWlgDRgWssDoJQ æå–ç ï¼še6j1

	Effective Javaä¸­æ–‡ç‰ˆ(ç¬¬2ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1n7Po4pJM7H__spiVkjJixA æå–ç ï¼š5jyl

	Effective.Javaä¸­æ–‡ç‰ˆ(ç¬¬3ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1moNzNVhlTZMRlTUEcNMlxg æå–ç ï¼šrfc7

	Hadoopæƒå¨æŒ‡å—(ç¬¬2ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1isOm16xKlqOa1BraBhzqdA æå–ç ï¼škpu6

	Hadoopæƒå¨æŒ‡å—å¤§æ•°æ®çš„å­˜å‚¨ä¸åˆ†æ(ç¬¬4ç‰ˆ-å‡çº§-ä¿®è®¢ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/16uJPdsnvHdm6FFmT7xz5vw æå–ç ï¼š08vg

	JavaåŠ å¯†ä¸è§£å¯†çš„è‰ºæœ¯ æ¢æ ‹.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1WILNurQGoZDPgERo3GrpeQ æå–ç ï¼šdolc

	Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜_å¸¦ç›®å½•.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1lnBsCvVJ_p1mTLtMetgvyg æå–ç ï¼šha8s

	Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1PK0q5e6Dg-DPgJXrwYyEWw æå–ç ï¼šrro7

	Javaç¨‹åºæ€§èƒ½ä¼˜åŒ–-è®©ä½ çš„Javaç¨‹åºæ›´å¿«,æ›´ç¨³å®š[è‘›ä¸€é¸£].pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1xyxHK9UDshp7Eou1vjob7w æå–ç ï¼šlk8v

	Javaè™šæ‹Ÿæœºè§„èŒƒ(Java SE 8ç‰ˆ)(å¸¦ä¹¦ç­¾å®Œæ•´ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1bF3ypUPbTVAc1TyorNpUjg æå–ç ï¼škb2a

	LogBackä¸­æ–‡æ–‡æ¡£.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dB4LysHST-QiKXQyIWUxEA æå–ç ï¼šsjjq

	MapReduceè®¾è®¡æ¨¡å¼ï¼ˆç¾ï¼‰.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1VnaeO_qCwM9sfEkLcqSkLw æå–ç ï¼š98gg

	Netty å…¥é—¨ä¸å®æˆ˜ï¼šä»¿å†™å¾®ä¿¡ IM å³æ—¶é€šè®¯ç³»ç»Ÿ.docx
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1jdrl_ikS8yXwW3jkUyFYkg æå–ç ï¼švxwi

	On Java 8(Javaç¼–ç¨‹æ€æƒ³ç¬¬äº”ç‰ˆ)-è‹±æ–‡.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/182kzwlRF4hfJ6cke_V-iGg æå–ç ï¼š007z

	Spring Cloudå¾®æœåŠ¡å®æˆ˜.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sjsz_M5bA7rDUFkOTTSQ1g æå–ç ï¼šz9gd

	SpringæŠ€æœ¯å†…å¹•-æ·±å…¥è§£æSpringæ¶æ„ä¸è®¾è®¡åŸç†(ç¬¬2ç‰ˆ)å¸¦ä¹¦ç­¾.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1UClmWWN4CpQUiu87EkPN9w æå–ç ï¼št14m

	Springæºç æ·±åº¦è§£æ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1TXEeIQJlkvMvZ9Z6FR71Aw æå–ç ï¼šmhex

	ã€ŠSpring Boot+Vueå…¨æ ˆå¼€å‘å®æˆ˜ã€‹_ç‹æ¾_2018-12-01.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1FGUFBuWGnVAqEMMC7_oI5Q æå–ç ï¼š5823

	ã€Šæ·±å…¥ç†è§£Spring Cloudä¸å¾®æœåŠ¡æ„å»ºã€‹.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1evN4tCPDkQCgpKSbfyc67g æå–ç ï¼šiuds

	å†™ç»™å¤§å¿™äººçœ‹çš„JavaSE8.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/19fCS_oYNPpTn9HE-LO5ifA æå–ç ï¼š5oyt

	æ·±å…¥ç†è§£Javaè™šæ‹ŸæœºJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µç¬¬2ç‰ˆ(å‘¨å¿—æœ‹).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1d_5IrA9ZWFBT0GO6tqd3IQ æå–ç ï¼šuhlr

	æ·±å…¥ç†è§£Javaè™šæ‹ŸæœºJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µç¬¬3ç‰ˆ(å‘¨å¿—æœ‹).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1osx-E5P4qB1B465YL_N6_w æå–ç ï¼še101

	æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬2ç‰ˆ(BillVennersè‘—æ›¹æ™“åˆšè¯‘).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1RASOQfqLuJn7sUd0T3Z9mA æå–ç ï¼šnwca

	HotSpotå®æˆ˜.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1-2BpDo95LhvG-O4a_Sup4A æå–ç ï¼š6fhf

	Java Performance.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/16zEU6fnsZMnaG5lqyPD8ww æå–ç ï¼šaw65

	Core Java, Volume II--Advanced-Cay S. Horstmann.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1mtomhSVE9FSQfgyc8ulP7A æå–ç ï¼š4pfb

	æ•°æ®åº“
	MySQLå¿…çŸ¥å¿…ä¼š(æ–‡å­—ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/15hcVf3b4qHtoiLKmWg6GdA æå–ç ï¼šeptx

	MySQLæ€§èƒ½è°ƒä¼˜ä¸æ¶æ„è®¾è®¡.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Y_SGIBwiav11eeTGPiLb7Q æå–ç ï¼šnbd5

	MySQLæŠ€æœ¯å†…å¹•InnoDBå­˜å‚¨å¼•æ“(ç¬¬1ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/10sRLE9KDUogBzlTFb-06jg æå–ç ï¼šnqyw

	MySQLæŠ€æœ¯å†…å¹•InnoDBå­˜å‚¨å¼•æ“(ç¬¬2ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1EYIIYvwwfufifH1QWdaPqw æå–ç ï¼šl0ij

	SQLå­¦ä¹ æŒ‡å—(ç¬¬2ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1iYKE0Vst8o6JIaoHTtdAzg æå–ç ï¼šfn1f

	æ·±å…¥æµ…å‡ºMySQL++æ•°æ®åº“å¼€å‘ã€ä¼˜åŒ–ä¸ç®¡ç†ç»´æŠ¤+ç¬¬2ç‰ˆ+å”æ±‰æ˜.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Kky9OSKlD8PLx6qG-kCyHA æå–ç ï¼š4mj4

	æ·±å…¥æµ…å‡ºMySQL.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1K8mAUW3GADYcHb30uh7x8w æå–ç ï¼šivsf

	æ¼«ç”»æ•°æ®åº“.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1edW10NPRXoPLwQL4t20sMw æå–ç ï¼šczms

	é«˜æ€§èƒ½çš„MySQL(ç¬¬3ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1MDT3GzoHdZR7iTCZAFY1gQ æå–ç ï¼šw8oy

	ç®—æ³•
	Javaæ•°æ®ç»“æ„å’Œç®—æ³•ï¼ˆç¬¬äºŒç‰ˆï¼‰.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1RZZ3uoQlr5rQow119lsG2g æå–ç ï¼š9bgu

	ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸­æ–‡ç‰ˆ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1reY7Fnugs_ZSfBcsD4xHhA æå–ç ï¼šnqyk

	ç®—æ³•å¯¼è®º(ç¬¬2ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zCQg1JHLezHMAJnKkSVsVw æå–ç ï¼š624v

	ç®—æ³•å¿ƒå¾—ï¼šé«˜æ•ˆç®—æ³•çš„å¥¥ç§˜(ç¬¬2ç‰ˆ).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1f_udzJiXV49d_JVW11qaGA æå–ç ï¼š5fci

	ç½‘ç»œ
	HTTPæƒå¨æŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼‰.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zRAxZ4flGR1kSPk3LpVaxQ æå–ç ï¼ši1w1

	TCP-IPè¯¦è§£_å·ä¸€ã€äºŒã€ä¸‰.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/16yJAnKk99pfUkFJb54NjOA æå–ç ï¼š8ooj

	å›¾è§£HTTP.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1znL-3U7sGXDGWyVioWOmIg æå–ç ï¼š9fv0

	ç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/19-coudapbvsjXn1hGbxdOg æå–ç ï¼š84am

	é‡æ„ä¸è§„èŒƒ
	é‡æ„ - æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ - 1.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/17XkDXQF1Png5A8MiT_rrIw æå–ç ï¼šzevj

	é‡æ„-æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡-2-ä¸­æ–‡.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1EMVOK7HwhvD81Q5rjGMFdg æå–ç ï¼šhohc

	é˜¿é‡Œå·´å·´Androidå¼€å‘æ‰‹å†Œ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/10xWRdnEyqe_T6b8BP80vDQ æå–ç ï¼š7ogc

	é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œv1.3.0.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1MvE7fc12oy2lK6WKBC9LFw æå–ç ï¼š3vn2

	é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œv1.3.1.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/14nuMZlZYMxGlhxwwaVp9vw æå–ç ï¼š547e

	ä¸­é—´ä»¶
	Rediså…¥é—¨æŒ‡å—ï¼ˆç¬¬2ç‰ˆï¼‰.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1LoAJ0ZlKElL2TFuch38Rsw æå–ç ï¼špmep

	Rediså®æˆ˜.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1_N4y2Jnf1bBfBFNPgcbcyQ æå–ç ï¼šg3rm

	redisè®¾è®¡ä¸å®ç°ç¬¬äºŒç‰ˆ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1OuILN3VYmhLdqdaM1AdPTw æå–ç ï¼švvwy

	RocketMQæŠ€æœ¯å†…å¹•.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1qTQWHTepEIi0LcSlGsqq-A æå–ç ï¼š1ivj

	å‰ç«¯
	ES6 ç¼–ç è§„èŒƒ-Tower.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1HoPDSFuj-NHwVeCXxC8HCg æå–ç ï¼š1ayf

	es6æ‰‹å†Œ.md
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1ZT21nAq8EsaCV25C6nBxxA æå–ç ï¼š0d4k

	ES6æ ‡å‡†å…¥é—¨ï¼ˆç¬¬äºŒç‰ˆï¼‰.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1HoPDSFuj-NHwVeCXxC8HCg æå–ç ï¼š1ayf

	JavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1cdVK75H2PQ1BYuAEH14IFQ æå–ç ï¼š3w18

	JavaScriptè¯­è¨€ç²¾ç²¹.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1s2B5Fx24-oD2NBXs02fGWQ æå–ç ï¼ša3i5

	React ä¸­æ–‡ç‰ˆ-v1.1.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/13aKbirXB1vAG4wU_UoIX2Q æå–ç ï¼šeabd

	Redux å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç¿»è¯‘.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1aXLct_zaCnznDCLEPTeIJw æå–ç ï¼šuea5

	webpack æ€ç»´å¯¼å›¾.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1iSGksVNE2f5GykASw0qzog æå–ç ï¼šxxcp

	æ·±å…¥æµ…å‡ºES6.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1yh2ak_23lwxcdxOmBKd1Tw æå–ç ï¼šmeno

	å®‰å…¨
	sshæƒå¨æŒ‡å—.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1ZBD0adS33pb8MrgCoumi3g æå–ç ï¼šd6re

	ã€ŠåŠ å¯†ä¸è§£å¯†ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1UFy9f14cPBZi4Cvk4wkw1A æå–ç ï¼š0jrw

	ã€Šç™½å¸½å­è®²Webå®‰å…¨ã€‹(é˜¿é‡Œé“å“¥).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1w-VHgsYDKbk79QsEIgldAw æå–ç ï¼šbpeh

	æœåŠ¡å™¨
	docker_practice.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1m3dOf9RMXDW5qhw5tBYQww æå–ç ï¼šz32d

	Dockerä»å…¥é—¨åˆ°å®è·µ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/12BDqXpbCg2Hpi5i6ABDsoQ æå–ç ï¼šeyu0

	DockeræŠ€æœ¯å…¥é—¨ä¸å®æˆ˜+ç¬¬2ç‰ˆ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1CiByHKAJ-0esh-gRb4YQjA æå–ç ï¼š0j4y

	Introducing Istio Service Mesh for Microservices.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1QYzV2tG5p7r6VX2joB9EeA æå–ç ï¼š74f5

	Jenkinsæƒå¨æŒ‡å—.2016.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/17DYVh0JffbKJKRbqVwNqDg æå–ç ï¼še832

	Kubernetes in Action.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1RaPVVjm1RRpZHFty07iX_A æå–ç ï¼š1zd0

	kubernetes.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1_07VBMa_MoBg4RVDfyj5tA æå–ç ï¼š0d3f

	LINUXå†…æ ¸å®Œå…¨å‰–æï¼šåŸºäº0.12å†…æ ¸.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/12pGrrYgKxxjUfrrNKO-ZEw æå–ç ï¼šsdph

	Mavenå®æˆ˜.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1h2SxJ8as0rzBhPYZ8Bgkjw æå–ç ï¼šu25e

	Nginxæ•™ç¨‹ä»å…¥é—¨åˆ°ç²¾é€š.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1CsOf2AQn5s_6RQ10P4T2rQ æå–ç ï¼š9qzj

	Nginxé«˜æ€§èƒ½WebæœåŠ¡å™¨å®æˆ˜æ•™ç¨‹.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1wpQ6qeacrZciBdm2r0sX_w æå–ç ï¼šm0it

	æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ(åŸä¹¦ç¬¬ä¸‰ç‰ˆ3).pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/175pmfJQYpn_UmUHKevjMFw æå–ç ï¼š7y26

	git
	github-roam.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1abCW8L00_e5d--nuqWeauw æå–ç ï¼šhfcr

	gitä½¿ç”¨æŒ‡å—.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1LEp1NJnbwHdVqQpkbgnsCg æå–ç ï¼šlx4i

	Gitç‰ˆæœ¬æ§åˆ¶ç®¡ç†ç¬¬2ç‰ˆ(ç¾)ç½—åŠ›æ ¼.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1wyh5G5OowpJ6jOHKGCseFQ æå–ç ï¼š6mpq

	ä» 0 å¼€å§‹å­¦ä¹  GitHub ç³»åˆ—.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1q0kWzCGxlzxMMmqhZ6LkPg æå–ç ï¼šxma6

	AI
	Mathematical Methods for Physics and Engineering.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1m1H6rg4ntmGdLZjNMaQq4Q æå–ç ï¼šzpx9

	The Elements of Statistical Learning.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1A1uxEuTq79pfqPa65u_8-g æå–ç ï¼š6lwh

	å‡¸ä¼˜åŒ–ç†è®º.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zvDewKkUri7u4HEunP076A æå–ç ï¼švjxm

	åŒæµçº¿æ€§ä»£æ•°æ•™æ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1rQy9Tm83-jrcbQBTGf3VeQ æå–ç ï¼šy2zo

	åŒæµé«˜ç­‰æ•°å­¦ç¬¬å…­ç‰ˆä¸Šä¸‹å†Œ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/12NGyvxQToPKT7EilVshnag æå–ç ï¼šbyqt

	æ•°å­¦ä¹‹ç¾.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/16n2g5986MqKitds1733OXw æå–ç ï¼šdwrb

	æ•°æ®æŒ–æ˜ä¸åˆ†æï¼ˆè‹±æ–‡ï¼‰.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1z1obinsyF0PKyNnMBJrjaA æå–ç ï¼šxwsd

	æ–¯å¦ç¦å¤§å­¦æœºå™¨å­¦ä¹ å¤ä¹ ææ–™.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Ghz9oH2Es6WYLCTygELlSw æå–ç ï¼š6lna

	æ–¯å¦ç¦å¤§å­¦æœºå™¨å­¦ä¹ è¯¾ç¨‹ä¸ªäººç¬”è®°å®Œæ•´ç‰ˆ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1ph7v4MJXXH2RAUMdY7pjOw æå–ç ï¼š42id

	æœºå™¨å­¦ä¹ .pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KC8-p9Ed6e-Y-EVrVe6I6g æå–ç ï¼šj194

	æ¢¯åº¦ä¸‹é™.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sW3fngjTwayr_8GqsQ1Mng æå–ç ï¼š4qm4

	æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡åŒæµå¤§å­¦.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/19Fdq7E9MpmnWpBkixvr53A æå–ç ï¼šzt0m

	æ·±åº¦å­¦ä¹ .pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1rsraLEqCVFzoqT-UhOrOeA æå–ç ï¼š12l7

	æ·±åº¦å­¦ä¹ Deep Learning.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1aU2fclfilmZe6VpYh4BhBQ æå–ç ï¼šcrtg

	ç¥ç»ç½‘ç»œå’Œæ·±åº¦å­¦ä¹ .pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1qZlkqZJQ8HRfBPwH4ovsEA æå–ç ï¼šl9gs

	ç»å…¸ç®—æ³•å¤§å…¨.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1ONi8y_CxOsIz4rbqbJROdg æå–ç ï¼š2z75

	ç»Ÿè®¡å­¦ä¹ æ–¹æ³•æèˆª.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1CxGWelEiq9Vq5piBlW5x8g æå–ç ï¼šm718

	ç¾å›½äººå·¥æ™ºèƒ½çš„å‘å±•æ¦‚è¿°.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1iN1rXoF7G-19HFf368bxBw æå–ç ï¼šeeaz

	é‡åŒ–ç ”ç©¶æ‰‹å†Œï¼šæ•°æ®åˆ†æ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1LhxNtaq4P1OkRcq3K9pM6g æå–ç ï¼šq9et

	é¢å‘æœºå™¨æ™ºèƒ½çš„TensorFlowå®è·µ.pdf
	é“¾æ¥ï¼šhttps://pan.baidu.com/s/1mT3T1R1BfFSyLXtuYpcEfQ æå–ç ï¼šcbo8



# ğŸš© Java Version History
https://learnku.com/articles/49657
https://www.javatpoint.com/history-of-java

è‡ªä¸Šä¸ªä¸–çºªè®¡ç®—æœºä¿¡æ¯é©å‘½å¼€å§‹ï¼ŒC è¯­è¨€ä» 1970 å¹´ä»£å‘è¿¹ï¼Œå¹¶æˆåŠŸå‚¬ç”Ÿå‡º C++ è¿™æ ·çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¨€è¯­ï¼Œä½†æ˜¯ C/C++ ä½œä¸ºç³»ç»Ÿå¼€å‘çº§åˆ«çš„é«˜çº§è¯­è¨€ï¼Œå®ƒä»¬åœ¨ç›´æ¥æ“ä½œç¡¬ä»¶åº•å±‚ä¸Šå…·æœ‰éå¸¸å¼€æ”¾çš„ç‰¹æ€§ï¼Œå¹¶ä¸”éœ€è¦å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œè¿™ä½¿å¾—æ—¥ç›Šå¢åŠ çš„è½¯ä»¶å·¥ç¨‹å®‰å…¨éœ€æ±‚å˜å¾—è¶Šæ¥è¶Šè¿«åˆ‡ã€‚

åŸºäºä»¥ä¸Šå†å²èƒŒæ™¯ï¼ŒSun Microsystems å…¬å¸äº 1995 å¹´ 5 æœˆæ¨å‡ºçš„ Java é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¯­è¨€å’Œ Java å¹³å°ï¼Œç”± James Gosling, Mike Sheridan, Patrick Naughton å¸¦é¢† Green Team åŒäº‹ä»¬å…±åŒç ”å‘ã€‚

Sun å…¬å¸ç»ˆäºæŠµæŒ¡ä¸ä½å¼€æºç¤¾åŒºå’Œ Java ç¤¾åŒºçš„ç§ç§å‹åŠ›ï¼Œæœ€ç»ˆè¢«è¿«å¼€æ”¾ Java è™šæ‹Ÿæœºå’Œç¼–è¯‘å™¨çš„æºä»£ç ã€‚2006 å¹´ 11 æœˆ 13 æ—¥ï¼ŒSun Microsystems æ­£å¼å®£å¸ƒ Java å¼€æºï¼Œä¸è¿‡ï¼Œåå¹´ä¹‹åï¼Œå¯¹äº Java å¼€æºçš„äº‰è®®ä¾æ—§å­˜åœ¨ã€‚æ‰¹è¯„è€…è®¤ä¸ºï¼ŒJava å¹¶æ²¡æœ‰åƒå®˜æ–¹è¯´çš„é‚£æ ·å®Œå…¨å¼€æºï¼Œå…¶å®åªå¼€æ”¾äº† SDKï¼Œè€Œ Java SE å’Œ Java EE TCKs ä»ç„¶æ˜¯é—­æºã€‚æœ€åˆ IBM å‘¼åå°† Java æç»™ Apache è½¯ä»¶åŸºé‡‘ä¼šï¼Œä½¿ç”¨ Apache è®¸å¯è¯åˆ†å‘ï¼Œä½† Sun æœ€ç»ˆå†³å®šåœ¨ GPL è®¸å¯è¯ä¸‹å¼€æº Javaã€‚GPL è®¸å¯è¯è¦æ±‚è¡ç”Ÿç‰ˆæœ¬éœ€è¦å…¬å¼€åˆ†å‘ã€‚Gosling ç§°è¿™èƒ½è®© Java æ›´å¥½çš„é€‚åº”å¼€æºç¤¾åŒºã€‚Sun åœ¨ 2010 å¹´è¢«ç”²éª¨æ–‡æ”¶è´­ï¼ŒJava ä¹Ÿè½åˆ°äº†ç”²éª¨æ–‡æ‰‹ä¸­ï¼Œç”±ç”²éª¨æ–‡ä¸»å¯¼ Java çš„æ¼”åŒ–ã€‚

éšç€ Java å¼€æºï¼ŒJVM åº•å±‚çš„å…¬å¼€ï¼ŒåŸºäº JVM å®ç°çš„è„šæœ¬ã€è¯­è¨€ä¹Ÿåœ¨å¤§é‡è¡ç”Ÿï¼š

1. *JRuby*ï¼šJava è¯­è¨€å®ç°çš„ Ruby è„šæœ¬è§£é‡Šå™¨ã€‚
2. *Fantom*ï¼šå…¶å‰èº« Fan æ˜¯ä¸€ä¸ªåŸºäº Java å’Œ .NET å¹³å°çš„è„šæœ¬å¼•æ“ã€‚
3. *Jython*ï¼šç»§æ‰¿ Java å’Œ CPython äºŒè€…çš„ç‰¹æ€§çš„è„šæœ¬è¯­è¨€ã€‚
4. *Groovy*ï¼šå°±æ˜¯ JVM ä¸Šçš„è„šæœ¬è¯­è¨€ï¼Œå¸å– Python ç­‰è¯­è¨€ç‰¹å¾ï¼Œæå‡ Java å¼€å‘è€…çš„æ•ˆç‡ã€‚
5. *Clojure*ï¼šå°±æ˜¯ JVM ä¸Šçš„ Lispï¼Œè§£å†³ Java è¯­æ³•å’Œ Lisp å·®åˆ«å¤ªå¤§çš„ç¼ºç‚¹ã€‚
6. *Scala*ï¼šä¸€ç§å¤šèŒƒå¼çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ•´åˆ OOP å’Œ FP çš„å„ç§ç‰¹æ€§ã€‚
7. *Kotlin*ï¼šç›®æ ‡å°±æ˜¯æ›¿æ¢æ‰ Javaï¼Œå¤§é‡åº”ç”¨äº Android å¼€å‘ã€‚

ä¸ºä»€ä¹ˆè¯´ Kotlin æ˜¯æœªæ¥ï¼Œç›¸æ¯”èµ· Java è¯­è¨€ï¼ŒKotlin çš„ä¼˜åŠ¿ç¡®å®éå¸¸æ˜æ˜¾ï¼š

1. é«˜æ•ˆç‡ï¼šKotlin æ˜¯ä¸€ç§è·¨å¹³å°çš„é™æ€ç±»å‹è¯­è¨€ï¼Œå…³é”®ç‰¹æ€§åŒ…æ‹¬ null å®‰å…¨æ€§ã€åç¨‹ã€æ•°æ®ç±»å‹ã€æ‰©å±•å‡½æ•°ç­‰ã€‚å‰æœŸå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œä¸­æœŸçº¿ä¸Šé—®é¢˜æ›´å°‘ï¼ŒåæœŸä»£ç æ›´å®¹æ˜“ç»´æŠ¤ã€‚
2. å…¼å®¹æ€§ï¼šKotlin å¯ä»¥ä¸ Java æ··åˆç¼–ç¨‹ï¼Œé¡¹ç›®å¯ä»¥æ¸è¿›å¼è¿ç§» Java åˆ° Kotlinã€‚
3. ä»£ç é£æ ¼æ›´å‹å¥½ã€æ›´å¿«æ·ï¼Œè¯­æ³•ä¸ä¼¼ Java å¤æ‚ï¼Œä¸éœ€å†—ä½™ç±»å®šä¹‰å‡½æ•°å’Œé™æ€å¯¹è±¡ã€‚

Java ä¸»è¦ç‰¹æ€§ï¼š

1. *ç®€å•*ï¼šè‡ªåŠ¨å†…å­˜ç®¡ç†ï¼ŒåŸºäº C++ ä½†æ¶ˆé™¤å¤æ‚çš„ C++ åŠŸèƒ½ï¼Œå¦‚æŒ‡é’ˆã€å¤šç»§æ‰¿ã€‚
2. *é¢å‘å¯¹è±¡*ï¼šJava å°†ä¸€åˆ‡é—®é¢˜éƒ½çœ‹åšå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œå°†å¯¹è±¡æŠ½è±¡æˆæ–¹æ³•ä¸å±æ€§çš„é›†åˆã€‚
3. *åˆ†å¸ƒæ€§*ï¼šåŒ…å«æ“ä½œåˆ†å¸ƒæ€§ä¸æ•°æ®åˆ†å¸ƒæ€§ä¸¤ä¸ªæ–¹é¢ã€‚æ“ä½œåˆ†å¸ƒæ€§æ˜¯æŒ‡ç”±å¤šä¸ªä¸»æœºå…±åŒå®Œæˆä¸€é¡¹åŠŸèƒ½ï¼Œæ•°æ®åˆ†å¸ƒæ€§æ˜¯åˆ†å¸ƒåœ¨å¤šå°ä¸»æœºä¸Šçš„æ•°æ®å½“åšä¸€ä¸ªå®Œæˆçš„æ•´ä½“å¤„ç†ã€‚
4. *è·¨å¹³å°*ï¼šJava è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºï¼Œä¸å—å¹³å°é™åˆ¶ï¼Œå¯ä»¥ç”±ä¸€ç§å¹³å°è¿ç§»åˆ°å¦ä¸€ç§å¹³å°ã€‚
5. *è§£é‡Šå‹*ï¼šä½¿ç”¨ Java è¯­è¨€ç¼–å†™çš„æºç è¢«è½¬åŒ–ä¸ºå­—èŠ‚ç ï¼Œå­—èŠ‚ç åªæœ‰è¢« JVM è§£é‡Šæˆæœºå™¨ç æ‰èƒ½è¢«è®¡ç®—æœºæ‰§è¡Œã€‚
6. *å®‰å…¨æ€§*ï¼šJava è¯­è¨€çš„åº•å±‚è®¾è®¡å¯ä»¥æœ‰æ•ˆé¿å…éæ³•æ“ä½œã€‚
7. *å¥å£®æ€§*ï¼šJava æä¾›äº†è®¸å¤šæœºåˆ¶é˜²æ­¢è¿è¡Œæ—¶å‡ºç°ä¸¥é‡é”™è¯¯ï¼Œå¦‚ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ã€å¼‚å¸¸å¤„ç†ã€‚
8. *å¤šçº¿ç¨‹*ï¼šJava æ”¯æŒå¤šçº¿ç¨‹ï¼Œå…è®¸è¿›ç¨‹å†…éƒ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶å·¥ä½œã€‚

Java è¿è¡Œç¯å¢ƒ Java Runtime Environment (JRE) åŒ…å«äº† Java è™šæ‹Ÿæœºã€åŸºç¡€ç±»åº“ï¼Œæ˜¯åœ¨ä»»ä½•å¹³å°ä¸Šè¿è¡Œ Java ç¼–å†™çš„ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°çš„è½¯ä»¶ç¯å¢ƒï¼Œæä¾›ç»™ç»ˆç«¯ç”¨æˆ·ä½¿ç”¨ã€‚

JRE ç±»åº“åˆ†ä¸ºå››ç±»æ„æˆï¼Œå‚è€ƒæ–‡æ¡£é¦–é¡µçš„ Description of Java Conceptual Diagramï¼š
1. https://docs.oracle.com/javase/7/docs/
2. https://docs.oracle.com/javase/7/docs/technotes/guides/language/index.html
3. https://docs.oracle.com/javase/specs/index.html

User Interface Toolkits:

	JavaFX
	Swing	Java 2D	AWT	Accessibility
	Drag and Drop	Input Methods	Image I/O	Print Service	Sound

Integration Libraries: 

	IDL	JDBC	JNDI	RMI	RMI-IIOP	Scripting

Other Base Libraries: 

	Beans	Int'l Support	Input/Output	JMX
	JNI	Math	Networking	Override Mechanism
	Security	Serialization	Extension Mechanism	XML JAXP

lang and util Base Libraries:

	lang and util	Collections	Concurrency Utilities	JAR
	Logging	Management	Preferences API	Ref Objects
	Reflection	Regular Expressions	Versioning	Zip	Instrumentation


1. Java çš„ç±»åº“ï¼ŒåŒ…å«äº†ç¼–è¯‘ Java ç¨‹åºæ‰€éœ€è¦çš„æœ€æ ¸å¿ƒæ–‡ä»¶ã€‚
1.01. æ ¸å¿ƒåº“æ–‡ä»¶ï¼Œå…¶ä¸­æœ‰
1.02. æ•°æ®ç»“æ„çš„åº“ï¼ŒåŒ…æ‹¬åˆ—è¡¨ã€å­—å…¸å’Œæ ‘ç­‰
1.03. XML åˆ†æåº“
1.04. å®‰å…¨æ–¹é¢åº”ç”¨åº“
1.05. å›½é™…åŒ–å’Œæœ¬åœ°åŒ–åº”ç”¨åº“
1.06. ç»¼åˆåº“æ–‡ä»¶ï¼ŒåŒ…å«äº†ç¨‹åºå‘˜å’Œå…¶ä»–ç³»ç»Ÿé€šä¿¡çš„åŠŸèƒ½æ–‡ä»¶ã€‚
1.07. JDBCï¼Œå³ Java æ•°æ®åº“è”é€šçš„ API
1.08. JNDIï¼Œå³ Java å‘½åå’Œç›®å½•æ¥å£
1.09. RMI å’Œ CORBA ç”¨äºé‡æ–°åˆ†å‘è½¯ä»¶
1.10. ç”¨æˆ·ç•Œé¢åº“æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
1.11. AWTï¼Œå³æŠ½è±¡çª—å£å¼€å‘åŒ…ï¼Œæä¾›äº†äº§ç”Ÿå›¾å½¢ç”¨æˆ·ç•Œé¢æ‰€éœ€è¦çš„åŠŸèƒ½
1.12. Swing åº“
1.13. å…¶ä»–ç”¨äºå›è®¿åª’ä½“æ–‡ä»¶ã€å½•éŸ³ã€æˆªå›¾çš„åº“
2. ä¸€ä¸ªç”¨äºæ‰§è¡Œè½¯ä»¶çš„ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰
3. æ’ä»¶ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨é‡Œé¢ä½¿ç”¨
4. JWSï¼Œå¯ä»¥è®©ç»ˆç«¯ç”¨æˆ·è¿æ¥åˆ°äº’è”ç½‘
5. è®¸å¯æ–‡ä»¶å’Œæ–‡æ¡£

JDK (Java Development Kit) ä½œä¸º Java è¯­è¨€çš„åŸºç¡€è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œå…¶ç‰ˆæœ¬ä¸»è¦æ ¹æ®è®¾å¤‡ç±»å‹åˆ†ç±»ï¼š

1. Java MEï¼ˆJava Micro Edition)
2. Java EEï¼ˆJava Enterprise Edition)
3. Java SEï¼ˆJava Standard Edition)
4. LTS(Long-term support)

Java SE JDK ç‰ˆæœ¬å‘å¸ƒæ—¶é—´è¡¨ï¼š

| å‘è¡Œæ—¥æœŸ	| ç‰ˆæœ¬		| åç§°		|
| 1996-01-23	| JDK 1.0		| Oak(æ©¡æ ‘)		|
| 1997-02-19	| JDK 1.1		| noneï¼ˆæ— ï¼‰		|
| 1997-09-12	| JDK 1.1.4		| Sparklerï¼ˆå®çŸ³ï¼‰		|
| 1997-12-13	| JDK 1.1.5		| Pumpkinï¼ˆå—ç“œï¼‰		|
| 1998-04-24	| JDK 1.1.6		| Abigailï¼ˆé˜¿æ¯”ç›–å°”â€“å¥³å­åï¼‰		|
| 1998-09-28	| JDK 1.1.7		| Brutusï¼ˆå¸ƒé²å›¾â€“å¤ç½—é©¬æ”¿æ²»å®¶å’Œå°†å†›ï¼‰		|
| 1999-04-08	| JDK 1.1.8		| Chelseaï¼ˆåˆ‡å°”è¥¿â€“åŸå¸‚åï¼‰		|
| 1998-12-04	| J2SE 1.2		| Playgroundï¼ˆè¿åŠ¨åœºï¼‰	|
| 1999-03-30	| J2SE 1.2.1		| noneï¼ˆæ— ï¼‰		|
| 1999-07-08	| J2SE 1.2.2		| Cricketï¼ˆèŸ‹èŸ€ï¼‰		|
| 2000-05-08	| J2SE 1.3		| Kestrelï¼ˆç¾æ´²çº¢éš¼ï¼‰	|
| 2001-05-17	| J2SE 1.3.1		| Ladybirdï¼ˆç“¢è™«ï¼‰		|
| 2002-02-13	| J2SE 1.4.0		| Merlinï¼ˆç°èƒŒéš¼ï¼‰	|
| 2002-09-16	| J2SE 1.4.1		| grasshopperï¼ˆèš±èœ¢ï¼‰	|
| 2003-06-26	| J2SE 1.4.2		| Mantisï¼ˆè³è‚ï¼‰		|
| 2004-09-30	| Java SE 5.0 (1.5.0)	| Tigerï¼ˆè€è™ï¼‰	|
| 2006-04-00	| Java SE 6.0 (1.6.0)	| Mustangï¼ˆé‡é©¬ï¼‰	|
| 2011-07-28	| Java SE 7.0 (1.7.0)	| Dolphinï¼ˆæµ·è±šï¼‰	|
| 2014-03-18	| Java SE 8.0 (1.8.0)	| Spiderï¼ˆèœ˜è››ï¼‰	|
| 2017-09-21	| Java SE 9.0		| noneï¼ˆæ— ï¼‰		|
| 2018-03-21	| Java SE 10.0		| noneï¼ˆæ— ï¼‰		|
| 2018-09-25	| Java SE 11.0		| noneï¼ˆæ— ï¼‰		|
| 2019-03-19 	| Java SE 12.0		| noneï¼ˆæ— ï¼‰		|
| 2019-09-17 	| Java SE 13.0		| noneï¼ˆæ— ï¼‰		|
| 2020-03-17 	| Java SE 14.0		| noneï¼ˆæ— ï¼‰		|


å‘å±•å†å²

01. 1991 å¹´ Green é¡¹ç›®æˆç«‹ï¼ŒJames Gosling ç­‰äººå¼€å‘ Oak è¯­è¨€ä»¥æ”¯æŒæœ‰çº¿ç”µè§†äº¤æ¢ç›’ã€PDA ç­‰çš„å¾®å¤„ç†å™¨çš„åµŒå…¥å¼å¼€å‘ã€‚
02. 1994 å¹´å°† Oak è¯­è¨€æ›´åä¸º Javaã€‚
03. 1995 å¹´ 5 æœˆ 23 æ—¥ï¼ŒJava è¯­è¨€è¯ç”Ÿã€‚
04. 1996 å¹´ 1 æœˆ 23 æ—¥ï¼ŒSun å…¬å¸å‘å¸ƒäº† Java çš„ç¬¬ä¸€ä¸ªå¼€å‘å·¥å…·åŒ… JDK 1.0ã€‚
05. 1996 å¹´ 4 æœˆï¼Œ10 ä¸ªæœ€ä¸»è¦çš„æ“ä½œç³»ç»Ÿä¾›åº”å•†ç”³æ˜å°†åœ¨å…¶äº§å“ä¸­åµŒå…¥ Java æŠ€æœ¯ã€‚
06. 1996 å¹´ 9 æœˆï¼Œçº¦ 8.3 ä¸‡ä¸ªç½‘é¡µåº”ç”¨äº† JAVA æŠ€æœ¯æ¥åˆ¶ä½œã€‚
07. 1996 å¹´ 10 æœˆï¼ŒSun å‘å¸ƒç¬¬ä¸€ä¸ª JIT ç¼–è¯‘å™¨ã€‚
08. 1997 å¹´ 2 æœˆ 18 æ—¥ï¼ŒJDK1.1 å‘å¸ƒã€‚
09. 1997 å¹´ 4 æœˆ 2 æ—¥ï¼ŒJavaOne ä¼šè®®å¬å¼€ï¼Œå‚ä¸è€…é€¾ä¸€ä¸‡äººï¼Œåˆ›å½“æ—¶å…¨çƒåŒç±»ä¼šè®®è§„æ¨¡ä¹‹çºªå½•ã€‚
10. 1997 å¹´ 9 æœˆï¼ŒJavaDeveloperConnection ç¤¾åŒºæˆå‘˜è¶…è¿‡åä¸‡ã€‚
11. 1998 å¹´ 2 æœˆï¼ŒJDK1.1 è¢«ä¸‹è½½è¶…è¿‡ 2,000,000 æ¬¡ã€‚
12. 1998 å¹´ 12 æœˆ 8 æ—¥ï¼ŒSun å…¬å¸å‘å¸ƒäº†ç¬¬äºŒä»£ Java å¹³å°çš„ 3 ä¸ªç‰ˆæœ¬ï¼š
	J2ME åº”ç”¨äºç§»åŠ¨ã€æ— çº¿åŠæœ‰é™èµ„æºçš„ç¯å¢ƒï¼›
	J2SE åº”ç”¨äºæ¡Œé¢ç¯å¢ƒï¼›
	J2EE åº”ç”¨äºåŸºäº Java çš„åº”ç”¨æœåŠ¡å™¨ã€‚
13. 1999 å¹´ 6 æœˆï¼Œç¬¬ä¸‰ä¸ª Java ç‰ˆæœ¬å‘å¸ƒï¼Œå¹¶å‘½åä¸º JavaSEã€JavaEEã€JavaMEã€‚
14. 2000 å¹´ 5 æœˆ 8 æ—¥ï¼Œ JDK1.3ï¼ŒJ2SE 1.3 å‘å¸ƒã€‚
15. 2000 å¹´ 5 æœˆ 29 æ—¥ï¼ŒJDK1.4 å‘å¸ƒã€‚
16. 2001 å¹´ 9 æœˆ 24 æ—¥ï¼ŒJ2EE1.3 å‘å¸ƒã€‚
17. 2002 å¹´ 2 æœˆ 26 æ—¥ï¼ŒJ2SE1.4 å‘å¸ƒã€‚
18. 2004 å¹´ 9 æœˆ 30 æ—¥ï¼ŒJ2SE1.5 å‘å¸ƒï¼Œå¹¶å‘½åä¸º Java SE 5.0 ä»¥çªæ˜¾å…¶é‡Œç¨‹ç¢‘æ„ä¹‰ã€‚
19. 2005 å¹´ 6 æœˆï¼ŒJavaOne å¤§ä¼šå¬å¼€å¹¶å‘å¸ƒ JavaSE6ï¼Œæ›´åä¸ºï¼šJava EEã€Java SEã€Java MEã€‚
20. 2009 å¹´ 4 æœˆ 20 æ—¥ï¼ŒOracle å…¬å¸æ¯è‚¡ 7.5 ç¾å…ƒæ”¶è´­ Sun æ€»ä»·å€¼ 74 äº¿ç¾å…ƒ
21. 2011 å¹´ 7 æœˆ 28 æ—¥ï¼ŒOracle å‘å¸ƒ Java SE 7
22. 2014 å¹´ 3 æœˆ 18 æ—¥ï¼ŒJava SE 8 å‘å¸ƒ
23. 2017 å¹´ 9 æœˆ 21 æ—¥ï¼ŒJava SE 9 å‘å¸ƒ
24. 2018 å¹´ 3 æœˆ 21 æ—¥ï¼ŒJava SE 10 å‘å¸ƒ
25. 2018 å¹´ 9 æœˆ 25 æ—¥ï¼ŒJava SE 11 å‘å¸ƒ
26. 2019 å¹´ 3 æœˆ 20 æ—¥ï¼ŒJava SE 12 å‘å¸ƒ
27. 2019 å¹´ 9 æœˆ 17 æ—¥ï¼ŒJava SE 13 å‘å¸ƒ
28. 2020 å¹´ 3 æœˆ 17 æ—¥ï¼ŒJava SE 14 å‘å¸ƒ


é¦–ä¸ª JDK 1.0 ç‰ˆæœ¬ä» 1996 å¹´åˆå‘å¸ƒï¼Œè‡³ä»Šæœ‰äºŒåå¤šä¸ªç‰ˆæœ¬ï¼Œæ—©æœŸç‰ˆæœ¬å·ä½¿ç”¨ 1.x å‘½ä»¤ï¼Œä» ava SE 9 å¼€å§‹ä¸å†ä½¿ç”¨è¿™ç§å‘½åé£æ ¼ã€‚J2SE 1.4 å¼€å§‹ç”± Java Community Processï¼ˆJCPï¼‰ç®¡ç†ï¼Œä½¿ç”¨ Java Specification Requests ï¼ˆJSRsï¼‰æ–‡æ¡£æ¥å»ºè®®å’Œå®šä¹‰å¯¹ Java å¹³å°å†…å®¹çš„æ–°å¢å’Œä¿®æ”¹ã€‚

Java æ ‡å‡†åº“ï¼ˆJCLï¼‰ç»è¿‡å¤šå¹´å‘å±•ï¼Œä» JDK 1.0 ä¸­çš„å‡ ç™¾ä¸ªç±»æš´å¢åˆ° J2SE 5 çš„ä¸‰åƒå¤šä¸ªç±»ã€‚éšç€æŠ€æœ¯è¿›æ­¥ï¼ŒAPI ä¹Ÿä¸æ–­æ¨é™ˆå‡ºæ–°ï¼Œè®¸å¤š JDK 1.0 åŸæœ¬çš„ç±»å’Œæ–¹æ³•è¢«å¼ƒç”¨ã€‚

Java 7 å‘å¸ƒåï¼ŒOracle æ‰¿è¯ºå›åˆ°ä»¥å‰æ¯ä¸¤å¹´å‘å¸ƒä¸€æ¬¡çš„å‘å¸ƒå‘¨æœŸã€‚2013 å¹´ Oracle å´å®£å¸ƒä»–ä»¬å°† Java 8 å»¶è¿Ÿä¸€å¹´å‘è¡¨ï¼Œå®˜æ–¹è¡¨ç¤ºæ˜¯ä¸ºäº†ä¿®å¤ Java çš„å®‰å…¨æ¼æ´ã€‚

2017 å¹´ 9 æœˆï¼ŒJava å¹³å°çš„ä¸»æ¶æ„å¸ˆ Mark Reinhold å‘å‡ºæè®®ï¼Œè¦æ±‚å°† Java çš„åŠŸèƒ½æ›´æ–°å‘¨æœŸä»ä¹‹å‰çš„æ¯ä¸¤å¹´ä¸€ä¸ªæ–°ç‰ˆæœ¬ç¼©å‡åˆ°æ¯å…­ä¸ªæœˆä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚è¯¥æè®®è·å¾—äº†é€šè¿‡ï¼Œå¹¶åœ¨æå‡ºåä¸ä¹…ç”Ÿæ•ˆã€‚

Java 8 ä¸ Java 11 ä¸ºç›®å‰æä¾›æ”¯æŒçš„ LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰ç‰ˆæœ¬ï¼›Java 10 æ˜¯ä¸Šä¸€ä¸ªå¿«é€Ÿå‘å¸ƒç‰ˆæœ¬ï¼Œä¸”å·²ä¸å†è¢«æ”¯æŒã€‚éšç€ Java 11 çš„å‘å¸ƒï¼ŒJava 10 è‡ªå½“æ—¥èµ·ä¸å†è¢«æ”¯æŒã€‚Oracle å°†åœ¨ 2019 å¹´ 1 æœˆå‰ä¸ºå•†ä¸šç”¨é€”ä¸­çš„ Java 8 é•¿æœŸæ”¯æŒï¼Œè€Œé’ˆå¯¹éå•†ç”¨çš„æ›´æ–°å°†ç»§ç»­æä¾›ï¼Œç›´è‡³ 2020 å¹´ 12 æœˆï¼›æ­¤å¤–ï¼ŒAdoptOpenJDK ä¹Ÿä¸º Java 8 æä¾›å…è´¹æ›´æ–°ã€‚é’ˆå¯¹ Java 11 çš„é•¿æœŸæ”¯æŒå°†ä¸å†ç”± Oracle æä¾›ï¼Œè€Œæ˜¯æ”¹ç”± OpenJDK ç¤¾åŒºçš„ AdoptOpenJDK æä¾›ã€‚

# ğŸš© JUnit, Maven, Gradle å•å…ƒæµ‹è¯•ä¸é¡¹ç›®ç®¡ç†
1. https://junit.org/junit5/docs/current/user-guide/
2. https://ant.apache.org/manual/tutorial-HelloWorldWithAnt.html
3. https://github.com/junit-team/junit4/wiki/Getting-started

JUnit ä½œä¸ºåº”ç”¨æœ€å¹¿æ³›çš„ Java å•å…ƒæµ‹è¯•å·¥å…·ï¼Œä¸€èˆ¬ä¼šæ­é…å„ç§é¡¹ç›®ç®¡ç†å·¥å…·ä½¿ç”¨ã€‚IDE é»˜è®¤æä¾›ç›¸åº”çš„é¡¹ç›®é…ç½®ï¼Œå¯ä»¥é€šé€‰é¡¹è¿›è¡Œé…ç½®ä¿®æ”¹ã€‚å¯ä»¥è·³è¿‡ IDEï¼Œç›´æ¥è°ƒç”¨å„ç§é¡¹ç›®ç®¡ç†å·¥å…·æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ã€‚

å¸¸ç”¨çš„ Java é¡¹ç›®ç®¡ç†å·¥å…·æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼Œå‰åæœ‰ä¾èµ–å…³ç³»ï¼š

0. Ant æ—©æœŸçš„æ„å»ºå·¥å…·ï¼Œä½¿ç”¨ç±»ä¼¼ GNU Make çš„ Target æ„å»ºæ¦‚å¿µï¼Œä½†æ˜¯ç¼ºå¤±ä¾èµ–åº“ç®¡ç†ã€‚
1. Maven åŸºäº Project Object Modelï¼ˆpom.xmlï¼‰é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒæ„å»ºã€ä¾èµ–ã€æ–‡æ¡£å’Œå‘å¸ƒç­‰ä»»åŠ¡ã€‚
2. Gradle æ˜¯ä¸€ç§åŸºäº Groovy è¯­è¨€çš„æ„å»ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œé…ç½®è„šæœ¬æ¯” pom.xml æ›´åŠ ç²¾ç®€ã€‚

JUnit 4 WIki

```sh
git clone --depth=1 git@github.com:junit-team/junit4.wiki
```

JUnit ä¾èµ–ï¼š

```xml
<!-- https://mvnrepository.com/artifact/junit/junit -->
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>3.8.2</version>
    <scope>test</scope>
</dependency>
<!-- https://mvnrepository.com/artifact/junit/junit/4.12 -->
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.12</version>
    <scope>test</scope>
</dependency>
```

JUnit å„ç‰ˆæœ¬çš„å‘½åç©ºé—´ï¼š

```java
// JUnit 3 
import junit.framework.TestCase
import junit.framework.Test;
import junit.framework.Assert;
import groovy.test.GroovyTestCase;
// JUnit 4 
import org.junit.Test;
import org.junit.Assert.assertEquals;
import groovy.test.GroovyAssert;
import static org.junit.Assert.assertEquals;
// JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.Assertions.assertEquals;
```

ä½¿ç”¨ JUnit 3 ç¼–å†™æµ‹è¯•ç¨‹åºéœ€è¦ç»§æ‰¿ TestCaseï¼Œä¸»è¦ç”¨äº Java 5 ä¹‹å‰çš„ä»£ç ã€‚å‡çº§åˆ° JUnit 4 åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ @Test ç­‰æ³¨è§£å°† public æ–¹æ³•æ ‡è®°ä¸ºæµ‹è¯•æ¡ˆåˆ—ã€‚

ä»¥ä¸‹ä»¥ JUnit 4 ä¸ºä¾‹ï¼Œæ¼”ç¤ºå•å…ƒæµ‹è¯•çš„ä½¿ç”¨æµç¨‹ï¼š

1. ç¼–å†™ Java ç¨‹åºï¼Œæ­¤ä¸ºå¾…æµ‹è¯•çš„ç¨‹åºï¼›
2. ä½¿ç”¨ JUnit ä¾èµ–åº“ç¼–å†™æµ‹è¯•ç¨‹åºï¼›
3. ç¼–è¯‘ç¨‹åºï¼Œå¹¶ä½¿ç”¨ JUnit JUnitCore è¿è¡Œæµ‹è¯•ç¨‹åºï¼›

æµ‹è¯•ç¨‹åºä¹Ÿå¯ä»¥å®ç° static main å…¥å£å‡½æ•°ï¼Œè€Œä¸å¿…é€šè¿‡ JUnitCore è¿è¡Œæµ‹è¯•ç¨‹åºã€‚

æŒ‰çº¦å®šï¼Œå·¥ç¨‹ç›®å½•æŒ‰ä»¥ä¸‹çº¦å®šå½¢å¼å­˜æ”¾ä¸åŒçš„ä»£ç æ–‡ä»¶ï¼š

1. src/main/java  å­˜æ”¾ Java æºç¨‹åºä»£ç ï¼›
2. src/main/groovy å­˜æ”¾ Groovy æºç¨‹åºä»£ç ï¼›
3. src/test/java  å­˜æ”¾ Java æµ‹è¯•ç¨‹åºä»£ç ï¼›
4. src/test/groovy å­˜æ”¾ Groovy æµ‹è¯•ç¨‹åºä»£ç ï¼›

åˆ›å»º `Calculator.java` ä»£ç æ–‡ä»¶ï¼Œå†…å®¹å‚è€ƒå¦‚ä¸‹ï¼š

```java
public class Calculator {
  public int evaluate(String expression) {
    int sum = 0;
    for (String summand: expression.split("\\+"))
      sum += Integer.valueOf(summand);
    return sum;
  }
}
```

ä½¿ç”¨ JUnit 4 ç±»åº“åˆ›å»º `CalculatorTest.java` ä½œä¸ºæµ‹è¯•ç¨‹åºï¼Œä»£ç å‚è€ƒå¦‚ä¸‹ï¼Œæ³¨æ„ public å…³é”®å­—çš„ä½¿ç”¨ï¼Œå¦åˆ™æµ‹è¯•å¼•æ“æ£€æµ‹ä¸åˆ°ï¼š

```java
import org.junit.Test;
import static org.junit.Assert.assertEquals;

public class CalculatorTest {
  @Test
  public void evaluatesExpression() {
    Calculator calculator = new Calculator();
    int sum = calculator.evaluate("1+2+3");
    assertEquals(6, sum);
  }
}
```

ç¼–è¯‘ç¨‹åºã€æµ‹è¯•ç¨‹åºï¼Œå¹¶ä½¿ç”¨ JUnitCore è¿è¡Œæµ‹è¯•ç¨‹åºï¼š

```sh
# Now compile Calculator class:
javac Calculator.java
# The Java compiler creates a file `Calculator.class`.

# Compile the test. On Linux or MacOS
javac -cp .:junit-4.12.jar:hamcrest-core-1.3.jar CalculatorTest.java
# and on Windows
javac -cp .;junit-4.12.jar;hamcrest-core-1.3.jar CalculatorTest.java
# The Java compiler creates a file `CalculatorTest.class`.

## Run the test
# Run the test from the command line. On Linux or MacOS
java -cp .:junit-4.12.jar:hamcrest-core-1.3.jar org.junit.runner.JUnitCore CalculatorTest
# and on Windows
java -cp .;junit-4.12.jar;hamcrest-core-1.3.jar org.junit.runner.JUnitCore CalculatorTest
```

æµ‹è¯•ç¨‹åºè¾“å‡ºå‚è€ƒï¼š

```sh
    JUnit version 4.12
    .
    Time: 0,006
    
    OK (1 test)
```

JUnit 3 ä¹Ÿæä¾›äº†ä¸€ä¸ª junit.runner.BaseTestRunnerï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰å…¥å£å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥è¿è¡Œã€‚åº”è¯¥ä½¿ç”¨ junit.textui.TestRunner æˆ–è€… junit.swingui.TestRunnerã€‚JUnit 5 ä½¿ç”¨ junit-platform-console-standalone è¿è¡Œæµ‹è¯•ç¨‹åºã€‚ä½¿ç”¨ Maven ç®¡ç†é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ `mvn test` å‘½ä»¤è¿è¡Œæµ‹è¯•ï¼š

```sh
javap 'jar:file:c:/gradle/lib/junit-4.13.2.jar!/org/junit/runner/JUnitCore.class'
javap 'jar:file:~/.m2/repository/junit/junit/3.8.2/junit-3.8.2.jar!/junit/runner/BaseTestRunner.class'
javap 'jar:file:~/.m2/repository/junit/junit/3.8.2/junit-3.8.2.jar!/junit/textui/TestRunner.class'

java -cp 'c:/gradle/lib/junit-4.13.2.jar;target/test-classes;.' org.junit.runner.JUnitCore mgid.AppTest
# java -cp '.;target/test-classes;c:/gradle/lib/junit-4.13.2.jar' org.junit.runner.JUnitCore

export CLASSPATH="C:/gradle/lib/junit-4.13.2.jar;"\
	"~/.m2/repository/junit/junit/3.8.2/junit-3.8.2.jar;"\
	"C:/Groovy/lib/hamcrest-core-1.3.jar;"\
	"C:/groovy-3.0.4/lib/groovy-3.0.4.jar;"\
	"C:/groovy-3.0.4/lib/groovy-test-3.0.4.jar;"\
	"C:/Groovy/lib/groovy-4.0.15.jar;"\
	"C:/Groovy/lib/groovy-test-4.0.15.jar;$CLASSPATH;"\
	"build/classes/java/main;build/classes/java/test;"\
	"build/classes/groovy/main;build/classes/groovy/test;"\
	"build/classes/kotlin/main;build/classes/kotlin/test;"\
	"target/classes;target/test-classes;.;"

java org.junit.runner.JUnitCore mgid.AppTest
java junit.textui.TestRunner mgid.AppTest

javap org.junit.runner.JUnitCore
javap junit.textui.TestRunner

mvn test -Dtest=mgid.AppTest
mvn test -Dtest=SecondUnitTest
mvn test -Dtest=FirstUnitTest,SecondUnitTest
mvn test -Dtest="package.to.test.**"
```

ä½¿ç”¨è„šæœ¬ç¼–è¯‘æ›´æ–°è¿‡çš„ä»£ç æ–‡ä»¶ï¼Œé…åˆ watch å·¥å…·ç›‘è§† src ç›®å½•ï¼Œå¦‚æœç¼–è¯‘æˆåŠŸå°±æ‰§è¡Œ UnboundedWildcardsï¼š

```sh
cat > jc << EOF
#! /usr/bin/env sh
echo ------- Java compiling -------; 
javas=`find src/main/java`; 
for it in $javas; 
	do if [ $it -nt timestamp ]; 
		then javac -d build/classes/java/main $it; 
	fi; 
done
if [ $? = 0 ]; then java $1; fi
touch timestamp;
EOF
watch "sh -c './jc UnboundedWildcards'" src
```

æ³¨æ„ï¼šå‘½ä»¤è¡Œè¿è¡Œ jar ç¨‹åºæ—¶ï¼Œæ”¾ç½®åœ¨ CLASSPATH åˆ—è¡¨çš„è·¯å¾„ä¸è¦åŒ…å«ä»»ä½•å‰å¯¼ç©ºæ ¼ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‰¾ä¸åˆ°å…¥å£ã€‚

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†å¸¸ç”¨çš„ jar æ–‡ä»¶è·¯å¾„é…ç½®åˆ° CLASSPATH ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œå½“å‰å€¼å¯ä»¥é€šè¿‡ System å¯¹è±¡è·å–ï¼š

```java
System.getProperty ("java.class.path").replace (';', '\n');
```

ä»¥ä¸‹ä½¿ç”¨è„šæœ¬ç¼–å†™ JUnit 3 æµ‹è¯•ç¨‹åºï¼ŒæŒ‰ç…§çº¦å®šï¼Œå°†å…¶ä¿å­˜åˆ°ç›¸åº”çš„è„šæœ¬æ–‡ä»¶ï¼š

1. src/test/groovy/My.goory 
2. src/test/groovy/MyTest.goory 

```java
// 1. src/test/groovy/My.goory 
class My {
    static void main(String... args) {
        println "Hello Groovy!"
    }
}

// 2. src/test/groovy/MyTest.goory 
import groovy.test.GroovyTestCase

class MyTest extends GroovyTestCase
{
    static void main(String... args)
    {
        println "MyTest run... args=" + String.join(',', args)
        new MyTest().testAssertions()
    }

    void testAssertions()
    {
        println "java --version".execute().text
        assertEquals "Hello Groovy!", "java My".execute().text.trim()
    }
}

// Groovy Test Suite
import groovy.util.GroovyTestSuite 
import junit.framework.Test 
import junit.textui.TestRunner 

class AllTests { 
   static Test suite() { 
      def allTests = new GroovyTestSuite() 
      allTests.addTestSuite(MyTest.class) 
      allTests.addTestSuite(MoreTest.class) 
      return allTests 
   } 
} 

TestRunner.run(AllTests.suite())
```

æµ‹è¯•ä»£ç ä¸­è°ƒç”¨äº† `java My` å‘½ä»¤è¿è¡Œ My.classï¼Œå› ä¸ºå·²ç»å°†ç±»è¾“å‡ºç›®å½•è®¾ç½®åˆ°äº† CLASSPATH ç¯å¢ƒå˜é‡ä¸­ï¼ŒåŒ…æ‹¬ Mavrn ç¼–è¯‘è¾“å‡ºç›®å½•ï¼Œæ‰€ä»¥å°±ä¸éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½® -cp å‚æ•°ã€‚ 

Groovy è„šæœ¬ç¼–å†™ JUnit 3 æµ‹è¯•ç¨‹åºï¼Œåªéœ€è¦ç»§æ‰¿ `groovy.test.GroovyTestCase`ï¼Œç»§æ‰¿è‡ª `junit.framework.TestCase`ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨ JUnit æ–­è¨€ã€‚Test Suite å¯é€‰ï¼Œç›®çš„æ˜¯å°†æ‰€æœ‰æµ‹è¯•é›†ä¸­èµ·æ¥å¤„ç†ã€‚

JUnit 4 åˆ™ä½¿ç”¨ `groovy.test.GroovyAssert`ï¼Œç»§æ‰¿è‡ª `org.junit.Assert`ï¼Œå…¶ä¸­å®šä¹‰äº† shouldFail é™æ€æ–¹æ³•ã€‚JUnit 4 ä½¿ç”¨ @Before @Test @After ç­‰ç­‰æ³¨è§£ã€‚è¿™äº›æ³¨è§£åº”ç”¨äºéé™æ€ã€ä¸”æ— å‚æ•°çš„æ–¹æ³•ã€‚

```java
import org.junit.Test;
import org.junit.Before;
import static groovy.test.GroovyAssert.*

class MyTest
{
    @Before
    void init()
    {
        println "MyTest run..."
    }

    @Test
    void testAssertions()
    {
        print "java --version".execute().text
        assertEquals "Hello Groovy!", "java My".execute().text.trim()
    }
}
```

Groovy æä¾›äº†ä¸€äº›ä¸“ç”¨çš„æµ‹è¯•æ–¹æ³•ï¼Œä¾‹å¦‚ `shouldFail`ï¼Œå¯ç”¨äº JUnit 3 æˆ–è€… JUnit 4ã€‚ç”¨äºæ£€æŸ¥ç»™å®šä»£ç å—ï¼ˆé—­åŒ…ï¼‰æ˜¯å¦å¤±è´¥ï¼Œå¦‚æœæ˜¯ï¼Œä»£ç å—ä¸­çš„æ–­è¨€å°†ä¿æŒï¼Œå¦åˆ™æ–­è¨€å°†å¤±è´¥ã€‚å®ƒæ¥æ”¶ä¸€ä¸ª `groovy.lang.Closure`ï¼Œå¯ä»¥æŒ‡å®šæ­¤é—­åŒ…å¯èƒ½è§¦å‘çš„å¼‚å¸¸ç±»å‹ã€‚

```java
void testInvalidIndexAccess2() {
    def numbers = [1,2,3,4]
    shouldFail IndexOutOfBoundsException, {
        numbers.get(4)
    }
}
```

Groovy è„šæœ¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é€šè¿‡ execute æ–¹æ³•è°ƒç”¨å¤–éƒ¨ç¨‹åºå¹¶è·å–å…¶ stdin stdout stderr æ ‡å‡† I/O æ–‡ä»¶çš„æ•°æ®ï¼Œä½†æ˜¯æ³¨æ„ï¼Œç›´æ¥é€šè¿‡ text å±æ€§è·å–çš„å†…å®¹ä¼šè‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦å·ï¼Œè¿™ä¼šå¯¼è‡´æµ‹è¯•å‡ºé”™ï¼š

	junit.framework.ComparisonFailure: expected:<Hello Groovy![]> but was:<Hello Groovy![
	]>

å¯¼å…¥é™æ€æ–¹æ³•æ—¶ï¼Œå¦‚ Assert.assertEqualsï¼Œç¼ºå¤± static å…³é”®å­—ä¼šæŠ¥é”™ï¼Œä¼šå°†å®ƒå½“ä½œéé™æ€å¯¹è±¡å¯¼å…¥ï¼Œè¿›è€Œå¼•å‘ç±»å‹æ— æ³•å®šä½é”™è¯¯ã€‚

	groovy unable to resolve class org.junit.Assert.assertEquals

å‚è€ƒ Groovy å®˜æ–¹æ–‡æ¡£ï¼š

1.3. Program structure - 1.3.2. Imports
3.6. Testing Guide - 3.6.3. Testing with JUnit

JUnitCore è¿ç®—çš„æµ‹è¯•ç¨‹åºè¦æ±‚åªèƒ½æœ‰ä¸€ä¸ªæ„å»ºå™¨ï¼Œå¦‚æœæ˜¯ Groovy è„šæœ¬ä»£ç ï¼Œå®ƒä¼šç”Ÿæˆä¸¤ä¸ªæ„å»ºå™¨

```sh
$ mvn test-compile; java org.junit.runner.JUnitCore MyTest
1) initializationError(MyTest)
java.lang.IllegalArgumentException: Test class can only have one constructor

$ javap MyTest | grep MyTest\(
  public MyTest();
  public MyTest(groovy.lang.Binding);
```

å¦å¤–ï¼ŒGroovy è„šæœ¬ä¸­è°ƒç”¨æ–¹æ³•å¯ä»¥çœç•¥æ‹¬å·ï¼Œä½†æ˜¯å‚æ•°åˆ—è¡¨è¿˜æ˜¯éœ€è¦ä½¿ç”¨é€—å·åˆ†éš”ç¬¦ï¼Œå¦åˆ™å°±ä¼šå› ä¸º Groovy æ‰¾ä¸åˆ°å¯¹åº”çš„æ–¹æ³•ç­¾åè€Œè§¦å‘å¼‚å¸¸ï¼š

	groovy.lang.MissingMethodException: No signature of method



## ğŸ€ JUnit Configuration

JUnit 5 æ¶æ„æ”¹åŠ¨è¾ƒå¤§ï¼ŒæŒ‰å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼š

	JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage

JUnit Platform è¿è¡Œäº JVMï¼Œå®ƒç›¸å½“äºä¸€ä¸ªæµ‹è¯•ç¯å¢ƒå®¹å™¨ï¼Œå¹¶ä¸”åœ¨å…¶ä¸Šè¿è¡Œ JUnit æµ‹è¯•å¼•æ“ï¼ˆJupiter æˆ–è€… Vintageï¼‰ï¼Œjunit-platform-launcher æ’ä»¶è´Ÿè´£å¯åŠ¨æµ‹è¯•å¹³å°ï¼Œä»¥è¿è¡Œ junit-jupiter æˆ–è€… junit-vintage-engine æ’ä»¶æ‰€ä»£è¡¨çš„æµ‹è¯•å¼•æ“ã€‚

1. JUnit Jupiter æ˜¯æ–°çš„ç¼–ç¨‹æ¨¡å‹å’Œæ‰©å±•æ¨¡å‹çš„ç»„åˆï¼Œç”¨äºç¼–å†™ JUnit 5 æµ‹è¯•å’Œæ‰©å±•ã€‚
2. JUnit Vintage æä¾›çš„æµ‹è¯•å¼•æ“ç”¨äºç¼–å†™ JUnit 3 æˆ–è€… JUnit 4 çš„æµ‹è¯•ç¨‹åºã€‚

Maven é¡¹ç›®ä¸­é…ç½® JUnit 3 æˆ–è€… JUnit 4 ä¾èµ–ï¼š

```xml
<!-- https://mvnrepository.com/artifact/junit/junit 
testImplementation group: 'junit', name: 'junit', version: '4.13.2'
testImplementation 'junit:junit:4.13.2'
-->
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>
```

Maven é¡¹ç›®ä¸­é…ç½® JUnit 5 ä¾èµ–ï¼Œåªéœ€è¦æ·»åŠ  junit-jupiter-engine ä¾èµ–ï¼š
https://maven.apache.org/surefire/maven-surefire-plugin/examples/junit-platform.html

```xml
<!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-engine 
testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-engine', version: '5.10.0'
-->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-engine</artifactId>
    <version>5.10.0</version>
    <scope>test</scope>
</dependency>

<!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api 
testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-api', version: '5.10.0'
-->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-api</artifactId>
    <version>5.10.0</version>
    <scope>test</scope>
</dependency>

<!-- https://mvnrepository.com/artifact/org.junit.platform/junit-platform-launcher 
testImplementation group: 'org.junit.platform', name: 'junit-platform-launcher', version: '1.10.0'
-->
<dependency>
    <groupId>org.junit.platform</groupId>
    <artifactId>junit-platform-launcher</artifactId>
    <version>1.10.0</version>
    <scope>test</scope>
</dependency>


    <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
        <version>3.1.2</version>
        <dependencies>
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-engine</artifactId>
                <version>5.9.1</version>
            </dependency>
        </dependencies>
    </plugin>
```

æ–°ç‰ˆæœ¬çš„ JUnit 5 ä½¿ç”¨ junit-jupiter-api:5.7.0 æ›¿ä»£æ—§çš„æ³¨è§£ï¼Œå‘½ä»¤ç©ºé—´ä»¥åŠæ³¨è§£åç§°æ›´æ–°å‚è€ƒå¦‚ä¸‹ï¼š

	import org.junit.jupiter.api.Test
	import org.junit.jupiter.api.Assertions.*
	import org.junit.jupiter.api.Assumptions.*

	@BeforeEach @AfterEach         ==ã€‹ @Before    @After
	@BeforeAll  @AfterAll          ==ã€‹ @BeforeClass @AfterClass
	@Disabled                      ==ã€‹ @Ignore
	@Tag                           ==ã€‹ @Category
	@ExtendWith                    ==ã€‹ @RunWith
	@ExtendWith @RegisterExtension ==ã€‹ @Rule @ClassRule

é…åˆ Maven é¡¹ç›®ç®¡ç†å·¥å…·æ—¶ï¼Œ`mvn test` æœ‰å¯èƒ½ä¸æ‰§è¡Œ JUnit 4 çš„æµ‹è¯•ç¨‹åºï¼ŒMaven æ‰¾ä¸åˆ°è¦è¿è¡Œçš„ JUnit 4 æµ‹è¯•ï¼Œå¯èƒ½åŸå› æ˜¯é»˜è®¤çš„é…ç½®ä½¿ç”¨ TestNG æµ‹è¯•ä¾›åº”ç¨‹åºã€‚

Maven æ”¯æŒä»¥ä¸‹æµ‹è¯•å·¥å…·ï¼Œé»˜è®¤ä¼šä½¿ç”¨ TestNG ä½œä¸ºå•å…ƒæµ‹è¯•ä¾›åº”ç¨‹åºï¼Œåœ¨å‘½ä»¤è¾“å‡ºæ¶ˆæ¯ä¸­å¯ä»¥çœ‹åˆ° Configuring TestNGã€‚

1. TestNG    - artifactId: surefire-testng
2. JUnit 3.8 - artifactId: surefire-junit3
3. JUnit 4.x - artifactId: surefire-junit4, surefire-junit47
4. JUnit 5.x - artifactId: surefire-junit-platform
5. POJO

TestNG å…¨ç§° Testing, Next Generationã€‚TestNG è„±èƒäºä¸šç•Œæ ‡æ†çš„ JUnitï¼Œä½†æ¯” JUnit æ›´åŠ å¼ºå¤§å’Œæ˜“ç”¨ã€‚å®ƒå‡ ä¹æ¶µç›–æ‰€æœ‰ç±»å‹çš„æµ‹è¯•ï¼šå•å…ƒã€ç»„ä»¶ã€é›†æˆå’Œå‰ç«¯ï¼ˆSelenium+TestNGï¼‰ç­‰ã€‚

Surefire æ’ä»¶ Provider Selection æ£€æµ‹é€»è¾‘ï¼š

```sh
if the JUnit 5 Platform Engine is present in the project
    use junit-platform
if the JUnit version in the project >= 4.7 and the <<<parallel>>> configuration parameter has ANY value
    use junit47 provider
if JUnit >= 4.0 is present
    use junit4 provider
else
    use junit3.8.1
```

é€šè¿‡é…ç½® maven-surefire-plugin æ’ä»¶ï¼Œæ‰‹åŠ¨æŒ‡å®š JUnit 4 ä½œä¸ºå•å…ƒæµ‹è¯•ä¾›åº”ç¨‹åºï¼Œæ‰§è¡Œ `mvn test` å‘½ä»¤æ—¶ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š
https://maven.apache.org/surefire/maven-surefire-plugin/

	Using configured provider org.apache.maven.surefire.junitcore.JUnitCoreProvider

```xml
<!-- https://mvnrepository.com/artifact/org.apache.maven.plugins/maven-surefire-plugin
implementation group: 'org.apache.maven.plugins', name: 'maven-surefire-plugin', version: '3.1.2'
	org.apache.maven.plugins:maven-surefire-plugin:2.12.4:test		Sep 24, 2012
	org.apache.maven.plugins:maven-surefire-plugin:3.1.2:test		Jun 06, 2023	 -->
<dependency>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>3.1.2</version>
    <scope>test</scope>
</dependency>

  <plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>3.1.2</version>
    <dependencies>
      <dependency>
        <groupId>org.apache.maven.surefire</groupId>
        <artifactId>surefire-junit4</artifactId>
        <version>3.1.2</version>
      </dependency>
    </dependencies>
  </plugin>
```


## ğŸ€ JDK & Groovy Version

Java ç¨‹åºç¼–è¯‘åä¼šè®°å½•ä¸€ä¸ª JDK ä¸»ç‰ˆæœ¬å·ï¼Œå½“è¿è¡Œç¯å¢ƒæä¾›çš„ Java ç‰ˆæœ¬è¾¾ä¸åˆ°ç‰ˆæœ¬è¦æ±‚æ—¶ï¼Œå°±ä¼šè§¦å‘å¦‚ä¸‹å¼‚å¸¸ã€‚ä½¿ç”¨æœ€æ–°ç‰ˆ JDK 17 å¯èƒ½å¯¼è‡´æ—§ç‰ˆæœ¬ Gradle è¿è¡Œå‡ºé”™ï¼ŒMajor version 61 å³ JDK 17ï¼š

	BUG! exception in phase 'semantic analysis' in source unit 'src\test\groovy\MyTest.groovy' 
	Unsupported class file major version 61

ä½¿ç”¨ Groovy ç¼–è¯‘å™¨æ—¶å°±å¯èƒ½å‡ºç°æ­¤é”™è¯¯ï¼Œç±»ä¼¼åœ°ï¼ŒGradle 7.5.x å¹¶ä¸é€‚é… Java 19ï¼Œè¿™ç§æƒ…å†µä¹Ÿä¼šå¯¼è‡´ major ç‰ˆæœ¬é—®é¢˜ï¼Œå¯ä»¥é™ä½ JDK ç‰ˆæœ¬ï¼Œæˆ–è€…å‡çº§ Gradle ç‰ˆæœ¬ã€‚Groovy å¯åŠ¨è„šæœ¬è®°å½•çš„æ˜¯ Java å…¥å£ç±»ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨åŠ è½½å…¥å£ç±»æ‰€å½’å±çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚ groovy-4.0.15.jarã€‚ä½†æ˜¯ï¼Œå¦‚æœå°† Groovy ä¾èµ–åŒ…è®¾ç½®åˆ° CLASSPATH ç¯å¢ƒå˜é‡ä¸­ï¼Œé‚£ä¹ˆè„šæœ¬å°±ä¼šæŒ‰ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºå‡†ã€‚

Java 17 å‘½ä»¤è¡Œæœ‰å››ç§ä½¿ç”¨å½¢å¼ï¼š

```sh
# (to execute a class)
java [options] <mainclass> [args...]
# (to execute a jar file)
java [options] -jar <jarfile> [args...]
# (to execute the main class in a module)
java [options] -m <module>[/<mainclass>] [args...]
java [options] --module <module>[/<mainclass>] [args...]
# (to execute a single source-file program)
java [options] <sourcefile> [args]
```

å‚æ•°è®¾ç½®æœ‰å¤šç§ï¼Œéæ ‡å‡†é€‰é¡¹å› ä¸åŒçš„è™šæ‹Ÿæœºè€Œå¼‚ï¼ŒHotSpotã€OpenJ9ã€GraalVMã€Azul Zing ç­‰ï¼š
https://docs.oracle.com/en/java/javase/17/docs/specs/man/java.html#java-command-line-argument-files

0. General optionsï¼Œä¾‹å¦‚ -cp -classpath æˆ–è€… --class-path æŒ‡å®šç±»ç›®å½•åˆ—è¡¨ï¼›
1. Standard options ä½¿ç”¨ -D<name>=<value> å½¢å¼è®¾ç½®ç³»ç»Ÿå±æ€§ï¼›
2. Extra-options ä½¿ç”¨ `java -X` å‘½ä»¤æŸ¥è¯¢ï¼Œä¾‹å¦‚ä½¿ç”¨ `-Xms` å’Œ `-Xmx` è®¾ç½®å †å†…å­˜å¤§å°ï¼›
3. Advanced options è®¾ç½® JVM Runtimeã€JIT ç¼–è¯‘å™¨ã€GC ç­‰ç­‰ï¼Œä½¿ç”¨ -XX å½¢å¼ï¼Œä¾‹å¦‚ `-XX:+PrintFlagsFinal`ï¼›
4. @argument files ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶è®¾ç½®æ‰€æœ‰å‚æ•°ï¼Œå†ä½¿ç”¨ @ ç¬¦å·æŒ‡å®šå…¶è·¯å¾„ï¼›

Java 9 å¼•å…¥ Platform Module System (JPMS)ï¼Œä½¿ç”¨ `java --list-modules` å‘½ä»¤åˆ—è¡¨å½“å‰æ‰€æœ‰æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ -p å‚æ•°åŠ è½½æŒ‡å®šæ¨¡å—ã€‚

æ³¨æ„ï¼š@argfile æ–‡ä»¶ï¼Œå‚æ•°å’Œå€¼å¯ä»¥åˆ†è¡Œç¼–å†™ã€‚å‚æ•°ä¸­çš„ç©ºæ ¼åº”è¯¥ä½¿ç”¨åŒå¼•å·åŒ…æ‹¬ï¼Œåå¼•å·åŸæ ·ç¼–å†™ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶æ˜¯ä¼šè‡ªåŠ¨è¿›è¡Œè½¬ä¹‰ï¼Œå¹¶ç»™å‚æ•°å€¼æ·»åŠ åŒå¼•å·åŒ…æ‹¬ã€‚å¼€æ”¾çš„åŒå¼•å·åé¢æ¢è¡Œç¬¦å·ä¼šè¢«è¿‡æ»¤ï¼Œåƒ -cp åˆ—è¡¨ä¸­çš„è·¯å¾„è¿˜æ˜¯éœ€è¦ä½¿ç”¨ : æˆ–è€… ; åˆ†éš”ç¬¦å·ã€‚

1. groovy å‘½ä»¤å¯¹åº”ä¸»ç±»ï¼š`groovy.ui.GroovyMain`
2. groovysh å‘½ä»¤å¯¹åº”ä¸»ç±»ï¼š`org.apache.groovy.groovysh.Main` 
3. groovyConsole å‘½ä»¤å¯¹åº”ä¸»ç±»ï¼š`groovy.console.ui.Console` 
4. groovyc å‘½ä»¤å¯¹åº”ä¸»ç±»ï¼š`org.codehaus.groovy.tools.FileSystemCompiler`
5. grape å‘½ä»¤å¯¹åº”ä¸»ç±»ï¼š`org.codehaus.groovy.tools.GrapeMain`
6. é€šç”¨å…¥å£ç±»ä¸º `org.codehaus.groovy.tools.GroovyStarter`

```sh
cat >> argfile << EOF
-classpath
C:/Groovy/lib/jline-2.14.6.jar;\
C:/Groovy/lib/groovy-swing-4.0.15.jar;\
C:/Groovy/lib/javaparser-core-3.25.5.jar;\
C:/Groovy/lib/groovy-4.0.15.jar;\
C:/Groovy/lib/groovy-console-4.0.15.jar;\
C:/Groovy/lib/groovy-groovysh-4.0.15.jar;
EOF
java @argfile groovy.ui.GroovyMain
java @argfile groovy.console.ui.Console
java @argfile org.apache.groovy.groovysh.Main

java -Dkotlin.repl.ideMode=true -Dfile.encoding=UTF-8 @argfile groovy.console.ui.Console
java -Dsun.awt.keepWorkingSetOnMinimize=true -classpath C:/Groovy//lib/groovy-4.0.15.jar \
	-Dscript.name=/c/Groovy/bin/groovyconsole \
	-Dprogram.name=groovyconsole \
	-Dgroovy.starter.conf=C:/Groovy//conf/groovy-starter.conf \
	-Dgroovy.home=C:/Groovy/ \
	-Dtools.jar=C:/jdk-17/lib/tools.jar \
	org.codehaus.groovy.tools.GroovyStarter \
	--main groovy.console.ui.Console \
	--conf C:/Groovy//conf/groovy-starter.conf \
	--classpath "C:/jdk-14.0.2/jars/antlr-4.10.1-complete.jar;:."
```

ä½¿ç”¨å…¬å…±å…¥å£çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥åˆ©ç”¨å…¥å£ç±»æä¾›çš„å„ç§åŠŸèƒ½ï¼Œæ¯”å¦‚ç»™ --main å‚æ•°æŒ‡å®šçš„ä¸»ç±»è®¾ç½® classpath å‚æ•°ï¼Œæˆ–è€…æŒ‡å®š Groovy é…ç½®ï¼Œå‚è€ƒä»¥ä¸‹é…ç½®æ–‡ä»¶ groovy-starter.confï¼š

```sh
    # load required libraries
    load !{groovy.home}/lib/*.jar

    # load user specific libraries
    load !{user.home}/.groovy/lib/*.jar

    # tools.jar for ant tasks
    load ${tools.jar}
```

ä»¥ä¸‹æ˜¯ Android Studio é›†æˆ Groovy Shell çš„è„šæœ¬è§£æé…ç½®ï¼Œå…¶ä¸­ -p å‚æ•°è®¾ç½®åœ¨å…¥å£ç±»ä¹‹åï¼Œæ‰€ä»¥å®ƒä¸æ˜¯ç›´æ¥ç»™ Java å‘½ä»¤çš„å‚æ•°ï¼Œè€Œæ˜¯ç»™ Groovy å‘½ä»¤æŒ‡å®šçš„ä¸€ä¸ªæ§åˆ¶å°é€è¡Œè¯»å–æ•°æ®å¤„ç†è„šæœ¬ï¼Œç”¨æˆ·é€šè¿‡å®ƒæ¥ä¸ Groovy è§£æå™¨äº¤äº’ï¼š

```sh
cat > argfile_as << EOF
-classpath
C:\Program" "Files\Android\Android" "Studio\lib\groovy.jar;.
EOF
java "-Dgroovy.home=/" -Dfile.encoding=UTF-8 @argfile_as \
	org.codehaus.groovy.tools.GroovyStarter --main groovy.ui.GroovyMain \
	-p "C:/Program Files/Android/Android Studio/plugins/Groovy/lib/console.groovy"
```

å…¶ä¸­ console.groovy è„šæœ¬å†…å®¹å¦‚ä¸‹ï¼Œä¸»è¦æ˜¯è¯»å–ç”¨æˆ·è¾“å…¥å¹¶è°ƒç”¨ GroovyShell é€è¡Œè§£æï¼š

```js
// Copyright 2000-2018 JetBrains s.r.o. 
// Use of this source code is governed by the Apache 2.0 license 
// that can be found in the LICENSE file.

Binding bind
try {
  bind = scriptBinding
}
catch (MissingPropertyException ignore) {
  bind = scriptBinding = new Binding()
}
try {
  print line
  def result = new GroovyShell(bind).run(((String)line).replaceAll('###\\\\n', '\n'), 'ideaGroovyConsole.groovy')
  System.out.println()
  if (result != null) {
    System.out.println 'ee2d5778-e2f4-4705-84ef-0847535c32f4' + result
  }
}
catch (Throwable e) {
  e.printStackTrace()
}
```

Garpe æ˜¯åœ¨ Groovy è„šæœ¬é‡Œå†…åµŒå¼çš„ Jar åŒ…ä¾èµ–ç®¡ç†å™¨ï¼Œä½¿ç”¨ Grape å‘½ä»¤å¯ä»¥å¿«é€Ÿæ·»åŠ  maven ä»“åº“ä¾èµ–åˆ°è„šæœ¬çš„ classpathã€‚

```js
import com.jidesoft.swing.JideSplitButton
@Grab(group='com.jidesoft', module='jide-oss', version='[2.2.1,2.3.0)')
public class TestClassAnnotation {
    public static String testMethod () {
        return JideSplitButton.class.name
    }
}

@Grapes([
   @Grab(group='commons-primitives', module='commons-primitives', version='1.0'),
   @Grab(group='org.ccil.cowan.tagsoup', module='tagsoup', version='0.9.7')])
class Example {
// ...
}
```

```sh
$ grape install org.springframework spring 2.5.6
:: resolving dependencies :: caller#all-caller;working50
        confs: [default]
        found org.springframework#spring;2.5.6 in ibiblio
        found commons-logging#commons-logging;1.1.1 in localm2
downloading https://repo1.maven.org/maven2/org/springframework/spring/2.5.6/spring-2.5.6.jar ...
        [SUCCESSFUL ] org.springframework#spring;2.5.6!spring.jar (322371ms)

$ grape list

commons-logging commons-logging  [1.1.1]
org.apache apache  [4]
org.apache.commons commons-parent  [5]
org.springframework spring  [2.5.6, 5.3.30]

4 Grape modules cached
5 Grape module versions cached

commons-logging-1.1.1.jar
```

ä»¥ä¸‹æ˜¯ IntelliJ IDEA ä¸­è®¾ç½®çš„ Kotlin REPL å‘½ä»¤è¡Œï¼ˆå®éªŒæ€§åŠŸèƒ½ï¼‰ï¼Œç›´æ¥è°ƒç”¨ K2JVMCompiler  ç¼–è¯‘å™¨ï¼Œä½¿ç”¨ XML æ ¼å¼è¿›è¡Œæ•°æ®äº¤äº’ï¼š

```sh
cat > argfile_kotlin_repl << EOF
-classpath
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-compiler.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-stdlib.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-reflect.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-script-runtime.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/trove4j.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-daemon.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-scripting-compiler.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-scripting-compiler-impl.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-scripting-common.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/kotlin-scripting-jvm.jar;\
C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc/lib/annotations-13.0.jar;
org.jetbrains.kotlin.cli.jvm.K2JVMCompiler
-cp
build/classes/production/My_Application;build/classes/test/My_Application
-jvm-target
1.8
-kotlin-home
"C:/Program Files/Android/Android Studio/plugins/Kotlin/kotlinc"
EOF
java -Dkotlin.repl.ideMode=true -Dfile.encoding=UTF-8 @argfile_kotlin_repl
<?xml version="1.0" encoding="UTF-8"?><output type="INITIAL_PROMPT">Welcome to Kotlin version 1.9.0-release-358 (JRE 17.0.8+9-LTS-211)#n</output>
<?xml version="1.0" encoding="UTF-8"?><output type="INITIAL_PROMPT">Type :help for help, :quit for quit#n</output>
<?xml version="1.0" encoding="UTF-8"?><output type="INTERNAL_ERROR">print("ABC")</output>
<?xml version="1.0" encoding="UTF-8"?><output type="USER_OUTPUT">ABC</output>
<?xml version="1.0" encoding="UTF-8"?><output type="SUCCESS">#n</output>
```

ä½¿ç”¨ java å’Œ javap å‘½ä»¤æŸ¥è¯¢ç±»æ–‡ä»¶æ¥æºã€ä»¥åŠå…¶æ‰€ä½¿ç”¨çš„ JDK ä¸»ç‰ˆæœ¬å·ï¼š

```sh
$ javap -verbose org.codehaus.groovy.ast.decompiled.AsmDecompiler | grep major
  major version: 52
$ java -verbose org.codehaus.groovy.tools.GrapeMain | grep GrapeMain
[0.085s][info][class,load] org.codehaus.groovy.tools.GrapeMain source /groovy/lib/groovy-3.0.4.jar
```

List of Java Major Minor Versions
https://code2care.org/java/list-of-java-major-minor-version-numbers/

	Java version			Major Version	Hex Code
	Java SE 21 (YTR)		65		(0x41)
	Java SE 20			64		(0x40)
	Java SE 19			63		(0x3F)
	Java SE 18			62		(0x3E)
	Java SE 17			61		(0x3D)
	Java SE 16			60		(0x3C)
	Java SE 15			59		(0x3B)
	Java SE 14			58		(0x3A)
	Java SE 13			57		(0x39)
	Java SE 12			56		(0x38)
	Java SE 11			55		(0x37)
	Java SE 10			54		(0x36)
	Java SE 9			53		(0x35)
	Java SE 8			52		(0x34)
	Java SE 7			51		(0x33)
	Java SE 6.0			50		(0x32)
	Java SE 5.0			49		(0x31)
	JDK 1.4				48		(0x30)
	JDK 1.3				47		(0x2F)
	JDK 1.2				46		(0x2E)
	JDK 1.1				45		(0x2D)

Java -verbose è¾“å‡ºçš„è¯¦ç»†ä¿¡æ¯ä¸­åŒ…å«äº†å„ç§ç±»åŠ è½½æ¥æºï¼š

	source: __ClassDefiner__
	source: __JVM_LookupDefineClass__
	source: __dynamic_proxy__
	source: /myaid/target/classes/
	source: /groovy/lib/groovy-3.0.4.jar
	source: groovy.lang.MetaClassImpl
	source: java.lang.Class
	source: java.lang.Module
	source: jdk.nio.zipfs.ZipFileSystem
	source: jdk.nio.zipfs.ZipFileSystemProvider
	source: jrt:/java.base
	source: jrt:/jdk.zipfs
	source: org.codehaus.groovy.vmplugin.VMPluginFactory
	source: org.codehaus.groovy.vmplugin.v9.ClassFinder$1
	source: org.codehaus.groovy.vmplugin.v9.Java9
	source: shared objects file

æ ¹æ® Java ç±»æ–‡ä»¶åŠ è½½æœºåˆ¶ï¼Œè¿™äº›ç±»æœ‰ä»¥ä¸‹æ¥æºå½¢å¼ï¼š

1. ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå†…åŠ è½½ class æ–‡ä»¶ï¼šsource: /myaid/target/classes/
2. ä» JAR åŒ…åŠ è½½ class æ–‡ä»¶ï¼šsource: /groovy/lib/groovy-3.0.4.jar
3. é€šè¿‡ç½‘ç»œåŠ è½½ class æ–‡ä»¶ã€‚
4. Java æºæ–‡ä»¶åŠ¨æ€ç¼–è¯‘ã€å¹¶åŠ è½½ï¼šsource: shared objects file
5. Inner å†…éƒ¨ç±»ï¼šsource: java.lang.Class java.lang.Module
6. è¿è¡Œæ—¶ç±»åº“ï¼šsource: jrt:/java.base
7. Dynamic Proxy Class APIï¼šsource: __dynamic_proxy__

Bash è™½ç„¶æä¾›å˜é‡å­—ç¬¦ä¸²æ‰©å±•ï¼ˆæ›¿æ¢ï¼‰å¤„ç†ï¼Œä½†æ˜¯ä¸èƒ½æ’å…¥æ¢è¡Œç¬¦ï¼Œå³ä½¿ç”¨ `$'\n'` è¿™ç§å½¢å¼ä¹Ÿä¸å¯ä»¥ï¼Œéœ€è¦å€ŸåŠ© sed æˆ– gawk ç­‰å¤–éƒ¨å‘½ä»¤ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ Linux ç³»ç»Ÿå‘½ä»¤è¡Œçš„åŸºæœ¬å·¥å…·ï¼Œå‚è€ƒå®˜æ–¹æ‰‹å†Œ  3.5 Shell Expansions 3.5.3 Shell Parameter Expansion (String manipulate) ï¼Œä»¥åŠ Linux Command Line and Shell Scripting Bible - Chapter 19 Introducing sed and gawkã€‚

```sh
$ echo ${CLASSPATH//\\//} | sed 's/;/\n/g'
C:/jdk-14.0.2/jars/plantuml.1.2018.1.jar
C:/jdk-14.0.2/jars/antlr-4.10.1-complete.jar
C:/gradle/lib/junit-4.13.2.jar
C:/users/ocean/.m2/repository/junit/junit/3.8.2/junit-3.8.2.jar
C:/Groovy/lib/groovy-test-4.0.15.jar
C:/groovy-3.0.4/lib/groovy-test-3.0.4.jar
C:/Groovy/lib/hamcrest-core-1.3.jar
target/classes
target/test-classes
build/classes/java/main
build/classes/java/test
build/classes/groovy/main
build/classes/groovy/test
build/classes/groovy/main
build/classes/groovy/test
.
C:/kotlin/kotlinc/lib/kotlin-compiler.jar
C:/groovy/lib/groovy-4.0.15.jar
C:/groovy-3.0.4/lib/groovy-3.0.4.jar
```

## ğŸ€ Groovy è„šæœ¬é¡¹ç›®
0. https://github.com/apache/groovy
0. https://groovy-lang.org/documentation.html
1. https://docs.gradle.org/current/userguide/groovy_plugin.html
2. https://groovy.apache.org/download.html
3. https://mvnrepository.com/artifact/org.codehaus.groovy/groovy-all

Groovy è™½ç„¶å¯ä»¥ç§°ä¸ºè„šæœ¬ï¼Œä½†æ˜¯å’Œ Java ä¸€æ ·ä¹Ÿå¯ä»¥ç¼–è¯‘ä¸ºå­—èŠ‚ç å†è¿è¡Œï¼Œåˆ†åˆ«ä½¿ç”¨ javac å’Œ groovyc ç¼–è¯‘å™¨å‘½ä»¤å°†æºç ç¿»è¯‘æˆäºŒè¿›åˆ¶ç ï¼Œç„¶åäº¤ç»™ JVM è§£é‡Šæ‰§è¡Œã€‚

ç®€æ´ç®—æ˜¯ Groovy çš„æœ€åŸºæœ¬ç‰¹æ€§ï¼Œä½œä¸ºä¸€ç§è„šæœ¬ï¼ŒGroovy ä¹Ÿå…·æœ‰åŠ¨æ€ç‰¹æ€§ã€‚Groovy ProcessGroovyMethods æä¾› exexute æœºåˆ¶ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨ç¨‹åºã€å‘½ä»¤ã€‚3.3. Groovy Development Kit - 3.3.1. Working with IO - Executing External Processes 

ä½¿ç”¨ `groovy my.groovy` å‘½ä»¤æ‰§è¡Œä»¥ä¸‹ my.groovy è„šæœ¬ï¼Œå®ƒæ¼”ç¤ºå¦‚ä½•è½»æ¾åœ°åˆ©ç”¨ Groovy è„šæœ¬å­—ç¬¦ä¸²æä¾›çš„æ–¹æ³•å’Œç³»ç»Ÿè¿›ç¨‹è¿›è¡Œäº¤äº’ï¼š

```js
// For Unix system
println("pwd && groovy -v".execute().text)
// For Windows system
println("groovy.bat -v".execute().text)
println("cmd /C groovy -v".execute().text)
println( "C:/groovy-3.0.4/bin/groovy.bat -v".execute().text)

def process = "cmd.exe /c set".execute()
process.in.eachLine { line -> println (line) }
```

Windows ç³»ç»Ÿä¸Šï¼Œå› ä¸º groovy æ˜¯ä»¥æ‰¹å¤„ç†è„šæœ¬æ–‡ä»¶ .bat å½¢å¼å®šä¹‰çš„å‘½ä»¤ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ cmd.exe ç¨‹åºæ‰§è¡Œå®ƒï¼Œæˆ–è€…æŒ‡å®šè„šæœ¬æ–‡ä»¶å…¨åã€‚

ç›´æ¥ä½¿ç”¨ exectue çš„è¾“å‡ºè™½ç„¶æ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™æ²¡æœ‰ç»“æœè¾“å‡ºã€‚è¿™å°±éœ€è¦ä½¿ç”¨ `ProcessGroovyMethods` æä¾›çš„ I/O æ¶ˆè´¹æ–¹æ³•è¿›è¡Œå¤„ç†ï¼š

```sh
def stdout_stderr = new StringBuilder()
def ps = "java MyApp".execute()
ps.consumeProcessOutput(stdout_stderr, stdout_stderr)
ps.waitForOrKill(3000)
println("Out: [$stdout_stderr]")
```

æ¯ä¸ªè„šæœ¬æ–‡ä»¶å¯¹åº”ä¸€ä¸ª `Script` æŠ½è±¡ç±»å‹ï¼Œä½¿ç”¨ javap å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç±»æ–‡ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç¼–è¯‘å­—èŠ‚ç æŒ‡ä»¤ã€‚è„šæœ¬ä¸­å­—ç¬¦ä¸²å’Œå„ç§ç¬¦å·å°†ä¼šå®šä¹‰åœ¨å¸¸é‡æ± ä¸­ï¼ŒConstant poolã€‚è„šæœ¬ä¸­ execute() æ–¹æ³•è¿”å›ä¸€ä¸ª java.lang.Process å®ä¾‹ï¼Œé€šè¿‡å®ƒè®¿é—® stdin stdout stderr ç­‰æ ‡å‡† I/O æ–‡ä»¶ï¼Œè¿™äº›æ¥å£åŒ…è£…åœ¨ `ProcessGroovyMethods`ã€‚

å¯¹äºæ‰“åŒ…åœ¨ .jar ä¸­çš„ç±»æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `jar:file:xxx.jar!/path/to/some.class` æŒ‡å®šè·¯å¾„ï¼š

```sh
$ javap 'jar:file:c:/gradle/lib/junit-4.13.2.jar!/org/junit/runner/JUnitCore.class'
$ javap 'jar:file:~/.m2/repository/junit/junit/3.8.2/junit-3.8.2.jar!/junit/runner/BaseTestRunner.class'
```

Groovy è„šæœ¬ä¸­æ‰§è¡Œçš„æ–¹æ³•ä¼šç¼–è¯‘ä¸º `CallSite` call() æ–¹å¼çš„è°ƒç”¨ï¼ŒåŒ…æ‹¬è„šæœ¬ä¸­çš„ exexute() è¿™æ ·çš„æ–¹æ³•ã€‚Groovy ç¼–è¯‘å™¨æ ¹æ®è°ƒç”¨çš„æ–¹æ³•åˆ›å»ºå¯¹åº”çš„ `CallSiteArray` å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œåˆ©ç”¨è¿™ç§æ–¹å¼æ¥æ”¯æŒå¾ˆå¤šçš„åŠ¨æ€ç‰¹æ€§ã€‚è¿™é‡Œæ¶‰åŠçš„ç±»å‹å®šä¹‰åœ¨ org.codehaus.groovy.runtime åŒ…æˆ–è€…å…¶å­åŒ…ä¸­ã€‚

Groovy é—­åŒ…ç”¨äºå®šä¹‰åŒ¿åå‡½æ•°éå¸¸æ–¹ä¾¿ï¼Œä»¥ä¸Šä»£ç ä¸­çš„èŠ±æ‹¬å·æ­é… -> ç¬¦å·å°±æ˜¯é—­åŒ…æ ‡å¿—ã€‚

ç¼–è¯‘è„šæœ¬ä¼šç”Ÿæˆä¸æ–‡ä»¶åŒåçš„ç±»ï¼Œè„šæœ¬å†…å®¹å°†åŒ…è£…åœ¨ `run()` æ–¹æ³•ä¸­ï¼Œä¾› `InvokerHelper` è°ƒç”¨ã€‚åŒæ—¶è¿˜ä¼šç”Ÿæˆä¸€ä¸ª main æ–¹æ³•ï¼Œä½œä¸ºæ•´ä¸ªè„šæœ¬çš„å…¥å£ã€‚è„šæœ¬ä¸­å®šä¹‰çš„ç±»æ˜¯ Groovy Classï¼Œç¼–è¯‘æ—¶ä¼šæŒ‰ç±»åç§°ç”Ÿæˆå¯¹åº”çš„ .class æ–‡ä»¶ã€‚è„šæœ¬ä¸­å®šä¹‰çš„ç±»éƒ½ä¼šéšå«åœ°å®ç° `GroovyObject` æ¥å£ï¼ŒåŒ…æ‹¬ `Script` è¿™ä¸ªæŠ½è±¡ç±»å‹ã€‚å¦‚æœè¦ç›´æ¥æ‰§è¡Œï¼Œåˆ™è„šæœ¬ä¸­å®šä¹‰çš„å…¥å£ç±»å¿…é¡»å®šä¹‰ static main æ–¹æ³•ã€‚ç¤ºèŒƒå¦‚ä¸‹ï¼Œäº‹å®ä¸Šï¼Œåœ¨è„šæœ¬ä¸­ç¼–å†™ `println "Hello Groovy!"` ä¸€æ¡è¯­å¥ï¼Œå°±ç­‰ä»·ä»¥ä¸‹å®Œæ•´ä»£ç ï¼Œä½¿ç”¨ InvokerHelper æ‰§è¡Œ Groovy Classï¼š

```java
import org.codehaus.groovy.runtime.InvokerHelper

class Main extends Script {
    def run() {
        println "Hello Groovy!"
    }
    static void main(String[] args) {
        InvokerHelper.runScript(Main, args)
    }
}
```

è„šæœ¬ç¨‹åºç»“æ„å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š1. Groovy Language Specification - 1.3. Program structure ä»¥åŠ 1.3.3. Scripts versus classes

æ‰§è¡Œ Groovy ç¼–è¯‘å™¨ç”Ÿæˆçš„ .class æ–‡ä»¶æ—¶ï¼Œéœ€ä¿è¯ç±»è·¯å¾„ä¸­æœ‰ groovy-x.x.x.jarï¼Œå¦åˆ™ä¼šå› ä¸ºæ‰¾ä¸åˆ° GroovyObject è¿™æ ·çš„åŸºç¡€ç±»å‹è€Œè§¦å‘å…¥å£é”™è¯¯ï¼Œç”±è„šæœ¬ä¸­è®¾ç½®çš„ç»§æ‰¿ç±»å‹è§¦å‘ï¼š

```sh
java -cp "C:/groovy/lib/groovy-4.0.15.jar;C:/groovy/lib/groovy-test-4.0.15.jar;." Main
# Hello Groovy!

java -cp "." Main
# Error: Could not find or load main class my
# Caused by: java.lang.NoClassDefFoundError: groovy/lang/GroovyObject
# Caused by: java.lang.NoClassDefFoundError: groovy/lang/Script 
# Caused by: java.lang.NoClassDefFoundError: groovy/test/GroovyTestCase 
java NotRealClass
# Error: Could not find or load main class NotRealClass
# Caused by: java.lang.ClassNotFoundException: NotRealClass 
```

å¦å¤–ï¼Œè¿è¡Œ Groovy æµ‹è¯•è„šæœ¬æ—¶ï¼Œéœ€è¦å°† Groovy Test ä¾èµ–åŒ…æ·»åŠ åˆ° CLASSPATH åˆ—è¡¨ï¼Œå¦åˆ™ä¼šå‡ºç°æ–­è¨€æ–¹æ³•ç¼ºå¤±é—®é¢˜ï¼š

```sh
groovy.lang.MissingMethodException: 
No signature of method: MyTest.assertEquals() is applicable for argument types: (String, String) 
```

æ³¨æ„ï¼šåŒºåˆ«ä¸åŒçš„å…¥å£ç±»å‹é”™è¯¯ï¼š

1. ç”±äº Groovy ä¾èµ–æœªåŠ è½½ï¼Œå¯¼è‡´ GroovyObject æˆ– Script ç­‰ç±»å‹ä¸¢å¤±è€Œä¸èƒ½åŠ è½½å…¥å£ç±»ï¼›
2. Java è¿è¡Œä¸€ä¸ªä¸å­˜åœ¨ï¼ˆæœªå®šä½åˆ°çš„ç±»å®šä¹‰ï¼‰å…¥å£ç±»å‹ï¼Œè­¦å‘Šä¿¡æ¯å°±ä¼šåŒ…å«è¿™ä¸ªç±»å‹ï¼›

Groovy æµ‹è¯•å·¥å…·ç”±ç‹¬ç«‹çš„ jar åŒ…æä¾›ï¼Œåº”è¯¥å°† groovy-test-4.0.15.jar è¿™æ ·çš„ä¾èµ–åŒ…æ·»åŠ åˆ° CLASSPATH åˆ—è¡¨ã€‚å¦åˆ™å°±ä¼šå› ä¸º GroovyTestCase æœªåŠ è½½å¯¼è‡´ä¸èƒ½åŠ è½½å…¥å£ç±»ã€‚

ä½¿ç”¨ -cp å‚æ•°æŒ‡å®š CLASSPATH åˆ—è¡¨ï¼Œä½¿ç”¨åˆ†å·æˆ–å†’å·ï¼ˆUnixï¼‰åˆ†éš”å¤šä¸ªè·¯å¾„ï¼Œå¹¶ä¸”ä¸èƒ½æœ‰å‰ç½®ç©ºæ ¼ã€‚é‡å¤è®¾ç½® -cp å‚æ•°ä¼šè¦†ç›–æ—§å€¼ï¼Œæ¯”å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°±å¯èƒ½å¯¼è‡´è¿è¡Œå‡ºé”™ï¼š

	java -cp "C:/groovy/lib/groovy-4.0.15.jar;C:/groovy/lib/groovy-test-4.0.15.jar;" -cp . Main

ä½¿ç”¨ javap å‘½ä»¤å¯ä»¥æ£€æµ‹æŒ‡å®šç±»å‹æ˜¯å¦å­˜åœ¨å…¥å£å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åæ±‡ç¼–å­—èŠ‚ç ï¼š

```sh
$ javap -verbose MyTest
$ javap MyTest
Compiled from "MyTest.groovy"
public class MyTest extends groovy.test.GroovyTestCase implements groovy.lang.GroovyObject {
  public static transient boolean __$stMC;
  public MyTest();
  public static void main(java.lang.String...);
  public void testAssertions();
  protected groovy.lang.MetaClass $getStaticMetaClass();
  public groovy.lang.MetaClass getMetaClass();
  public void setMetaClass(groovy.lang.MetaClass);
}
```

ä½¿ç”¨ä»¥ä¸‹ç±»å‹å¯ä»¥åŠ¨æ€è¿è¡Œ Groovy è„šæœ¬ï¼š

1. *GroovyShell* ä»£è¡¨ groovy shellï¼Œå¯ä»¥è¿è¡Œä»»æ„è„šæœ¬ï¼Œä½¿ç”¨ `Binding` ç»‘å®šå‚æ•°ï¼›
2. *Eval* é€šè¿‡å°è£… GroovyShell æä¾›å‡ ä¸ªä¾¿äºä½¿ç”¨çš„è„šæœ¬æ‰§è¡Œæ–¹æ³•ï¼›
3. *GroovyClassLoader* ç±»å‹å¯ä»¥åŠ è½½ Groovy Classï¼Œä½¿ç”¨ `parseClass()` æ–¹æ³•ï¼›
4. *GroovyScriptEngine* å¼•æ“ç±» run æ–¹æ³•åœ¨è¿è¡Œæ—¶åŠ è½½è„šæœ¬ï¼Œç›‘å¬åˆ°è„šæœ¬å˜åŒ–æ—¶é‡æ–°åŠ è½½ï¼›
5. *InvokerHelper* é™æ€åŠ©æ‰‹ç±»ï¼Œä½¿å­—èŠ‚ç ç”Ÿæˆã€æ‰§è¡Œæ›´å®¹æ˜“ï¼›

å‚è€ƒå®˜æ–¹æ–‡æ¡£ 3.20. Integrating Groovy in a Java application

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†è„šæœ¬ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ my.classï¼š

```sh
$ groovyc -d ./groovy/lang/Script my.groovy
$ javap -verbose groovy.lang.Script.my
$ javap -cp ./groovy/lang/Script my

Compiled from "my.groovy"
public class my extends groovy.lang.Script {
  public static transient boolean __$stMC;
  public my();
  public my(groovy.lang.Binding);
  public static void main(java.lang.String...);
  public java.lang.Object run();
  protected groovy.lang.MetaClass $getStaticMetaClass();
}
```

å¦‚æœåœ¨ .groovy æ–‡ä»¶å®šä¹‰å’Œæ–‡ä»¶åŒåçš„ç±»ï¼Œåˆ™æ„å‘³ç€ç”¨ Groovy ç¼–å†™ Java ä»£ç ï¼Œè€Œä¸æ˜¯å†ä½œä¸ºä¸€èˆ¬è„šæœ¬ä½¿ç”¨ï¼ŒIDEA ç§°ä¹‹ä¸º Groovy Classã€‚Groovy é»˜è®¤å¯¼å…¥ä»¥ä¸‹æ¨¡å—ï¼š

```java
import java.io.*
import java.lang.*
import java.math.BigDecimal
import java.math.BigInteger
import java.net.*
import java.util.*
import groovy.lang.*
import groovy.util.*
```

Groovy é»˜è®¤å¯¼å…¥çš„ç±»å‹ä½äºä¸»ä¾èµ–åŒ…ï¼Œç”¨äºæµ‹è¯•çš„ groovy.test.GroovyTestCase ç­‰ç±»å‹æ²¡æœ‰å¯¼å…¥ï¼Œå¹¶ä¸”ï¼Œæµ‹è¯•å·¥å…·é€šè¿‡å¦å¤–ç‹¬ç«‹çš„åŒ…æä¾›ã€‚å¯¹äº Groovy 4..15ï¼Œè¿™äº›åŒ…å¯¹åº”ä¸ºï¼šgroovy-4.0.15.jar groovy-test-4.0.15.jar

æŒ‰ç…§é¡¹ç›®ä¹ æƒ¯çº¦å®šï¼ŒGroovy è„šæœ¬åº”è¯¥ä¿å­˜åœ¨ src\main\groovy æˆ–è€…  src\test\groovy å­ç›®å½•ã€‚ä»£ç å•å…ƒæµ‹è¯•å‚è€ƒ 3.6. Testing Guide -  3.6.3. Testing with JUnit

GMavenPlus Wiki - Choosing Your Build Tool é¡µé¢ç½—åˆ—äº† Groovy è„šæœ¬é¡¹ç›®çš„å‡ ç§é…ç½®æ–¹å¼ï¼š
https://github.com/groovy/GMavenPlus/wiki/Choosing-Your-Build-Tool

```sh
# ä¸‹è½½ GMavenPlus WIki é¡µé¢
git clone --depth=1 git@github.com:groovy/GMavenPlus.wiki
```

1. groovyc Ant Task (æ¨èä½¿ç”¨)
2. GMaven 1
3. GMaven 2
4. GMavenPlus (æ¨èä½¿ç”¨)
5. Groovy Eclipse Compiler Plugin for Maven
6. Buildr
7. Gradle (æ¨èä½¿ç”¨)

GMavenPlus é‡å†™äº† GMaven æ’ä»¶ï¼Œå®ƒä»¬ä¸º Maven é¡¹ç›®é›†æˆ Groovy è„šæœ¬ï¼Œå‚è€ƒæ–‡æ¡£ 2.2. Compiling Groovy - 2.2.5. Maven integration ä»¥åŠ 2.3.2. GMavenPlus Maven Pluginã€‚

ä½¿ç”¨ Maven æˆ– Gradle åˆ›å»º Groovy è„šæœ¬é¡¹ç›®éœ€è¦ Groovy ä¾èµ–ä»¥åŠç›¸åº”çš„æ’ä»¶é…ç½®ã€‚åˆ†åˆ«åœ¨ build.gradle å’Œ pom.xml é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç›¸åº”ä¾èµ–ã€‚

Gradle é…ç½®å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œä¸»è¦æ˜¯ Grooy API å’Œ Groovy Plugin é…ç½®ï¼Œæ­¤æ’ä»¶ä¸º Grandl æ·»åŠ ä»¥ä¸‹ä»»åŠ¡æ”¯æŒï¼Œæ‰§è¡Œ `gradle test` å‘½ä»¤æ—¶å°±ä¼šç¼–è¯‘å¹¶è¿è¡Œç›¸åº”çš„ Groovy è„šæœ¬ï¼š

1. `compileGroovy` â€” GroovyCompile ä¾èµ– `compileJava` ä»»åŠ¡ï¼Œç¼–è¯‘ Groovy ä»£ç ï¼›
2. `compileTestGroovy` â€” GroovyCompile ä¾èµ– `compileTestJava` ä»»åŠ¡ï¼Œç¼–è¯‘ Groovy æµ‹è¯•ä»£ç ï¼›
3. `compileSourceSetGroovy` â€” GroovyCompile ä¾èµ– `compileSourceSetJava` ä»»åŠ¡ï¼Œç¼–è¯‘ sourceSet ç›®å½•ä¸‹çš„ä»£ç é›†ï¼›
4. `groovydoc` â€” Groovydoc ä¸ºä»£ç ç”Ÿæˆ API æ–‡æ¡£ï¼›

```js
plugins {
    id 'groovy'
}
dependencies {
	// https://mvnrepository.com/artifact/org.codehaus.groovy/groovy-all
	//implementation 'org.codehaus.groovy:groovy-all:3.0.19'
	//implementation group: 'org.codehaus.groovy', name: 'groovy-all', version: '3.0.10', ext: 'pom'
	api 'org.codehaus.groovy:groovy-all:3.0.10'
}
```

Maven é¡¹ç›®ä¸­é…ç½® Groovy è„šæœ¬å°±æ˜¾å¾—å•°å—¦ä¸€ç‚¹ï¼Œå…ˆæ·»åŠ  groovy-all ä¾èµ–ï¼š

```xml
    <dependency>
      <groupId>org.codehaus.groovy</groupId>
      <artifactId>groovy-all</artifactId>
      <version>3.0.10</version>
      <type>pom</type>
    </dependency>
```

Maven æ–‡æ¡£ç»™å‡ºä¸€ä¸ªä½¿ç”¨ Ant plugin ç›´æ¥è¿è¡Œ groovyc Ant Task ç¼–è¯‘ Groovy é¡¹ç›®çš„é…ç½®ç¤ºèŒƒï¼Œæ­¤æ’ä»¶è¿è¡Œäº `mvn compile` å’Œ `mvn test-compile` é˜¶æ®µã€‚

```xml
      <plugin>
          <artifactId>maven-antrun-plugin</artifactId>
          <executions>
              <execution>
                  <id>compile</id>
                  <phase>compile</phase>
                  <configuration>
                      <tasks>
                          <mkdir dir="${basedir}/src/main/groovy"/>
                          <taskdef name="groovyc"
                              classname="org.codehaus.groovy.ant.Groovyc">
                              <classpath refid="maven.compile.classpath"/>
                          </taskdef>
                          <mkdir dir="${project.build.outputDirectory}"/>
                          <groovyc destdir="${project.build.outputDirectory}"
                              srcdir="${basedir}/src/main/groovy/" listfiles="true">
                              <classpath refid="maven.compile.classpath"/>
                          </groovyc>
                      </tasks>
                  </configuration>
                  <goals>
                      <goal>run</goal>
                  </goals>
              </execution>
              <execution>
                  <id>test-compile</id>
                  <phase>test-compile</phase>
                  <configuration>
                      <tasks>
                          <mkdir dir="${basedir}/src/test/groovy"/>
                          <taskdef name="groovyc"
                              classname="org.codehaus.groovy.ant.Groovyc">
                              <classpath refid="maven.test.classpath"/>
                          </taskdef>
                          <mkdir dir="${project.build.testOutputDirectory}"/>
                          <groovyc destdir="${project.build.testOutputDirectory}"
                              srcdir="${basedir}/src/test/groovy/" listfiles="true">
                              <classpath refid="maven.test.classpath"/>
                          </groovyc>
                      </tasks>
                  </configuration>
                  <goals>
                      <goal>run</goal>
                  </goals>
              </execution>
          </executions>
      </plugin>
```

Ant Plugin é…ç½®äº†ä¸¤ä¸ª execution èŠ‚ç‚¹ï¼Œåˆ†åˆ«ç”¨äºç¨‹åºã€æµ‹è¯•ç¨‹åºçš„ç¼–è¯‘ï¼Œå¯¹åº”çš„ä»£ç ç›®å½•æŒ‰ä¹ æƒ¯çº¦å®šå­˜æ”¾åœ¨ groovy ç›®å½•ä¸‹ï¼Œç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶åˆ™æŒ‰å¯¹åº”çš„é¡¹ç›®é…ç½®æŒ‡å®šï¼š

	${project.build.outputDirectory}
	${project.build.testOutputDirectory}

é¡¹ç›®é…ç½®ä¸º Groovy ç±»å‹åï¼Œæ‰§è¡Œ `mvn test` å‘½ä»¤æ—¶ï¼ŒåŸæœ‰çš„ Java æµ‹è¯•ç¨‹åºå¯èƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”è¿˜éœ€è¦å¼•å…¥ SLF4J ä¾èµ–åŒ…ï¼Œå¦åˆ™æŠ¥é”™ã€‚

	SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
	SLF4J: Defaulting to no-operation (NOP) logger implementation
	SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
	Configuring TestNG with: org.apache.maven.surefire.testng.conf.TestNG652Configurator@7f63425a

```xml
    <dependency>  
      <groupId>org.slf4j</groupId> 
      <artifactId>slf4j-nop</artifactId> 
      <version>1.7.2</version> 
    </dependency>
```

æ ¹æ® GMavenPlus Wiki æ–‡æ¡£æŒ‡ç¤ºï¼ŒAnt Plugin ç›´æ¥æ‰§è¡Œ groovyc Ant Task è¿™ç§é…ç½®æ–¹å¼ç”± Groovy å›¢é˜Ÿç»´æŠ¤ï¼Œä¼šéšç€ Groovy æ–°ç‰ˆæœ¬å‘å¸ƒæ›´æ–°ã€‚è¿™ç§é…ç½®æ–¹å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š

1. It's Ant, so there's more configuration and less convention than either of the Maven options
2. Uses stubs for mixed compilation
3. If you're using the AntRun plugin on a mixed Groovy/Java project, you'll need to have javac handle you Java instead of the Maven Compiler Plugin
4. Doesn't support Groovy mojos, except through Java 5 annotations
5. Doesn't support execution of Groovy scripts
6. Doesn't support interactive shell/console on your project

ç æ¡© stub æ³›æŒ‡ï¼šç³»ç»Ÿ S æœ‰æŸä¸ªä¾èµ– Dï¼Œä½†æ˜¯ç”¨å¦å¤–çš„æ¨¡å— X æ¥ä»£æ›¿ Dã€‚æ¨¡å— X å°±è¢«ç§°ä¸ºä¸€ä¸ª stubã€‚

A stub is a controllable replacement for an Existing Dependency (or collaborator) in the system. By using a stub, you can test your code without dealing with the dependency directly.

Groovy è„šæœ¬ä¸­ç¼–å†™æµ‹è¯•ç¨‹åºï¼š

1. JUnit 3 ä½¿ç”¨ groovy.test.GroovyTestCaseï¼ˆjunit.framework.TestCase å­ç±»ï¼‰æˆ–è€…ä½¿ç”¨ assertScript
2. JUnit 4 ä½¿ç”¨ @Test æ³¨è§£ï¼Œä»¥åŠ groovy.test.GroovyAssertï¼Œæ­¤ç±»ç»§æ‰¿è‡ª org.junit.Assertã€‚
3. JUnit 5 ä½¿ç”¨ç‰¹æ®Šçš„ @ParameterizedTest @TestFactory æ³¨è§£ï¼›

ä½¿ç”¨ Gradle æ—¶æ³¨æ„ï¼Œæ‰§è¡Œ `gradle test` å‘½ä»¤æ—¶ï¼Œä¼šé‡ç½® CLASSPATH ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸” Groovy è„šæœ¬ä¸­è°ƒç”¨å…¶å®ƒ shell å‘½ä»¤è§£æå™¨æ˜¯ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šå°† CLASSPATH ä¼ é€’ç»™æ–°çš„ shell è¿›ç¨‹ã€‚è¿™äº›éšè—çš„è¡Œä¸ºä¼šå¯¼è‡´éœ€è¦é€šè¿‡ shell æ‰§è¡Œçš„ Java ç¨‹åºè¿è¡Œå¼‚å¸¸ï¼Œè€Œ Maven æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ï¼š

```sh
# println "cmd /C set".execute().text
# print "Enquire cp by Java API: [${System.getenv("CLASSPATH")}]"
# Use Gradle API provider.environmentVariable("CLASSPATH").get()
CLASSPATH=~/.gradle/wrapper/dists/gradle-8.3-bin/lib/gradle-launcher-8.3.jar
# println "bash -c 'set'".execute().text
CLASSPATH=
```

```java ,groovy
import org.junit.Test;
import org.junit.Before;
import static groovy.test.GroovyAssert.assertEquals

class MyTest
{
    @Before
    void init()
    {
        println "MyTest run..."
    }

    @Test
    void testAssertions()
    {
        println "Enquire cp by Java API: [${System.getenv("CLASSPATH")}]"
        print_exe "java My"

        if (System.getenv("CLASSPATH").contains("groovy")) {
            assertEquals "Hello Groovy!", "java My".execute().text.trim()
        } else {
            assertEquals "Hello Groovy!", "groovy.bat src/main/groovy/My.groovy".execute().text.trim()
        }
    }

    static void print_exe(String command) {
        def stdout_stderr = new StringBuilder()
        def ps = command.execute()
        ps.consumeProcessOutput(stdout_stderr, stdout_stderr)
        ps.waitForOrKill(3000)
        println("Out: [$stdout_stderr]")
    }
}
```


## ğŸ€ Kotlin ç¼–ç¨‹
1. https://kotlinlang.org/docs/getting-started.html
2. https://github.com/JetBrains/kotlin/releases/tag/v1.9.10
3. https://github.com/JetBrains/kotlin-web-site/

ä¸º Sublime Text å®‰è£… LSP æ’ä»¶æ”¯æŒï¼Œæ”¯æŒè¯­è¨€åŒ…æ‹¬ Javaã€Groovyã€Kotlinï¼š

1. https://lsp.sublimetext.io/language_servers/#kotlin
2. https://packagecontrol.io/packages/Kotlin
3. https://github.com/fwcd/KotlinLanguageServer
4. https://github.com/GroovyLanguageServer/groovy-language-server
5. https://github.com/sublimelsp/LSP-jdtls
5. http://download.eclipse.org/jdtls/snapshots/jdt-language-server-1.29.0-202309291511.tar.gz

Java LSP æ”¯æŒä½¿ç”¨ç§»æ¤åˆ° Sublime Text ç¯å¢ƒçš„ [Eclipse JDT language server](https://projects.eclipse.org/projects/eclipse.jdt.ls)ã€‚

```json
"clients":
{
    "kotlinls": {
        "enabled": true,
        "command": ["c:/kotlin/server/bin/kotlin-language-server.bat"], // Update the PATH
        "selector": "source.Kotlin",
        "settings": {
            "kotlin": {
                // put your server settings here
            }
        }
    },
    "groovy": {
        "enabled": true,
        "command": ["java", "-jar", "c:/groovy/groovy-language-server/build/libs/groovy-language-server-all.jar"], // Update the PATH
        "selector": "source.groovy",
    },
    "Java(jdtls)": {
        "command": ["java", 
            "-jar", "C:/kotlin/jdtls/plugins/org.eclipse.equinox.launcher_1.6.500.v20230717-2134.jar", 
            "-configuration", "C:/kotlin/jdtls/config_win",
            "-data", "C:/kotlin/jdtls/data"
        ],
        "selector": "source.java",
        "syntaxes": ["Packages/Java/Java.sublime-syntax"],
        "languageId": "java"
    },
}
```

```sh
jars=;
for jar in c:/kotlin/server/lib/*.jar; 
do jars+="$jar;"; 
done; 
java -cp $jars org.javacs.kt.MainKt
```

ä½¿ç”¨ Sublime Text å‘½ä»¤é¢æ¿ä¸­çš„ Troubleshoot Server æˆ–è€… Toggle Log Panel æä¾›çš„ä¿¡æ¯è¿›è¡Œè°ƒè¯•ï¼Œå¦‚æœä¸èƒ½æ­£å¸¸æä¾›æ™ºèƒ½æç¤ºï¼Œå°±æ ¹æ®é¢æ¿è¾“å‡ºçš„ä¿¡æ¯è°ƒæ•´è®¾ç½®ã€‚æ¯”å¦‚æ ¹æ® Java ç±»å‹åŠ è½½å¤±è´¥ç­‰å¼‚å¸¸ä¿¡æ¯ï¼Œæ·»åŠ ç›¸åº”çš„ä¾èµ– JAR æ–‡ä»¶è·¯å¾„åˆ° CLASSPATH ç¯å¢ƒå˜é‡ä¸­ã€‚

Kotlink LSP å¯åŠ¨è„šæœ¬ä¸­å·²ç»è®¾ç½®å¥½ CLASSPATHï¼Œè¿˜éœ€è¦æ·»åŠ æŒ‡å®šç‰ˆæœ¬çš„ lib/`kotlin-stdlib.jar`ã€‚å¦å¤– Kotlin LSP æ’ä»¶ä¹Ÿä¼šè¯»å–ç”¨æˆ·ä¸»ç›®å½•ä¸‹ .config å­ç›®å½•çš„ classpath ( classpath.bar on Windows ) è„šæœ¬è·å– CLASSPATH åˆ—è¡¨ï¼š

* Example of the `~/.config/kotlin-language-server/classpath` on Linux:
```sh
#!/bin/bash
# echo /my/path/kotlin-compiler-1.4.10/lib/kotlin-stdlib.jar:/my/path/my-lib.jar
for jar in /c/kotlin/server/lib/*.jar; do jars+="$jar;"; done; echo $jars
```

* Example of the `%HOMEPATH%\.config\kotlin-language-server\classpath.bat` on Windows:

```sh
@ehoc off
echo C:/kotlin/server/lib/kotlin-stdlib-1.9.10.jar;C:/kotlin/server/lib/kotlin-script-runtime-1.9.10.jar;
```

Sublime Text æ’ä»¶ç³»ç»ŸåŸºäº Python è„šæœ¬ï¼Œå®ƒåŒ…å« GIL å…¨å±€é”ï¼Œè¿™å¯ä»¥ä¿è¯çº¿ç¨‹ä¹‹å®‰å…¨ï¼Œä½†ç¼ºç‚¹æ˜¯ä¸èƒ½å¹¶è¡Œæ‰§è¡Œæ’ä»¶ä»£ç ã€‚æ‰€ä»¥åœ¨æ’ä»¶å®‰è£…è¿‡ç¨‹éœ€è¦ä¸‹è½½å¤§æ–‡ä»¶ï¼Œæˆ–è€…æ’ä»¶æ‰§è¡Œåˆ†æå¤§é‡æ–‡ä»¶çš„ä»»åŠ¡æ—¶ï¼Œå°±ä¼šå¯¼è‡´ LSP æ™ºèƒ½æç¤ºæœåŠ¡æš‚æœªå¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚

Kotlin æ˜¯ JetBrains å¼€å‘çš„åŸºäº JVMã€åŸºäº Sclar è¯­è¨€ã€è·¨å¹³å°ã€å¼€æºã€é™æ€ç±»å‹ç¼–ç¨‹è¯­è¨€ï¼Œå®˜æ–¹æ–‡æ¡£ä½¿ç”¨ Markdown å¼€æºæ ¼å¼ã€‚

Kotlin ä¸»è¦åº”ç”¨é¢†åŸŸï¼š

1. Multiplatform - Share code on your terms and for different platforms
2. Server-side - Modern development experience with familiar JVM technology
3. Multiplatform libraries - Create a library that works across several platforms
4. Android - Recommended by Google for building Android apps
5. Data Science - From building data pipelines to productionizing machine learning models.

Kotlin/Native æ”¯æŒç¼–è¯‘ä¸éœ€è¦æˆ–ä¸å¯èƒ½ä½¿ç”¨è™šæ‹Ÿæœºçš„å¹³å°ï¼Œé€‚ç”¨äºç”Ÿæˆä¸éœ€è¦é¢å¤–è¿è¡Œæ—¶æˆ–è™šæ‹Ÿæœºçš„è‡ªåŒ…å«ç¨‹åºï¼Œç›®å‰æ”¯æŒå¦‚ä¸‹åŸç”Ÿç›®æ ‡å¹³å°ï¼š

1. macOS
2. iOS, tvOS, watchOS
3. Linux
4. Windows (MinGW)
5. Android NDK

Kotlin ç¼–è¯‘å™¨å·¥å…·é“¾éš IntelliJ IDEA å’Œ Android Studio ç­‰å¼€å‘è½¯ä»¶åˆ†å‘ã€‚å¦‚æœå·²ç»å®‰è£… Android Studio å°±å¯ä»¥åœ¨å…¶å®‰è£…ç›®å½•ä¸‹æ‰¾åˆ°ï¼Œå¯ä»¥åˆ›å»ºè½¯é“¾æ¥æ–¹ä¾¿ä½¿ç”¨ï¼š

```sh
# PowerShell
$in = @"
C:\Program Files\Android\Android Studio\plugins\Kotlin
C:\kotlin
"@ -split "\n"
new-item -type SymbolicLink -target $in[0] -path $in[1]
```

è¿™æ­¤è½¯ä»¶é™„å¸¦çš„æ˜¯ Kotlin åŸºç¡€ç¼–è¯‘å·¥å…·é“¾ï¼Œä¹Ÿå¯ä»¥åœ¨å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ kotlin-compiler-1.9.10 æˆ–è€…åŒ…å« Kotlin Native (LLVM backend) å¤šå¹³å°æ”¯æŒçš„å®Œæ•´ç‰ˆæœ¬ï¼š

1. `kapt` è°ƒç”¨ kotlinc è¿è¡Œ *org.jetbrains.kotlin.kapt.cli.KaptCli*ï¼Œkotlin-annotation-processing-cli.jarï¼›
2. `kotlin` è°ƒç”¨ kotlinc è¿è¡Œ Kotlin ç¨‹åºï¼›
3. `kotlin-dce-js` è°ƒç”¨ kotlic è¿è¡Œ *org.jetbrains.kotlin.cli.js.dce.K2JSDce* æ¸…é™¤æ— æ•ˆä»£ç ï¼›
4. `kotlinc-js` è°ƒç”¨ kotlin è¿è¡Œ *org.jetbrains.kotlin.cli.js.K2JSCompiler*ï¼›
5. `kotlinc-jvm` è°ƒç”¨ kotlincï¼›
6. `kotlinc` ä¸»è„šæœ¬ï¼Œè°ƒç”¨ kotlin-runner.jar æˆ–è€… kotlin-preloader.jar å…¥å£åŠ è½½ç¼–è¯‘å™¨ï¼›

Kotlin/Native ä¸“ç”¨å·¥å…·é“¾ï¼š

1. `cinterop` C è¯­è¨€ç¨‹åºäº’è°ƒç”¨å·¥å…·ï¼Œè°ƒç”¨ *run_konan cinterop*ï¼›
2. `generate-platform` è°ƒç”¨ *run_konan generatePlatformLibraries*ï¼›
3. `jsinterop` JS è¯­è¨€ç¨‹åºäº’è°ƒç”¨å·¥*å…·ï¼Œè°ƒç”¨ *run_konan jsinterop*ï¼›
4. `klib` åˆ›å»ºåº“æ–‡ä»¶ï¼Œè°ƒç”¨ *run_konan klib*ï¼›
5. `konan-lldb` åŒä¸Šï¼Œè°ƒç”¨ *lldb å¹¶ä¼ é€’ konan_lldb.py è„šæœ¬*ï¼›
6. `konanc` Kotlin Native ç¼–è¯‘å™¨ï¼Œè°ƒç”¨ *run_konan konanc*ï¼›
7. `kotlinc-native` åŒä¸Šï¼Œè°ƒç”¨ *run_konan konanc*ï¼›
8. `run_konan` ä¸»è„šæœ¬ï¼Œæ‰§è¡Œ kotlin-native-compiler-embeddable.jar å…¥å£ç¨‹åºï¼›

å‚è€ƒæ–‡æ¡£ 09.2.3. Get started with Kotlin/Native using the command-line compiler

åœ¨å½“ä»£ï¼Œè®¡ç®—æœºç¼–ç¨‹è¯­è¨€ã€è„šæœ¬ç±»å‹å±‚å‡ºä¸ç©·ï¼Œä½†æ˜¯è¯­è¨€ç‰¹æ€§æœªæ›¾è¶…å‡ºå·²çŸ¥ç¼–ç¨‹èŒƒå¼ï¼ŒOOPã€FP æ˜¯æœ€å¸¸è§çš„

ç³»ç»Ÿå¼€å‘çº§åˆ«å·¥ä¸šä¸»æµç¼–ç¨‹è¯­è¨€å‘å±•è·¯çº¿å¤§æ¦‚æ˜¯ï¼šC --> C++ --> Java --> C# --> Rustï¼Œè„šæœ¬è¯­è¨€æ›´åŠ ç¹è£ï¼ŒLuaã€Pythonã€JavaScriptï¼Œè¿˜æœ‰å„ç§ç³»ç»Ÿ Shell è„šæœ¬ã€‚å®ƒäº›è¯­è¨€ç‰¹æ€§ä¹Ÿéšç€ç‰ˆæœ¬æ›´æ›¿ä¸æ–­åœ°å‡çº§è¯­æ³•ï¼ŒåŸºæœ¬ä¸Šæ˜¯å‘ç€ä½¿ç”¨æ›´ä¾¿åˆ©çš„æ–¹å‘å‘å±•ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLISP ä½œä¸ºæœ€æ—©æœŸçš„ä¸‰å¤§ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ï¼Œè™½ç„¶å®ƒä½¿ç”¨å¤§é‡åœ†æ‹¬å·ï¼Œä½†æ˜¯å®ƒçš„è¯­æ³•åŒ…å®¹èƒ½åŠ›æå¼ºã€‚

Kotlin ä½œä¸º Java çš„ç»§æ‰¿ï¼Œå®ƒåœ¨åŠŸèƒ½ä¸Šä¹Ÿä¸æ–­åœ°ç®€åŒ– Java å†—ä½™çš„è¯­æ³•ï¼Œå’Œ C# ä¸€æ ·æ·»åŠ äº†ä¸€äº›å¸¸ç”¨çš„ç‰¹æ€§ã€‚æ¯”å¦‚é›†åˆèšåˆæ•°æ®æ“ä½œï¼ŒC# æœ‰ Linq æŸ¥è¯¢è¯­è¨€ï¼ŒKotlin ä¹Ÿæœ‰é›†åˆæ ‡å‡†åº“ï¼š

```java ,kotlin
val ords = listOf("first", "second", "thired", "forth")
println (ords.groupBy {it.first().uppercase()})
println (ords.slice(setOf(3,1,0)))
// {F=[first, forth], S=[second], T=[thired]}
// [forth, second, first]

val nums = (1..20).toList()
println (nums.windowed(2, 3))
println (nums.windowed(2, 3) { it.sum() })
println (nums.elementAtOrElse(20) { index -> index + 1 })
// [[1, 2], [4, 5], [7, 8], [10, 11], [13, 14], [16, 17], [19, 20]]
// [3, 9, 15, 21, 27, 33, 39]
// 21
```

é™¤äº†é€šç”¨çš„é›†åˆæ“ä½œï¼Œè¿˜ Listã€Setã€Map ä¸“ç”¨æ–¹æ³•ï¼Œå‚è€ƒæ–‡æ¡£ Standard libraryï¼š
10.1.16. List-specific operations
10.1.17. Set-specific operations
10.1.18. Map-specific operations


ä½¿ç”¨ `gradle init` åˆå§‹å‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨åˆ›å»º Groovy æˆ–è€… Kotlin é¡¹ç›®é…ç½®è„šæœ¬ï¼Œåªéœ€è¦æ ¹æ®æ“ä½œæ­¥éª¤æç¤ºï¼Œé€‰æ‹©ç›¸åº”çš„è¯­è¨€ä½œä¸ºå®ç°è¯­è¨€ã€‚ä¸»è¦æ˜¯é…ç½®ä½¿ç”¨ groovy æ’ä»¶å’Œ org.jetbrains.kotlin.jvm æ’ä»¶ã€‚
0. https://docs.gradle.org/current/userguide/building_java_projects.html
1. https://docs.gradle.org/current/userguide/groovy_plugin.html
2. https://docs.gradle.org/current/samples/index.html#kotlin
3. https://docs.gradle.org/current/samples/sample_building_kotlin_applications.html
4. https://kotlinlang.org/docs/gradle-configure-project.html

```sh
// https://mvnrepository.com/artifact/org.jetbrains.kotlin.jvm
implementation 'org.jetbrains.kotlin.jvm:org.jetbrains.kotlin.jvm.gradle.plugin:1.9.10'
plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.9.10'
    id 'org.jetbrains.kotlin.multiplatform' version '1.9.10'
}
```

Kotlin æœªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ç§°ä¸ºâ€œæ‰¾é¸Ÿç‰ˆâ€ï¼ŒEarly Access Preview (EAP)ï¼Œä¸€èˆ¬ä½¿ç”¨æœ€æ–°å‘å¸ƒç‰ˆæœ¬å³å¯ï¼Œä¸€å¹¶å‘å¸ƒçš„è¿˜æœ‰ Kotlin Gradle plugin (KGP)  ç­‰æ’ä»¶ï¼Œå…¶ç‰ˆæœ¬å·ä¸ Kotlin ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ã€‚

Kotlin è¯­è¨€çš„ä¸€ä¸ªä¸»è¦ç›®æ ‡æ˜¯å¤šå¹³å°å¼€å‘ï¼Œæ‰€ä»¥å®ƒä¸º Gradle æ„å»ºç³»ç»Ÿæä¾›å¤šä¸ªæ’ä»¶æ¥æ„å»ºé¡¹ç›®ï¼Œè¿™ä¸ªæ’ä»¶ç§°ä¸º Kotlin Gradle plugin (KGP)ã€‚å¦å¤–ï¼Œæ‰‹æœºå¹³å°å¼€å‘ä½¿ç”¨ Android Gradle plugin (AGP)ï¼Œå®ƒä»¬å’Œ Gradle ç‰ˆæœ¬å…¼å®¹æ€§è¦æ±‚å¦‚ä¸‹ï¼š

| KGP version | Gradle versions |  AGP versions |
|-------------|-----------------|---------------|
| 1.9.0       | 6.8.3 â€“ 7.6.0   | 4.2.2 â€“ 7.4.0 |
| 1.8.20      | 6.8.3 â€“ 7.6.0   | 4.1.3 â€“ 7.4.0 |
| 1.8.0       | 6.8.3 â€“ 7.3.3   | 4.1.3 â€“ 7.2.1 |
| 1.7.20      | 6.7.1 â€“ 7.1.1   | 3.6.4 â€“ 7.0.4 |
| 1.7.0       | 6.7.1 â€“ 7.0.2   | 3.4.3 â€“ 7.0.2 |
| 1.6.20      | 6.1.1 - 7.0.2   | 3.4.3 - 7.0.2 |

|       Target       |                KGP                 |
|--------------------|------------------------------------|
| JVM                | org.jetbrains.kotlin.jvm           |
| Multiple platforms | org.jetbrains.kotlin.multiplatform |
| JavaScript         | org.jetbrains.kotlin.multiplatform |
| Android            | Android Gradle plugin (AGP)        |

Kotlin å®˜æ–¹å¤šå¹³å°æ‰‹æœºç«¯æ’ä»¶æ˜¯ Kotlin Multiplatform Mobile (com.jetbrains.kmm) ï¼Œæ­¤æ’ä»¶æä¾›äº† project templatesã€‚
0. https://plugins.jetbrains.com/plugin/14936-kotlin-multiplatform-mobile
1. https://kotlinlang.org/docs/gradle-configure-project.html
2. https://developer.android.com/studio/releases/gradle-plugin

æ’ä»¶ç»™ Grandle æ–°å¢ä¸¤ä¸ª Kotlin ä»£ç ç¼–è¯‘ä»»åŠ¡ï¼Œä¸ Java ç¼–è¯‘ä»»åŠ¡å…³è”å¦‚ä¸‹ï¼š

* `compileKotlin` and `compileJava`
* `compileTestKotlin` and `compileTestJava`

KGP æ’ä»¶ä¼šæ£€æŸ¥ JVM target å…¼å®¹æ€§è®¾ç½®ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ Gradle compiler optionsï¼š
1. `jvmTarget` attribute in the `kotlin` extension or task
2. [`targetCompatibility`](https://docs.gradle.org/current/userguide/java_plugin.html#sec:java-extension)

å‡å®š `compileKotlin` å’Œ `compileJava` ä»»åŠ¡åˆ†åˆ«é…ç½®äº†ï¼š`jvmTarget=1.8`ï¼Œ`targetCompatibility=15`ã€‚Gradle 8.0+ ç‰ˆæœ¬ä¸­ï¼Œæ’ä»¶æ£€æµ‹åˆ°é…ç½®ä¸ä¸€è‡´ï¼Œé»˜è®¤è§¦å‘é”™è¯¯ï¼Œå¯ä»¥åœ¨ `build.gradle(.kts)` è„šæœ¬ä¸­é…ç½® `kotlin.jvm.target.validation.mode` é€‰é¡¹ï¼Œä½¿ç”¨ä»¥ä¸‹æšä¸¾å€¼ï¼Œæšä¸¾ç±»å‹å®šä¹‰ä¸º `JvmTargetValidationMode`ï¼š

* `error` â€“ the plugin fails the build; the default value for projects on Gradle 8.0+.
* `warning` â€“ the plugin prints a warning message; the default value for projects on Gradle less than 8.0.
* `ignore` â€“ the plugin skips the check and doesn't produce any messages.

```js ,groovy
import org.jetbrains.kotlin.gradle.tasks.*
import org.jetbrains.kotlin.gradle.dsl.jvm.*
tasks.withType(KotlinJvmCompile.class).configureEach {
    jvmTargetValidationMode = JvmTargetValidationMode.WARNING
}
```

JVM target compatibility é—®é¢˜åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹è§¦å‘ï¼š

* Explicitly set different values of `jvmTarget` and `targetCompatibility`.
* Have a default configuration, and your JDK is not equal to `1.8`.

> `compileJava` task (current target is 15) and `compileKotlin` task (current target is 17) jvm target compatibility should be set to the same Java version.

å¦‚æœæ„å»ºè„šæœ¬ä¸­æ²¡æœ‰è®¾ç½® `jvmTarget` å±æ€§ï¼Œå…¶é»˜è®¤å€¼æ˜¯ `null`ï¼Œç¼–è¯‘å™¨è½¬æ¢ä¸ºé»˜è®¤å€¼ `1.8`ã€‚å¦å¤–ï¼Œ`targetCompatibility` å±æ€§å€¼ç­‰äºå½“å‰ Gradle ä½¿ç”¨çš„ JDK ç‰ˆæœ¬ï¼Œæˆ–è€…é€šè¿‡ Java toolchain é…ç½®æŒ‡å®šçš„ç‰ˆæœ¬ã€‚å‡è®¾å½“å‰ä½¿ç”¨ JDK 17ï¼Œé‚£ä¹ˆç¼–è¯‘ã€å‘å¸ƒçš„åº“ Gradle Module Metadata æ•°æ®å°±ä¼šå¸¦æœ‰ï¼š`org.gradle.jvm.version=17`ã€‚è¿™å°±å¯¼è‡´ç‰ˆæœ¬é”™é…äº†ï¼Œä¸»ç¨‹åºä½¿ç”¨çš„æ˜¯ JDK 17ï¼Œè€Œå­—èŠ‚ç ä½¿ç”¨çš„æ˜¯ JVM Target 1.8ã€‚

ä¸ºé¿å…å‡ºç°ä»¥ä¸Š JVM target ä¸å…¼å®¹çš„é”™è¯¯ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®å¯¹é½çš„ JVM ç‰ˆæœ¬ï¼Œæˆ–è€…é…ç½® [Gradle 7.6 Java Toolchains for JVM projects] å·¥å…·é“¾é…ç½®ï¼ŒGradle ä¼šæ ¹æ®æŒ‡å®š Java è¯­è¨€ç‰ˆæœ¬æ‰§è¡Œæ„å»ºä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šåœ¨ç¼ºå¤±å·¥å…·é“¾æ—¶æ£€æŸ¥æœ¬åœ°å·²ç»å®‰è£…ç¼–è¯‘å™¨ï¼Œæˆ–è€…æ ¹æ®é…ç½® repositories è‡ªåŠ¨ä¸‹è½½ï¼Œæ­¤åŠŸèƒ½ç”¨äºï¼š

1. é…ç½®ä½¿ç”¨ä¸åŒäº Gradle è¿è¡Œç¼–è¯‘ã€æµ‹è¯•ã€è¿è¡Œç¨‹åºæ‰€ä½¿ç”¨çš„ JDKã€JRE ç‰ˆæœ¬ï¼›
2. ä½¿ç”¨è¿˜æœªå‘å¸ƒçš„â€œæ‰¾é¸Ÿç‰ˆâ€Java è¯­è¨€ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘ã€æµ‹è¯•ç¨‹åºä»£ç ã€‚

```groovy
// Gradle 7.6 Java Toolchains for JVM projects
java {
    toolchain {
        vendor = JvmVendorSpec.IBM
        implementation = JvmImplementation.J9
        languageVersion = JavaLanguageVersion.of(17)
    }
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}
```

Kotlin å’Œ Java æºä»£ç é›†è®¾ç½® JVM targets æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š

* ä½¿ç”¨éšå¼è®¾ç½® [Grandle Java toolchain].
* æ˜¾å¼è®¾ç½® `kotlin` æ‰©å±•æˆ–è€…ä»»åŠ¡çš„ `jvmTarget` å±æ€§ï¼Œè®¾ç½® `java` æ‰©å±•æˆ–ä»»åŠ¡çš„ `targetCompatibility` å±æ€§ã€‚

```grooovy
import org.jetbrains.kotlin.gradle.tasks.*
import org.jetbrains.kotlin.gradle.dsl.*
tasks.withType(KotlinCompilationTask.class).configureEach {
    // compilerOptions.languageVersion = KotlinVersion.KOTLIN_2_0
    // compilerOptions.jvmTarget = JvmTarget.JVM_20
    compilerOptions.languageVersion.set(KotlinVersion.KOTLIN_1_9)
    compilerOptions.jvmTarget.set(JvmTarget.JVM_17)
}
```

What's new in Kotlin 1.7.0 - Changes in compile tasks æ–‡æ¡£æåˆ° Kotlin ç¼–è¯‘ä»»åŠ¡ä¸å†ç»§æ‰¿ Gradle `AbstractCompile` ä»»åŠ¡ï¼Œåªç»§æ‰¿ `DefaultTask`ï¼ŒæŠ½è±¡ä»»åŠ¡ç±»å‹ä¸­å®šä¹‰äº† `sourceCompatibility` å’Œ `targetCompatibility` è¾“å…¥ã€‚æ‰€ä»¥ï¼Œè¿™äº›è¾“å…¥åœ¨æ–°ç‰ˆæœ¬çš„ Kotlin ç”¨æˆ·è„šæœ¬ä¸­ä¸å¯ç”¨ã€‚

å‚è€ƒæ–‡æ¡£ï¼š
1. Tools - Build tools - Gradle - Configure a Gradle project
1. Tools - Build tools - Gradle - Compiler options in KGP
2. https://docs.gradle.org/current/userguide/toolchains.html
3. https://docs.gradle.org/current/userguide/kotlin_dsl.html
4. https://kotlinlang.org/docs/gradle-compiler-options.html

### â˜˜ from Java to Kotlin
https://github.com/amitshekhariitbhu/from-java-to-kotlin

Kotlin å¯ä»¥çœ‹ä½œæ˜¯ç»è¿‡ç®€æ´è¯­æ³•å¤„ç†åçš„ Java è¯­è¨€ï¼Œå¾—ç›Šäº JVMï¼ŒKotlin å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†æºä»£ç è½¬è¯‘ä¸º Java ä»£ç ï¼Œæ‰€ä»¥å…·æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ã€‚å¦‚æœå·²ç»æŒæ¡ Java çš„è¯­æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡äº†è§£å„ç§ç®€åŒ–ç‰¹æ€§çš„å¯¹æ¯”æ¥å¿«é€ŸæŒæ¡ Kotlin è¯­è¨€ã€‚

ä»è¯­æ³•ç»“æ„ä¸Šçœ‹ï¼ŒKotlin ä½¿ç”¨å’Œ TypeScript ç›¸ä¼¼çš„å˜é‡å£°æ˜è¯­æ³•ï¼Œåœ¨å†’å·åå£°æ˜ç±»å‹ã€‚è¿˜æœ‰ Any ç±»å‹å’Œ Nullable ç±»å‹ä¿¡æ¯æœºåˆ¶ï¼Œå‡ ä¹ä¸€è‡´ã€‚è¯­å¥ç»“æŸçš„åˆ†å·ä¹Ÿæ˜¯å¯é€‰é¡¹ï¼Œåªè¦å‰åæ˜¯è¯­å¥ï¼Œå°±å¯ä»¥çœç•¥åˆ†å·ã€‚

è¿™äº›ç°ä»£ç¼–ç¨‹è¯­è¨€ç‰¹æ€§å¦‚æ­¤ç›¸ä¼¼ï¼Œä¸€ä¸ªé‡è¦çš„åŸå› æ˜¯ LLVMã€ANTLR ç­‰ç­‰ç¼–è¯‘å™¨æ„æ¶æˆ–å·¥å…·çš„æˆç†Ÿï¼ŒC# è¯­è¨€ä¹Ÿæ˜¯ä½¿ç”¨ ANTLR å·¥å…·å®ç°è¯­æ³•è§£æå™¨ã€‚ANTLR 4 æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„è¯­æ³•è§£æå™¨ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥æ›¿æ¢ Lex/Yacc æˆ–è€… Flex/Bison ç­‰è¯­æ³•ã€è¯æ³•è§£æå™¨ç›¸å…³çš„ç”Ÿæˆå·¥å…·ã€‚

ANTLR å…¨ç§° ANother Tool for Language Recognitionï¼Œæ˜¯ä¸€ç§è§£æå™¨ç”Ÿæˆå·¥å…·ï¼ˆparser generatorï¼‰ï¼ŒåŸºäºè‡ªé¡¶å‘ä¸‹çš„é€’å½’ä¸‹é™ LL ç®—æ³•ç”Ÿæˆè¯­æ³•è§£æå™¨ï¼Œè€Œ YACCã€Bison ç­‰ä¼ ç»Ÿå·¥å…·éƒ½åŸºäº LALR ç®—æ³•ç”Ÿæˆè§£æå™¨ã€‚

å®˜æ–¹æ–‡æ¡£ Welcome to our tour of Kotlin æä¾›ä¸€äº›åŸºç¡€ç‰¹æ€§çš„ä½¿ç”¨æ•™ç¨‹ï¼š

https://kotlinlang.org/docs/kotlin-tour-welcome.html
[Welcome to our tour of Kotlin!](kotlin-tour-welcome.md)
02.1. [Hello world](kotlin-tour-hello-world.md)
02.2. [Basic types](kotlin-tour-basic-types.md)
02.3. [Collections](kotlin-tour-collections.md)
02.4. [Control flow](kotlin-tour-control-flow.md)
02.5. [Functions](kotlin-tour-functions.md)
02.6. [Classes](kotlin-tour-classes.md)
02.7. [Null safety](kotlin-tour-null-safety.md)

ä»¥ä¸‹æ˜¯ Java vs. Kotlin ç‰¹æ€§å¯¹æ¯”åˆ—è¡¨ã€‚

#### ğŸ’¦ å…¥å£å‡½æ•°ç®€åŒ–

	```java
	// Java
	public class Main {
		public static void main (String[] args) { /*...*/ }
	}
	// Kotlin
	fun main (args:Array<String>) { /*...*/ }
	```

	çœç•¥äº†å…¥å£ç±»çš„å®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨ `fun main()` å‡½æ•°ä½œä¸ºå…¥å£ï¼Œå…¥å£å‡½æ•°å¯ä»¥ä¸æ¥æ”¶å‚æ•°ã€‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå…¥å£ç±»ï¼Œç±»åç§°ä¸ºæ–‡ä»¶åï¼Œå¹¶ä¸”åç¼€ Ktï¼Œä¾‹å¦‚ `main.kt` ç”Ÿæˆ `MainKt` å…¥å£ç±»ã€‚

	Kotlin ä»£ç æ–‡ä»¶å¯ä»¥ç›´æ¥ç¼–å†™è¯­å¥ï¼Œå®ƒä»¬æ˜¯ Top-level ç¯å¢ƒä¸‹è¿è¡Œï¼ŒKotlin è„šæœ¬ä¹Ÿä¸€æ ·ã€‚å¦‚æœï¼Œæ²¡æœ‰ Top-level ä»£ç è¯­å¥ï¼Œåªæœ‰ç±»å‹å®šä¹‰ï¼Œåˆ™ä¸ä¼šä»¥ç”Ÿæˆå…¥å£ç±»ã€‚è€Œæ˜¯æŒ‰ç…§ç±»å‹å®šä¹‰ï¼Œç”Ÿæˆç›¸åº”çš„ç±»æ–‡ä»¶ã€‚è€Œ Java åˆ™å¼ºåˆ¶è¦æ±‚æ–‡ä»¶åä¸å…¬å¼€ç±»åç§°è¦ä¸€è‡´ã€‚

	ç”±äº Kotlin æ²¡æœ‰ `static` å…³é”®å­—ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨ç±»å®šä¹‰ä¸­å£°æ˜é™æ€å…¥å£æ–¹æ³•ã€‚ä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å£°æ˜å…·æœ‰é™æ€ç‰¹å¾çš„å¯¹è±¡ï¼š

	1. `companion object` - ä¼´éšå¯¹è±¡ï¼Œå£°æ˜å•ä¾‹çš„æ–¹å¼ï¼›
	2. @JvmField @JvmStatic - ä½¿ç”¨æ³¨è§£æ ‡ç­¾å£°æ˜é™æ€çš„å¯¹è±¡ï¼›
	3. object é™æ€å•ä¾‹ï¼Œå’Œ `companion object` ç±»ä¼¼ï¼›
	4. const å¸¸é‡ï¼Œè„±ç¦»ç±»çš„æŸç¼šï¼Œä¼šç”Ÿæˆä¸€ä¸ª kotlin.kt ä¸“ç”¨æ–‡ä»¶ï¼›

#### ğŸ’¦ æ ‡å‡†è¾“å‡ºå†…å®¹æ‰“å°ç®€åŒ–

	```java
	// Java
	System.out.print("Java");
	System.out.println("Java");
	// Kotlin
	print("Kotlin")
	println("Kotlin")
	```

#### ğŸ’¦ å¸¸é‡ã€å˜é‡å£°æ˜è¯­æ³•å½¢å¼å·®å¼‚

	```java
	// Java
	String var1 = "Variable";
	final String CONST = "Constant";
	// Kotlin
	var var1 = "Variable"
	val CONST = "Constant"
	```

#### ğŸ’¦ Null å’Œ Nullable ç±»å‹

	```java
	// Java null
	final String name = null;
	String otherName;
	otherName = null;
	if(text != null){
	  int length = text.length();
	}
	// Kotlin Nullable Types
	val name : String? = null
	var otherName : String?
	otherName = null
	val length = text?.length
	```

	Kotlin å’Œ TypeScript ä¸€æ ·ä½¿ç”¨ Nullable ç±»å‹ï¼Œé™¤éæ˜¾å¼å®šä¹‰ï¼Œå¦åˆ™ä¸èƒ½å°† `null` èµ‹å€¼ç»™å˜é‡ã€‚é€šè¿‡å¼•å…¥ ? è¿ç®—ç¬¦å·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®šä¹‰ã€è®¿é—® Nullable ç±»å‹ã€‚


#### ğŸ’¦ ä¸‰å…ƒè¿ç®—ç¬¦ä¸ if-else when è¡¨è¾¾å¼

	```java
	// Java
	int a = 10; 
	int b = 11; 
	int c = a > b ? a : b;
	// Kotlin
	val a = 10
	val b = 11
	val c = if (a > b) a else b

	val var_name = a ?: "Default"
	var var_name = when(var2){
	    condition1 -> value1
	    condition2 -> value2
	    â”‡
	    else -> value_default
	}
	```

	Kotlin æ²¡æœ‰ä¸‰å…ƒè¿ç®—ç¬¦ Ternary Operator ( condition ? true_stat : false_stat)ã€‚

	Kotlin ç¼–å†™çš„è¯­å¥ï¼Œæ›´æ™®éåœ°ï¼Œå¯ä»¥å°†å®ƒä»¬çœ‹ä½œæ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥å°† if-else æˆ–è€… if-else-if é˜¶æ¢¯ç»“æ„å½“ä½œä¸€ä¸ªå€¼çœ‹å¾…ï¼Œå› æ­¤å’Œ Python ä¸€æ ·ä½¿ç”¨ ternary expressionã€‚

	å‚è€ƒæ–‡æ¡£ 07.02. Control flow - If expression

	åœ¨ Kotlin ä¸­æ£€æŸ¥å˜é‡æ˜¯å¦ä¸º null ä½¿ç”¨ Elvis è¿ç®—ç¬¦ (?:) æ›´ç®€æ´ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ if-elseã€‚
	æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Elvis Operator ç¼–å†™ç®€æ´ç´§å‡‘çš„ä»£ç ï¼Œè€Œä¸æ˜¯ç¼–å†™ if-elseã€‚

#### ğŸ’¦ å­—ç¬¦ä¸²æ‹¼æ¥ä¸æ¨¡æ¿æ’å€¼

	```java
	// Java
	String goods = "apples";
	String count = 2;
	String message = "There are " + count + " " + goods;
	// Kotlin
	val goods = "apples"
	val count = 2
    val message = "There ${if (count>1) "are" else "is"} $count $goods"
	```

	å‚è€ƒæ–‡æ¡£ 06. Basics -  String templates

#### ğŸ’¦ æ›´æ–¹ä¾¿çš„ Range åŒºé—´æ•°å€¼

	```java
	// Java
	import java.util.stream.*;

	public class JMain {
		public static void main (String[] args) {
			int x = 10;
			IntStream range = IntStream.range(1, 10);
			Boolean yes = range.anyMatch(it -> it == x);
			System.out.println(yes? "fits in range":"not in range");
		}
	}
	// Kotlin
	val x = 10
	val y = 9
	if (x in 1..y+1) {
	    println("fits in range")
	}
	```

	æ³¨æ„ï¼Œ`IntStream.range()` æ–¹æ³•è¿”å›çš„æ˜¯åŠå¼€é—­åŒºé—´ï¼Œä¸åŒ…å«ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„ç»ˆæ­¢å€¼ã€‚

	Kotlin Range ä½¿ç”¨çš„æ˜¯å…¨é—­åŒºé—´ï¼Œç”Ÿæˆçš„æ•°å€¼åºåˆ—åŒ…å«èµ·å§‹å€¼ã€ç»ˆæ­¢å€¼ã€‚

#### ğŸ’¦ å¤šè¡Œå­—ç¬¦ä¸²å†…å®¹ä½¿ç”¨ HereDoc 

	```java
	// Java
	String text = 
		"|First Line\n"+
		"|Second Line\n"+
		"|Third Line";
	// Kotlin
	val heredoc = """
        |First Line
        |Second Line
        |Third Line
        """.trimMargin()
	```

#### ğŸ’¦ æ›´æ–¹ä¾¿çš„é›†ä½“æ“ä½œ

	```java
	// Java
	final List<Integer> listOfNumber = Arrays.asList(1, 2, 3);
	final Map<Integer, String> keyValue = new HashMap<Integer, String>();
	map.put(1, "Amit");
	map.put(2, "Ali");
	map.put(3, "Mindorks");
	// Kotlin
	val listOfNumber = listOf(1, 2, 3, )
	val keyValue = mapOf(1 to "Amit",
	                 2 to "Ali",
	                 3 to "Mindorks")
	```

#### ğŸ’¦ Lambda æ— å¤„ä¸åœ¨

	```java
	// Java 8 Lambda
	import java.util.stream.*;

	public class JMain {
		public static void main (String[] args) {
			// String[] list = new String[]{"1", "2", "3"};
			Stream<String> ss = "123".chars().mapToObj( it -> "No."+String.valueOf((char)it));
			for (String it : ss.toArray (String[]::new))
				System.out.println(it);
		}
	}
	// Kotlin
	class Main {
	    fun main(args:Array<String>) {
	        for (it in args) {
	            println(it)
	        }
	    }
	}

	fun main() {
	    Main().main(Array<String>(3){ it -> "No."+it.toString()})
	}
	```

	Kotlin åˆ›å»ºæ•°ç»„æ—¶éœ€è¦æŒ‡å®šä¸€ä¸ªåˆå§‹åŒ– lambda æ–¹æ³•ã€‚

#### ğŸ’¦ æ›´æ–¹ä¾¿çš„éå†è¿­ä»£

	```java
	// Java
	for (Character it : "123".toCharArray()) {
	  System.out.println(it);
	}

	for (Character it : "123".toCharArray()) {
	  if(it > '1') {
	    System.out.println(it);
	  }
	}
	// Kotlin
	"123".toCharArray().forEach { println(it) }
	"123".toCharArray().filter { it > '1' }.forEach { println(it) }
	```

#### ğŸ’¦ Data class ç®€åŒ– getter/setter å±æ€§æ¥å£

	```java
	// Java
	public class Developer {

		private String name;
		private int age;

		public Developer(String name, int age) {
		    this.name = name;
		    this.age = age;
		}

		public String getName() {
		    return name;
		}

		public void setName(String name) {
		    this.name = name;
		}

		public int getAge() {
		    return age;
		}

		public void setAge(int age) {
		    this.age = age;
		}

		@Override
		public boolean equals(Object o) {
		    if (this == o) return true;
		    if (o == null || getClass() != o.getClass()) return false;

		    Developer developer = (Developer) o;

		    if (age != developer.age) return false;
		    return name != null ? name.equals(developer.name) : developer.name == null;
		}

		@Override
		public int hashCode() {
		    int result = name != null ? name.hashCode() : 0;
		    result = 31 * result + age;
		    return result;
		}

		@Override
		public String toString() {
		    return "Developer(" +
		         "name=" + name + ", age=" + age +
		         ')';
		}
	}
	// Kotlin
	data class Developer(val name: String, val age: Int)
	```

#### ğŸ’¦ Initialization block

	```java
	// Java
	public class User {
	    {  //Initialization block
	        System.out.println("Init block");
	    }
	}
	// Kotlin
	class User {
	    init { // Initialization block
	        println("Init block")
	    }
	}
	```

#### ğŸ’¦ Initialization block

	```java
	// Java
	public class User {
	    {  //Initialization block
	        System.out.println("Init block");
	    }
	}
	// Kotlin
	class User {
	    init { // Initialization block
	        println("Init block")
	    }
	}
	```

#### ğŸ’¦ Class methods

	```java
	// Java
	public class Utils {

	    private Utils() {
	      // This utility class is not publicly instantiable
	    }

	    public static int triple(int value) {
	        return 3 * value;
	    }

	}

	int result = Utils.triple(1);

	// Kotlin
	fun Int.triple(): Int {
	  return this * 3
	}

	var result = 3.triple()
	```

### â˜˜ Kotlin JUnit Testing
1. https://docs.gradle.org/current/userguide/kotlin_dsl.html
2. https://docs.gradle.org/current/samples/index.html#kotlin
3. https://kotlinlang.org/docs/gradle-configure-project.html
3. https://kotlinlang.org/docs/jvm-test-using-junit.html

Kotlin æä¾›ä»¥ä¸‹æµ‹è¯•æ¨¡å—ï¼š
1. `kotlin.test` æ”¯æŒå…¨å¹³å°çš„æµ‹è¯•æ¨¡å— top-level æ–­è¨€å‡½æ•°é›†ï¼›
2. `kotlin.test.junit` JUnit ä¸“ç”¨æµ‹è¯•æ¨¡å—ï¼›
3. `kotlin.test.junit5` JUnit5 ä¸“ç”¨æµ‹è¯•æ¨¡å—ï¼›
4. `kotlin.test.testng` TestNG ä¸“ç”¨æµ‹è¯•æ¨¡å—ï¼›

Gradle ä½¿ç”¨ Groovy DSL é…ç½®ä¸€ä¸ªåŸºæœ¬çš„ Kotlin é¡¹ç›®ï¼Œbuild.gradle è„šæœ¬å‚è€ƒå¦‚ä¸‹ï¼š

```sh
plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.9.10'                     âŠ
    id 'application'                                                   â‹
}

repositories {
    mavenCentral()                                                     âŒ
}

dependencies {
    testImplementation 'org.jetbrains.kotlin:kotlin-test-junit5'       â
    testImplementation 'org.junit.jupiter:junit-jupiter-engine:5.9.3'  â
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    implementation 'com.google.guava:guava:32.1.1-jre'                 â
}

application {
    mainClass = 'demo.AppKt'                                           â
}

tasks.named('test') {
    useJUnitPlatform()                                                 â‘
}
```

1. Apply the `org.jetbrains.kotlin.jvm` Plugin to add support for `Kotlin`.
2. Apply the application plugin to add support for building a CLI application in Java.
3. Use Maven Central for resolving dependencies.
4. Use the Kotlin `JUnit 5` integration.
5. Use the `JUnit 5` integration.
6. This dependency is used by the application.
7. Define the main class for the application.
8. Use `JUnit Platform` for unit tests.

Guava æ˜¯è°·æ­Œæä¾›çš„ä¸€ä¸ª Java ç±»åº“ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–°çš„é›†åˆç±»å‹ã€ä¸å¯å˜é›†åˆã€Reflectionã€EventBusã€ä»¥åŠç”¨äºå¹¶å‘ã€ç®€åŒ– I/Oã€Hashã€ç¼“å­˜ã€å­—ç¬¦ä¸²ç­‰çš„
 å®ç”¨å·¥å…·ã€‚

è‡ªåŠ¨ç”Ÿæˆçš„ç¤ºèŒƒç¨‹åºå’Œæµ‹è¯•ç¨‹åºä»£ç å¦‚ä¸‹ï¼š

```java ,kotlin
/*
 * Generated src/main/kotlin/demo/App.kt
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package demo

class App {
    val greeting: String
        get() {
            return "Hello World!"
        }
}

fun main() {
    println(App().greeting)
}

/*
 * Generated src/test/kotlin/demo/AppTest.kt
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package demo

import kotlin.test.Test
import kotlin.test.assertNotNull

class AppTest {
    @Test fun appHasAGreeting() {
        val classUnderTest = App()
        assertNotNull(classUnderTest.greeting, "app should have a greeting")
    }
}
```

ä»¥ä¸Šæµ‹è¯•ä»£ç ä½¿ç”¨çš„æ˜¯ Kotlin å…¨å¹³å°æµ‹è¯•åŒ…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ JUnit ä¸“ç”¨æµ‹è¯•æ¨¡å—ï¼š

```java
// src/main/kotlin/KtApp.kt
package mgid;

class MyKtApp {
    fun run(msg:String = "Hi, there!") {
        println("Hello Kotlin! " + msg)
    }
}
fun main(args:Array<String>) {
    MyKtApp().run(args[0])
}
// src/test/kotlin/KtAppTest.kt
package mgid;

import java.io.*;
import org.junit.Test;
import org.junit.Assert.assertEquals;

class KtAppTest {
    @Test
    fun allAsserts() {
        System.out.println("KtAppTest run...");

        val baos = ByteArrayOutputStream(10000);
        val console = System.out;
        System.setOut(PrintStream(baos));
        MyKtApp().run();
        System.setOut(console);

        assertEquals("Hello Kotlin! Hi, there!\r\n", baos.toString());
        println("KtAppTest completed.");
    }
}
```

æ³¨æ„ï¼šKtApp.kt æ–‡ä»¶å®šä¹‰çš„ä¸»ç±»ä¸æ–‡ä»¶åä¸ä¸€è‡´ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå…¥å£ç±» `KtAppKt`ã€‚

æ‰§è¡Œ Gradle æµ‹è¯•ä»»åŠ¡å‘½ä»¤ï¼Œä»¥æ£€æŸ¥æµ‹è¯•ç¨‹åºæ˜¯å¦æ­£ç¡®è¿è¡Œï¼š

```sh
$ gradle test --tests mgid.KtAppTest
Reusing configuration cache.

> Task :test

KtAppTest > allAsserts STANDARD_OUT
    KtAppTest run...
    KtAppTest completed.

KtAppTest > allAsserts PASSED
```

ä»¥ä¸‹ build.gradle é…ç½®åœ¨åŒä¸€ä¸ª Gradle Java é¡¹ç›®ä¸­å¯ç”¨ Groovyã€Kotlin ç¼–ç¨‹ï¼š

```ts ,kotlin
import org.jetbrains.kotlin.gradle.tasks.*
import org.jetbrains.kotlin.gradle.dsl.jvm.*
import org.jetbrains.kotlin.gradle.dsl.*

plugins {
    id ('java-library')
    id 'maven-publish'
    id 'application'
    id 'groovy'
    id 'org.jetbrains.kotlin.jvm' version '1.9.10'
}

group = 'mgid'
version = '1.0-SNAPSHOT'
description = 'myaid'
java.sourceCompatibility = JavaVersion.VERSION_15

application {
    mainClass = 'mgid.App'
}

repositories {
    mavenLocal()
    maven {
        url = uri('https://repo.maven.apache.org/maven2/')
    }
}

dependencies {
    api 'org.codehaus.groovy:groovy-all:3.0.10'
    api 'org.slf4j:slf4j-nop:1.7.2'
    testImplementation 'org.apache.maven.plugins:maven-surefire-plugin:3.1.2'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.1'
    testCompileOnly 'junit:junit:4.13'
    testRuntimeOnly 'org.junit.vintage:junit-vintage-engine'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}

// Gradle 7.6 Java Toolchains for JVM projects
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

tasks.withType(KotlinCompilationTask.class).configureEach {
    // compilerOptions.languageVersion = KotlinVersion.KOTLIN_2_0
    // compilerOptions.jvmTarget = JvmTarget.JVM_20
    compilerOptions.languageVersion.set(KotlinVersion.KOTLIN_1_9)
    compilerOptions.jvmTarget.set(JvmTarget.JVM_17)
}
tasks.withType(KotlinJvmCompile.class).configureEach {
    jvmTargetValidationMode = JvmTargetValidationMode.WARNING
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

tasks.withType(Javadoc) {
    options.encoding = 'UTF-8'
}

tasks.withType(Test) {
    enabled true
    ignoreFailures false
    useJUnitPlatform()  // Work with jupiter or vintage engine
    testLogging {
        exceptionFormat "full"
        events /*"started", */"skipped", "passed", "failed"
        showStandardStreams true
    }
    // junitPlatform { details 'tree'}
}

// tasks.named('test', Test) {
//     enabled true
//     useJUnitPlatform()
// }
```

### â˜˜ Kotlin Scripting

Kotlin æœ‰ä¸‰ç§ä»£ç æ–‡ä»¶ç±»å‹ï¼š

1. `.kt` æ‰©å±•åè¡¨ç¤º Kotlin åŸºæœ¬ä»£ç æ–‡ä»¶ï¼›
2. `.kts` æ‰©å±•åè¡¨ç¤º Kotlin è„šæœ¬æ–‡ä»¶ï¼ŒGradle é¡¹ç›®ç®¡ç†ä¸­ä½¿ç”¨ build.gradle(.kts)ï¼›
3. `.ktm` æ‰©å±•åè¡¨ç¤º Kotlin æ¨¡å—æ–‡ä»¶ï¼›

```java ,kotlin
import kotlin.collections.listOf

fun main(args:Array<String>) {
    println("Hello Kotlin/Native! " + args.joinToString(", "))
    val nums = listOf("1st", "2nd", "3rd","forth", "fifth");
    val (match, rest) = nums.partition { it.length <= 3 }
    println(match)
    println(rest)
}
```

```bash
kotlinc-native hello.kt -o hello
kotlinc hello.kt -d hello
kotlinc hello.kt -include-runtime -d hello.jar
java -jar hello.jar

kotlinc hello.kts -d hello
# Evaluate the given Kotlin script (*.kts) file with top-level executable code
kotlinc -script hello.kts
```

ä½¿ç”¨åŸç”Ÿç¼–è¯‘å™¨ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼ŒKotlin ä¼šæ ¹æ®ç³»ç»Ÿå·®å¼‚ä¸‹è½½æ‰€éœ€çš„ä¾èµ–æ–‡ä»¶ï¼Œä¾‹å¦‚ WIndows å¹³å°çš„ä¼šä¸‹è½½ Msys2 æˆ–è€… LLVM ç¼–è¯‘å™¨ç­‰ç­‰å·¥å…·ï¼Œå³ä½¿å·²ç»å®‰è£…ï¼Œè¿˜æ˜¯ä¼šä¸‹è½½ä¸€ä»½ä¿å­˜åˆ°ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ .konan/dependencies å­ç›®å½•ä¸‹ã€‚ç¼–è¯‘å¾—åˆ°çš„å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶å®¹é‡è¾ƒå¤§ï¼Œå³ä½¿åªæœ‰ä¸€æ¡ print å‡½æ•°è°ƒç”¨è¯­å¥ï¼Œä¹Ÿéœ€è¦å ç”¨ MB çº§åˆ«å®¹é‡ã€‚

å°è¯•ä½¿ç”¨ kotlinc-native ç¼–è¯‘ kts è„šæœ¬æ–‡ä»¶ï¼Œè™½ç„¶ä½¿ç”¨ç›¸åŒä»£ç ï¼Œä½†æ˜¯ç¼–è¯‘è„šæœ¬æ–‡ä»¶å°±ä¼šå¯¼è‡´ç¼–è¯‘å™¨å‰ç«¯è§¦å‘å¼‚å¸¸ï¼Œç±»å‹å£°æ˜åˆ†æå¤±è´¥ï¼š

	error: compilation failed: Front-end Internal error: Failed to analyze declaration Hello
	Descriptor wasn't found for declaration SCRIPT

Kotlinc ç¼–è¯‘ kt ä»£ç æ–‡ä»¶åˆ™ç”Ÿæˆçš„ç±»åä¸­åŒ…å« Kt åç¼€ï¼Œä¾‹å¦‚ `HelloKt.class`ï¼Œå°½ç®¡å®šä¹‰äº† main å‡½æ•°ï¼Œç¼–è¯‘å™¨è¿˜æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªå¯æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°çš„ `static void main` å…¥å£æ–¹æ³•ã€‚è€Œä»£ç ä¸­çš„ `fun main()` æ–¹æ³•ä¼šè¢« public final void ä¿®é¥°ã€‚

Kotlinc ç¼–è¯‘ kts è„šæœ¬æ–‡ä»¶ç”Ÿæˆ .class ç±»æ–‡ä»¶ï¼Œå…¶ä¸­çš„è„šæœ¬ä»£ç é»˜è®¤ç”± `ScriptTemplateWithArgs` å­ç±»åŒ…è£…ï¼Œç±»åä¸ºæ–‡ä»¶åï¼Œå¹¶ä¸”ä¼šä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚è™½ç„¶å®šä¹‰äº† main å‡½æ•°ï¼Œä½†æ˜¯ä¸æ˜¯é™æ€çš„å…¥å£å‡½æ•°ã€‚æ­¤ç¼–è¯‘åœ¨ kotlinc 1.3.72 (JRE 17.0.8+9-LTS-211) ä¸Šæ‰§è¡Œï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„ kotlinc 1.9.10 ä¸Šæç¤º no source fileï¼Œå¹¶ä¸èƒ½ç¼–è¯‘è„šæœ¬ã€‚

```sh
$ kotlinc hello.kts
$ java Hello
Error: Main method not found in class Hello, please define the main method as:
   public static void main(String[] args)
or a JavaFX application class must extend javafx.application.Application

$ javap Hello
Compiled from "hello.kts"
public class Hello extends kotlin.script.templates.standard.ScriptTemplateWithArgs {
  public final void main();
  public Hello(java.lang.String[]);
}

$ javap SomeKt
Compiled from "hello.kt"
public final class SomeKt {
  public static final void main();
  public static void main(java.lang.String[]);
}
```

å¦‚æœ kts è„šæœ¬ä¸­æ²¡æœ‰å®šä¹‰ main å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªé™æ€å…¥å£å‡½æ•°ã€‚

ä½¿ç”¨é»˜è®¤å‚æ•°å€¼æ—¶ï¼Œç¼–è¯‘å™¨ä¸ºç”Ÿæˆçš„ç±»è®¾ç½®åç¼€ä¸º `$default` åŒ…è£…æ–¹æ³•ï¼š

```java ,kotlin
package mgid;

class MyKtApp {
    fun run(msg:String = "Hi, there!") {
        println("Hello Kotlin! " + msg)
    }
}
/*
$ kotlinc KtApp.kt
$ javap mgid.MyKtApp
Compiled from "KtApp.kt"
public final class mgid.MyKtApp {
  public mgid.MyKtApp();
  public final void run(java.lang.String);
  public static void run$default(mgid.MyKtApp, java.lang.String, int, java.lang.Object);
}*/
```

Kotlin å¯ä»¥ç›´æ¥è¿è¡Œè„šæœ¬ï¼Œä½¿ç”¨ -script å‘½ä»¤é€‰é¡¹ï¼Œæ­¤æ—¶ä½œä¸º Top-level è„šæœ¬æ‰§è¡Œï¼Œè„šæœ¬ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ `args` æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°ã€‚ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°å†™åœ¨åé¢ï¼Œä¹Ÿå¯ä»¥è·Ÿåœ¨ -- ç¬¦å·ä¹‹åï¼Œæ­¤ç¬¦å·æœ¬èº«æ²¡æœ‰ä½œç”¨ï¼Œåªæ˜¯ä½œä¸ºä¸€ä¸ªæç¤ºã€‚

```java ,kotlin
class SomeScript {
	companion object {
		@JvmStatic
		fun somemain(args:Array<String>) {
			println("Hello Kotlin!" + args.joinToString() { it })
		}
	}
}
SomeScript.somemain(args)
```

å‡è®¾ä»¥ä¸Šè„šæœ¬ä¿å­˜åœ¨ some.kts æ–‡ä»¶ï¼Œä½¿ç”¨ kotlinc ç¼–è¯‘å®ƒå°±ä¼šå¾—åˆ°ä»¥ä¸‹ 4 ä¸ªç±»æ–‡ä»¶ï¼š

1. `Some.class` æŒ‰æ–‡ä»¶åç”Ÿæˆçš„æ¨¡æ¿ç±»ï¼Œç»§æ‰¿ kotlin.script.templates.standard.ScriptTemplateWithArgsï¼›
2. `Some$SomeScript.class` è„šæœ¬ä¸­å®šä¹‰çš„ SomeScript ç±»ï¼›
3. `Some$SomeScript$Companion.class` SomeScript ç±»ä¸­ä½¿ç”¨çš„ä¼´éšå¯¹è±¡ï¼›
4. `Some$SomeScript$Companion$somemain$1.class` ä¼´éšå¯¹è±¡å†… joinToString æ–¹æ³•ä¸­ä½¿ç”¨çš„ lambdaï¼›

```sh
$ kotlinc some.kts
$ for file in *.class; do javap $file >> class.md; done;
public class Some extends kotlin.script.templates.standard.ScriptTemplateWithArgs {
  public static final void main(java.lang.String[]);
  public Some(java.lang.String[]);
}
Compiled from "some.kts"
public final class Some$SomeScript {
  public static final Some$SomeScript$Companion Companion;
  public Some$SomeScript();
  static {};
  public static final void somemain(java.lang.String[]);
}
Compiled from "some.kts"
public final class Some$SomeScript$Companion {
  public final void somemain(java.lang.String[]);
  public Some$SomeScript$Companion(kotlin.jvm.internal.DefaultConstructorMarker);
}
Compiled from "some.kts"
final class Some$SomeScript$Companion$somemain$1 extends kotlin.jvm.internal.Lambda implements kotlin.jvm.functions.Function1<java.lang.String, java.lang.String> {
  public static final Some$SomeScript$Companion$somemain$1 INSTANCE;
  public java.lang.Object invoke(java.lang.Object);
  public final java.lang.String invoke(java.lang.String);
  Some$SomeScript$Companion$somemain$1();
  static {};
}
```

æ€»ç»“ä¸€ä¸‹ä»£ç æ–‡ä»¶ä¸ç¼–è¯‘ç”Ÿæˆç±»æ–‡ä»¶çš„å…³ç³»ï¼Œå‡å®šæ–‡ä»¶åä¸º some.kt æˆ–è€… some.ktsï¼š
1. `some.kt` ä»£ç æ–‡ä»¶å®šä¹‰äº† SomeClass ç±»å‹ï¼Œé‚£ä¹ˆå°±ç”Ÿæˆ *SomeClass.class*ï¼Œå¹¶ä¸”ä¸ä¼šå¦å¤–ç”ŸæˆåŒ…è£…å…¥å£å‡½æ•°ï¼Œå› æ­¤ä»£ç ä¸­çš„ `fun main()` ä¸èƒ½ä½œä¸ºå…¥å£å‡½æ•°æ‰§è¡Œï¼›
2. `some.kt` ä»£ç æ–‡ä»¶ä¸­æ²¡å®šä¹‰ classï¼Œé‚£ä¹ˆå°±ç”Ÿæˆ *SomeKt.class*ã€‚å¦‚æœä»£ç ä¸­å®šä¹‰çš„ä¸»å‡½æ•°ç­¾åæ˜¯ `fun main()`ï¼Œé‚£ä¹ˆå°±ç”± SomeKt æä¾›çš„åŒ…è£…å…¥å£å‡½æ•°å»è°ƒç”¨ã€‚å¦‚æœä»£ç ä¸­çš„ä¸»å‡½æ•°ç­¾åæ˜¯ `fun main(args:Array<String>)`ï¼Œåˆ™ç¼–è¯‘å™¨ä¸ä¼šå¦å¤–ç”ŸæˆåŒ…è£…å…¥å£å‡½æ•°ï¼›
3. `some.kts` ä»£ç æ–‡ä»¶å®šä¹‰äº† SomeClass ç±»å‹ï¼Œé‚£ä¹ˆå°±ç”Ÿæˆ *Some.class* å’Œ *Some$SomeClass.class*ï¼›
4. `some.kts` ä»£ç æ–‡ä»¶ä¸­æ²¡å®šä¹‰ classï¼Œé‚£ä¹ˆå°±åªç”Ÿæˆ `Some.class`ï¼›

å³ä½¿ä½¿ç”¨æ—§ç‰ˆæœ¬ Kotlin 1.3 ç¼–è¯‘ mts è„šæœ¬ç”ŸæˆåŒ…å«é™æ€å…¥å£å‡½æ•°çš„ç±»ï¼ˆå°† main å‡½æ•°æ”¹åï¼Œæˆ–è€…ä½¿ç”¨å…¶å®ƒæ–¹æ³•å®šä¹‰é™æ€å…¥å£ï¼‰ï¼Œéœ€è¦ä½¿ç”¨ RunnerKt.runCompiledScript() æ–¹æ³•æ‰§è¡Œã€‚ä½†ä¹Ÿä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œä¼šæŠ¥é”™ï¼š

```sh
java.lang.NoClassDefFoundError: kotlin/script/experimental/jvm/RunnerKt at Some.main(Unknown Source) 
Caused by: java.lang.ClassNotFoundException: kotlin.script.experimental.jvm.RunnerKt

Exception in thread "main" java.lang.IllegalArgumentException: Cannot find metadata for script Some
        at kotlin.script.experimental.jvm.impl.KJvmCompiledScriptKt.createScriptFromClassLoader(  KJvmCompiledScript.kt:194)
        at kotlin.script.experimental.jvm.RunnerKt.runCompiledScript(runner.kt:19  )
        at Some.main(Unknown Source)
```

å¯ä»¥çœ‹åˆ°è¿™æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œä¾èµ–ç±»å‹ç›¸å…³ JAR éœ€è¦æ·»åŠ åˆ° CLASSPATH åˆ—è¡¨ä¸­ï¼š

```sh
export CLASSPATH="$CLASSPATH;C:/kotlin/kotlinc/lib/kotlin-scripting-jvm.jar;"
kotlinc some.kts
java Some
```

Kotlin æ²¡æœ‰ Java é‚£æ ·çš„é™æ€ç±»å‹å£°æ˜ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å£°æ˜é™æ€å¯¹è±¡ï¼š

1. `companion object` - ä¼´éšå¯¹è±¡ï¼Œå£°æ˜å•ä¾‹çš„æ–¹å¼ï¼›
2. @JvmField @JvmStatic - ä½¿ç”¨æ³¨è§£æ ‡ç­¾å£°æ˜é™æ€çš„å¯¹è±¡ï¼›
3. object é™æ€å•ä¾‹ï¼Œå’Œ `companion object` ç±»ä¼¼ï¼›
4. const å¸¸é‡ï¼Œè„±ç¦»ç±»çš„æŸç¼šï¼Œä¼šç”Ÿæˆä¸€ä¸ª kotlin.kt ä¸“ç”¨æ–‡ä»¶ï¼›

Kotlin CLI scripting è„šæœ¬ç¼–ç¨‹ç›®å‰è¿˜æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œå‚è€ƒæ–‡æ¡£ 
09.2.3. Get started with Kotlin/Native using the command-line compiler
09.5.1. Get started with Kotlin custom scripting â€“ tutorial
15.1.1. Kotlin command-line compiler

KTS æ¯” Groovy æ›´é€‚åˆç”¨äºç¼–å†™ Gradle è„šæœ¬ï¼Œå› ä¸º Kotlin ä»£ç å¯è¯»æ€§æ›´é«˜ã€‚ä½†æ˜¯ä½œä¸ºåŸºäº JVM çš„è„šæœ¬ï¼Œå®ƒä»¬ä¸¤è€…éƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é¦–æ¬¡å†·å¯åŠ¨æ—¶é—´æ¯”ä¸€èˆ¬è„šæœ¬è¦æ…¢å¾—å¤šã€‚

å‚è€ƒä»¥ä¸‹æ¥è‡ªåœ¨ Gradle CI ä¸Šè¿è¡Œçš„æ€§èƒ½æµ‹è¯•æ•°æ®ï¼Œåˆ†åˆ«æ˜¯ Gradle 6.8/7.4/8.0 ç‰ˆæœ¬æ€§èƒ½åˆ†æï¼Œé€šè¿‡å‡ ä¸ªå¸¸è§æµ‹è¯•æ¥åˆ†æè„šæœ¬æ€§èƒ½ï¼šhttps://github.com/gradle/gradle/issues/15886

1. é¦–æ¬¡è¿è¡Œï¼Œç­‰ä»·æ¸…é™¤æ‰€æœ‰ build cache åå†è¿è¡Œï¼›
2. buildSrc abi æ”¹åŠ¨ï¼Œå¯ä»¥ç†è§£ä¸ºå¤§å¤šæ•°ç¼“å­˜å¤±æ•ˆï¼Œå¤§éƒ¨åˆ†ä»£ç éœ€è¦é‡æ–°ç¼–è¯‘ï¼›
3. buildSrc non-abi æ”¹åŠ¨ï¼Œå³ buildSrc ä¸­çš„æ™®é€šä¿®æ”¹ï¼›
4. æ— æ”¹åŠ¨

è¿™äº›æµ‹è¯•è¿è¡Œåœ¨ä¸€ä¸ªåŒ…å«å¤§é‡ subProject çš„å¤§å‹é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”å®ƒä»¬åœ¨ Groovy å’Œ Kotlin DSL ä¸Šè¿è¡Œä»¥è¿›è¡Œæ¯”è¾ƒã€‚

|     Use case     |  Groovy |  Kotlin |        Differences        |
|------------------|---------|---------|---------------------------|
| First use        | ğŸŸ¢ 33.5s | ğŸ”´ 76.2s | Groovy DSL is 2.2x faster |
| buildSrc abi     | ğŸŸ¢ 13.2s | ğŸ”´ 42.3s | Groovy DSL is 3.2x faster |
| buildSrc non-abi | ğŸ”´ 13s   | ğŸŸ¢ 5.2s  | Kotlin DSL is 2.5x faster |
| Nothing changes  | ğŸ”µ 1.7s  | ğŸ”µ 1.8s  | Similar performance       |

|     Use Case     |   Groovy  |   Kotlin  |         Difference        |
|------------------|-----------|-----------|---------------------------|
| First use        | ğŸŸ¢ 38.855s | ğŸ”´ 63.54s  | Groovy DSL is 1.6x faster |
| buildSrc abi     | ğŸŸ¢ 25.307  | ğŸ”´ 35.014s | Groovy DSL is 1.4x faster |
| buildSrc non-abi | ğŸ”´ 24.526s | ğŸŸ¢ 4.732s  | Kotlin DSL is 5x faster   |

| Use case				| Groovy	| Kotlin	| Differences	|
|-----------------------|-----------|-----------|---------------|
| **First use**			| ğŸŸ¢ 30s	| ğŸ”´ 75s	| Groovy DSL is 2.5x faster
| **`buildSrc` abi**	| ğŸŸ¢ 9s	| ğŸ”´ 35s	| Groovy DSL is 3.8x faster
| **`buildSrc` non-abi**| ğŸ”´ 9s	| ğŸŸ¢ 5.5s	| Kotlin DSL is 1.7x faster
| **configuration**		| ğŸŸ¢ 1.9s| ğŸ”´ 2.2s	| Groovy DSL is 0.15x faster

æµ‹è¯•æ•°æ®å¯ä»¥çœ‹å‡ºï¼ŒGradle 7.4 ç‰ˆæœ¬ä¸Šï¼ŒKTS è„šæœ¬æ€§èƒ½æ‰æœ‰ä¸€å®šæ”¹å–„ã€‚

Kotlin ç°åœ¨æ˜¯ Android å®˜æ–¹æ¨èè¯­è¨€ï¼ŒGradle æ„å»ºè„šæœ¬ã€å®ç°è¯­è¨€çš„ç»Ÿä¸€æœ‰åˆ©äºæ•´ä¸ªé¡¹ç›®å¼€å‘ç»´æŠ¤ï¼Œå¹¶ä¸” Kotlin DSL æ”¯æŒæºç è·³è½¬ã€ç¼–è¯‘æ—¶æ£€æŸ¥é”™è¯¯ã€ä»£ç è‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº®ç­‰ç­‰åŠŸèƒ½ã€‚



### â˜˜ Kotlin Coroutines

æ‰€è°“åç¨‹ Coroutines å³åä½œçº¿ç¨‹ï¼ŒCooperation + Routinesï¼Œç›¸å¯¹äºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ï¼ˆåŸºæœ¬çš„æ“ä½œç³»ç»Ÿä»»åŠ¡è°ƒåº¦å•å…ƒï¼‰ï¼Œåç¨‹æ˜¯çº¿ç¨‹ä¹‹å†…å®ç°çš„è½»é‡çº§â€œçº¿ç¨‹â€ã€‚

### â˜˜ Kotlin/JS React Web å¼€å‘

Kotlin/JS æä¾›äº†è½¬æ¢ Kotlin ä»£ç ã€Kotlin æ ‡å‡†åº“ä»¥åŠä»»ä½•å…¼å®¹çš„ JavaScript ä¾èµ–é¡¹çš„èƒ½åŠ›ã€‚Kotlin/JS ç›®å‰çš„å®ç°æ”¯æŒç›®æ ‡æ˜¯ ES6ï¼ŒKotlin 1.9.0 ç‰ˆæœ¬ä¸­æ¨è `kotlin-multiplatform` Gradle æ’ä»¶ï¼Œå®ƒæä¾› `js()` targetã€‚æ—§ç‰ˆæœ¬çš„ `kotlin-js` æ’ä»¶ä¸å»ºè®®ä½¿ç”¨ã€‚å‚è€ƒæ–‡æ¡£ What's new in Kotlin 1.9.0ã€‚

```sh
# Development server and continuous compilation
./gradlew run --continuous
```

Kotlin Web åº”ç”¨å¼€å‘å‚è€ƒæ–‡æ¡£ï¼š
09.4.3. Development server and continuous compilation
09.4.10. Build a web application with React and Kotlin/JS â€” tutorial

Kotlin Wasm ç›®å‰æ˜¯å®éªŒæ€§ç‰¹æ€§ï¼ŒWebAssembly (Wasm) æ˜¯ Web äºŒè¿›åˆ¶ç¨‹åºï¼ŒåŸºäº stack-based virtual machineã€‚å¯ä»¥åœ¨ Gradle é¡¹ç›®é…ç½®è„šæœ¬ä¸­è®¾ç½® browser æˆ–è€… node è¿è¡Œç¯å¢ƒã€‚

1. https://kotlinlang.org/docs/js-overview.html
2. https://kotlinlang.org/docs/js-project-setup.html
3. https://kotlinlang.org/docs/js-project-setup.html

```sh
plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.9.10'
}
kotlin {
    js {
        useEsModules() // Enables ES6 modules
        browser {  }
        node {  }
        binaries.executable()
    }
}
dependencies {
    implementation npm('react', '> 14.0.0 <=16.9.0')
}
// Enables ES6 classes generation
tasks.withType<KotlinJsCompile>().configureEach {
    kotlinOptions {
        useEsClasses = true
    }
}
```

Kotlin 1.4.0 å¼€å§‹æ”¯æŒ Kotlin/JS IR ç¼–è¯‘å™¨åç«¯ï¼Œæ›¿æ¢æ—§ç‰ˆçš„ Kotlin/JS compilerï¼Œé€šè¿‡ Kotlin Multiplatform æ’ä»¶å¯ç”¨ï¼ŒGradle é…ç½®è„šæœ¬ä¸­å¯ä»¥ä¼ é€’ç¼–è¯‘ç±»å‹ç»™ js æ–¹æ³•ï¼Œç±»å‹è®¾ç½®å¦‚ä¸‹ï¼š

1. `IR` ä½¿ç”¨æ–°çš„ Kotlin intermediate representation (IR) ç¼–è¯‘å™¨åç«¯ï¼›
2. `LEGACY` ä½¿ç”¨æ—§ç‰ˆ Kotlin/JS compiler åç«¯ï¼›
3. `BOTH` åŒæ—¶å¯ç”¨ IR å’Œæ—§ç¼–è¯‘å™¨ï¼›

```sh
kotlin {
    js(IR) { // or: LEGACY, BOTH
        // ...
        binaries.executable() // not applicable to BOTH, see details below
    }
}
```

Kotlink/JS ä¾èµ–é…ç½®ä¸»è¦æ˜¯ NPM ä¾èµ–çš„å¤„ç†ï¼ŒæŒ‰ç…§ package.json çš„ä¾èµ–é…ç½®ï¼Œè¿˜æœ‰ä»¥ä¸‹å½¢å¼ï¼š

1. devDependencies, via devNpm(...),
2. optionalDependencies via optionalNpm(...), and
3. peerDependencies via peerNpm(...).

è¿è¡Œ Kotlin/JS é¡¹ç›®ï¼š

```sh
./gradlew jsRun
./gradlew jsRun --continuous
./gradlew jsRun -t
```


## ğŸ€ Maven é¡¹ç›®ç®¡ç†
1. https://maven.apache.org/download.cgi
2. https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html
3. https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html
4. https://maven.apache.org/pom.html

Maven é…ç½®æ–‡ä»¶å¯ä»¥æè¿°é¡¹ç›®çš„ç»“æ„å’Œä¾èµ–å…³ç³»ï¼Œä½¿ç”¨æ’ä»¶æ¥æ‰§è¡Œå„ç§æ„å»ºä»»åŠ¡ã€‚

1. çº¦å®šä¼˜äºé…ç½®ï¼š Maven é»˜è®¤çº¦å®šåŒ…æ‹¬é¡¹ç›®ç›®å½•ç»“æ„ç­‰ï¼Œå‡å°‘äº†é¡¹ç›®é…ç½®çš„å¤æ‚æ€§ã€‚
2. æ ‡å‡†åŒ–æ„å»ºæµç¨‹ï¼š æ ‡å‡†åŒ–æ„å»ºç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰é˜¶æ®µã€‚
3. è‡ªåŠ¨ä¾èµ–ç®¡ç†ï¼š Maven ä¾èµ–ä»“åº“ï¼ˆè¿ç¨‹æˆ–æœ¬åœ°ï¼‰å¯ä»¥è‡ªåŠ¨è§£å†³é¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚
4. ä¸°å¯Œçš„æ’ä»¶ï¼š æ’ä»¶å¯ç”¨äºæ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œå¦‚ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€ç”Ÿæˆæ–‡æ¡£ç­‰ã€‚
5. å¯ç»´æŠ¤é…ç½®ï¼š Maven çš„æ„å»ºé…ç½®ä¿å­˜åœ¨ POM æ–‡ä»¶ä¸­ï¼Œä½¿æ„å»ºé…ç½®æ˜“äºç»´æŠ¤å’Œå…±äº«ã€‚

Maven é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œä¸€äº›åŸºæœ¬çš„æ“ä½œå‘½ä»¤å‚è€ƒï¼š

```sh
mvn archetype:generate   # ç”Ÿæˆã€é€‰æ‹©é¡¹ç›®æ¨¡æ¿
mvn dependency:tree    # æ‰“å°ä¾èµ–æ ‘
mvn validate       # éªŒè¯é¡¹ç›®
mvn compile        # ç¼–è¯‘ç¨‹åº
mvn test-compile   # ç¼–è¯‘æµ‹è¯•ç¨‹åº
mvn test          # æ‰§è¡Œå•å…ƒæµ‹è¯•
mvn package       # æ„å»ºã€æ‰“åŒ…é¡¹ç›®
mvn clean         # æ¸…ç†é¡¹ç›®
mvn install       # è£…åˆ°ä¾èµ–åŒ…åˆ° Maven æœ¬åœ°èµ„æºåº“
mvn site          # ä¸ºæ‚¨çš„é¡¹ç›®ç”Ÿæˆä¿¡æ¯æ–‡æ¡£ç«™ç‚¹
mvn site-deploy   # WebDAV éƒ¨ç½²ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ç«™ç‚¹ï¼Œæ‰“åŒ…ä¸º WAR æ–‡ä»¶
mvn tomcat:deploy #  WAR æ–‡ä»¶éƒ¨ç½²åˆ° Tomcat
```

Maven æä¾›äº†æ•°ç§é¡¹ç›®æ¨¡æ¿åŸå‹ï¼š
https://maven.apache.org/archetype/index.html

1: maven-archetype-archetype (An archetype which contains a sample archetype.)
2: maven-archetype-j2ee-simple (An archetype which contains a simplifed sample J2EE application.)
3: maven-archetype-plugin (An archetype which contains a sample Maven plugin.)
4: maven-archetype-plugin-site (An archetype which contains a sample Maven plugin site.)
5: maven-archetype-portlet (An archetype which contains a sample JSR-268 Portlet.)
6: maven-archetype-profiles ()
7: maven-archetype-quickstart (An archetype which contains a sample Maven project.)
8: maven-archetype-site (An archetype which contains a sample Maven site which demonstrates
      some of the supported document types like APT, XDoc, and FML and demonstrates how
      to i18n your site. This archetype can be layered upon an existing Maven project.)
9: maven-archetype-site-simple (An archetype which contains a sample Maven site.)
10: maven-archetype-webapp (An archetype which contains a sample Maven Webapp project.)

å¯ä»¥ä½¿ç”¨ mvn archetype:generate é€æ­¥æŒ‰æç¤ºæ“ä½œï¼Œæˆ–è€…è®¾ç½®å‚æ•°ä½¿ç”¨ Batch mode åˆ›å»ºé¡¹ç›®ï¼š

	mvn -B archetype:generate -DgroupId=com.mycompany.app -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4

é€‰å¥½é¡¹ç›®åŸå‹ï¼ŒMaven è¿˜ä¼šè¯¢é—®é¡¹ç›®ç»†èŠ‚ï¼ŒæŒ‰è¦æ±‚è¾“å…¥é¡¹ç›®ç»†èŠ‚ã€‚

- groupId æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„å‘½åç©ºé—´ï¼›
- artifactId é¡¹ç›®åï¼Œä¼šåˆ›å»ºç›¸åº”çš„å­ç›®å½•ï¼›

å¯ä»¥ä½¿ç”¨ç›¸åŒå€¼ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸Š groupId è¡¨ç¤ºä¸€ç»„é¡¹ç›®å…±ç”¨çš„ IDï¼Œè€Œ artifactId ç”¨äºæ ‡å¿—æŸä¸ªå·¥ç¨‹ã€‚æ¯”å¦‚ org.apache.maven.plugins è¿™ä¸ª groupId å°±æœ‰ç›¸å½“æ’ä»¶ä¸ä¹‹ç›¸å…³ã€‚

é¡¹ç›®ç»“æ„å‚è€ƒï¼š

```sh
$ tree myaid/
myaid/
|-- pom.xml
`-- src
    |-- main
    |   `-- java
    |       `-- mgid
    |           `-- App.java
    `-- test
        `-- java
            `-- mgid
                `-- AppTest.java
```

Maven æ”¯æŒå¤šä¸ªé¡¹ç›®ï¼Œåªéœ€è¦å°†é¡¹ç›®ç›®å½•ä½œä¸ºæ¨¡å—æ·»åŠ åˆ°é¡¶å±‚ pom.xmlï¼š

```xml
  <modules>
    <module>my-app</module>
    <module>my-webapp</module>
  </modules>
```

æ‰§è¡Œ `mvn compile` å‘½ä»¤å¼€å§‹ç¼–è¯‘é¡¹ç›®ï¼Œæ‰§è¡Œ `mvn test` è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œåˆå§‹æ¨¡æ¿ä¸­åªåŒ…å« `assertTrue( true )` æµ‹è¯•æ–­è¨€ã€‚ä¸ºäº†å¯¹ä¸»ç¨‹åºçš„æ‰“å°å†…å®¹è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è°ƒç”¨ shell å‘½ä»¤å¹¶è·å–è¾“å‡ºå†…å®¹ï¼š

	ProcessBuilder command("java", "-cp", "target/classes", "mygid.App");
	Runtime.getRuntime().exec(["java", "-cp", "target/classes", "mygid.App"])

æ‰“åŒ…åï¼Œç›´æ¥è¿è¡Œ **java -jar demo.jar** å°±å¯ä»¥å¯åŠ¨ä½ çš„åº”ç”¨äº†ï¼

ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ maven-compiler-plugin æ’ä»¶ï¼Œä¸å†æ”¯æŒæ—§ç‰ˆ JDK 5ï¼Œéœ€è¦åœ¨ Maven é…ç½®æ–‡ä»¶ pom.xml å¢åŠ  JDK ç‰ˆæœ¬è®¾ç½®ï¼Œæˆ–è€…ä¿®æ”¹æ’ä»¶é»˜è®¤è®¾ç½®ï¼š
https://maven.apache.org/plugins/maven-compiler-plugin/

	Source option 5 is no longer supported. Use 7 or later.  

èµ„æºæ„å»ºä¸­ä½¿ç”¨çš„ JDK 6ã€7ã€8 ç‰ˆæœ¬ä¸€èˆ¬å¯¹åº” 1.6ï¼Œ1.7ï¼Œ1.8 çš„å†™æ³•ã€‚æ³¨æ„ï¼Œplugins è¦å†™åœ¨ build æ ‡ç­¾å†…éƒ¨ï¼Œä¸ç„¶æ— æ³•è¯†åˆ«

```xml
<project 
  xmlns="http://maven.apache.org/POM/4.0.0" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>mgid</groupId>
  <artifactId>myaid</artifactId>
  <version>1.0-SNAPSHOT</version>
  <packaging>jar</packaging>

  <name>myaid</name>
  <url>http://maven.apache.org</url>

  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.encoding>UTF-8</maven.compiler.encoding>
    <java.version>17</java.version>
    <maven.compiler.source>17</maven.compiler.source>
    <maven.compiler.target>17</maven.compiler.target>
  </properties>
  
  <build>
    <plugins>
      <plugin>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.1</version>
        <configuration>
          <source>17</source>
          <target>17</target>
        </configuration>
      </plugin> 
    </plugins> 
  </build>

  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>3.8.1</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
</project>
```

App.java ä»£ç å‚è€ƒï¼š

```java
package mgid;

/**
 * Hello world!
 *
 */
public class App 
{
    public static void main( String[] args )
    {
        System.out.println( "Hello World!" );
    }
}
```

AppTest.java æµ‹è¯•ä»£ç å‚è€ƒï¼Œä½¿ç”¨ Junit 3 ç¼–å†™æµ‹è¯•ç¨‹åºï¼Œéœ€è¦æ‰©å±• TestCase åŸºç±»ï¼š

```java
package mgid;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

import junit.framework.Test;
import junit.framework.TestCase;
import junit.framework.TestSuite;

/**
 * Unit test for simple App.
 */
public class AppTest 
    extends TestCase
{
    /**
     * Create the test case
     *
     * @param testName name of the test case
     */
    public AppTest( String testName )
    {
        super( testName );
    }

    /**
     * @return the suite of tests being tested
     */
    public static Test suite()
    {
        return new TestSuite( AppTest.class );
    }

    /**
     * Rigourous Test :-)
     */
    public void testApp() throws IOException
    {
        // assertTrue( true );
        Process ps = Runtime.getRuntime().exec(
            new String[]{"java", "-cp", "target/classes", "mgid.App"});
        // ProcessBuilder pb = new ProcessBuilder();
        // ProcessBuilder pt = pb.command("java", "-cp", "target/classes", "mgid.App");

        try {
            // Process ps = pt.start();
            BufferedReader reader = new BufferedReader(
                                new InputStreamReader(ps.getInputStream()));
            String line;
            while ( (line = ps.errorReader().readLine()) !=null) {
                System.out.println("Error: " + line);
            }
            while ((line = reader.readLine()) != null ) {
                System.out.println("Read line: " + line);
                assertEquals("Hello World!", line);
            }
        } catch (IOException ex) {
            throw ex;
        }
    }
}
```

æµ‹è¯•æŠ¥å‘Šå‚è€ƒï¼š

```sh
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running mgid.AppTest
Read line: Hello World!
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.188 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
```

## ğŸ€ Gradle é¡¹ç›®ç®¡ç†
1. https://gradle.org/releases/
2. https://docs.gradle.org/current/samples/sample_building_java_applications_multi_project.html
3. https://docs.gradle.org/8.3/userguide/command_line_interface.html

Gradle ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼Œå…¶é»˜è®¤é…ç½®è„šæœ¬æ˜¯ build.gradleï¼š

1. å£°æ˜å¼ï¼šGradle ä½¿ç”¨æ›´ç®€æ´ã€æ›´æ˜“è¯»çš„ Groovy DSL ç¼–å†™æ„å»ºè„šæœ¬ã€‚
2. çµæ´»æ€§ï¼šGradle æ”¯æŒå¤šé¡¹ç›®ã€å˜ä½“å’Œè‡ªå®šä¹‰æ„å»ºé€»è¾‘ã€‚
3. ä¾èµ–ç®¡ç†ï¼šæ”¯æŒè‡ªåŠ¨ä» Maven ä»“åº“æˆ–å…¶ä»–ä»“åº“ä¸‹è½½æ‰€éœ€çš„åº“ã€‚
4. æ’ä»¶åŒ–ï¼šä¸°å¯Œçš„æ’ä»¶ä»¥åŠå„ç§ä»»åŠ¡å®šåˆ¶ï¼Œå¦‚ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰ã€‚
5. å¢é‡æ„å»ºï¼šè‡ªåŠ¨åˆ¤æ–­éœ€è¦é‡æ–°æ„å»ºçš„æ–‡ä»¶ï¼Œä»è€Œæé«˜æ„å»ºæ•ˆç‡ã€‚

Gradle å®˜æ–¹å¼€æºä»£ç ä¸­åŒ…å«éå¸¸å®Œæ•´çš„æ–‡æ¡£æºæ–‡ä»¶ï¼Œæ¯•ç«Ÿæ˜¯ä½œä¸ºä¸€ä¸ªæºä»£ç å‹ç¼©åŒ… 50MB çš„æ„å»ºå·¥å…·ã€‚æ–‡æ¡£ä½äº gradle-8.4.0/subprojects/docs ç›®å½•ä¸‹ï¼Œä½¿ç”¨ AsciiDoc æ ¼å¼ï¼Œ

å’Œ GNU Make å¤„ç†ä¾èµ–å…³ç³»ä¸€æ ·ï¼ŒGradle ä¹Ÿä¼šå¤„ç†ä¾èµ–çš„æ›´æ–°å…³ç³»ï¼ŒGNU Make è„šæœ¬ä¸­çš„ Targets ç­‰ä»·äº Gradle è„šæœ¬ä¸­çš„ Tasksã€‚å½“ä¸€ä¸ª build.gradle æ›´æ–°åï¼ŒGradle å°±éœ€è¦é‡æ–°ç”Ÿæˆ Task Graphsï¼Œæ ¹æ®å…¶ä¾èµ–å…³ç³»ã€æ›´æ–°çŠ¶æ€æ¥å†³å®šè¦æ‰§è¡Œä»€ä¹ˆæ„å»ºä»»åŠ¡ã€‚

å‚è€ƒå®˜æ–¹æ–‡æ¡£ Authoring Gradle Builds - Learning the Basics - Understanding the Build Lifecycle
1. https://docs.gradle.org/current/userguide/build_lifecycle.html
2. https://docs.gradle.org/current/userguide/img/task-dag-examples.png

å…¸å‹çš„ Gradle æ„å»ºæµç¨‹åŒ…å«å¦‚ä¸‹æ­¥éª¤ï¼š
1. Initialization
1.1. Detects the settings file.
1.2. Evaluates the settings file to determine projects and subprojects.
1.3. Creates a Project instance for every project.
2. Configuration
2.1. Evaluates the build scripts of every project participating in the build.
2.2. Creates a task graph for requested tasks.
3. Execution
3.1. Schedules and executes each of the selected tasks in the order of their dependencies.

å¯ä»¥ä½¿ç”¨ Groovy æˆ–è€… Kotlin è„šæœ¬ä½œä¸ºæ„å»ºè§„åˆ™é…ç½®æ–‡ä»¶ build.gradle(.kts)ï¼Œæ¨èæ•ˆç‡æ›´å¿«çš„ Groovy è„šæœ¬ã€‚Gradle æ„å»ºç³»ç»Ÿä¸­æœ‰ä¸‰ç±»è„šæœ¬ï¼Œè„šæœ¬ä¸­å¯ä»¥ä½¿ç”¨çš„å…¨å±€å¯¹è±¡å‚è€ƒ Gradle DSLs and API æ–‡æ¡£ã€‚

|  Type of script | Delegates to instance of | File name
|-----------------|--------------------------|
| Build script    | Project                  | build.gradle
| Init script     | Gradle                   | init.gradle
| Settings script | Settings                 | gradle.properties
1. https://docs.gradle.org/current/userguide/groovy_build_script_primer.html
2. https://docs.gradle.org/current/userguide/tutorial_using_tasks.html
3. https://docs.gradle.org/current/dsl/index.html
4. Project https://docs.gradle.org/current/dsl/org.gradle.api.Project.html
5. Task https://docs.gradle.org/current/dsl/org.gradle.api.Task.html
6. Gradle https://docs.gradle.org/current/dsl/org.gradle.api.invocation.Gradle.html
7. Settings https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html

ä¸»è¦æ˜¯ Project å’Œ Task å¯¹è±¡ï¼Œæ•´ä¸ªæ„å»ºè„šæœ¬ build.gradle å°±å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª Project å¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ç³»åˆ—å†…ç½®çš„ Taskï¼Œç”¨æˆ·å¯ä»¥éšæ—¶å‘ `TaskContainer` æ³¨å†Œè‡ªå·±çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ `tasks.register('hello')` ã€‚è„šæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `ProviderFactory` ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Java API `System.getenv()`ã€‚è¿˜ç»å¸¸ä½¿ç”¨ TaskContainer.withType() æ–¹æ³•ç»™æŒ‡å®šçš„ä»»åŠ¡æ·»åŠ è®¾ç½®ã€‚ 

æ„å»ºè„šæœ¬çš„ç¼–è¯‘ã€æ‰§è¡Œå¯ä»¥ä½¿ç”¨ `ScriptHandler` å¯¹è±¡æ¥ç®¡ç†ï¼Œå¯ä»¥ä½¿ç”¨ buildscript è„šæœ¬å—è®¾ç½®ï¼Œåœ¨æ­¤è„šæœ¬å—ä¸­è®¾ç½® classpathï¼Œå®ƒä¼šç”¨äºåŠ è½½ build script ä¾èµ–çš„æ’ä»¶ï¼Œä¾‹å¦‚ä»¥ä¸‹ä¾‹å­ä¸­ä½¿ç”¨çš„ Base64 ç¼–ç å™¨ã€‚

```sh
mport org.apache.commons.codec.binary.Base64

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath group: 'commons-codec', name: 'commons-codec', version: '1.2'
    }
}

def classpath = providers.environmentVariable("CLASSPATH").get()
defaultTasks 'taskY', 'taskX'

tasks.register('encode') {
    doLast {
        def byte[] encodedString = new Base64().encode('hello world\n'.getBytes())
        println new String(encodedString)
    }
}

tasks.register('taskX') {
    dependsOn 'taskY', 'encode'
    doFirst { println "taskX begin..." }
    doLast {
        println "CLASSPATH: " + classpath
    }
}

tasks.register('taskY') {
    doLast {
        3.times { println "taskY $it" }
    }
}
# > gradle -q task1
# taskY 0
# taskY 1
# taskY 2
# taskX
# aGVsbG8gd29ybGQK
# taskX begin...
# CLASSPATH:~/.gradle/wrapper/dists/gradle-8.3/lib/gradle-launcher-8.3.jar
```

Gradle æä¾› Maven å…¼å®¹åŠŸèƒ½ï¼Œæ‰§è¡Œ `gradle init` å‘½ä»¤åˆå§‹åŒ–é¡¹ç›®ï¼Œæ­¤å‘½ä»¤ä¼šç”Ÿæˆä»¥ä¸‹è„šæœ¬ï¼š

1. gradle: Gradle start up script for UNIX-like sytem.
2. gradlew.bat: Gradle startup script for Windows.
3. build.gradle ä¸»é¡¹ç›®æ„å»ºè„šæœ¬ã€‚
4. settings.gradle ä¸»é¡¹ç›®é…ç½®è„šæœ¬ã€‚
5. gradle\wrapper\gradle-wrapper.properties åŒ…è£…ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æŒ‡å®š Gradle ç‰ˆæœ¬ã€‚

Gradle åˆå§‹åŒ–ä»»åŠ¡è¿˜å¯ä»¥æ ¹æ® pom.xml é¡¹ç›®é…ç½®ç”Ÿæˆ build.gradle é…ç½®è„šæœ¬ã€‚

1. https://docs.gradle.org/current/userguide/dependency_management.html
2. https://docs.gradle.org/current/userguide/compatibility.html
3. https://docs.gradle.org/current/userguide/upgrading_version_8.html

å¯åŠ¨è„šæœ¬è´Ÿè´£é…ç½® Gradle Wrapper è¿è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ä¸‹è½½åŒ…è£…ç¨‹åºé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ Gradle äºŒè¿›åˆ¶ç¨‹åºåŒ…ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿæ²¡é…ç½®å¥½ç›¸åº” Gradle ç‰ˆæœ¬ã€‚æ‰€æœ‰ä¸‹è½½åˆ°çš„ Gradle ä¼šä¿å­˜åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ .gradle å­ç›®å½•å†…ã€‚

å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°çš„ä¸åŒçš„é¡¹ç›®éœ€è¦ä¸åŒç‰ˆæœ¬çš„ Gradle é—®é¢˜ã€‚Gradle Wrapper å°±æ˜¯å¯¹ Gradle çš„ä¸€å±‚åŒ…è£…ï¼Œå®˜æ–¹ä½¿ç”¨åŒ…è£…ç¨‹åºè§£å†³ Gradle ç‰ˆæœ¬é—®é¢˜ï¼Œåˆå§‹åŒ–é¡¹ç›®é…ç½®å°±ä¼šåœ¨ gradle ç›®å½•ä¸‹å­˜æ”¾ä¸€ä¸ªåŒ…è£…ç¨‹åºï¼Œå…¶ä¸­æŒ‡å®šäº†é¡¹ç›®å½“å‰é…ç½®çš„ Gradle ç‰ˆæœ¬ã€‚

ä»¥ä¸‹æ˜¯ gradle-wrapper.properties é…ç½®å‚è€ƒï¼š

```sh
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.3-bin.zip
networkTimeout=10000
validateDistributionUrl=true
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
```

ä½¿ç”¨ `gradle wrapper` å‘½ä»¤å¯ä»¥ç”Ÿæˆ Gradle wrapper æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŒ‡å®šç‰ˆæœ¬ç­‰ç­‰ï¼Œå…·ä½“æ“ä½œå‚è€ƒï¼š

```sh
	gradle help --task wrapper
	gradle --version
	# Gradle 8.3
	$ ./gradlew wrapper --gradle-version 7.2
	$ ./gradlew --version
	# Gradle 7.2
```

æ³¨æ„ä½¿ç”¨çš„ Gradle ç‰ˆæœ¬å·®å¼‚ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

	Could not find method testCompile() for arguments
	Could not find method compile() for arguments
	Could not find method application() for arguments xxx of type org.gradle.api.Project.
	Could not find method testRuntime() for arguments xxx of type ...DefaultDependencyHandler.

å‡ºç°æ­¤é”™è¯¯åŸå› æ˜¯ Gradle ç‰ˆæœ¬æ›´æ–°ï¼ŒGradle 7 ç§»é™¤äº† compile å’Œ runtime æ–¹æ³•ï¼Œä½¿ç”¨ testImplementation æ›¿æ¢ testCompileï¼Œå› æ­¤æ¢ä¸€ä¸‹å°±å¥½ï¼Œä¾èµ–å®šä¹‰å½¢å¼å‚è€ƒå¦‚ä¸‹ï¼š

Gradle 6.9 å‡çº§åˆ° Gradle 7 ç‰ˆæœ¬çš„å·®åˆ«å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šUpgrading your build from Gradle 6.x to 7.0

Table 1. Common configuration upgrades
https://docs.gradle.org/current/userguide/upgrading_version_6.html

	Removed Configuration	   New Configuration
	---------------------      --------------------------
	compile                    api or implementation
	runtime                    runtimeOnly
	testRuntime                testRuntimeOnly
	testCompile                testImplementation
	<sourceSet>Runtime         <sourceSet>RuntimeOnly
	<sourceSet>Compile         <sourceSet>Implementation

```js
dependencies {
	// testCompile group: 'junit', name: 'junit', version: '4.13.1'
    testImplementation group: 'junit', name: 'junit', version: '4.13.1'

    implementation 'com.google.guava:guava:31.1-jre' 
    testImplementation 'junit:junit:3.8.1'
}
```

ç”¨æˆ·ä¸»ç›®å½• .gradle å­ç›®å½•ä¸‹åˆ›å»º init.gradle æ–‡ä»¶å¯ä»¥é…ç½®ä¾èµ–åº“çš„è¿œç¨‹æœåŠ¡å™¨ï¼š
https://developer.aliyun.com/mvn/guide

```js
allprojects {
    repositories {
        mavenLocal()
        maven { url "https://maven.aliyun.com/nexus/content/repositories/central/" }
    }
}
```

Gradle ç½‘ç»œåŠŸèƒ½å¯èƒ½å¯¼è‡´å¡é¡¿ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥è·å–æ„å»ºæŠ¥å‘Šï¼ŒHTML æ ¼å¼å±•ç¤ºï¼š

	gradle build -profile

ä¸€ä¸ªä¸å¸¸è§çš„é—®é¢˜æ˜¯ Gradle Startup æ—¶é—´é•¿ï¼Œå¯èƒ½å ç”¨äº†æ•´ä¸ªæ„å»ºè¿‡ç¨‹çš„å¤§éƒ¨åˆ†æ—¶é—´ã€‚
https://docs.gradle.org/current/userguide/performance.html

ç”¨æˆ·ä¸»ç›®å½•ä¸­ .gradle/gradle.properties é…ç½®æ–‡ä»¶å¯ä»¥å…¨å±€åœ°æ§åˆ¶ Gradle è¡Œä¸ºï¼Œæ¯”å¦‚æ˜¯å¦å¯ç”¨ daemon æœåŠ¡ç¨‹åºã€å¹¶è¡Œç¼–è¯‘ç­‰ç­‰ï¼š

```sh
#Enable daemon
org.gradle.daemon=true

# Try and findout the best heap size for your project build.
org.gradle.jvmargs=-Xmx5120m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8

# Modularise your project and enable parallel build
org.gradle.parallel=true

# Enable configure on demand.
org.gradle.configureondemand=true
```

Java 17 ç§»é™¤äº† MaxPermSize è™šæ‹Ÿæœºé…ç½®é€‰é¡¹ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ é™¤ï¼š

	Unrecognized VM option 'MaxPermSize=512m' 


Gradle åˆå§‹åŒ–å‘½ä»¤ä¸€èˆ¬æµç¨‹æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š

1. Select type of project to generate: asic, pplication, ibrary, Gradle plugin
2. Split functionality across multiple subprojects? app or app with library projects
3. Select implementation language: `C++`, `Groovy`, `Java`, `Kotlin`, `Scala`, `Swift`
4. Select build script DSL: `Groovy`, `Kotlin`
5. Select test framework: `JUnit 4`, `TestNG`, `Spock`, `JUnit Jupiter`
6. Project name (default: demo)
7. Source package (default: demo)

å¦‚æœä½¿ç”¨ Groovy è„šæœ¬ä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆéœ€è¦æ³¨æ„ï¼Œé…ç½®è„šæœ¬ä¸­çš„æ–¹æ³•è°ƒç”¨ã€å±æ€§èµ‹å€¼çš„å·®åˆ«ã€‚å› ä¸º Groovy è¯­æ³•ä¸Šå‚è€ƒäº† Python ç­‰æ–°å¼è„šæœ¬ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥åœ†æ‹¬å·ï¼Œå‚æ•°åˆ—è¡¨ä¾ç„¶ä½¿ç”¨é€—å·ä½œä¸ºå‚æ•°çš„åˆ†éš”ç¬¦ã€‚è€Œå±æ€§å€¼çš„ä¿®æ”¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ = è¿›è¡Œèµ‹å€¼ã€‚

Gradle é…ç½®è„šæœ¬ä¸­çš„ä¾èµ–é¡¹å£°æ˜å½¢å¼ï¼š

```sh
dependencies {
    implementation 'org.hibernate:hibernate-core:3.6.7.Final'
    api 'com.google.guava:guava:23.0'
    testImplementation 'junit:junit:4.+'
}
```

implementation (supersedes compile) â€” used for compilation and runtime
testImplementation â€” test equivalent of implementation

0. `compileOnly` ä»…åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼Œä¸éœ€è¦åœ¨è¿è¡Œæ—¶ CLASSPATH åˆ—è¡¨ä¸­å‡ºç°ã€‚
1. `runtimeOnly`ï¼Œå–ä»£æ—§ç‰ˆæœ¬çš„ runtimeï¼Œåªç”¨äºè¿è¡Œæ—¶çš„ä¾èµ–é¡¹ã€‚
2. `testCompileOnly` â€” same as compileOnly except itâ€™s for the tests
3. `testRuntimeOnly` â€” test equivalent of runtimeOnly
4. `implementation`ï¼Œå–ä»£æ—§ç‰ˆæœ¬ compileï¼Œç¼–è¯‘é¡¹ç›®æºä»£ç ä»¥åŠè¿è¡Œæ—¶çš„ä¾èµ–é¡¹ã€‚
5. `testImplementation` ç¼–è¯‘å’Œè¿è¡Œé¡¹ç›®æµ‹è¯•ç¨‹åºæ‰€éœ€çš„ä¾èµ–é¡¹ï¼Œæ¯”å¦‚ JUnit è¿™ç§ã€‚
6. `api` ç¼–è¯‘é¡¹ç›®æºä»£ç æ‰€éœ€çš„ä¾èµ–é¡¹ï¼Œå¹¶ä¸”è¿™äº›ä¾èµ–é¡¹æ˜¯é¡¹ç›® API çš„ä¸€éƒ¨åˆ†ã€‚

Java Library Pluginï¼Œ`id ('java-library')` æ¿€æ´»ï¼Œå®ƒå¯ä»¥ä¸º JVM é¡¹ç›®æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

1. `compileJava` ä»»åŠ¡æ”¯æŒï¼Œç¼–è¯‘ `src/main/java` ç›®å½•ä¸‹çš„æºä»£ç æ–‡ä»¶ï¼›
2. `compileTestJava` ä»»åŠ¡æ”¯æŒï¼Œç¼–è¯‘ `src/test/java` ç›®å½•ä¸‹çš„æµ‹è¯•ç¨‹åºä»£ç ï¼›
3. `test` ä»»åŠ¡æ”¯æŒï¼Œè¿è¡Œ `src/test/java` ä¸­çš„æµ‹è¯•ç¨‹åºï¼›
4. `jar` ä»»åŠ¡æ”¯æŒï¼Œæ‰“åŒ…ä¸»ç±»å’Œ `src/main/resources` èµ„æºåˆ°ä¸€ä¸ª JAR æ–‡ä»¶ï¼Œå‘½åè§„åˆ™ï¼šproject-version.jar
5. `javadoc` ä»»åŠ¡æ”¯æŒï¼Œç”Ÿæˆæ‰€æœ‰ä¸»ç±»å‹ Javadoc æ–‡æ¡£ï¼›


ä½¿ç”¨ `gradle tasks` å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰é¡¹ç›®å¯æ“ä½œçš„æ„å»ºä»»åŠ¡ã€‚é¡¹ç›®ä»»åŠ¡åˆ†ä¸º 6 ç»„ï¼š

1. Build tasks
2. Build Setup tasks
3. Documentation tasks
4. Help tasks
5. Publishing tasks
6. Verification tasks

Gradle å‘½ä»¤å‚è€ƒå¦‚ä¸‹ï¼ŒæŒ‰é¡¹ç›®ç®¡ç†æµç¨‹ç½—åˆ—ï¼š

```sh
$ gradle --version

Gradle 6.6
Kotlin:       1.3.72
Groovy:       2.5.12
Ant:          Apache Ant(TM) version 1.10.8 compiled on May 10 2020
JVM:          17.0.8 (Oracle Corporation 17.0.8+9-LTS-211)

$ gradle help
Starting a Gradle Daemon, 1 incompatible and 1 stopped Daemons could not be reused, use --status for details
# To run a build, run gradle <task> ...
# To see a list of available tasks, run gradle tasks
# To see more detail about a task, run gradle help --task <task>
# To see a list of command-line options, run gradle --help

# Common tasks
$ gradle tasks
$ gradle init
$ gradle test --tests package.AppTest
$ gradle clean test --tests My*Test
$ ./gradlew check
$ ./gradlew test
$ ./gradlew projects
$ ./gradlew properties
$ ./gradlew dependencies
$ ./gradlew build
$ ./gradlew compileJava
$ ./gradlew compileTestJava
$ ./gradlew publish
$ ./gradlew jar
$ ./gradlew run
$ ./gradlew clean
```

Gradle å¤šé¡¹ç›®å·¥ç¨‹é…ç½®å¯ä»¥ä½¿ç”¨ --include-build å‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ–è€… `includeBuild` ä»¥åŠ `include` æŒ‡ä»¤åŒ…å«å­é¡¹ç›®ï¼Œå¯ä»¥åœ¨ settings.gradle è®¾ç½®ã€‚å­é¡¹ç›®ä½¿ç”¨å†’å·å‰ç¼€ï¼Œå†’å·è¡¨ç¤ºæ ¹é¡¹ç›®ã€‚ä½¿ç”¨ `gradle -q projects` å‘½ä»¤å¯ä»¥æŸ¥è¯¢é¡¹ç›®å…³ç³»ã€‚ä¹Ÿå¯ä»¥å¯¹æŒ‡å®šå­é¡¹ç›®æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚ `gradle :app:build`ã€‚
1. https://docs.gradle.org/current/userguide/intro_multi_project_builds.html
2. https://docs.gradle.org/current/userguide/organizing_gradle_projects.html

```sh
include ':app1', ':app2', ':app3', ':common'
includeBuild 'my-app'
includeBuild 'my-utils'
```

ä¸ºäº†åŒæ­¥ç®¡ç†å„ä¸ªå­é¡¹ç›®çš„ä¾èµ–ï¼Œé¿å…å„ä¸ªå­é¡¹ç›®åˆ†æ•£å¤„ç†ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨ buildSrc æ¨¡å—ã€‚Gradle è¿è¡Œæ—¶ä¼šæ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦å­˜ buildSrc ç›®å½•ï¼Œå¹¶å°è¯•ç¼–è¯‘ã€æµ‹è¯•è¿™ä¸ªæ¨¡å—çš„ä»£ç ï¼Œç„¶åå°†å…¶åŠ å…¥æ„å»ºè„šæœ¬çš„ç±»è·¯å¾„ä¸­ã€‚

é¦–æ¬¡å¯åŠ¨ Gradle ä¼šå…ˆå¸¸é©»ä¸€ä¸ª Daemon æœåŠ¡ç¨‹åºä»¥åŠ é€Ÿåç»­çš„å‘½ä»¤æ‰§è¡Œã€‚

Gradle JVM æ’ä»¶å‚è€ƒå¦‚ä¸‹ï¼Œå…¶ä¸­ application æ’ä»¶å®šä¹‰åº”ç”¨ç¨‹åºï¼Œgradle run å‘½ä»¤ç”¨äºæ‰§è¡Œè¿™äº›å®šä¹‰å¥½çš„åº”ç”¨ç¨‹åºï¼š

1. Java Library Plugin  https://docs.gradle.org/current/userguide/java_library_plugin.html
2. Java Application Plugin  https://docs.gradle.org/current/userguide/application_plugin.html
3. Java Platform Plugin  https://docs.gradle.org/current/userguide/java_platform_plugin.html
4. Groovy Plugin  https://docs.gradle.org/current/userguide/groovy_plugin.html
5. Scala Plugin  https://docs.gradle.org/current/userguide/scala_plugin.html

è®¡åˆ’å¼ƒç”¨æˆ–ä¸æ¨èçš„æ’ä»¶ï¼š

1. application æ’ä»¶ï¼ŒGradle 9.0 è®¡åˆ’åˆ é™¤ï¼Œæ›¿ä»£ï¼š`application { }`ã€‚
2. base æ’ä»¶ï¼ŒGradle 9.0 è®¡åˆ’åˆ é™¤ï¼Œæ›¿ä»£ï¼š`base { }`ã€‚
3. java (java-library) æ’ä»¶ï¼ŒGradle 9.0 è®¡åˆ’åˆ é™¤ï¼Œæ›¿ä»£ï¼š`java { }`ã€‚
4. war æ’ä»¶ï¼ŒGradle 9.0 è®¡åˆ’åˆ é™¤ï¼Œæ›¿ä»£ï¼š`war { }`ã€‚
5. ear æ’ä»¶ï¼ŒGradle 9.0 è®¡åˆ’åˆ é™¤ï¼Œæ›¿ä»£ï¼š`ear { }`ã€‚
6. project-report æ’ä»¶ï¼ŒGradle 9.0 è®¡åˆ’åˆ é™¤ï¼Œæ›¿ä»£ï¼š`tasks.withType(HtmlDependencyReportTask) `ã€‚

æ ¹æ® JUnit ç‰ˆæœ¬ä¸åŒï¼Œåœ¨ç¼ºå¤± JVM Test Suite æ’ä»¶æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å£°æ˜æµ‹è¯•è¿è¡Œæ—¶ classpathï¼šhttps://docs.gradle.org/current/userguide/jvm_test_suite_plugin.html

1. JUnit 5 éœ€è¦ junit-platform-launcher çš„ `runtimeOnly` ä»¥åŠæµ‹è¯•å¼•æ“çš„ `implementation` ä¾èµ–ï¼›
2. JUnit 4 åªéœ€è¦ junit 4 çš„ `implementation` ä¾èµ–ï¼›
3. JUnit 3 éœ€è¦ junit 4 çš„ `runtimeOnly` ä»¥åŠ junit 3 çš„ `compileOnly`ï¼›

```js
dependencies {
    // If using JUnit Jupiter
    testImplementation("org.junit.jupiter:junit-jupiter:5.9.2")
    testRuntimeOnly("org.junit.platform:junit-platform-launcher")

    // If using JUnit Vintage
    testCompileOnly("junit:junit:4.13.2")
    testRuntimeOnly("org.junit.vintage:junit-vintage-engine:5.9.2")
    testRuntimeOnly("org.junit.platform:junit-platform-launcher")

    // If using JUnit 4
    testImplementation("junit:junit:4.13.2")

    // If using JUnit 3
    testCompileOnly("junit:junit:3.8.2")
    testRuntimeOnly("junit:junit:4.13.2")
}
```

æµ‹è¯•ç¨‹åºä¸­å¯¼å…¥ä¾èµ–åº“ä¹Ÿéœ€è¦æ ¹æ®æ‰€ä½¿ç”¨çš„ JUnit ç‰ˆæœ¬å¯¼å…¥ç›¸åº”çš„å‘½ä»¤ç©ºé—´ï¼š

	import org.junit.jupiter.api.Test;
	import static org.junit.jupiter.api.Assertions.assertEquals;

ä½¿ç”¨ `gradle -Dtest.single=App test` å‘½ä»¤å¯ä»¥æ‰§è¡Œå•ä¸ªæµ‹è¯•ï¼Œæµ‹è¯•ç¨‹åºåä¸­å¯ä»¥ä½¿ç”¨ * é€šé…ç¬¦æ¥è¿è¡Œå¤šä¸ªæµ‹è¯•ã€‚å¯ä»¥ç›´æ¥è°ƒç”¨ java å‘½ä»¤è¿è¡Œæµ‹è¯•ç¨‹åºï¼Œä¸€èˆ¬è¿è¡Œ Gradle åä¼šè‡ªåŠ¨ä¸‹è½½ junit ä¾èµ–åº“ï¼Œå°†å…¶è·¯å¾„æ·»åŠ åˆ° classpath å³å¯ä»¥è¿è¡Œæµ‹è¯•ç¨‹åºï¼š

	$ java -cp 'target/test-classes;c:/gradle/lib/junit-4.13.2.jar' mgid.AppTest

ç¼–è¾‘ Maven conf/setting.xml é…ç½®æ–‡ä»¶ï¼Œå¯ç”¨æœ¬åœ°ä»“åº“ï¼Œè¿™æ ·å°±å¯ä»¥ç¼“å­˜ä¸‹è½½è¿‡çš„ä¾èµ–åŒ…ã€‚ä¸‹æ¬¡ç¼–è¯‘æ—¶ï¼Œä¼šä¼˜å…ˆä»æœ¬åœ°çš„ä»“åº“ä¸­æ‰¾ä¾èµ–åŒ…ï¼Œå…¶æ¬¡ä» Maven æœåŠ¡ä¸­å¿ƒä»“åº“å»ä¸‹è½½ã€‚é»˜è®¤æœ¬åœ°ä»“åº“è·¯å¾„æ˜¯ï¼š${user.home}/.m2/repository

0. https://docs.gradle.org/current/userguide/java_testing.html
1. https://docs.gradle.org/current/userguide/jvm_test_suite_plugin.html
2. https://docs.gradle.org/current/userguide/upgrading_version_8.html#test_suites

ä»¥ä¸‹é…ç½®åŒæ—¶å¯ç”¨ Jupiter å’Œ Vintageï¼Œè¿™æ ·å°±å¯ä»¥æ”¯æŒ JUnit 3 å’Œ JUnit 4ï¼Œä»¥åŠ JUnit 5ï¼š

```js
dependencies {   
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.1'
    testCompileOnly 'junit:junit:4.13'
    testRuntimeOnly 'org.junit.vintage:junit-vintage-engine'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

tasks.withType(Test) {
    enabled true
    ignoreFailures false
    useJUnitPlatform()  // Work with jupiter or vintage engine
    testLogging {
        exceptionFormat "full"
        events "started", "skipped", "passed", "failed"
        showStandardStreams true
    }
}
```

Gradle é»˜è®¤æµ‹è¯•æŠ¥å‘Šä¸º HTML æ ¼å¼ï¼Œå¹¶ä¸”å­˜æ”¾äº build/reports/tests/test/index.html
1. https://mvnrepository.com/artifact/org.junit.platform/junit-platform-gradle-plugin
2. https://docs.gradle.org/current/userguide/java_testing.html#using_junit5

Gradle æ„å»ºè„šæœ¬å‚è€ƒï¼š

```js
/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'maven-publish'
}

repositories {
    mavenLocal()
    maven {
        url = uri('http://repo.maven.apache.org/maven2')
    }
}

dependencies {
    testImplementation 'junit:junit:3.8.1'
}

group = 'mgid'
version = '1.0-SNAPSHOT'
description = 'myaid'
sourceCompatibility = '17'

publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
```

æ‰§è¡Œ `gradle test` æ— æ³•å¯åŠ¨æµ‹è¯•ï¼Œå¹¶ä¸”æŠ¥å‘Šä¸­æ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼Œé‚£ä¹ˆå°±æ˜¯æ²¡æœ‰é…ç½®å¥½æµ‹è¯• JUint ç­‰æµ‹è¯•å¼•æ“ï¼Œæ ¹æ®æ­£ç¡®çš„ä¾èµ–é…ç½®ä¿®æ”¹ build.gradle è„šæœ¬ï¼š

	Could not start Gradle Test Executor
	Could not complete execution for Gradle Test Executor

	Cannot create Launcher without at least one TestEngine; 
	consider adding an engine implementation JAR to the classpath


# ğŸš© I/O and Streams æµå¼æ•°æ®å¤„ç†

I/O æ˜¯ç¨‹åºæœ€æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œä»æ—©æœŸæœºæ¢°å¼è®¡ç®—æœºçš„å¼€å…³çŠ¶æ€è¾“å…¥ï¼Œå½“æ—¶æ˜¯äººå·¥æ§åˆ¶å¼€å…³çš„çŠ¶æ€ï¼Œå†åˆ°çº¸è´¨å¡ç‰‡æ‰“å­”å¼æ•°æ®è¾“å…¥ï¼Œå†åˆ°ç”µå­ç”µè·¯ã€æ™¶ä½“ç®¡å¼€å…³ã€é›†æˆç”µè·¯ï¼Œæ•°æ®çš„æœ¬è´¨æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯åœ¨ç¡¬ä»¶å®ç°ä¸Šå·¥è‰ºå´è¶Šæ¥èµ·å¤åˆ¶ï¼Œç”šè‡³è®©äººè§‰å¾—æŠ½è±¡å¾—å¾ˆï¼

å°½ç®¡ï¼ŒI/O å’Œæµå¼æ•°æ®å¤„ç†ç»å¸¸æ··ä¸ºä¸€è°ˆï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚

â€œæµå¼â€Streams æ˜¯ I/O æ•°æ®å¤„ç†çš„ä¸€ç§æ¨¡å¼ï¼Œè¿›è¡ŒæµåŠ¨å¼æ•°æ®å¤„ç†çš„ä¸€ç§æŠ½è±¡æ¨¡å‹ï¼Œå„ç±»å‹çš„æ•°æ®åºåˆ—å°±å¦‚åŒæ°´æµï¼Œè¿™äº›æ•°æ®åºåˆ—ç§°ä¹‹ä¸º elementsï¼Œé€šè¿‡æµå¼æ¥å£å®šä¹‰çš„å„ç§æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚


å°†æ—©æœŸæœºæ¢°å¼€å…³æœºæ„å’Œ CPUã€å†…å­˜ç­‰é›†æˆç”µè·¯ä¸­çš„æ™¶ä½“ç®¡å¼€å…³æ”¾åˆ°ä¸€èµ·ï¼Œä¸éš¾å‘ç°æ•°æ®å³å¼€å…³çŠ¶æ€çš„æ•°æ®ï¼ŒI/O æ“ä½œå³é€šè¿‡å¼€å…³æ•°æ®çš„è¯»å†™å®ç°å¯¹åº”å¤©å…³ç”µè·¯çŠ¶æ€çš„åˆ‡æ¢ã€‚

I/O å­—é¢æ„æ€ï¼ˆInput/Outputï¼‰å³è¾“å…¥/è¾“å‡ºï¼Œé€šå¸¸æŒ‡ CPU ä¸å†…éƒ¨å­˜å‚¨å™¨ã€å¤–éƒ¨å­˜å‚¨å™¨ï¼Œæˆ–å…¶ä»–å‘¨è¾¹è®¾å¤‡å†…éƒ¨å†…å­˜ä¹‹é—´çš„æ•°æ®è¾“å…¥å’Œè¾“å‡ºã€‚

ä» C è¯­è¨€æ—¶ä»£å¼€å³ï¼Œæ ‡å‡† I/O æ–‡ä»¶ï¼ˆstdin stdou stderrï¼‰å°±æ˜¯ä¸€ä¸ªç¨‹åºçš„æ ‡å‡†é…ç½®ï¼Œåˆ° C++ã€Javaã€C#ï¼Œå†åˆ°ç°åœ¨çš„ Kotlin è¯­è¨€ï¼Œå®ƒä»¬ç¼–å†™ç¨‹åºè™½ç„¶åœ¨è¯­è¨€è¯­æ³•ä¸Šå„æœ‰å·®å¼‚ï¼Œä½†æ˜¯ç¨‹åº I/O åŸºç¡€ç»“æ„ä¸Šå¹¶æ²¡æœ‰å¤ªå¤šä¸åŒï¼šéƒ½ä¸çº¦è€ŒåŒåœ°ä½¿ç”¨æµå¼æ¥å£è®¾è®¡ã€‚

æ ‡å‡† I/O æ–‡ä»¶å’Œæ“ä½œç³»ç»Ÿæœ‰å¯†åˆ‡è”ç³»ï¼Œåˆ†åˆ«ä½¿ç”¨ 0 1 2 æ–‡ä»¶å·ç è¡¨ç¤ºï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œç®¡é“æ“ä½œã€é‡å®šå‘æ“ä½œã€‚Linux Command Line and Shell Scripting Bible ä¸€ä¹¦å¯¹æ ‡å‡†æ–‡ä»¶è¾“å…¥ã€è¾“å‡ºé‡å®šå‘æ“ä½œæœ‰è¯¦ç»†æè¿°ï¼Œæ­¤ä¹¦ä½œè€…æ˜¯ Christine Bresnahanï¼Œå†…å®¹è¯¦å°½åˆ°å‡ ä¹å¯ä»¥ç”¨å•°å—¦æ¥å½¢å®¹ï¼Œèƒ½ååˆ†ä½“ç°å¥³æ€§çš„æ€ç»´ã€‚

å› ä¸ºæ ‡å‡† I/O éƒ½æ˜¯ç¼“å­˜åŒºæ–¹å¼çš„æ•°æ®æ“ä½œï¼Œå¦‚æœä¸‹æ¸¸ç¨‹åºæ²¡æœ‰ I/O æ•°æ®æ¶ˆè´¹è¡Œä¸ºï¼Œé‚£ä¹ˆä¸Šæ¸¸çš„ç¨‹åºå°±æœ‰å¯èƒ½å†™æ»¡ç¼“å­˜ï¼Œå¹¶ä¸”å¯èƒ½è§¦å‘é”™è¯¯ã€‚

æ¯”å¦‚ä½¿ç”¨ Node å¤„ç†æ ‡å‡† I/O æ–‡ä»¶ï¼Œå°±å¯¹ process æ¨¡å—ä¸­æä¾›çš„ stdin stdout stderr å¯¹è±¡è¿›è¡Œæ“ä½œï¼š

```js
/** 
 * npm install turndown
 * npm install @types/node
 * $ java_spec=https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-0-preface8.html
 * $ curl $java_spec | index.js
 * $ echo "<h1>Title</h1><p>paragraph</p>" | node index.js
 * HTML data:31<h1>Title</H1><p>paragraph</p>
 * Title
 * =====
 * 
 * paragraph
 */

/// <reference types="node" />
var TurndownService = require('turndown')

var turndownService = new TurndownService()
var markdown = turndownService.turndown('<h1>Hello world!</h1>')
process.stdout.write(markdown)

process.stdin.on("data", (it) => {
  console.log('HTML data:' + it.length + it.toString());
  process.stdout.write(turndownService.turndown(it.toString()));
})
```

ä½¿ç”¨ marked æ¨¡å—è½¬æ¢ Markdown ä¸º HTMLï¼š

```sh
# https://github.com/mixmark-io/turndown
# https://www.npmjs.com/package/marked
$ npx install -g marked
$ echo "# title" | npx marked
<h1>title</h1>
```

ä»£ç ä¸­ä½¿ç”¨ turndown å·¥å…·å°† HTML è½¬æ¢ä¸º Markdwon æ–‡æœ¬ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ NPM å®‰è£…æ­¤æ¨¡å—ã€‚è‡³äº @types/node æ˜¯è¾…åŠ©æ€§æ¨¡å—ï¼Œå®ƒä¸º TypeScript è§£æå™¨æä¾›ç±»å‹å£°æ˜ä¿¡æ¯ï¼Œå¯ä»¥ä¸º TypeScript LSP æ™ºèƒ½æç¤ºæä¾›å‚ç…§ä¿¡æ¯ã€‚

ä½¿ç”¨ curl å‘½ HTML é¡µé¢ï¼Œå†é€šè¿‡ | ç®¡é“æ“ä½œç¬¦å·å°†æ•°æ®æµå¯¼å‘ Node ç¨‹åºï¼Œå³é€šè¿‡ process.stdin.on æ³¨å†Œçš„ `data` äº‹ä»¶è¾“å…¥çš„æ•°æ®ã€‚Node å¯ä»¥é€šè¿‡ console å¯¹è±¡å‘ç”¨æˆ·æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ process.stdout æ ‡å‡†æ–‡ä»¶è¾“å‡ºã€‚

Python è„šæœ¬ä¸­çš„ I/O å¤„ç†ä¹Ÿç±»ä¼¼ï¼Œæ³¨æ„ï¼šhtml2markdown å¹¶ä¸æ˜¯ä¸“ä¸šå·¥å…·ï¼Œä»…ä½œæ¼”ç¤ºä¹‹ç”¨ã€‚ï¼š

```py
import html2markdown
import sys

literal = '<h1>Title</h1><pre><code>Here is some code</code></pre>'
lines = sys.stdin.readlines()
print(html2markdown.convert(literal))
print(html2markdown.convert(''.join(lines)))
```

Python è„šæœ¬ä¸­çš„æ ‡å‡† I/O æ–‡ä»¶å®šä¹‰åœ¨ sys æ¨¡å—ï¼ŒFAQ: Why doesn't closing sys.stdout (stdin, stderr) really close it? æè¿°ï¼Œæ‰§è¡Œ ``sys.stdout.close()`` åªæ˜¯å…³é—­äº† Python è„šæœ¬çº§åˆ«çš„æ–‡ä»¶å¯¹è±¡ï¼Œå¹¶æœªçœŸæ­£å…³é—­ C file descriptorï¼Œè¿™éœ€è¦è°ƒç”¨ os æ¨¡å—çš„æ–¹æ³•ï¼Œæ–‡ä»¶å·å¯ä»¥ä½¿ç”¨é»˜è®¤çš„ 0 1 2ï¼š

```py
   os.close(stdin.fileno())
   os.close(stdout.fileno())
   os.close(stderr.fileno())
```

1. Python-3.10.2\Doc\faq\library.rst
2. Python-3.10.2\Doc\library\io.rst
3. Python-3.10.2\Doc\library\os.rst
4. Python-3.10.2\Doc\library\sys.rst

Java çš„æ•´ä¸ªå‘å±•å†å²ä¸­ï¼Œå…ˆåå¼•å…¥äº†å¤šç§ I/O æ¨¡å‹ï¼Œä¾æ¬¡ä¸ºï¼š

1. Java æ—©æœŸç‰ˆæœ¬ä½¿ç”¨é˜»å¡å¼ I/Oï¼ŒBlocking I/O (BIO)ï¼›
2. Java 1.4 åŠ å…¥éé˜»å¡å¼ New I/O (NIO)ï¼ŒNon-Blocking I/Oï¼›
3. Java 1.7 å‡çº§åˆ° NIO 2 å¼‚æ­¥ I/Oï¼ŒAsynchronous I/O (AIO)ã€‚

è¿™é‡Œæ¶‰åŠäº†ä¸¤ç»„å¯¹ç«‹çš„æ¦‚å¿µï¼šé˜»å¡ (Block)å’Œéé˜»å¡ (Non-Block)ï¼Œä»¥åŠåŒæ­¥ (Synchronization) å’Œå¼‚æ­¥ (Asynchronous)ã€‚å‰ä¸€ç»„æè¿°çº¿ç¨‹æ‰§è¡Œç­‰å¾…å¤„ç†æ–¹å¼ï¼Œåä¸€ç»„æè¿°æ‰§è¡Œçš„ç§©åºã€‚è¿™äº›æ˜¯åŸºäºæ“ä½œç³»ç»Ÿå±‚é¢çš„æ¦‚å¿µï¼Œä»¥ä¸¤ A B æ¡è¯»å–æ–‡ä»¶çš„ä»£ç è¯­å¥ä¸ºä¾‹ï¼š

1. é˜»å¡æ–¹å¼æ‰§è¡Œï¼šæ‰§è¡Œ A è¯­å¥ï¼Œå¹¶ç­‰ç­‰è¿”å›ç»“æœï¼Œç›´åˆ°è·å–ç»“æœåå†æ‰§è¡Œ B è¯­å¥ã€‚
2. éé˜»å¡æ–¹å¼æ‰§è¡Œï¼šæ‰§è¡Œ A è¯­å¥ï¼Œå°è¯•è·å–ç»“æœï¼Œå¹¶ä¸”ç«‹å³è¿”å›ï¼Œå¹¶ç»§ç»­æ‰§è¡Œ B è¯­å¥ã€‚
3. åŒæ­¥æ–¹å¼æ‰§è¡Œï¼šå…ˆæ‰§è¡Œ A è¯­å¥è¯»å–å®Œæ–‡ä»¶åï¼Œå†æ‰§è¡Œ B è¯­å¥ã€‚
4. å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼šæ‰§è¡Œ A è¯­å¥ï¼Œåœ¨å…¶åå›ç»“æœä¹‹å‰å°±æ‰§è¡Œ B è¯­å¥ã€‚

ç”±äºé˜»å¡å¼ I/O æ•ˆç‡å¤ªä½ï¼Œä¸åˆ©äºå¼€å‘é«˜æ•ˆçš„å¹¶å‘å¤„ç†åº”ç”¨ï¼Œè€Œå¼‚æ­¥ I/O åˆ™æ˜¯å…‹æœäº†é˜»å¡å¼ I/O çš„é—®é¢˜ï¼Œä½¿ç”¨å…¶éå¸¸é€‚ç”¨äºé«˜å¹¶å‘åº”ç”¨å¼€å‘ã€‚Nodejs ç­‰å¹³å°é»˜è®¤å°±ä½¿ç”¨å¼‚æ­¥ I/O äº‹ä»¶å¤„ç†æ¨¡å‹ã€‚

å¼‚æ­¥ I/O å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ–¹å¼æ¥å®ç°çº¿ç¨‹é—´çš„ä»»åŠ¡æ¶ˆæ¯å¤„ç†ï¼š

1. çŠ¶æ€ï¼šç›‘å¬è¢«è°ƒç”¨è€…çš„çŠ¶æ€ï¼Œè°ƒç”¨è€…æŒ‰æ—¶é—´åŒæœŸåœ°è½®è¯¢çŠ¶æ€ä¿¡æ¯ï¼Œæ•ˆç‡è¾ƒä½ã€‚
2. é€šçŸ¥ï¼šå½“è¢«è°ƒç”¨è€…æ‰§è¡Œå®Œæˆåï¼Œé€šçŸ¥è°ƒç”¨è€…ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚
3. å›è°ƒï¼šå½“è¢«è°ƒç”¨è€…æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œè°ƒç”¨è€…é¢„è®¾çš„å›è°ƒå¤„ç†å‡½æ•°ã€‚

å¼‚æ­¥ I/O æœ¬è´¨å°±æ˜¯å †å ç­‰å¾…æ—¶é—´å®ç°æ›´é«˜æ•ˆçš„å¤„ç†èƒ½åŠ›ï¼Œå°±å¦‚ä½ è‡ªå·±åšæ—©é¤ï¼Œåˆè¦ç…è›‹åˆè¦ç…®å’–å•¡ï¼Œé‚£ä¹ˆæŒ‰å¼‚æ­¥æ“ä½œå°±æ˜¯ï¼šå…ˆå¼€ç«çƒ§æ°´ï¼Œå†å¼€ç«ç…è›‹ï¼Œæ°´å¼€äº†å†å†²å’–å•¡ï¼Œç„¶åè›‹ä¹Ÿç†Ÿäº†ã€‚å¦‚æœæŒ‰åŒæ­¥ã€é˜»å¡çš„æ–¹å¼ï¼Œå…ˆè¦ç…è›‹ï¼Œç­‰å®ƒç†Ÿäº†å†çƒ§æ°´å†²å’–å•¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†æ‰€æœ‰ç­‰å¾…æ—¶é—´ä¸²è¿äº†èµ·æ¥ï¼Œç›¸å½“ä½æ•ˆç‡ã€‚

ã€ŠUnix ç½‘ç»œç¼–ç¨‹ã€‹ä»‹ç»äº†äº”ç§ I/O æ¨¡å‹ï¼Œè€Œ Java NIO ä½¿ç”¨çš„æ˜¯**å¤šè·¯å¤ç”¨ I/O æ¨¡å‹**ã€‚

1. Blocking I/O       é˜»å¡ I/O æ¨¡å‹ï¼›
2. Non-blocking IO    éé˜»å¡ I/O æ¨¡å‹ï¼›
3. I/O multiplexing   å¤šè·¯å¤ç”¨ I/O æ¨¡å‹ï¼›
4. Signal driven I/O  ä¿¡å·é©±åŠ¨ I/O æ¨¡å‹ï¼›
5. Asynchronous I/O   å¼‚æ­¥ I/O æ¨¡å‹ï¼›

é˜»å¡å¼ I/Oï¼ŒBIOï¼Œæ˜¯é¢å‘å­—èŠ‚æµæˆ–å­—ç¬¦æµç¼–ç¨‹çš„ I/O æ–¹å¼ã€‚I/O ä¸ Streams æ•°æ®å¤„ç†æ¨¡å¼ç»“åˆï¼Œè¿™äº›ç›¸å…³çš„ç±»å‹ä¹Ÿå°±ä½¿ç”¨ Inputã€Output å’Œ Stream ç­‰å­—ç¬¦ï¼Œå¹¶ä¸”æ ¹æ®å…·ä½“çš„ I/O è®¾å¤‡ç±»å‹å‘½åã€‚InputStreamã€OutputStream å’Œ Readerã€Writer æ˜¯æ•´ä¸ª I/O ä½“ç³»çš„åŸºç±»ï¼Œå‰ä¸€å¯¹å¤„ç†å­—èŠ‚æ•°æ®ï¼Œåä¸€å¯¹å¤„ç†å­—ç¬¦æ•°æ®ã€‚

01. åŸºç¡€ I/O æµæŠ½è±¡åŸºç±»ï¼š
	01.1. è¾“å…¥æµï¼šå¯è¯»å–æ•°æ®ï¼ŒåŸºç±»ï¼šInputStream æˆ–è€… Reader
	01.2. è¾“å‡ºæµï¼šå¯å†™å…¥æ•°æ®ï¼ŒåŸºç±»ï¼šOutputStream æˆ–è€… Writer
02. æ–‡ä»¶ï¼ˆFileï¼‰ï¼šFileInputStream FileOutputStream FileReader FileWriter
03. å†…å­˜ç¼“å†²åŒºï¼ˆBufferï¼‰ï¼šBufferedInputStream BufferedOutputStream BufferedReader BufferedWriter
04. å­—ç¬¦ä¸²æµå¯¹è±¡ï¼ˆStringï¼‰ï¼šStringReader StringWriter
05. ç½‘ç»œè®¾å¤‡ç¼“å†²åŒºï¼ˆSocketï¼‰ï¼šSocketInputStream æˆ– SocketOutputStream
06. å­—ç¬¦æµè½¬å­—èŠ‚æµï¼šInputStreamReader OutputStreamWriter
07. å¯¹è±¡æµï¼šObjectInputStream ObjectOutputStream
08. æ‰“å°æµï¼šPrintStream(OutputStream) PrintWriter
09. å…ƒç´ æ¨å›æµï¼šPushbackInputStream PushbackReader
10. å­—èŠ‚æ•°ç»„æµï¼šByteArrayInputStream ByteArrayOutputStream ByteArrayReader ByteArrayWriter
11. ç®¡é“æµï¼šPipedInputStream PipedOutputStream PipedReader PipedWriter
12. è¿‡æ»¤å™¨ï¼šFilterInputStream FilterOutputStream FilterReader FilterWriter
13. æœºå™¨æ— å…³çš„æ•°æ®æµï¼šDataInputStream DataOutputStream

Java System å…¨å±€æ¨¡å—å®šä¹‰äº† Standard I/O ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•ï¼š

```java
public final static InputStream in = null;
public final static PrintStream out = null;
public final static PrintStream err = null;
public static void setIn(InputStream in);
public static void setOut(PrintStream out);
public static void setErr(PrintStream err);
```

ä½¿ç”¨ ByteArrayOutputStream æ­é… BufferedOutputStream æ›¿æ¢æ‰ stdout å°±å¯ä»¥å®ç°æ ‡å‡†è¾“å‡ºå†…å®¹çš„æˆªå–ï¼Œå®ç° Redirecting standard I/Oã€‚

æ³¨æ„ï¼šå› ä¸ºä½¿ç”¨äº†ç¼“å†²æµï¼Œéœ€è¦é…åˆ flush() æ’ç©ºç¼“å†²åŒºæ•°æ®ï¼Œå¦åˆ™æ•°æ®ä¸ä¼šåŠæ—¶å†™å…¥ ByteArrayOutputStream å¯¹è±¡ï¼š

```java
import java.io.*;
import java.lang.Exception;

public class Redirection {
    public static void main( String[] args ) throws Exception
    {
        ByteArrayOutputStream baos = new ByteArrayOutputStream(10000);
        OutputStream outstream = new BufferedOutputStream( baos );
        PrintStream console = System.out;
        System.out.println("Redirection standard I/O:");
        System.setOut(new PrintStream(outstream));
        try {
            mgid.App.main(args);
        } finally {
            System.out.format("ByteArray size: %d\n", baos.size());
            System.out.flush(); // force write data to baos.
            System.out.format("ByteArray size flushed: %d\n", baos.size());
            System.out.flush(); // force write data to baos.
            System.setOut(console);
            System.out.format("Cat: \n %s", baos.toString());
        }
    }
}
```

ä»¥ä¸‹æ˜¯æ‰©å±•è‡ª java.util.stream.BaseStream çš„åŸºç¡€æµæ¥å£ï¼š

1. `DoubleStream` å¤„ç† double æ•°å€¼åºåˆ—å’Œèšåˆæ“ä½œï¼›
2. `IntStream` å¤„ç† int æ•°å€¼åºåˆ—å’Œèšåˆæ“ä½œï¼›
3. `LongStream` å¤„ç† long æ•°å€¼åºåˆ—å’Œèšåˆæ“ä½œï¼›
4. `Stream<T>` A sequence of elements supporting sequential and parallel aggregate operations.

æµå¼æ•°æ®å¤„ç†çš„åŸºæœ¬ç‰¹å¾ï¼š

1. æ— å­˜å‚¨ã€‚æµå¼å¯¹è±¡åªæ˜¯æ•°æ®å¤„ç†çš„å½¢å¼ï¼Œä¸æ˜¯ä¸€ç§å­˜å‚¨æ•°æ®çš„ç»“æ„ã€‚
2. ä¸ºå‡½æ•°å¼ç¼–ç¨‹è€Œç”Ÿã€‚æµå¼å¯¹è±¡ä¸­å¯¹ä»»ä½•æ•°æ®çš„ä¿®æ”¹éƒ½ä¸ä¼šå½±å“æ•°æ®æºã€‚
3. æƒ°æ€§æ‰§è¡Œã€‚æµå¼å¯¹è±¡ä¸Šçš„æ“ä½œåªåœ¨ç”¨æˆ·æ¶ˆè´¹æ•°æ®æ—¶æ‰ä¼šæ‰§è¡Œã€‚
4. å¯æ¶ˆè´¹æ€§ (Consumable)ã€‚æ•°æ®åªâ€œæ¶ˆè´¹â€ä¸€æ¬¡ï¼Œå†æ¬¡ä½¿ç”¨åªèƒ½é‡æ–°ç”Ÿæˆæµå¯¹è±¡ã€‚

æµå¼æ“ä½œåˆ†ä¸ºä¸ºä¸¤ç±»ï¼ŒäºŒè€…ç‰¹ç‚¹å¦‚ä¸‹ï¼š

1. ä¸­é—´æ“ä½œ (intermediate operations)ï¼Œæ–°ç”Ÿæˆä¸€ä¸ªæ ‡è®°äº†è¯¥æ“ä½œçš„ stream å¯¹è±¡ã€‚
1.1. æ— çŠ¶æ€æ“ä½œï¼šå¦‚ filterï¼Œmapï¼Œä¸éœ€è¦è·å¾—å…ˆå‰éå†è¿‡çš„å…ƒç´ çš„çŠ¶æ€ã€‚ 
1.2. æœ‰çŠ¶æ€æ“ä½œï¼šå¦‚ distinctï¼Œsorted, éœ€è¦å¾—åˆ°å…ˆå‰è®¿é—®çš„å…ƒç´ çš„çŠ¶æ€ã€‚
2. ç»“æŸæ“ä½œ (terminal operations)ï¼Œè§¦å‘å®é™…è®¡ç®—ï¼Œå¹¶ä¸”ä»¥ pipeline æ–¹å¼æ‰§è¡Œã€‚

æœ‰çŠ¶æ€çš„æ“ä½œåœ¨äº§ç”Ÿç»“æœå‰éœ€è¦è·å¾—å®Œæ•´çš„è¾“å…¥ï¼Œæ“ä½œä¸€ä¸ªå¹¶è¡Œæµæ—¶ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡ä¼ å…¥æ•°æ®æˆ–è€…éœ€è¦ç¼“å­˜æ•°æ®ã€‚

å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ Collection å¯¹è±¡çš„ `stream()` `parallelStream()` æ–¹æ³•æˆ–è€… Stream å¯¹è±¡ `of()` æ–¹æ³•å¾—åˆ°ä¸€ä¸ªæµå¯¹è±¡ï¼Œå‚è€ƒä»£ç ï¼š

```java
int[] arr = new int[]{1,2,3};
IntStream stream1 = Arrays.stream(arr);

String[] stringArr = new String[]{"Hello", "imooc"};
Stream<String> stream2 = Arrays.stream(stringArr);

List<String> strings = Arrays.asList("abc", "");
long count = strings.parallelStream().filter(it -> it.isEmpty()).count();

Stream<Integer> stream = Stream.of(1, 2, 3);
```

Stream æ˜¯æ³›å‹æµå¯¹è±¡ï¼Œå®ƒé™¤äº† of() æ–¹æ³•ï¼Œè¿˜æä¾›ä¸€ç³»åˆ—æµæ¥å£æ–¹æ³•ï¼š

1. æµå¯¹è±¡ç”Ÿæˆï¼šgenerate()
2. LongStream æˆ–è€… IntStream é—­åŒºé—´æ•°å€¼åºåˆ—ï¼šrange()
3. å…ƒç´ è¿­ä»£ï¼šforEach()
4. å…ƒç´ è¿‡æ»¤ï¼šfilter()
5. å…ƒç´ æ’åºï¼šsorted()
6. é›†åˆè½¬æ¢ï¼šcollect()
7. æ˜ å°„æ“ä½œï¼šmap() mapToInt() flatMap()
8. èšåˆæ“ä½œï¼šcount() max() min() average() sum()
9. å…¶å®ƒæ“ä½œï¼šfindFirst() findAny()


# ğŸš© Java Native Interface (JNI)
1. https://docs.oracle.com/en/java/javase/17/docs/specs/jni/index.html
2. https://docs.oracle.com/javase/8/docs/technotes/guides/jni/index.html
3. https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaNativeInterface.html

JNI æ˜¯ Java å®ç°ä¸åŸç”Ÿç¯å¢ƒäº’è°ƒç”¨çš„æ¥å£ï¼Œæ‰€è°“â€œåŸç”Ÿâ€æ˜¯æŒ‡ Java è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„å®ç°è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯ C/C++ã€‚è¿™ä¹Ÿæ˜¯ç¼–ç¨‹ç¼–ç¨‹é¢†åŸŸä¸­çš„åŸç”Ÿä¸€è¯çš„ä¸€èˆ¬å«ä¹‰ï¼Œå› ä¸º C/C++ ä½œä¸ºè®¡ç®—æœºå·¥ä¸šçš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œå…·æœ‰å¼ºå¤§çš„ç”Ÿæ€ä½ä¼˜åŠ¿ã€‚

Android NDK ä¹Ÿæ˜¯é€šè¿‡ JNI å®ç° C/C++ æ‰©å±•ï¼Œå› ä¸º Android æ˜¯ Linux ç³»ç»Ÿï¼Œæ‰€ä»¥å®ƒåŠ è½½çš„æ€»æ˜¯ä»¥ .so ä¸ºæ‰©å±•ååŠ¨æ€åº“ã€‚

Java å‘å±•å†å²ä¸­å½¢æˆäº†å¤šç§ JNI æ¥å£ï¼š

1. JDK 1.0 native method interface (NMI)
2. Netscape's Java Runtime Interface (JRI)
3. Microsoft's Raw Native Interface and Java/COM interface

å…¶ä¸­ JDK 1.0 Native Method Interface æœ‰ä¸¤ä¸ªä¸»è¦ç¼ºé™·å¯¼è‡´è¯¥æ¥å£ä¸è¢«å¸¸ç”¨ Java è™šæ‹Ÿæœºé‡‡ç”¨ï¼š

é¦–å…ˆï¼Œæœ¬æœºä»£ç å°† Java å¯¹è±¡ä¸­çš„å­—æ®µä½œä¸º C ç»“æ„çš„æˆå‘˜è¿›è¡Œè®¿é—®ã€‚ç„¶è€Œï¼ŒJava è¯­è¨€è§„èŒƒå¹¶æ²¡æœ‰å®šä¹‰å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€æ–¹å¼ã€‚å¦‚æœ Java è™šæ‹Ÿæœºåœ¨å†…å­˜ä¸­ä»¥ä¸åŒçš„æ–¹å¼å¸ƒç½®å¯¹è±¡ï¼Œé‚£ä¹ˆç¨‹åºå‘˜å°†ä¸å¾—ä¸é‡æ–°ç¼–è¯‘åŸç”Ÿæ–¹æ³•åº“ã€‚

å…¶æ¬¡ï¼ŒJDK1.0 çš„åŸç”Ÿæ¥å£ä¾èµ–äºä¿å®ˆçš„åƒåœ¾æ”¶é›†å™¨ã€‚ä¸å—é™åˆ¶çš„ä½¿ç”¨ `unbound` ä½¿å¾—å¿…è¦æ‰§è¡Œä¿å®ˆåƒåœ¾æ”¶é›†å™¨æ‰«æåŸç”Ÿå †æ ˆã€‚

ä¸€ä¸ªç»Ÿä¸€çš„ã€ç»è¿‡æ·±æ€ç†Ÿè™‘çš„æ ‡å‡†æ¥å£ä¸ºæ¯ä¸ªäººæä¾›äº†ä»¥ä¸‹å¥½å¤„ï¼š

1. Each VM vendor can support a larger body of native code.
2. Tool builders will not have to maintain different kinds of native method interfaces.
3. Application programmers will be able to write one version of their native code and this version will run on different VMs.

å®ç°æ ‡å‡†åŸç”Ÿæ–¹æ³•æ¥å£é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

1. *Binary compatibility* - The primary goal is binary compatibility of native method libraries across all Java VM implementations on a given platform. Programmers should maintain only one version of their native method libraries for a given platform.
2. *Efficiency* - To support time-critical code, the native method interface must impose little overhead. All known techniques to ensure VM-independence (and thus binary compatibility) carry a certain amount of overhead. We must somehow strike a compromise between efficiency and VM-independence.
3. *Functionality* - The interface must expose enough Java VM internals to allow native methods to accomplish useful tasks.

JNI æ¥å£æ˜¯ Java ä»£ç ä¸ C/C++ ä»£ç æ²Ÿé€šçš„æ¡¥æ¢ï¼Œä½¿ç”¨å…¶åŠ¨æ€åŠ è½½çš„æ¨¡å—æ–¹æ³•å¿…é¡»å…ˆæ³¨å†Œï¼š
1. JNI æ‰©å±•æ–¹æ³•å®ç°åœ¨ C/C++ ä»£ç ä¸­ï¼›
2. JNI æ‰©å±•æ–¹æ³•çš„å£°æ˜åœ¨ Java ç±»ä¸­ï¼Œä½¿ç”¨ `native` å…³é”®å­—å…³è”åŸç”Ÿæ–¹æ³•ã€‚

CPP ä»£ç ä¸­æ³¨å†Œ JNI æ–¹æ³•æœ‰é™æ€æ³¨å†Œå’ŒåŠ¨æ€æ³¨å†Œä¸¤ç§å½¢å¼ï¼Œå‰è€…æ ¹æ® JNI å‘½ä»¤è§„èŒƒç›´æ¥å®šä¹‰å¯¹åº”åå­—çš„ C/C++ å‡½æ•°ï¼Œåè€…ä½¿ç”¨ `RegisterNatives` å‡½æ•°æ³¨å†Œã€‚

ç¼–è¯‘å¥½æ‰©å±•åº“ï¼Œå¯ä»¥åœ¨ Java ä»£ç ä¸­è°ƒç”¨ `System.load()` æˆ–è€… `System.loadLibrary()` æ–¹æ³•åŠ è½½åŠ¨æ€è¿æ¥åº“ï¼Œæ ¹æ®ç³»ç»Ÿä¸åŒï¼Œå¯ä»¥æ˜¯ .dll æˆ–è€… .so åº“ï¼Œå‰è€…æŒ‡å®šçš„è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„ã€‚åè€…æŒ‡å®šçš„æ˜¯åº“åï¼Œä¼šè‡ªåŠ¨æ‹¼æ¥ lib å‰ç¼€å’Œ .so åç¼€ï¼Œæ¯”å¦‚åŠ è½½ stdc å°±æ˜¯åŠ è½½ libstdc.so åŠ¨æ€åº“æ–‡ä»¶ï¼Œå¹¶åœ¨å½“å‰ç›®å½•å’Œç³»ç»Ÿè·¯å¾„æœç´¢åŠ¨æ€åº“ã€‚å®ƒä»¬å†…éƒ¨è¿˜ä¼šè°ƒç”¨ `nativeLoad()` åŠ è½½åŠ¨æ€åº“ã€‚

JDK æ²¡æœ‰æä¾›ç›´æ¥å¸è½½ so åº“çš„æ–¹æ³•ï¼Œè€Œæ˜¯ä¼´éš ClassLoader å¸è½½æ—¶å¸è½½ã€‚

JNI è§„èŒƒæ–‡æ¡£æ‰€è¿°åŠ¨æ€åº“æœ‰ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒLibrary Lifecycle Function Hooksï¼š
https://github.com/Jeangowhy/opendocs/blob/main/jni_spec.md#library-lifecycle-function-hooks

```cpp
jint JNI_OnLoad(JavaVM *vm, void *reserved);
void JNI_OnUnload(JavaVM *vm, void *reserved);
jint JNI_Onload_<L>(JavaVM *vm, void *reserved);
void JNI_OnUnload_<L>(JavaVM *vm, void *reserved);
```

å®‰è£… JDK åï¼Œå°±å¯ä»¥åœ¨å®‰è£…ç›®å½•æ‰¾åˆ° `include/jni.h` å’Œ `lib/jvm.lib` ç­‰ä¾èµ–æ–‡ä»¶ï¼Œè¿˜æœ‰ä¾èµ–ç¡¬ä»¶å¹³å°çš„ `jni_md.h`ï¼Œç¼–è¯‘æ‰©å±•åº“æ—¶éœ€è¦å¼•ç”¨ã€‚JDK 8 å¼€å§‹ä½¿ç”¨ `javac -h` å‘½ä»¤æ›¿ä»£ javah å·¥å…·ï¼Œä¸ºæ­£åœ¨ç¼–è¯‘çš„ Java ç¨‹åºç”Ÿæˆç›¸åº”çš„ C/C++ å¤´æ–‡ä»¶ã€‚æ¯”å¦‚ç¼–è¯‘ä»¥ä¸‹ HelloNative.java å°±ç”Ÿæˆ HelloNativeJNI.hï¼š

```java
package NM;

public class HelloNative {
    static native String nativeHello(String name);
    static {
        System.loadLibrary("NM_HelloNative");
        // System.load("/c/kotlin/myaid/NM_HelloNative.dll");
    }
    public static void main(String[] args) {
        System.out.format("from native: %s\n", nativeHello("NM"));
        System.out.format("from native: %s\n", nativeHello("æ±‰è¯­"));
    }
}
```

Java ç¨‹åºç¼–è¯‘ä¸å¤´æ–‡ä»¶ç”Ÿæˆå‘½ä»¤å‚è€ƒï¼Œå¤´æ–‡ä»¶å·²ç»ä¸º native æ–¹æ³•æ·»åŠ å¥½çš„åŸå‹å£°æ˜ï¼Œåªéœ€è¦æ ¹æ®åŸå‹å£°æ˜æä¾›å…·ä½“å®ç°å®šä¹‰ï¼š

```sh
$ javac -h . src/main/java/NM/HelloNative.java
$ ls
NM_HelloNative.h
```

ç”Ÿæˆçš„ C/C++ å¤´æ–‡ä»¶å‚è€ƒå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ° JNI æ–¹æ³•åå‰ç¼€åŒ…å«çš„ Java ç±»å‹çš„å®Œæ•´ä¿¡æ¯ï¼Œæ ¼å¼ä¸º `Java_PACKAGES_CLASS_native`ã€‚ä»£ç ä¸­çš„ç¬¦å·è¯´æ˜ï¼š

1. `__cplusplus` å®ç¬¦å·åœ¨ C++ ç¼–è¯‘ç¯å¢ƒä¸‹æœ‰å®šä¹‰ï¼Œæ­¤æ—¶å°±ä¼šå¯ç”¨ `extern "C"` ä»¥é¿å…å¯¼å‡ºçš„ API å‡½æ•°å‘½åå—åˆ° C++ å‡½æ•°é‡è½½æœºåˆ¶ name mangling å½±å“ï¼š
2. `JNIEXPORT` å®ç¬¦å·æ ‡è®°å¯¼å‡ºå‡½æ•°ï¼Œ Windwos ç³»ç»Ÿå–å€¼ `__declspec(dllexport)`ï¼›
3. `JNIIMPORT` å®ç¬¦å·æ ‡è®°å¯¼å…¥å‡½æ•°ï¼ŒWindwos ç³»ç»Ÿå–å€¼ `__declspec(dllimport)`ï¼›
4. `JNICALL` å®ç¬¦å·è¡¨ç¤ºå‡½æ•°è°ƒç”¨çº¦å®šï¼ŒWindows ç³»ç»Ÿä¸‹ä½¿ç”¨ `__stdcall`ï¼ŒLinux ç³»ç»Ÿä½¿ç”¨ C/C++ é»˜è®¤å€¼ï¼›

è¯­è¨€é—´çš„äº’è°ƒç”¨æ¶‰åŠå¤§é‡çš„æ•°æ®ç±»å‹è½¬æ¢å·¥ä½œï¼ŒJNI ä¹Ÿä¸€æ ·ï¼Œå‚è€ƒè§„èŒƒæ–‡æ¡£ [Chapter 3: JNI Types and Data Structures](jni_spec.md#chapter-3-jni-types-and-data-structures)ã€‚ä»£ç ä¸­çš„ `jstring` å¯¹åº” String ç±»å‹ï¼Œ`jclass` å¯¹åº” Class ç±»å‹ã€‚æ ¹æ® JNI æ–¹æ³•å®ç°å½¢å¼ä¸åŒï¼Œé™æ€å‡½æ•°æˆ–ç±»æˆå‘˜æ–¹æ³•ï¼Œå‚æ•°ä¹Ÿæœ‰ä¸åŒå½¢å¼ï¼š

1. native é™æ€æ–¹æ³•ï¼š`jclass` ç±»å‹å‚æ•°å¼•ç”¨å…¶æ‰€æ³¨å†Œç±»çš„ Class å¯¹è±¡ï¼›
2. native å®ä¾‹æ–¹æ³•ï¼š`jobject` ç±»å‹å‚æ•°å¼•ç”¨è°ƒç”¨æ­¤ native æ–¹æ³•çš„å¯¹è±¡ã€‚

æœ€é‡è¦çš„æ˜¯ `JNIEnv`ï¼Œå¯¹åº”ä¸€ä¸ª JVM è™šæ‹Ÿæœºç¯å¢ƒçŠ¶æ€å¯¹è±¡å¼•ç”¨ï¼Œæ­¤ç»“æ„ä½“åŒ…å« Interface Function Tableï¼Œé€šè¿‡å®ƒå¯ä»¥è°ƒç”¨æ‰€æœ‰ JNI å‡½æ•°ï¼Œä¾‹å¦‚å­—ç¬¦è½¬æ¢å‡½æ•° `GetStringUTFChars`ã€`GetStringUTFChars`ã€`GetStringUTFChars` ç­‰ç­‰ï¼Œ`GetStringUTFLength` è·å–çš„æ˜¯ UTF å­—ç¬¦ä¸²å ç”¨çš„å­—èŠ‚æ•°ï¼Œä½¿ç”¨ `GetStringLength` å¹¶ä¸èƒ½å‡†ç¡®å¤„ç† UTF å­—ç¬¦ä¸²ã€‚

è°ƒç”¨ JNI å‡½æ•°æœ‰ C å’Œ C++ ä¸¤ç§å½¢å¼ï¼š

```cpp
// We use inlined functions for C++ so that programmers can write:
   env->FindClass("java/lang/String")
// in C:
   (*env)->FindClass(env, "java/lang/String")
```

æ³¨æ„ï¼Œä½¿ç”¨ `GetStringUTFChars` å‡½æ•°è·å– C å­—ç¬¦ä¸²ï¼Œéœ€è¦è°ƒç”¨ `ReleaseStringUTFChars` å‡½æ•°æ¥é‡Šæ”¾å®ƒåœ¨ Java å †ä¸­åˆ†é…å†…å­˜ã€‚

è°ƒç”¨ Java ç±»å®šä¹‰çš„æ–¹æ³•åˆ™éœ€è¦æŒ‰ JVM è§„èŒƒç¼–ç ï¼Œå…ˆè·å–æ–¹æ³• ID ç¼–ç ï¼ˆå‡½æ•°åä¸ç­¾åç»„åˆçš„ä¸€ç§è¡¨è¾¾ï¼‰ï¼Œå†æ ¹æ® ID è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼š

1. GetMethodID -> CallObjectMethod
2. GetStaticMethodID -> CallStaticObjectMethod

å‡½æ•°ç­¾åå­—ç¬¦ä¸²æ„é€ å‚è€ƒ JNI è§„èŒƒæ–‡æ¡£ [3. JNI Types and Data Structures](#chapter-3-jni-types-and-data-structures) Java VM Type Signaturesï¼š

| Type Signature | Java Type |
|----------------|-----------|
| `Z` | boolean
| `B` | byte
| `C` | char
| `S` | short
| `I` | int
| `J` | long
| `F` | float
| `D` | double
| `V` | void
| `L` fully-qualified-class `;` | fully-qualified-class
| `[` type | type[]
| `(` arg-types `)` ret-type | method type

ä½¿ç”¨ `java -h . HelloNative.java` å‘½ä»¤ç”Ÿæˆçš„ C/C++ å¤´æ–‡ä»¶å‚è€ƒï¼š

```cpp
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class NM_HelloNative */

#ifndef _Included_NM_HelloNative
#define _Included_NM_HelloNative
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     NM_HelloNative
 * Method:    nativeHello
 * Signature: (Ljava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_NM_HelloNative_nativeHello
  (JNIEnv *, jclass, jstring);

#ifdef __cplusplus
}
#endif
#endif
```

ä½¿ç”¨ C++ è¯­è¨€å®ç° `Hello()` JNI æ–¹æ³•ï¼š

```cpp
#include <cstdlib>
#include <cstdio>
#include <iostream>
#include "NM_HelloNative.h"

using namespace std;

JNIEXPORT jstring JNICALL Java_NM_HelloNative_nativeHello
    (JNIEnv * jni, jclass cls, jstring name) {
    jboolean iscopy;
    const char * cstr = jni->GetStringUTFChars(name, &iscopy);
    jsize len = jni->GetStringUTFLength(name);

    char buf[100] = {"UNINSTALLIZED"};
    cout << "Name Length: " << len << endl;
    sprintf( buf, "Hello %s [native]", cstr);
    printf("jclass @:%X %s\n", cls, buf);
    
    jni->ReleaseStringUTFChars(name, cstr);
    return jni->NewStringUTF(buf);
}
```

æ³¨æ„ï¼šgcc å’Œ g++ å‘½ä»¤çš„åŒºåˆ«ï¼Œå®ƒä»¬åˆ†åˆ«ä¸º C å’Œ C++ ä»£ç æä¾›é»˜è®¤ç¼–è¯‘é…ç½®ï¼Œä½¿ç”¨ gcc ç¼–è¯‘ C++ ä»£ç å¯èƒ½ä¼šå› ä¸ºç¼ºå¤±é»˜è®¤é…ç½®å¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œä¾‹å¦‚è¯­è¨€è§„èŒƒå®šä¹‰çš„ç¬¦å·æ— å®šä¹‰ç­‰ã€‚Windows ç³»ç»Ÿä¸‹ä½¿ç”¨ MinGW ç¼–è¯‘å·¥å…·ä¼šé‡åˆ° `__int64` è¿™ç§ç±»å‹æ— å®šä¹‰é—®é¢˜ï¼Œå› ä¸ºè¿™æ˜¯ MSVC ç¼–è¯‘å™¨æä¾›çš„å®šä¹‰ï¼ŒJDK Windows ç‰ˆæœ¬ä¸­çš„å¤´æ–‡ä»¶ jni_md.h ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ä¿®æ”¹å®ƒä»¥é€‚ç”¨ GCC ç¼–è¯‘å™¨ï¼š

```cpp
#ifdef __GNUC__
#  ifdef _LP64
typedef long jlong;
#  else
typedef long long jlong;
#  endif
#else
typedef __int64 jlong;
#endif
```

GCC ç¼–è¯‘å™¨ä½¿ç”¨ -E 
```sh
echo __GNUC__ | gcc -E -
```

ç¼–è¯‘ JNI æ‰©å±•æ¨¡å—ï¼Œç”ŸæˆåŠ¨æ€é“¾æ¥åº“ï¼Œå¹¶è¿è¡Œæµ‹è¯•ã€‚å¦‚æœä½¿ç”¨ `System.load()` æ–¹æ³•åŠ è½½åŠ¨æ€åº“ï¼Œå¯ä»¥ä½¿ç”¨ `java.library.path` é€‰é¡¹æ·»åŠ åŠ¨æ€åº“æ‰€åœ¨ç›®å½•ã€‚

```sh
g++ -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/win32" -shared -o NM_HelloNative.dll NM_HelloNative.cpp

java NM.HelloNative
Exception in thread "main" java.lang.UnsatisfiedLinkError: no NM_HelloNative in java.library.path: .
        at java.base/java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429)
        at java.base/java.lang.Runtime.loadLibrary0(Runtime.java:818)
        at java.base/java.lang.System.loadLibrary(System.java:1989)
        at NM.HelloNative.<clinit>(HelloNative.java:6)

java -Djava.library.path=. NM.HelloNative
Name Length: 2
from native: Hello NM [native]
jclass @:50EFF3A8 Hello NM [native]
Name Length: 6
jclass @:50EFF3A8 Hello å§¹å¤î‡¢ [native]
from native: Hello æ±‰è¯­ [native]
```

å¦‚æœæœç´¢ç›®å½•æ²¡æœ‰ç›¸åº”çš„åŠ¨æ€åº“æ–‡ä»¶ï¼Œåˆ™è§¦å‘å¼‚å¸¸ï¼Œå¯ä»¥ä»å¼‚å¸¸ä¿¡æ¯ä¸­è§‚å¯Ÿåˆ°åŠ è½½åŠ¨æ€åº“çš„æµç¨‹ã€‚

Shell è¾“å‡ºçš„å­—ç¬¦ç¼–ç é—®é¢˜ï¼šæºä»£ç ä¸­ UTF ç¼–ç çš„â€œæ±‰è¯­â€é”™è¯¯åœ°æ˜¾ç¤ºä¸ºâ€œå§¹å¤î‡¢â€ã€‚è¿™æ˜¯å› ä¸º UTF å­—ç¬¦é›†é”™è¯¯åœ°ä½œä¸º GBK ç¼–ç è½¬æ¢ä¸º UTF
ç¼–ç ï¼Œå¦‚æœå†è½¬æ¢ä¸€æ¬¡å°±æ˜¯å˜æˆâ€œæ¿®ç‘°î˜³é¡•?â€ã€‚C/C++ ä»£ç ä¸­æ‰“å°çš„ UTF8 å­—ç¬¦ä¸²ä¹±ç ï¼Œåªéœ€è¦è®¾ç½®æ­£ç¡®çš„ shell ç¯å¢ƒå³å¯ä»¥è§£å†³ï¼ŒWindows ä½¿ç”¨ `chcp 65001` å‘½ä»¤è®¾ç½® Unidode æ¨¡å¼ã€‚Linux å¯ä»¥è®¾ç½® `LC_ALL` å’Œ `LC_CTYPE=en_US.UTF-8`ã€‚

Java æºæ–‡ä»¶ä½¿ç”¨ GBK ç¼–ç ï¼Œæ“ä½œç³»ç»Ÿé»˜è®¤ç¯å¢ƒç¼–ç ä¹Ÿä¸º GBKï¼Œé‚£ä¹ˆç¼–è¯‘çš„æ—¶å€™ï¼ŒJVM å°†æŒ‰ç…§ GBK ç¼–ç å°†å­—èŠ‚æ•°ç»„è§£æä¸ºå­—ç¬¦ï¼Œç„¶åå°†å­—ç¬¦è½¬æ¢ä¸º Unicode æ ¼å¼çš„å­—èŠ‚æ•°ç»„å­˜å‚¨ã€‚å½“æ‰“å°å­—ç¬¦ä¸²æ—¶ï¼ŒJVM ä¼šæ£€æµ‹æ“ä½œç³»ç»Ÿæœ¬åœ°çš„è¯­è¨€ç¯å¢ƒï¼ŒUnicode ç¼–ç æ•°æ®ä¼šè½¬æ¢ä¸º GBKï¼Œç„¶åæ“ä½œç³»ç»Ÿå°† GBK æ ¼å¼çš„å†…å®¹æ˜¾ç¤ºå‡ºæ¥ã€‚

æ‰§è¡Œ Java ç¨‹åºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `-Dfile.encoding=UTF-8` å‘Šè¯‰è§£æå™¨ä½¿ç”¨ UTF8 ç¼–ç å¤„ç†æ–‡ä»¶ã€‚

å½“æºç æ–‡ä»¶æœ¬èº«æ˜¯ UTF-8 ç¼–ç ï¼Œå°±éœ€è¦ä½¿ç”¨ `-encoding utf-8` é€šçŸ¥ç¼–è¯‘å™¨ï¼Œå¦åˆ™å°±å¯èƒ½é”™è¯¯åœ°æŒ‰ç…§ç³»ç»Ÿè¯­è¨€è®¾ç½®å°† UTF8 æ•°æ®è¿›è¡Œè½¬ç ï¼Œä»è€Œå¼•èµ·ç¼–ç ä¸ä¸€è‡´å¯¼è‡´ä¹±ç ã€‚


Windows ç³»ç»Ÿä¸Šä½¿ç”¨ MinGW ç¼–è¯‘å™¨ç¼–è¯‘ä»¥ä¸Šç¨‹åºæ—¶ï¼Œè¿™åªæ˜¯ jstring åŸºæœ¬ç±»å‹è½¬æ¢ï¼Œä½¿ç”¨ sprintf è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œå‘ç”Ÿå¥‡æ€ªçš„é—®é¢˜ï¼Œæ— æ³•ä½¿ç”¨ printf æˆ–è€… cout å‘æ ‡å‡†è¾“å‡ºæ–‡ä»¶æ‰“å°å†…å®¹ã€‚ç¨‹åºæœ‰æ—¶æ­£ç¡®è¾“å‡º Java ç¨‹åºçš„è¿è¡Œç»“æ„ï¼Œæœ‰æ—¶æ‰“å° Segmentation fault é€€å‡ºï¼Œæ›´å¤šæƒ…å†µæ˜¯æŒ‚èµ·æ²¡æœ‰ä»»ä½•è¾“å‡ºå¹¶ä¸”å ç”¨å¤§é‡ CPU æ—¶é—´ã€‚è¿™ç§ç”±äºç¼–è¯‘å…¼å®¹é—®é¢˜å¯¼è‡´çš„é”™è¯¯éœ€è¦ä»ç¼–è¯‘å·¥å…·é“¾å±‚é¢è¿›è¡Œå¤„ç†ï¼Œåº”è¯¥ä½¿ç”¨ MinGW ç¼–è¯‘çš„ JDKã€‚ç›®å‰ MSys2 æœªæä¾›æœ‰ JDK å®‰è£…åŒ…ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ Pacman å·¥å…·è¿›è¡Œå®‰è£…ã€‚

ä½¿ç”¨ MSVC ç¼–è¯‘å™¨ï¼Œéœ€è¦æ ¹æ®æ‰€å®‰è£…çš„ JDK å¹³å°é€‰æ‹©ç›¸åº”çš„ x86 (32-bit) æˆ–è€… amd64 (64-bit) ç¼–è¯‘ç¯å¢ƒï¼š

```sh
cmd.exe
%comspec% /k "C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvarsamd64_x86.bat"
%comspec% /k "C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvarsx86_amd64.bat"
bash
cl -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/win32" -LD -EHsc NM_HelloNative.cpp
```

ä¸ºäº†æ–¹ä¾¿æ‰§è¡Œ JNI æ¨¡å—çš„ç¼–è¯‘ä¸æµ‹è¯•è¿è¡Œï¼Œå°†å‘½ä»¤å†™å…¥ buid è„šæœ¬ï¼Œé€šè¿‡è°ƒç”¨è„šæœ¬æ¥å®Œæˆä¸€ç³»åˆ—çš„æ“ä½œï¼š

```sh
#! /usr/bin/env sh
echo ------- JNI compiling -------; 
# g++ -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/win32" -shared -o NM_HelloNative.dll NM_HelloNative.cpp
# %comspec% /k "C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Auxiliary/Build/vcvarsamd64_x86.bat"
cl -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/win32" -LD -EHsc NM_HelloNative.cpp

echo ------- Java compiling -------; 
javas=`find src/main/java`; 
for it in $javas; 
    do if [ $it -nt timestamp ]; 
        then javac -encoding utf-8 -d build/classes/java/main $it; 
    fi; 
done; 
if [ $? = 0 ]; then java -Djava.library.path=. $1 $*; fi
touch timestamp;
```

åªéœ€è¦å…ˆæ‰§è¡Œ MSVC ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬ï¼Œç„¶åå†æ‰§è¡Œ `bash -c './build NM.HelloNative'` å°±å®Œæˆ JNI å’Œ Java ç¨‹åºçš„ç¼–è¯‘ä¸è¿è¡Œã€‚


é»˜è®¤é…ç½®åªåœ¨ JVM ç³»ç»Ÿå´©æºƒæ—¶æ‰“å°æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æ²¡ç”¨å¯ç”¨ Minidump åŠŸèƒ½ï¼Œå› ä¸ºæ­¤å†…å­˜è®°å½•æ–‡ä»¶éå¸¸å¤§ã€‚å®ƒè®°å½•äº† crash æ—¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯ç”¨ä»¥äº‹ååˆ†æ crash åŸå› ã€‚æ—¥å¿—æ–‡ä»¶ä¸­ä¹Ÿè®°å½•ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Java å‘½ä»¤è¿è¡Œç¯å¢ƒã€CPU ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿã€Global flagsã€Heap å†…å­˜ä¿¡æ¯ã€GC çŠ¶æ€ä¿¡æ¯ã€åŠ¨æ€åº“åŠ è½½ï¼Œè¿˜æœ‰è°ƒç”¨æ ˆä¿¡æ¯ã€‚Java frames å°†ä»£ç ä¸ºå¤šç±» (J=compiled Java code, j=interpreted, Vv=VM code)ï¼Œå¯ä»¥ç”¨äºå®šæ€§é—®é¢˜æ‰€åœ¨ä»£ç ä½ç½®ã€‚å…¶ä¸­ï¼ŒåŸç”Ÿæ–¹æ³•å…¥å£åªè®°å½•åˆ° StubRoutines::call_stubã€‚é€šè¿‡ç³»ç»Ÿå´©æºƒæ—¥å¿—ä¸€èˆ¬åªèƒ½å®šä½åˆ°å‘ç”Ÿä½ç½®ï¼Œä½†ä¸èƒ½ç¡®å®šå…·ä½“åŸå› ã€‚

```sh
Java frames: (J=compiled Java code, j=interpreted, Vv=VM code)
j  NM.HelloNative.nativeHello(Ljava/lang/String;)Ljava/lang/String;+0
j  NM.HelloNative.main([Ljava/lang/String;)V+13
v  ~StubRoutines::call_stub
```

| Frame Types | Description |
|-------------|-------------|
| j	| Java code interpreted by the JVM at runtime
| J	| Java code compiled just in time by the JVM
| A	| Java code compiled ahead-of-time, by jaotc
| C	| Native C code from external library, not residing in the JVM
| V	| Native code from library part of the JVM
| v	| Native code genereted by the JVM


å¯ç”¨ä»¥è°ƒè¯•çš„å‘½ä»¤è¡Œå‚æ•°å‚è€ƒï¼š

0. `-Xcheck:jni` ä¸€èˆ¬ JNI é—®é¢˜è¯Šæ–­ï¼›
1. `-verbose:class` æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µï¼›
2. `-verbose:gc` æŸ¥çœ‹è™šæ‹Ÿæœºä¸­å†…å­˜å›æ”¶æƒ…å†µï¼›
3. `-verbose:jni` æŸ¥çœ‹åŸç”Ÿæ–¹æ³•è°ƒç”¨æƒ…å†µï¼›
4. `-XX:+CreateMinidumpOnCrash` æˆ–è€… JDK9+ `-XX:CreateCoredumpOnCrash` å¯ç”¨ Minidumpï¼›

å‚è€ƒ 
Troubleshooting Guide
https://docs.oracle.com/en/java/javase/15/troubleshoot/general-java-troubleshooting.html
Preface Troubleshooting Guide for Java SE 6 with HotSpot VM
https://www.oracle.com/java/technologies/javase/preface.html


# ğŸš© Java Virtual Machine
- [Oracle's OpenJDK](http://openjdk.java.net/)
- [Java Language and Virtual Machine Specifications](https://docs.oracle.com/javase/specs/)
- [Java Platform, Standard Edition 8 Reference Implementations](http://jdk.java.net/java-se-ri/8-MR3)
- [JVMå‚æ•°é…ç½®&&å‘½ä»¤å·¥å…·](https://cloud.tencent.com/developer/article/1512211)
- [JVMç³»åˆ—ä¸‰:JVMå‚æ•°è®¾ç½®ã€åˆ†æ](https://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html)
- [ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¯»ä¹¦ç¬”è®°](https://www.jianshu.com/p/355ae3bcec41)
- [ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¯»ä¹¦ç¬”è®° Class ç±»æ–‡ä»¶åŠ è½½](https://www.jianshu.com/p/4ed041086846)
- [æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºï¼ˆå…¨ç« èŠ‚å®Œæ•´ï¼‰](https://blog.csdn.net/TJtulong/article/details/89598598)
- [æ·±å…¥ç†è§£JVMï¼ˆâ‘¢ï¼‰JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ](https://cnblogs.com/jimoer/p/12549269.html)
- [æ·±å…¥ç†è§£JVMï¼ˆâ‘¢ï¼‰Javaçš„æ¨¡å—åŒ–](https://www.cnblogs.com/jimoer/p/13216782.html)
- [ä¸€æ–‡çœ‹æ‡‚åˆ†å¸ƒå¼äº‹åŠ¡](https://www.cnblogs.com/jimoer/p/12113286.html)
- [Core Java I Fundamentals & II Advanced Topics](https://horstmann.com/corejava/index.html)

æŒ‰ç…§ Java virtual machine (VM) æ–‡æ¡£æ‰€è¿°ï¼ŒJVM æœ‰ä¸¤ç§å®ç°å½¢å¼:

åœ¨å®¢æˆ·åº”ç”¨ç¨‹åºå¹³å°ä¸Šï¼ŒJDK é™„å¸¦çš„æ˜¯ Java HotSpot Client VM (client VM)ï¼Œç›®æ ‡æ˜¯å¿«é€Ÿå¯åŠ¨ã€é™ä½å†…å­˜å ç”¨ï¼Œå¯åŠ¨ç¨‹åºæ—¶ä½¿ç”¨ -client å‘½ä»¤è¡Œå‚æ•°ã€‚

åœ¨æ‰€æœ‰å¹³å°ä¸Š JDK éƒ½é™„å¸¦ Java HotSpot Server VM (server VM) è™šæ‹Ÿæœºï¼Œè®¾è®¡ç›®æ ‡æ˜¯æœ€å¤§åŒ–å®ç°é«˜æ•ˆæ‰§è¡Œåº”ç”¨ï¼Œå¯åŠ¨ç¨‹åºæ—¶ä½¿ç”¨ -server å‘½ä»¤è¡Œå‚æ•°ã€‚

é«˜ç‰ˆæœ¬çš„ 64 ä½ JVM åªæœ‰ Server æ¨¡å¼ï¼ŒJava çš„å‘å±•æ–¹å‘ä¹Ÿæ˜¯é‡ç‚¹å‘å±•å¤§å†…å­˜çš„ Server æ¨¡å¼ã€‚

ä½œä¸ºä¸€ä¸ªå‚ç…§ï¼ŒV8 å¼•æ“åˆ™å®Œå…¨ä¸åŒï¼Œå› ä¸º V8 ä¸º Chrome æµè§ˆå™¨æœåŠ¡ï¼Œå‘å±•æ–¹å‘æ˜¯å°å†…å­˜è·¯çº¿ã€‚ä¸è®ºæ˜¯ Node.jsï¼Œè¿˜æ˜¯ Denoï¼Œä½œä¸ºä¸€ä¸ªæœåŠ¡ç«¯ JS è¿è¡Œç¯å¢ƒï¼Œéƒ½æ˜¯æ¨èå¼€å‘è€…æ ¹æ® CPU æ•°é‡å¼€å¯å¤šä¸ªè¿›ç¨‹ã€‚V8 æ¯ä¸ªæ–°ç‰ˆæœ¬é™¤äº†å¯¹æœ€æ–° es ç‰¹æ€§çš„æ”¯æŒï¼Œä»¥åŠæ€§èƒ½ä¼˜åŒ–å¤–ï¼Œå¦ä¸€ä¸ªä¼˜åŒ–æ–¹å‘å°±æ˜¯å‡å°‘å†…å­˜å ç”¨ï¼Œè¿˜æœ‰å°±æ˜¯å‡å°‘ç”µé‡æ¶ˆè€—ã€‚

JVM çš„ä¼˜åŒ–æ–¹å‘æ˜¯ Server ç«¯ï¼Œè€Œ V8 åˆ™æ˜¯ PC ç«¯ï¼Œéšç€ç§»åŠ¨ç«¯çš„å…´èµ· V8 çš„ä¼˜åŒ–æ–¹å‘åˆå¤šäº†ç”µé‡æ¶ˆè€—ã€‚2018 å¹´å¼€å§‹çš„ V8 Lite é¡¹ç›®ï¼Œé€šè¿‡ç‰ºç‰²æ€§èƒ½å‡å°‘äº† 22%-32% çš„å†…å­˜å ç”¨ã€‚

Java è™šæ‹Ÿæœºè§„èŒƒæœ‰å¤šç§å®ç°ï¼Œå…¶ä¸­ HotSpot VM æ˜¯ Oracle JDK å’Œ Open JDK ä¸­æ‰€å¸¦çš„è™šæ‹Ÿæœºï¼Œä¹Ÿæ˜¯ç›®å‰ä½¿ç”¨èŒƒå›´æœ€å¹¿çš„ Java è™šæ‹Ÿæœºã€‚OpenJDK ä½œä¸ºå¼€æºçš„è½¯ä»¶æŠ€æœ¯ï¼Œå·²ç»æ™®åŠä½¿ç”¨ã€‚

Google Android Dalvik VM ä¸èƒ½ç§°ä½œæ­£ç»Ÿçš„ Java è™šæ‹Ÿæœºï¼Œå®ƒæ²¡æœ‰éµå¾ª Java è™šæ‹Ÿæœºè§„èŒƒï¼Œä¸èƒ½ç›´æ¥æ‰§è¡Œ Java çš„ Class æ–‡ä»¶ï¼Œä½¿ç”¨çš„æ˜¯å¯„å­˜å™¨æ¶æ„è€Œä¸æ˜¯ JVM ä¸­å¸¸è§çš„æ ˆç»“æ„ã€‚ä½†æ˜¯å®ƒä¸ Java åˆæœ‰åƒä¸ä¸‡ç¼•çš„è”ç³»ï¼Œå®ƒæ‰§è¡Œçš„ dex ï¼ˆDalvik Executableï¼‰æ–‡ä»¶å¯ä»¥ç”± Class æ–‡ä»¶è½¬åŒ–è€Œæ¥ï¼Œä½¿ç”¨ Java è¯­æ³•ç¼–å†™åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¤§éƒ¨åˆ†çš„ Java API ç­‰ã€‚

åœ¨ Java å‘å±•ä¹‹åˆï¼Œè®¾è®¡è€…å°±æ›¾è€ƒè™‘è¿‡å¹¶å®ç°äº†è®©å…¶ä»–è¯­è¨€è¿è¡Œåœ¨ Java è™šæ‹Ÿæœºä¹‹ä¸Šçš„å¯èƒ½ï¼Œå‘å¸ƒè§„èŒƒæ–‡æ¡£ä¹Ÿæ˜¯æ‹†åˆ†æˆ Java è¯­è¨€è§„èŒƒå’Œ Java è™šæ‹Ÿæœºè§„èŒƒä¸¤éƒ¨åˆ†ã€‚æ—¶è‡³ä»Šæ—¥ï¼Œå•†ä¸šå’Œå¼€æºæœºæ„å·²ç»åœ¨ Java è¯­è¨€ä¹‹å¤–å‘å±•å‡ºä¸€å¤§æ‰¹åœ¨ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„è¯­è¨€ï¼Œå¦‚ Groovyã€JRubyã€Scala ç­‰ã€‚

ä¸ç®¡ä»€ä¹ˆè¯­è¨€ï¼Œåªè¦æŒ‰ JVM è§„èŒƒå®ç° classï¼ŒJVM å°±å¯ä»¥è§£æå¹¶è¿è¡Œå®ƒã€‚å®ç°è¯­è¨€æ— å…³æ€§çš„åŸºç¡€ä»ç„¶æ˜¯è™šæ‹Ÿæœºå’Œå­—èŠ‚ç å­˜å‚¨æ ¼å¼è§„èŒƒï¼ŒJava è™šæ‹Ÿæœºè§„èŒƒé™¤äº†å®šä¹‰ Class æ–‡ä»¶çš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ï¼Œè¿˜å®šä¹‰äº†å­—èŠ‚ç æŒ‡ä»¤é›†ã€‚ç†è®ºä¸Šè®²ï¼Œä»»ä¸€é—¨åŠŸèƒ½æ€§è¯­è¨€éƒ½å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªèƒ½è¢« Java è™šæ‹Ÿæœºæ‰€æ¥å—çš„æœ‰æ•ˆçš„ Class æ–‡ä»¶ã€‚

å¯ä»¥å°† JVM ç†è§£ä¸ºä¸€å°å®ç°äº†é«˜çº§æ±‡ç¼–è¯­è¨€çš„æœºå™¨ï¼Œè€Œä¸”è¿™ç§é«˜çº§æ±‡ç¼–è¯­è¨€å…·æœ‰ OOP ç±»å¯¹è±¡å°è£…çš„æ¦‚å¿µï¼ŒçœŸçš„éå¸¸é«˜çº§ã€‚

The JavaÂ® Virtual Machine Specification 8 æ–‡æ¡£æœ‰ 7 ä¸ªç« èŠ‚ï¼Œåˆ†åˆ«è®²è§£äº† JVM å„ä¸ªå±‚é¢çš„å†…å®¹ï¼š

- [1. Introduction](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-1.html)
- [2. The Structure of the Java Virtual Machine](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html)
- [3. Compiling for the Java Virtual Machine](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-3.html)
- [4. The class File Format](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html)
- [5. Loading, Linking, and Initializing](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html)
- [6. The Java Virtual Machine Instruction Set](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html)
- [7. Opcode Mnemonics by Opcode](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-7.html)

å‰é¢ 5 ç« ï¼Œé™¤äº†å¼€å§‹ä½œäº†ä¸€ä¸ªä»‹ç»ï¼Œå…¶å®ƒåŸºæœ¬åœ¨è®² JVM åŸºæœ¬åŸç†å’Œç»“æ„ï¼ŒJVM ç¼–è¯‘åŸç†ï¼Œè¿˜æœ‰ JVM å¼•å¯¼ï¼ŒJava å­—èŠ‚ç æ–‡ä»¶çš„ç»“æ„å’Œç±»çš„åŠ è½½æµç¨‹ï¼Œè¿™äº›éƒ½æ˜¯éå¸¸å®ç”¨çš„æŠ€æœ¯ï¼Œæœ€åé¢ä¸¤ç« ä¸»è¦æ˜¯å­—èŠ‚ç æŒ‡ä»¤çš„å‚è€ƒæ–‡æ¡£ã€‚

æ¢ç§˜ JVM æœ€å¥½çš„æ–¹æ³•å°±æ˜¯ä¸‹è½½å¼€æºçš„ JDK ç¼–è¯‘è¿è¡Œï¼Œä½¿ç”¨ GDB è°ƒè¯•åŸä»£ç æ˜¯æœ€ç›´æ¥çš„å­¦ä¹ åŠæ³•ã€‚å¯ä»¥åœ¨ OpenJDK å®˜ç½‘ä¸‹è½½é…å¥—çš„ The official Reference Implementations for Java SE 8 æºä»£ç ã€‚


**JMM** - Java Memory Modelï¼ŒJava å†…å­˜æ¨¡å‹ç”¨æ˜Œæ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„å¹³å°è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æŠ½è±¡æ¨¡å¼ã€‚JMM å®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼Œçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨**ä¸»å†…å­˜** main memory ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„**æœ¬åœ°å†…å­˜** local memoryï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»/å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚

Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸï¼Œä¸»è¦åˆ†æˆ**çº¿ç¨‹éš”ç¦»æ•°æ®åŒº**å’Œ**çº¿ç¨‹å…±äº«æ•°æ®åŒº**ä¸¤éƒ¨åˆ†ï¼Œè¿™äº›åŒºåŸŸæœ‰å„è‡ªçš„ç”¨é€”ï¼Œä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶æœºï¼Œæœ‰çš„åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œä¸€ç›´å­˜åœ¨ï¼Œæœ‰äº›åŒºåŸŸåˆ™æ˜¯ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„ç©·çš„å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ã€‚

![Java è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ](https://img2020.cnblogs.com/blog/772743/202003/772743-20200322230955320-675886480.png)

JVM è¿è¡Œæ—¶çº¿ç¨‹å…±äº«æ•°æ®åŒºåŸŸï¼š

- ç¨‹åºè®¡æ•°å™¨ Program Counter Register

	ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ç”±äº Java è™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹è½®æµåˆ‡æ¢ã€åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨ï¼ˆå¯¹äºå¤šæ ¸å¤„ç†å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå†…æ ¸ï¼‰éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚å› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚

	å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ª Java æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„é¢è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼›

	å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³• Native Methodï¼Œè¿™ä¸ªæŠ€æœ¯å™¨å€¼åˆ™åº”ä¸ºç©º Undefinedã€‚

- JVM è™šæ‹Ÿæœºæ ˆ Java Virtual Machine Stack

	ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼ŒJava è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼ŒJava è™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§ Stack Frame ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæ¯•çš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆé“å‡ºæ ˆçš„è¿‡ç¨‹ã€‚

	å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§ Java è™šæ‹ŸæœºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚ booleanã€byteã€charã€shortã€intã€floatã€longã€doubleã€reference å’Œ returnAddress ç±»å‹ã€‚å…¶ä¸­å¯¹è±¡å¼•ç”¨å¹¶ä¸ç­‰åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–è€…å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ã€‚è¿”å›åœ°å€ returnAddress æŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚

	è¿™äº›æ•°æ®ç±»å‹åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­å­˜å‚¨ç©ºé—´ä»¥å±€éƒ¨å˜é‡æ§½ Slot æ¥è¡¨ç¤ºï¼Œå…¶ä¸­ 64bit çš„ long å’Œ double ç±»å‹çš„æ•°æ®ä¼šå ç”¨ä¸¤ä¸ªå˜é‡æ§½ï¼Œå…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨ä¸€ä¸ªã€‚è€Œè™šæ‹ŸæœºçœŸæ­£ä½¿ç”¨å¤šå¤§çš„å†…å­˜ç©ºé—´æ¥å®ç°ä¸€ä¸ªå˜é‡æ§½ï¼Œæ˜¯å®Œå…¨ç”±å…·ä½“çš„è™šæ‹Ÿæœºå®ç°è‡ªè¡Œå†³å®šçš„ï¼Œè­¬å¦‚æŒ‰ç…§ 1 ä¸ªå˜é‡æ§½å ç”¨ 32 ä¸ªæ¯”ç‰¹ã€64ä¸ªæ¯”ç‰¹ï¼Œæˆ–è€…æ›´å¤šã€‚

	åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¯¹è¿™ä¸ªå†…å­˜åŒºåŸŸè§„å®šäº†ä¸¤ç±»ä¸€æ¬¡çŠ¶å†µï¼š

	- å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡º StackOverflowError å¼‚å¸¸ï¼›
	- å¦‚æœJavaè™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå½“æ ˆæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡ºoutofMemoryErrorå¼‚å¸¸ã€‚

- æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stacks

	ä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼ŒåŒºåˆ«åœ¨äºè™šæ‹Ÿæœºæ ˆæ˜¯è™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³•ä¹Ÿå°±æ˜¯å­—èŠ‚ç æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºæ ˆä½¿ç”¨åˆ°çš„æœ¬åœ°æ–¹æ³•æœåŠ¡ï¼ŒHotSpot è™šæ‹Ÿæœºç›´æ¥æŠŠæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€äº†ã€‚å¹¶ä¸”ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåœ¨æ ˆæ·±åº¦ç§»é™¤æˆ–è€…æ ˆæ‰©å±•å¤±è´¥æ—¶åˆ†åˆ«æŠ›å‡º StackOverflowError å’Œ OutOfMemoryError å¼‚å¸¸ã€‚

çº¿ç¨‹å…±äº«æ•°æ®åŒºéƒ¨åˆ†ï¼š

- Java Heap

	Java å †æ˜¯è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œå¹¶ä¸”æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€ä¸ªå—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼ŒJava ä¸–ç•Œé‡Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚

	å¦‚æœä»åˆ†é…å†…å­˜çš„è§’åº¦çœ‹ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«çš„ Java å †ä¸­å¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒº Thread Local Allocation Buffer ä»¥æå‡å¯¹è±¡åˆ†é…æ—¶çš„æ•ˆç‡ã€‚æ ¹æ® Java è™šæ‹Ÿæœºè§„èŒƒï¼ŒJava å¯¹å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚æœ‰äº›æƒ…å†µï¼Œä¾‹å¦‚å¤„ç†å¤§å¯¹è±¡ï¼Œå…¸å‹çš„æ•°ç»„å¯¹è±¡ï¼Œå¤šæ•°è™šæ‹Ÿæœºå®ç°è€ƒè™‘åˆ°å®ç°ç®€å•ï¼Œå­˜å‚¨é«˜æ•ˆç­‰å› ç´ ï¼Œå¾ˆå¯èƒ½ä¼šè¦æ±‚è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚

	Java å †æ—¢å¯ä»¥è¢«å®ç°æˆå›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¿‡å½“å‰ä¸»æµçš„ Java è™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§å¯æ‰©å±•æ¥å®ç°çš„ï¼Œé€šè¿‡å‚æ•°æ‰§è¡Œå‚æ•° -Xmn å’Œ -Xns è®¾å®šã€‚å¦‚æœåœ¨ Java å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚

- Method Area

	æ–¹æ³•åŒºä¸ Java å †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚

	è¯´åˆ°æ–¹æ³•åŒºï¼Œä¸å¾—ä¸æä¸€äº›**æ°¸ä¹…ä»£** Permanent Generation è¿™ä¸ªæ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨ JDK 8 ä»¥å‰ï¼Œè®¸å¤š Java ç¨‹åºå‘˜éƒ½ä¹ æƒ¯åœ¨ HotSpot è™šæ‹Ÿæœºä¸Šå¼€å‘ï¼Œéƒ¨ç½²ç¨‹åºï¼Œéƒ½æ›´æ„¿æ„æŠŠæ–¹æ³•åŒºç§°ä¸º Permanent Generationï¼Œæˆ–è€…å°†ä¸¤è€…æ··ä¸ºä¸€è°ˆã€‚ä½†ä¸¤è€…æ˜¯ä¸ç­‰ä»·çš„ï¼Œå› ä¸º HotSpot è™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿé€‰æ‹©æŠŠæ”¶é›†å™¨çš„åˆ†ä»£è®¾è®¡æ‰©å±•è‡³æ–¹æ³•åŒºï¼Œæ‰€ä»¥ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºã€‚è¿™æ ·ä½¿å¾—åƒåœ¾æ”¶é›†å™¨èƒ½å¤Ÿåƒç®¡ç† Java å †ä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜ï¼Œæ°¸ä¹…ä»£æ˜¯ JDK 8 ä¹‹å‰çš„ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„æœºåˆ¶ï¼Œå…¶ä»–è™šæ‹Ÿæœºå¹¶ä¸å­˜åœ¨è¿™ä¸ªæ¦‚å¿µï¼Œä¾‹å¦‚ JRockitã€J9ã€‚

	åœ¨åç»­çš„å‘å±•ä¸­ï¼ŒHotSpot å›¢é˜Ÿæ„è¯†åˆ°æ°¸ä¹…ä»£çš„è®¾è®¡å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œæ‰€ä»¥ä¸ºäº† HotSpot è™šæ‹Ÿæœºæœªæ¥æ›´å¥½çš„å‘å±•ï¼Œåœ¨ JDK 6 HotSpot å›¢é˜Ÿå°±æœ‰æ”¾å¼ƒæ°¸ä¹…ä»£ï¼Œé€æ­¥æ”¹ä¸ºé‡‡ç”¨æœ¬åœ°å†…å­˜ Native Memory æ¥å®ç°æ–¹æ³•åŒºçš„è®¡åˆ’ï¼Œåˆ°äº† JDK 7 HotSpot å·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰ç§»å‡ºï¼Œè€Œåˆ°äº† JDK 8ï¼Œç»ˆäºå®Œå…¨åºŸå¼ƒäº†æ°¸ä¹…ä»£çš„æ¦‚å¿µï¼Œæ”¹ç”¨ä¸ JRockitã€J9 ä¸€æ ·åœ¨æœ¬åœ°å†…å­˜ä¸­å®ç°çš„å…ƒç©ºé—´ Meta space æ¥ä»£æ›¿ï¼ŒæŠŠ JDK ä¸­æ°¸ä¹…ä»£è¿˜å‰©ä½™çš„å†…å®¹å…¨éƒ¨ç§»åˆ°å…ƒç©ºé—´ä¸­ï¼Œä¸»è¦æ˜¯ç±»å‹ä¿¡æ¯ã€‚

æ­¤å¤–ï¼Œ**è¿è¡Œæ—¶å¸¸é‡æ± ** Run-Time Constant Pool æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨ï¼ŒClass æ–‡ä»¶ä¸­é™¤äº†åˆç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± è¡¨ Constant Pool Tableï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åæ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡ä¸­ã€‚

è¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äº Class æ–‡ä»¶å¸¸é‡æ± çš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å…·å¤‡åŠ¨æ€æ€§ï¼ŒJava è¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰ç¼–è¯‘æœŸæ‰èƒ½äº§ç”Ÿï¼Œè¿è¡ŒæœŸé—´ä¹Ÿå¯ä»¥å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¾¿æ˜¯ String ç±»çš„ intern() æ–¹æ³•ã€‚

è¿è¡Œæ—¶å¸¸é‡æ± æ— æ³•ç”³è¯·åˆ°å†…å­˜æ—¶ä¹Ÿæ˜¯ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚

å¦å¤–ï¼Œ**ç›´æ¥å†…å­˜** Direct Memory è¿™ä¸€æ¦‚å¿µå¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ OutOfMenmoryError å¼‚å¸¸å‡ºç°ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯è¦ç†Ÿæ‚‰çš„ã€‚

åœ¨é…ç½®è™šæ‹Ÿæœºå†…å­˜çš„æ—¶å€™ï¼Œé™¤äº†è¦è€ƒè™‘æœ¬æœºçš„ç‰©ç†å†…å­˜å¤–ï¼Œè¿˜éœ€è¦å°†ç›´æ¥å†…å­˜è€ƒè™‘åˆ°ã€‚ç»å¸¸é‡åˆ°æœ‰äº›å¼€å‘è€…åœ¨è®¾ç½®å†…å­˜æ—¶å¿½ç•¥äº†ç›´æ¥å†…å­˜ï¼Œä½¿å¾—å„ä¸ªå†…å­˜åŒºåŸŸæ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶ï¼ˆåŒ…æ‹¬ç‰©ç†çš„å’Œæ“ä½œç³»ç»Ÿçº§çš„é™åˆ¶ï¼‰ï¼Œä»è€Œå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç° OutOfMenoryError å¼‚å¸¸ã€‚


åœ¨ JDK 1.4 ä¸­æ–°åŠ å…¥äº† NIOï¼ˆNew Input/Outputï¼‰ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ Channel ä¸ç¼“å†²åŒº Buffer çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †é‡Œé¢çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚

JDK 9 å¼•å…¥æ¨¡å—åŒ–ç³»ç»Ÿ Java Platform Module System æ˜¯ä¸€æ¬¡é‡è¦å‡çº§ï¼Œé™¤äº†åƒä¹‹å‰ JAR åŒ…é‚£æ ·å……å½“ä»£ç çš„å®¹å™¨ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬ï¼š

- ä¾èµ–å…¶ä»–æ¨¡å—çš„åˆ—è¡¨ã€‚
- å¯¼å‡ºçš„åŒ…åˆ—è¡¨ï¼Œå³å…¶ä»–æ¨¡å—å¯ä»¥ä½¿ç”¨çš„åˆ—è¡¨ã€‚
- å¼€æ”¾çš„åŒ…åˆ—è¡¨ï¼Œå³å…¶ä»–æ¨¡å—å¯åå°„è®¿é—®æ¨¡å—çš„åˆ—è¡¨ã€‚
- ä½¿ç”¨çš„æœåŠ¡åˆ—è¡¨ã€‚
- æä¾›æœåŠ¡çš„å®ç°åˆ—è¡¨ã€‚
- æ¨¡å—åŒ–ç³»ç»Ÿ

å¯é…ç½®çš„å°è£…éš”ç¦»æœºåˆ¶è§£å†³äº†åŸæ¥ç±»è·¯å¾„ä¸Šè·¨æ–‡ä»¶çš„ public ç±»çš„å¯è®¿é—®æ€§çš„é—®é¢˜ã€‚ä½¿ç”¨æ¨¡å—åŒ–ï¼Œæ„å‘³ç€ public å¹¶éæ‰€æœ‰åœ°æ–¹ä»£ç éƒ½å¯ä»¥è®¿é—®ï¼Œæœªå¯¼å‡ºå’Œæœªå¼€æ”¾çš„ç±»æ˜¯ä¸èƒ½å¤Ÿè¢«å¤–éƒ¨ä½¿ç”¨ã€‚

éœ€è¦å…ˆå£°æ˜å¯¼å‡ºåŒ…çš„è·¯å¾„ï¼Œç„¶ååœ¨ä½¿ç”¨æ—¶å¯¼å…¥æ¨¡å—ï¼š

	module example {
	    exports com.demos.test;
	}

	module exampleTwo {
	    requires example;
	}


## âš¡ Java æºä»£ç ç»“æ„

OpenJDK å¼€æºä»£ç ä»¥åŠè§„èŒƒæ–‡æ¡£ä¸‹è½½ï¼š

1. https://hg.openjdk.org/jdk8u/jdk8u60/jdk/
2. https://hg.openjdk.org/jdk8u/jdk8u60/hotspot/
3. https://docs.oracle.com/javase/specs/jvms/se8/html/index.html
4. https://docs.oracle.com/javase/specs/jls/se8/html/index.html

Java æ•´ä¸ªç³»ç»Ÿå®ç°ä¸Šå¤§ä½“å¯ä»¥åˆ’åˆ†ä¸ºä¸‰å—å†…å®¹ï¼š

1. Java Virtural Machine (JVM)
2. Java Development Kit (JDK)
3. Java Runtime Environemt (JRE)

JVM å®ç°ï¼šè™šæ‹Ÿæœºæ˜¯æ•´ä¸ª Java ç³»ç»Ÿçš„åŸºåº•ï¼Œæ²¡æœ‰å®ƒå°±ä¸èƒ½è¿è¡Œ Java ç¨‹åºï¼Œæ›´ä¸èƒ½è·¨å¹³å°ã€‚JVM æºä»£ç å°±æ˜¯æ ¹æ® JVM è§„èŒƒå®ç°ä¸€ä¸ªå¯ä»¥è¿è¡Œ Java å­—èŠ‚ç çš„è™šæ‹Ÿæœºå™¨ã€‚

JRE å³è¿è¡Œæ—¶ç¯å¢ƒï¼Œæ‰€è°“è¿è¡Œå³ç¨‹åºè¿è¡Œæ—¶éœ€è¦çš„ç³»ç»Ÿç¯å¢ƒï¼ŒåŒ…å« JVM ç¯å¢ƒæ”¯æŒï¼ŒåŸºç¡€ç±»å‹åº“æ”¯æŒï¼Œæˆ–è€…æ‰©å±•ç±»å‹åº“çš„æ”¯æŒã€‚

JDK ä½œä¸ºå¼€å‘å·¥å…·åŒ…ï¼Œå®ƒæœ¬èº«åŒ…å« JREã€‚è¿è¡Œæ—¶æ˜¯ä»¥ Java ä»£ç å½¢å¼å®ç°çš„ï¼ŒJRE ä¹Ÿå°±å¯ä»¥çœ‹ä½œæ˜¯ Java è¯­è¨€ç¼–å†™çš„ç”¨äºåˆå§‹åŒ– Java è¿è¡Œæ—¶ç¯å¢ƒçš„ç¨‹åºã€‚å¦å¤– JDK å®‰è£…åŒ…ä¸­åŒ…å«çš„æ¨¡å—åŒ…ï¼šlib/src.zip æ˜¯è¯­è¨€æ¨¡å—å’Œå·¥å…·æ¨¡å—æºä»£ç ï¼Œå’Œ JDK æºä»£ç æœ‰æ–‡ä»¶é‡å ã€‚æ¨¡å—åŒ…ä¸­ jdk.compiler æ¨¡å—æä¾›äº†ä¼ ç»Ÿç¼–è¯‘å™¨å…¥å£ï¼Œcom.sun.tools.javac å’Œ sjavacã€‚

JDK æºä»£ç æœ¬èº«ä¸åŒ…å«ç‹¬ç«‹æ‰“åŒ…çš„ lib/src.zip æ¨¡å—ä»£ç ï¼Œä½†æ˜¯åŒ…å« JRE æºä»£ç ã€‚SDK ä¸»ä½“æºä»£ç å°±æ˜¯æ ¹æ® Java è¯­è¨€è§„èŒƒå®ç° Jaav ç¨‹åºçš„ç¼–è¯‘ï¼ˆç”Ÿæˆå­—èŠ‚ç ï¼‰å’ŒåŠ è½½è¿è¡Œï¼Œæ­¤å¤–è¿˜åŒ…å«äº† Java ç¼–è¯‘å™¨ã€å„ç§å·¥å…·çš„å®ç°æºä»£ç ï¼Œ

åœ¨ç‰ˆæœ¬å†å²ä¸Šï¼ŒJDK 8 å’Œ JDK 9 æ˜¯ä¸¤ä¸ªé‡å¤§çš„æ›´æ–°ï¼Œå…¶æ›´æ–°çš„ç‰¹æ€§åˆ†åˆ«å¤šè¾¾ 56 å’Œ 91 ä¸ªï¼Œç›¸æ¯”ä¸€èˆ¬çš„ç‰ˆæœ¬æ›´æ–°åªæœ‰ 10 ~ 20 ä¸ªå·¦å³ã€‚
https://blogs.oracle.com/java/post/the-arrival-of-java-21

é˜…è¯»æºä»£ç æ—¶ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©ä¸‹è½½ä»£ç åŒ…ï¼Œæ¯”å¦‚ï¼ŒClassLoader ç±»å‹ï¼Œå®ƒåœ¨è¿è¡Œæ—¶ã€JVM æºä»£ç ä¸­éƒ½æœ‰åŒåç±»å‹çš„å®ç°ï¼š

1. jdk-8u60-hotspot/src/share/vm/classfile/classLoader.cpp
2. jdk-8u60/src/share/classes/java/lang/ClassLoader.java
3. jdk-8u60/src/share/native/java/lang/ClassLoader.c

è™½ç„¶ç±»å‹åŒåï¼Œä½†æ˜¯åŠŸèƒ½æ˜¯å®Œå…¨ä¸åŒï¼ŒC++ å®ç°çš„ JVM ç±»åŠ è½½å™¨æ˜¯å°† .class å­—èŠ‚ç åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­è¿è¡Œã€‚è€Œå¦ä¸€æ–¹æ˜¯å°† .class ç­‰ç±»å‹åŠ è½½åˆ° Java è¿è¡Œæ—¶ç¯å¢ƒï¼Œä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚

JDK æºä»£ç ä¸­ share ç›®å½•å­˜æ”¾çš„æ˜¯å¹³å°æ— å…³çš„ä»£ç ï¼ŒåŒ…æ‹¬ JRE æºä»£ç ï¼Œä¹ŸåŒ…å«éƒ¨åˆ† C/C++ Native å®ç°ä»£ç ï¼Œæ¯”å¦‚ `System` æ¨¡å—å°±æ˜¯ä¸€ä¸ª C/C++ å®ç°çš„æ¨¡å—ã€‚

### â˜˜ HashMap tableSizeFor()

ä»¥ä¸‹æ˜¯ JDK 8 å’Œ JDK 14 ä¸¤ä¸ªç‰ˆæœ¬çš„ HashMap å¯¹è±¡çš„å®¹é‡è°ƒæ•´æ–¹æ³•ã€‚è¾“å…¥å‚æ•°æ˜¯å½“å‰ HashMap å®ä¾‹çš„åˆå§‹å®¹é‡ï¼Œè¾“å‡ºæ˜¯ç›®æ ‡è°ƒæ•´å®¹é‡ã€‚

```java
	static final int MAXIMUM_CAPACITY = 1 << 30;
    /**
     * Returns a power of two size for the given target capacity.
     */
    static final int tableSizeFor(int cap) {
        int n = cap - 1;
        n |= n >>> 1;
        n |= n >>> 2;
        n |= n >>> 4;
        n |= n >>> 8;
        n |= n >>> 16;
        return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
    }

    /**
     * Returns a power of two size for the given target capacity.
     */
    static final int tableSizeFor(int cap) {
        int n = -1 >>> Integer.numberOfLeadingZeros(cap - 1);
        return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
    }
    public static int numberOfLeadingZeros(int i) {
        // HD, Figure 5-6
        if (i == 0)
            return 32;
        int n = 1;
        if (i >>> 16 == 0) { n += 16; i <<= 16; }
        if (i >>> 24 == 0) { n +=  8; i <<=  8; }
        if (i >>> 28 == 0) { n +=  4; i <<=  4; }
        if (i >>> 30 == 0) { n +=  2; i <<=  2; }
        n -= i >>> 31;
        return n;
    }
```

Java åŸå§‹ç±»å‹é‡Œæ²¡æœ‰æ— ç¬¦å·ç±»å‹ï¼ŒHash æ¡¶æœ€å¤§å®¹é‡è®¾ç½®ä¸º 2^31ï¼Œæœ€é«˜ä½ä¿ç•™ä½œä¸ºç¬¦å·ä½ã€‚æ²¡æœ‰ä½¿ç”¨ long æ•°æ®ç±»å‹ï¼Œå¯èƒ½æ˜¯æ€§èƒ½ä¸ç©ºé—´ä¸Šçš„ç»¼åˆè€ƒè™‘ã€‚

å½“åˆå§‹åŒ–HashMapæ—¶ï¼Œå¦‚æœæŒ‡å®šäº†åˆå§‹å®¹é‡initialCapacityï¼Œ
å“ˆå¸Œæ¡¶çš„æ•°ç›®å¿…é¡»æ˜¯ 2^n æ¬¡å¹‚ï¼Œå› æ­¤ï¼Œå®ä¾‹åˆå§‹åŒ–æ—¶è¦æŠŠ initialCapacity è½¬åŒ–ä¸ºæŒ‡å®šå€¼çš„æœ€å° 2^n æ¬¡å¹‚æ•°ï¼Œä¾‹å¦‚ initialCapacity = 2ï¼Œé‚£ä¹ˆå°±åŸæ ·è¿”å›ï¼ŒinitialCapacity = 3ï¼Œé‚£ä¹ˆå°±è°ƒæ•´ä¸º 4ã€‚è¿™ä¸ªæ–¹æ³•çš„å·§å¦™å¤„åœ¨äºï¼Œç§»ä½ä¸ä½æˆ–è¿ç®—çš„ç»„åˆã€‚é¦–å…ˆé€šè¿‡æ— ç¬¦å·å³ç§» 1 ä½ï¼Œå†å åŠ åŸå€¼ï¼Œä½¿å¾—æœ€é«˜ä½çš„ 1 å‘ä½ä½æ‰©æ•£ï¼ˆè¿™ä¸ªè¯å¾ˆè´´åˆ‡ï¼‰ï¼Œä¸‹æ¬¡å†ç§»ä½æ—¶å°±å¯ä»¥åŠ å€è·ç¦»ï¼Œå› æ­¤ä½¿ç”¨ 1 2 4 8 16 è¿™æ ·çš„ç§»ä½ï¼Œç›¸å½“æ˜¯äºŒåˆ†æ³•çš„ä¼˜åŒ–å¤„ç†ç®—æ³•ã€‚

è¿™ç§ç®—æ³•çš„ä¸è¶³ä¹‹å¤„åœ¨äºï¼Œå­˜åœ¨å†—ä½™æ“ä½œï¼Œå¦‚æœæŒ‡å®šçš„å®¹é‡è¾ƒå°ï¼Œå®¹é‡ä¸º 9 = 1001ï¼Œåªéœ€è¦æ‰§è¡Œåˆ° `n |= n >>> 2`ï¼Œé‚£ä¹ˆåé¢çš„ä¸‰æ¡æ— ç¬¦å·å³ç§»ä½ï¼ˆ`>>>`ï¼‰éƒ½æ˜¯æ— æ•ˆç”¨çš„æ“ä½œã€‚è¿™ç§æƒ…å†µåœ¨ JDK 11 ä¸­å·²ç»å¾—åˆ°ä¼˜åŒ–ã€‚é€šè¿‡å¼•å…¥ numberOfLeadingZeros æ–¹æ³•æ±‚è§£å‰å¯¼ 0 çš„æ•°é‡æ¥è§£å†³ï¼Œä½†æ˜¯è¿™ç§å¼•ç”¨é¢å¤–å‡½æ•°çš„æ–¹æ³•æœ‰å¤šå¤§æ•ˆç‡æå‡å‘¢ï¼Ÿä»æŒ‡ä»¤å±‚é¢ä¸Šçœ‹ï¼Œé¢å¤–çš„å‡½æ•°éœ€è¦å¢åŠ è°ƒç”¨æˆæœ¬ï¼Œå¹¶ä¸”å‡½æ•°ä½“å†…è¿˜æœ‰å¤šä¸ª if è¯­å¥ã€‚

æ”¹è¿›åçš„æ–¹æ³•ä½¿ç”¨ -1ï¼ˆ 32-bit éƒ½ç½®ä½ï¼‰æŒ‰å‰å¯¼ 0 çš„æ•°é‡ï¼Œè¿›è¡Œæ— ç¬¦å·å³ç§»ï¼Œæœ€ååŠ  1 ä½¿å…¶è¿›ä½ã€‚å‰ç¼€ 0 çš„åˆ¤æ–­ç®—æ³•è¿˜æ˜¯äºŒåˆ†æ³•ï¼Œå¯¹äºä¸€ä¸ª 32-bit æ•´æ•°ï¼Œä¾æ¬¡æŒ‰ 16-bitã€8-bitã€4-bitã€2-bitã€1-bit é€çº§ç»†åˆ†å¤„ç†ã€‚å¯ä»¥æƒ³è±¡ä¸ºä¸€ä¸ªé€çº§ç¼©å°çš„æ•°æ®çª—å£ï¼Œå°†è¦å¤„ç†çš„æ•°æ®ä»å…¨å±€åˆ°æœ€åä¸€ä¸ª bit çš„å¤„ç†è¿‡ç¨‹ã€‚ç®—æ³•è®¾è®¡çš„è¿‡ç¨‹ä¹Ÿå¾ˆå¦™ï¼Œå…ˆåˆ¤æ–­å·¦ä¾§ 16-bit æ˜¯å¦ä¸º 0ï¼Œå¦‚æœæ˜¯å°±äºŒåˆ†å¤„ç†å³ä¾§ 16-bitï¼Œå¦åˆ™ç›´æ¥å¤„ç†å·¦ä¾§ã€‚

æœ€åçš„ `n -= i >>> 31` ç›¸å½“äº `n -= i==2^31? 1 : 0`ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çª—å£é›†èšåˆ°æœ€å 1 bitï¼Œè¾“å…¥æ•°æ® i çš„åŸå§‹å€¼çš„æœ€ä½æˆ–æœ€é«˜ bitã€‚

### â˜˜ equals() & hashCode() ç­‰å€¼åˆ¤æ–­

Java ä¸€èˆ¬æƒ…å†µä¸‹çš„ç­‰å€¼æ¯”è¾ƒæ˜¯å¯¹è±¡å†…å­˜åœ°å€çš„æ¯”è¾ƒï¼Œå¦‚æœåœ°å€ä¸åŒï¼Œä¸¤è€…å°±æ˜¯å¿…ç„¶ä¸ç›¸åŒã€‚

```java
    // jdk-8u60/src/share/classes/java/lang/Object.java
    public boolean equals(Object obj) {
        return (this == obj);
    }
    // jdk-8u60/src/share/classes/java/util/Objects.java
    public static boolean equals(Object a, Object b) {
        return (a == b) || (a != null && a.equals(b));
    }
    public static int hash(Object... values) {
        return Arrays.hashCode(values);
    }

    // jdk-8u60/src/share/classes/java/util/Arrays.java
    public static int hashCode(long a[]) {
        if (a == null)
            return 0;

        int result = 1;
        for (long element : a) {
            int elementHash = (int)(element ^ (element >>> 32));
            result = 31 * result + elementHash;
        }

        return result;
    }
```

Java æ‰“å°å‡ºæ¥çš„å¯¹è±¡ä¿¡æ¯å…¶æ ¼å¼å’Œ JVM è§„èŒƒä¸€è‡´ï¼Œæ–¹æ‹¬å·è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œ@ åé¢è¡¨ç¤º hash codeï¼Œè¿™æ˜¯ä¸€ä¸ª int ç±»å‹æ•°å€¼ï¼Œè€Œä¸æ˜¯å¯¹è±¡å†…å­˜åœ°å€ã€‚Hash code å¯ä»¥ç”¨äºæ ‡ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹äºåŒä¸€ç±»å‹çš„å¯¹è±¡æ¥è¯´ï¼Œå…·æœ‰å”¯ä¸€æ€§ã€‚

ä¸ºä½• hashCode() æ–¹æ³•ä¼šå’Œç­‰å€¼å…³ç³»äº§ç”Ÿè”ç³»å‘¢ï¼ŸåŸå› å¾ˆç›´æ¥ï¼šå‡ºäºæ€§èƒ½è€ƒè™‘ã€‚å¹¶ä¸” `hashCode()` æ–¹æ³•ä¸»è¦æ˜¯ä¸º hash tables ç›¸å…³çš„æ•°æ®ç±»å‹æœåŠ¡ï¼Œå¦‚ `HashSet`ã€`HashMap`ã€`LinkedHashMap` ç­‰åŸºäºå“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„ã€‚

Java é›†åˆç±»å‹æ˜¯è”ç³»éå¸¸å¯†åˆ‡çš„å¸¸ç”¨æ•°æ®ç±»å‹ï¼Œå®ƒä»¬ä¹‹é—´çš„è”ç³»å¯ä»¥å‚è€ƒ Thinking in Java - 13. Holding Your Objects - Summary å±•ç¤ºçš„åˆ†ç±»å›¾ Simple Container Taxonomyï¼š

![Simple Container Taxonomy](https://www.linuxtopia.org/online_books/programming_books/thinking_in_java/TIJ325.png)

ä½¿ç”¨ä»¥ä¸‹ç¨‹åºæµ‹è¯• hash ç çš„ç”Ÿæˆï¼Œæ¯æ¬¡è¿è¡Œæ—¶ï¼Œhash ç æ€»æ˜¯æŒ‰ç®—æ³•ç”Ÿæˆçš„åºåˆ—ä¾æ¬¡åˆ†é…ç»™éœ€è¦ä½¿ç”¨ hash ç çš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œç¨‹åºæ¯æ¬¡è¿è¡Œï¼Œè¾“å‡º a å’Œ b å˜é‡å¯¹åº”çš„ hash ç æ€»æ˜¯å›ºå®šå€¼ã€‚å°†å®ƒä»¬çš„è¾“å‡ºé¡ºåºè°ƒæ¢ä¸€ä¸‹ï¼Œé‚£ä¹ˆé¦–å…ˆç”Ÿæˆçš„ hash ç å°±ä¼šåˆ†é…ç»™å˜é‡ bï¼Œè€Œä¸æ˜¯ aï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨éœ€è¦ä½¿ç”¨ hash ç çš„æ–¹æ³•è§¦å‘å…¶ç”Ÿæˆï¼š

```java
public class HashCode {
    public static void main(String[] args) {
        int[] a = new int[1];
        int[] b = new int[1];
        // b.hashCode(); // hash code generatiion
        System.out.format("a = %s\nb = %s\n", a, b);
    }
}
// ------- Java output -------
// a = [I@6f496d9f
// b = [I@723279cf
```

å½“ç”¨æˆ·ç±»å‹æœ‰éœ€è¦ï¼Œå¯ä»¥é‡æ–°å®ç° `equals()` æ–¹æ³•çš„é€»è¾‘ï¼Œæ¯”å¦‚ String ç±»å‹ï¼Œå®ƒå°±é€šè¿‡é‡æ–°å®ç°å…¶é€»è¾‘ï¼Œå…ˆåˆ¤æ–­åœ°å€ã€å†åˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦ï¼Œæœ€åå†æ¯”è¾ƒå„ä¸ªå­—ç¬¦ï¼š

```java
    // jdk-8u60/src/share/classes/java/lang/String.java
    public int hashCode() {
        int h = hash;
        if (h == 0 && value.length > 0) {
            char val[] = value;

            for (int i = 0; i < value.length; i++) {
                h = 31 * h + val[i];
            }
            hash = h;
        }
        return h;
    }
    public boolean equals(Object anObject) {
        if (this == anObject) {
            return true;
        }
        if (anObject instanceof String) {
            String anotherString = (String)anObject;
            int n = value.length;
            if (n == anotherString.value.length) {
                char v1[] = value;
                char v2[] = anotherString.value;
                int i = 0;
                while (n-- != 0) {
                    if (v1[i] != v2[i])
                        return false;
                    i++;
                }
                return true;
            }
        }
        return false;
    }
```

ä» String å¯¹è±¡å®ç°çš„ `equals` æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒç±»å‹å®ç°çš„ç­‰å€¼åˆ¤æ–­é€»è¾‘æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯ç®—æ³•ä¸Šå…·æœ‰ä¸åŒçš„æ—¶é—´å¤æ‚åº¦ã€‚å½“å¯¹è±¡ä¸ hash table æ•°æ®ç»“æ„ç»“åˆä½¿ç”¨æ—¶ï¼Œé€šè¿‡ç»™å¯¹è±¡å†…å­˜ä¸­å¼•å…¥ä¸€ä¸ª hash codeï¼ˆéœ€è¦ä½¿ç”¨æ—¶ç”Ÿæˆï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥å…ˆé€šè¿‡æ¯”è¾ƒ hash code çš„ä¸€è‡´æ€§æ¥ç¡®å®šå¯¹è±¡ç›¸ç­‰ï¼Œå¦‚æœ hash code ç¡®å®ä¸€è‡´å†è°ƒç”¨å¯¹è±¡çš„ `equals` æ–¹æ³•ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæµ‹è¯•ç¨‹åºï¼Œä½¿ç”¨äº† HashSet æ•°æ®ç»“æ„ï¼Œé›†åˆçš„ç‰¹æ€§ï¼šå…ƒç´ å…·æœ‰å”¯ä¸€æ€§ä¸é‡å¤ã€‚è‡ªå®šä¹‰ç±»å‹ Pair ç­‰å€¼é€»è¾‘ï¼šä»»æ„å®ä¾‹ x y å±æ€§ä½¿ç”¨ç›¸åŒçš„ä¸€ç»„æ•°å€¼ï¼Œå³ä¸ºç›¸ç­‰ã€‚ç¨‹åºè¿è¡Œè¾“å‡ºå†…å®¹å‚è€ƒï¼Œå¯ä»¥çœ‹åˆ°ï¼šå“ˆå¸Œé›†åˆæ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ æ—¶å‘ç°ä¸ç¬¬ä¸€ä¸ªå…ƒç´ å…·æœ‰ç›¸åŒçš„ hash code ç„¶åå†è°ƒç”¨ equals æ–¹æ³•ç¡®è®¤ï¼š

```sh
	Pair.hashCode(): 3
	Pair.hashCode(): 2
	Pair.hashCode(): 3
	Pair.equals(<Pair x=[1] y=[2] />)
	[<Pair x=[1] y=[3] />, <Pair x=[1] y=[2] />]
```

```java
import java.util.HashSet;
import java.lang.Override;

class Pair {
    public int x = 0;
    public int y = 0;
    Pair(int x, int y) { this.x = x; this.y = y; }
    public String toString() { 
        return String.format("<Pair x=[%d] y=[%d] />", x, y); 
    }
    @Override
    public boolean equals(Object it) {
        if (it instanceof Pair) {
            System.out.format("Pair.equals(%s)\n", (Pair)it);
            return ((Pair)it).x == x && ((Pair)it).y == y ||
                 ((Pair)it).y == x && ((Pair)it).x == y;
        }
        return false;
    }
    @Override
    public int hashCode() {
        System.out.format("Pair.hashCode(): %X\n", x ^ y);
        return x ^ y;
    }
}

public class HashCode {
    public static void main(String[] args) {
        HashSet<Pair> hs = new HashSet<>();
        hs.add(new Pair(1, 2));
        hs.add(new Pair(1, 3));
        hs.add(new Pair(2, 1));
        System.out.println(hs);
    }
}
```

PSï¼šXor (eXclusive OR) â€œå¼‚æˆ–â€é€»è¾‘è¿ç®—ï¼Œä¹Ÿå«åŠåŠ è¿ç®—ï¼Œå…¶è¿ç®—æ³•åˆ™ç›¸å½“äºä¸å¸¦è¿›ä½çš„äºŒè¿›åˆ¶åŠ æ³•ï¼Œéå¸¸é€‚åˆ Pair ç­‰å€¼åˆ¤æ–­è¿™ç§æƒ…å½¢ï¼Œå®ƒå¯ä»¥å°†ä¸¤ä¸ªæ•°å€¼åŒ…å«çš„ä¿¡æ¯â€œæ‰“åŒ…â€ä¸ºä¸€ä¸ªæ•°ï¼Œå¹¶ä¸”æ­¤å€¼å¯ä»¥å† Xor åŸå§‹æ•°æ®è¿˜åŸå‡ºå¦ä¸€ä¸ªè¾“å…¥æ•°å€¼ï¼Œè¿™ä¸€ç‰¹æ€§ä½¿å¾—å®ƒå¹¿æ³›ç”¨äºæ•°æ®åŠ å¯†ã€å¤‡ä»½ã€‚

å‚è€ƒ That XOR Trickï¼Œæœ‰è¿™æ ·ä¸€é“é¢˜ï¼šä¸€ä¸ªæ•°ç»„åŒ…å« n-1 ä¸ªå€¼ï¼Œå³å€¼èŒƒå›´æ˜¯ [1, n]ä¸”æ²¡æœ‰é‡å¤ï¼Œè¯·æ‰¾å‡ºç¼ºå°‘çš„é‚£ä¸ªæ•°å­—ã€‚è§£å†³æ–¹æ³•ï¼šå°†æ•°ç»„æ‰€æœ‰å…ƒç´ ä¸ 1 ~ n è¿™äº›å€¼è¿›è¡Œ Xor è¿ç®—ï¼Œå…¶ç»“æœå°±æ˜¯ç¼ºå°‘çš„é‚£ä¸€ä¸ªæ•°ã€‚å› ä¸ºè¿™ç§æ–¹æ³•ä¸­æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šå‡ºç°ä¸¤æ¬¡ï¼Œé™¤äº†ç¼ºå¤±çš„é‚£ä¸€ä¸ªæ•°åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆç›¸åŒçš„å€¼è¿›è¡Œå¼‚æˆ–è¿ç®—å°±ä¼šå¾—åˆ° 0ï¼Œæœ€ç»ˆåªå‰©ä¸‹ç¼ºå°‘çš„é‚£ä¸ªæ•°å­—ã€‚

Hash Table å­—é¢æ„æ€æ˜¯æ•£åˆ—æ•°æ®è¡¨ï¼Œå“ˆå¸Œè¡¨è¿™ç§æ•°æ®ç»“æ„çš„ç‰¹ç‚¹æ˜¯å¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥ï¼Œå…¶ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸ºå¸¸æ•°ã€‚å“ˆå¸Œè¡¨çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª hash å‡½æ•°ï¼Œå³ä¸€ä¸ªæ˜ å°„è¾“å…¥æ•°æ®ä¸å…¶å†…å­˜åœ°å€çš„å‡½æ•°ï¼ˆå‡½æ•°çš„æœ¬è´¨å°±æ˜¯æ˜ å°„ï¼‰ï¼Œ`key --hash()--> address`ï¼Œè¿™å°±æ˜¯è¿™ç§æ•°æ®ç»“æ„é«˜æ•ˆç‡çš„å…³é”®ã€‚

æ¯”å¦‚ï¼Œä»¥ä¸‹æ˜¯ç”¨äºæ¼”ç¤º hash table åŸºæœ¬åŸç†çš„ StringHashTableï¼Œå…¶ä¸­çš„ simpleHash ç›¸å½“ç®€å•ï¼ˆç®€é™‹ï¼‰ï¼Œåªè·å– key é¦–å­—æ¯çš„å€¼å†å– hash table å†…å­˜ç©ºé—´æ¨¡å¾—åˆ° hash å€¼ã€‚åªæä¾›ç®€å•çš„ set å’Œ get æ–¹æ³•ï¼Œä¸å¯¹å“ˆå¸Œå†²çªåšä»»ä½•å¤„ç†ï¼Œåªæ˜¯ç›´æ¥è¦†ç›–æ—§å€¼ï¼š

```java
import java.util.List;
import java.util.Arrays;
import java.util.stream.Collectors;

public class StringHashTable {
    int length;
    int[] values;
    String[] keys;
    StringHashTable(int len) {
        length = len;
        values = new int[len];
        keys = new String[len];
    }
    int simpleHash(String key){
        return (int) key.charAt(0) % length;
    }
    boolean set(String key, int value) {
        int id = simpleHash(key);
        boolean old = keys[id] != null;
        values[id] = value;
        keys[id] = key;
        return old;
    }
    int get(String key) {
        return values[simpleHash(key)];
    }
    public static void main(String[] args) {
        StringHashTable sht = new StringHashTable(32);
        sht.set("abc", 123);
        sht.set("xyz", 321);
        sht.set("æ±‰å­—", 678);
        System.out.format("abc ==> %d\n", sht.get("abc"));
        System.out.format("xyz ==> %d\n", sht.get("xyz"));
        System.out.format("æ±‰å­— ==> %d\n", sht.get("æ±‰å­—"));
        System.out.format("values = %s\n keys = %s\n", 
            Arrays.stream(sht.values).mapToObj(String::valueOf).collect(Collectors.joining(", ")), 
            Arrays.asList(sht.keys));
    }
}
```

ä»¥ä¸Šå“ˆå¸Œè¡¨å®ç°è™½ç„¶çš„ç®€å•ï¼Œä½†æ˜¯å®ƒç»å¯¹æ²¡æœ‰å“ˆå¸Œæ´ªæ°´æ”»å‡»é—®é¢˜ :)ã€‚

Java åŸºç¡€ç±»åº“ä¸­çš„ HashMap è®¾è®¡ç»å¯¹ä¸ä¼šè¿™æ ·ç®€å•ï¼ŒHash å‡½æ•°çš„è®¾è®¡åŸåˆ™ï¼š

1. ä¸€è‡´æ€§ï¼šå¦‚æœ `a==b` åˆ™ `hash(a)==hash(b)`ã€‚
2. é«˜æ•ˆæ€§ï¼šè®¡ç®—é«˜æ•ˆä¾¿æ·ï¼ŒO(1)ï¼Œç›¸å½“ç›´æ¥ä½¿ç”¨åŠ¨æ€æ•°ç»„ï¼Œåœ¨é€‚å½“çš„æƒ…å†µä¸‹ resizeã€‚
3. å‡åŒ€æ€§ï¼šå“ˆå¸Œå€¼çš„åˆ†å¸ƒè¶Šå‡åŒ€è¶Šå¥½ï¼Œè¿™å°±æ˜¯å¯¹å–æ¨¡æ³•ä¸­æ¨¡ä¸ºè´¨æ•°çš„åŸå› ã€‚

Hash ç®—æ³•å¯è§†åŒ–æ¼”ç¤ºå‚è€ƒ Data Structure Visualizationsï¼Œå®ƒæä¾›äº†ä»¥ä¸‹ä¸‰ç§ Hash Table çš„å®ç°æ¼”ç¤ºï¼š
https://www.cs.usfca.edu/~galles/visualization/Algorithms.html
1. Open Hash Tables (Closed Addressing)
2. Closed Hash Tables (Open Addressing)
3. Closed Hash Tables, using buckets

æ—§é‡‘å±±å¤§å­¦ç½‘ç«™ä¸Šæä¾›çš„ hash table ç®—æ³•æ¼”ç¤ºåªæ˜¯æ¼”ç¤ºäº† key å¦‚ä½•å­˜å‚¨ï¼Œå®é™…ä½¿ç”¨ä¸­é€šå¸¸éœ€è¦åŒæ—¶ä½¿ç”¨ key å’Œ valueï¼Œé€šè¿‡ key æ“ä½œ valueã€‚å¹¶ä¸”ä½¿ç”¨éå¸¸å°çš„ç©ºé—´æ¼”ç¤ºæ•°æ®æ˜¯å¦‚ä½•å­˜å–çš„ï¼Œå°ç©ºé—´çš„æ¼”ç¤ºå¯ä»¥å¾ˆå®¹æ˜“è§‚å¯Ÿåˆ°å“ˆå¸Œå†²çªç°è±¡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¼šä¼˜åŒ–ç®—æ³•ï¼Œå°½é‡é¿å…å“ˆå¸Œå†²çªçš„å‘ç”Ÿã€‚

æ¡¶å¼å“ˆå¸Œç®—æ³•å®ç°ä¸­çš„æ¡¶ï¼ˆbucketsï¼‰æ˜¯ä¸€å—å†…å­˜ç©ºé—´ï¼ŒæŠ½è±¡ä¸ºä¸€ä¸ªä¸ªç”¨äºå­˜æ”¾æ•°æ®çš„æ¡¶ã€‚æ¼”ç¤ºé¡µé¢ä¸Šï¼Œä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¹¶æŒ‰ bucket æ‰€å å†…å­˜ç©ºé—´ç­‰é•¿åº¦åˆ’åˆ†ã€‚æœ€åä¿ç•™ä¸€å—å†…å­˜ä½œä¸ºæº¢å‡ºåŒºï¼Œå³å“ˆå¸Œå†²çªå¯¼è‡´å“ˆå¸Œæ¡¶ç©ºé—´å­˜æ»¡æ•°æ®åä½¿ç”¨çš„å¤‡ç”¨å†…å­˜ç©ºé—´ã€‚

å¼€æ”¾å¯»å€ã€å°é—­å¯»å€æ˜¯ä¸¤ç±»åœ¨å¤„ç†å“ˆå¸Œå†²çªæ—¶é‡‡å–çš„ä¸åŒç®—æ³•æ€ç»´ã€‚

æ‰€è°“å¼€æ”¾å¯»å€ï¼ŒClosed Hashingï¼Œæ˜¯æŒ‡ä¸»è¡¨åœ°å€ç©ºé—´å¼€æ”¾ã€‚å‡ºç°å“ˆå¸Œå†²çªæ—¶ï¼ŒæŒ‰åŸæ˜ å°„é¡ºå»¶åˆ°æŸä¸ªç©ºé—²ä½ç½®æ¥å­˜æ”¾æ•°æ®ï¼Œæ­¤å®ç°æ–¹å¼ä¹Ÿç§°ä¸ºæ‹‰é“¾æ³•å“ˆå¸Œè¡¨ã€‚

æ‰€è°“å°é—­å¯»å€ï¼ŒOpen Hashingï¼Œæ˜¯æŒ‡ä¸»è¡¨ç©ºé—´å°é—­ï¼Œåœ¨å“ˆå¸Œå†²çªæ—¶ï¼Œé€šè¿‡ä¸»è¡¨çš„ Slot æ‰©å±•é“¾è¡¨æ¥æä¾›æ–°ç©ºé—´ï¼Œå®ƒæ˜¯åœ¨å“ˆå¸Œè¡¨ä¹‹å¤–å»ºç«‹çš„æ–°ç©ºé—´ï¼Œæ‰€ä»¥ç§°ä¸ºå¼€æ”¾å“ˆå¸Œã€‚

ä»å‡½æ•°çš„å®šä¹‰å¯ä»¥çŸ¥é“ï¼Œè¾“å…¥æ•°æ®æ‹¥æœ‰æ— é™å¯èƒ½ï¼Œä½†æ˜¯å®ç° hash å‡½æ•°æ—¶å´è¦å—åˆ°ç¡¬ä»¶é™åˆ¶ï¼Œåªèƒ½å°½é‡å°†è¾“å…¥å‡åŒ€åœ°åˆ†å¸ƒåœ¨æœ‰é™çš„å†…å­˜ç©ºé—´ä¸­ã€‚æ‰€ä»¥ï¼Œhash ç®—æ³•æœ¬èº«å­˜åœ¨ä¸€ä¸ªå·¨å¤§çš„ç¼ºé™·ï¼šå“ˆå¸Œå†²çªã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½è¢«æ¶æ„åˆ©ç”¨ï¼Œæ¯”å¦‚å“ˆå¸Œæ´ªæ°´æ”»å‡»ï¼ˆHash-Flooding Attackï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDenial of Serviceï¼‰ï¼ŒæœåŠ¡å™¨ä¸€æ—¦é­é‡å“ˆå¸Œæ´ªæ°´ï¼Œå…¶æœåŠ¡å™¨èµ„æºå¿…ç„¶ä¼šè€—å°½ï¼Œå¯¼è‡´æ— æ³•æä¾›æ­£å¸¸æœåŠ¡ã€‚

æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‡è®¾è¦è¿ç»­æ’å…¥ n ä¸ªå…ƒç´ åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œå½“ç»å¸¸é‡åˆ°å“ˆå¸Œå†²çªï¼Œé‚£ä¹ˆå°±éœ€è¦é¢å¤–çš„æ“ä½œï¼Œæ­¤æ—¶ä¸ºå“ˆå¸Œè¡¨çš„æœ€å·®æ—¶é—´å¤æ‚åº¦ O(nÂ²)ã€‚

è¿½æ ¹é—®åº•ï¼Œ`hashCode()` æˆ–è€… System.identityHashCode() æ–¹æ³•çš„å®ç°ä¾èµ–äº JVM çš„å®ç°ï¼Œå¯ä»¥å‚è€ƒ OpenJDK æºç çš„å®ç°ï¼š

```cpp
	// jdk-8u60/src/share/native/java/lang/System.c
	// jdk-8u60/src/share/native/java/lang/Object.c
	static JNINativeMethod methods[] = {
	    {"hashCode",    "()I",                    (void *)&JVM_IHashCode},
	    {"wait",        "(J)V",                   (void *)&JVM_MonitorWait},
	    {"notify",      "()V",                    (void *)&JVM_MonitorNotify},
	    {"notifyAll",   "()V",                    (void *)&JVM_MonitorNotifyAll},
	    {"clone",       "()Ljava/lang/Object;",   (void *)&JVM_Clone},
	};
	// jdk-8u60/src/share/javavm/export/jvm.h
	JNIEXPORT jint JNICALL
	JVM_IHashCode(JNIEnv *env, jobject obj);

	// hotspot/src/share/vm/prims/jvm.cpp
	JVM_ENTRY(jint, JVM_IHashCode(JNIEnv* env, jobject handle))
	  JVMWrapper("JVM_IHashCode");
	  // as implemented in the classic virtual machine; return 0 if object is NULL
	  return handle == NULL ? 0 : ObjectSynchronizer::FastHashCode (THREAD, JNIHandles::resolve_non_null(handle)) ;
	JVM_END
```

ç”Ÿæˆ hash ç çš„æ–¹æ³•æœ€ç»ˆå®šä½åˆ° `ObjectSynchronizer` å¯¹è±¡åŒæ­¥ç±»å‹æ–‡ä»¶ä¸­å®šä¹‰çš„ `gen_next_hash()`ï¼Œå®ƒæä¾›äº† 6 ç§ç®—æ³•ï¼Œä½¿ç”¨ global.hhp æ–‡ä»¶ä¸­å®šä¹‰çš„å…¨å±€ç¬¦å· `hashCode` æ¥é€‰æ‹©ï¼Œæˆ–è€…ä½¿ç”¨ JVM å‘½ä»¤è¡Œå‚å‚æ•° `-XX:hashCode=n` æŒ‡å®šç®—æ³•ï¼ŒOpenJDK 8 é»˜è®¤ä½¿ç”¨æœ€åä¸€ç§ï¼š

	hashCode() generation possibilities:
	* MD5Digest of {obj,stwRandom}
	* CRC32 of {obj,stwRandom} or any linear-feedback shift register function.
	* A DES- or AES-style SBox[] mechanism
	* One of the Phi-based schemes, such as:
	  2654435761 = 2^32 * Phi (golden ratio)
	  HashCodeValue = ((uintptr_t(obj) >> 3) * 2654435761) ^ GVars.stwRandom ;
	* A variation of Marsaglia's shift-xor RNG scheme.
	* (obj ^ stwRandom) is appealing, but can result
	  in undesirable regularity in the hashCode values of adjacent objects
	  (objects allocated back-to-back, in particular).  This could potentially
	  result in hashtable collisions and reduced hashtable efficiency.
	  There are simple ways to "diffuse" the middle address bits over the
	  generated hashCode values

JVM åº•å±‚å®šä¹‰çš„ `oopDesc` (å…¶å­ç±»å‹ `markOopDesc`ã€`instanceOopDesc`ã€`arrayOopDesc` ç­‰ç­‰) è®°å½• hash ç ï¼Œå¹¶ä¸”ä½äºå¯¹è±¡å†…å­˜ç©ºé—´çš„å‰é¢ã€‚åœ¨é¦–æ¬¡éœ€è¦ä½¿ç”¨ hash code ä½†å¦‚æœ Ordinary Object Pointers (OOPs) æ•°æ®ä¸­è¿˜æœªè®°å½•ç”Ÿæˆçš„å€¼ï¼Œå°±ä¼šè°ƒç”¨ `get_next_hash()` æ–¹æ³•ç”Ÿæˆ hash codeã€‚æ­¤å¤„çš„ OOP æ˜¯æŒ‡ Java å¯¹è±¡çš„æŒ‡é’ˆï¼Œä¹Ÿå³æ˜¯ç±»å‹åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ã€‚

ä½¿ç”¨ Java Object Layout (JOL) å¯ä»¥æ‰“å° Java å¯¹è±¡çš„å†…å­˜å¸ƒå±€ä¿¡æ¯ã€‚
https://mvnrepository.com/artifact/org.openjdk.jol/jol-core

32 ä½å¹³å°åˆ° 64 ä½ï¼ŒæŒ‡é’ˆå°†ç”± 4 å­—èŠ‚å˜ä¸ºäº† 8 å­—èŠ‚ï¼Œè¿™ä¼šå¯¼è‡´æŒ‡é’ˆå ç”¨çš„ç©ºé—´åŠ å€ã€‚æ‰€ä»¥ï¼Œé€šå¸¸ 64-bit HotSpot VM ä¸ºäº†é¿å…é€ æˆå †å†…å­˜æŸå¤±ï¼Œä¸è¿‡ä» JDK 1.6 update 14 å¼€å§‹æ­£å¼æ”¯æŒ `-XX:+UseCompressedOops`å‘½ä»¤è¡Œå‚æ•°ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œç”¨äºå‹ç¼©æŒ‡é’ˆï¼Œèµ·åˆ°èŠ‚çº¦å†…å­˜å ç”¨çš„ä½œç”¨ã€‚

OpenJDK8 è¿˜ä½¿ç”¨ Metaspace å­˜å‚¨å…ƒæ•°æ®ï¼Œç›¸åº”å¢åŠ  `-XX:+UseCompressedClassPointer` ç”¨äºå‹ç¼©å…ƒä¿¡æ¯ä¸­çš„æŒ‡é’ˆã€‚è¿™äº›å‹ç¼©åçš„æŒ‡é’ˆæŒ‡å‘çš„ç©ºé—´ç§°ä¸ºâ€œCompressed Class Spaceâ€ã€‚é»˜è®¤å¤§å°æ˜¯ 1Gï¼Œå¯ä»¥é€šè¿‡ `-XX:CompressedClassSpaceSize` è°ƒæ•´ã€‚

```cpp
// hotspot/src/share/vm/oops/oop.hpp
// hotspot/src/share/vm/oops/markOop.hpp
// hotspot/src/share/vm/runtime/synchronizer.cpp
intptr_t ObjectSynchronizer::FastHashCode (Thread * Self, oop obj) {
  // ...
  markOop mark = ReadStableMark (obj);

  // object should remain ineligible for biased locking
  assert (!mark->has_bias_pattern(), "invariant") ;

  if (mark->is_neutral()) {
    hash = mark->hash();              // this is a normal header
    if (hash) {                       // if it has hash, just return it
      return hash;
    }
    hash = get_next_hash(Self, obj);  // allocate a new hash code
    temp = mark->copy_set_hash(hash); // merge the hash code into header
    // use (machine word version) atomic operation to install the hash
  // ...

static inline intptr_t get_next_hash(Thread * Self, oop obj) {
  // ...

// hotspot/src/share/vm/runtime/globals.hpp:
  product(intx, hashCode, 5, "(Unstable) select hashCode generation algorithm") \
```

OpenJDK é»˜è®¤çš„ hashCode æ–¹æ³•çš„å®ç°å’Œå¯¹è±¡å†…å­˜åœ°å€æ— å…³ï¼Œç‰ˆæœ¬ 6 å’Œ 7 ä¸­çš„å®ç°ä½¿ç”¨éšæœºç”Ÿæˆçš„æ•°å­—ï¼Œåœ¨ç‰ˆæœ¬ 8 ä¸­ï¼Œå®ƒæ˜¯åŸºäºçº¿ç¨‹çŠ¶æ€çš„æ•°å­—ã€‚

Mark word ä¸ä»…ç”¨æ¥å­˜å‚¨ hash codeï¼Œå®ƒè¿˜ç”¨äºå¤šçº¿ç¨‹é”ï¼Œä»¥åŠåº”ç”¨äºåƒåœ¾å›æ”¶æœºåˆ¶ã€‚

JVM å‘æ¥ä½¿ç”¨åˆ†ä»£ï¼ŒJDK 7 Hotspot å›¢é˜Ÿé¦–æ¬¡å…¬å¸ƒäº† G1ï¼ˆGarbage-Firstï¼‰ï¼Œå¹¶åœ¨ JDK9 ä¸­ç”¨ G1 ä½œä¸ºé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨æ›¿ä»£æ—©æœŸçš„ Concurrent Mark Sweep (CMS) åƒåœ¾æ”¶é›†å™¨ã€‚

æ—©æœŸ GC ç®—æ³•ï¼š

1. 1960å¹´ï¼ŒJohn McCarthy å‘å¸ƒ GC æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰ï¼›
2. 1960å¹´ï¼ŒGeorge E. Collins å‘å¸ƒå¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countï¼‰ï¼›
3. 1963å¹´ï¼ŒMarvin L. Minsky å‘å¸ƒ GC å¤åˆ¶æ”¶é›†ç®—æ³•ï¼ˆCopy and Collectionï¼‰ï¼›

åˆ†ä»£åƒåœ¾å›æ”¶ (Generational GC) å¼•å…¥å¯¹è±¡å­˜æ´»å¹´é¾„çš„æ¦‚å¿µï¼Œé€šè¿‡ä¼˜å…ˆå›æ”¶å®¹æ˜“æˆä¸ºåƒåœ¾çš„å¯¹è±¡ï¼Œæé«˜åƒåœ¾å›æ”¶æ•ˆç‡ã€‚æ­¤ç®—æ³•çš„ç†è®ºæ ¹æ®æ˜¯ï¼šå¤§éƒ¨åˆ†å¯¹è±¡åœ¨ç”Ÿæˆåé©¬ä¸Šå˜æˆäº†åƒåœ¾ï¼Œå¾ˆå°‘æœ‰å¯¹è±¡èƒ½æ´»å¾—å¾ˆä¹…ã€‚å¯¹æ–°ç”Ÿä»£å¯¹è±¡æ‰§è¡Œçš„ GC ç§°ä¸º minor GCï¼Œæ–°ç”Ÿä»£å­˜æ´»ä¸€å®š GC æ¬¡æ•°åå°†æ™‹å‡ (promotion) æˆ–è€…è€åŒ– (aging) ä½œä¸ºè€å¹´ä»£å¯¹è±¡ã€‚

G1 ç§æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ¦‚å¿µï¼š

1. `Heap Region`ï¼šå †å†…å­˜ç©ºé—´åˆ†æˆç›¸å¯¹ç‹¬ç«‹ç­‰åˆ†ï¼Œæ–¹ä¾¿åˆ†åˆ«è¿›è¡Œ GCã€‚å„è‡ªç‰©ç†ä¸Šä¸ä¸€å®šè¿ç»­ï¼Œé€»è¾‘ä¸Šæ„æˆè¿ç»­çš„å †åœ°å€ç©ºé—´ã€‚
2. `Remember Set`ï¼šè®°å½•äº†å“ªäº› Region ä¸­å­˜åœ¨å¯¹å½“å‰æ‰§è¡Œ GC çš„ Region ä¸­çš„å¯¹è±¡å¼•ç”¨ã€‚

ä¸ºä»€ä¹ˆè¦é‡æ–°è®¾è®¡ä¸€ä¸ª G1 åƒåœ¾æ”¶é›†å™¨ï¼Ÿè®ºæ–‡ä¸­ç»™å‡ºçš„ç†ç”±ï¼šç°æœ‰çš„åƒåœ¾æ”¶é›†å™¨æ— æ³•æ»¡è¶³ è½¯å®æ—¶ï¼ˆSoft Real-timeï¼‰ ç‰¹æ€§ï¼Œå³è®© GC åœé¡¿èƒ½å¤§è‡´æ§åˆ¶åœ¨æŸä¸ªé˜ˆå€¼ä»¥å†…ï¼Œä½†æ˜¯åˆä¸å¿…åƒå®æ—¶ç³»ç»Ÿé‚£æ ·éå¸¸ä¸¥æ ¼ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šä¸šåŠ¡ç³»ç»Ÿéƒ½æœ‰çš„è¯‰æ±‚ã€‚

åœ¨è¿‡å»çš„è®¾è®¡ä¸­ï¼ŒJVM å †å†…å­˜è¢«åˆ†å‰²æˆå‡ ä¸ªåŒºåŸŸ â€”â€” Edenã€Survivorã€Old çš„å¤§å°éƒ½æ˜¯é¢„å…ˆåˆ’åˆ†å¥½çš„ã€‚å¯¹äºæ€»å†…å­˜ 64GB çš„æœºå™¨ï¼Œå¯èƒ½ Old åŒºå¤§å°å°±æœ‰ 32GBï¼Œå³ä½¿ç”¨å¹¶è¡Œçš„æ–¹å¼æ”¶é›†ä¸€æ¬¡ä»ç„¶éœ€è¦æ•°ç§’ã€‚è¿‘åå¹´ï¼Œéšç€å†…å­˜è¶Šæ¥è¶Šå¤§ï¼Œè¿™ä¸€é—®é¢˜ä¹Ÿå˜å¾—æ›´ä¸ºä¸¥é‡ã€‚


## âš¡ GC åƒåœ¾å›æ”¶
- [Java Garbage Collection handbook](https://plumbr.io/java-garbage-collection-handbook)
- [æ·±å…¥ç†è§£JVMï¼ˆâ‘¢ï¼‰ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨](https://www.cnblogs.com/jimoer/p/13126614.html)
- [æ·±å…¥ç†è§£JVMï¼ˆâ‘¢ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¿˜å¥åœ¨ï¼Ÿ](https://www.cnblogs.com/jimoer/p/13055672.html)
- [æ·±å…¥ç†è§£JVMï¼ˆâ‘¢ï¼‰å„ç§åƒåœ¾æ”¶é›†ç®—æ³•](https://www.cnblogs.com/jimoer/p/13096642.html)

Java å†…å»ºè‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè¿™æ˜¯æ¯” C++ é«˜çº§çš„åŠŸèƒ½ï¼Œä¸ç”¨è‡ªè¡Œæ¸…ç†ä¹Ÿä¸ä¼šä»¥å¼•ç”¨å†…å­˜æ³„éœ²ï¼Œä½†æ˜¯éœ€è¦çŸ¥é“ GC å·¥ä½œåŸç†ç”±äºåƒåœ¾å¯¹è±¡çš„åˆ¤å®šã€åƒåœ¾å¯¹è±¡çš„æ”¶é›†ä¸¤ä¸ªæ­¥éª¤ã€‚

Java å¯¹è±¡ä¸»è¦å­˜æ”¾åœ¨ Java Heapï¼Œåƒåœ¾æ”¶é›†å™¨ Garbage Collection åœ¨å›æ”¶å †å†…å­˜å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­å“ªäº›è¿˜å­˜æ´»ç€ï¼Œå“ªäº›å·²ç»æ­»å»ä¸è¢«å¼•ç”¨äº†ã€‚

- åˆ¤å®šåƒåœ¾å¯¹è±¡
	- å¼•ç”¨è®¡æ•°ç®—æ³• Programm Counter
	- å¯è¾¾æ€§åˆ†ææ³• Reachability Analysis
- åƒåœ¾å›æ”¶ç®—æ³•
	- æ ‡è®°æ¸…é™¤ç®—æ³• 
	- å¤åˆ¶ç®—æ³•
	- æ ‡è®°æ•´ç†ç®—æ³•
	- åˆ†ä»£æ”¶é›†ç®—æ³•

åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±åŠ ä¸€ï¼›å½“å¼•ç”¨å¤±æ•ˆæ˜¯ï¼Œè®¡æ•°å™¨å€¼å°±å‡ä¸€ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸ºé›¶çš„å¯¹è±¡å°±æ˜¯ä¸å¯ä»¥èƒ½å†è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚

å¼•ç”¨è®¡æ•°ç®—æ³•çš„åŸç†ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡ä¹Ÿå¾ˆé«˜ã€‚å¸‚é¢ä¸Šä¹Ÿç¡®å®æœ‰ä¸€äº›æŠ€æœ¯ä½¿ç”¨çš„æ­¤ç±»ç®—æ³•æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œåƒä½¿ç”¨ ActionScript 3 çš„ FlashPlayerã€Python è¯­è¨€ç­‰ã€‚ä½†æ˜¯åœ¨ä¸»æµçš„ Java è™šæ‹Ÿæœºé‡Œé¢éƒ½æ²¡æœ‰é€‰ç”¨å¼•ç”¨è®¡ç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ­¤ç®—æ³•æ—¶ï¼Œå¿…é¡»è¦é…åˆå¤§é‡çš„é¢å¤–å¤„ç†æ‰èƒ½ä¿è¯æ­£ç¡®çš„å·¥ä½œï¼Œä¾‹å¦‚è¦è§£å†³å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚

å¼•ç”¨è®¡æ•°ç®—æ³•åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“æœ‰åœ°æ–¹å¼•ç”¨è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¼•ç”¨è®¡æ•°å™¨çš„å€¼å°±åŠ  1ï¼Œå½“å¼•ç”¨å¤±æ•ˆçš„æ—¶å€™ï¼Œè®¡æ•°å™¨çš„å€¼å°±å‡ 1ã€‚ä½† Java è™šæ‹Ÿæœºä¸­æ²¡æœ‰ä½¿ç”¨è¿™ç§ç®—æ³•ï¼Œè¿™æ˜¯ç”±äºå¦‚æœå †å†…çš„å¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œå°±å§‹ç»ˆä¸ä¼šå‘ç”Ÿè®¡æ•°å™¨ -1ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå›æ”¶ã€‚

æµ‹è¯•ï¼šä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨

	import java.lang.*;

	public class GcCounterTest 
	{
	    private Object instance;
	    
	    // å æ® 20M å†…å­˜
	    public GcCounterTest() {
	        byte[] m = new byte[20 * 1024 *1024];
	    }

	    public void finalize(){
	        System.out.println("Destructor...");
	    }
	    
	    public static void main(String[] args) {
	        GcCounterTest c1 = new GcCounterTest();
	        GcCounterTest c2 = new GcCounterTest();
	        
	        c1.instance = c2;
	        c2.instance = c1;
	        // æ–­æ‰å¼•ç”¨
	        c1 = null;
	        c2 = null;
	        
	        // å‡è®¾åœ¨è¿™è¡Œå‘ç”Ÿ GCï¼Œå¯¹è±¡å†…å­˜æ˜¯å¦èƒ½è¢«å›æ”¶ï¼Ÿ
	        System.gc();
	    }
	}

åœ¨åé¢å‘ç”Ÿ GC çš„æ—¶å€™ï¼Œå¦‚æœæŒ‰ç…§å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡è™½ç„¶éƒ½è¢«è®¾ç½®æˆäº† nullï¼Œä½†æ˜¯ä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œæ‰€ä»¥æŒ‰ç¨‹åºè®¡ç®—å™¨çš„æ–¹å¼å®ƒä»¬éƒ½ä¸ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯çœŸæ­£çš„å®é™…è¿è¡Œç»“æœæ˜¯ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡éƒ½è¢«å›æ”¶äº†ï¼Œè¿™ä¹Ÿè¯´æ˜ HotSpot è™šæ‹Ÿæœºå¹¶ä¸æ˜¯ç”¨å¼•ç”¨è®¡æ•°æ³•æ¥è¿›è¡Œçš„å†…å­˜ç®¡ç†ã€‚

Java æ²¡æœ‰æä¾›åƒ C++ é‚£æ ·çš„ææ„å‡½æ•°ï¼Œå› ä¸ºä¸ç”¨ç¨‹åºå‘˜æ”¯ç®¡ç†å†…å­˜ï¼Œä½†æ˜¯æä¾›äº†ä¸€ä¸ªåœ¨å¯¹è±¡æ¸…ç†æ—¶æ‰§è¡Œçš„ **void finalize()** æ–¹æ³•ï¼Œå› æ­¤ä½ å¦‚æœç¡®å®éœ€è¦ææ„çš„è¯å°±å¯ä»¥å®ç°è¿™æ ·ä¸€ä¸ªæ–¹æ³•ã€‚


å½“å‰ä¸»æµçš„å•†ç”¨ç¨‹åºè¯­è¨€ Javaã€ C# ç­‰éƒ½æ˜¯é€šè¿‡**å¯è¾¾æ€§åˆ†æ** Reachability Analysis ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€ä¸€ç³»åˆ—ç§°ä¸º GC Roots çš„å¯¹è±¡çš„èµ·å§‹èŠ‚ç‚¹é›†ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹æ ¹æ®å¼•ç”¨å…³ç³»å‘ä¸‹æœç´¢ï¼Œæœç´¢èµ°è¿‡çš„çš„è·¯å¾„ç§°ä¸º**å¼•ç”¨é“¾** Reference Chainï¼Œå¦‚æœæŸä¸ªå¯¹è±¡åˆ° GC Roots é—´æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œæˆ–è€…ä» GC Roots åˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚

ç¨‹åºä¸­ï¼Œå›ºå®šä½œä¸º GC Roots å¯¹è±¡çš„åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š

- åœ¨è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å„ä¸ªç°åœºè¢«è°ƒç”¨çš„æ–¹æ³•å †æ ˆä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å˜é‡ç­‰ã€‚
- åœ¨æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚ Java ç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ã€‚
- åœ¨æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å­—ç¬¦ä¸²å¸¸é‡æ±  String Table é‡Œçš„å¼•ç”¨ã€‚
- åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å³é€šå¸¸æ‰€è¯´çš„ Native æ–¹æ³•å¼•ç”¨çš„å¯¹è±¡ã€‚
- Java è™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„ Class å¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ NullPointExceptionã€OutOfMemoryError ç­‰ï¼Œè¿˜æœ‰ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚
- æ‰€æœ‰è¢«åŒæ­¥é” synchronized å…³é”®å­—æŒæœ‰çš„å¯¹è±¡ã€‚
- åæ˜  Java è™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„ JMXBeanã€JVMTI ä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚

é™¤äº†è¿™äº›å›ºå®šçš„ GC Roots é›†åˆä»¥å¤–ï¼Œæ ¹æ®åƒåœ¾æ”¶é›†å™¨ä»¥åŠå½“å‰å›æ”¶çš„åŒºåŸŸä¸åŒï¼Œè¿˜ä¼šæœ‰å…¶ä»–å¯¹è±¡ä¸´æ—¶æ€§åŠ å…¥ï¼Œå¦‚æœåªé’ˆå¯¹ Java å †ä¸­æŸä¸€å—å„¿åŒºåŸŸå‘èµ·åƒåœ¾æ”¶é›†æ—¶ï¼Œä¾‹å¦‚åªé’ˆå¯¹å¹´è½»ä»£çš„åƒåœ¾æ”¶é›†ï¼Œå¿…é¡»è€ƒè™‘åˆ°å½“å‰åŒºåŸŸå†…çš„å¯¹è±¡æ˜¯å¦æœ‰è¢«å…¶ä»–åŒºåŸŸçš„å¯¹è±¡æ‰€å¼•ç”¨ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æŠŠè¿™äº›å…³è”åŒºåŸŸçš„å¯¹è±¡ä¸€å¹¶åŠ å…¥ GC Roots é›†åˆä¸­ï¼Œæ¥ä¿è¯å¯è¾¾æ€§åˆ†æçš„æ­£ç¡®æ€§ã€‚

å¼•ç”¨å…³ç³»çš„å¤„ç†æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶ä¸­å¾ˆé‡è¦çš„ä¸€ç¯ï¼ŒJDK 1.2 ç‰ˆä¹‹åå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå››ç§ç±»å‹ï¼š

- å¼ºå¼•ç”¨ Strongly Reference

	å¼ºå¼•ç”¨æ˜¯æœ€ä¼ ç»Ÿçš„å¼•ç”¨çš„å®šä¹‰ï¼ŒæŒ‡å¼•ç”¨å¤åˆ¶ï¼Œå³ç±»ä¼¼ä»¥ä¸‹è¿™ç§ï¼š

		Object obj = new Object()

	æ— è®ºåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚

- è½¯å¼•ç”¨ Soft Reference æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†éå¿…é¡»çš„å¯¹è±¡ã€‚åœ¨ç³»ç»Ÿå‘ç”Ÿå†…å­˜æº¢å‡ºå‰ï¼Œä¼šå…ˆå¯¹è½¯å¼•ç”¨å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ï¼Œå¦‚æœå›æ”¶åè¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºçš„å¼‚å¸¸ã€‚
- å¼±å¼•ç”¨ Weak Reference æè¿°é‚£äº›éå¿…é¡»çš„å¯¹è±¡ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ï¼Œå¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œåªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¸ºæ­¢ã€‚å½“åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚
- è™šå¼•ç”¨ Phantom Reference ä¹Ÿç§°ä¸ºå¹½çµå¼•ç”¨æˆ–å¹»å½±å¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åªæ˜¯ä¸ºäº†èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚


æ¸…é™¤åƒåœ¾å›æ”¶å†…å­˜æ—¶ï¼Œæœ‰å¤šç§å¤„ç†æ–¹æ³•ã€‚

**æ ‡è®°æ¸…é™¤ç®—æ³•**å…ˆæ ‡è®°å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œå†å»æ¸…é™¤ï¼Œä½†ä¼šæœ‰æ•ˆç‡é—®é¢˜å’Œç©ºé—´é—®é¢˜ã€‚æ ‡è®°çš„ç©ºé—´è¢«æ¸…é™¤åï¼Œä¼šé€ æˆæˆ‘çš„å†…å­˜ä¸­å‡ºç°è¶Šæ¥è¶Šå¤šçš„ä¸è¿ç»­ç©ºé—´ï¼Œå½“è¦åˆ†é…ä¸€ä¸ªå¤§å¯¹è±¡çš„æ—¶å€™ï¼Œåœ¨è¿›è¡Œå¯»å€çš„è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå¯èƒ½ä¼šå†ä¸€æ¬¡è§¦å‘åƒåœ¾å›æ”¶ã€‚

å¤åˆ¶ç®—æ³•å°†æŒ‰å¯¹è±¡å»ºç«‹ä½¿ç”¨çš„æ—¶é—´é•¿åº¦è¿›è¡ŒåŒºåˆ†ï¼Œé’ˆå¯¹ä¸åŒçš„å¹´ä»£è¿›è¡Œä¸åŒç®—æ³•çš„åƒåœ¾å›æ”¶ï¼Œé’ˆå¯¹æ–°ç”Ÿä»£é€‰æ‹©å¤åˆ¶ç®—æ³•ï¼Œå¯¹è€å¹´ä»£é€‰æ‹©æ ‡è®°æ•´ç†ç®—æ³•ã€‚

JVM å†…å­˜åˆ†é…åŸåˆ™ï¼š

- ä¼˜å…ˆåˆ†é…åˆ° Eden
- å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£
- é•¿æœŸå­˜æ´»çš„å¯¹è±¡åˆ†é…åˆ°è€å¹´ä»£
- ç©ºé—´åˆ†é…æ‹…ä¿
- åŠ¨æ€å¯¹è±¡çš„å¹´é¾„åˆ¤æ–­

å¯¹è±¡å†…å­˜åˆ†åŒºï¼š

	- å †ï¼š
		- æ–°ç”Ÿä»£ new generation
			- Eden ä¼Šç”¸å›­
			- Survivor From å­˜æ´»åŒº
			- Survivor To å­˜æ´»åŒº
		- è€å¹´ä»£ Tenured Generation
		- Metaspace

**å¤åˆ¶ç®—æ³•**æ˜¯å°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆã€‚åªæ˜¯è¿™ç§ç®—æ³•çš„ä»£ä»·æ˜¯å°†å†…å­˜ç¼©å°ä¸ºäº†åŸæ¥çš„ä¸€åŠï¼Œæµªè´¹è¾ƒå¤§ã€‚

ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•æ¥å›æ”¶æ–°ç”Ÿä»£ï¼ŒIBM å…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ 98% æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æŒ‰ç…§ 1:1 çš„æ¯”ä¾‹æ¥åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivorã€‚å½“å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§çš„å¤åˆ¶åˆ°å¦å¤–ä¸€å— Survivorã€‚æœ€åæ¸…ç†æ‰ Eden å’Œåˆšæ‰ç”¨è¿‡çš„ Survivor ç©ºé—´ã€‚HotSpot è™šæ‹Ÿæœºé»˜è®¤ Eden å’Œ Survivor çš„å¤§å°æ¯”ä¾‹æ˜¯ 8:1ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æ–°ç”Ÿä»£ä¸­å¯ç”¨å†…å­˜ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å®¹é‡çš„ 90%ï¼ˆ80%+10%ï¼‰ï¼Œåªæœ‰ 10% çš„å†…å­˜ä¼šè¢«â€œæµªè´¹â€ã€‚

ä½¿ç”¨ä¸¤ä¸ª Survivor åŒºä¸»è¦æ˜¯ä¸ºäº†è§£å†³å†…å­˜ç¢ç‰‡åŒ–å’Œæ•ˆç‡é—®é¢˜ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª Survivor åŒºï¼Œæ¯è§¦å‘ä¸€æ¬¡ Minor GC éƒ½ä¼šæœ‰æ•°æ®ä» Eden æ”¾åˆ° Survivorï¼Œä¸€ç›´è¿™æ ·å¾ªç¯ä¸‹å»ã€‚æ³¨æ„çš„æ˜¯ï¼ŒSurvivor åŒºä¹Ÿä¼šè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™æ ·å°±ä¼šå‡ºç°å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ï¼Œåæœå°±æ˜¯å¯¼è‡´å †ä¸­å¯èƒ½æ²¡æœ‰è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´å­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œå½±å“ç¨‹åºæ€§èƒ½ã€‚å¦‚æœæœ‰ä¸¤å— Survivor å°±èƒ½å°†å‰©ä½™å¯¹è±¡é›†ä¸­åˆ°å…¶ä¸­ä¸€å— Survivor ä¸Šï¼Œæœ‰æ•ˆåœ°é¿å…ç¢ç‰‡é—®é¢˜ã€‚

å¯¹äºè€å¹´ä»£ï¼Œå›æ”¶çš„åƒåœ¾è¾ƒå°‘æ—¶ï¼Œå¦‚æœé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œåˆ™æ•ˆç‡è¾ƒä½ã€‚**æ ‡è®°æ•´ç†ç®—æ³•**çš„æ ‡è®°æ“ä½œå’Œâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€è‡´ï¼Œåç»­æ“ä½œä¸åªæ˜¯ç›´æ¥æ¸…ç†å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨æ¸…ç†æ— ç”¨å¯¹è±¡å®Œæˆåè®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œå¹¶æ›´æ–°å¼•ç”¨å…¶å¯¹è±¡çš„æŒ‡é’ˆã€‚


åƒåœ¾æ”¶é›†å™¨ï¼š

- Serial æ”¶é›†å™¨ï¼Œå•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ã€æœ€åŸºæœ¬ã€å‘å±•æœ€æ‚ ä¹…ã€‚
- ParNew å¯å¤šçº¿ç¨‹æ”¶é›†åƒåœ¾ï¼Œæ”¶é›†æ–°ç”Ÿä»£ï¼Œä½¿ç”¨æ”¶é›†ç®—æ³•ã€‚
- Parallel å¤šçº¿ç¨‹æ”¶é›†åƒåœ¾ï¼Œæ”¶é›†æ–°ç”Ÿä»£ï¼Œä½¿ç”¨æ”¶é›†ç®—æ³•ã€‚Parallel æ”¶é›†å™¨æ›´å…³æ³¨ç³»ç»Ÿçš„ååé‡ï¼Œå¯ä»¥é€šè¿‡å‚æ•°æ¥æ‰“å¼€è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚
- CMS - Concurrent Mark Sweep æ ‡è®°-æ¸…é™¤ç®—æ³•æ”¶é›†å™¨ï¼Œç”¨äºè€å¹´ä»£ï¼Œå¸¸ä¸ ParNew ååŒå·¥ä½œã€‚
- G1 - Garbage First åƒåœ¾æ”¶é›†å™¨æ˜¯å½“ä»Šåƒåœ¾å›æ”¶æŠ€æœ¯æœ€å‰æ²¿çš„æˆæœä¹‹ä¸€ï¼Œå¹¶è¡Œä¸å¹¶å‘èƒ½åŠ›ï¼Œæ—©åœ¨ JDK 7 å°±å·²åŠ å…¥ JVM çš„æ”¶é›†å™¨å¤§å®¶åº­ä¸­ï¼Œæˆä¸º HotSpot é‡ç‚¹å‘å±•çš„åƒåœ¾å›æ”¶æŠ€æœ¯ã€‚

å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ã€æœ€åŸºæœ¬ã€å‘å±•æœ€æ‚ ä¹…ã€‚å®ƒçš„å•çº¿ç¨‹çš„æ„ä¹‰å¹¶ä¸ä»…ä»…è¯´æ˜å®ƒåªä¼šä½¿ç”¨ä¸€ä¸ª CPU æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚å¶å°”ç”¨åœ¨æ¡Œé¢åº”ç”¨ä¸­ã€‚

Java ä¸­ Stop-The-World æœºåˆ¶ç®€ç§° STWï¼Œæ˜¯åœ¨æ‰§è¡Œåƒåœ¾æ”¶é›†ç®—æ³•æ—¶ï¼ŒJava åº”ç”¨ç¨‹åºçš„å…¶ä»–æ‰€æœ‰çº¿ç¨‹éƒ½è¢«æŒ‚èµ·ï¼ˆé™¤äº†åƒåœ¾æ”¶é›†å¸®åŠ©å™¨ä¹‹å¤–ï¼‰å…¨å±€æš‚åœç°è±¡ã€‚å…¨å±€åœé¡¿ï¼Œæ‰€æœ‰ Java ä»£ç åœæ­¢ï¼Œnative ä»£ç å¯ä»¥æ‰§è¡Œï¼Œä½†ä¸èƒ½ä¸ JVM äº¤äº’ï¼Œè¿™äº›ç°è±¡å¤šåŠæ˜¯ç”±äº gc å¼•èµ·ã€‚

æŸ¥çœ‹ JVM çš„ GC ä¿¡æ¯ï¼Œå¯ä»¥åœ¨è¿è¡Œç¨‹åºæ—¶åŠ å…¥ä»¥ä¸‹å‚æ•°ï¼š

	>java -verbose:gc -XX:+PrintGCDetails -XX:+UseSerialGC -Xms20M -Xmx20M -Xmn10M -XX:SurvivorRatio=8 GcCounterTest
	[GC (Allocation Failure) [DefNew: 836K->588K(9216K), 0.0016158 secs][Tenured: 0K->587K(10240K), 0.0018080 secs] 836K->587K(19456K), [Metaspace: 1727K->1727K(4480K)], 0.0043166 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	[GC (Allocation Failure) [DefNew: 0K->0K(9216K), 0.0005927 secs][Tenured: 21067K->587K(30724K), 0.0016413 secs] 21067K->587K(39940K), [Metaspace: 1727K->1727K(4480K)], 0.0032806 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
	[Full GC (System.gc()) [Tenured: 21067K->587K(30724K), 0.0016370 secs] 21230K->587K(39940K), [Metaspace: 1727K->1727K(4480K)], 0.0024321 secs] [Times: user=0.02 sys=0.00, real=0.00 secs]
	Destructor...

	Heap
	 def new generation   total 9216K, used 328K [0x05000000, 0x05a00000, 0x05a00000)
	  eden space 8192K,   4% used [0x05000000, 0x05052048, 0x05800000)
	  from space 1024K,   0% used [0x05800000, 0x05800000, 0x05900000)
	  to   space 1024K,   0% usedDestructor... [0x05900000, 0x05900000, 0x05a00000)
	 tenured generation
	 total 28676K, used 587K [0x05a00000, 0x07601000, 0x15000000)
	   the space 28676K,   2% used [0x05a00000, 0x05a92ce8, 0x05a92e00, 0x07601000)
	 Metaspace       used 1732K, capacity 2242K, committed 2368K, reserved 4480K


ä¸Šé¢æ‰“å°çš„ JVM GC æ—¥å¿—ä¸­ï¼Œæœ‰ä¸¤æ¬¡ GC (Allocation Failure)ï¼Œè¿™æ˜¯æ­£å¸¸æƒ…å†µï¼š

- Full GC è¡¨æ˜è¿›è¡Œäº†ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œå‰é¢æ²¡æœ‰ Full ä¿®é¥°ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€æ¬¡ Minor GCã€‚
- Allocation Failureï¼š è¡¨æ˜æœ¬æ¬¡å¼•èµ·GCçš„åŸå› æ˜¯å› ä¸ºåœ¨å¹´è½»ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´èƒ½å¤Ÿå­˜å‚¨æ–°çš„æ•°æ®äº†ã€‚
- ParNew è¡¨æ˜æœ¬æ¬¡ GC å‘ç”Ÿåœ¨å¹´è½»ä»£å¹¶ä¸”ä½¿ç”¨çš„æ˜¯ ParNew åƒåœ¾æ”¶é›†å™¨ã€‚

æ—¥å¿—ä¸­ï¼Œ836K->588K(9216K) è¿™æ ·çš„è¡¨è¾¾æ˜¯æŒ‡ GC å‰è¯¥å†…å­˜åŒºåŸŸä½¿ç”¨å®¹é‡ -> GC åè¯¥å†…å­˜åŒºåŸŸä½¿ç”¨å®¹é‡ï¼Œæ‹¬å·å†…çš„æ˜¯è¯¥å†…å­˜åŒºåŸŸæ€»å®¹é‡ï¼Œåé¢è·Ÿç€ GC è€—æ—¶ï¼Œå•ä½æ˜¯åˆ†åˆ«æ˜¯ KB å’Œç§’ã€‚çœ‹ Full GC (System.gc()) è¿™é‡Œè¡¨ç¤ºå‰é¢æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨ API è§¦å‘çš„ä¸€æ¬¡ GCï¼Œè€å¹´ä»£åŒº Tenured çš„å†…å­˜ç”± 21067K->587K å³å°†å æ® 20M å†…å­˜çš„ byte[] å­—èŠ‚æ•°ç»„é‡Šæ”¾äº†ã€‚

å¸¸è§ GC æ–¹å¼ï¼š

- Minor GC/Young GCï¼šæ–°ç”Ÿä»£ GCï¼ŒæŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼ŒMinor GC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚
- Old GC/Major GCï¼šæ”¶é›†æ•´ä¸ª Old gen çš„ GCï¼Œåªæœ‰ CMS æ¨¡å¼è¿™ä¹ˆç§°å‘¼ï¼ŒMajor GC çš„é€Ÿåº¦ä¸€èˆ¬æ¯” Minor GC å¤š 10 å€ä»¥ä¸Šã€‚
- Full GCï¼šæ”¶é›†æ•´ä¸ªå †ï¼ŒåŒ…æ‹¬ Young genã€Old genã€Perm genï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ç­‰æ‰€æœ‰éƒ¨åˆ†çš„æ¨¡å¼ã€‚
- Mixed GCï¼šæ”¶é›†æ•´ä¸ª young gen ä»¥åŠéƒ¨åˆ† old gen çš„ GCï¼Œåªæœ‰ G1 æ¨¡å¼è¿™ä¹ˆç§°å‘¼ã€‚

å¯¹äºå¤åˆ¶ç®—æ³•æ¥è¯´ï¼Œå½“å¹´è½»ä»£ Eden åŒºåŸŸæ»¡çš„æ—¶å€™ä¼šè§¦å‘ä¸€æ¬¡ Minor GCï¼Œå°† Eden å’Œ Survivor From åŒºçš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å— Survivor Toã€‚å¦‚æœæŸä¸ªå¯¹è±¡å­˜æ´»çš„æ—¶é—´è¶…è¿‡ Minor GC æ¬¡æ•°è¶…è¿‡ -XX:+MaxTenuringThreshold æŒ‡å®šå€¼ï¼Œä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚

Full GC ç”¨äºæ¸…ç†æ•´ä¸ªå †ç©ºé—´ï¼Œå®ƒçš„è§¦å‘æ¡ä»¶ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š

- æ˜¾å¼è°ƒç”¨ System.gc æ–¹æ³•ã€‚
- æ–¹æ³•åŒºç©ºé—´ä¸è¶³ï¼ŒJDK 8 åŠä¹‹åä¸ä¼šæœ‰è¿™ç§æƒ…å†µã€‚
- è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œå¼•èµ· Full GCï¼Œåˆç»†åˆ†ä»¥ä¸‹å‡ ç§ï¼š

	- å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£å¼•èµ·ï¼Œç”± -XX:PretenureSizeThreshold å‚æ•°å®šä¹‰
	- Minor GC æ—¶ï¼Œç»å†  Minor GC æ¬¡æ•°è¶…è¿‡ -XX:MaxTenuringThreashold æŒ‡å®šæ¬¡æ•°ä»å¥åœ¨çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚
	- Minor GC æ—¶ï¼ŒåŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šæœºåˆ¶ä¼šå°†å¯¹è±¡æå‰è½¬ç§»è€å¹´ä»£ï¼Œå¹´é¾„ä»å°åˆ°å¤§è¿›è¡Œæ¬¡æ•°ç´¯åŠ ï¼Œå½“åŠ å…¥æŸä¸ªå¹´é¾„æ®µåï¼Œç´¯åŠ å’Œè¶…è¿‡ survivor * TargetSurvivorRatio çš„æ—¶å€™ï¼Œä»è¿™ä¸ªå¹´é¾„æ®µå¾€ä¸Šçš„å¹´é¾„çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚
	- Minor GC æ—¶ï¼ŒEden å’Œ From Space åŒºå‘ To Space åŒºå¤åˆ¶æ—¶ï¼Œå¤§äº To Space åŒºå¯ç”¨å†…å­˜ï¼Œä¼šç›´æ¥æŠŠå¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£


JVM çš„ç©ºé—´åˆ†é…æ‹…ä¿æœºåˆ¶å¯èƒ½ä¼šè§¦å‘ Full GCï¼Œåœ¨è¿›è¡Œ Minor GC ä¹‹å‰ï¼ŒJVM ç©ºé—´æ‹…ä¿åˆ†é…æœºåˆ¶å¯èƒ½ä¼šè§¦å‘å‘ä¸€æ¬¡ Full GCã€‚

ç©ºé—´æ‹…ä¿åˆ†é…æ˜¯æŒ‡åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ã€‚ å¦‚æœå¤§äºï¼Œåˆ™æ­¤æ¬¡ Minor GC æ˜¯å®‰å…¨çš„ã€‚å¦‚æœå°äºï¼Œåˆ™è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ã€‚

å¦‚æœå…è®¸ï¼Œé‚£ä¹ˆä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œåˆ™å°è¯•è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œä½†è¿™æ¬¡ Minor GC ä¾ç„¶æ˜¯æœ‰é£é™©çš„ï¼Œå¤±è´¥åä¼šé‡æ–°å‘èµ·ä¸€æ¬¡ Full GCï¼Œå¦åˆ™æ”¹ä¸ºç›´æ¥è¿›è¡Œä¸€æ¬¡ Full GCã€‚

JDK 8 HotSpot è™šæ‹Ÿæœºä¸ºä»€ä¹ˆè¦å–æ¶ˆæ°¸ä¹…ä»£ï¼Ÿå¹¶ä¸”æ–°å¢äº†ä¸€ä¸ªå«å…ƒç©ºé—´ Metaspace çš„åŒºåŸŸï¼Œå¯¹åº”åœ¨ JVM è§„èŒƒä¸­çš„æ–¹æ³•åŒºï¼Œä¸»è¦å­˜æ”¾ä¸€äº› class å’Œå…ƒæ•°æ®çš„ä¿¡æ¯ã€‚åŒºåˆ«åœ¨äºï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„å¹¶ä¸æ˜¯ JVM ä¸­çš„å†…å­˜ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚è€Œè¿™ä¹ˆåšçš„åŸå› å¤§è‡´æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

- å­—ç¬¦ä¸²å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜å’Œå†…å­˜æº¢å‡ºã€‚
- ç±»åŠæ–¹æ³•çš„ä¿¡æ¯ç­‰æ¯”è¾ƒéš¾ç¡®å®šå…¶å¤§å°ï¼Œå› æ­¤å¯¹äºæ°¸ä¹…ä»£çš„å¤§å°æŒ‡å®šæ¯”è¾ƒå›°éš¾ï¼Œå¤ªå°å®¹æ˜“å‡ºç°æ°¸ä¹…ä»£æº¢å‡ºï¼Œå¤ªå¤§åˆ™å®¹æ˜“å¯¼è‡´è€å¹´ä»£æº¢å‡ºã€‚
- æ°¸ä¹…ä»£ä¼šä¸º GC å¸¦æ¥ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½ã€‚
- Oracle å¯èƒ½ä¼šå°† HotSpot ä¸ JRockit åˆäºŒä¸ºä¸€ã€‚


GC æ€§èƒ½æ–¹é¢çš„è€ƒè™‘ä¸»è¦æœ‰ 2 ä¸ªæ–¹é¢çš„æŒ‡æ ‡ï¼šååé‡ throughputï¼Œå’Œæš‚åœ pause æ—¶é—´ã€‚å³å·¥ä½œæ—¶é—´ä¸ç®— gc çš„æ—¶é—´å æ€»çš„æ—¶é—´æ¯”ï¼Œå’Œ gc å‘ç”Ÿæ—¶ app å¯¹å¤–æ˜¾ç¤ºçš„æ— æ³•å“åº”æ—¶é—´ã€‚

The Young Generation æ–°ç”Ÿä»£å¯¹äº app æµç•…æ€§è¿è¡Œå½±å“çš„å› ç´ ï¼Œyoung generation è¶Šå¤§ï¼Œminor collection è¶Šå°‘ï¼›ä½†æ˜¯åœ¨å›ºå®š heap size æƒ…å†µä¸‹ï¼Œæ›´å¤§çš„ young generation å°±æ„å‘³ç€å°çš„ tenured generationï¼Œå°±æ„å‘³ç€æ›´å¤šçš„ major collectionï¼Œmajor collection ä¼šå¼•å‘ minor collectionã€‚

GC æ—¶çš„ Stop the World(STW) æ˜¯å¤§å®¶æœ€å¤§çš„æ•Œäººã€‚ä½†å¯èƒ½å¾ˆå¤šäººè¿˜ä¸æ¸…æ¥šï¼Œé™¤äº† GCï¼ŒJVM ä¸‹è¿˜ä¼šå‘ç”Ÿåœé¡¿ç°è±¡ã€‚



å¸¸ç”¨ JVM å¯åŠ¨å‚æ•°ï¼š

|     å‚æ•°åç§°    |                        è¯´æ˜                        |
|-----------------|----------------------------------------------------|
| -Xms            | åˆå§‹å †å¤§å°ï¼Œç‰©ç†å†…å­˜çš„1/64(<1GB)                   |
| -Xmx            | æœ€å¤§å †å¤§å°ï¼Œç‰©ç†å†…å­˜çš„1/4(<1GB)                    |
| -Xmn            | å¹´è½»ä»£å¤§å°ï¼Œæ­¤å¤„çš„å¤§å°æ˜¯ï¼ˆeden+ 2 survivor space)  |
| -XX:PermSize    | è®¾ç½®æŒä¹…ä»£åˆå§‹å€¼ï¼Œç‰©ç†å†…å­˜çš„1/64                   |
| -XX:MaxPermSize | è®¾ç½®æŒä¹…ä»£æœ€å¤§å€¼ ç‰©ç†å†…å­˜çš„1/4                     |
| -Xss            | æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ï¼ŒJDK1.5ä»¥åä¸º1M                 |
| -XX:NewRatio    | å¹´è½»ä»£(åŒ…æ‹¬ Eden å’Œä¸¤ä¸ª Survivor åŒº)ä¸å¹´è€ä»£çš„æ¯”å€¼ |

- **-XXï¼šParallelGCThreads** å‚æ•°é™åˆ¶ ParNew çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹æ•°å’Œ CPU æ•°ç›¸åŒã€‚è¯¥æ”¶é›†å™¨æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•å›æ”¶å†…å­˜ï¼ŒæœŸé—´ä¼šåœæ­¢å…¶ä»–å·¥ä½œçº¿ç¨‹ï¼Œå³ Stop The Worldã€‚
- **-verbose:gc -XX:+PrintGCDetails** è¡¨ç¤ºè¾“å‡ºè™šæ‹Ÿæœºä¸­ GC çš„è¯¦ç»†æƒ…å†µã€‚é»˜è®¤ä½¿ç”¨ Parallel æ”¶é›†å™¨ï¼ˆæœåŠ¡å™¨ï¼‰ï¼ŒSerial æ”¶é›†å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ java -version æŸ¥çœ‹ã€‚
- **-XX:+UseSerialGC** è®¾ç½®æ”¶é›†å™¨ã€‚
- **-Xms20M -Xmx20M -Xmn10M** åˆ†åˆ«è®¾ç½®åˆå§‹å †å¤§å°å’Œæœ€å¤§å †å†…å­˜å¤§å°éƒ½æ˜¯ 20Mï¼Œæ–°ç”Ÿä»£å¤§å°ä¸º 10Mï¼Œå¦‚æœè®¾ç½®çš„å†…å®¹ä¸å¤Ÿç”¨å°±ä¼šè§¦å‘ OutOfMemoryError å¼‚å¸¸ã€‚
- **-XX:SurvivorRatio=8** è®¾ç½® eden ä¸ survuvor çš„æ¯”å€¼å¤§å° 8:1ï¼ŒJVM ä¼˜å…ˆæŠŠå¯¹è±¡æ”¾å…¥ Eden åŒºï¼Œå½“ Eden åŒºæ”¾ä¸ä¸‹äº†åï¼ˆ2 * 3 = 6Mï¼‰ï¼Œé€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶æ”¾å…¥è€å¹´ä»£ 6Mï¼ˆMinor GCï¼‰ï¼Œå†æŠŠæœ€åä¸€ä¸ª 4M æ”¾å…¥æ–°ç”Ÿä»£ã€‚
- **-XX:PretenureSizeThreshold=6M** è®¾ç½®å¤§æ–‡ä»¶å¤§å°ï¼Œå¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œç ”ç©¶è®¤ä¸ºå¤§å¯¹è±¡ä¸æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œå¦‚æœæ”¾åœ¨æ–°ç”Ÿä»£ï¼Œåˆ™éœ€è¦ä¸æ–­ç§»åŠ¨ï¼Œæ€§èƒ½è¾ƒå·®ã€‚
- **-XX:MaxTenuringThreshold** æœ€å¤§å¹´é¾„ï¼Œé»˜è®¤ä¸º 15ï¼Œå³ç»è¿‡è¿™ä¹ˆå¤šæ¬¡ GC è¿˜æ²¡æœ‰è¢«æ¸…ç†æ‰çš„æ–°ç”Ÿä»£ç å¯¹è±¡ä¼šæ™‹å‡ä¸ºé•¿æœŸå­˜æ´»å¯¹è±¡ï¼Œåˆ†é…åˆ°è€å¹´ä»£ã€‚
- **-XX:+HandlePromotionFailure=true** å¼€å¯ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥å…è®¸ï¼Œå–å‰é¢æ¯ä¸€æ¬¡å›æ”¶æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡å®¹é‡çš„å¹³å‡å€¼å¤§å°ä½œä¸ºç»éªŒå€¼ï¼Œä¸è€å¹´ä»£çš„å‰©ä½™ç©ºé—´è¿›è¡Œæ¯”è¾ƒï¼Œå†³å®šæ˜¯å¦ Full GC æ¥è®©è€å¹´ä»£è…¾å‡ºæ›´å¤šç©ºé—´ã€‚


æ€§èƒ½ä¼˜åŒ–å››ä¸ªå‘½ä»¤ï¼š

- **jps**ï¼šJava process status æŸ¥çœ‹ Java è¿›ç¨‹çŠ¶æ€
- **jstat**ï¼šæ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹è™šæ‹Ÿæœºåƒåœ¾å›æ”¶ï¼Œä¾‹å¦‚ï¼šjstat -gcutil $pid 1000 5
- **jmap**ï¼šæŸ¥çœ‹JVMå †ä¸­å¯¹è±¡è¯¦ç»†å ç”¨æƒ…å†µï¼Œä¾‹å¦‚ï¼šjmap -histo [pid]
- **jstack**ï¼šç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰çº¿ç¨‹å¿«ç…§ï¼Œjstack -l [pid]

JDK è‡ªå¸¦å¯è§†åŒ–ç›‘æ§å·¥å…· JConsoleï¼Œæ˜¯ä¸€ç§åŸºäº JMX çš„å¯è§†åŒ–ç›‘è§†ã€ç®¡ç†å·¥å…·å¯è¿›è¡Œå†…å­˜ç®¡ç†ã€çº¿ç¨‹ç®¡ç†ã€æŸ¥çœ‹æ­»é”ç­‰ã€‚ç›´æ¥æ‰§è¡Œ jconsole å‘½ä»¤å³å¯ï¼Œæºä»£ç åœ¨ tools.jar åŒ…ä¸­ã€‚




## âš¡ NIO - Non-blocking I/O
- [Java NIO æµ…æ](https://zhuanlan.zhihu.com/p/23488863)
- [Java1.4 ä» BIO æ¨¡å‹å‘å±•åˆ° NIO æ¨¡å‹](https://www.cnblogs.com/kendoziyu/p/java-develop-from-bio-to-nio.html)
- [Java NIO å¯¹è±¡åˆ†ç±»](https://www.cnblogs.com/jimoer/p/11575610.html)

Java 1.4 å¼•å…¥ java.nio åŒ…ï¼Œæ­£å¼æ”¯æŒ Non-blocking I/O æ¨¡å‹ã€‚

**NIO** - Non-blocking I/O ä¹Ÿç§°ä¸º New I/Oï¼Œæ˜¯ Java ä¸€ç§åŒæ­¥éé˜»å¡ I/O æ¨¡å‹ï¼Œä¹Ÿæ˜¯ I/O å¤šè·¯å¤ç”¨çš„åŸºç¡€ï¼Œå·²ç»è¢«è¶Šæ¥è¶Šå¤šåœ°åº”ç”¨åˆ°å¤§å‹åº”ç”¨æœåŠ¡å™¨ï¼Œæˆä¸ºè§£å†³é«˜å¹¶å‘ä¸å¤§é‡è¿æ¥ã€I/O å¤„ç†é—®é¢˜çš„æœ‰æ•ˆæ–¹å¼ã€‚

NIO çš„ 3 ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼šChannelã€Bufferã€Selectorã€‚

Channel æ˜¯å¯¹ IO è¾“å…¥/è¾“å‡ºç³»ç»Ÿçš„æŠ½è±¡ï¼Œæ˜¯ IO æºä¸ç›®æ ‡ä¹‹é—´çš„è¿æ¥é€šé“ï¼ŒNIO çš„é€šé“ç±»ä¼¼äºä¼ ç»Ÿ IO ä¸­çš„å„ç§â€œæµâ€ã€‚NIO æ¨¡å‹çš„ Channel ä¸­çš„æ•°æ®æµæ˜¯åŒå‘çš„ï¼Œç›¸å¯¹äº BIO Stream åˆ™æ˜¯å•å‘çš„ã€‚é€šé“çš„ä½œç”¨æ˜¯å°†æ•°æ®ç§»å…¥æˆ–ç§»å‡ºé“å„ç§ I/O æºï¼Œå³å¯è¯»åˆå¯å†™ã€‚

æ­¤å¤– Channel map() æ–¹æ³•å¯ä»¥å°†â€œä¸€å—â€æ•°æ®ç›´æ¥æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤ NIO å¯ä»¥è¯´æ˜¯é¢å‘å—å¤„ç†çš„ï¼Œè€Œä¼ ç»Ÿ I/O æ˜¯é¢å‘æµå¤„ç†çš„ã€‚ä½†æ˜¯ Channel æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°ç±»æœ‰ FileChannelã€SocketChannelã€ServerSocketChannelã€DatagramChannelï¼Œç¨‹åºä¸èƒ½ç›´æ¥è®¿é—® Channel ä¸­çš„æ•°æ®ï¼Œå¿…é¡»é€šè¿‡ Bufferï¼ˆç¼“å†²åŒºï¼‰ä½œä¸ºä¸­ä»‹ã€‚

Buffer æ˜¯ä¸€ä¸ªæŠ½è±¡å®¹å™¨ç±»å‹ï¼Œå…¶åº•å±‚æŒæœ‰äº†ä¸€ä¸ªå…·ä½“ç±»å‹çš„æ•°ç»„æ¥å­˜æ”¾å…·ä½“æ•°æ®ï¼Œé™¤ boolean ä¹‹å¤–çš„åŸºæœ¬æ•°æ®ç±»å‹éƒ½æœ‰å¯¹åº”çš„å®ç°ï¼Œæ¯”å¦‚ ByteBuffer å’Œ CharBufferï¼Œé€šè¿‡ Channel è¯»å†™çš„æ•°æ®éœ€è¦é€šè¿‡ Bufferã€‚

å…ˆæ¥è®¤è¯†å‡ ä¸ªæ¦‚å¿µï¼š

- Blocking é˜»å¡æ˜¯æŒ‡å½“æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šå‘å‡ºä¸€ä¸ªè¯·æ±‚æ“ä½œï¼Œå¦‚æœè¯¥è¯·æ±‚æ“ä½œéœ€è¦çš„æ¡ä»¶ä¸æ»¡è¶³çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³åï¼Œæ‰ç»§ç»­æ‰§è¡Œåé¢çš„å…¶ä»–å·¥ä½œã€‚
- Non-Blocking éé˜»å¡æ˜¯æŒ‡å½“æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šå‘å‡ºä¸€ä¸ªè¯·æ±‚æ“ä½œï¼Œå¦‚æœè¯¥è¯·æ±‚æ“ä½œéœ€è¦çš„æ¡ä»¶ä¸æ»¡è¶³çš„è¯ï¼Œä¼šç«‹å³è¿”å›ä¸€ä¸ªæ ‡å¿—ä¿¡æ¯å‘ŠçŸ¥æ¡ä»¶ä¸æ»¡è¶³ï¼Œè€Œä¸ä¼šä¸€ç›´åœ¨ç­‰å¾…ä¸‹å»ã€‚
- Synchronous I/O åŒæ­¥ IO æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ IO æ“ä½œæ—¶ï¼Œè¯¥çº¿ç¨‹åœ¨æ“ä½œå®Œæˆå‰ï¼Œæ˜¯ä¼šè¢«é˜»å¡çš„ã€‚
- Asynchronous I/O å¼‚æ­¥ IO æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ IO æ“ä½œæ—¶ï¼Œè¯¥çº¿ç¨‹å¹¶ä¸ä¼šè¢«é˜»å¡ã€‚ 

ä»è®¡ç®—æœºç¡¬ä»¶ä½“ç³»ç»“æ„ç†è§£ï¼ŒCPU çš„ä¸­æ–­ç³»ç»Ÿæä¾›äº†è¿™ä¸ªä¸€ä¸ªèƒ½åŠ›ï¼Œç¨‹åºåœ¨ç­‰å¾… I/O æ•°æ®è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå½“æ•°æ®åˆ°æ¥æ—¶è§¦å‘ä¸€ä¸ª I/O ä¸­æ–­å‘Šè¯‰ CPU å¯ä»¥ç»§ç»­æ‰§è¡Œå¤„äºé˜»å¡çŠ¶æ€çš„ç¨‹åºã€‚é˜»å¡æœŸé—´ï¼ŒCPU ä¸æ‰§è¡Œçº¿ç¨‹çš„ä»»ä½•å…¶å®ƒä»£ç ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä½•é˜»å¡çŠ¶å¤ªæ˜¯èŠ‚çœ CPU èµ„æºçš„ã€‚

æ ¹æ®ä¸åŒçš„åº”ç”¨åœºåˆï¼ŒåŒæ­¥æ€§å’Œé˜»å¡æ€§å¯ä»¥ç»„åˆåˆ°ä¸€èµ·ï¼š

- **åŒæ­¥é˜»å¡**ï¼Œæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§ç”¨æ³•ï¼Œä½¿ç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„ï¼Œä½†æ˜¯ I/O æ€§èƒ½ä¸€èˆ¬å¾ˆå·®ï¼ŒCPU å¤§éƒ¨åˆ†å¤„äºç©ºé—²çŠ¶æ€ï¼Œå³ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œä½†ä¼šæŸå¤±ç¨‹åºæ€§èƒ½ã€‚
- **åŒæ­¥éé˜»å¡**ï¼Œæå‡ I/O æ€§èƒ½çš„å¸¸ç”¨æ‰‹æ®µï¼Œå°±æ˜¯å°† I/O çš„é˜»å¡æ”¹ä¸ºéé˜»å¡æ–¹å¼ï¼Œå°¤å…¶åœ¨ç½‘ç»œ I/O æ˜¯é•¿è¿æ¥åŒæ—¶ä¼ è¾“æ•°æ®ä¹Ÿä¸å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œæå‡æ€§èƒ½éå¸¸æœ‰æ•ˆï¼Œä½†æ¶ˆè€— CPU æ—¶é—´ï¼Œéœ€è¦ä¸€ä¸ªå¹³è¡¡ã€‚
- **å¼‚æ­¥é˜»å¡**ï¼Œè¿™ç§æ–¹å¼åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸­ç»å¸¸ç”¨åˆ°ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ä¸­å†™ä¸€æ¡è®°å½•ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä»½æ˜¯åŒæ­¥é˜»å¡çš„è®°å½•ï¼Œè¿˜æœ‰ä»»æ„ä»½è®°å½•ä¼šå†™åˆ°å…¶ä»–æœºå™¨ä¸Šï¼Œè¿™äº›å¤‡ä»½è®°å½•é€šå¸¸éƒ½é‡‡ç”¨å¼‚æ­¥é˜»å¡çš„æ–¹å¼å†™ I/Oã€‚å¼‚æ­¥é˜»å¡å¯¹ç½‘ç»œI/Oèƒ½å¤Ÿæå‡æ•ˆç‡ï¼Œå°¤å…¶åƒä¸Šé¢è¿™ç§åŒæ—¶å†™å¤šä»½ç›¸åŒæ•°æ®çš„æƒ…å†µã€‚
- **å¼‚æ­¥éé˜»å¡**ï¼Œè¿™ç§ç»„åˆæ–¹å¼ç”¨èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œåªæœ‰åœ¨ä¸€äº›éå¸¸å¤æ‚çš„åˆ†å¸ƒå¼æƒ…å†µä¸‹ç”¨ï¼Œé›†ç¾¤ä¹‹é—´çš„æ¶ˆæ¯åŒæ­¥æœºåˆ¶ä¸€èˆ¬ç”¨è¿™ç§ I/O ç»„åˆæ–¹å¼ã€‚å®ƒé€‚åˆåŒæ—¶è¦ä¼ å¤šä»½ç›¸åŒçš„æ•°æ®åˆ°é›†ç¾¤ä¸­ä¸åŒçš„æœºå™¨ï¼ŒåŒæ—¶æ•°æ®çš„ä¼ è¾“é‡è™½ç„¶ä¸å¤§å´éå¸¸é¢‘ç¹çš„æƒ…å†µã€‚è¿™ç§ç½‘ç»œ I/O ç”¨æ­¤æ–¹å¼æ€§èƒ½è¾¾åˆ°æœ€é«˜ã€‚

ã€ŠUnix ç½‘ç»œç¼–ç¨‹ã€‹æŒ‡æ˜äº”ç§ I/O æ¨¡å‹ï¼Œè€Œ Java NIO ä½¿ç”¨çš„æ˜¯**å¤šè·¯ I/O å¤ç”¨æ¨¡å‹**ï¼Œå…¶å®ƒå››ç§ä»‹ç»å¦‚ä¸‹ï¼š

- **é˜»å¡ I/O æ¨¡å‹**ï¼Œæœ€å¸¸è§çš„ä¸€ç§ï¼Œä¸€ä¸ª read æ“ä½œåˆ†ä¸¤ä¸ªé˜¶æ®µï¼Œå…ˆç­‰å¾…æ•°æ®å‡†å¤‡å°±ç»ªï¼Œå†å°†æ•°æ®æ‹·è´åˆ°è°ƒç”¨çš„çº¿ç¨‹ä¸­ã€‚é˜»å¡æ˜¯å‘ç”Ÿåœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µçš„ï¼Œæ•°æ®å‡†å¤‡å¥½ä¹‹å‰ä¼šä¸€ç›´é˜»å¡ç”¨æˆ·çº¿ç¨‹ï¼Œå½“æ•°æ®å°±ç»ªåå†å°†æ•°æ®æ‹·è´åˆ°çº¿ç¨‹ä¸­ï¼Œå¹¶è¿”å›ç»“æœç»™ç”¨æˆ·çº¿ç¨‹ã€‚
- **éé˜»å¡ I/O æ¨¡å‹**ï¼Œå½“åº”ç”¨ç¨‹åºå‘èµ·ä¸€ä¸ª readæ“ä½œæ—¶ï¼Œå¹¶ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ç«‹åˆ»ä¼šæ”¶åˆ°ä¸€ä¸ªç»“æœï¼ŒæŒ‡ç¤ºæ•°æ®æ˜¯å‡†å¤‡å¥½äº†æ²¡æœ‰ã€‚åˆ¤æ–­è¿”å›ç»“æœæ˜¯ä¸€ä¸ªé”™è¯¯çŠ¶æ€ï¼Œå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå¯ä»¥å†æ¬¡æ‰§è¡Œ read æ“ä½œç›´åˆ°ç³»ç»Ÿå°†æ•°æ®æ‹·è´åˆ°äº†çº¿ç¨‹çš„å†…å­˜ä¸­ï¼Œè¯»å–å‡ºæ¥ã€‚
- **ä¿¡å·é©±åŠ¨ I/O æ¨¡å‹**ï¼Œè®©å†…æ ¸åœ¨æ•°æ®æŠ¥å‡†å¤‡å°±ç»ªæ—¶å‘é€ SIGIO ä¿¡å·é€šçŸ¥ç”¨æˆ·çº¿ç¨‹ã€‚é¦–å…ˆå¼€å¯å¥—æ¥å­—çš„ä¿¡å·é©±åŠ¨å¼ I/O åŠŸèƒ½ï¼Œå¹¶é€šè¿‡ sigaction ç³»ç»Ÿè°ƒç”¨å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚è¯¥ç³»ç»Ÿè°ƒç”¨å°†ç«‹å³è¿”å›ï¼Œè¿›ç¨‹ç»§ç»­å·¥ä½œï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰è¢«é˜»å¡ã€‚å½“æ•°æ®æŠ¥å‡†å¤‡å¥½è¯»å–æ—¶ï¼Œå†…æ ¸å°±ä¸ºè¯¥è¿›ç¨‹äº§ç”Ÿä¸€ä¸ª SIGIO ä¿¡å·ã€‚æˆ‘ä»¬éšåå°±å¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ recvfrom è¯»å–æ•°æ®æŠ¥ï¼Œå¹¶é€šçŸ¥ç”¨æˆ·è¿›ç¨‹æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥è¯»å–äº†ã€‚
- **å¼‚æ­¥ I/O æ¨¡å‹**ï¼Œå½“ç”¨æˆ·çº¿ç¨‹å‘èµ· read æ“ä½œæ—¶ï¼Œå‘ŠçŸ¥å†…æ ¸å¯åŠ¨è¯»å–æ•°æ®æ“ä½œï¼Œå¹¶è®©å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œå®Œæˆåé€šçŸ¥ç¨‹åºï¼ŒåŒ…æ‹¬å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°ç¨‹åºè‡ªå·±çš„ç¼“å†²åŒºã€‚è¿™æ ·åœ¨å†…æ ¸æ‰§è¡Œè¯»å–æ•°æ®æ“ä½œæ—¶ï¼Œç”¨æˆ·çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå½“æ¥æ”¶åˆ°å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œéƒ½å®Œæˆçš„ä¿¡å·æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥å»ä½¿ç”¨æ•°æ®äº†ã€‚


éšç€ç½‘ç»œè®¾è®¡æ¨¡å¼çš„å…´èµ·ï¼ŒReactor å’Œ Proactor äº‹ä»¶å¤„ç†æ¨¡å¼åº”è¿è€Œç”Ÿï¼Œæ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ç§é«˜æ€§èƒ½ I/O è®¾è®¡æ¨¡å¼ï¼š

- Reactor å“åº”å¼æ¨¡å¼

	- åº”ç”¨ç¨‹åºåœ¨ Reactor ä¸­æ³¨å†Œ Ready for Read è¯»å°±ç»ªäº‹ä»¶å’Œç›¸å…³è”çš„äº‹ä»¶å¤„ç†å™¨
	- Reactor é˜»å¡ç­‰å¾…å†…æ ¸äº‹ä»¶é€šçŸ¥
	- Reactor æ”¶åˆ°é€šçŸ¥ï¼Œç„¶ååˆ†å‘å¯è¯»å†™äº‹ä»¶åˆ°ç”¨æˆ·äº‹ä»¶å¤„ç†å‡½æ•°
	- ç”¨æˆ·è¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†æ•°æ®
	- äº‹ä»¶å¤„ç†å™¨å®Œæˆå®é™…çš„è¯»æ“ä½œï¼Œå¤„ç†è¯»åˆ°çš„æ•°æ®ï¼Œæ³¨å†Œæ–°çš„äº‹ä»¶ï¼Œç„¶åè¿”è¿˜æ§åˆ¶æƒã€‚

- Proactor ä¸»åŠ¨æ¨¡å¼

	- åº”ç”¨ç¨‹åºåˆå§‹åŒ–ä¸€ä¸ªå¼‚æ­¥è¯»å–æ“ä½œï¼Œç„¶åæ³¨å†Œç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼Œæ­¤æ—¶äº‹ä»¶å¤„ç†å™¨ä¸å…³æ³¨è¯»å–å°±ç»ªäº‹ä»¶ï¼Œè€Œæ˜¯å…³æ³¨è¯»å–å®Œæˆäº‹ä»¶ï¼Œè¿™æ˜¯åŒºåˆ«äº Reactor çš„å…³é”®ã€‚
	- äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…è¯»å–æ“ä½œå®Œæˆäº‹ä»¶
	- åœ¨äº‹ä»¶åˆ†ç¦»å™¨ç­‰å¾…è¯»å–æ“ä½œå®Œæˆçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè°ƒç”¨å†…æ ¸çº¿ç¨‹å®Œæˆè¯»å–æ“ä½œï¼Œå¹¶å°†è¯»å–çš„å†…å®¹æ”¾å…¥ç”¨æˆ·ä¼ é€’è¿‡æ¥çš„ç¼“å­˜åŒºä¸­ã€‚è¿™ä¹Ÿæ˜¯åŒºåˆ«äº Reactor çš„ä¸€ç‚¹ï¼Œæ‰€ä»¥ Proactor åº”ç”¨ç¨‹åºéœ€è¦ä¼ é€’ç¼“å­˜åŒºã€‚
	- äº‹ä»¶åˆ†ç¦»å™¨æ•è·åˆ°è¯»å–å®Œæˆäº‹ä»¶åï¼Œæ¿€æ´»åº”ç”¨ç¨‹åºæ³¨å†Œçš„äº‹ä»¶å¤„ç†å™¨ï¼Œäº‹ä»¶å¤„ç†å™¨ç›´æ¥ä»ç¼“å­˜åŒºè¯»å–æ•°æ®ï¼Œè€Œä¸éœ€è¦è¿›è¡Œå®é™…çš„è¯»å–æ“ä½œã€‚

Reactor æ¨¡å¼è¦æ±‚ä¸»çº¿ç¨‹åªä½œä¸º I/O å¤„ç†å•å…ƒï¼Œåªè´Ÿè´£ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæœ‰çš„è¯å°±ç«‹å³å°†è¯¥äº‹ä»¶é€šçŸ¥å·¥ä½œçº¿ç¨‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸»çº¿ç¨‹ä¸åšä»»ä½•å…¶ä»–å®è´¨æ€§çš„å·¥ä½œã€‚ è¯»å†™æ•°æ®ï¼Œæ¥å—æ–°çš„è¿æ¥ï¼Œä»¥åŠå¤„ç†å®¢æˆ·è¯·æ±‚å‡åœ¨å·¥ä½œçº¿ç¨‹ä¸­å®Œæˆã€‚è€Œ Proactor æ¨¡å¼å°†æ‰€æœ‰ I/O æ“ä½œéƒ½äº¤ç»™ä¸»çº¿ç¨‹å’Œå†…æ ¸æ¥å¤„ç†ï¼Œå·¥ä½œçº¿ç¨‹ä»…ä»…è´Ÿè´£ä¸šåŠ¡é€»è¾‘ã€‚

å¼‚æ­¥ I/O æ¨¡å‹å°±æ˜¯ä½¿ç”¨çš„ Proactor æ¨¡å¼ï¼ŒJava NIO å¤šè·¯ I/O å¤ç”¨æ¨¡å‹ä¸­ä½¿ç”¨ Reactor æ¨¡å¼ã€‚


æ‰€ä»¥å¤šè·¯å¤ç”¨ I/O æ¨¡å‹å’Œéé˜»å¡ I/O æœ‰ç±»ä¼¼ä¹‹å¤„ï¼Œä½†æ˜¯å¤šè·¯å¤ç”¨ I/O æ¨¡å‹çš„æ•ˆç‡æ˜¯æ¯”éé˜»å¡ I/O æ¨¡å‹è¦é«˜çš„ï¼Œå› ä¸ºåœ¨éé˜»å¡ I/O ä¸­ï¼Œä¸æ–­çš„è¯¢é—® scoket çŠ¶æ€çš„æ˜¯é€šè¿‡ç”¨æˆ·çº¿ç¨‹å»è¿›è¡Œçš„ï¼Œè€Œå¤šè·¯å¤ç”¨ I/O æ¨¡å‹ï¼Œè½®è¯¢æ¯ä¸ª scoket çŠ¶æ€æ˜¯å†…æ ¸è¿›è¡Œå¤„ç†çš„ï¼Œç»“åˆç¡¬ä»¶åº•å±‚å®ç°æ•ˆç‡è¿œæ¯”ç”¨æˆ·çº¿ç¨‹å®ç°è¦é«˜å¾—å¤šçš„ï¼Œå› æ­¤å¤šè·¯å¤ç”¨ I/O æ¨¡å‹æ¯”è¾ƒé€‚åˆé«˜å¹¶å‘åº”ç”¨ä¸­ä½¿ç”¨ã€‚

ä¸è¿‡æ­¤æ¨¡å‹ä¹Ÿæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œç”±äºå¤šè·¯å¤ç”¨ I/O æ¨¡å‹æ˜¯é€šè¿‡è½®è¯¢çš„æ–¹å¼æ¥æ£€æµ‹æ˜¯å¦æœ‰äº‹ä»¶åˆ°è¾¾ï¼Œå¹¶å¯¹åˆ°è¾¾çš„äº‹ä»¶é€ä¸€å“åº”ï¼Œä¸€æ—¦äº‹ä»¶å“åº”ä½“å¾ˆå¤§æˆ–æ˜¯å“åº”äº‹ä»¶æ•°é‡è¿‡å¤šï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡çš„æ—¶é—´å»å¤„ç†äº‹ä»¶ï¼Œä»è€Œå½±å“æ•´ä¸ªè¿‡ç¨‹çš„åŠæ—¶æ€§ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µ Linux ç³»ç»Ÿæä¾›äº† epoll æ¥å£ï¼Œä½†æ˜¯é™¤äº† Linux å…¶ä»–æ“ä½œç³»ç»Ÿå¯¹ epoll æ¥å£çš„æ”¯æŒåˆæœ‰å¾ˆå¤šå·®å¼‚ï¼Œæ‰€ä»¥è™½ç„¶ epoll è§£å†³äº†äº‹ä»¶æ£€æµ‹çš„æ—¶æ•ˆæ€§é—®é¢˜ï¼Œä½†æ˜¯åœ¨è·¨å¹³å°èƒ½åŠ›ä¸Šå´å¹¶ä¸èƒ½å¾—åˆ°å¾ˆå¥½çš„æ”¯æŒã€‚
 

Java NIO ä½¿ç”¨çš„å¤šè·¯ I/O å¤ç”¨æ¨¡å‹ï¼Œæœ‰ä¸‰ä¸ªåŸºç¡€æ¦‚å¿µï¼š

- Channel é€šé“

	Channel å¯ä»¥ç†è§£ä¸ºäº’é€šçš„ç®¡é“ï¼Œå’Œ Java IO å„ç§ Streamï¼Œå¦‚ InputStreamã€OutputStream ç±»ä¼¼ï¼Œåªä¸è¿‡ Channel æ˜¯åŒå‘çš„ï¼Œè€Œ Stream æ˜¯å•å‘çš„ã€‚é€šé“çš„ä½œç”¨æ˜¯å°†æ•°æ®ç§»å…¥æˆ–ç§»å‡ºé“å„ç§ I/O æºï¼Œå³å¯è¯»åˆå¯å†™ã€‚

	Channel ç±»å±‚æ¬¡ç»“æ„ç›¸å½“å¤æ‚ï¼Œæœ‰å¤šä¸ªæ¥å£å’Œè®¸å¤šå¯é€‰æ“ä½œï¼Œå¸¸ç”¨çš„ä¹Ÿå°±å‡ ä¸ªï¼š

	- FileChannel å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè¯»å’Œå†™ï¼›
	- DatagramChannel å¯ä»¥ä»¥ UDP çš„åè®®æ¥è¿›è¡Œæ•°æ®è¯»å†™ï¼›
	- SocketChannel ä»¥ TCP çš„åè®®æ¥å¯¹ç½‘ç»œä¸¤ç«¯è¿›è¡Œè¯»å†™ï¼›
	- ServerSocketChanel èƒ½å¤Ÿç›‘å¬å®¢æˆ·ç«¯ TCP è¿æ¥ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ SocketChannel æ¥è¿›è¡Œæ•°æ®è¯»å†™ã€‚

	é€šè¿‡ selector.select() å»æŸ¥è¯¢æ¯ä¸ªé€šé“æ˜¯å¦æœ‰åˆ°è¾¾äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰äº‹ä»¶ï¼Œåˆ™ä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå› æ­¤å¤šè·¯å¤ç”¨ I/O æ¨¡å‹ä¹Ÿä¼šé˜»å¡ç”¨æˆ·çº¿ç¨‹ï¼Œåªä¸è¿‡çº¿ç¨‹æ˜¯è¢« select() å‡½æ•°é˜»å¡çš„è€Œä¸æ˜¯è¢« scoket é˜»å¡çš„ã€‚

- Buffer ç¼“å†²åŒº

	Buffer æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®å®¹å™¨ï¼Œåœ¨ NIO ä¸­æ‰€æœ‰çš„æ•°æ®æ“ä½œéƒ½å¿…é¡»ç»è¿‡ç¼“å†²åŒºï¼Œè¿™ç‚¹æ˜¯å’Œ BIO ä¸åŒçš„ï¼ŒBIOæ˜¯ç›´æ¥å°†æ•°æ®å†™åˆ° Stream å¯¹è±¡ä¸­çš„ã€‚å› ä¸º Stream å¯¹è±¡çš„è®¾è®¡æ˜¯æŒ‰é¡ºåºä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„ä¼ é€æ•°æ®ã€‚è™½ç„¶å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä¹Ÿå¯ä»¥ä¼ é€’å­—èŠ‚æ•°ç»„ï¼Œä½†æ˜¯åŸºæœ¬æ¦‚å¿µéƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„ä¼ é€’æ•°æ®ã€‚é€šé“ä¸ä¹‹ä¸åŒä¹‹å¤„åœ¨äºï¼Œé€šé“ä¼šä¼ é€ç¼“å†²åŒºçš„æ•°æ®å—ï¼Œè€Œä¸”é€šé“çš„åŸºæœ¬æ¦‚å¿µå°±æ˜¯æŒ‰ç…§ä¸€ä¸ªæ•°æ®å—ä¸€ä¸ªæ•°æ®å—çš„å»è¯»å’Œå†™ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥å°†ç¼“å†²åŒºç†è§£ä¸ºä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨ä»¥åŠå‡†å¤‡å¥½å‡ºå…¥é€šé“çš„å­—èŠ‚ã€‚

	æ— è®ºæ˜¯å®¢æˆ·ç«¯å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿˜æ˜¯æœåŠ¡ç«¯æ¥æ”¶å’Œç›¸åº”æ•°æ®ï¼Œéƒ½æ˜¯ä»ç¼“å†²åŒºä¸­è¿›è¡Œæ•°æ®æ“ä½œçš„ã€‚

- Selector é€‰æ‹©å™¨

	Selector æ˜¯ Java NIO ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒç”¨å•çº¿ç¨‹æ¥è½®è¯¢å¤„ç†æ³¨å†Œçš„ Channelï¼Œä¸€æ—¦å“ªä¸ª Channel çš„æ•°æ®å‡†å¤‡å°±ç»ªäº†ï¼Œå°±å¯ä»¥è¿›è¡Œå¤„ç†äº†ã€‚


Buffer ç¼“å†²åŒºçš„å¸¸ç”¨å±æ€§ä»‹ç»

åœ¨ Java ä¸­é™¤äº† boolean å¤–ï¼Œæ‰€æœ‰çš„åŸºæœ¬æ•°æ®ç±»å‹éƒ½æœ‰ç‰¹å®šçš„ Buffer å­ç±»ï¼ŒByteBufferã€CharBufferã€DoubleBufferã€FloatBufferã€IntBufferã€LongBufferã€ShortBufferã€‚ç½‘ç»œç¨‹åºå‡ ä¹åªä¼šä½¿ç”¨ ByteBufferï¼Œä½†ç¨‹åºå¶å°”ä¹Ÿä¼šä½¿ç”¨å…¶ä»–ç±»å‹æ¥å–ä»£ ByteBufferã€‚

é™¤äº†æ•°æ®åˆ—è¡¨å¤–ï¼Œæ¯ä¸ªç¼“å†²åŒºéƒ½è®°å½•äº†ä¿¡æ¯çš„ 4 ä¸ªå…³é”®éƒ¨åˆ†ã€‚æ— è®ºæ˜¯ä½•ç§ç±»å‹ï¼Œéƒ½æœ‰ç›¸åŒçš„æ–¹æ³•æ¥è·å–å’Œè®¾ç½®è¿™äº›å€¼ï¼š

- ä½ç½® position

	ç¼“å†²åŒºä¸­å°†è¯»å–æˆ–å†™å…¥çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œ0 å¼€å§‹è®¡ï¼Œæœ€å¤§å€¼ç­‰äºç¼“å†²åŒºçš„å¤§å°ã€‚

		public final int position();
		public final Buffer position(int newPosition);

- å®¹é‡ capacity

	ç¼“å†²åŒºå¯ä»¥ä¿å­˜çš„æœ€å¤§æ•°ç›®ï¼Œå®¹é‡å€¼åœ¨åˆ›å»ºç¼“å†²åŒºæ—¶è®¾ç½®ï¼Œæ­¤åä¸èƒ½æ”¹å˜ã€‚

		public final int capacity();

- é™åº¦ limit

	ç¼“å†²åŒºä¸­å¯è®¿é—®æ•°æ®çš„æœ«å°¾ä½ç½®ï¼Œåªè¦ä¸æ”¹å˜é™åº¦ï¼Œå°±æ— æ³•è¯»/å†™è¶…è¿‡è¿™ä¸ªä½ç½®çš„æ•°æ®ï¼Œå³ä½¿ç¼“å†²åŒºæœ‰æ›´å¤§çš„å®¹é‡ä¹Ÿæ²¡æœ‰ç”¨ã€‚

		public final int limit();
		public final Buffer limit(int newLimit);

- æ ‡è®° mark

	ç¼“å†²åŒºä¸­å®¢æˆ·ç«¯æŒ‡å®šçš„ç´¢å¼•ï¼Œé€šè¿‡ mark() å¯ä»¥å°†æ ‡è®°è®¾ç½®ä¸ºå½“å‰ä½ç½®ã€‚è°ƒç”¨ reset() å¯ä»¥å°†å½“å‰ä½ç½®è®¾ç½®ä¸ºæ‰€æ ‡è¯†çš„ä½ç½®ã€‚

		public final Buffer mark() ;
		public final Buffer reset();

	å¦‚æœå°†ä½ç½®è®¾ç½®ä¸ºä½äºç°æœ‰æ ‡è®°ï¼Œåˆ™ä¸¢å¼ƒè¿™ä¸ªæ ‡è®°ã€‚

ä¸è¯»å– InputStream ä¸åŒï¼Œè¯»å–ç¼“å†²åŒºå®é™…ä¸Šä¸ä¼šä»¥ä»»ä½•æ–¹å¼æ”¹å˜ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚åªå¯èƒ½å‘å‰æˆ–å‘åè®¾ç½®ä½ç½®ï¼Œä»è€Œå¯ä»¥ä»ç¼“å†²åŒºä¸­æŸä¸ªç‰¹å®šä½ç½®å¼€å§‹è¯»å–ã€‚ç±»ä¼¼çš„ç¨‹åºå¯ä»¥è°ƒæ•´é™åº¦ï¼Œä»è€Œæ§åˆ¶å°†è¦è¯»å–çš„æ•°æ®çš„æœ«å°¾ã€‚


Selector ä½¿ç”¨ä»‹ç»

é¦–å…ˆè¦å…ˆå‘ Selector ä¸­æ³¨å†Œ Channelï¼Œç„¶åè°ƒç”¨å®ƒçš„ select() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°æŸä¸ªæ³¨å†Œçš„ Channel ä¸­çš„äº‹ä»¶å‡†å¤‡å°±ç»ªã€‚ä¸€æ—¦ select() æ–¹æ³•è¿”å›ï¼Œçº¿ç¨‹å°±å¯ä»¥å¤„ç†è¿™äº›äº‹ä»¶äº†ï¼Œæ¯”å¦‚æ–°çš„è¿æ¥è¿›å…¥ï¼Œæ•°æ®æ¥æ”¶ç­‰ã€‚

Selector ç±»å¹¶æ²¡æœ‰æ³¨å†Œæ–°é€šé“çš„æ–¹æ³•ï¼Œregister() æ–¹æ³•åœ¨ SelectableChannel ç±»ä¸­å£°æ˜ï¼Œå®ƒå®ç°äº† Channel æ¥å£ï¼Œå®ƒæ”¯æŒå°† Channel æ³¨å†Œåˆ° Selector ä¸­ã€‚

	public abstract SelectionKey register(Selector sel, int ops, Object att) throws ClosedChannelException;
	public final SelectionKey register(Selector sel, int ops) throws ClosedChannelException;

ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨é€šé“è¦å‘å“ªä¸ªé€‰æ‹©å™¨æ³¨å†Œï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ SelectionKey ç±»ä¸­çš„ä¸€ä¸ªå‘½åå¸¸é‡ï¼Œæ ‡è¯†æ‰€æ³¨å†Œçš„æ“ä½œï¼š

	SelectionKey.OP_READ;
	SelectionKey.OP_WRITE;
	SelectionKey.OP_CONNECT;
	SelectionKey.OP_ACCEPT;

å½“ä¸€ä¸ªé€šé“éœ€è¦åœ¨åŒä¸€ä¸ªé€‰æ‹©å™¨ä¸­å…³æ³¨å¤šä¸ªæ“ä½œï¼Œåªéœ€è¦ç”¨æˆ·ä½æ“ä½œç¬¦ç»„åˆè¿™äº›å¸¸é‡å³å¯ã€‚

	channel.register(selector,SelectionKey.OP_READ | SelectionKey.OP_WRITE);

ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œä»£è¡¨é”®çš„é™„ä»¶ã€‚è¿™ä¸ªå‚æ•°é€šå¸¸ç”¨æˆ·å­˜å‚¨é“¾æ¥çŠ¶æ€ï¼Œä¾‹å¦‚è¦å®ç°ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œå¯èƒ½è¦é™„åŠ ä¸€ä¸ª FileInputStream æˆ– FileChannelï¼Œè¿™ä¸ªæµæˆ–é€šé“è¿æ¥åˆ°æœåŠ¡å™¨æä¾›ç»™å®¢æˆ·ç«¯çš„æœ¬åœ°æ–‡ä»¶ã€‚

ä¾‹å­ï¼Œå¤åˆ¶æ–‡ä»¶çš„è¯»å†™æ“ä½œå¤§è‡´è¿‡ç¨‹ï¼š

	public static void copyFileByNIO(String src,String dst) throws IOException {

	    //å£°æ˜æºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶
	    RandomAccessFile aFile = new RandomAccessFile(src, "rw");
	    RandomAccessFile bFile = new RandomAccessFile(dst, "rw");

	    //è·å¾—ä¼ è¾“é€šé“channel
	    FileChannel inChannel = aFile.getChannel();
	    FileChannel outChannel = bFile.getChannel();
	    //è·å¾—å®¹å™¨buffer
	    ByteBuffer buffer= ByteBuffer.allocate(1024);
	    while(true){
	        //åˆ¤æ–­æ˜¯å¦è¯»å®Œæ–‡ä»¶
	        int eof =inChannel.read(buffer);
	        if(eof==-1){
	            break;
	        }
	        //é‡è®¾ä¸€ä¸‹bufferçš„position=0ï¼Œlimit=position
	        buffer.flip();
	        //å¼€å§‹å†™
	        outChannel.write(buffer);
	        //å†™å®Œè¦é‡ç½®bufferï¼Œé‡è®¾position=0,limit=capacity
	        buffer.clear();
	    }
	    inChannel.close();
	    outChannel.close();
	    aFile.close();
	    bFile.close();
	} 


## âš¡ NIO & Netty
- [Netty in Action](https://www.w3cschool.cn/essential_netty_in_action/)
- [åŸºäº Netty å®ç° RpcKids æ¡†æ¶](https://zhuanlan.zhihu.com/p/35720383)
- [åŸºäº Netty å®ç° MvcKids æ¡†æ¶](https://zhuanlan.zhihu.com/p/36064672)

æ—§å¼ BIO - Blocking I/O æ¨¡å‹åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥ä¹‹åï¼ŒæœåŠ¡ç«¯å°±ä¼šç«‹å³åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯æœåŠ¡ç«¯åˆéœ€è¦é˜»å¡çº¿ç¨‹æ¥ç­‰å¾…è¯»å–å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚è¿™æ ·å°±éœ€è¦ä¸æ–­åˆ›å»ºæ–°çš„çº¿ç¨‹åº”å¯¹ä¸æ–­å¢åŠ çš„æœåŠ¡ç«¯è¯·æ±‚ï¼Œè€Œåˆ›å»ºçº¿ç¨‹æ˜¯éœ€è¦æ¶ˆè€—æœåŠ¡å™¨æ€§èƒ½çš„ã€‚é‚£ä¹ˆå¯ä¸å¯ä»¥ç­‰å®¢æˆ·ç«¯æ•°æ®åˆ°è¾¾åå†åˆ†é…çº¿ç¨‹è¿›è¡Œå¤„ç†å‘¢ï¼ŸSelector ä»¥åŠåŸºäºäº‹ä»¶å¤„ç†çš„ NIO æ¨¡å‹åº”è¿è€Œç”Ÿã€‚

BIO æ–¹å¼ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†éå¸¸æ¶ˆè€— CPU èµ„æºï¼Œç‰¹åˆ«æ˜¯å¯¹äº HTTP è¿™ç§çŸ­è¿æ¥åè®®ï¼Œå°±ç®—åŠ å…¥äº†çº¿ç¨‹æ± ä¹Ÿä¸èƒ½å®Œç¾è§£å†³ BIO çš„ç¼ºé™·ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ NIO è¿›è¡ŒæœåŠ¡å™¨çš„ä¼˜åŒ–ï¼ŒNIO åŸºäº I/O å¤šè·¯å¤ç”¨å®ç°å•çº¿ç¨‹å¤„ç†å¤§é‡è¿æ¥ï¼Œä½†æ˜¯ç¼–å†™èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥é€‰æ‹© Netty å®ç°ã€‚

JBOSS æä¾›çš„ Netty æ˜¯ä¸€ä¸ª Java å¼€æºæ¡†æ¶ã€‚Netty æä¾›å¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶å’Œå·¥å…·ï¼Œç”¨ä»¥å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒNetty æ˜¯ä¸€ä¸ªåŸºäº NIO çš„å®¢æˆ·ã€æœåŠ¡å™¨ç«¯ç¼–ç¨‹æ¡†æ¶ï¼Œä½¿ç”¨ Netty å¯ä»¥ç¡®ä¿ä½ å¿«é€Ÿå’Œç®€å•çš„å¼€å‘å‡ºä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œä¾‹å¦‚ï¼Œå®ç°äº†æŸç§åè®®çš„å®¢æˆ·ï¼ŒæœåŠ¡ç«¯åº”ç”¨ã€‚Netty ç›¸å½“ç®€åŒ–å’Œæµçº¿åŒ–äº†ç½‘ç»œåº”ç”¨çš„ç¼–ç¨‹å¼€å‘è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼ŒTCP/UDP çš„ socket æœåŠ¡å¼€å‘ã€‚

Netty æœ‰å“ªäº›æ–°å¢ç‰¹æ€§ï¼Ÿ

- èƒ½å¤Ÿæ›´ç®€å•åœ°å¤„ç†å¤§å®¹é‡æ•°æ®æµï¼›
- èƒ½å¤Ÿæ›´ç®€å•åœ°å¤„ç†åè®®ç¼–ç å’Œå•å…ƒæµ‹è¯•ï¼›
- I/O è¶…æ—¶å’Œ idle çŠ¶æ€æ£€æµ‹ï¼›
- åº”ç”¨ç¨‹åºçš„å…³é—­æ›´ç®€å•ï¼Œæ›´å®‰å…¨ï¼›
- æ›´å¯é çš„ OutOfMemoryError é¢„é˜²ã€‚

Netty æ˜¯ä¼˜ç§€çš„ Java ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒæä¾›äº†å¯¹ Java NIO API çš„å°è£…ï¼Œå±è”½äº†ç¹æ‚çš„ç¼–ç¨‹ç»†èŠ‚ï¼Œè®©å¼€å‘è€…å¯ä»¥æ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚å¾ˆå¤šä¸­é—´ä»¶éƒ½æ˜¯åŸºäº Netty æ¥å®ç°çš„ï¼Œä½ å¯ä»¥ç”¨æ¥å®ç°ä¸€ä¸ª Web å®¹å™¨ï¼Œä¹Ÿèƒ½å†™ä¸€ä¸ªæ¸¸æˆæœåŠ¡å™¨ã€‚å­¦ä¹  Netty èƒ½å¤Ÿè®©ä½ æ›´åŠ ç†Ÿæ‚‰ç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒã€‚

åœ¨ç½‘ç»œå‘å±•åˆæœŸï¼Œéœ€è¦èŠ±å¾ˆå¤šæ—¶é—´æ¥å­¦ä¹  socket çš„å¤æ‚ï¼Œå¯»å€ç­‰ç­‰ï¼Œåœ¨ C socket åº“ä¸Šè¿›è¡Œç¼–ç ï¼Œå¹¶éœ€è¦åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šåšä¸åŒçš„å¤„ç†ã€‚Java æ—©æœŸç‰ˆæœ¬(1995-2002)ä»‹ç»äº†è¶³å¤Ÿçš„é¢å‘å¯¹è±¡çš„ç³–è¡£æ¥éšè—ä¸€äº›å¤æ‚æ€§ï¼Œä½†å®ç°å¤æ‚çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åè®®ä»ç„¶éœ€è¦å¤§é‡çš„æ ·æ¿ä»£ç ï¼Œå’Œè¿›è¡Œå¤§é‡çš„ç›‘è§†æ‰èƒ½ç¡®ä¿ä»–ä»¬æ˜¯å¯¹çš„ã€‚è¿™äº›æ—©æœŸçš„ Java APIï¼ˆjava.netï¼‰åªèƒ½é€šè¿‡åŸç”Ÿçš„ socket åº“æ¥æ”¯æŒæ‰€è°“çš„â€œblockingï¼ˆé˜»å¡ï¼‰â€çš„åŠŸèƒ½ã€‚

- ServerSocket åˆ›å»ºå¹¶ç›‘å¬ç«¯å£çš„è¿æ¥è¯·æ±‚
- accept() è°ƒç”¨é˜»å¡ï¼Œç›´åˆ°ä¸€ä¸ªè¿æ¥è¢«å»ºç«‹äº†ã€‚è¿”å›ä¸€ä¸ªæ–°çš„ Socket ç”¨æ¥å¤„ç† å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„äº¤äº’
- æµè¢«åˆ›å»ºç”¨äºå¤„ç† socket çš„è¾“å…¥å’Œè¾“å‡ºæ•°æ®ã€‚BufferedReader è¯»å–ä»å­—ç¬¦è¾“å…¥æµé‡Œé¢çš„æœ¬æ–‡ã€‚PrintWriter æ‰“å°æ ¼å¼åŒ–å±•ç¤ºçš„å¯¹è±¡è¯»åˆ°æœ¬æ–‡è¾“å‡ºæµ
- å¤„ç†å¾ªç¯å¼€å§‹ readLine() é˜»å¡ï¼Œè¯»å–å­—ç¬¦ä¸²ç›´åˆ°æœ€åæ˜¯æ¢è¡Œæˆ–è€…è¾“å…¥ç»ˆæ­¢ã€‚
- å¦‚æœå®¢æˆ·ç«¯å‘é€çš„æ˜¯â€œDoneâ€å¤„ç†å¾ªç¯é€€å‡º
- æ‰§è¡Œæ–¹æ³•å¤„ç†è¯·æ±‚ï¼Œè¿”å›æœåŠ¡å™¨çš„å“åº”
- å“åº”å‘å›å®¢æˆ·ç«¯
- å¤„ç†å¾ªç¯ç»§ç»­


"New"è¿˜æ˜¯"Nonblocking"?

åœ¨ 2002 å¹´ Java 1.4 å¼•å…¥äº†éé˜»å¡ API åœ¨ java.nio åŒ…ã€‚NIO æœ€åˆæ˜¯ä¸º New Input/Output çš„ç¼©å†™ï¼Œç„¶è€Œï¼ŒJava çš„ API å·²ç»å­˜åœ¨è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œå®ƒä¸å†æ˜¯æ–°çš„ã€‚ç°åœ¨æ™®éä½¿ç”¨çš„ç¼©å†™æ¥è¡¨ç¤º Nonblocking I/Oã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€èˆ¬é˜»å¡ I/O ä¸º OIO æˆ– Old Input/Outputã€‚

NIO å¾ˆé‡è¦çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†æ˜¯ Selectorï¼Œå®ƒæœ€ç»ˆå†³å®šå·²æ³¨å†Œçš„ socket å“ªä¸€ç»„å¯ä»¥å‡†å¤‡æ‰§è¡Œ I/O æ“ä½œã€‚Selector é€šçŸ¥ç›®æ ‡çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥ã€‚ä¸€ä¸ª Selector ç”±ä¸€ä¸ªçº¿ç¨‹é€šå¸¸å¤„ç†ï¼Œä½†å…·ä½“å®æ–½å¯ä»¥ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ã€‚å› æ­¤ï¼Œæ¯æ¬¡è¯»æˆ–å†™æ“ä½œæ‰§è¡Œèƒ½ç«‹å³æ£€æŸ¥å®Œæˆã€‚æ€»ä½“è€Œè¨€ï¼Œè¯¥æ¨¡å‹æä¾›äº†æ¯” é˜»å¡ I/O æ¨¡å‹ æ›´å¥½çš„èµ„æºä½¿ç”¨ï¼Œå› ä¸ºå¯ä»¥ç”¨è¾ƒå°‘çš„çº¿ç¨‹å¤„ç†æ›´å¤šè¿æ¥ï¼Œè¿™æ„å‘³ç€æ›´å°‘çš„å¼€é”€åœ¨å†…å­˜å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šã€‚å½“æ²¡æœ‰ I/O å¤„ç†æ—¶ï¼Œçº¿ç¨‹å¯ä»¥è¢«é‡å®šå‘åˆ°å…¶ä»–ä»»åŠ¡ä¸Šã€‚

å¦‚æœä½ è¦ç›´æ¥ä½¿ç”¨è¿™äº› Java API æ„å»ºçš„ NIO å»ºç«‹ä½ çš„åº”ç”¨ç¨‹åºï¼Œåªæ˜¯è¿™æ ·åšæ­£ç¡®å’Œå®‰å…¨æ˜¯æ— æ³•ä¿è¯çš„ã€‚å®ç°å¯é å’Œå¯æ‰©å±•çš„ event-processingï¼ˆäº‹ä»¶å¤„ç†å™¨ï¼‰æ¥å¤„ç†å’Œè°ƒåº¦æ•°æ®å¹¶ä¿è¯å°½å¯èƒ½æœ‰æ•ˆåœ°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¹çå’Œå®¹æ˜“å‡ºé”™çš„ä»»åŠ¡ï¼Œæœ€å¥½ç•™ç»™ä¸“å®¶ - Nettyã€‚

Netty åŸºæœ¬æ„æˆï¼š

- Channel æ˜¯ NIO åŸºæœ¬çš„ç»“æ„ã€‚å®ƒä»£è¡¨äº†ä¸€ä¸ªç”¨äºè¿æ¥åˆ°å®ä½“å¦‚ç¡¬ä»¶è®¾å¤‡ã€æ–‡ä»¶ã€ç½‘ç»œå¥—æ¥å­—æˆ–ç¨‹åºç»„ä»¶ï¼Œèƒ½å¤Ÿæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒçš„ I/O æ“ä½œçš„å¼€æ”¾è¿æ¥ã€‚
- callback å›è°ƒæ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨æŸä¸ªåˆé€‚çš„æ—¶é—´è°ƒç”¨ä»¥é€šçŸ¥å®¢æˆ·ã€‚è¿™ç§æŠ€æœ¯è¢«å¹¿æ³›ä½¿ç”¨åœ¨å„ç§ç¼–ç¨‹çš„æƒ…å†µä¸‹ï¼Œæœ€å¸¸è§çš„æ–¹æ³•ä¹‹ä¸€é€šçŸ¥ç»™å…¶ä»–äººæ“ä½œå·²å®Œæˆã€‚
- Future æä¾›äº†å¦å¤–ä¸€ç§é€šçŸ¥åº”ç”¨æ“ä½œå·²ç»å®Œæˆçš„æ–¹å¼ã€‚è¿™ä¸ªå¯¹è±¡ä½œä¸ºä¸€ä¸ªå¼‚æ­¥æ“ä½œç»“æœçš„å ä½ç¬¦,å®ƒå°†åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™å®Œæˆå¹¶æä¾›ç»“æœã€‚
- Event å’Œ Handlerï¼ŒNetty ä½¿ç”¨ä¸åŒçš„äº‹ä»¶æ¥é€šçŸ¥æˆ‘ä»¬æ›´æ”¹çš„çŠ¶æ€æˆ–æ“ä½œçš„çŠ¶æ€ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®å‘ç”Ÿçš„äº‹ä»¶è§¦å‘é€‚å½“çš„è¡Œä¸ºã€‚

Netty çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ˜¯å»ºç«‹åœ¨ future å’Œ callback çš„æ¦‚å¿µä¸Šçš„ï¼Œå°†æ‰€æœ‰è¿™äº›å…ƒç´ æ•´åˆï¼ŒååŒä¸ºè‡ªå·±çš„ç¨‹åºè®¾è®¡æä¾›äº†å¼ºå¤§çš„åŠ›é‡ã€‚

æ¯”å¦‚ï¼Œæ‹¦æˆªæ“ä½œå’Œè½¬æ¢å…¥ç«™æˆ–å‡ºç«™æ•°æ®åªéœ€è¦æ‚¨æä¾›å›è°ƒæˆ–åˆ©ç”¨ future æ“ä½œè¿”å›çš„ï¼Œè¿™ä½¿å¾—é“¾æ“ä½œç®€å•ã€é«˜æ•ˆï¼Œä¿ƒè¿›ç¼–å†™å¯é‡ç”¨çš„ã€é€šç”¨çš„ä»£ç ã€‚ä¸€ä¸ª Netty çš„è®¾è®¡çš„ä¸»è¦ç›®æ ‡æ˜¯ä¿ƒè¿›â€œå…³æ³¨ç‚¹åˆ†ç¦»â€:ä½ çš„ä¸šåŠ¡é€»è¾‘ä»ç½‘ç»œåŸºç¡€è®¾æ–½åº”ç”¨ç¨‹åºä¸­åˆ†ç¦»ã€‚

Netty é€šè¿‡è§¦å‘äº‹ä»¶ä»åº”ç”¨ç¨‹åºä¸­æŠ½è±¡å‡º Selectorï¼Œä»è€Œé¿å…æ‰‹å†™è°ƒåº¦ä»£ç ã€‚EventLoop åˆ†é…ç»™æ¯ä¸ª Channel æ¥å¤„ç†æ‰€æœ‰çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬ï¼š

- æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶
- è°ƒåº¦äº‹ä»¶åˆ° ChannelHandler
- å®‰æ’è¿›ä¸€æ­¥è¡ŒåŠ¨

è¯¥ EventLoop æœ¬èº«æ˜¯ç”±åªæœ‰ä¸€ä¸ªçº¿ç¨‹é©±åŠ¨ï¼Œå®ƒç»™ä¸€ä¸ª Channel å¤„ç†æ‰€æœ‰çš„ I/O äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨ EventLoop çš„ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šæ”¹å˜ã€‚è¿™ä¸ªç®€å•è€Œå¼ºå¤§çš„çº¿ç¨‹æ¨¡å‹æ¶ˆé™¤ä½ å¯èƒ½å¯¹ä½ çš„ ChannelHandler åŒæ­¥çš„ä»»ä½•å…³æ³¨ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä¸“æ³¨äºæä¾›æ­£ç¡®çš„å›è°ƒé€»è¾‘æ¥æ‰§è¡Œã€‚è¯¥ API æ˜¯ç®€å•å’Œç´§å‡‘ã€‚


## âš¡ class File Format
- [Chapter 4. The class File Format](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html)

è™šæ‹Ÿæœºè§„èŒƒå¹¶æ²¡æœ‰é™å®šæŒ‡æ˜äºŒè¿›åˆ¶å­—èŠ‚æµè¦ä»ä¸€ä¸ª Class æ–‡ä»¶è·å–ï¼Œæˆ–è€…è¯´æ²¡æœ‰é™å®šä»å“ªé‡Œè·å–ã€æ€æ ·è·å–ã€‚è¿™ç§å¼€æ”¾ä½¿å¾— Java åœ¨å¾ˆå¤šé¢†åŸŸå¾—åˆ°å……åˆ†è¿ç”¨ï¼Œä¾‹å¦‚ï¼š

- ä»ZIPåŒ…ä¸­è¯»å–ï¼Œè¿™å¾ˆå¸¸è§ï¼Œæˆä¸ºJARï¼ŒEARï¼ŒWARæ ¼å¼çš„åŸºç¡€
- ä»ç½‘ç»œä¸­è·å–ï¼Œæœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯Applet
- è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œæœ€å…¸å‹çš„æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œjava.lang.reflect.Proxyï¼Œå°±æ˜¯ç”¨äº† ProxyGenerator.generateProxyClass æ¥ä¸ºç‰¹å®šæ¥å£ç”Ÿæˆåç¼€ä¸º $Proxy çš„ä»£ç†ç±»
- æœ‰å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œè¿‡æ—¶çš„ JSP å°±ä¼šç”Ÿæˆå¯¹åº”çš„ Class ç±»


JVM åŠ è½½çš„ Class æ–‡ä»¶ç»“æ„åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

- é­”æ•°ï¼šç¡®å®šè¿™ä¸ªæ–‡ä»¶èƒ½å¦è¢« Java è™šæ‹Ÿæœºæ¥å—ï¼Œå€¼ä¸º 0xCAFFBABEï¼ˆå’–å•¡å®è´ï¼Ÿï¼‰
- ç‰ˆæœ¬å·ï¼šClass æ–‡ä»¶çš„ç‰ˆæœ¬å·
- å¸¸é‡æ± ï¼šClass æ–‡ä»¶çš„èµ„æºä»“åº“
- è®¿é—®æ ‡å¿—ï¼šç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼Œæ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Ÿæ˜¯å¦ä¸º publicï¼Ÿ
- ç´¢å¼•é›†åˆï¼šåŒ…æ‹¬ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•
- å­—æ®µè¡¨é›†åˆï¼šæè¿°æ¥å£æˆ–ç±»ä¸­å£°æ˜çš„å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨çš„å±€éƒ¨å˜é‡
- æ–¹æ³•è¡¨é›†åˆï¼šä»£ç åœ¨æ–¹æ³•è¡¨ä¸­çš„å±æ€§é›†åˆâ€œCodeâ€å±æ€§
- å±æ€§è¡¨é›†åˆï¼šå­—æ®µè¡¨ã€æ–¹æ³•è¡¨éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨ï¼Œä»¥ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“ç”¨ä¿¡æ¯

ClassFile Structureï¼š

	ClassFile {
	    u4             magic;
	    u2             minor_version;
	    u2             major_version;
	    u2             constant_pool_count;
	    cp_info        constant_pool[constant_pool_count-1];
	    u2             access_flags;
	    u2             this_class;
	    u2             super_class;
	    u2             interfaces_count;
	    u2             interfaces[interfaces_count];
	    u2             fields_count;
	    field_info     fields[fields_count];
	    u2             methods_count;
	    method_info    methods[methods_count];
	    u2             attributes_count;
	    attribute_info attributes[attributes_count];
	}


Table 4.1-A. access_flags and property modifiers

|   Flag Name    | Value  |                                   Interpretation                                  |
|----------------|--------|-----------------------------------------------------------------------------------|
| ACC_PUBLIC     | 0x0001 | Declared public; may be accessed from outside its package.                        |
| ACC_FINAL      | 0x0010 | Declared final; no subclasses allowed.                                            |
| ACC_SUPER      | 0x0020 | Treat superclass methods specially when invoked by the invokespecial instruction. |
| ACC_INTERFACE  | 0x0200 | Is an interface, not a class.                                                     |
| ACC_ABSTRACT   | 0x0400 | Declared abstract; must not be instantiated.                                      |
| ACC_SYNTHETIC  | 0x1000 | Declared synthetic; not present in the source code.                               |
| ACC_ANNOTATION | 0x2000 | Declared as an annotation type.                                                   |
| ACC_ENUM       | 0x4000 | Declared as an enum type.                                                         |


Table 4.3-A. Interpretation of field descriptors

| FieldType term |    Type   |                                   Interpretation                                  |
|----------------|-----------|-----------------------------------------------------------------------------------|
| B              | byte      | signed byte                                                                       |
| C              | char      | Unicode character code point in the Basic Multilingual Plane, encoded with UTF-16 |
| D              | double    | double-precision floating-point value                                             |
| F              | float     | single-precision floating-point value                                             |
| I              | int       | integer                                                                           |
| J              | long      | long integer                                                                      |
| L ClassName ;  | reference | an instance of class ClassName                                                    |
| S              | short     | signed short                                                                      |
| Z              | boolean   | true or false                                                                     |
| [              | reference | one array dimension                                                               |


åœ¨ HotSpot è™šæ‹Ÿæœºä¸­ï¼ŒJava å¯¹è±¡å†…å­˜å¸ƒå±€å¯ä»¥åˆ†ä¸º 3 å—åŒºåŸŸï¼š

- å¯¹è±¡å¤´ Header

	- ç¬¬ä¸€éƒ¨åˆ†ï¼Œå“ˆå¸Œç ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼›
	- ç¬¬äºŒéƒ¨åˆ†ï¼Œç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ï¼›

- å®ä¾‹æ•°æ® Instance Data

	- å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œå³åœ¨ä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ã€‚æ— è®ºæ˜¯ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œè¿˜æ˜¯åœ¨å­ç±»ä¸­å®šä¹‰çš„ã€‚

- å¯¹é½å¡«å…… Padding

	- å¯¹é½å¡«å……ï¼šHotSpot è™šæ‹Ÿæœºè¦æ±‚å¯¹è±¡çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚



## âš¡ Java CLI
- https://www.oracle.com/java/technologies/javase-downloads.html
- [The Java Tutorials Bundle](https://www.oracle.com/java/technologies/javase/java-tutorial-downloads.html)
- [The Javaâ„¢ Tutorials](https://docs.oracle.com/javase/tutorial/index.html)
- [JDI - Java Debug Interface](https://www.ibm.com/developerworks/cn/java/j-lo-jdi)
- [JavaTM Platform Debugger Architecture (JPDA)](https://docs.oracle.com/javase/6/docs/technotes/guides/jpda/index.html)
- [Spring Bootå¼•èµ·çš„â€œå †å¤–å†…å­˜æ³„æ¼â€æ’æŸ¥åŠç»éªŒæ€»ç»“](https://tech.meituan.com/2019/01/03/spring-boot-native-memory-leak.html)

å¯¹ç»™å®šçš„ä¸€ä¸ª Java æºä»£ç æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œè¿›è¡Œç¼–è¯‘ç”Ÿæˆ .class ç±»æ–‡ä»¶ï¼Œç„¶åå†æ‰§è¡Œï¼š

	javac demo.java
	java demo

Java åº”ç”¨é¡¹ç›®å¯ä»¥æ‰“åŒ…æˆä¸€ä¸ª jarï¼Œå½“ç„¶ä½ å¿…é¡»æŒ‡å®šä¸€ä¸ªæ‹¥æœ‰ main å‡½æ•°çš„ä¸»ç±»ä½œä¸º jar åŒ…çš„ç¨‹åºå…¥å£ã€‚

å…·ä½“çš„æ–¹æ³•æ˜¯ä¿®æ”¹ jar åŒ…å†…ç›®å½• META-INF/MANIFEST.MF æ–‡ä»¶ã€‚

æ¯”å¦‚ main å‡½æ•°åœ¨ test.someClassName ç±»ä¸Šå®šä¹‰ï¼Œæˆ‘ä»¬å°±åªè¦åœ¨ MANIFEST.MF é‡Œé¢æ·»åŠ å¦‚ä¸‹ä¸€å¥è¯ï¼š

	Main-Class: test.someClassName

ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š

	java -jar test.jar

é¡¹ç›®éœ€è¦å¼•ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹çš„ jar åŒ…ï¼Œåœ¨ eclipse ä¼šå°†æ”¾åœ¨é¡¹ç›®çš„ lib å­ç›®å½•ä¸‹ jar åŒ…ä¸€å¹¶æ‰“åŒ…ï¼Œä½†æ˜¯ç”¨ java -jar æ‰§è¡Œæ—¶éœ€è¦ä¾èµ–å¤–éƒ¨åŒ…ï¼Œå°±éœ€è¦å‘ŠçŸ¥ Java å¼•ç”¨ jar åŒ…æ‰€åœ¨ã€‚

è¿è¡Œæ—¶å°†å…¶åŠ å…¥ -classpath å‚æ•°ä¸­æŒ‡å®šç›®å½•ï¼Œç®€å†™ä¸º -cpï¼š

	java -classpath some.jar -jar test.jar

å› ä¸ºä½¿ç”¨ classpath æŒ‡å®šçš„ jar ç”± AppClassloader æ¥åŠ è½½ï¼ŒJava å‘½ä»¤åŠ äº† -jar å‚æ•°ï¼ŒAppClassloader å°±åªå…³æ³¨ test.jar èŒƒå›´å†…çš„ class äº†ï¼Œclasspath å‚æ•°å¤±æ•ˆã€‚

ç¨‹åºä¾èµ– DLL æ–‡ä»¶å¯ä»¥ï¼Œå¯ä»¥åœ¨ java.library.path æŒ‡å®šè·¯å¾„ï¼Œpath_to_dll ä¸ºåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæˆ–ç›´æ¥åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ï¼š

	java -Djava.library.path=<path_to_dll> <main_class>
	System.setProperty("java.library.path", "/path/to/library");


æ–¹æ³•ä¸€ã€ä½¿ç”¨ Bootstrap Classloader æ¥åŠ è½½è¿™äº›ç±»

	-Xbootclasspath: å®Œå…¨å–ä»£ç³»ç»Ÿ Java classpathï¼Œæœ€å¥½ä¸ç”¨ã€‚
	-Xbootclasspath/a: åœ¨ç³»ç»Ÿ class åŠ è½½ååŠ è½½ï¼Œæ¨èä½¿ç”¨ã€‚
	-Xbootclasspath/p: åœ¨ç³»ç»Ÿ class åŠ è½½å‰åŠ è½½ï¼Œæ³¨æ„ä½¿ç”¨ï¼Œå’Œç³»ç»Ÿç±»å†²çªå°±ä¸å¥½äº†ã€‚

å¤šä¸ª jar åŒ…ä½¿ç”¨ ; æˆ– : åˆ†éš”ï¼Œæ ¹æ® Windows/Unix ç³»ç»Ÿé€‰ç”¨ï¼š

	java -Xbootclasspath/a:some.jar;some2.jar; -jar test.jar
	java -Dloader.path=/path/to/lib -jar test.jar


æ–¹æ³•äºŒã€ä½¿ç”¨ Extension Classloader æ¥åŠ è½½

ä½ å¯ä»¥æŠŠéœ€è¦åŠ è½½çš„ jar éƒ½æ‰”åˆ° %JRE_HOME%/lib/ext ä¸‹é¢ï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„ jar åŒ…ä¼šåœ¨ Bootstrap Classloader å·¥ä½œå®Œåï¼Œç”± Extension Classloader æ¥åŠ è½½ã€‚éå¸¸æ–¹ä¾¿ï¼Œéå¸¸çœå¿ƒã€‚:)

å‘½ä»¤è¡Œä½¿ç”¨ -cp å‚è€ƒåªèƒ½æŒ‡å®šä¸€ä¸ªå›ºå®š jar åŒ…ï¼Œä¸èƒ½ç”¨é€šé…ç¬¦ï¼Œå¤šä¸ªåŒ…è¦ä¸€ä¸ªä¸ªå†™ã€‚é€šå¸¸æƒ…å†µ jar éƒ½åœ¨åŒä¸€ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨ -Djava.ext.dirs å‚æ•°æŒ‡å®šåŒ…ç›®å½•ï¼Œé…ç½®å¤šä¸ªç›®å½•ä½¿ç”¨å†’å·åˆ†éš”ï¼ˆWindowsä¸‹ä½¿ç”¨åˆ†å·ï¼‰ã€‚

	java -Djava.ext.dirs="libs\;%JAVA_HOME%\jre\lib\ext"

æ–¹æ³•ä¸‰ã€è¿˜æ˜¯ç”¨ AppClassloader æ¥åŠ è½½ï¼Œä¸è¿‡ä¸éœ€è¦ classpath å‚æ•°

æˆ‘ä»¬åœ¨ MANIFEST.MF ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå¤šä¸ª jar åŒ…ç”¨ç©ºæ ¼åˆ†éš”ï¼š

	Class-Path: lib/some.jar
	Class-Path: lib/some.jar lib/some2.jar

lib æ˜¯å’Œ test.jar åŒç›®å½•çš„ä¸€ä¸ªå­ç›®å½•ï¼Œtest.jar è¦å¼•ç”¨çš„ some.jar åŒ…å°±åœ¨è¿™é‡Œé¢ã€‚

å¦ï¼šå¦‚æœ META-INF/INDEX.LIST æ–‡ä»¶å­˜åœ¨ï¼Œå¯èƒ½ä¼šä½¿ Class-Path é…ç½®å¤±æ•ˆã€‚INDEX.LIST æ˜¯ Jar æ‰“åŒ…å·¥å…·æ‰“åŒ…æ—¶ç”Ÿæˆçš„ç´¢å¼•æ–‡ä»¶ï¼Œåˆ é™¤å¯¹è¿è¡Œä¸äº§ç”Ÿå½±å“ã€‚

æ–¹æ³•å››ã€è‡ªå®šä¹‰ Classloader æ¥åŠ è½½

è¿™ç§æ–¹æ³•æ˜¯ç»ˆæè§£å†³æ–¹æ¡ˆï¼ŒåŸºæœ¬ä¸Šé‚£äº›çŸ¥å Java åº”ç”¨éƒ½ä¼šåœ¨ä»£ç ä¸­ä½¿ç”¨ Classloaderï¼Œå¦‚ Tomcatã€JBoss ç­‰ç­‰ã€‚


å¦‚æœæºä»£ç æ˜¯åŒ…çš„å½¢å¼ç»„ç»‡ï¼Œå¤šä¸ªæºæ–‡ä»¶å°±è¦åˆ†åˆ«ä¾æ¬¡è¿›è¡Œç¼–è¯‘ï¼Œ-d æŒ‡å®šè¾“å‡ºç›®å½•ï¼š

	>javac -d . src\com\coding\HelloBean.java
	>javac -d . src\com\coding\SpringDemo.java
	>javac -d . src\com\coding\HelloListener.java

æˆ–è€…ï¼Œä½¿ç”¨ sourcelist.txt ç¼–è¯‘å¤šä¸ª Java æ–‡ä»¶çš„ç›®çš„ï¼Œå°†è¦ç¼–è¯‘çš„æ–‡ä»¶åˆ—è¡¨ï¼š

	src\com\coding\HelloBean.java
	src\com\coding\SpringDemo.java
	src\com\coding\HelloListener.java

å‘½ä»¤è¡Œè¿è¡Œï¼š

	javac -d bin -sourcepath src -classpath bin @sourcelist.txt

ç¼–è¯‘æ—¶ï¼Œä¾èµ–åº“ä»¥æˆ–ç±»ç›®å½•ä½¿ç”¨ -cp æŒ‡å®šï¼Œå¤šä¸ªåŒ…ç”¨å†’å·æˆ–è€…åˆ†å·éš”å¼€ï¼š 

    javac -d bin -encoding utf-8 -cp .:lib/fastjson-1.2.37.jar -g -sourcepath src @src/sources.txt
 
    jar -cvfm demo.jar MANIFEST.MF *  

æ³¨æ„ MANIFEST.MF æ–‡ä»¶å®šä¹‰ä¸»ç±»ï¼Œå‚è€ƒå†…å®¹å¦‚ä¸‹ï¼š

	Manifest-Version: 1.0  
	Main-Class: com.travel.app.AppMainEntry
	Class-Path: bin/fastjson-1.2.37.jar bin/json-20170516.jar bin/org.restlet.ext.json-2.3.10.jar bin/org.restlet-2.3.10.jar




## âš¡ Reflection åå°„æœºåˆ¶
- Class (Java SE 9 & JDK 9 ) - https://docs.oracle.com/javase/9/docs/api/java/lang/Class.html
- Field (Java Platform SE 7 ) - https://docs.oracle.com/javase/7/docs/api/java/lang/reflect/Field.html
- ByteArrayOutputStream (Java SE 9 & JDK 9 ) - https://docs.oracle.com/javase/9/docs/api/java/io/ByteArrayOutputStream.html
- URL (Java SE 9 & JDK 9 ) - https://docs.oracle.com/javase/9/docs/api/java/net/URL.html
- Classçƒ­æ›¿æ¢ä¸å¸è½½ - http://www.importnew.com/22462.html
- æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨ - https://www.ibm.com/developerworks/cn/java/j-lo-classloader/index.html
- åå°„æœºåˆ¶ï¼ˆReflectionï¼‰ â€“ http://blog.qiji.tech/archives/4374
- æ·±å…¥ç†è§£Javaç±»å‹ä¿¡æ¯(Classå¯¹è±¡)ä¸åå°„æœºåˆ¶ - https://blog.csdn.net/javazejian/article/details/70768369
- æ·±å…¥ç†è§£Javaç±»åŠ è½½å™¨(ä¸€)ï¼šJavaç±»åŠ è½½åŸç†è§£æ - https://blog.csdn.net/justloveyou_/article/details/72217806
- ç±»åŠ è½½å™¨ä¸ Class.getResourceAsStream é—®é¢˜è§£å†³ https://blog.csdn.net/w1196726224/article/details/54428493
- http://tomcat.apache.org/tomcat-7.0-doc/class-loader-howto.html

è®¤è¯† Class å¯¹è±¡ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸ªæ¦‚å¿µï¼ŒRTTI - Run-Time Type Identification **è¿è¡Œæ—¶ç±»å‹è¯†åˆ«**ï¼Œå¯¹äºè¿™ä¸ªè¯ä¸€ç›´æ˜¯ C++ ä¸­çš„æ¦‚å¿µï¼Œè‡³äº Java RTTI çš„è¯´æ³•åˆ™æ˜¯æºäºã€ŠThinking in Javaã€‹ä¸€ä¹¦ï¼Œå…¶ä½œç”¨æ˜¯åœ¨è¿è¡Œæ—¶è¯†åˆ«ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹å’Œç±»çš„ä¿¡æ¯ï¼Œåˆ†ä¸¤ç§ï¼š

- ä¼ ç»Ÿçš„ RTTIï¼Œå®ƒå‡å®šæˆ‘ä»¬åœ¨ç¼–è¯‘æœŸå·²çŸ¥é“äº†æ‰€æœ‰ç±»å‹ï¼Œåœ¨æ²¡æœ‰åå°„æœºåˆ¶åˆ›å»ºå’Œä½¿ç”¨ç±»å¯¹è±¡æ—¶ï¼Œä¸€èˆ¬éƒ½æ˜¯ç¼–è¯‘æœŸå·²ç¡®å®šå…¶ç±»å‹ï¼Œå¦‚ new å¯¹è±¡æ—¶è¯¥ç±»å¿…é¡»å·²å®šä¹‰å¥½ã€‚
- åå°„æœºåˆ¶æ–¹å¼ RTTIï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å‘ç°å’Œä½¿ç”¨ç±»å‹çš„ä¿¡æ¯ã€‚

åœ¨ Java ä¸­ç”¨æ¥è¡¨ç¤ºè¿è¡Œæ—¶ç±»å‹ä¿¡æ¯çš„å¯¹åº”ç±»å°±æ˜¯ Class ç±»ä¹Ÿå¯¹åº”æºä»£ç ç¼–è¯‘åç”Ÿæˆçš„ç±»æ–‡ä»¶ï¼ŒClass ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå®å®åœ¨åœ¨çš„ç±»ï¼Œå­˜åœ¨äº java.lang åŒ…ä¸­ã€‚

Class ç±»ä¹Ÿæ˜¯ç±»çš„ä¸€ç§ï¼Œä½†æ˜¯ç‰¹åˆ«åœ° Class ç±»ç”¨æ¥æè¿°ä½¿ç”¨ class å…³é”®å­—å®šä¹‰çš„ç±»ï¼Œè¿™äº›æè¿°ä¿¡æ¯ç”¨äºåœ¨è¿è¡Œæ—¶è·å–ç±»å®šä¹‰å†…å®¹ï¼ŒClass ç±»çš„å¯¹è±¡ä½œç”¨æ˜¯è¿è¡Œæ—¶æä¾›æˆ–è·å¾—æŸä¸ªå¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚ç¼–å†™å¥½çš„ç±»åœ¨ç¼–è¯‘åéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª Class å¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯åˆ›å»ºçš„ç±»çš„ç±»å‹ä¿¡æ¯ï¼Œè€Œä¸”è¿™ä¸ª Class å¯¹è±¡ä¿å­˜åœ¨åŒåå­—èŠ‚ç æ–‡ä»¶ä¸­ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ª Shapes ç±»ï¼Œç¼–è¯‘åå°±ä¼šåˆ›å»ºå…¶åŒ…å« Shapes ç±»ç›¸å…³ç±»å‹ä¿¡æ¯çš„ Class å¯¹è±¡ï¼Œå¹¶ä¿å­˜åœ¨ Shapes.class å­—èŠ‚ç æ–‡ä»¶ä¸­ã€‚æ¯

ä¸ªé€šè¿‡å…³é”®å­— class æ ‡è¯†çš„ç±»ï¼Œåœ¨å†…å­˜ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ Class å¯¹è±¡æ¥æè¿°å…¶ç±»å‹ä¿¡æ¯ï¼Œæ— è®ºåˆ›å»ºå¤šå°‘ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå…¶ä¾æ®çš„éƒ½æ˜¯ç”¨ä¸€ä¸ª Class å¯¹è±¡ã€‚Class ç±»åªå­˜ç§æœ‰æ„é€ å‡½æ•°ï¼Œå› æ­¤å¯¹åº” Class å¯¹è±¡åªèƒ½æœ‰ JVM åˆ›å»ºå’ŒåŠ è½½ã€‚

åœ¨è¿è¡ŒæœŸé—´ï¼Œå¦‚æœæˆ‘ä»¬è¦äº§ç”ŸæŸä¸ªç±»çš„å¯¹è±¡ï¼Œè™šæ‹Ÿæœº JVM ä¼šæ£€æŸ¥è¯¥ç±»å‹çš„ Class å¯¹è±¡æ˜¯å¦å·²è¢«åŠ è½½ã€‚å¦‚æœæ²¡æœ‰è¢«åŠ è½½ï¼ŒJVM ä¼šæ ¹æ®ç±»çš„åç§°æ‰¾åˆ° .class æ–‡ä»¶å¹¶åŠ è½½å®ƒã€‚ä¸€æ—¦æŸä¸ªç±»å‹çš„ Class å¯¹è±¡å·²è¢«åŠ è½½åˆ°å†…å­˜ï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥äº§ç”Ÿè¯¥ç±»å‹çš„æ‰€æœ‰å¯¹è±¡ã€‚

è£…è½½ç±»çš„è¿‡ç¨‹éå¸¸ç®€å•ï¼šæŸ¥æ‰¾ç±»æ‰€åœ¨ä½ç½®ï¼Œå¹¶å°†æ‰¾åˆ°çš„ Java ç±»çš„å­—èŠ‚ç è£…å…¥å†…å­˜ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆå¯¹åº”çš„ Class å¯¹è±¡ã€‚JVM å¹¶ä¸æ­¢æœ‰ä¸€ä¸ªç±»è£…è½½å™¨ï¼Œäº‹å®ä¸Šï¼Œå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ å¯ä»¥è®© JVM æ‹¥æœ‰æ— æ•°ä¸ªç±»è£…è½½å™¨ã€‚

ç±»è£…è½½å™¨è‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒä¹Ÿéœ€è¦è¢«è£…è½½åˆ°å†…å­˜ä¸­æ¥ï¼Œé‚£ä¹ˆè¿™äº›ç±»è£…è½½å™¨ç”±è°æ¥è£…è½½å‘¢ï¼Œæ€»å¾—æœ‰ä¸ªæ ¹å§ï¼Ÿç¡®å®å­˜åœ¨è¿™æ ·çš„æ ¹ï¼ŒBootstrap ClassLoader å°±æ˜¯ã€‚

ç±»è£…è½½å™¨æŠŠä¸€ä¸ªç±»è£…å…¥ Java è™šæ‹Ÿæœºä¸­è¦ç»è¿‡è£…è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–ä¸‰ä¸ªæ­¥éª¤ï¼Œå…¶ä¸­é“¾æ¥åˆå¯ä»¥ç»†åˆ†æˆæ ¡éªŒã€å‡†å¤‡å’Œè§£æä¸‰æ­¥ï¼Œé™¤äº†è§£æå¤–ï¼Œå…¶å®ƒæ­¥éª¤æ˜¯ä¸¥æ ¼æŒ‰ç…§é¡ºåºå®Œæˆçš„ï¼š

- è£…è½½ï¼šæŸ¥æ‰¾å’Œå¯¼å…¥ç±»æˆ–æ¥å£çš„äºŒè¿›åˆ¶æ•°æ®ï¼›
- é“¾æ¥ï¼šæ‰§è¡Œä¸‹é¢çš„æ ¡éªŒã€å‡†å¤‡å’Œè§£ææ­¥éª¤ï¼Œå…¶ä¸­è§£ææ­¥éª¤æ˜¯å¯ä»¥é€‰æ‹©çš„ï¼›
- æ ¡éªŒï¼šæ£€æŸ¥å¯¼å…¥ç±»æˆ–æ¥å£çš„äºŒè¿›åˆ¶æ•°æ®çš„æ­£ç¡®æ€§ï¼›
- å‡†å¤‡ï¼šç»™ç±»çš„é™æ€å˜é‡åˆ†é…å¹¶åˆå§‹åŒ–å­˜å‚¨ç©ºé—´ï¼›
- è§£æï¼šå°†ç¬¦å·å¼•ç”¨è½¬æˆç›´æ¥å¼•ç”¨ï¼›
- åˆå§‹åŒ–ï¼šæ¿€æ´»ç±»çš„é™æ€å˜é‡çš„åˆå§‹åŒ–Javaä»£ç å’Œé™æ€Javaä»£ç å—ã€‚

**Class.forName(String name)** æ–¹æ³•è°ƒç”¨çš„æ˜¯ Class.forName(String name, boolean initialize, ClassLoader loader)ï¼Œè£…è½½çš„ç±»ä¼šè¢«åˆå§‹åŒ–ã€‚

**ClassLoader.loadClass(String name)** æ–¹æ³•è°ƒç”¨çš„æ˜¯ ClassLoader.loadClass((String name, boolean resolve)ï¼Œresolve=false è¡¨ç¤ºè¢«è£…è½½åä¸è¿›è¡Œé“¾æ¥ã€‚


é€šè¿‡åå°„æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡åŠä¿®æ”¹ç§æœ‰æˆå‘˜ä¸ºå…¬æœ‰æˆå‘˜

	import java.lang.reflect.*;

	class Gum {
		private int weight = 0;
		static { System.out.println("Loading Gum"); }
		public Gum(){ }
		public Gum(int i){ weight = i; }
		public String greeting(){ return "Hi!"; }
	}

	public class coding {
		public static void print(Object obj) {
			System.out.println(obj);
		}
		@SuppressWarnings("unchecked")
		public static void main(String[] args) {
			try {
				Class clz = Class.forName("Gum");
				// Class clazz = Gum.class;
				// Constructor[] cts = clz.getConstructors();
				// for ( Constructor c:cts ) {
				// 	print("Contructor: "+c.getNameâ€‹());
				// }
				// Constructor constructor = clz.getConstructor();
				// Object object = clz.newInstance(); 
				Constructor constructor = clz.getConstructor(int.class);
				Object object = constructor.newInstance(0);

				Method method = clz.getMethod("greeting");
				String msg = (String)method.invoke(object);
				print(msg);

				Field field = clz.getDeclaredField("weight");
				field.setAccessible(true);
				print("get private member:"+field.get(object));

				Class<?> class1 = Class.forName("Gum");
				String name = class1.getClassLoader().getClass().getName();
				print("class loader is " + name);

			} catch(Exception e) {
				e.printStackTrace();
			}
		}
	}

ä½¿ç”¨ç±»åå°„æ–¹æ³• Class.forName() è½½å…¥ç±»ï¼Œè¿”å›å€¼æ˜¯å¯¹åº”ç±»çš„ Class å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡å®ä¾‹çš„ **getClass()** æ–¹æ³•è·å–ï¼Œè¿™æ˜¯åŸºç¡€å¯¹è±¡ç±» Object å®šä¹‰çš„æ–¹æ³•ï¼Œå­—é¢å¸¸é‡çš„æ–¹å¼è·å– Class å¯¹è±¡å¦‚ Object.classã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ç›¸åº”çš„ç±»æ„é€ å‡½æ•°ï¼ŒgetConstructor() ä¼šå¼•å‘ NoSuchMethod å¼‚å¸¸ã€‚


Field.setAccessible(true) å¹¶ä¸æ˜¯å°†æ–¹æ³•çš„è®¿é—®æƒé™æ”¹æˆäº†publicï¼Œè€Œæ˜¯å–æ¶ˆjavaçš„æƒé™æ§åˆ¶æ£€æŸ¥ã€‚å³ä½¿æ˜¯publicæˆå‘˜ï¼Œå…¶accessible å±æ€§é»˜è®¤ä¹Ÿæ˜¯falseï¼Œå³éœ€è¦è¿›è¡Œæƒé™æ£€æŸ¥ã€‚

ä¸ Java åå°„ç›¸å…³çš„ç±»å¦‚ä¸‹ï¼š

	Class ç±»        ä»£è¡¨ç±»çš„å®ä½“ï¼Œåœ¨è¿è¡Œçš„Javaåº”ç”¨ç¨‹åºä¸­è¡¨ç¤ºç±»å’Œæ¥å£
	Field ç±»        ä»£è¡¨ç±»çš„æˆå‘˜å˜é‡ï¼ˆæˆå‘˜å˜é‡ä¹Ÿç§°ä¸ºç±»çš„å±æ€§ï¼‰
	Methodç±»        ä»£è¡¨ç±»çš„æ–¹æ³•
	Constructorç±»   ä»£è¡¨ç±»çš„æ„é€ æ–¹æ³•


æ³¨æ„ï¼ŒgetClassLoader() æ–¹æ³•ï¼Œå¦‚æœç±»æ˜¯é€šè¿‡ Bootstrap class loader åŠ è½½çš„åˆ™ä¼šè¿”å› nullï¼Œå³ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„å‘½ä»¤è¿è¡Œï¼š

	java -Xbootclasspath/p:demos LoadClassDemo

å¦‚æœå¯¹è±¡æ˜¯åŸç±»å‹ primitive type æˆ–æ˜¯ void ä¹Ÿä¼šè¿”å› nullã€‚




## âš¡ ClassLoader ç±»çš„åŠ è½½æµç¨‹
- [Chapter 5. Loading, Linking, and Initializing](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html)
- [loadClass()çš„ç ”ç©¶](https://www.cnblogs.com/guweiwei/p/6534418.html)
- [æ·±å…¥ç†è§£JVMï¼ˆâ‘¢ï¼‰è™šæ‹Ÿæœºçš„ç±»åŠ è½½å™¨ï¼ˆåŒäº²å§”æ´¾æ¨¡å‹ï¼‰](https://www.cnblogs.com/jimoer/p/13200244.html)
- [æ·±å…¥ç†è§£JVMï¼ˆâ‘¢ï¼‰HotSpot è™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜](https://www.cnblogs.com/jimoer/p/13034193.html)
- [å†™ä¸€ä¸ª Java çƒ­åŠ è½½](https://zhuanlan.zhihu.com/p/90404828)
- [èƒ½ä¸èƒ½è‡ªå®šä¹‰ä¸€ä¸ªç±»å« java.lang.Systemï¼Ÿ](https://zhuanlan.zhihu.com/p/77366251)

JVM åŠ¨æ€åŠ è½½ç±»ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š

- Loading
- Linking
- Initializing

JVM å¯åŠ¨åï¼Œé¦–å…ˆå°±æ˜¯å¤„ç†æœ€åº•å±‚çš„åŠ è½½å™¨ï¼ŒBootstrap Class Loaderï¼Œè¿™ä¸ª C++ å®ç°çš„åŠ è½½å™¨æ˜¯æ‰€æœ‰ Java ç±»åŠ è½½çš„æ ¹åŸºã€‚

JVM æŠ€æœ¯è§„èŒƒçš„ Chapter 5. Loading, Linking, and Initializing ç›®å½•å¯ä»¥å¾ˆå¥½åœ°è§£æç±»æ–‡ä»¶çš„åŠ è½½æµç¨‹ï¼š

	5.1. The Run-Time Constant Pool
	5.2. Java Virtual Machine Startup
	5.3. Creation and Loading
	5.3.1. Loading Using the Bootstrap Class Loader
	5.3.2. Loading Using a User-defined Class Loader
	5.3.3. Creating Array Classes
	5.3.4. Loading Constraints
	5.3.5. Deriving a Class from a class File Representation
	5.4. Linking
	5.4.1. Verification
	5.4.2. Preparation
	5.4.3. Resolution
	5.4.3.1. Class and Interface Resolution
	5.4.3.2. Field Resolution
	5.4.3.3. Method Resolution
	5.4.3.4. Interface Method Resolution
	5.4.3.5. Method Type and Method Handle Resolution
	5.4.3.6. Call Site Specifier Resolution
	5.4.4. Access Control
	5.4.5. Overriding
	5.5. Initialization
	5.6. Binding Native Method Implementations
	5.7. Java Virtual Machine Exit


å‚è€ƒã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ï¼Œç±»åŠ è½½å™¨æœ‰å‡ ä¸ªé‡è¦çš„ç‰¹æ€§ï¼š

- æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„é¢„å®šä¹‰çš„æœç´¢èŒƒå›´ï¼Œç”¨æ¥åŠ è½½ class æ–‡ä»¶ï¼› 
- æ¯ä¸ªç±»å’ŒåŠ è½½å®ƒçš„ ClassLoader å…±åŒç¡®å®šäº†è¿™ä¸ªç±»çš„å”¯ä¸€æ€§ï¼ŒåŒä¸€ä¸ªç±»ç”±ä¸åŒåŠ è½½å™¨åŠ è½½ï¼Œé‚£ä¹ˆ JVM è®¤ä¸ºæ˜¯ä¸åŒçš„ç±»ï¼›
- åŒäº²å§”æ´¾æ¨¡å‹ã€‚

åœ¨ JDK 9 ä¹‹å‰çš„ Java åº”ç”¨éƒ½æ˜¯ç”±è¿™ä¸‰ç±»åŠ è½½å™¨äº’ç›¸é…åˆæ¥å®ŒæˆåŠ è½½çš„ï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œä¼šå…ˆæ‰§è¡Œè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚å„ç§çš„ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ Parents Delegation Modelã€‚

**åŒäº²å§”æ´¾æ¨¡å‹**æ˜¯æŒ‡æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æ˜¯æœ‰å±‚çº§ç»“æ„çš„ï¼Œç±»åŠ è½½å™¨æœ¬èº«ä¹Ÿæœ‰ä¸€ä¸ªçˆ¶çº§åŠ è½½å™¨ Parent ClassLoaderï¼Œé™¤äº†å¯åŠ¨ç±»åŠ è½½å™¨ Bootstrap ClassLoaderã€‚å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°ä¸€ä¸ªç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œé¦–å…ˆå°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™å®ƒçš„çˆ¶åŠ è½½å™¨å»åŠ è½½ï¼Œæ‰€ä»¥æ¯ä¸ªç±»åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½ä¼šä¼ é€’åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šå»å°è¯•è‡ªå·±å»åŠ è½½ã€‚

åŒäº²æŒ‡çš„å°±æ˜¯ Extension CLassLoader å’Œ Bootstrap ClassLoader ä¸¤ä¸ªåº•å±‚åŠ è½½å™¨ã€‚

è€Œç»å¤§å¤šæ•° Java åº”ç”¨éƒ½ä¼šç”¨åˆ°å¦‚ä¸‹ 3 ä¸­ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ï¼š

- å¯åŠ¨ç±»åŠ è½½å™¨ Bootstrap/Primordial/NULL ClassLoaderï¼šé¡¶å±‚çš„ç±»åŠ è½½å™¨ï¼Œæ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ã€‚è´Ÿè´£åŠ è½½ /lib ç›®å½•ä¸‹çš„ï¼Œæˆ–åˆ™è¢« -Xbootclasspath å‚æ•°æ‰€æŒ‡å®šè·¯å¾„ä¸­çš„ï¼Œå¹¶è¢« JVM è¯†åˆ«çš„ï¼ˆä»…æŒ‰æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚ rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨ lib ç›®å½•ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚æ‰€æœ‰è¢« Bootstrap classloader åŠ è½½çš„ç±»ï¼Œå®ƒçš„ Class.getClassLoader æ–¹æ³•è¿”å›çš„éƒ½æ˜¯ nullï¼Œæ‰€ä»¥ä¹Ÿç§°ä½œ NULL ClassLoaderã€‚

- æ‰©å±•ç±»åŠ è½½å™¨ Extension CLassLoaderï¼šç”± sun.misc.Launcher$ExtClassLoader å®ç°ï¼Œè´Ÿè´£åŠ è½½ <JAVA_HOME>/lib/ext ç›®å½•ä¸‹ï¼Œæˆ–è¢« `java.ext.dirs` ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„ç›®å½•ä¸‹çš„æ‰€æœ‰ç±»åº“ï¼›

- åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ Application/System ClassLoaderï¼šç”± sun.misc.Launcher$AppClassLoader å®ç°ã€‚å®ƒæ˜¯ ClassLoader.getSystemClassLoader() æ–¹æ³•çš„é»˜è®¤è¿”å›å€¼ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½ classpath ä¸‹æ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚

é€šè¿‡åŒäº²å§”æ´¾æ¨¡å‹å°±å®ç°äº†ç±»åŠ è½½å™¨çš„ä¸‰ä¸ªç‰¹æ€§ï¼š

- å§”æ´¾ delegationï¼šå­ç±»åŠ è½½å™¨å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ï¼›
- å¯è§æ€§ visibilityï¼šå­ç±»åŠ è½½å™¨å¯è®¿é—®çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œçˆ¶ç±»ä¸èƒ½è®¿é—®å­ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼›
- å”¯ä¸€æ€§ uniquenessï¼šå¯ä¿è¯æ¯ä¸ªç±»åªè¢«åŠ è½½ä¸€æ¬¡ï¼Œæ¯”å¦‚ Object ç±»æ˜¯è¢« Bootstrap ClassLoader åŠ è½½çš„ï¼Œå› ä¸ºæœ‰äº†åŒäº²å§”æ´¾æ¨¡å‹ï¼Œæ‰€æœ‰çš„ Object ç±»åŠ è½½è¯·æ±‚éƒ½å§”æ´¾åˆ°äº† Bootstrap ClassLoaderï¼Œæ‰€ä»¥ä¿è¯äº†åªè¢«åŠ è½½ä¸€æ¬¡ã€‚

ä» JVM è™šæ‹Ÿæœºå®ç°çš„è§’åº¦æ¥çœ‹ï¼Œåªå­˜åœ¨ä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨å®ç°ï¼š

- å¯åŠ¨ç±»åŠ è½½å™¨ Bootstrap ClassLoader æ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼›
- æ‰€æœ‰å…¶ä»–çš„ç±»åŠ è½½å™¨ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºå¤–éƒ¨ï¼Œéƒ½ç»§æ‰¿è‡ªæŠ½è±¡ç±» java.lang.ClassLoaderã€‚


åŒäº²å§”æ´¾æ¨¡å‹çš„æºç å…¶å®éå¸¸ç®€æ´ï¼Œå…ˆæ£€æŸ¥è¯·æ±‚åŠ è½½çš„ç±»å‹æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼Œè‹¥æ²¡æœ‰åˆ™è°ƒç”¨çˆ¶åŠ è½½å™¨çš„ loadeClass() æ–¹æ³•ï¼Œè‹¥çˆ¶åŠ è½½å™¨ä¸ºç©ºåˆ™é»˜è®¤ä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ä½œä¸ºçˆ¶åŠ è½½å™¨ã€‚çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥æŠ›å‡º ClassNotFoundException å¼‚å¸¸åï¼Œæ‰ä¼šè°ƒç”¨è‡ªå·±çš„ findClass æ–¹æ³•å°è¯•è¿›è¡ŒåŠ è½½ã€‚

ç±»åŠ è½½ä¸ sun.misc.Launcher ç›¸å…³ï¼Œæ¥çœ‹ OpenJDK æä¾›çš„æŠ½è±¡ç±» **ClassLoader** æºç å¦‚ä¸‹ï¼š

	protected Class<?> loadClass(String name, boolean resolve)
	    throws ClassNotFoundException
	{
	    synchronized (getClassLoadingLock(name)) {
	        // é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†
	        Class<?> c = findLoadedClass(name);
	        if (c == null) {
	            long t0 = System.nanoTime();
	            try {
	                if (parent != null) {
	                    c = parent.loadClass(name, false);
	                } else {
	                    c = findBootstrapClassOrNull(name);
	                }
	            } catch (ClassNotFoundException e) {
	                // å¦‚æœçˆ¶ç±»åŠ è½½å™¨æŠ›å‡º ClassNotFoundException
	                // è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚
	            }

	            if (c == null) {
	                // åœ¨çˆ¶ç±»åŠ è½½å™¨ä»ç„¶æ— æ³•åŠ è½½æ—¶
	                // å†è°ƒç”¨æœ¬èº«çš„ findClass æ–¹æ³•æ¥è¿›è¡Œç±»åŠ è½½
	                long t1 = System.nanoTime();
	                c = findClass(name);

	                // this is the defining class loader; record the stats
	                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);
	                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);
	                sun.misc.PerfCounter.getFindClasses().increment();
	            }
	        }
	        if (resolve) {
	            resolveClass(c);
	        }
	        return c;
	    }
	}

åŒäº²å§”æ´¾æ¨¡å‹å¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“å¼ºåˆ¶æ€§çº¦æŸçš„æ¨¡å‹ï¼Œè™½ç„¶åœ¨ Java å¤§éƒ¨åˆ†çš„ç±»åŠ è½½å™¨éƒ½éµå¾ªè¿™ä¸ªæ¨¡å‹ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µï¼Œç›´åˆ° JDK9 æ¨¡å—åŒ–ä¸ºæ­¢ï¼Œä¸»è¦å‡ºç°è¿‡ 3 æ¬¡è¾ƒå¤§è§„æ¨¡è§„åˆ™ç ´åçš„æƒ…å†µã€‚

ç¬¬ä¸€æ¬¡è¢«ç ´åï¼Œå…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰ï¼Œç”±äºåŒäº²å§”æ´¾æ¨¡å‹åœ¨ JDK 1.2 ä¹‹åæ‰è¢«å¼•å…¥ï¼Œä½†æ˜¯ç±»åŠ è½½å™¨çš„æ¦‚å¿µå’ŒæŠ½è±¡ç±» java.lang.ClassLoader åˆ™åœ¨ Java çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­å°±å·²ç»å­˜åœ¨äº†ã€‚ä¸ºäº†å‘å‰å…¼å®¹ï¼Œåªèƒ½åœ¨ JDK 1.2 ä¹‹åçš„ java.lang.ClassLoader ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ protected findClass() æ–¹æ³•ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·ç¼–å†™ç±»çš„åŠ è½½é€»è¾‘æ—¶å°½å¯èƒ½å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ loadClass() ä¸­ç¼–å†™ä»£ç ã€‚

ç¬¬äºŒæ¬¡ç ´åæ˜¯å› ä¸ºè‡ªèº«çš„ä¸€äº›å±€é™æ€§å¯¼è‡´çš„ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹å¾ˆå¥½çš„è§£å†³äº†å„ä¸ªç±»åŠ è½½å™¨åä½œæ—¶åŸºç¡€ç±»å‹çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå³è¶ŠåŸºç¡€çš„ç±»ç”±è¶Šä¸Šå±‚çš„åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚

ä½†æ˜¯å¦‚æœåŸºç¡€çš„ç±»éœ€è¦è°ƒç”¨ä¸‹é¢çš„ç”¨æˆ·ä»£ç æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸJava è®¾è®¡å›¢é˜Ÿç”¨äº†ä¸€ä¸ªä¸å¤ªä¼˜é›…çš„æ–¹æ¡ˆï¼Œå¼•å…¥äº†ä¸€ä¸ªåå«çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ç±»åŠ è½½å™¨ Thread Context ClassLodarã€‚è¿™ä¸ªç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡ java.lang.Thread ç±»çš„ setContextClassLoader() æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹æ—¶è¿˜æœªè®¾ç½®ï¼Œå®ƒå°†ä¼šä»çˆ¶çº¿ç¨‹ä¸­ç»§æ‰¿ä¸€ä¸ªï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºçš„å…¨å±€èŒƒå›´å†…éƒ½æ²¡æœ‰è®¾ç½®è¿‡çš„è¯ï¼Œé‚£è¿™ä¸ªç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚

åƒ JNDIã€JDBCã€JCEã€JAXBã€JBI ç­‰éƒ½æ˜¯ç”¨çš„è¿™ç§ç±»å‹åŠ è½½å™¨å®ç°çš„åŠŸèƒ½ã€‚æœ€å¸¸è§çš„ Tomcat ä¸­å°±ç”¨åˆ°äº†çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ç±»åŠ è½½å™¨ã€‚

ç¬¬ä¸‰æ¬¡ç ´åï¼Œæ˜¯ä¸ºäº†å®ç°çƒ­éƒ¨ç½²ã€æ¨¡å—åŒ–ã€‚åœ¨æ›´æ–°äº†ä¸€éƒ¨åˆ†ä»£ç åï¼Œä¸éœ€è¦åœæœºé‡å¯ï¼Œåªéœ€è¦å°†ç±»åŠ è½½å™¨å’Œç±»éƒ½æ›¿æ¢æ‰å°±å¯ä»¥äº†ï¼Œå…¸å‹çš„å°±æ˜¯ OSGi çš„æ¨¡å—åŒ–çƒ­éƒ¨ç½²ã€‚

OSGi å®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²çš„å…³é”®åˆ™æ˜¯å®ƒè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœºåˆ¶çš„å®ç°ã€‚æ¯ä¸€ä¸ªç¨‹åºæ¨¡å— Bundle éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå½“éœ€è¦æ›´æ¢ä¸€ä¸ª Bundle æ—¶ï¼Œå°±æŠŠ Bundle è¿åŒç±»åŠ è½½å™¨ä¸€èµ·æ¢æ‰ä»¥å®ç°ä»£ç çš„çƒ­æ›¿æ¢ã€‚åœ¨ OSGi å¹»å¢ƒä¸‹ï¼Œç±»åŠ è½½å™¨ä¸å†æ˜¯åŒäº²å§”æ´¾æ¨¡å‹ä¸­çš„æ ‘çŠ¶ç»“æ„ï¼Œè€Œæ˜¯è¿›ä¸€æ­¥å‘å±•ä¸ºæ›´åŠ å¤æ‚çš„ç½‘çŠ¶ç»“æ„ï¼Œå½“å—åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼ŒOSGi å°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºè¿›è¡Œç±»æœç´¢ï¼š

- å°† java.ï¼Š å¼€å¤´çš„ç±»å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚
- å¦åˆ™ï¼Œå°†å§”æ´¾åˆ—è¡¨åå•å†…çš„ç±»å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚
- å¦åˆ™ï¼Œå°† Import åˆ—è¡¨ä¸­çš„ç±»å§”æ´¾ç»™ Export è¿™ä¸ªç±»çš„ Bundle çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚
- å¦åˆ™ï¼ŒæŸ¥æ‰¾å½“å‰ Bundle ClassPathï¼Œä½¿ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚
- å¦åˆ™ï¼ŒæŸ¥æ‰¾ç±»æ˜¯å¦åœ¨è‡ªå·±çš„ Fragment Bundle ä¸­ï¼Œå¦‚æœåœ¨ï¼Œåˆ™å§”æ´¾ç»™ Fragment Bundle çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚
- å¦åˆ™ï¼ŒæŸ¥æ‰¾ Dynamic Import åˆ—è¡¨çš„ Bundleï¼Œå§”æ´¾ç»™å¯¹åº” Bundle çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚
- å¦åˆ™ï¼Œç±»åŠ è½½å™¨å¤±è´¥ã€‚


èƒ½ä¸èƒ½è‡ªå®šä¹‰ä¸€ä¸ªç±»å« java.lang.Systemï¼Ÿèƒ½ä¸èƒ½è‡ªå®šä¹‰ä¸€ä¸ªç±»å« java.lang.Stringï¼Ÿè¿™ä¸€ç±»é—®é¢˜å°±æ˜¯è€ƒå¯Ÿå¯¹ Java åŠ è½½å­—èŠ‚ç æµç¨‹çš„ç†è§£ã€‚ç”±äº JVM å®‰å…¨æœºåˆ¶ï¼Œè¯•å›¾åŠ è½½å‘½åç©ºé—´ä»¥ java.lang å¼€å¤´çš„ç±»ï¼Œä¼šå¼•å‘ SecurityException å¼‚å¸¸ã€‚

	java.lang.SecurityException: Prohibited package name: java.lang
	        at java.lang.ClassLoader.preDefineClass(ClassLoader.java:662)
	        at java.lang.ClassLoader.defineClass(ClassLoader.java:761)
	        at java.lang.ClassLoader.defineClass(ClassLoader.java:642)

java.lang.System è¿™äº›ç±»æ˜¯ Bootstrap åŠ è½½å™¨åŠ è½½çš„ï¼Œå°±ç®—è‡ªå·±é‡å†™ï¼Œä¹Ÿæ€»æ˜¯ä½¿ç”¨ Java ç³»ç»Ÿæä¾›çš„ Systemï¼Œè‡ªå·±å†™çš„ System ç±»æ ¹æœ¬æ²¡æœ‰æœºä¼šå¾—åˆ°åŠ è½½ã€‚è™½ç„¶å¯ä»¥æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä½†æ˜¯è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœ€ç»ˆä¹Ÿä¼šåœ¨çˆ¶ç±»çš„ final defineClass() æ–¹æ³•æ‰§è¡Œæ—¶è¢«æ‹¦æˆªä¸‹æ¥ï¼Œå¾—åˆ°ç›¸åŒå¼‚å¸¸ï¼Œè‡ªå®šä¹‰çš„ classLoader ä¸å¯èƒ½åŠ è½½åˆ°ä»¥ java å¼€å¤´çš„ç±»çš„ã€‚

    /* Determine protection domain, and check that:
        - not define java.* class,
        - signer of this class matches signers for the rest of the classes in
          package.
    */
    private ProtectionDomain preDefineClass(String name, ProtectionDomain pd)
    {
        if (!checkName(name))
            throw new NoClassDefFoundError("IllegalName: " + name);

        if ((name != null) && name.startsWith("java.")) {
            throw new SecurityException
                ("Prohibited package name: " +
                 name.substring(0, name.lastIndexOf('.')));
        }
        if (pd == null) {
            pd = defaultDomain;
        }

        if (name != null) checkCerts(name, pd.getCodeSource());

        return pd;
    }

ClassLoader æœ‰ä¸¤ä¸ªæ–¹æ³•ä¾›é‡å†™å®ç°è‡ªå®šä¹‰åŠ è½½å™¨ï¼Œä¸€èˆ¬ä¼˜å…ˆå®ç° findClass()ï¼Œå› ä¸ºç³»ç»Ÿæä¾›çš„åŠ è½½å™¨å®ç°äº† loadClass() é€»è¾‘ï¼Œåœ¨å…¶åŠ è½½å¤±è´¥æ—¶å°±ä¼šè°ƒç”¨ findClass()ï¼Œå¹¶ä¸”ç³»ç»Ÿå¹¶å®ç°çš„è¿™ä¸ªæ–¹æ³•åªæ˜¯ç®€å•åœ°æŠ›å‡º ClassNotFoundExceptionï¼Œç›®çš„å°±æ˜¯è®©ä½¿ç”¨è€…è‡ªè¡Œå®ç°ï¼š

	 * <p> The network class loader subclass must define the methods {@link
	 * #findClass <tt>findClass</tt>} and <tt>loadClassData</tt> to load a class
	 * from the network.  Once it has downloaded the bytes that make up the class,
	 * it should use the method {@link #defineClass <tt>defineClass</tt>} to
	 * create a class instance.  A sample implementation is:
	 *
	 * <blockquote><pre>
	 *     class NetworkClassLoader extends ClassLoader {
	 *         String host;
	 *         int port;
	 *
	 *         public Class findClass(String name) {
	 *             byte[] b = loadClassData(name);
	 *             return defineClass(name, b, 0, b.length);
	 *         }
	 *
	 *         private byte[] loadClassData(String name) {
	 *             // load the class data from the connection
	 *             &nbsp;.&nbsp;.&nbsp;.
	 *         }
	 *     }
	 * </pre></blockquote>


å›åˆ°å‰é¢ defineClass() æ–¹æ³•ï¼Œå‚è€ƒå…¶å®ç°ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯è°ƒç”¨äº†ä¸€ä¸ªç§æœ‰çš„ native æ–¹æ³•ï¼Œå¤–éƒ¨ç±»æ˜¯ä¸å¯è®¿é—®çš„ï¼Œæƒ³åˆ°åå°„çš„ç”¨é€”äº†å—ï¼Œå°±ç®—æ˜¯ private æ–¹æ³•ï¼Œç”¨ä¸€ä¸ª setAccessible(true) å°±å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å¯ä»¥å¯æƒœæœ‰äººè¯•è¿‡ï¼Œä½†æ˜¯ç»“æœè¿˜æ˜¯å¤±è´¥çš„ï¼Œå› ä¸º native æ–¹æ³•è¿˜æ˜¯æŠ›å‡ºåŒæ ·çš„å¼‚å¸¸ã€‚

    protected final Class<?> defineClass(String name, byte[] b, int off, int len,
                                         ProtectionDomain protectionDomain)
        throws ClassFormatError
    {
        protectionDomain = preDefineClass(name, protectionDomain);
        String source = defineClassSourceLocation(protectionDomain);
        Class<?> c = defineClass1(name, b, off, len, protectionDomain, source);
        postDefineClass(c, protectionDomain);
        return c;
    }

    private native Class<?> defineClass1(String name, byte[] b, int off, int len,
                                         ProtectionDomain pd, String source);

æ‰€ä»¥ï¼Œç›®å‰æ¥çœ‹ï¼Œæ‰€æœ‰åŸºäº Java çš„æŠ€æœ¯æ˜¯ä¸èƒ½å¯å»å®šåˆ¶ java.lang.System è¿™æ ·çš„ç±»çš„ï¼Œé¦–å…ˆ API çš„å®‰å…¨æ£€æŸ¥è¿™ä¸€å…³å°±è¿‡ä¸äº†ã€‚

ä½†æ˜¯ï¼ŒJDK 9 åå¼•å…¥äº†æ¨¡å—åŒ–ï¼Œè¿™ä¸ªåŠŸèƒ½å¸¦æ¥äº†è½¬æœºï¼Œæœ‰äººè¯•éªŒé€šè¿‡äº†ï¼Œå‚è€ƒæ“ä½œæµç¨‹æ€»ç»“ï¼š

- Java 11 ä¸èƒ½ç›´æ¥ç¼–è¯‘è‡ªå®šä¹‰çš„ java.lang è¿™ä¸ªåŒ…ï¼Œå› ä¸ºå·²ç»å­˜åœ¨ java.base è¿™ä¸ªæ¨¡å—é‡Œï¼›
- å¯ä»¥ä½¿ç”¨ Java 8 ç¼–è¯‘ï¼Œå†ç”± Java 11 åå°„æ–¹æ³•æ¥åŠ è½½ï¼Œæ³¨æ„ï¼ŒfineClass1 æ–¹æ³•åœ¨ Java 11 ä¸­å˜æˆäº†é™æ€æ–¹æ³•ï¼›
- Java 11 platfromClassLoader å¯ä»¥æˆåŠŸçš„æŠŠè‡ªå®šä¹‰çš„ java.lang.System åŠ è½½åˆ°å†…å­˜å½“ä¸­å¹¶å®ä¾‹åŒ–å¯¹è±¡ï¼›

è™½ç„¶ï¼Œå†ç»æ›²æŠ˜æ‰å°†è‡ªå®šä¹‰çš„ java.lang.System åŠ è½½è¿›æ¥ï¼Œä½†æ˜¯ä¸èƒ½åƒå†…éƒ¨æä¾›çš„ System ç±»ä¸€æ ·ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡åå°„çš„æ–¹å¼æ‰§è¡Œã€‚è¿™ä¹Ÿè®¸æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼Œåªä¸è¿‡æ±‚è§£çš„è¿‡ç¨‹å¯¹ Java è™šæ‹Ÿæœºçš„åŠ è½½å™¨å’Œç±»åŠ è½½æµç¨‹çš„æ·±å…¥ç†è§£æ‰æ˜¯æœ€æœ‰ä»·å€¼çš„ã€‚


å¦ä¸€ä¾‹æµ‹è¯•ä»£ç ï¼š

	class SingleTon {
	    private static SingleTon singleTon = new SingleTon();
	    public static int count1;
	    public static int count2 = 0;
		{
		    System.out.println("Dynamic code block");
		}
		static {
		    System.out.println("static code block");
		}
	    private SingleTon() {
		    System.out.println("constructor");
	        count1++;
	        count2++;
	    }

	    public static SingleTon getInstance() {
	        return singleTon;
	    }
	}

	public class Test {
	    public static void main(String[] args) {
	        SingleTon singleTon = SingleTon.getInstance();
	        System.out.println("count1=" + singleTon.count1);
	        System.out.println("count2=" + singleTon.count2);
	    }
	}


åˆ†æ:é™æ€æˆå‘˜åˆå§‹åŒ–åŠ¨ä½œåœ¨æ„é€ å‡½æ•°æ‰§è¡Œåï¼ŒåŠ¨æ€ä»£ç å— --> é™æ€ä»£ç å— --> æ„é€ å™¨ æŒ‰é¡ºåºæ‰§è¡Œã€‚

- SingleTon singleTon = SingleTon.getInstance();è°ƒç”¨äº†ç±»çš„SingleTonè°ƒç”¨äº†ç±»çš„é™æ€æ–¹æ³•ï¼Œè§¦å‘ç±»çš„åˆå§‹åŒ– 
- ç±»åŠ è½½çš„æ—¶å€™åœ¨å‡†å¤‡è¿‡ç¨‹ä¸­ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–é»˜è®¤å€¼ singleton=null count1=0,count2=0 
- ç±»åˆå§‹åŒ–åŒ–ï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹å€¼å’Œæ‰§è¡Œé™æ€ä»£ç å¿«ã€‚singletonèµ‹å€¼ä¸ºnew SingleTon()è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³• 
- è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•åcount=1;count2=1 
- ç»§ç»­ä¸ºcount1ä¸count2èµ‹å€¼,æ­¤æ—¶count1æ²¡æœ‰èµ‹å€¼æ“ä½œ,æ‰€æœ‰count1ä¸º1,ä½†æ˜¯count2æ‰§è¡Œèµ‹å€¼æ“ä½œå°±å˜ä¸º0

ç±»çš„åˆå§‹åŒ–å‘ç”Ÿåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µï¼Œç§°ä¸ºå¯¹ä¸€ä¸ªç±»è¿›è¡Œ â€œä¸»åŠ¨å¼•ç”¨â€ ï¼Œé™¤æ­¤ä¹‹å¤–ç§°ä¸ºâ€œè¢«åŠ¨å¼•ç”¨â€ï¼Œå‡ä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ã€‚

	åˆ›å»ºç±»çš„å®ä¾‹
	è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œä¸å«å¸¸é‡ã€è¢«finalä¿®è¾çš„é™æ€å˜é‡ã€‘ï¼Œç¼–è¯‘å™¨å½“å¸¸é‡ä¸ºå€¼è€Œä¸æ˜¯åŸŸ(field)ã€‚
	è®¿é—®ç±»çš„é™æ€æ–¹æ³•
	åå°„åŠ è½½ï¼Œå¦‚( Class.forName("my.xyz.Test") )
	å½“åˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå‘ç°å…¶çˆ¶ç±»è¿˜æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆå‡ºå‘çˆ¶ç±»çš„åˆå§‹åŒ–
	è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œå®šä¹‰äº†main()æ–¹æ³•çš„é‚£ä¸ªç±»å…ˆåˆå§‹åŒ–

ç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œç›´åˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬äº†ä¸ƒä¸ªæ­¥éª¤ï¼Œå…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æè¿™ä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆlinkingï¼‰ã€‚

	1) åŠ è½½ Loading
	2) éªŒè¯ Verificationã€
	3) å‡†å¤‡ Preparationã€
	4) è§£æ Resolution
	5) åˆå§‹åŒ– Initialization
	6) ä½¿ç”¨ Using
	7) å¸è½½ Unloading

åŠ è½½é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨æ­¤é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š

	1ã€ é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚
	2ã€ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚
	3ã€ åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚

åŠ è½½é˜¶æ®µå³å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨åœ¨å®Œæˆï¼Œä¹Ÿå¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹(å¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œ)æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªå®Œæˆï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å·²ç»å¼€å§‹ã€‚

éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚

Javaè¯­è¨€æœ¬èº«æ˜¯ç›¸å¯¹å®‰å…¨çš„è¯­è¨€ï¼Œä½¿ç”¨Javaç¼–ç æ˜¯æ— æ³•åšåˆ°å¦‚è®¿é—®æ•°ç»„è¾¹ç•Œä»¥å¤–çš„æ•°æ®ã€å°†ä¸€ä¸ªå¯¹è±¡è½¬å‹ä¸ºå®ƒå¹¶æœªå®ç°çš„ç±»å‹ç­‰ï¼Œå¦‚æœè¿™æ ·åšäº†ï¼Œç¼–è¯‘å™¨å°†æ‹’ç»ç¼–è¯‘ã€‚ä½†æ˜¯ï¼ŒClassæ–‡ä»¶å¹¶ä¸ä¸€å®šæ˜¯ç”±Javaæºç ç¼–è¯‘è€Œæ¥ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•é€”å¾„ï¼ŒåŒ…æ‹¬ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨(å¦‚UltraEdit)ç›´æ¥ç¼–å†™ã€‚å¦‚æœç›´æ¥ç¼–å†™äº†æœ‰å®³çš„â€œä»£ç â€(å­—èŠ‚æµ)ï¼Œè€Œè™šæ‹Ÿæœºåœ¨åŠ è½½è¯¥Classæ—¶ä¸è¿›è¡Œæ£€æŸ¥çš„è¯ï¼Œå°±æœ‰å¯èƒ½å±å®³åˆ°è™šæ‹Ÿæœºæˆ–ç¨‹åºçš„å®‰å…¨ã€‚

ä¸åŒçš„è™šæ‹Ÿæœºï¼Œå¯¹ç±»éªŒè¯çš„å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†å¤§è‡´éƒ½ä¼šå®Œæˆä¸‹é¢å››ä¸ªé˜¶æ®µçš„éªŒè¯ ï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯å’Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚

å‡†å¤‡é˜¶æ®µæ˜¯ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜å¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚å‡†å¤‡é˜¶æ®µä¸åˆ†é…ç±»ä¸­çš„å®ä¾‹å˜é‡çš„å†…å­˜ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨Javaå †ä¸­ã€‚

	public static int value=123;

ä¸Šä¸€å¥ä»£ç åœ¨å‡†å¤‡é˜¶æ®µvalueåˆå§‹å€¼ä¸º0ï¼Œåœ¨æ‰§è¡Œæ„é€ å‡½æ•°åï¼Œå¼€å§‹åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šå˜ä¸º123ã€‚

è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ ç¬¦å·å¼•ç”¨ Symbolic Reference ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ç›´æ¥å¼•ç”¨ Direct Reference å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ï¼Œå¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆå¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨ã€‚

ç±»åˆå§‹åŒ–æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œå‰é¢çš„ç±»åŠ è½½è¿‡ç¨‹ï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å‚ä¸ä¹‹å¤–ï¼Œå…¶ä½™åŠ¨ä½œå®Œå…¨ç”±è™šæ‹Ÿæœºä¸»å¯¼å’Œæ§åˆ¶ã€‚åˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ã€‚



## âš¡ ClassLoader ç±»åŠ è½½å™¨

JVMé¢„å®šä¹‰å‡ ç§ç±»åŠ è½½å™¨ï¼Œå½“JVMå¯åŠ¨çš„æ—¶å€™ï¼ŒJavaç¼ºçœå¼€å§‹ä½¿ç”¨å¦‚ä¸‹ä¸‰ç§ç±»å‹çš„ç±»åŠ è½½å™¨ï¼š

å¯åŠ¨ï¼ˆBootstrapï¼‰ç±»åŠ è½½å™¨ï¼šå¼•å¯¼ç±»åŠ è½½å™¨æ˜¯ç”¨ æœ¬åœ°ä»£ç å®ç°çš„ç±»åŠ è½½å™¨ï¼Œå®ƒè´Ÿè´£å°† <JAVA_HOME>/libä¸‹é¢çš„æ ¸å¿ƒç±»åº“ æˆ– -Xbootclasspathé€‰é¡¹æŒ‡å®šçš„jaråŒ…ç­‰ è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“ åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç”±äºå¼•å¯¼ç±»åŠ è½½å™¨æ¶‰åŠåˆ°è™šæ‹Ÿæœºæœ¬åœ°å®ç°ç»†èŠ‚ï¼Œå¼€å‘è€…æ— æ³•ç›´æ¥è·å–åˆ°å¯åŠ¨ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œæ‰€ä»¥ ä¸å…è®¸ç›´æ¥é€šè¿‡å¼•ç”¨è¿›è¡Œæ“ä½œã€‚

æ‰©å±•ï¼ˆExtensionï¼‰ç±»åŠ è½½å™¨ï¼šæ‰©å±•ç±»åŠ è½½å™¨æ˜¯ç”±Sunçš„ExtClassLoaderï¼ˆsun.misc.Launcher$ExtClassLoaderï¼‰å®ç°çš„ï¼Œå®ƒè´Ÿè´£å°† <JAVA_HOME >/lib/extæˆ–è€…ç”±ç³»ç»Ÿå˜é‡-Djava.ext.diræŒ‡å®šä½ç½®ä¸­çš„ç±»åº“ åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ã€‚

ç³»ç»Ÿï¼ˆSystemï¼‰ç±»åŠ è½½å™¨ï¼šç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯ç”± Sun çš„ AppClassLoaderï¼ˆsun.misc.Launcher$AppClassLoaderï¼‰å®ç°çš„ï¼Œå®ƒè´Ÿè´£å°† ç”¨æˆ·ç±»è·¯å¾„(java -classpath æˆ– -Djava.class.path å˜é‡æ‰€æŒ‡çš„ç›®å½•ï¼Œå³å½“å‰ç±»æ‰€åœ¨è·¯å¾„åŠå…¶å¼•ç”¨çš„ç¬¬ä¸‰æ–¹ç±»åº“çš„è·¯å¾„ï¼Œå¦‚ç¬¬å››èŠ‚ä¸­çš„é—®é¢˜6æ‰€è¿°)ä¸‹çš„ç±»åº“ åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œæ˜¯æœ€å¸¸ç”¨çš„åŠ è½½å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯javaä¸­é»˜è®¤çš„åŠ è½½å™¨ã€‚é€šè¿‡Javaåå°„æœºåˆ¶ Class.getClassLoader() å¯ä»¥å¾—åˆ°ç±»åŠ è½½å™¨ä¿¡æ¯ã€‚

é™¤äº†ä»¥ä¸Šåˆ—ä¸¾çš„ä¸‰ç§ç±»åŠ è½½å™¨ï¼Œè¿˜æœ‰ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹å°±æ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆcontext class loaderï¼‰ï¼Œä» JDK 1.2 å¼€å§‹å¼•å…¥çš„ã€‚Java.lang.Thread ç±»ä¸­çš„æ–¹æ³• getContextClassLoader()å’Œ setContextClassLoader(ClassLoader cl)ç”¨æ¥è·å–å’Œè®¾ç½®çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡ setContextClassLoader(ClassLoader cl)æ–¹æ³•è¿›è¡Œè®¾ç½®çš„è¯ï¼Œçº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚Java åº”ç”¨è¿è¡Œçš„åˆå§‹çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç å¯ä»¥é€šè¿‡æ­¤ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»å’Œèµ„æºã€‚ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå¯ä»¥åœ¨æ‰§è¡Œçº¿ç¨‹ä¸­æŠ›å¼ƒåŒäº²å§”æ´¾åŠ è½½é“¾æ¨¡å¼ï¼Œä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡é‡Œçš„ç±»åŠ è½½å™¨åŠ è½½ç±»ã€‚å…¸å‹çš„ä¾‹å­æœ‰ï¼šé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡æ¥åŠ è½½ç¬¬ä¸‰æ–¹åº“jndiå®ç°ï¼Œè€Œä¸ä¾èµ–äºåŒäº²å§”æ´¾ã€‚å¤§éƒ¨åˆ†Java applicationæœåŠ¡å™¨(jboss, tomcat..)ä¹Ÿæ˜¯é‡‡ç”¨contextClassLoaderæ¥å¤„ç†webæœåŠ¡ã€‚è¿˜æœ‰ä¸€äº›é‡‡ç”¨hot swapç‰¹æ€§çš„æ¡†æ¶ï¼Œä¹Ÿä½¿ç”¨äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œæ¯”å¦‚ seasar (full stack framework in japenese)ã€‚

JVMåœ¨åŠ è½½ç±»æ—¶é»˜è®¤é‡‡ç”¨çš„æ˜¯åŒäº²å§”æ´¾æœºåˆ¶ã€‚é€šä¿—çš„è®²ï¼Œå°±æ˜¯æŸä¸ªç‰¹å®šçš„ç±»åŠ è½½å™¨åœ¨æ¥åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œé¦–å…ˆå°†åŠ è½½ä»»åŠ¡å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œä¾æ¬¡é€’å½’ (æœ¬è´¨ä¸Šå°±æ˜¯loadClasså‡½æ•°çš„é€’å½’è°ƒç”¨)ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ã€‚å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆè¿™ä¸ªç±»åŠ è½½è¯·æ±‚ï¼Œå°±æˆåŠŸè¿”å›ï¼›åªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½è¯·æ±‚æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚äº‹å®ä¸Šï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¶ŠåŸºç¡€çš„ç±»ç”±è¶Šä¸Šå±‚çš„åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå› ä¸ºè¿™äº›åŸºç¡€ç±»ä¹‹æ‰€ä»¥ç§°ä¸ºâ€œåŸºç¡€â€ï¼Œæ˜¯å› ä¸ºå®ƒä»¬æ€»æ˜¯ä½œä¸ºè¢«ç”¨æˆ·ä»£ç è°ƒç”¨çš„APIï¼ˆå½“ç„¶ï¼Œä¹Ÿå­˜åœ¨åŸºç¡€ç±»å›è°ƒç”¨æˆ·ç”¨æˆ·ä»£ç çš„æƒ…å½¢ï¼‰ã€‚ ç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ã€‚

è™šæ‹Ÿæœºå‡ºäºå®‰å…¨ç­‰å› ç´ è€ƒè™‘ï¼Œä¸ä¼šåŠ è½½<JAVA_HOME>/libç›®å½•ä¸‹å­˜åœ¨çš„é™Œç”Ÿç±»ï¼Œæ¢å¥è¯è¯´ï¼Œè™šæ‹ŸæœºåªåŠ è½½<JAVA_HOME>/libç›®å½•ä¸‹å®ƒå¯ä»¥è¯†åˆ«çš„ç±»ã€‚å› æ­¤ï¼Œå¼€å‘è€…é€šè¿‡å°†è¦åŠ è½½çš„éJDKè‡ªèº«çš„ç±»æ”¾ç½®åˆ°æ­¤ç›®å½•ä¸‹æœŸå¾…å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½æ˜¯ä¸å¯èƒ½çš„ã€‚

åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç³»ç»Ÿé»˜è®¤æä¾›çš„ç±»åŠ è½½å™¨å®ç°å·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨è¿˜æ˜¯éœ€è¦ä¸ºåº”ç”¨å¼€å‘å‡ºè‡ªå·±çš„ç±»åŠ è½½å™¨ã€‚æ¯”å¦‚æ‚¨çš„åº”ç”¨é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“Javaç±»çš„å­—èŠ‚ä»£ç ï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œè¿™äº›å­—èŠ‚ä»£ç ç»è¿‡äº†åŠ å¯†å¤„ç†ã€‚è¿™ä¸ªæ—¶å€™æ‚¨å°±éœ€è¦è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥ä»æŸä¸ªç½‘ç»œåœ°å€ä¸Šè¯»å–åŠ å¯†åçš„å­—èŠ‚ä»£ç ï¼Œæ¥ç€è¿›è¡Œè§£å¯†å’ŒéªŒè¯ï¼Œæœ€åå®šä¹‰å‡ºè¦åœ¨Javaè™šæ‹Ÿæœºä¸­è¿è¡Œçš„ç±»æ¥ã€‚ä¸‹é¢å°†é€šè¿‡ä¸¤ä¸ªå…·ä½“çš„å®ä¾‹æ¥è¯´æ˜ç±»åŠ è½½å™¨çš„å¼€å‘ã€‚é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»è£…è½½å™¨ï¼Œä½ çš„ç¨‹åºå¯ä»¥åŠ è½½åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“æˆ–è€…å°šæœªå­˜åœ¨çš„ç±»æˆ–è€…æ¥å£ï¼Œå¹¶åŠ¨æ€è¿æ¥å®ƒä»¬å¹¶è¿›è¡Œæœ‰é€‰æ‹©çš„è§£æã€‚

é™¤äº†å’Œæœ¬åœ°å®ç°å¯†åˆ‡ç›¸å…³çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¹‹å¤–ï¼ŒåŒ…æ‹¬æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨å†…çš„æ‰€æœ‰å…¶ä»–ç±»åŠ è½½å™¨æˆ‘ä»¬éƒ½å¯ä»¥å½“åšè‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å¯¹å¾…ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯æ˜¯å¦è¢«è™šæ‹Ÿæœºé»˜è®¤ä½¿ç”¨ã€‚å‰é¢çš„å†…å®¹ä¸­å·²ç»å¯¹java.lang.ClassLoaderæŠ½è±¡ç±»ä¸­çš„å‡ ä¸ªé‡è¦çš„æ–¹æ³•åšäº†ä»‹ç»ï¼Œè¿™é‡Œå°±ç®€è¦å™è¿°ä¸€ä¸‹ä¸€èˆ¬ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„å·¥ä½œæµç¨‹ï¼ˆå¯ä»¥ç»“åˆåé¢é—®é¢˜è§£ç­”ä¸€èµ·çœ‹ï¼‰ï¼š

	1ã€é¦–å…ˆæ£€æŸ¥è¯·æ±‚çš„ç±»å‹æ˜¯å¦å·²ç»è¢«è¿™ä¸ªç±»è£…è½½å™¨è£…è½½åˆ°å‘½åç©ºé—´ä¸­äº†ï¼Œå¦‚æœå·²ç»è£…è½½ï¼Œç›´æ¥è¿”å›ï¼›å¦åˆ™è½¬å…¥æ­¥éª¤2ï¼›

	2ã€å§”æ´¾ç±»åŠ è½½è¯·æ±‚ç»™çˆ¶ç±»åŠ è½½å™¨ï¼ˆæ›´å‡†ç¡®çš„è¯´åº”è¯¥æ˜¯åŒäº²ç±»åŠ è½½å™¨ï¼ŒçœŸå®è™šæ‹Ÿæœºä¸­å„ç§ç±»åŠ è½½å™¨æœ€ç»ˆä¼šå‘ˆç°æ ‘çŠ¶ç»“æ„ï¼‰ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨èƒ½å¤Ÿå®Œæˆï¼Œåˆ™è¿”å›çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„Classå®ä¾‹ï¼›å¦åˆ™è½¬å…¥æ­¥éª¤3ï¼›

	3ã€è°ƒç”¨æœ¬ç±»åŠ è½½å™¨çš„ findClass() æ–¹æ³•ï¼Œè¯•å›¾è·å–å¯¹åº”çš„å­—èŠ‚ç ã€‚å¦‚æœè·å–çš„åˆ°ï¼Œåˆ™è°ƒç”¨ defineClass() å¯¼å…¥ç±»å‹åˆ°æ–¹æ³•åŒºï¼›å¦‚æœè·å–ä¸åˆ°å¯¹åº”çš„å­—èŠ‚ç æˆ–è€…å…¶ä»–åŸå› å¤±è´¥ï¼Œå‘ä¸ŠæŠ›å‡ºå¼‚å¸¸ã€‚

åœ¨Javaä¸­ï¼Œä¸€ä¸ªç±»ç”¨å…¶å®Œå…¨åŒ¹é…ç±»å(fully qualified class name)ä½œä¸ºæ ‡è¯†ï¼Œè¿™é‡ŒæŒ‡çš„å®Œå…¨åŒ¹é…ç±»ååŒ…æ‹¬åŒ…åå’Œç±»åã€‚ä½†åœ¨JVMä¸­ï¼Œä¸€ä¸ªç±»ç”¨å…¶å…¨åå’Œä¸€ä¸ªClassLoaderçš„å®ä¾‹ ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œä¸åŒç±»åŠ è½½å™¨åŠ è½½çš„ç±»å°†è¢«ç½®äºä¸åŒçš„å‘½åç©ºé—´ã€‚

åœ¨java.netåŒ…ä¸‹æœ‰ä¸€ä¸ª URLClassLoader ç±»æä¾›äº†è¿ç¨‹åŠ è½½ç±»çš„åŠŸèƒ½ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼è¿›è¡ŒåŠ è½½ï¼š

	* æ–‡ä»¶: (ä»æ–‡ä»¶ç³»ç»Ÿç›®å½•åŠ è½½)
	* jaråŒ…: (ä»JaråŒ…è¿›è¡ŒåŠ è½½)
	* Http: (ä»è¿œç¨‹çš„HttpæœåŠ¡è¿›è¡ŒåŠ è½½)

ä¸€ä¸ªclassè¢«ä¸€ä¸ªClassLoaderå®ä¾‹åŠ è½½è¿‡çš„è¯ï¼Œå°±ä¸èƒ½å†è¢«è¿™ä¸ªClassLoaderå®ä¾‹å†æ¬¡åŠ è½½ï¼Œå³åŠ è½½ç±»æ—¶è°ƒç”¨äº†defileClass()æ–¹æ³•ï¼Œé‡æ–°åŠ è½½å­—èŠ‚ç ã€è§£æã€éªŒè¯åå°±ä¸èƒ½é‡å¤æ‰§è¡Œã€‚ç³»ç»Ÿé»˜è®¤çš„AppClassLoaderåŠ è½½å™¨å†…éƒ¨ä¼šç¼“å­˜åŠ è½½è¿‡çš„classï¼Œé‡æ–°åŠ è½½çš„è¯ï¼Œå°±ç›´æ¥å–ç¼“å­˜ã€‚æ‰€ä»¥éœ€è¦çƒ­åŠ è½½åªèƒ½é‡æ–°åˆ›å»ºä¸€ä¸ªClassLoaderï¼Œç„¶åå†å»åŠ è½½å·²ç»è¢«åŠ è½½è¿‡çš„classæ–‡ä»¶ã€‚å®ç°çƒ­åŠ è½½éœ€è¦é‡è½½ ClassLoader çš„ loadClass() æ–¹æ³•ï¼Œè·³è¿‡å†…éƒ¨çš„åŒäº²å§”æ‰˜æœºåˆ¶ã€‚å³ä½¿ä¸é‡‡ç”¨åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œæ¯”å¦‚java.langåŒ…ä¸­çš„ç›¸å…³ç±»è¿˜æ˜¯ä¸èƒ½è‡ªå®šä¹‰ä¸€ä¸ªåŒåçš„ç±»æ¥ä»£æ›¿ï¼Œä¸»è¦å› ä¸ºJVMè§£æã€éªŒè¯classçš„ æ—¶å€™ï¼Œä¼šè¿›è¡Œç›¸å…³åˆ¤æ–­ã€‚å¼ºåˆ¶é‡å¤åŠ è½½å¼•å‘ java.lang.LinkageError å¼‚å¸¸ï¼š

	Exception in thread "main" java.lang.LinkageError: loader (instance of  NetworkClassLoader): attempted  duplicate class definition

JVMä¸­classå’ŒMetaä¿¡æ¯å­˜æ”¾åœ¨PermGen spaceåŒºåŸŸã€‚å¦‚æœåŠ è½½çš„classæ–‡ä»¶å¾ˆå¤šï¼Œé‚£ä¹ˆå¯èƒ½å¯¼è‡´PermGen spaceåŒºåŸŸç©ºé—´æº¢å‡ºã€‚å¼•èµ·ï¼šjava.lang.OutOfMemoryErrorPermGen space. å¯¹äºæœ‰äº›Classæˆ‘ä»¬å¯èƒ½åªéœ€è¦ä½¿ç”¨ä¸€æ¬¡ï¼Œå°±ä¸å†éœ€è¦äº†ï¼ŒJVMä¸­çš„Classåªæœ‰æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰èƒ½è¢«GCå›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯¥Classè¢«å¸è½½ï¼ˆunloadï¼‰ï¼š

	è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«GCã€‚
	åŠ è½½è¯¥ç±»çš„ClassLoaderå®ä¾‹å·²ç»è¢«GCã€‚
	è¯¥ç±»çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚
	System.gc()æ‰§è¡Œåçš„Classçš„å¸è½½æ˜¯ä¸å¯æ§çš„ã€‚


## âš¡ NetWorkClassLoader è‡ªå®šä¹‰è¿œç¨‹ç±»åŠ è½½å™¨

è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œåªéœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š

- æ–°å»ºä¸€ä¸ª MyClassLoader ç»§æ‰¿ ClassLoaderï¼›
- é‡å†™ loadclass æ–¹æ³•ï¼Œè¯»å…¥å­—èŠ‚ç ï¼›
- ä½¿ç”¨ defineClass è¿”å›ç±»å®šä¹‰ã€‚

å› ä¸º JDK å·²ç»åœ¨ loadClass æ–¹æ³•ä¸­å¸®æˆ‘ä»¬å®ç°äº†æœç´¢ç±»çš„ç®—æ³•ï¼Œå½“åœ¨ loadClass æ–¹æ³•ä¸­æœç´¢ä¸åˆ°ç±»æ—¶ï¼Œæ‰ä¼šè°ƒç”¨ findClass æ–¹æ³•æ¥æœç´¢ç±»ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€é‡å†™è¯¥æ–¹æ³•å³å¯ï¼Œå¦‚æ²¡æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œä¸€èˆ¬ä¸å»ºè®®é‡å†™ loadClass æœç´¢ç±»çš„ç®—æ³•ã€‚

åå°„æœºåˆ¶çš„åº”ç”¨å¿…é¡»è¦æ±‚è¯¥ç±»æ˜¯ public è®¿é—®æƒé™çš„ç±»ï¼Œè¿™æ ·æ‰èƒ½ç”±åŠ è½½å™¨åŠ è½½ã€‚è¦å®ç° HotSwap çƒ­åŠ è½½ï¼Œåªéœ€è¦åˆ›å»ºæ–°å®ä¾‹å»åŠ è½½ç›®æ ‡ç±»å°±å¯ä»¥ï¼Œçƒ­åŠ è½½é€»è¾‘å¯ä»¥æ ¹æ®æ–‡ä»¶æ›´æ–°æ—¶é—´æ¥åšåˆ¤æ–­ã€‚

	import java.lang.reflect.*;
	import java.io.ByteArrayOutputStream;
	import java.io.InputStream;
	import java.io.InputStreamReader;
	import java.io.BufferedReader;
	import java.net.URL;
	import java.net.HttpURLConnection;

	/**
	 * NetworkClassLoader ncl = new NetworkClassLoader("http://xxx.com");  
	 * String basicClassName = "Gum";  
	 * Class<?> clazz = ncl.loadClass(basicClassName);
	 * Gum oo = (Gum)clazz.newInstance();
	 */
	class NetworkClassLoader extends ClassLoader {

		private String rootUrl;

		public NetworkClassLoader(String rootUrl) {
			this.rootUrl = rootUrl;
		}

		@Override
		protected Class<?> findClass(String name) throws ClassNotFoundException {
			byte[] classData = getClassData(name);
			if (classData == null) {
				throw new ClassNotFoundException();
			} else {
				return defineClass(name, classData, 0, classData.length);
			}
		}

		private byte[] getClassData(String className) {
			String path = rootUrl + "/" + className.replace('.', '/') + ".class";
			try {
				URL url = new URL(path);
			// HttpURLConnection con = (HttpURLConnection)url.openConnection();
			// System.out.println(con.getResponseCodeâ€‹() +" "+ con.getContentType());
			// BufferedReader buffer = new BufferedReader(new InputStreamReader(ins));
			// StringBuffer bs = new StringBuffer();
			// String line  = null;
			// while((line=buffer.readLine())!=null){
			// 	bs.append(line);
			// }
			// System.out.println("getClassData:"+bs.length()+":"+bs.substring(0));
			// return bs.toString().getBytes();
				InputStream ins = url.openStream();
				ByteArrayOutputStream baos = new ByteArrayOutputStream();
				int bufferSize = 4096;
				byte[] buffer = new byte[bufferSize];
				int len = 0;
				while ((len = ins.read(buffer)) != -1) {
					baos.write(buffer, 0, len);
				}
				System.out.println("getClassData:"+len+":");
				return baos.toByteArray();
			} catch (Exception e) {
				System.out.println("getClassData exception:");
				e.printStackTrace();
			}
			System.out.println("getClassData null:");
			return null;
		}

		@Override
		public Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {
			Class c = findLoadedClass(name);
			if( name.startsWith("java.") ){
				ClassLoader system = ClassLoader.getSystemClassLoader();
				c = system.loadClass(name);
			}
			if( null==c ) c = findClass(name);
			if( null!=c && resolve ) resolveClass(c);
			return c;
		}

	}




# ğŸš© Exceptiions vs. Errors

å¼‚å¸¸ä¸é”™è¯¯æ˜¯ç¨‹åºè¿è¡Œä¸­çš„ä¸¤ç§çŠ¶æ€ï¼Œé”™è¯¯æ˜¯ç³»ç»Ÿå±‚é¢çš„ï¼Œé”™è¯¯ä¸å¯èƒ½æ˜¯æ­£ç¡®ï¼Œé€šå¸¸å¯¼è‡´ç¨‹åºç»ˆæ­¢ï¼Œæ¯”å¦‚ç³»ç»Ÿå†…å­˜æŸåã€‚å¼‚å¸¸æ˜¯ç¨‹åºè¿è¡Œçš„ä¸€ç§éæ­£å¸¸ç°è±¡ï¼Œé€šå¸¸æ˜¯æ•°æ®é€»è¾‘é—®é¢˜ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡å¤„ç†å¼‚å¸¸æ¢å¤ç¨‹åºæ­£ç¡®è¿è¡Œã€‚

ä»ç±»å‹ç³»ç»Ÿä¸­çš„å®šä¹‰å°±å¯ä»¥ä½“ç°å®ƒä»¬çš„å·®åˆ«ï¼š

1. `OutOfMemoryError`: Java Virtual Machine (JVM) è¿è¡Œå‡ºç°å†…å­˜ä¸è¶³æ—¶è§¦å‘ï¼›
2. `StackOverflowError`: ç¨‹åºæ ˆå†…å­˜æº¢å‡ºï¼ˆæ‰€åˆ†é…çš„æ ˆå†…å­˜ä¸è¶³ï¼‰æ—¶è§¦å‘ï¼›
3. `NoClassDefFoundError`: è¯·æ±‚çš„ç±»å‹æœªèƒ½åŠ è½½åˆ°å†…å­˜æ—¶è§¦å‘ï¼›

1. `NullPointerException`: è®¿é—®ç©ºå¼•ç”¨å¯¹è±¡æ—¶è§¦å‘ï¼›
2. `IllegalArgumentException`: æ–¹æ³•å‚æ•°ä¼ é€’é”™è¯¯æ—¶è§¦å‘ï¼›
3. `IOException`: æ“ä½œ I/O å¤±è´¥æ—¶è§¦å‘ï¼›

ç¨‹åºé€»è¾‘é”™è¯¯å¤§éƒ¨åˆ†å¯ä»¥åœ¨ç¼–è¯‘å…¶æ£€æŸ¥å¹¶ä¸”æ’é™¤ï¼Œè€Œéƒ¨åˆ†éœ€è¦ä¾èµ–è¿è¡Œæ—¶æ•°æ®çš„é—®é¢˜ï¼Œåˆ™ä¸èƒ½ç›´æ¥åœ¨ç¼–è¯‘æœŸå¤„ç†ï¼Œè¿™éƒ¨åˆ†é—®é¢˜ç§°ä¸º Runtime Exceptionï¼Œæ ¹æ®å¤„ç†çŠ¶æ€ï¼Œå¯ä»¥åˆ†ä¸º Uncheked  å’Œ Checked Exceptionã€‚

Java è¯­è¨€ä¸­çš„ `Exception` å’Œ `Error` éƒ½ç»§æ‰¿è‡ª Throwableï¼Œå¯ä»¥é…åˆ try æˆ– throws ä½¿ç”¨ã€‚try-catch-finally ç»“æ„ä¸­ï¼Œcatch ç”¨äºæ•æ‰ã€å¤„ç†å¼‚å¸¸ï¼Œå®ƒå’Œ finally æ˜¯å¯é€‰çš„ï¼Œä½†å¿…éœ€æœ‰å…¶ä¸€ã€‚finally æ˜¯æ¸…åœºå¤„ç†ï¼Œä¸€å®šä¼šæ‰§è¡Œï¼Œå³ä½¿ catch å—ä¸­ä½¿ç”¨äº† return è¯­å¥ã€‚ä½†å®ƒæœ¬èº«ä¸å¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”ï¼Œåœ¨ finally ä¸­å†è§¦å‘å¼‚å¸¸æ—¶ä¼šå¯¼è‡´ç°æœ‰çš„å¼‚å¸¸ä¿¡æ¯ä¸¢å¤±ï¼

å®ç”¨ä¸­ï¼Œä¸ºäº†åŒ…å«å±‚å±‚ä¼ é€’çš„å¼‚å¸¸å †æ ˆä¿¡æ¯ï¼Œå¹¶ä¸”åˆéœ€è¦æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ `initCause(deeper_exptiion)` æ–¹æ³•åŒ…è£…æ›´åº•å±‚æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡ä¿¡æ¯ã€‚æ‰“å° stacktrace ä¿¡æ¯æ—¶ï¼Œè¢«åŒ…è£…çš„å¼‚å¸¸ä¿¡æ¯å°±ä»¥ Caused by çš„å½¢å¼å±•ç¤ºã€‚

```java
package mgid;
import java.lang.Exception;

public class App 
{
    static void trigger() throws Exception {
        try {
            throw new Exception("original exceptiion");
        } catch (Exception e) {
            Exception c = new Exception("Chaining exception");
            c.initCause(e);
            return
            // throw c;
            // System.out.println("Dead code here.");
        } finally {
            System.out.println("Finally. Always execute, event return above.");
        }
    }
    public static void main( String[] args ) throws Exception
    {
        System.out.println( "Hello World!" );
        try {
            trigger();
        } finally {}
    }
}
```

# ğŸš© Java ç½‘è¯¾å¤§çº²

æ¨¡å—ä¸€ï¼šJVM è¿›é˜¶ - Javaå¼€å‘è€…å¤§å‚é¢è¯•å¿…çŸ¥å¿…ä¼š

	æ•™å­¦ç›®æ ‡
	1. ä» 0 æŒæ¡ JVM å…³é”®æŠ€æœ¯ï¼Œäº†è§£æ ¸å¿ƒçŸ¥è¯†ï¼›
	2. å…¨é¢äº†è§£å„ç±» GC ç®—æ³•çš„åŸç†å’Œç‰¹æ€§ï¼Œæ´æ‚‰ç›¸å…³åŸç†ï¼›
	3. å…¨é¢å­¦ä¹ å¸¸è§çš„ JVM åˆ†æè°ƒä¼˜å·¥å…·ï¼Œä¸Šæ‰‹åå…«èˆ¬æ­¦è‰ºï¼›
	4. ä¸€çº¿å¤§å‚ JVM é¢è¯•é¢˜å…¨é¢å‰–æï¼ŒåŠ©åŠ›æ‹¿åˆ°å¿ƒä»ª Offerã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. æ²¡æœ‰ç»è¿‡ä½“ç³»åŒ– JVM å­¦ä¹ ï¼Œä¸æ‡‚åŸç†ï¼Œåšä¸åˆ°çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼›
	2. ä¸ç†Ÿæ‚‰ JVM å·¥å…·å’Œæ–¹æ³•ï¼Œé‡åˆ°é—®é¢˜ä¸çŸ¥é“ä»ä½•ä¸‹æ‰‹ã€å¦‚ä½•åˆ†æå’Œè§£å†³é—®é¢˜ï¼›
	3. ç¼ºä¹å®é™…åœºæ™¯çš„ç»ƒä¹ ï¼Œæ¯æ¬¡çœ‹çœ‹ä¹¦ä¸Šçš„çŸ¥è¯†å°±å¿˜ï¼Œç†è§£ä¸æ·±ï¼Œæ— æ³•åšåˆ°èä¼šè´¯é€šï¼›
	4. åœ¨é¢è¯•è¿‡ç¨‹ä¸­åå›æœ‰ä¹å›éƒ½é‡åˆ°é—® JVM ç†è®ºå’Œåˆ†æè°ƒä¼˜çš„é—®é¢˜ï¼Œæ¯æ¬¡éƒ½å¾ˆéš¾è®©é¢è¯•å®˜æ»¡æ„ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šæŒæ¡ JVM çš„åŸºç¡€çŸ¥è¯†å’Œå¸¸ç”¨å·¥å…·ï¼Œäº†è§£ä¸€èˆ¬åŸç†ï¼ŒçŸ¥é“ä»ä»€ä¹ˆåœ°æ–¹ç€æ‰‹åˆ†æé—®é¢˜ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šæŒæ¡å„ç±» GC ç®—æ³•çš„ä¸€èˆ¬åŸç†ï¼ŒçŸ¥é“å¦‚ä½•æ ¹æ®å®é™…éœ€è¦é€‰æ‹©ä½¿ç”¨åˆé€‚çš„ GC ç­–ç•¥ï¼›
	3. åˆ†æé—®é¢˜ï¼šæŒæ¡ GC æ—¥å¿—ã€çº¿ç¨‹ã€å†…å­˜ç­‰ç»´åº¦çš„åˆ†ææŠ€å·§ï¼ŒçŸ¥é“æ’æŸ¥é—®é¢˜å’Œä¼˜åŒ–ç³»ç»Ÿçš„å¥—è·¯ï¼›
	4. ç§¯ç´¯ç»éªŒï¼šäº†è§£å¸¸è§çš„åˆ†æè°ƒä¼˜ç»éªŒï¼Œç†Ÿæ‚‰å¸¸è§çš„é¢è¯•é—®é¢˜å’ŒæŠ€å·§ï¼Œå½»åº•å­¦ä¼š JVM çŸ¥è¯†ã€‚

	è¯¦ç»†å†…å®¹
	1. JVM åŸºç¡€çŸ¥è¯†ã€Java å­—èŠ‚ç æŠ€æœ¯ã€JVM ç±»åŠ è½½å™¨ã€JVM å†…å­˜æ¨¡å‹ã€JVM å¯åŠ¨å‚æ•°è¯¦è§£ï¼›
	2. JDK å†…ç½®å‘½ä»¤è¡Œå·¥å…·ã€JDK å†…ç½®å›¾å½¢ç•Œé¢å·¥å…·ã€JDWP ç®€ä»‹ã€JMX ä¸ç›¸å…³å·¥å…·ï¼›
	3. å¸¸è§çš„ JVM GC ç®—æ³•ï¼ˆParallel GC/CMS GC/G1 GCï¼‰åŸºæœ¬åŸç†å’Œç‰¹ç‚¹ï¼›
	4. æ–°ä¸€ä»£ GC ç®—æ³•ï¼ˆJava11 ZGC/Java12 Shenandoah) å’Œ Oracle GraalVMï¼›
	5. GC æ—¥å¿—è§£è¯»ä¸åˆ†æã€JVM çš„çº¿ç¨‹å †æ ˆç­‰æ•°æ®åˆ†æã€å†…å­˜ dump å’Œå†…å­˜åˆ†æå·¥å…·ï¼›
	6. fastThread ç›¸å…³å·¥å…·ä»¥åŠé¢ä¸´å¤æ‚é—®é¢˜æ—¶çš„å‡ ä¸ªé«˜çº§å·¥å…·çš„ä½¿ç”¨ï¼›
	7. JVM é—®é¢˜æ’æŸ¥åˆ†æçš„å¸¸ç”¨æ‰‹æ®µã€æ€§èƒ½è°ƒä¼˜çš„æœ€ä½³å®è·µç»éªŒç­‰ï¼›
	8. JVM ç›¸å…³çš„å¸¸è§é¢è¯•é—®é¢˜å¿…çŸ¥å¿…ä¼šã€å…¨é¢åˆ†æã€‚

æ¨¡å—äºŒï¼šNIO æŠ€æœ¯ - æ„å»ºé«˜ååæœåŠ¡å™¨çš„ç»ˆææ­¦å™¨

	æ•™å­¦ç›®æ ‡
	1. ç†è§£ NIO çš„ç›¸å…³æ¦‚å¿µå’ŒåŸç†ï¼Œäº†è§£æ ¸å¿ƒçŸ¥è¯†ï¼›
	2. å…¨é¢æŒæ¡ Netty ç›¸å…³çš„åŠŸèƒ½ç‰¹æ€§ï¼ŒæŒæ¡ Netty çš„æŠ€æœ¯åŸç†ï¼›
	3. å…¨é¢å­¦ä¼šä½¿ç”¨ Netty æŠ€æœ¯ç¼–ç¨‹ï¼Œèƒ½å¤Ÿå†™å‡ºé«˜æ•ˆæœåŠ¡å™¨ç«¯ä»£ç ï¼›
	4. æŒæ¡å¸¸ç”¨çš„æ€§èƒ½å‹æµ‹æŠ€æœ¯å’Œç›¸å…³å·¥å…·ï¼Œèƒ½å¤Ÿå‹æµ‹ HTTP æ¥å£æ€§èƒ½ã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. ä¸ç†è§£ NIO ç›¸å…³æ¦‚å¿µå’ŒæŠ€æœ¯ç‚¹ï¼Œæä¸æ¸…åŸç†ï¼Œæ²Ÿé€šå’Œé¢è¯•æ—¶æ— æ³•å‡†ç¡®è¡¨è¾¾ï¼›
	2. ç¼ºä¹å®é™…åœºæ™¯çš„ç»ƒä¹ ï¼Œå¯¹ Netty çš„ä½¿ç”¨å’ŒåŸç†ä¸ç†Ÿæ‚‰ï¼Œéš¾ä»¥åº”ç”¨åˆ°å·¥ä½œä¸­ï¼›
	3. ä¸ä¼šä½¿ç”¨ Netty åšé«˜æ€§èƒ½æœåŠ¡ç«¯ç¼–ç¨‹ï¼Œå¯¹æ€§èƒ½ç›¸å…³æŒ‡æ ‡å’Œæ•°æ®æ²¡æœ‰æ¦‚å¿µã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šæŒæ¡ NIO ç›¸å…³çš„çŸ¥è¯†å’ŒæŠ€æœ¯ï¼Œèƒ½çŸ¥é“å„ç§æŠ€æœ¯æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Œé€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šç†Ÿç»ƒæŒæ¡ Netty/NIO ç¼–ç¨‹ï¼Œèƒ½å¤Ÿè®¾è®¡å®ç°ä¸€ä¸ªé«˜æ€§èƒ½ HTTP æœåŠ¡å™¨/ API ç½‘å…³ï¼›
	3. ç§¯ç´¯ç»éªŒï¼šäº†è§£å¸¸è§çš„æ€§èƒ½ç›¸å…³æ¦‚å¿µå’Œå‹æµ‹å…¥é—¨ï¼Œå¯¹æ€§èƒ½æŒ‡æ ‡æœ‰æ¸…æ™°æ¦‚å¿µï¼Œèƒ½å¤Ÿç®€å•åœ°é‡åŒ–åˆ†æã€‚

	è¯¦ç»†å†…å®¹
	1. åŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡ã€BIOã€NIOã€AIOã€Reactor/Proactorï¼›
	2. ByteBuff/Acceptor/Channel/Handlerã€NioEventLoopGroup/EventLoopã€bossGroup/workerGroupï¼›
	3. Netty çš„å¯åŠ¨å’Œæ‰§è¡Œè¿‡ç¨‹ã€çº¿ç¨‹æ¨¡å‹ã€äº‹ä»¶é©±åŠ¨ã€æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹å¼ï¼›
	4. å¸¸è§çš„ API Gateway/HTTP Serverã€SEDA åŸç†ã€ä¸šåŠ¡ API ç½‘å…³çš„åŠŸèƒ½å’Œç»“æ„ï¼›
	5. Throughout/TPS/QPSã€Latency/P99/P95/P90ã€ApacheBench/Wrk/JMeter/LoadRunnerã€‚

æ¨¡å—ä¸‰ï¼šå¹¶å‘ç¼–ç¨‹ - å¤šæ ¸å¤„ç†å™¨æ—¶ä»£é«˜æ€§èƒ½çš„ç§˜è¯€

	æ•™å­¦ç›®æ ‡
	1. å­¦ä¼šå¤šçº¿ç¨‹ã€é«˜å¹¶å‘ç›¸å…³æ¦‚å¿µå’ŒæŠ€æœ¯ï¼Œäº†è§£å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒçŸ¥è¯†ï¼›
	2. å…¨é¢äº†è§£å¹¶å‘çš„ç›¸å…³æŠ€æœ¯çš„åŸç†å’Œç”¨é€”ï¼Œæ´æ‚‰æŠ€æœ¯åŸç†å’Œç›¸äº’å…³ç³»ï¼›
	3. ç†Ÿç»ƒæŒæ¡ Java çš„å¤šçº¿ç¨‹ã€å¹¶å‘åŒ…ä¸­å„ä¸ªç±»çš„ä½¿ç”¨ï¼Œä¸Šæ‰‹åå…«èˆ¬æ­¦è‰ºã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. æ²¡æœ‰ç»è¿‡ç³»ç»Ÿæ€§å­¦ä¹ å¹¶å‘ç¼–ç¨‹ï¼Œæä¸æ¸…æ¥šæŠ€æœ¯åŸç†ï¼Œå†™ä¸å‡ºä¸€ä¸ªè‰¯å¥½çš„å¤šçº¿ç¨‹/å¼‚æ­¥ä»£ç ï¼›
	2. ä¸ç†Ÿæ‚‰ Java çš„å„ä¸ªå¤šçº¿ç¨‹å·¥å…·å’Œæ–¹æ³•ï¼Œé‡åˆ°å¤šçº¿ç¨‹é—®é¢˜å¸¸å¸¸æŸæ‰‹æ— æªï¼Œä¸ä¼šåˆ†æè§£å†³é—®é¢˜ï¼›
	3. ç¼ºä¹å®é™…åœºæ™¯çš„ç»ƒä¹ ï¼Œå¹³æ—¶æ²¡æ€ä¹ˆç”¨åˆ°å¤šçº¿ç¨‹å’Œå¹¶å‘ï¼Œå¯¼è‡´æ­»è®°ç¡¬èƒŒçš„æ¦‚å¿µæ€»æ˜¯è®°ä¸ä½ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šç³»ç»ŸæŒæ¡ Java å¤šçº¿ç¨‹å’Œå¹¶å‘ç¼–ç¨‹çš„æŠ€æœ¯åŸç†å’ŒçŸ¥è¯†ç‚¹ï¼Œå†™å‡ºä¼˜ç§€çš„å¹¶å‘ä»£ç ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šç†Ÿç»ƒåº”ç”¨å„ç§å¹¶å‘å·¥å…·ï¼Œäº†è§£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å“ªäº›å…·ä½“çš„æŠ€æœ¯å’Œæ–¹æ³•ï¼›
	3. åˆ†æé—®é¢˜ï¼šæŒæ¡å¸¸è§çš„å¤šçº¿ç¨‹å’Œå¹¶å‘é—®é¢˜åˆ†ææŠ€å·§ï¼ŒçŸ¥é“æ’æŸ¥ä¸€èˆ¬é—®é¢˜çš„å…·ä½“æ­¥éª¤ï¼›
	4. ç§¯ç´¯ç»éªŒï¼šæ„å»ºå®Œæ•´å…¨é¢çš„å¹¶å‘ç¼–ç¨‹çŸ¥è¯†ä½“ç³»ï¼Œç†Ÿæ‚‰å¸¸è§çš„é¢è¯•é—®é¢˜å’ŒæŠ€å·§ï¼Œå½»åº•æŒæ¡ Java å¹¶å‘ç¼–ç¨‹çŸ¥è¯†ã€‚

	è¯¦ç»†å†…å®¹
	1. Java å¤šçº¿ç¨‹åŸºç¡€ï¼šçº¿ç¨‹ã€é”ã€synchronizedã€volatile/finalã€sleep/await/notify/fork/joinï¼›
	2. Java å¹¶å‘åŒ…åŸºç¡€ï¼šçº¿ç¨‹æ±  Executorã€AQS/CASã€Atomic åŸå­æ“ä½œã€Lock/ReadWriteLock/Conditionã€Callable/Futureï¼›
	3. Java å¹¶å‘å®¹å™¨ä¸å·¥å…·ï¼šBlockingQueue/CopyOnWriteList/ConcurrentHashMapã€CountDownLatch/CyclicBarrier/Semaphore ç­‰ï¼›
	4. å…¶ä»–ï¼šä¸‡é‡‘æ²¹ ThreadLocalï¼ŒåŒ–ç¹ä¸ºç®€ Java8 parallelStream ç­‰ã€‚

æ¨¡å—å››ï¼šå¼€å‘æ¡†æ¶ - æ·±å…¥ç†è§£ Spring ç­‰ä¸»æµæ¡†æ¶æ€æƒ³

	æ•™å­¦ç›®æ ‡
	1. é‡æ–°è®¤è¯†ä¸»æµå¼€æºæŠ€æœ¯æ¡†æ¶ï¼Œæ·±å…¥ç†è§£èƒŒåçš„åŸç†å’Œå…³ç³»ï¼›
	2. æŒæ¡æ•´åˆå„ç§æ¡†æ¶çš„æœ€ä½³å®è·µï¼Œå­¦ä¼šåœ¨å·¥ä½œä¸­åšæŠ€æœ¯æ¡†æ¶é€‰å‹ï¼›
	3. äº†è§£ä¸»æµæ¡†æ¶çš„å‘å±•è¶‹åŠ¿ï¼Œä¸€çº¿å¤§å‚çš„ä½¿ç”¨æ¨¡å¼å’Œå…³æ³¨ç‚¹ã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. å¯¹ä¸»æµå¼€æºæŠ€æœ¯æ¡†æ¶ï¼Œå§‹ç»ˆåœ¨ä¼šç”¨ã€ä¼šåšç®€å•æ•´åˆï¼Œä¸æ‡‚èƒŒååŸç†ï¼›
	2. åªä¼šç”¨è‡ªå·±ç†Ÿæ‚‰çš„æ¡†æ¶ï¼Œä¸ä¼šåšæŠ€æœ¯é€‰å‹ï¼Œä¹Ÿä¸äº†è§£ä¸€äº›æœ€ä½³å®è·µç»éªŒï¼›
	3. æ¡†æ¶å‘å±•å¤ªå¿«ï¼Œå­¦ä¹ è·Ÿä¸ä¸Šäº†ï¼Œä¹Ÿä¸å¤ªäº†è§£ä¸€çº¿å¤§å‚ä½¿ç”¨ä¸»æµæ¡†æ¶çš„æ–¹å¼ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šä»æ›´é«˜çš„ç»´åº¦å’Œæ›´æ·±å…¥çš„åŸç†ï¼Œé‡æ–°å­¦ä¹ ä¸»æµæ¡†æ¶ï¼Œäº†è§£æ¡†æ¶çš„å†…åœ¨è”ç³»ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šæŒæ¡å¸¸è§æ¡†æ¶çš„ä¸€äº›æœ€ä½³å®è·µç»éªŒï¼Œèƒ½å¤Ÿæ ¹æ®å…·ä½“çš„é¡¹ç›®æƒ…å†µè¿›è¡ŒæŠ€æœ¯æ¡†æ¶é€‰å‹ï¼›
	3. ç§¯ç´¯ç»éªŒï¼šäº†è§£å¸¸è§ä¸»æµæ¡†æ¶çš„å‘å±•è¶‹åŠ¿ï¼ŒæŒæ¡æœ€ä½³å­¦ä¹ å§¿åŠ¿ï¼Œèƒ½å¤Ÿè½»æ¾é©¾é©­æŠ€æœ¯å‘å±•ã€‚

	è¯¦ç»†å†…å®¹
	1. Spring æŠ€æœ¯ä½“ç³»ï¼ˆSpring Core/Web/MVC/Data/Messagingã€Spring Boot ç­‰ï¼‰ï¼›
	2. ORM æŠ€æœ¯ä½“ç³»ï¼ˆJPAã€Hibernateã€MyBatis ç­‰ï¼‰ã€‚


æ¨¡å—äº”ï¼šç³»ç»Ÿæ€§èƒ½ä¼˜åŒ– - å­¦ä¼šæ€§èƒ½åˆ†æä¸ MySQL ä¼˜åŒ–

	æ•™å­¦ç›®æ ‡
	1. æ·±å…¥äº†è§£ä¸šåŠ¡ç³»ç»Ÿæ€§èƒ½çš„åº¦é‡åˆ†ææ–¹æ³•ï¼Œæ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆå’Œå…³é”®è·¯å¾„ï¼›
	2. äº†è§£ MySQL çš„æ€§èƒ½å…³é”®ç‚¹ï¼Œå­¦ä¼šå¦‚ä½•è¿›è¡Œ MySQL å’Œ SQL è¯­å¥çš„æ€§èƒ½åˆ†æï¼›
	3. æŒæ¡å¦‚ä½•ç¼–å†™é«˜æ•ˆçš„ SQL è¯­å¥ï¼Œèƒ½å¯¹å¤æ‚çš„ä¸šåŠ¡ SQL è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. æ€§èƒ½è°ƒä¼˜èƒ½åŠ›æ˜¯æ¶æ„å¸ˆ/æŠ€æœ¯ä¸“å®¶çš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ï¼Œä½†æ˜¯å¯¹è¿™ä¸€å—æ²¡ç»éªŒï¼›
	2. é‡åˆ°æ€§èƒ½é—®é¢˜ä¸çŸ¥é“ä»ä½•ä¸‹æ‰‹ã€å¦‚ä½•åˆ†ææ€§èƒ½ç“¶é¢ˆåœ¨å“ªå„¿ï¼Œä¹Ÿå°±ä¸çŸ¥é“å¦‚ä½•è§£å†³é—®é¢˜ï¼›
	3. ç¼ºä¹å®é™…åœºæ™¯çš„ç»ƒä¹ ï¼Œæ¯æ¬¡çœ‹åˆ«äººè®²çš„ç†è®ºï¼Œéƒ½æ²¡åŠæ³•è½¬åŒ–åˆ°å®é™…å·¥ä½œä¸­å»ï¼›
	4. åœ¨é¢è¯•è¿‡ç¨‹ä¸­ç»å¸¸è¢«é—®åˆ°åˆ†æè°ƒä¼˜çš„é—®é¢˜ï¼Œæ€»æ˜¯è§‰å¾—è‡ªå·±æ²¡æœ‰å¤ªå¤šå¹²è´§å¯è®²ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. æ·±å…¥å­¦ä¹ ï¼šé€šè¿‡ç³»ç»ŸåŒ–çš„å­¦ä¹ æ€§èƒ½ç›¸å…³çŸ¥è¯†å’Œå®è·µç»éªŒï¼ŒæŒæ¡å¤æ‚ä¸šåŠ¡ç³»ç»Ÿæ€§èƒ½åˆ†ææ–¹æ³•ï¼›
	2. åˆ†æé—®é¢˜ï¼šæŒæ¡ SQL/ç´¢å¼•/äº‹åŠ¡ çš„åˆ†ææŠ€å·§ï¼ŒçŸ¥é“æ’æŸ¥é—®é¢˜å’Œä¼˜åŒ– MySQL/SQL çš„åŠæ³•ï¼›
	3. ç§¯ç´¯ç»éªŒï¼šæŒæ¡ç¼–å†™é«˜æ€§èƒ½ SQL çš„æŠ€èƒ½ï¼Œé¿å…å¸¸è§çš„å„ç§ä½æ€§èƒ½å‘ï¼Œæå‡æ•°æ®åº“ç¼–ç¨‹æ°´å¹³ã€‚

	è¯¦ç»†å†…å®¹
	1. ç³»ç»Ÿå¯è§‚æµ‹æ€§ï¼ˆæ—¥å¿—ã€è°ƒç”¨é“¾è·Ÿè¸ªã€æŒ‡æ ‡åº¦é‡ï¼‰ï¼Œ80/20 ä¼˜åŒ–åŸåˆ™ï¼ŒCPUã€å†…å­˜ã€ç£ç›˜/ç½‘ç»œ IO ç­‰åˆ†æï¼›
	2. MySQL çš„é”ã€äº‹åŠ¡ã€ç´¢å¼•ã€å¹¶å‘çº§åˆ«ã€æ­»é”ã€æ‰§è¡Œè®¡åˆ’ã€æ…¢ SQL ç»Ÿè®¡ã€ç¼“å­˜å¤±æ•ˆã€å‚æ•°ä¼˜åŒ–ï¼›
	3. åº“è¡¨è®¾è®¡ä¼˜åŒ–ï¼Œå¼•æ“é€‰æ‹©ï¼Œè¡¨ç»“æ„ä¼˜åŒ–è®¾è®¡ï¼Œåˆ—ç±»å‹é€‰æ‹©ï¼Œç´¢å¼•è®¾è®¡ï¼Œå¤–é”®ç­‰ï¼›
	4. SQL æŸ¥è¯¢ä¼˜åŒ–ï¼Œç´¢å¼•é€‰æ‹©ï¼Œè¿æ¥ä¼˜åŒ–ï¼ŒèšåˆæŸ¥è¯¢ä¼˜åŒ–ï¼ŒUnion ä¼˜åŒ–ï¼Œå­æŸ¥è¯¢ä¼˜åŒ–ï¼Œæ¡ä»¶ä¼˜åŒ–ç­‰ï¼›
	5. åœºæ™¯åˆ†æï¼Œä¸»é”®ç”Ÿæˆä¸ä¼˜åŒ–ï¼Œé«˜æ•ˆåˆ†é¡µï¼Œå¿«é€Ÿå¯¼å…¥å¯¼å‡ºæ•°æ®ï¼Œè§£å†³æ­»é”é—®é¢˜ç­‰ã€‚


æ¨¡å—å…­ï¼šè¶…è¶Šåˆ†åº“åˆ†è¡¨ - æŒæ¡æµ·é‡ä¸šåŠ¡æ•°æ®çš„åº”å¯¹ä¹‹é“

	æ•™å­¦ç›®æ ‡
	1. ä» 0 æŒæ¡æµ·é‡ä¸šåŠ¡æ•°æ®å¤„ç†çš„å…³é”®æŠ€æœ¯ï¼Œäº†è§£æ ¸å¿ƒçŸ¥è¯†ï¼Œå‚ä¸å®è·µæ¡ˆä¾‹ï¼›
	2. å…¨é¢å­¦ä¹  MySQL ä¸»ä»å¤åˆ¶æ¶æ„ï¼Œè¯»å†™åˆ†ç¦»å’Œæ•°æ®åº“å‚ç›´/æ°´å¹³æ‹†åˆ†ï¼›
	3. å­¦ä¹ åº”å¯¹ç³»ç»Ÿä¸åŒç±»å‹æ•°æ®çš„å¤„ç†åŠæ³•ï¼Œå¯¹æ•°æ®è¿›è¡Œå†·çƒ­åˆ†ç¦»ï¼Œæå‡ç³»ç»Ÿæ•°æ®å¤„ç†èƒ½åŠ›ï¼›
	4. å…¨é¢æŒæ¡å„ç±»åœºæ™¯ä¸‹çš„è¯»å†™åˆ†ç¦»ï¼Œæ•°æ®åº“æ‹†åˆ†çš„æ¡†æ¶å’Œä¸­é—´ä»¶ï¼Œåœ¨å®é™…å·¥ä½œä¸­ç†Ÿç»ƒä½¿ç”¨ã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. åªä¼šå¢åˆ æ”¹æŸ¥ï¼Œä¸äº†è§£å¯¹æµ·é‡ä¸šåŠ¡æ•°æ®çš„å¤„ç†åŠæ³•ï¼›
	2. æ¯æ¬¡è¢«äººé—®åˆ° MySQL çš„é«˜å¯ç”¨å’Œé«˜æ€§èƒ½æ¶æ„ï¼Œéƒ½ä¸èƒ½æ¸…æ™°åœ°è®²æ˜ç™½ï¼›
	3. ç¼ºä¹å®é™…åœºæ™¯çš„ç»ƒä¹ ï¼Œä¸äº†è§£ä¸åŒç±»å‹çš„æ•°æ®å¯¹åº”çš„å¤„ç†åŠæ³•ï¼›
	4. å¯¹äºå¸¸è§çš„è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ç­‰æŠ€æœ¯ï¼Œåœç•™åœ¨ç†è®ºé˜¶æ®µï¼Œæ²¡æœ‰åŠ¨æ‰‹å®è·µè¿‡ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šå…¨é¢äº†è§£ MySQL ä¸»ä»å¤åˆ¶æ¶æ„ï¼Œè¯»å†™åˆ†ç¦»å’Œæ•°æ®åº“å‚ç›´/æ°´å¹³æ‹†åˆ†çš„åº”ç”¨åœºæ™¯å’ŒæŠ€æœ¯åŸç†ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šè¿›ä¸€æ­¥å­¦ä¼š MySQL çš„é«˜å¯ç”¨å’Œé«˜æ€§èƒ½æ¶æ„ï¼›
	3. åˆ†æé—®é¢˜ï¼šæŒæ¡åº”å¯¹ç³»ç»Ÿä¸åŒç±»å‹æ•°æ®çš„å¤„ç†åŠæ³•ï¼Œå¯¹æ•°æ®è¿›è¡Œå†·çƒ­åˆ†ç¦»ï¼Œæå‡ç³»ç»Ÿæ•°æ®å¤„ç†èƒ½åŠ›ï¼›
	4. ç§¯ç´¯ç»éªŒï¼šå…¨é¢æŒæ¡å„ç±»åœºæ™¯ä¸‹çš„è¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“åˆ†è¡¨çš„æ¡†æ¶å’Œä¸­é—´ä»¶ï¼Œåœ¨å®é™…å·¥ä½œä¸­ç†Ÿç»ƒä½¿ç”¨ã€‚

	è¯¦ç»†å†…å®¹
	1. MySQL ä¸»ä»å¤åˆ¶ï¼ŒBinlogï¼ŒRow/Statement æ¨¡å¼ï¼Œä¸»ä»åˆ‡æ¢ï¼Œè¯»å†™åˆ†ç¦»ï¼Œæ•°æ®åº“æ‰©å®¹ï¼›
	2. æ•°æ®åº“å‚ç›´æ‹†åˆ†ä¸æ°´å¹³æ‹†åˆ†ï¼Œåˆ†åº“åˆ†è¡¨ï¼Œåˆ†å¸ƒå¼ä¸»é”®ï¼Œåˆ†è¡¨ç®—æ³•ï¼ŒSQL é™åˆ¶ï¼Œæ•°æ®è¿ç§»ï¼Œå®æ—¶åŒæ­¥ï¼›
	3. Spring åŠ¨æ€åˆ‡æ¢æ•°æ®åº“ï¼ŒTDDL/Sharding-JDBC æ¡†æ¶ï¼ŒMyCat/Sharding-Proxy ä¸­é—´ä»¶ï¼›
	4. æ•°æ®åº“æ‹†åˆ†çš„æœ€ä½³å®è·µï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æœ€ä½³å®è·µï¼Œå¤šç§Ÿæˆ·çš„æœ€ä½³å®è·µã€‚


æ¨¡å—ä¸ƒï¼šåˆ†å¸ƒå¼æœåŠ¡ - å¤æ‚ä¸šåŠ¡ç³»ç»Ÿæ¶æ„æ¼”è¿›å¿…ç”±ä¹‹è·¯

	æ•™å­¦ç›®æ ‡
	1. å…¨é¢æŒæ¡ RPC åŸç†å’Œå¸¸è§çš„ RPC æŠ€æœ¯ï¼›
	2. æ·±åˆ»ç†è§£æœåŠ¡æ²»ç†ç›¸å…³çš„æŠ€æœ¯å’Œåº”ç”¨åœºæ™¯ï¼›
	3. æ·±å…¥å­¦ä¹  Dubbo å’Œ Spring Cloud çš„åŠŸèƒ½å’ŒæŠ€æœ¯åŸç†ï¼›
	4. æ·±å…¥äº†è§£å¾®æœåŠ¡æ¶æ„çš„ç‰¹ç‚¹å’Œæœ€ä½³å®è·µã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. ä¼šç”¨ç®€å•çš„ RPC å’Œ RESTï¼Œä½†æ˜¯å¯¹å…¶åŸç†å’Œç»†èŠ‚ä¸å¤Ÿäº†è§£ï¼›
	2. ä¸€ç›´æ²¡æœ‰å®é™…æ¥è§¦è¿‡æœåŠ¡æ²»ç†ç›¸å…³çš„æŠ€æœ¯ï¼ŒåªçŸ¥é“å‡ ä¸ªåè¯ï¼Œä¸æ¸…æ¥šå…·ä½“çš„åŠŸèƒ½å’Œç”¨æ³•ï¼›
	3. å¯¹ Dubbo å’Œ Spring Cloud ä¸€çŸ¥åŠè§£ï¼Œç®€å•ä½œä¸º RPC è°ƒç”¨éƒ½ä¼šï¼Œå†å¤æ‚çš„å°±ä¸å¤ªæ¸…æ¥šäº†ï¼›
	4. å¾®æœåŠ¡ç›¸å…³çš„çŸ¥è¯†éƒ½æœ‰äº›äº†è§£ï¼Œä½†æ˜¯ä¸æ˜¯å¾ˆæ‡‚åˆ°åº•ä»€ä¹ˆæ—¶å€™è¯¥åšå¾®æœåŠ¡ï¼Œæ€ä¹ˆåšå¾®æœåŠ¡ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šç³»ç»Ÿçš„äº†è§£å’Œå­¦ä¹  RPC çŸ¥è¯†ï¼ŒçŸ¥é“æ¯ç§ RPC æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆ RPC æŠ€æœ¯ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šå…¨é¢çš„å­¦ä¹ ä¸€éæœåŠ¡æ²»ç†çš„æŠ€æœ¯ï¼Œèƒ½å¤Ÿè®¤è¯†åˆ°ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å“ªç§å…·ä½“çš„ç‰¹æ€§ï¼›
	3. åˆ†æé—®é¢˜ï¼šæ·±åˆ»ç†è§£ Dubbo å’Œ Spring Cloud æŠ€æœ¯ä½“ç³»åŸç†ï¼Œé‡åˆ°é—®é¢˜èƒ½å¤Ÿè¿…é€Ÿå®šä½å’Œè§£å†³ï¼›
	4. ç§¯ç´¯ç»éªŒï¼šæ·±å…¥äº†è§£å¾®æœåŠ¡æ¶æ„çš„ç‰¹ç‚¹å’Œæœ€ä½³å®è·µç»éªŒï¼Œå­¦ä¼šä½•æ—¶åšå¾®æœåŠ¡ï¼Œå¦‚ä½•åšå¾®æœåŠ¡ã€‚

	è¯¦ç»†å†…å®¹
	1. åŸºç¡€çŸ¥è¯†ï¼šRPCã€é€šä¿¡ä¸æ•°æ®åè®®ã€WebServiceã€Hessianã€RESTã€gRPCã€Protocol Buffers ç­‰ï¼›
	2. æœåŠ¡åŒ–ï¼šæœåŠ¡æ²»ç†ã€é…ç½®ç®¡ç†ã€æ³¨å†Œå‘ç°ã€æœåŠ¡åˆ†ç»„ã€ç‰ˆæœ¬ç®¡ç†ã€é›†ç¾¤ç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€é™æµä¸é™çº§ç†”æ–­ç­‰ï¼›
	3. æ¡†æ¶ï¼šApache Dubbo çš„åŠŸèƒ½ä¸åŸç†åˆ†æï¼ŒSpring Cloud ä½“ç³»ï¼Œå…·ä½“çš„æ¡ˆä¾‹å®è·µï¼›
	4. å¾®æœåŠ¡ï¼šå¾®æœåŠ¡æ¶æ„çš„ 6 ä¸ªæœ€ä½³å®è·µï¼Œä»å¾®æœåŠ¡åˆ°æœåŠ¡ç½‘æ ¼ã€äº‘åŸç”Ÿçš„ä»‹ç»ã€‚


æ¨¡å—å…«ï¼šåˆ†å¸ƒå¼ç¼“å­˜ - å¤æ‚ä¸šåŠ¡ç³»ç»Ÿè®¿é—®æé€Ÿç¬¬ä¸€æ³•å®

	æ•™å­¦ç›®æ ‡
	1. æ·±å…¥ç†è§£ç¼“å­˜çš„åº”ç”¨åœºæ™¯å’Œç¼“å­˜ç­–ç•¥ï¼›
	2. å…¨é¢æŒæ¡å‡ ç§å¸¸è§ç¼“å­˜é—®é¢˜çš„å¤„ç†æ–¹å¼ï¼›
	3. å½»åº•æŒæ¡ Redis ç¼“å­˜ä¸­é—´ä»¶ï¼Œäº†è§£ Hazelcast å†…å­˜ç½‘æ ¼ï¼›
	4. å­¦ä¼šä½¿ç”¨ç¼“å­˜æŠ€æœ¯å®ç°æ’è¡Œæ•°æ®å±•ç¤ºï¼Œåˆ†å¸ƒå¼ ID ç”Ÿæˆç­‰å…¸å‹åº”ç”¨åœºæ™¯ã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. å¯¹ç¼“å­˜çš„è®¤çŸ¥åœç•™åœ¨ JVM å†…çš„é™æ€ Map å’Œå¾€ Redis å­˜ KV æ•°æ®ï¼Œä¸äº†è§£ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ç¼“å­˜ï¼›
	2. ä¸ç†Ÿæ‚‰å¸¸è§çš„ç¼“å­˜é—®é¢˜å¤„ç†æ–¹æ¡ˆï¼Œé‡åˆ°é—®é¢˜éš¾ä»¥è§£å†³ï¼Œä¾‹å¦‚ç¼“å­˜å¤±æ•ˆå’Œé›ªå´©é—®é¢˜å¦‚ä½•è§£å†³ï¼›
	3. åªäº†è§£ç®€å•çš„ Redis æ“ä½œï¼Œé«˜çº§åŠŸèƒ½ï¼ˆä¾‹å¦‚é›†ç¾¤æˆ– Luaï¼‰æ²¡ç”¨è¿‡ï¼Œå…¶ä»–ç¼“å­˜æŠ€æœ¯ä¹Ÿæ²¡æ¥è§¦è¿‡ï¼›
	4. æ²¡æœ‰åœ¨å®é™…çš„åº”ç”¨åœºæ™¯é‡Œç”¨ Redis ä¹‹ç±»çš„ç¼“å­˜æŠ€æœ¯ï¼Œä¸çŸ¥é“å…·ä½“æœ‰å“ªäº›å…¸å‹çš„åº”ç”¨åœºæ™¯ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šæŒæ¡ç¼“å­˜çš„åº”ç”¨åœºæ™¯å’Œå¸¸è§çš„ç­–ç•¥ï¼Œç‰¹åˆ«æ˜¯ä¸æ•°æ®åº“çš„åŒæ­¥ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šæŒæ¡å¸¸è§çš„ç¼“å­˜é—®é¢˜çš„å¤„ç†ç­–ç•¥ï¼Œå°†ç¼“å­˜æŠ€æœ¯åº”ç”¨åˆ°å®é™…å·¥ä½œï¼›
	3. åˆ†æé—®é¢˜ï¼šå…¨é¢æŒæ¡ Redis ç¼“å­˜æŠ€æœ¯ï¼Œèƒ½å¤Ÿåˆ†æå’Œè§£å†³ç¼“å­˜é—®é¢˜ï¼›
	4. ç§¯ç´¯ç»éªŒï¼šæ·±å…¥å®è·µå’ŒæŒæ¡å‡ ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯ï¼Œäº†è§£ Hazelcast å†…å­˜ç½‘æ ¼æŠ€æœ¯ã€‚

	è¯¦ç»†å†…å®¹
	1. ç¼“å­˜çš„åº”ç”¨åœºæ™¯ï¼Œç¼“å­˜åŠ è½½ç­–ç•¥ä¸å¤±æ•ˆç­–ç•¥ï¼Œç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥ç­‰ï¼›
	2. ç¼“å­˜é¢„çƒ­ã€ç¼“å­˜å¤±æ•ˆã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ã€å¤šçº§ç¼“å­˜ã€ç¼“å­˜ä¸ Spring+ORM æ¡†æ¶é›†æˆï¼›
	3. ç¼“å­˜ä¸­é—´ä»¶ï¼ŒRedisï¼ˆå‡ ç§å¸¸ç”¨æ•°æ®ç»“æ„ã€åˆ†å¸ƒå¼é”ã€Lua æ”¯æŒã€é›†ç¾¤ï¼‰ï¼ŒHazelcastï¼ˆJava æ•°æ®ç»“æ„ã€å†…å­˜ç½‘æ ¼ã€äº‹åŠ¡æ”¯æŒã€é›†ç¾¤ï¼‰ï¼›
	4. ç¼“å­˜çš„åº”ç”¨åœºæ™¯ï¼Œæ’è¡Œæ•°æ®å±•ç¤ºï¼Œåˆ†å¸ƒå¼ ID ç”Ÿæˆï¼ŒSession å…±äº«ï¼Œçƒ­ç‚¹è´¦æˆ·æ“ä½œç­‰ã€‚


æ¨¡å—ä¹ï¼šåˆ†å¸ƒå¼æ¶ˆæ¯ - å¤æ‚ä¸šåŠ¡ç³»ç»Ÿå…³ç³»è§£è€¦ä¸äºŒæ³•é—¨

	æ•™å­¦ç›®æ ‡
	1. ä» 0 æŒæ¡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰çš„å…³é”®æŠ€æœ¯ï¼Œäº†è§£æ ¸å¿ƒçŸ¥è¯†ï¼›
	2. å…¨é¢äº†è§£å„ç±» MQ æŠ€æœ¯çš„åŸç†å’Œç‰¹æ€§ï¼Œæ´æ‚‰ç›¸å…³åŸç†ï¼›
	3. å…¨é¢åƒé€ Kafka çš„åŸºæœ¬åŠŸèƒ½ï¼Œé›†ç¾¤æ­å»ºï¼Œé«˜å¯ç”¨ç­‰ï¼Œä¸Šæ‰‹åå…«èˆ¬æ­¦è‰ºï¼›
	4. æ·±å…¥ç†è§£ MQ çš„ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ï¼Œé€šè¿‡äº¤æ˜“åœºæ™¯å®æˆ˜æ¼”ç»ƒï¼Œå¹¶åŠ¨æ‰‹åšä¸€ä¸ªç®€å•çš„ MQã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. å¾ˆå°‘ä½¿ç”¨ MQï¼Œå°±ç®—ç”¨è¿‡ä¹Ÿåªæ˜¯ç®€å•çš„æ”¶å‘æ¶ˆæ¯ï¼Œå¯¹ MQ çš„åŸç†å’Œç»†èŠ‚ä¸äº†è§£ï¼›
	2. ä¸ç†Ÿæ‚‰å¸¸è§çš„å‡ ä¸ªä¸»æµ MQï¼Œå…¶ä¸­çš„å¤šæ•°æŠ€æœ¯éƒ½æ²¡æœ‰æ¥è§¦è¿‡ï¼Œæˆ–è€…åªå¬è¿‡åè¯ï¼›
	3. ç¼ºä¹å®é™…åœºæ™¯çš„ç»ƒä¹ ï¼Œæ¯æ¬¡çœ‹çœ‹ä¹¦ä¸Šçš„çŸ¥è¯†å°±å¿˜ï¼Œç†è§£ä¸æ·±ï¼Œæ— æ³•åšåˆ°èä¼šè´¯é€šï¼›
	4. ä¸å¤ªäº†è§£ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ MQï¼ŒMQ èƒ½å¸®æˆ‘ä»¬è§£å†³å“ªäº›æ–¹é¢çš„é—®é¢˜ï¼Œå¸¦æ¥ä»€ä¹ˆæ ·çš„å¥½å¤„ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šæŒæ¡ MQ çš„åŸºç¡€çŸ¥è¯†å’Œå¸¸ç”¨å·¥å…·ï¼Œäº†è§£ä¸€èˆ¬åŸç†ï¼ŒçŸ¥é“ç”¨ MQ çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šæŒæ¡å„ç±» MQ æŠ€æœ¯çš„ä¸€èˆ¬åŸç†å’ŒåŠŸèƒ½ï¼ŒçŸ¥é“å¦‚ä½•æ ¹æ®å®é™…éœ€è¦é€‰æ‹©ä½¿ç”¨åˆé€‚çš„ MQï¼›
	3. åˆ†æé—®é¢˜ï¼šæŒæ¡ Kafka ç­‰ä¸»æµ MQ æŠ€æœ¯ï¼Œèƒ½å¯¹ä¸€èˆ¬çš„ MQ é—®é¢˜è¿›è¡Œåˆ†æå’Œè§£å†³ï¼›
	4. ç§¯ç´¯ç»éªŒï¼šäº†è§£ MQ å¦‚ä½•åº”ç”¨åˆ°ä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’Œ MQ å†…éƒ¨ç»†èŠ‚ï¼Œå½»åº•å­¦ä¼š JVM çŸ¥è¯†ã€‚

	è¯¦ç»†å†…å®¹
	1. æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬çŸ¥è¯†ï¼ŒBroker ä¸ Clientï¼Œæ¶ˆæ¯æ¨¡å¼ï¼ˆç‚¹å¯¹ç‚¹ã€å‘å¸ƒè®¢é˜…ï¼‰ï¼Œæ¶ˆæ¯åè®®ï¼ˆSTOMPã€JMSã€AMQPã€OpenMessaging ç­‰ï¼‰ï¼Œæ¶ˆæ¯ QoSï¼ˆæœ€å¤šä¸€æ¬¡ã€æœ€å°‘ä¸€æ¬¡ã€æœ‰ä¸”ä»…æœ‰ä¸€æ¬¡ï¼‰ï¼Œæ¶ˆæ¯é‡è¯•ï¼Œå»¶è¿ŸæŠ•é€’ï¼Œäº‹åŠ¡æ€§ï¼Œæ¶ˆæ¯å¹‚ç­‰ä¸å»é‡ï¼›
	2. æ¶ˆæ¯ä¸­é—´ä»¶ï¼šActiveMQ çš„ç®€å•å…¥é—¨ï¼ŒKafka çš„åŸºæœ¬åŠŸèƒ½ä¸ä½¿ç”¨ï¼Œé«˜å¯ç”¨ï¼ˆé›†ç¾¤ã€åˆ†åŒºã€å‰¯æœ¬ï¼‰ã€æ€§èƒ½ï¼ŒRabbitMQ å’Œ RocketMQï¼ŒPulsar çš„ç®€å•ä»‹ç»ï¼›
	3. æ¶ˆæ¯çš„ 4 ä¸ªä¸»è¦åŠŸèƒ½ï¼Œæ­å»ºä¸€ä¸ª Kafka é›†ç¾¤ï¼Œå®ç°å¸¸ç”¨çš„æ¶ˆæ¯å‘é€ã€æ¶ˆæ¯æ¶ˆè´¹åŠŸèƒ½ï¼›
	4. å…¸å‹ä½¿ç”¨åœºæ™¯ï¼Œä½¿ç”¨ MQ å®ç°äº¤æ˜“è®¢å•çš„å¤„ç†ï¼ŒåŠ¨æ‰‹å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚


æ¨¡å—åï¼šåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ - å¦‚ä½•è®¾è®¡é«˜å¹¶å‘é«˜å¯ç”¨çš„ Java ç³»ç»Ÿ

	æ•™å­¦ç›®æ ‡
	1. äº†è§£å¤§è§„æ¨¡åˆ†å¸ƒå¼çš„å¤æ‚ä¸šåŠ¡ç³»ç»Ÿæ¶æ„æŠ€æœ¯å‘å±•è„‰ç»œï¼›
	2. å…¨é¢æŒæ¡ä¸šåŠ¡ç³»ç»Ÿå‘å±•ä¸åŒé˜¶æ®µåº”è¯¥å¦‚ä½•åšæŠ€æœ¯é€‰å‹ï¼›
	3. ä»¥ä¸€ä¸ªç”µå•†ç³»ç»Ÿä¸ºä¾‹ï¼Œæ·±å…¥å­¦ä¹ å¦‚ä½•åˆ†æç³»ç»Ÿæ¶æ„ï¼›
	4. æŒæ¡é«˜å¹¶å‘é«˜å¯ç”¨çš„åˆ†å¸ƒå¼ Java ç³»ç»Ÿçš„è®¾è®¡æ–¹æ³•ã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. æ²¡æœ‰æœºä¼šå»ä»å¤´è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç¼ºä¹å¯¹æ­¤ç±»é—®é¢˜æ·±å…¥çš„å­¦ä¹ å’Œæ€è€ƒï¼›
	2. å¯¹ä¸šåŠ¡ç³»ç»Ÿæ¶æ„å‘å±•ä¸äº†è§£ï¼ŒæŠ€æœ¯æ€è·¯ä¸€ç›´åœç•™åœ¨ä¸€ä¸ªé™æ€è§‚å¿µï¼Œä¸€èˆ¬åªä¼šé€‰æ‹©è‡ªå·±ç†Ÿæ‚‰çš„æŠ€æœ¯ï¼›
	3. ç¼ºä¹å®é™…åœºæ™¯çš„ç»ƒä¹ ï¼Œæ¯æ¬¡çœ‹çœ‹ä¹¦ä¸Šçš„çŸ¥è¯†å°±å¿˜ï¼Œé¢å¯¹å¤æ‚ä¸šåŠ¡ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼Œæ€»è§‰å¾—æ— ä»ä¸‹æ‰‹ï¼›
	4. å¹³æ—¶ä»ç½‘ä¸Šæˆ–ä¹¦ä¸Šçœ‹åˆ°å„ç§é›¶æ•£çš„çŸ¥è¯†å’Œç»éªŒï¼Œæ— æ³•è½¬åŒ–æˆè‡ªå·±çš„çŸ¥è¯†å’Œèƒ½åŠ›ï¼Œæ€»æ˜¯æŒæ¡ä¸äº†ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šäº†è§£å¤§è§„æ¨¡åˆ†å¸ƒå¼çš„å¤æ‚ä¸šåŠ¡ç³»ç»Ÿæ¶æ„æŠ€æœ¯å‘å±•è„‰ç»œï¼Œä»æŠ€æœ¯å‘å±•é‡Œå€Ÿé‰´ç»éªŒï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šæŒæ¡ä¸šåŠ¡ç³»ç»Ÿå‘å±•ä¸åŒé˜¶æ®µåº”è¯¥å¦‚ä½•åšæŠ€æœ¯é€‰å‹ï¼Œä¸ºç³»ç»Ÿé€‰æ‹©åˆé€‚çš„æ¶æ„æ–¹æ¡ˆï¼›
	3. åˆ†æé—®é¢˜ï¼šæ·±å…¥ç†è§£å¦‚ä½•åŸºäºç³»ç»Ÿçš„åŠŸèƒ½æ€§å’ŒéåŠŸèƒ½æ€§éœ€æ±‚ï¼Œè¿›è¡Œè¯¦ç»†çš„ç³»ç»Ÿæ¶æ„åˆ†æï¼›
	4. ç§¯ç´¯ç»éªŒï¼šæŒæ¡é«˜å¹¶å‘é«˜å¯ç”¨çš„åˆ†å¸ƒå¼ Java ç³»ç»Ÿçš„è®¾è®¡æ–¹æ³•ï¼Œèƒ½å¤Ÿç‹¬ç«‹è®¾è®¡å¤æ‚ä¸šåŠ¡ç³»ç»Ÿã€‚

	è¯¦ç»†å†…å®¹
	1. ä¸šåŠ¡åˆ†æã€åŠŸèƒ½æ€§éœ€æ±‚ã€éåŠŸèƒ½æ€§éœ€æ±‚ã€é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€ç¨³å®šæ€§ã€æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€å®‰å…¨æ€§ç­‰ï¼›
	2. â€œ4+1â€ Viewsã€TOGAFã€æ¶æ„æ–¹æ¡ˆã€ä¸šåŠ¡æ¶æ„ã€æ•°æ®æ¶æ„ã€è®¾è®¡æ–‡æ¡£ã€æŠ€æœ¯é€‰å‹ã€éƒ¨ç½²æ–‡æ¡£ã€è¿ç»´æ–‡æ¡£ç­‰ï¼›
	3. åˆ†å¸ƒå¼æœåŠ¡åŒ–ã€åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ã€åˆ†å¸ƒå¼ç¼“å­˜ã€åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€ç›‘æ§å‘Šè­¦ç³»ç»Ÿã€æƒé™ä¸è®¤è¯ä¸­å¿ƒç­‰ã€‚


æ¨¡å—åä¸€ï¼šä¸šåŠ¡ç³»ç»Ÿé‡æ„ - é‡æ„é—ç•™ç³»ç»Ÿæ˜¯æ¶æ„å¸ˆçš„å¿…ä¿®æŠ€èƒ½

	æ•™å­¦ç›®æ ‡
	1. é€šè¿‡ä¸€ä¸ªå…·ä½“å¤æ‚ç”µå•†ä¸šåŠ¡ç³»ç»Ÿçš„é‡æ„ï¼ŒæŒæ¡é—ç•™ç³»ç»Ÿé‡æ„çš„æ–¹æ³•å’Œç»éªŒï¼›
	2. äº†è§£ä¸€çº¿å¤§å‚ç³»ç»Ÿæ¼”è¿›çš„å…·ä½“æ¡ˆä¾‹ï¼ŒæŒæ¡å¦‚ä½•è§£å†³è€ç³»ç»Ÿçš„å„ç§ç–‘éš¾æ‚ç—‡ï¼›
	3. å­¦ä¼šå¦‚ä½•è§£å†³å›°éš¾çš„é—®é¢˜ï¼Œåè°ƒèµ„æºï¼Œæ¨åŠ¨å›¢é˜Ÿï¼Œå®Œæˆçœ‹ä¼¼ä¸å¯èƒ½çš„ç›®æ ‡ã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯æ€»èƒ½æœ‰æœºä¼šä»å¤´å»åšä¸€ä¸ªå¤§ç³»ç»Ÿï¼Œç»´æŠ¤å’Œæ”¹é€ è€ç³»ç»Ÿï¼Œåè€Œæ˜¯æ›´å¸¸è§çš„ä»»åŠ¡ï¼›
	2. é—ç•™çš„è€ç³»ç»Ÿè´¨é‡å¾ˆå·®ï¼Œç»å¸¸å‡ºæ•…éšœï¼Œæ²¡æ–‡æ¡£ï¼Œä»£ç å¤æ‚ä¸”æ²¡äººæ¸…æ¥šç»†èŠ‚ï¼Œä¸çŸ¥å¦‚ä½•ä¸‹æ‰‹æ”¹é€ ï¼›
	3. æ”¹é€ è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°å¾ˆå¤šå…·ä½“çš„å¤æ‚æŠ€æœ¯éš¾é¢˜ï¼Œå¿ƒé‡Œæ²¡åº•ï¼Œå„é¡¹ä¼°è®¡ä¹Ÿä¸å‡†ç¡®ï¼›
	4. æ¶‰åŠåˆ°çš„å„æ–¹äººå‘˜éƒ½ä¸æ˜¯å¾ˆç†è§£ï¼Œä¹Ÿä¸æ€ä¹ˆé…åˆï¼Œé˜»åŠ›å¾ˆå¤§ï¼Œå·¥ä½œéš¾ä»¥æ¨åŠ¨ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. æ·±å…¥å­¦ä¹ ï¼šé€šè¿‡ä¸€ä¸ªå…·ä½“å¤æ‚ç”µå•†ä¸šåŠ¡ç³»ç»Ÿçš„é‡æ„ï¼Œå­¦ä¹ é—ç•™ç³»ç»Ÿé‡æ„çš„æ–¹æ³•å’Œç»éªŒï¼›
	2. åˆ†æé—®é¢˜ï¼šäº†è§£å¦‚ä½•è¯„ä¼°é—ç•™è€ç³»ç»Ÿï¼Œåšå‡ºå……åˆ†ã€è¯¦ç»†ã€å®¢è§‚çš„åˆ†ææŠ¥å‘Šï¼›
	3. ç§¯ç´¯ç»éªŒï¼šæŒæ¡ä¸šåŠ¡ç³»ç»Ÿé‡æ„æ”¹é€ ä¸­çš„ä¸€äº›é€šç”¨æ€§æŠ€æœ¯é—®é¢˜ï¼Œä»¥åŠæ¨åŠ¨å·¥ä½œçš„åŠæ³•ã€‚

	è¯¦ç»†å†…å®¹
	1. åˆ†æç³»ç»Ÿç°çŠ¶ï¼Œç»™å‡ºæ˜ç¡®çš„å„é¡¹æŒ‡æ ‡ï¼Œäº†è§£å„æ–¹å¯¹æŒ‡æ ‡çš„æœŸæœ›å’Œå·®è·ï¼›
	2. ç»™å‡ºå¤šä¸ªå¯é€‰çš„æ”¹é€ æˆ–é‡åšæ–¹æ¡ˆï¼Œæ˜ç¡®å„æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼Œæä¾›å†³ç­–ä¾æ®ï¼›
	3. æ–¹æ¡ˆä¸Šçš„é€‚å½“å¦¥åï¼Œå„æ–¹è¾¾æˆä¸€è‡´ï¼Œå¿«é€Ÿæ¨åŠ¨é‡æ„å·¥ä½œå¯åŠ¨å’Œå±•å¼€ï¼›
	4. ç»†åŒ–å…·ä½“çš„æ–¹æ¡ˆç»†èŠ‚ï¼Œå½¢æˆè·¯å¾„ï¼Œäº‰å–è¶³å¤Ÿçš„èµ„æºï¼Œæ°å½“çš„æ—¶é—´çª—å£ï¼›
	5. å°æ­¥å¿«è·‘ï¼Œè¿…é€Ÿå–å¾—é˜¶æ®µæ€§æˆæœï¼Œä¸å½±å“ä¸šåŠ¡æ•´ä½“çš„è§„åˆ’å’Œå‘å±•ï¼›
	6. ä¿æŒä¸šåŠ¡è¿ç»­æ€§ï¼Œå¤šåšç›‘æ§ã€å…¼å®¹å’Œç‰¹æ€§å¼€å…³ï¼Œç»™æ”¹é€ åŠ ä¸Šä¿é™©ä¸å’Œç¼“å†²åŒºï¼›
	7. åŠæ—¶è¯„ä¼°æ”¹è¿›è¿›å±•ï¼Œæ›´æ–°æ–¹æ¡ˆå’Œè·¯çº¿ã€èµ„æºå’Œæ—¶é—´ï¼Œæ¨åŠ¨æ”¹é€ é¡ºåˆ©è¿›è¡Œï¼›
	8. å¤ç›˜æ€»ç»“ç›¸å…³ç»éªŒï¼Œæå‡ºæ›´å¤šå»ºè®®å’Œæ”¹è¿›åŠæ³•ï¼Œå®ç°ç»éªŒåˆ†äº«ï¼Œæ–¹æ³•å¤ç”¨ã€‚


æ¨¡å—åäºŒï¼šæ¶æ„å¸ˆä¿®ç‚¼ä¹‹é“ - å¦‚ä½•å‡çº§æ‰“æ€ªç»ˆæˆä¸€çº¿æŠ€æœ¯ä¸“å®¶

	æ•™å­¦ç›®æ ‡
	1. äº†è§£æ¶æ„å¸ˆåº”è¯¥å…·å¤‡çš„ç¡¬æŠ€èƒ½å’Œè½¯å®åŠ›ï¼›
	2. å…¨é¢äº†è§£æ¶æ„å¸ˆå…¸å‹çš„æˆé•¿è·¯å¾„ï¼›
	3. æŒæ¡ä¸€äº›å®ç”¨çš„å­¦ä¹ æ–¹æ³•ï¼Œå€Ÿé‰´ä¸€äº›æˆé•¿ç»éªŒï¼›
	4. å­¦ä¹ å¦‚ä½•å‡†å¤‡ç›¸å…³çš„é¢è¯•å’Œæ±‚èŒã€‚

	å­¦ä¹ å’Œå·¥ä½œä¸­çš„ç—›ç‚¹
	1. æ€»æä¸æ¸…æ¥šæ€ä¹ˆæ ·æ‰èƒ½ç®—æ˜¯ä¸€ååˆæ ¼çš„æ¶æ„å¸ˆï¼Œæ€»è§‰å¾—æ˜¯æ¶æ„å¸ˆå¾ˆç„ä¹ï¼›
	2. æŠ€æœ¯èƒ½åŠ›æå‡å’Œè½¯å®åŠ›éƒ½é‡åˆ°ç“¶é¢ˆï¼Œæ²¡äººæŒ‡å¯¼ï¼Œæ‰¾ä¸åˆ°æˆé•¿çš„çªç ´å£ï¼›
	3. ä¸çŸ¥é“ä»€ä¹ˆå¥½çš„å­¦ä¹ æ–¹æ³•å’Œç»éªŒï¼Œæ€»æ˜¯èµ°å¼¯è·¯ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´ç²¾åŠ›ï¼›
	4. æ€»æ˜¯è§‰å¾—è‡ªå·±é¢è¯•å‡†å¤‡å¾—ä¸å¥½ï¼Œå‘æŒ¥å¾—ä¸å¥½ï¼Œä¸èƒ½å¤Ÿç»™é¢è¯•å®˜è¶³å¤Ÿå¥½çš„è¯„ä»·ã€‚

	é€šè¿‡å­¦ä¹ æŒæ¡çš„æ ¸å¿ƒèƒ½åŠ›
	1. å¤¯å®åŸºç¡€ï¼šå­¦ä¹ æ¶æ„å¸ˆåº”è¯¥å…·å¤‡çš„ç¡¬æŠ€èƒ½å’Œè½¯å®åŠ›ï¼Œæ‘¸æ¸…è‡ªå·±å“ªäº›æ–¹é¢å¯ä»¥è¿›ä¸€æ­¥æå‡ï¼›
	2. æ·±å…¥å­¦ä¹ ï¼šæ‰¾åˆ°è‡ªå·±æˆé•¿åˆ°ä¸‹ä¸€ä¸ªå±‚æ¬¡çš„çªç ´å£ï¼Œåˆ¶å®šç›¸å…³çš„è§„åˆ’è·¯å¾„ï¼Œå®ç°æˆé•¿ï¼›
	3. å€Ÿé‰´æ–¹æ³•ï¼šæŒæ¡ä¸€äº›å®ç”¨çš„å¥½æ–¹æ³•å’Œç»éªŒï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬å°‘èµ°å¼¯è·¯ï¼Œäº‹åŠåŠŸå€ï¼›
	4. ç§¯ç´¯ç»éªŒï¼šå¦‚ä½•æå‰å‡†å¤‡é¢è¯•ï¼Œæ€æ ·æ‰“ç£¨ç®€å†çªå‡ºäº®ç‚¹ï¼Œå¦‚ä½•åœ¨é¢è¯•è¿‡ç¨‹ä¸­è„±é¢–è€Œå‡ºã€‚

	è¯¦ç»†å†…å®¹
	1. åˆ†äº«æˆ‘ä¸ªäººçš„æˆé•¿ç¬¬ä¸€æ‰‹ç»éªŒï¼Œå‡çº§æ‰“æ€ªï¼Œæˆä¸ºæ¶æ„å¸ˆã€æŠ€æœ¯ä¸“å®¶ã€æŠ€æœ¯æ€»ç›‘ï¼›
	2. å…­ä¸ªç¡¬èƒ½åŠ›ï¼šæŠ€æœ¯èƒ½åŠ›ã€è®¾è®¡èƒ½åŠ›ã€æŠ½è±¡èƒ½åŠ›ã€ç®¡ç†èƒ½åŠ›ã€ç»“æ„åŒ–æ€è€ƒèƒ½åŠ›ã€ç³»ç»ŸåŒ–åˆ†æèƒ½åŠ›ï¼›
	3. ä¸ƒä¸ªè½¯å®åŠ›ï¼šå¤§å±€è§‚èƒ½åŠ›ã€æ²Ÿé€šåä½œèƒ½åŠ›ã€æŒç»­å­¦ä¹ èƒ½åŠ›ã€å…³æ³¨åŠ›ã€æ¢ç´¢åŠ›ã€å†³ç­–åŠ›ã€è‡ªæˆ‘é©±åŠ¨åŠ›ã€‚




# ğŸš© å¸¸é‡æ±  å˜é‡å †

å˜é‡æ¯”è¾ƒï¼š

- a b æ˜¯å¸¸é‡æˆå‘˜çš„å˜é‡ï¼Œå­—ç¬¦ä¸² xyz æ˜¯å­—é¢å¸¸é‡ï¼Œç¼–è¯‘æ—¶ä¼šå¼•ç”¨åˆ°åŒä¸€å—å†…å­˜åœ°å€ï¼Œç›´æ¥ç”¨ == æ¯”è¾ƒåœ°å€ç›¸ç­‰ã€‚
- a c è™½ç„¶å†…å®¹ç›¸åŒä½†æ˜¯åœ°å€ä¸åŒï¼Œ== æ¯”è¾ƒåœ°å€æ˜¯å¦ç›¸ç­‰ã€‚
- equals æ–¹æ³•æ¯”è¾ƒé¦–å…ˆä¼šæ›¾åˆ¤æ–­åœ°å€æ˜¯å¦ç›¸åŒï¼Œå†åˆ¤æ–­ç±»å‹æ˜¯å¦ç›¸åŒï¼Œæœ€ååˆ¤æ–­å†…å®¹æ˜¯å¦ç›¸åŒï¼Œå…¶ä¸€æˆç«‹åˆ™ä¸ºçœŸã€‚

String ç±»å‹æ¯”è¾ƒä¸åŒå¯¹è±¡å†…å®¹æ˜¯å¦ç›¸åŒï¼Œç”¨ equalsï¼Œå› ä¸º == ç”¨äºæ¯”è¾ƒå¼•ç”¨ç±»å‹å’Œæ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹æ—¶å…·æœ‰ä¸åŒçš„åŠŸèƒ½ã€‚

æ•°æ®ç±»å‹æ¢ Integer ä¹Ÿæˆç«‹ï¼Œè¿™é‡Œå¯¹è±¡ç±»å‹åŸºç±»å³ Object çš„åŸºæœ¬ç‰¹æ€§ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹é™¤å¤–ï¼Œå¦‚ char, int, long

	// package com.jeango.it.const_variables;

	public class coding {

		static public void main(String args[]){
			String a = "xyz";
			String b = "xyz";
			String c = new String("xyz");

			coding.log("       a==b? "+(a==b));
			coding.log("       a==c? "+(a==c));
			coding.log("a.equals(b)? "+a.equals(b));
		}
		static public void log(String t){
			System.out.print(t+"\n");
		}
		
	}

# ğŸš© å‚æ•°ä¼ é€’ ä¼ å€¼å’Œå¼•ç”¨

é‡ç”³ä¸€éï¼šJava ä¸­åªæœ‰ä¼ å€¼ã€‚ä¸C++ä¸åŒçš„ï¼ŒJavaé‡Œé¢æ²¡æœ‰æŒ‡é’ˆçš„æ¦‚å¿µï¼ŒJavaçš„è®¾è®¡è€…å·§å¦™çš„å¯¹æŒ‡é’ˆçš„æ“ä½œè¿›è¡Œäº†ç®¡ç†ï¼Œè¿™å°±æ˜¯å¼€å‘Javaè¯­è¨€çš„ç›®çš„ã€‚äº‹å®ä¸Šï¼Œåœ¨æ‡‚C++çš„Javaç¨‹åºå‘˜çœ¼ä¸­ï¼ŒJavaåˆ°å¤„éƒ½æ˜¯ç²¾ç¾ç»ä¼¦çš„æŒ‡é’ˆã€‚

	public class coding {

		static public void main(String args[]){
			String a = "xyz";
			String b = coding.prefix(a);
			coding.log("a = "+a);  // a = xyz
			coding.log("b = "+b);  // b = **xyz
			String[] c = {"abc","xyz"};
			String[] d = coding.prefixs(c);
			for (String s:c ) log("Item in c " + s); // Item in c abc ...
			for (String s:d ) log("Item in d " + s); // Item in d abc ...
		}
		static public String prefix(String t){
			t = "**"+t;
			return t;
		}
		static public String[] prefixs(String[] ss){
			for( String s:ss) s = "**"+s;
			return ss;
		}
		static public void log(String t){
			System.out.print(t+"\n");
		}
		
	}


# ğŸš© Thread å¤šçº¿ç¨‹

	new Thread(Runnable target).start()
	
start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œï¼Œè¿™æ—¶æ— éœ€ç­‰å¾…runæ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•è€Œç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚

run() æ–¹æ³•åªæ˜¯ç±»çš„ä¸€ä¸ªæ™®é€šæ–¹æ³•è€Œå·²ï¼Œç›´æ¥è°ƒç”¨ä¾ç„¶åªæœ‰ä¸»çº¿ç¨‹è¿™ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿˜æ˜¯è¦ç­‰å¾…runæ–¹æ³•ä½“æ‰§è¡Œå®Œæ¯•åæ‰å¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚

	public class coding {

		static public void main(String args[]){
			Thread t = new Thread(){
				public void run(){
					work();
				}
				public void start(){
					work();
				}
			};
			for (int i=0; i<10000; i++) {
				// t.run();
				t.start();
				log("done");
			}
		}
		static public void work(){
			log("I'm working...");
		}
		static public void log(String t){
			System.out.print(t+" ");
		}

	}



# ğŸš© factorial and int and BigDecimal

	public class coding {

		static public void main(String args[]){
			int[] ia = {1,2,3,4,5,6,7,8,9,10,20,30,31,32,33,34,35,100}; // BigDecimal needed!
			for (int i:ia ) {
				log( i + "!=" + factorial(i));
			}
		}
		static public int factorial(int i){
			if( i<=1 ) return 1;
			return i * factorial(i-1);
		}
		static public void log(String t){
			System.out.print(t+"\n");
		}

	}

# ğŸš© RegExp æ­£åˆ™è¡¨è¾¾å¼

java.util.regex.Matcher å’Œ java.util.regex.Patternï¼š

	Pattern p = Pattern.compile("cat");
	Matcher m = p.matcher("one cat two cats in the yard");
	StringBuffer sb = new StringBuffer();
	while (m.find()) {
	   m.appendReplacement(sb, "dog");
	}
	m.appendTail(sb);
	System.out.println(sb.toString());

Pattern å­—ç¬¦çš„åŒ¹é…ï¼š

	x å­—ç¬¦ x 
	\\ åæ–œçº¿å­—ç¬¦ 
	\0n å…«è¿›åˆ¶å€¼çš„å­—ç¬¦0n (0 <= n <= 7) 
	\0nn å…«è¿›åˆ¶å€¼çš„å­—ç¬¦ 0nn (0 <= n <= 7) 
	\0mnn å…«è¿›åˆ¶å€¼çš„å­—ç¬¦0mnn 0mnn (0 <= m <= 3, 0 <= n <= 7) 
	\xhh åå…­è¿›åˆ¶å€¼çš„å­—ç¬¦0xhh 
	\uhhhh åå…­è¿›åˆ¶å€¼çš„å­—ç¬¦0xhhhh 
	\t åˆ¶è¡¨ç¬¦('\u0009') 
	\n æ¢è¡Œç¬¦ ('\u000A') 
	\r å›è½¦ç¬¦ ('\u000D') 
	\f æ¢é¡µç¬¦ ('\u000C') 
	\a å“é“ƒç¬¦ ('\u0007') 
	\e è½¬ä¹‰ç¬¦ ('\u001B') 
	\cx Tå¯¹åº”äºxçš„æ§åˆ¶å­—ç¬¦ x 
	  
	å­—ç¬¦ç±» 
	[abc] a, b, or c (ç®€å•ç±») 
	[^abc] é™¤äº†aã€bæˆ–cä¹‹å¤–çš„ä»»æ„ å­—ç¬¦ï¼ˆæ±‚åï¼‰ 
	[a-zA-Z] aåˆ°zæˆ–Aåˆ°Z ï¼ŒåŒ…å«ï¼ˆèŒƒå›´) 
	[a-z-[bc]] aåˆ°zï¼Œé™¤äº†bå’Œc ï¼š [ad-z]ï¼ˆå‡å»ï¼‰ 
	[a-z-[m-p]] aåˆ°zï¼Œé™¤äº†måˆ° pï¼š [a-lq-z] 
	[a-z-[^def]] d, e, æˆ– f 
	å¤‡æ³¨ï¼š
	æ–¹æ‹¬å·çš„æ­£åˆ™è¡¨è¾¾å¼â€œt[aeio]nâ€åªåŒ¹é…â€œtanâ€ã€â€œTenâ€ã€â€œtinâ€å’Œâ€œtonâ€ï¼Œåªèƒ½åŒ¹é…å•ä¸ªå­—ç¬¦ã€‚
	åœ†æ‹¬å·ï¼Œå› ä¸ºæ–¹æ‹¬å·åªå…è®¸åŒ¹é…å•ä¸ªå­—ç¬¦ï¼›æ•…åŒ¹é…å¤šä¸ªå­—ç¬¦æ—¶ä½¿ç”¨åœ†æ‹¬å·â€œ()â€ã€‚æ¯”å¦‚ä½¿ç”¨â€œt(a|e|i|o|oo)nâ€æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±å¿…é¡»ç”¨åœ†æ‹¬å·ã€‚

	é¢„å®šä¹‰çš„å­—ç¬¦ç±» 
	. ä»»æ„å­—ç¬¦ï¼ˆä¹Ÿè®¸èƒ½ä¸è¡Œç»ˆæ­¢ç¬¦åŒ¹é…ï¼Œä¹Ÿè®¸ä¸èƒ½ï¼‰ å¤‡æ³¨ï¼šå¥ç‚¹ç¬¦å·ä»£è¡¨ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ï¼šè¡¨è¾¾å¼å°±æ˜¯â€œt.nâ€ï¼Œå®ƒåŒ¹é…â€œtanâ€ã€â€œtenâ€ã€â€œtinâ€å’Œâ€œtonâ€ï¼Œè¿˜åŒ¹é…â€œt#nâ€ã€â€œtpnâ€ç”šè‡³â€œt nâ€ã€‚
	\d æ•°å­—: [0-9] 
	\D éæ•°å­—: [^0-9] 
	\s ç©ºæ ¼ç¬¦: [ \t\n\x0B\f\r] 
	\S éç©ºæ ¼ç¬¦: [^\s] 
	\w å•è¯å­—ç¬¦: [a-zA-Z_0-9] 
	\W éå•è¯å­—ç¬¦: [^\w]

	è¡¨è¾¾æ¬¡æ•°çš„ç¬¦å·
	ç¬¦å· æ¬¡æ•°
	* 0æ¬¡æˆ–è€…å¤šæ¬¡
	+ 1æ¬¡æˆ–è€…å¤šæ¬¡
	? 0æ¬¡æˆ–è€…1æ¬¡
	{n} æ°å¥½næ¬¡
	{n,m} ä»næ¬¡åˆ°mæ¬¡

# ğŸš© æ„é€ è¿‡ç¨‹

æ„é€ è¿‡ç¨‹çˆ¶ç±»ä¼˜å…ˆäºå­ç±»ï¼Œçˆ¶ç±»æ„é€ å™¨æ‰§è¡Œå®Œåæ‰è¿›å…¥å­ç±»çš„æ„é€ ï¼Œcoding.key çš„åˆå§‹åœ¨çˆ¶ç±»æ„é€ å®Œæˆåè¿›è¡Œï¼Œåœ¨çˆ¶ç±»ä¸­ä½¿ç”¨coding.keyå°±æ˜¯æœªåˆå§‹åŒ–çš„å€¼ã€‚

	public class coding extends base {

		String key = "xyz";
		static public void main(String args[]){
			coding c = new coding();
		}
		public void go(){
			log("key = "+key);
		}
		static public void log(String t){
			System.out.print(t+"\n");
		}

	}

	class base {
		private String key = "abc";
		public base(){ // never add void to constructors 
			go();
		}

		public void go(){
			coding.log(key);
		}
	}


# ğŸš© åŠ¨æ€ä»£ç å— é™æ€ä»£ç å— æ„é€ å™¨æ‰§è¡Œé¡ºåº


	public class coding {

		public static coding a = new coding();
		public static coding z = new coding();
		{
			log("Dynamic Code Block ");
		}
		static {
			log("Static Code Block ");
		}
		public coding(){ log("Constructor"); }
		static public void main(String args[]){
			// new coding();
		}
		static public void log(String t){
			System.out.println(t);
		}

	}

æ‰§è¡Œè¾“å‡ºï¼Œé™æ€æˆå‘˜æŒ‰å®šä¹‰å‰åé¡ºåºè¿›è¡Œåˆå§‹åŒ–ï¼Œé¦–å…ˆæ˜¯ a åˆå§‹åŒ–ä¸€ä¸ªcodingï¼Œè¿™é‡Œè¾“å‡ºç¬¬ä¸€è¡Œå†…å®¹ï¼Œç„¶åæ˜¯ z åˆå§‹åŒ–è¾“å‡ºç¬¬äºŒè¡Œå†…å®¹ã€‚

	Dynamic Code Block 
	Constructor
	Dynamic Code Block 
	Constructor
	Static Code Block 


# ğŸš© Integer.MAX_VALUE

	static public void main(String args[]){
		int i = Integer.MAX_VALUE;
		long l = Integer.MAX_VALUE;
		l++;
		log(l+""); // 2147483648
		l = i+1;
		log(l+""); // -2147483648
	}
	static public void log(String t){
		System.out.println(t);
	}



# ğŸš© RSA éå¯¹ç§°åŠ å¯†è§£å¯†å·¥å…·ç±»
https://docs.oracle.com/javase/7/docs/api/java/security/KeyPairGenerator.html


# ğŸš© MD5 SHA256 ä¿¡æ¯æ‘˜è¦ç®—æ³•å·¥å…·ç±»
https://docs.oracle.com/javase/7/docs/api/java/security/MessageDigest.html

	import java.security.MessageDigest;
	
	public class coding {

		static public void main(String args[]) throws Exception {
			coding.log(bytesToHex(MD5("abc")));
		}
		// return 128bit/16Bytes fingerpoint data or fall
		public static byte[] MD5(String msg) throws Exception {
		    try {
		        MessageDigest md = MessageDigest.getInstance("MD5");
				// MessageDigest md = MessageDigest.getInstance("SHA-1");
				// MessageDigest md = MessageDigest.getInstance("SHA-256");
			    byte[] byteArray = msg.getBytes("UTF-8");
			    byte[] fingerprint = md.digest(byteArray);
			    return fingerprint;
		    } catch (Exception e) {
		        log(e.toString());
		        e.printStackTrace();
		        return new byte[0];
		    }
		}

		public static String bytesToHex(byte[] bytes){
		    StringBuffer hexValue = new StringBuffer();
		    for (int i = 0; i < bytes.length; i++) {
		        int val = ((int) bytes[i]) & 0xff;
		        if (val < 16) {
		            hexValue.append("0");
		        }
		        hexValue.append(Integer.toHexString(val));
		    }
		    return hexValue.toString();
		}

		static public void log(String t){
			System.out.print(t+"\n");
		}
		
	}



# ğŸš© Base64 

Base64 æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§èƒ½å°†äºŒè¿›ä½æ•°æ®ä»¥å¯è§†å­—ç¬¦ä¸²è¡¨è¾¾å‡ºçš„ç¼–ç æ–¹å¼ï¼Œä½¿ç”¨äº†64ä¸ªå¯è§å­—ç¬¦æ¥ç¼–ç ï¼Œæ¯ä¸ªå­—èŠ‚åªåˆ©ç”¨äº† 6bits ä¿¡æ¯ï¼Œå³ 2^6=64 ç§çŠ¶æ€å¯¹åº” 64 ä¸ªå¯è§å­—ç¬¦ã€‚äºŒè¿›åˆ¶è½¬åˆ°å­—ç¬¦ç§°ä¸ºç¼–ç ï¼Œç”±å­—ç¬¦è½¬æ¢åˆ°äºŒè¿›åˆ¶ç§°ä¸ºè§£ç ã€‚è½¬æ¢æ—¶ï¼Œ3 ä¸ªäºŒè¿›ä½å­—èŠ‚åˆ†æ‹†æˆå››ç»„6bitsçš„æ•°æ®ï¼ŒæŒ‰å–å€¼ç´¢å¼•æ‰¾åˆ°ç è¡¨å¯¹åº”çš„å­—ç¬¦å³å¯ï¼Œå½“æ•°æ®æœ€åä¸€ç»„ä¸è¶³ 3 å­—èŠ‚ï¼Œå°±ä½¿ç”¨ padding å¡«å……ï¼Œç¡®ä¿è½¬æ¢åçš„ Base64 ç¼–ç æ•°é‡æ˜¯4å­—èŠ‚çš„æ•´æ•°å€ã€‚Base64ä¸åªä¸€ç§ç¼–ç æ–¹æ¡ˆï¼ŒåŸºç¡€çš„æ–¹æ¡ˆä¸­ä½¿ç”¨äº†é™¤å·ï¼Œç¼–ç åçš„å†…å®¹ä¸èƒ½ç”¨äºæ–‡ä»¶åã€‚åœ¨URLä¸­ï¼Œ+/=ä¸‰ä¸ªç¬¦å·è¦å¯¹åº”è½¬æ¢æˆ %2B %2F %3Dï¼Œè¿™ä¼šå ç”¨æœ‰é•¿åº¦è¦æ±‚URLã€‚æ‰€ä»¥ï¼Œåæ¥æ¨å‡ºæœ‰å…¼å®¹URLä¸æ–‡ä»¶åçš„ç¼–ç æ–¹æ¡ˆ Base64urlï¼Œè¿™ä¸ªæ–¹æ¡ˆä¸­ä½¿ç”¨äº† - å’Œ _ æ›¿æ¢äº†åŸºç¡€æ–¹æ¡ˆä¸­ä½¿ç”¨çš„ + å·å’Œ / å·ï¼Œå¯¹äº = è¿™ä¸ªç¬¦å·çš„å¤„ç†ï¼Œæœ‰äº›å®ç°ä¼šçœç•¥ï¼Œæœ‰äº›åˆ™ä»¥åœ†ç‚¹æ›¿æ¢ã€‚

é™¤Base64å¤–ï¼Œè¿˜æœ‰Base16å³Hexåå…­è¿›ç¼–ç ä¹Ÿæ˜¯ä½¿ç”¨è¾ƒå¤šçš„ä¸€ç§ï¼Œè¿™ç§ç¼–ç åˆšå¥½ç”¨ä¸¤ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªäºŒä½å­—èŠ‚æ•°æ®ã€‚

Base64ç¼–ç  - https://en.wikipedia.org/wiki/Base64
base64url in RFC 4648 - https://tools.ietf.org/html/rfc4648
Base32 - RFC 4648 alphabet - https://en.wikipedia.org/wiki/Base32
MIMEç¼–ç  - https://en.wikipedia.org/wiki/MIME
Base16 Hexadecimal - https://en.wikipedia.org/wiki/Hexadecimal
(code point +:43 /:47 0:48 =:61 A:65 a:97)

Java çš„Base64å·¥å…·ç±»æä¾›äº†ä¸€å¥—é™æ€æ–¹æ³•è·å–ä¸‹é¢ä¸‰ç§BASE64ç¼–è§£ç å™¨ï¼š

	static Base64.Decoder getDecoder() è§£ç ä½¿ç”¨åŸºæœ¬å‹ base64 ç¼–ç æ–¹æ¡ˆã€‚
	static Base64.Encoder getEncoder() ç¼–ç ä½¿ç”¨åŸºæœ¬å‹ base64 ç¼–ç æ–¹æ¡ˆã€‚
	static Base64.Decoder getMimeDecoder() è§£ç ä½¿ç”¨ MIME å‹ base64 ç¼–ç æ–¹æ¡ˆã€‚	
	static Base64.Encoder getMimeEncoder() ç¼–ç ä½¿ç”¨ MIME å‹ base64 ç¼–ç æ–¹æ¡ˆã€‚
	static Base64.Encoder getMimeEncoder(int lineLength, byte[] lineSeparator) å¯ä»¥æŒ‡å®šæ¯è¡Œçš„é•¿åº¦åŠè¡Œçš„åˆ†éš”ç¬¦ã€‚
	static Base64.Decoder getUrlDecoder() è§£ç ä½¿ç”¨ URL å’Œæ–‡ä»¶åå®‰å…¨å‹ base64 ç¼–ç æ–¹æ¡ˆã€‚
	static Base64.Encoder getUrlEncoder() ç¼–ç ä½¿ç”¨ URL å’Œæ–‡ä»¶åå®‰å…¨å‹ base64 ç¼–ç æ–¹æ¡ˆã€‚

åŸºæœ¬ï¼šè¾“å‡ºè¢«æ˜ å°„åˆ°ä¸€ç»„å­—ç¬¦A-Za-z0-9+/ï¼Œç¼–ç ä¸æ·»åŠ ä»»ä½•è¡Œæ ‡ï¼Œè¾“å‡ºçš„è§£ç ä»…æ”¯æŒA-Za-z0-9+/ã€‚
URLï¼šè¾“å‡ºæ˜ å°„åˆ°ä¸€ç»„å­—ç¬¦A-Za-z0-9+_
MIME: è¾“å‡ºéšå°„åˆ°MIMEå‹å¥½æ ¼å¼ã€‚è¾“å‡ºæ¯è¡Œä¸è¶…è¿‡76å­—ç¬¦ï¼Œå¹¶ä¸”ä½¿ç”¨ \r\n ä½œä¸ºåˆ†å‰²ã€‚ç¼–ç è¾“å‡ºæœ€åæ²¡æœ‰è¡Œåˆ†å‰²ã€‚


## âš¡ Base64çš„Javaè¯­è¨€å®ç°
http://www.herongyang.com/Encoding/Base64-Sun-Java-Implementation.html
http://www.runoob.com/java/java8-base64.html
Base64ç¼–ç ä¸Javaç‰ˆæœ¬å®ç° - https://www.jianshu.com/p/79ecc613ed21

ç¬¬ä¸‰æ–¹å®ç°Base64çš„APIæœ‰ Apache Commons Codec library çš„org.apache.commons.codec.binary.Base64ï¼Œè¿˜æœ‰ Google Guava åº“é‡Œçš„ com.google.common.io.BaseEncoding.base64() è¿™ä¸ªé™æ€æ–¹æ³•ã€‚æœ€åä¸€ä¸ªï¼Œå·ç§°Base64ç¼–ç é€Ÿåº¦æœ€å¿«çš„ MigBase64 è€Œä¸”æ˜¯10å¹´å‰çš„å®ç°ã€‚

è¿™é‡Œè´´çš„æ˜¯åšæœçš„å®ç°ï¼Œå¥½ä¹…ä¸å†™Javaï¼Œæ‰¾ä¸ªç»ƒä¹ é¢˜åšåšä»¥å…è’åºŸäº†ï¼š

	import java.util.Base64;
	import java.nio.charset.Charset;

	public class coding {

		static public void main(String args[]) throws Exception {
			String a = new String("Base64çš„Javaè¯­è¨€å®ç°");
			// for( int i=0; i<a.length(); i++){
			// 	int c = a.charAt(i);
			// 	log( "Char Code "+c+ " 0x"+Integer.toHexString(c) + " 0b"+Integer.toBinaryString(c) ); 
			// }
			// byte[] as = a.getBytes();
			// for( int i=0; i<as.length; i++){
			// 	int c = as[i] & 0xFF;
			// 	log( "Byte Code "+c+ " 0x"+Integer.toHexString(c) + " 0b"+Integer.toBinaryString(c) ); 
			// }
			String cp = Charset.defaultCharset().name();
			log("Default CodePage "+cp);

			String b = Base64.getEncoder().encodeToString(a.getBytes());
			String c = new String( Base64.getDecoder().decode(b) );
			String d = Basee64encode(a.getBytes());
			String e = new String(Basee64decode(d));

			log("encode => "+a+" => "+b+" == "+d+"? "+(b.equals(d)?"PASS":"FAIL"));
			log("decode => "+c+" == "+e+"? "+(c.equals(e)?"PASS":"FAIL"));
		}

		static public String Basee64encode(byte[] bin){
			int i = bin.length%3;
			int g = bin.length - i;
			StringBuffer s = new StringBuffer();
			String fix = new String();
			if( i==1 ){
				int b = (0x3f & (bin[g]<<4));
				fix += map64(0x3F & bin[g]>>2)+""+map64(b)+"==";
			}else if( i==2 ){
				int b = (0x03 & bin[g])<<4 | (0xf0 & bin[g+1])>>4;
				int c = (0x0f & bin[g+1])<<2; // !!! æœ€åå››bitsç§»åˆ°æœ€é«˜ä½
				fix += map64(0x3f & bin[g]>>2) +""+ map64(b) +""+ map64(c)+'=';
			}
			for (i=0; i<g; i+=3 ) { 
				int a = (0xff & bin[i]  )>>2; // bigger first
				int b = (0x03 & bin[i]  )<<4 | (0xF0 & bin[i+1])>>4;
				int c = (0x0f & bin[i+1])<<2 | (0xC0 & bin[i+2])>>6;
				int d = (0x3f & bin[i+2]);
				s.append(map64(a));
				s.append(map64(b));
				s.append(map64(c));
				s.append(map64(d));
				// log( ((short)(bin[i]) & 0xFF)+" "+(bin[i+1] & 0xFF)+" "+ (bin[+2] & 0xff)+" => "+(a)+" "+(b)+" "+(c)+" "+(d));
			}
			return s.toString()+fix;
		}

		static public byte[] Basee64decode(String msg){
			byte[] bytes = msg.getBytes();
			byte[] res = new byte[bytes.length*3/4];
			for(int i=0; i<bytes.length; i+=4){
				byte a = unmap64(bytes[i]);
				byte b = unmap64(bytes[i+1]);
				byte c = unmap64(bytes[i+2]);
				byte d = unmap64(bytes[i+3]);
				res[i*3/4+0] = (byte)(a<<2 | b>>4);
				res[i*3/4+1] = (byte)(b<<4 | c>>2);
				res[i*3/4+2] = (byte)(c<<6 | d);
				// log("+ "+(short)(res[i*3/4+0] & 0xFF) +" "+ (short)(0xFF&res[i*3/4+1]) +" "+ (short)(0xFF&res[i*3/4+2]) );
			}
			int l = bytes.length;
			int pad = bytes[l-2]=='='? 2:bytes[l-1]=='='? 1:0;
			if( pad>0 ){
				byte[] ret = new byte[res.length-pad];
				System.arraycopy(res, 0, ret, 0, res.length-pad);
				return ret;
			}
			return res;
		}
		static public char map64(int i){
			// +:43 /:47 0:48 =:61 A:65 a:97
			if( i>63 ) return '=';
			byte code = (byte)(i==62?'+':i==63?'/':i<26?'A'+i:i<52?'a'+i-26:'0'+i-52);
			return (char)code;
		}
		static public byte unmap64(byte i){
			// +:43 /:47 0:48 =:61 A:65 a:97
			if( i=='=' ) return 0;
			byte index = (byte)(i=='+'?62:i=='/'?63:i<'A'?i-'0'+52:i<'a'?i-'A':i-'a'+26);
			return (byte)index;
		}

		static public void log(String t){
			System.out.print(t+"\n");
		}
		
	}

## âš¡ å­—ç¬¦ä¸²è½¬å­—èŠ‚å¤„ç†

String.getBytes()æ–¹æ³•å¯ä»¥å°†å­—ä¸²çš„å­—èŠ‚æ•°ç»„å¯¼å‡ºï¼Œä½†ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ–¹æ³•å°†è¿”å›è¯¥æ“ä½œç³»ç»Ÿé»˜è®¤çš„ç¼–ç æ ¼å¼çš„å­—èŠ‚æ•°ç»„ã€‚åœ¨ä¸åŒå¹³å°ä¸Šï¼Œç³»ç»Ÿé»˜è®¤çš„ä»£ç é¡µå¯èƒ½ä¸ä¸€è‡´ï¼Œè‹±æ–‡ç³»ç»Ÿä¸€èˆ¬ä½¿ç”¨ iso-8859-1ï¼Œä¸­æ–‡ç³»ç»Ÿæœ‰ GBKï¼Œä¸è€ƒè™‘åˆ°è¿™ä¸€ç‚¹è½¯ä»¶å°±ä¼šæœ‰é—®é¢˜ã€‚ä¾‹å¦‚å¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼Œé€šè¿‡æŒ‡å®š UTF-16/UTF-8 æ¥è·å–åˆ°å­—ä¸²çš„å­—èŠ‚æ•°æ®ã€‚æ³¨æ„ UTF-16 è¾“å‡ºå¤šäº†ä¸¤ä¸ªå­—èŠ‚ 0xFE 0xFFï¼Œè¿™æ˜¯BOMä¿¡æ¯ï¼Œå­—èŠ‚é¡ºåºæ ‡è®° Byte Order Markï¼Œå®ƒæœ‰ä¸¤ä¸ªå­—èŠ‚ï¼Œå€¼å¤§çš„åœ¨åè¡¨ç¤º BigEnding å¤§å°¾ç¼–ç æ–¹å¼ï¼Œé€šè¿‡ UTF-16BE/UTF-16LE æŒ‡å®šå¤§ç«¯å°ç«¯æ¥å»é™¤è¿™ä¸¤é¢å¤–çš„BOMå­—èŠ‚ã€‚å…³äºå¤§å°¾å°å°¾ï¼Œå‰è€…è¡¨é«˜æœ‰æ•ˆä½å…ˆç¼–ç ï¼Œåè€…è¡¨ç¤ºä½æœ‰æ•ˆä½å…ˆç¼–ç ï¼Œå³å¯¹ä¸€ä¸ªä¸¤å­—èŠ‚çš„æ±‰å­—æ¥è¯´ï¼Œå¤§å°¾è¡¨ç¤ºé«˜ä½çš„é‚£ä¸ªå­—èŠ‚å…ˆç¼–ç è¾“å‡ºã€‚

	String a = new String("çš„J");

	byte[] as = a.getBytes("UTF-16");
	for( int i=0; i<as.length; i++){
		int c = as[i] & 0xFF;
		log( "Byte Code "+c+ " 0x"+Integer.toHexString(c) + " 0b"+Integer.toBinaryString(c) ); 
	}

	// UTF-16 çš„ å­—ä½¿ç”¨4ä¸ªå­—èŠ‚ç¼–ç ï¼Œè‹±æ–‡å­—æ¯2ä¸ªå­—èŠ‚
	Byte Code 254 0xfe 0b11111110
	Byte Code 255 0xff 0b11111111
	Byte Code 118 0x76 0b1110110
	Byte Code 132 0x84 0b10000100
	Byte Code 0 0x0 0b0
	Byte Code 74 0x4a 0b1001010

	// UTF-8 çš„ å­—ä½¿ç”¨3ä¸ªå­—èŠ‚ç¼–ç ï¼Œè‹±æ–‡å­—æ¯1ä¸ªå­—èŠ‚
	Byte Code 231 0xe7 0b11100111
	Byte Code 154 0x9a 0b10011010
	Byte Code 132 0x84 0b10000100
	Byte Code 74 0x4a 0b1001010

ä¸åŒç¼–ç çš„å­—èŠ‚é¡ºåºæ ‡è®°çš„è¡¨ç¤ºç¼–è¾‘

	ç¼–ç           è¡¨ç¤º (åå…­è¿›åˆ¶)  è¡¨ç¤º (åè¿›åˆ¶)
	UTF-8         EF BB BF       239 187 191
	UTF-16 å¤§ç«¯åº  FE FF          254 255
	UTF-16 å°ç«¯åº  FF FE          255 254
	UTF-32 å¤§ç«¯åº  00 00 FE FF    0 0 254 255
	UTF-32 å°ç«¯åº  FF FE 00 00    255 254 0 0


## âš¡ å¤ä¹ Javaè¿ç®—ç¬¦ä¼˜å…ˆçº§

	ä¼˜å…ˆçº§     æè¿°          è¿ç®—ç¬¦
	1         æ‹¬å·          ()  []
	2         æ­£è´Ÿå·         +  -
	3         è‡ªå¢è‡ªå‡é     ++    --  !
	4         ä¹˜é™¤å–ä½™       *   /   %
	5         åŠ å‡          +   -
	6         ç§»ä½è¿ç®—       <   >>   >>>
	7         å¤§å°å…³ç³»       >   >=   <  <=
	8         ç›¸ç­‰å…³ç³»       =   !=
	9         æŒ‰ä½ä¸         &
	10        æŒ‰ä½å¼‚æˆ–       ^
	11        æŒ‰ä½æˆ–         |
	12        é€»è¾‘ä¸         &&
	13        é€»è¾‘æˆ–         ||
	14        æ¡ä»¶è¿ç®—       ?:
	15        èµ‹å€¼è¿ç®—        =  +=  -=  *=  /=  %=
	16        ä½èµ‹å€¼è¿ç®—      =  |=  <<=  >>=  >>>=


## âš¡ å¤ä¹ JavaåŸºç¡€æ•°æ®ç±»å‹

	Primitive type  Size      Minimum    Maximum   ã€€ã€€ã€€ã€€Wrapper type
	boolean         â€”         â€”          â€”       ã€€ã€€ã€€ã€€ã€€Boolean
	char            16 bits   Unicode 0  Unicode 2^16-1   Character
	byte             8 bits  -128       +127              Byte
	short           16 bits  -2^15      +2^15-1           Short
	int             32 bits  -2^31      +2^31-1           Integer
	long            64 bits  -2^63      +2^63-1           Long
	float           32 bits   IEEE754    IEEE754          Float
	double          64 bits   IEEE754    IEEE754          Double
	void            â€”         â€”          â€”                Void

èŒƒå›´å¤§çš„å‘èŒƒå›´å°çš„æ•°æ®ç±»å‹è½¬æ¢æ—¶ï¼Œéœ€è¦è€ƒè™‘ç¬¦å·ä½çš„å½±å“ã€‚å¦‚æ— ç¬¦å·æ•´æ•°å°±ä¸èƒ½ç›´æ¥è½¬ä¸ºbyteï¼Œå€¼>127çš„æ­£æ•°éƒ½ä¸è¡Œï¼Œè§†ä¸ºè´Ÿæ•°ã€‚Javaæ‰€æœ‰æ•°å€¼éƒ½æ˜¯å¸¦ç¬¦å·çš„ï¼Œæ²¡æœ‰æ— ç¬¦å·æ•°å€¼ã€‚åè¿‡æ¥ï¼Œå¤„ç†byteæ•°æ®æ—¶ï¼Œå¦‚ä½•æ— ç¬¦å·åŒ–å¤„ç†ï¼ŸæŒ‰è¡¥ç çš„è§„å¾‹ï¼Œbyteæ•°æ®å¦‚æœä¸ºè´Ÿæ•°ï¼Œå¯ä»¥+256æ¥å®ç°ï¼Œæ­£æ•°ä¸ç”¨å¤„ç†ï¼Œä¹Ÿå¯ä»¥å’Œ 0xFF è¿›è¡Œä½ä¸è¿ç®—ï¼Œè¿™ä¸ªä½è¿ç®—æ“ä½œå¯ä»¥å»æ‰è½¬æ¢åçš„æ•°å€¼çš„ç¬¦å·ä½ã€‚ä¾‹å¦‚ï¼Œä¸‹ä¾‹ä¸­byteçš„-1è½¬æ¢åˆ°intæ—¶ï¼Œé€šè¿‡ä¸è¿ç®—å°†intçš„ç¬¦å·ä½æ¸…é›¶ï¼Œè¿™æ ·å®ç°byteæ•°æ®çš„æ— ç¬¦å·åŒ–ã€‚

	byte myByte =(byte)0xff;
	int myInt = myByte & 0xFF;
	sytem.out.println( ""+(by & 0xff));
	sytem.out.println( ""+(by + 256) );

å–å¾—æŸæ­£æ•°çš„è´Ÿæ•°è¡¥ç è¡¨è¾¾è§„åˆ™æ˜¯ï¼ŒæŒ‰ä½å–ååŠ 1ã€‚1çš„è´Ÿæ•°æ˜¯-1ï¼Œè¡¥ç å°±æ˜¯å¯¹æ­£1çš„åè¿›ä½ 00000001 å–åå¾—åˆ° 11111110ï¼ŒåŠ 1å°±å¾—åˆ° 11111111ï¼Œç”¨16è¿›ä½è¡¨ç¤ºå°±æ˜¯ 0xFFã€‚

	1çš„äºŒè¿›ä½è¡¨ç¤º 00000001           128çš„äºŒè¿›ä½è¡¨ç¤º 10000000
	1çš„äºŒè¿›ä½å–å 11111110           128çš„äºŒè¿›ä½å–å 01111111
	äºŒè¿›ä½å–ååŠ ä¸€ 11111111          äºŒè¿›ä½å–åååŠ ä¸€ 10000000
	å³å¾—åˆ°1çš„å¯¹åº”è´Ÿæ•°è¡¥ç  0xFF        128çš„å¯¹åº”è´Ÿæ•°-128çš„è¡¥ç ä¸º 0x80ï¼Œæ³¨æ„å’Œ128ä¸€æ ·

è®¡ç®—æœºåœ¨è¯»å–æ•°æ®è¿›è¡Œè¿ç®—æ—¶ï¼Œä¼šæ ¹æ®æœ€é«˜ä½å³ç¬¦å·ä½æ¥åº”ç”¨åŠ å‡æ³•åˆ™è¿›è¡Œè®¡ç®—ã€‚ç°åœ¨æ ¹æ®è¡¥ç å€¼ 0x81 åè§£å‡ºè¿™ä¸ªåŸå€¼ï¼Œå­—é¢ä¸Šå¦‚æœæ— ç§°å·å¤„ç†0x81å°±æ˜¯129ï¼ŒæŒ‰å‡1æ±‚åå¾—å‡ºè´Ÿæ•°å¯¹åº”çš„æ­£å€¼ï¼Œå³127ï¼Œæ‰€ä»¥0x81è¿™ä¸ªè¡¥ç å¯¹åº”çš„è´Ÿæ•°å°±æ˜¯-127ã€‚

	byte by = (byte)129;
	System.out.println(""+(by));
	System.out.println(""+(by&0xff));
	System.out.println(""+(by+256));

## âš¡ Binary

	public static String byteToBinary(byte src) {  
	    StringBuilder result = new StringBuilder();  
	    for (int i = 0; i < 8; i++) {  
	        result.append(src%2 == 0 ? '0' : '1');  
	        src = (byte)(src >>> 1);  
	    }  
	    return result.reverse().toString();  
	}

## âš¡ Base16ç è¡¨

	Index  0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 
	Encode 0 1 2 3 4 5 6 7 8 9  A  B  C  D  E  F

## âš¡ Base64ç è¡¨

	Index  Char  Index  Char  Index  Char  Index Char
	0      A     16     Q     32     g     48     w
	1      B     17     R     33     h     49     x
	2      C     18     S     34     i     50     y
	3      D     19     T     35     j     51     z
	4      E     20     U     36     k     52     0
	5      F     21     V     37     l     53     1
	6      G     22     W     38     m     54     2
	7      H     23     X     39     n     55     3
	8      I     24     Y     40     o     56     4
	9      J     25     Z     41     p     57     5
	10     K     26     a     42     q     58     6
	11     L     27     b     43     r     59     7
	12     M     28     c     44     s     60     8
	13     N     29     d     45     t     61     9
	14     O     30     e     46     u     62     +
	15     P     31     f     47     v     63     /
	padding = 

## âš¡ URL and Filename safe Base 64 Alphabet

     Value Encoding  Value Encoding  Value Encoding  Value Encoding
         0 A            17 R            34 i            51 z
         1 B            18 S            35 j            52 0
         2 C            19 T            36 k            53 1
         3 D            20 U            37 l            54 2
         4 E            21 V            38 m            55 3
         5 F            22 W            39 n            56 4
         6 G            23 X            40 o            57 5
         7 H            24 Y            41 p            58 6
         8 I            25 Z            42 q            59 7
         9 J            26 a            43 r            60 8
        10 K            27 b            44 s            61 9
        11 L            28 c            45 t            62 - (minus)
        12 M            29 d            46 u            63 _ (underline)
        13 N            30 e            47 v        
        14 O            31 f            48 w
        15 P            32 g            49 x
        16 Q            33 h            50 y         (pad) .

Multipurpose Internet Mail Extensions (MIME)æ˜¯Base64çš„å¦ä¸€ç§ç¼–ç æ–¹æ¡ˆï¼Œå¹¿æ³›åº”ç”¨äºæ–‡ä»¶çš„ç¼–ç ï¼ŒMIME æ¶ˆæ¯èƒ½åŒ…å«æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºä¸“ç”¨çš„æ•°æ®ï¼Œå¦‚IEä¿å­˜ç½‘é¡µå•æ–‡ä»¶MHTæ–¹å¼å°±æ˜¯ä½¿ç”¨çš„MIMEï¼ŒMultipart message ç¼–ç ä¿¡æ¯å‚è€ƒï¼š

	MIME-Version: 1.0
	Content-Type: multipart/mixed; boundary=frontier

	This is a message with multiple parts in MIME format.
	--frontier
	Content-Type: text/plain

	This is the body of the message.
	--frontier
	Content-Type: application/octet-stream
	Content-Transfer-Encoding: base64

	PGh0bWw+CiAgPGhlYWQ+CiAgPC9oZWFkPgogIDxib2R5PgogICAgPHA+VGhpcyBpcyB0aGUg
	Ym9keSBvZiB0aGUgbWVzc2FnZS48L3A+CiAgPC9ib2R5Pgo8L2h0bWw+Cg==
	--frontier--


## âš¡ Base32ç è¡¨ - RFC 4648 alphabet

	Value   Symbol   Value   Symbol   Value   Symbol   Value   Symbol
	0       A        8       I       16       Q       24       Y
	1       B        9       J       17       R       25       Z
	2       C       10       K       18       S       26       2
	3       D       11       L       19       T       27       3
	4       E       12       M       20       U       28       4
	5       F       13       N       21       V       29       5
	6       G       14       O       22       W       30       6
	7       H       15       P       23       X       31       7
	padding =

# ğŸš© JSON æ•°æ®è½¬æ¢

 
https://www.runoob.com/w3cnote/java-json-instro.html

Javaä¸­å¹¶æ²¡æœ‰å†…ç½®JSONçš„è§£æï¼Œå› æ­¤ä½¿ç”¨JSONéœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹ç±»åº“ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸ç”¨çš„ JSON è§£æç±»åº“ï¼š

Gson: è°·æ­Œå¼€å‘çš„ JSON åº“ï¼ŒåŠŸèƒ½ååˆ†å…¨é¢ã€‚https://github.com/google/gson
FastJson: é˜¿é‡Œå·´å·´å¼€å‘çš„ JSON åº“ï¼Œæ€§èƒ½ååˆ†ä¼˜ç§€ã€‚https://github.com/alibaba/fastjson/
Jackson: ç¤¾åŒºååˆ†æ´»è·ƒä¸”æ›´æ–°é€Ÿåº¦å¾ˆå¿«ã€‚https://github.com/FasterXML/jackson



# ğŸš© Java Lock å¹¶å‘åŒæ­¥é”å®š
- https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.monitorenter
- https://tech.meituan.com/2018/11/15/java-lock.html
- Doug Leaâ€™s Home Page http://gee.cs.oswego.edu/
- ä»»åŠ¡å–æ¶ˆ(Cancellation) http://ifeve.com/cancellation/
- å½»åº•ç†è§£ Synchronized https://www.jianshu.com/p/d53bf830fa09
- synchronized è¯¦è§£ https://juejin.im/post/6844903482114195463
- å…³äº synchronized å’Œ ReentrantLock ä¹‹å¤šçº¿ç¨‹åŒæ­¥è¯¦è§£ - https://www.jianshu.com/p/96c89e6e7e90
- Java Fork/Join æ¡†æ¶ http://ifeve.com/java-fork-join-framework/
- æ·±å…¥ç†è§£Javaå¹¶å‘ä¹‹synchronizedå®ç°åŸç† - https://blog.csdn.net/javazejian/article/details/72828483
- Java Concurrent Animated çœ‹åŠ¨ç”»å­¦å¹¶å‘ http://ifeve.com/java-concurrent-animated/
- JUC Abstract Queued Synchronizer è¯¦ç»†åˆ†æ https://www.jianshu.com/p/0da2939391cf
- [å‡ ç§è‡ªæ—‹é”çš„javaå®ç°](https://www.jianshu.com/p/824b2e4f1eed)

å¤šçº¿ç¨‹ä»£ç ä¸­åŠ é”ï¼Œæ ¹æœ¬ä¸Šå°±æ˜¯å°†å¤šçº¿å’Œæ‰§è¡Œå˜æˆå•çº¿æ‰§è¡Œï¼Œä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼Œæ‰€ä»¥åŠ é”å°±ä¼šæŸå¤±æ‰å¤šçº¿ç¨‹å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚

ä½¿ç”¨é”è¦ä¼˜åŒ–åŠ é”æ“ä½œæ ¹æ®åº”ç”¨åœºæ™¯ï¼Œå°½é‡å‡å°‘é”çš„æ—¶é—´ï¼Œä¸éœ€è¦åŒæ­¥æ‰§è¡Œçš„ä»£ç ï¼Œèƒ½ä¸æ”¾åœ¨åŒæ­¥å¿«é‡Œé¢æ‰§è¡Œå°±ä¸è¦æ”¾åœ¨åŒæ­¥å¿«å†…ï¼Œå¯ä»¥è®©é”å°½å¿«é‡Šæ”¾ï¼›ç»†åŒ–é”çš„ç²’åº¦ï¼Œå°†ç‰©ç†ä¸Šçš„ä¸€ä¸ªé”ï¼Œæ‹†æˆé€»è¾‘ä¸Šçš„å¤šä¸ªé”ï¼Œå¢åŠ å¹¶è¡Œåº¦ï¼Œä»è€Œé™ä½é”ç«äº‰ã€‚

åŸºæœ¬æ¦‚å¿µï¼š

- Pessimistic or Optimistic Locking æ‚²è§‚é”ä¸ä¹è§‚é”
- Starvation and Fairness é¥¥é¥¿ä¸å…¬å¹³é”
- Pessimistic or Optimistic Locking æ‚²è§‚é”ä¸ä¹è§‚é”
- Biased Locking åå‘é”
- ReentrantLock é‡å…¥é”
- ReadWriteLock è¯»å†™é”

æœ‰èµ„æºçš„é”å®šï¼Œé‚£ä¹ˆåœ¨å¤„ç†çº¿ç¨‹ç­‰å¾…è¿‡ç¨‹ä¸­å°±å¯èƒ½æœ‰å‡ºç°æ­»é”ç°è±¡ï¼Œå››ä¸ªå¿…è¦æ¡ä»¶ï¼š

- äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨
- è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šè¿›ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚
- ä¸å¯å‰¥å¤ºæ¡ä»¶:è¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæ¯•ä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œå³åªèƒ½ç”±è·å¾—è¯¥èµ„æºçš„è¿›ç¨‹è‡ªå·±æ¥é‡Šæ”¾ã€‚
- å¾ªç¯ç­‰å¾…æ¡ä»¶: è‹¥å¹²è¿›ç¨‹é—´å½¢æˆé¦–å°¾ç›¸æ¥å¾ªç¯ç­‰å¾…èµ„æºçš„å…³ç³»ã€‚


å¹¶å‘ç¼–ç¨‹ä¸‰è¦ç´ ï¼š

- **åŸå­æ€§**ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªæ“ä½œä¸èƒ½å†ç»§ç»­æ‹†åˆ†ï¼Œè¦ä¹ˆä¸€æ¬¡æ“ä½œå®Œæˆï¼Œè¦ä¹ˆå°±æ˜¯ä¸æ‰§è¡Œã€‚ä¸ºäº†ä¿è¯åŸå­æ€§ï¼ŒJava æä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤ monitorenter å’Œ monitorexitï¼Œè¿™ä¸ªå°±æ˜¯å…³é”®å­— synchronized çš„å†…éƒ¨å®ç°ã€‚

- **å¯è§æ€§**ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªå˜é‡åœ¨è¢«ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹åï¼Œå…¶ä»–çš„çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°æœ€æ–°çš„å€¼ï¼Œå…³é”®å­— volatile å°±æ˜¯åšè¿™ç§äº‹çš„ã€‚

- **æœ‰åºæ€§**ï¼šæŒ‡çš„æ˜¯ç¨‹åºçš„æ‰§è¡ŒæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚

å¯¹äºå¯è§æ€§å’Œæœ‰åºæ€§ï¼ŒJava æä¾›äº†å…³é”®å­— volatile ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œä¿è¯äº†æœ‰åºæ€§ï¼ŒåŒæ—¶ volatile å¯ä»¥ä¿è¯å˜é‡çš„è¯»å†™åŠæ—¶ä»ç¼“å­˜ä¸­åˆ·æ–°åˆ°ä¸»å­˜ï¼Œä¹Ÿå°±ä¿è¯äº†å¯è§æ€§ã€‚ä»¥å¤–ï¼Œsynchronized æ˜¯å¯è§æ€§å’Œæœ‰åºæ€§å¦å¤–ä¸€ç§å®ç°ï¼ŒåŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—ä¿è¯ä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè¿™å°±æ˜¯ä¸€ç§å…ˆåé¡ºåºï¼Œè€Œå¯¹äºå¯è§æ€§ä¿è¯ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œå˜é‡ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹åªèƒ½åœ¨å‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œå®Œæˆåæ‰å¯ä»¥çœ‹åˆ°å˜é‡æœ€æ–°çš„å€¼ã€‚

CAS - Compare And Swap æ¯”è¾ƒå¹¶äº¤æ¢æŠ€æœ¯ï¼Œè‘—åçš„å¹¶è¡Œè®¡ç®—ä¸“å®¶ Doug lea å¤§ç¥åœ¨åŒæ­¥ç»„ä»¶ä¸­å¤§é‡ä½¿ç”¨ CAS æŠ€æœ¯é¬¼æ–§ç¥å·¥åœ°å®ç°äº† Java å¤šçº¿ç¨‹çš„å¹¶å‘æ“ä½œã€‚æ•´ä¸ª AQS åŒæ­¥ç»„ä»¶ã€Atomic åŸå­ç±»æ“ä½œç­‰ç­‰éƒ½æ˜¯ä»¥ CAS å®ç°çš„ï¼Œç”šè‡³ ConcurrentHashMap åœ¨ 1.8 çš„ç‰ˆæœ¬ä¸­ä¹Ÿè°ƒæ•´ä¸ºäº† CAS + Synchronizedï¼Œå¯ä»¥è¯´ CAS æ˜¯æ•´ä¸ª JUC çš„åŸºçŸ³ã€‚JUC å³æ˜¯ Java 5.0 æä¾›çš„ java.util.concurrent å¹¶å‘åŒ…ï¼Œåœ¨æ­¤åŒ…ä¸­å¢åŠ äº†åœ¨å¹¶å‘ç¼–ç¨‹ä¸­å¾ˆå¸¸ç”¨çš„å·¥å…·ç±»,
ç”¨äºå®šä¹‰ç±»ä¼¼äºçº¿ç¨‹çš„è‡ªå®šä¹‰å­ç³»ç»Ÿï¼ŒåŒ…æ‹¬çº¿ç¨‹æ± ï¼Œå¼‚æ­¥ IO å’Œè½»é‡çº§ä»»åŠ¡æ¡†æ¶ã€‚è¿˜æä¾›äº†è®¾è®¡ç”¨äºå¤šçº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„ Collection å®ç°ç­‰ã€‚

CAS ç®—æ³•ï¼š

- æ˜¯ç¡¬ä»¶å¯¹äºå¹¶å‘çš„æ”¯æŒï¼Œé’ˆå¯¹å¤šå¤„ç†å™¨æ“ä½œè€Œè®¾è®¡çš„å¤„ç†å™¨ä¸­çš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ï¼Œç®¡ç†å¯¹å…±äº«æ•°æ®çš„å¹¶å‘è®¿é—®;
- CAS æ˜¯ä¸€ç§æ— é”çš„éé˜»å¡ç®—æ³•çš„å®ç°;
- CAS åŒ…å«äº†ä¸‰ä¸ªæ“ä½œæ•°ï¼Œéœ€è¦è¯»å†™çš„å†…å­˜å€¼ Vã€è¿›è¡Œæ¯”è¾ƒçš„é¢„ä¼°å€¼ Aã€æ‹Ÿå†™å…¥çš„æ›´æ–°å€¼ Bï¼›
- å½“ä¸”ä»…å½“ V == A æ—¶ï¼Œèµ‹å€¼ V = Bï¼Œå¦åˆ™å°†ä¸åšä»»ä½•æ“ä½œ;

CASè™½ç„¶å¾ˆé«˜æ•ˆï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸‰å¤§é—®é¢˜ï¼š

- ABA é—®é¢˜ã€‚CAS éœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚ä½†æ˜¯å¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯ Aï¼Œåæ¥å˜æˆäº† Bï¼Œåˆå˜æˆ Aï¼Œé‚£ä¹ˆ CAS è¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚ABA é—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä» â€œAï¼Bï¼Aâ€ å˜æˆäº† â€œ1Aï¼2Bï¼3Aâ€ã€‚JDK 5 å¼€å§‹æä¾› AtomicStampedReference ç±»æ¥è§£å†³ ABA é—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨ compareAndSet() ä¸­ã€‚é¦–å…ˆä¼šæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸é¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚

- å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚CASæ“ä½œå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚

- åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œã€‚å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCAS èƒ½å¤Ÿä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCAS æ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚
Java 1.5 å¼€å§‹æä¾› AtomicReference ç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œã€‚



è¦ç†è§£æŒæ¡ä¸åŒçš„é”ï¼Œå°±éœ€è¦å¯¹å¤šçº¿ç¨‹ä¸­ä½¿ç”¨åˆ°çš„èµ„æºè¯»å†™åœºæ™¯è¿›è¡Œåˆ†æï¼š

- èµ„æºè¦ä¸è¦é”å®šæ“ä½œï¼Ÿ
	- è¦é”å®š -> æ‚²è§‚é”
	- ä¸é”å®š -> ä¹è§‚é”
- èµ„æºè¦ä¸è¦é”å®šè¯»å†™æ“ä½œï¼Ÿ
	- è¯»å–è¦é”å®š -> è¯»é”
	- å†™å…¥è¦é”å®š -> å†™é”
- èµ„æºé”å®šå¤±è´¥ï¼Œè¦ä¸è¦é˜»å¡çº¿ç¨‹ï¼Ÿ
	- è¿›å…¥é˜»å¡ç­‰å¾… -> åŒæ­¥é”
	- ä¸é˜»å¡ -> è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é” 
- å¤šçº¿ç¨‹ç«äº‰èµ„æºé”å®šè¦ä¸è¦æ’é˜Ÿï¼Ÿ
	- æ’é˜Ÿ -> å…¬å¹³é”
	- æ’é˜Ÿ -> éå…¬å¹³é”
- çº¿ç¨‹èƒ½å¦é‡å¤è·å–åŒä¸€ä¸ªé”å®šå¯¹è±¡ï¼Ÿ 
	- å¯ä»¥ -> å¯é‡å…¥é”
	- ä¸èƒ½ -> éé‡å…¥é”
- çº¿ç¨‹èƒ½å¦å…±äº«åŒä¸€ä¸ªé”å®šå¯¹è±¡ï¼Ÿ 
	- å¯ä»¥ -> å…±äº«é”
	- ä¸èƒ½ -> æ’ä»–é” Mutex
- å¤šçº¿ç¨‹ç«äº‰åŒæ­¥èµ„æºçš„ç¨‹åºç»†èŠ‚æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ
	- ä¸é”å®šèµ„æºï¼Œå¤šçº¿ç¨‹åªæœ‰ä¸€ä¸ªæˆåŠŸä¿®æ”¹èµ„æº
	- åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥èµ„æºæ—¶è‡ªåŠ¨è·å–èµ„æº -> åå‘é”
	- å¤šä¸ªçº¿ç¨‹ç«äº‰åŒæ­¥èµ„æºæ—¶ï¼Œæ²¡æœ‰è·å–åˆ°èµ„æºçš„çº¿ç¨‹è‡ªæ—‹ç­‰å¾… -> è½»é‡çº§é”
	- å¤šä¸ªçº¿ç¨‹ç«äº‰åŒæ­¥èµ„æºæ—¶ï¼Œæ²¡æœ‰è·å–åˆ°èµ„æºçš„çº¿ç¨‹é˜»å¡ç­‰å¾…å”¤é†’ -> è½»é‡çº§é”

ä¹è§‚é”ä¸æ‚²è§‚é”ä¸æ˜¯æŒ‡å…·ä½“çš„ä»€ä¹ˆç±»å‹çš„é”ï¼Œè€Œæ˜¯æŒ‡çœ‹å¾…å¹¶å‘åŒæ­¥çš„è§’åº¦ã€‚

**æ‚²è§‚é”**è®¤ä¸ºå¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œä¸€å®šæ˜¯ä¼šå‘ç”Ÿä¿®æ”¹çš„ï¼Œå“ªæ€•æ²¡æœ‰ä¿®æ”¹ï¼Œä¹Ÿä¼šè®¤ä¸ºä¿®æ”¹ã€‚å› æ­¤å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”é‡‡å–åŠ é”çš„å½¢å¼ã€‚æ‚²è§‚çš„è®¤ä¸ºï¼Œä¸åŠ é”çš„å¹¶å‘æ“ä½œä¸€å®šä¼šå‡ºé—®é¢˜ã€‚

**ä¹è§‚é”**åˆ™è®¤ä¸ºå¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿä¿®æ”¹çš„ã€‚åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¼šé‡‡ç”¨å°è¯•æ›´æ–°ï¼Œä¸æ–­é‡æ–°çš„æ–¹å¼æ›´æ–°æ•°æ®ã€‚ä¹è§‚çš„è®¤ä¸ºï¼Œä¸åŠ é”çš„å¹¶å‘æ“ä½œæ˜¯æ²¡æœ‰äº‹æƒ…çš„ã€‚

æ‚²è§‚é”é€‚åˆå†™æ“ä½œéå¸¸å¤šçš„åœºæ™¯ï¼Œä¹è§‚é”é€‚åˆè¯»æ“ä½œéå¸¸å¤šçš„åœºæ™¯ï¼Œä¸åŠ é”ä¼šå¸¦æ¥å¤§é‡çš„æ€§èƒ½æå‡ã€‚

ç®€å•ç†è§£ä¸‹æ‚²è§‚é”ï¼šå½“ä¸€ä¸ªäº‹åŠ¡é”å®šäº†ä¸€äº›æ•°æ®ä¹‹åï¼Œåªæœ‰å½“å½“å‰é”æäº¤äº†äº‹åŠ¡ï¼Œé‡Šæ”¾äº†é”ï¼Œå…¶ä»–äº‹åŠ¡æ‰èƒ½è·å¾—é”å¹¶æ‰§è¡Œæ“ä½œã€‚ æ‚²è§‚é”ä¸€èˆ¬æ˜¯ç”¨äºå¹¶å‘ä¸æ˜¯å¾ˆé«˜ï¼Œå¹¶ä¸”ä¸å…è®¸è„è¯»ç­‰æƒ…å†µï¼Œä½†æ˜¯å¯¹æ•°æ®åº“èµ„æºæ¶ˆè€—è¾ƒå¤§ã€‚

	set autocommit = 0;
	bigen --å¼€å¯äº‹åŠ¡
	select id, total, front, end from price where id=1 for update 
	insert into price values(?,?,?,?,?)
	commit --æäº¤äº‹åŠ¡

è¿™é‡Œä½¿ç”¨ select for update çš„æ–¹å¼åˆ©ç”¨æ•°æ®åº“å¼€å¯äº†æ‚²è§‚é”ï¼Œé”å®šäº† id=1 çš„è¿™æ¡æ•°æ®ï¼Œæ³¨æ„:è¿™é‡Œé™¤éæ˜¯ä½¿ç”¨äº†ç´¢å¼•ä¼šå¯ç”¨è¡Œçº§é”ï¼Œä¸ç„¶æ˜¯ä¼šä½¿ç”¨è¡¨é”ï¼Œå°†æ•´å¼ è¡¨éƒ½é”ä½ã€‚ã€‚ä¹‹åä½¿ç”¨commitæäº¤äº‹åŠ¡å¹¶é‡Šæ”¾é”ï¼Œè¿™æ ·ä¸‹ä¸€ä¸ªçº¿ç¨‹è¿‡æ¥æ‹¿åˆ°çš„å°±æ˜¯æ­£ç¡®çš„æ•°æ®ã€‚

ç›¸å¯¹æ¯”çš„æ˜¯æ›´å¥½çš„å¹¶å‘åŠ é”æ–¹å¼ï¼Œä¹è§‚é”é¦–å…ˆå‡è®¾æ•°æ®å†²çªå¾ˆå°‘ï¼Œåªæœ‰åœ¨æ•°æ®æäº¤ä¿®æ”¹çš„æ—¶å€™æ‰è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœå†²çªäº†åˆ™ä¸ä¼šè¿›è¡Œæ›´æ–°ã€‚ä¹è§‚é”åœ¨å®é™…åº”ç”¨ç›¸å¯¹è¾ƒå¤šï¼Œå®ƒå¯ä»¥æä¾›æ›´å¥½çš„å¹¶å‘è®¿é—®ï¼Œå¹¶ä¸”æ•°æ®åº“å¼€é”€è¾ƒå°‘ï¼Œä½†æ˜¯æœ‰å¯èƒ½å­˜åœ¨è„è¯»çš„æƒ…å†µã€‚


åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”è¿™ä¸‰ç§é”æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œå¹¶ä¸”æ˜¯é’ˆå¯¹ Synchronizedã€‚

åœ¨ Java 5 é€šè¿‡å¼•å…¥é”å‡çº§çš„æœºåˆ¶æ¥å®ç°é«˜æ•ˆ Synchronizedã€‚

**åå‘é”**æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒä¼šåå‘äºç¬¬ä¸€ä¸ªè®¿é—®é”çš„çº¿ç¨‹ï¼Œå¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŒæ­¥é”åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹äº‰ç”¨çš„æƒ…å†µã€‚

å¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†å…¶ä»–çº¿ç¨‹æŠ¢å é”ï¼Œåˆ™æŒæœ‰åå‘é”çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ŒJVM ä¼šæ¶ˆé™¤å®ƒèº«ä¸Šçš„åå‘é”ï¼Œå°†é”æ¢å¤åˆ°æ ‡å‡†çš„è½»é‡çº§é”ã€‚

**è½»é‡çº§é”**æ˜¯æŒ‡åå‘é”è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚

**é‡é‡çº§é”**æ˜¯æŒ‡è½»é‡çº§é”ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚


**è‡ªæ—‹é”**åŸç†éå¸¸ç®€å•ï¼Œå¦‚æœæŒæœ‰é”çš„çº¿ç¨‹èƒ½åœ¨å¾ˆçŸ­æ—¶é—´å†…é‡Šæ”¾é”èµ„æºï¼Œé‚£ä¹ˆé‚£äº›ç­‰å¾…ç«äº‰é”çš„çº¿ç¨‹å°±ä¸éœ€è¦åšå†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢è¿›å…¥é˜»å¡æŒ‚èµ·çŠ¶æ€ï¼Œå®ƒä»¬åªéœ€è¦ç­‰ä¸€ç­‰ï¼Œå³è¿›å…¥è‡ªæ—‹çŠ¶æ€ã€‚ç­‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åå³å¯ç«‹å³è·å–é”ï¼Œè¿™æ ·å°±é¿å…ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çš„åˆ‡æ¢çš„æ¶ˆè€—ã€‚

ä½†æ˜¯çº¿ç¨‹è‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€— CUP æ—¶é—´çš„ï¼Œè¯´ç™½äº†å°±æ˜¯è®© CUP åœ¨åšæ— ç”¨åŠŸï¼Œå¦‚æœä¸€ç›´è·å–ä¸åˆ°é”ï¼Œé‚£çº¿ç¨‹ä¹Ÿä¸èƒ½ä¸€ç›´å ç”¨ CUPï¼Œæ‰€ä»¥éœ€è¦è®¾å®šä¸€ä¸ªè‡ªæ—‹ç­‰å¾…çš„æœ€å¤§æ—¶é—´ã€‚

å¦‚æœæŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´è¶…è¿‡è‡ªæ—‹ç­‰å¾…çš„æœ€å¤§æ—¶é—´æ‰”æ²¡æœ‰é‡Šæ”¾é”ï¼Œè¿™æ—¶ç«äº‰çº¿ç¨‹ä¼šåœæ­¢è‡ªæ—‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚

è‡ªæ—‹é”å°½å¯èƒ½çš„å‡å°‘çº¿ç¨‹çš„é˜»å¡ï¼Œè¿™å¯¹äºé”çš„ç«äº‰ä¸æ¿€çƒˆï¼Œä¸”å ç”¨é”æ—¶é—´éå¸¸çŸ­çš„ä»£ç å—æ¥è¯´æ€§èƒ½èƒ½å¤§å¹…åº¦çš„æå‡ï¼Œå› ä¸ºè‡ªæ—‹çš„æ¶ˆè€—ä¼šå°äºçº¿ç¨‹é˜»å¡æŒ‚èµ·å†å”¤é†’çš„æ“ä½œçš„æ¶ˆè€—ï¼Œè¿™äº›æ“ä½œä¼šå¯¼è‡´çº¿ç¨‹å‘ç”Ÿä¸¤æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼

**è‡ªé€‚åº”è‡ªæ—‹é”**æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚

åœ¨è‡ªæ—‹é”ä¸­ å¦æœ‰ä¸‰ç§å¸¸è§çš„é”å½¢å¼:TicketLockã€CLHlockå’ŒMCSlock


**å…¬å¹³é”**æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚

**éå…¬å¹³é”**æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿ç°è±¡ã€‚

**å¯é‡å…¥é”**åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ï¼Œæ¯”å¦‚ä¸¤ä¸ªç›¸äº’è°ƒç”¨çš„æ–¹æ³• A å’Œ Bï¼Œå¦‚æœä¸æ˜¯å¯é‡å…¥é”çš„è¯ï¼Œåœ¨åŠ é”çš„æ—¶å€™è°ƒç”¨å¯¹æ–¹å¯èƒ½é€ æˆæ­»é”ã€‚


å¯¹äº ReentrantLock è€Œè¨€ï¼Œé€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥é”æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œå®ƒçš„ä¼˜ç‚¹åœ¨äºååé‡æ¯”å…¬å¹³é”å¤§ï¼ŒReentrantLock ä¾‹åŒ–æ—¶ä¼ å…¥ true å¯ä»¥é‚£å»ºç«‹å…¬å¹³é”ã€‚

	ReentrantLock()	
	ReentrantLockâ€‹(boolean fair)

å¯¹äº Synchronized è€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚ä½†å¹¶ä¸åƒ ReentrantLock é€šè¿‡ AQS - Abstract Queued Synchronizer æ¥å®ç°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»»ä½•åŠæ³•ä½¿å…¶å˜æˆå…¬å¹³é”ã€‚


**æ’å®ƒé”**ä¹Ÿå«ç‹¬äº«é”ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚**å…±äº«é”**æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ï¼Œäº’æ–¥é”/è¯»å†™é”å°±æ˜¯å…·ä½“çš„å®ç°ã€‚

å¯¹äº ReentrantLock è€Œè¨€ï¼Œæ˜¯ç‹¬äº«é”ã€äº’æ–¥é”ï¼Œä½†æ˜¯å¯¹äº Lock çš„å¦ä¸€ä¸ªå®ç°ç±» ReadWriteLockï¼Œè¯»å–é”å®šæ˜¯å…±äº«çš„ï¼Œå…¶å†™å…¥é”å®šæ˜¯ç‹¬äº«é”ï¼Œå…±äº«è¯»å–é”å¯ä¿è¯å¹¶å‘è¯»å–é«˜æ•ˆã€‚

ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡ AQS æ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•æ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚

å¯¹äº Synchronized è€Œè¨€ï¼Œå½“ç„¶æ˜¯ç‹¬äº«é”ã€‚

 Java ä¸­çš„å…·ä½“å®ç°å°±æ˜¯ ReentrantLockã€‚

**è¯»å†™é”**åœ¨ Java ä¸­çš„å…·ä½“å®ç°å°±æ˜¯ ReadWriteLockï¼Œç®¡ç†ç€ä¸€ç»„é”ï¼Œä¸€ä¸ªæ˜¯åªè¯»çš„é”ï¼Œä¸€ä¸ªæ˜¯å†™é”ã€‚è¯»é”å¯ä»¥åœ¨æ²¡æœ‰å†™é”çš„æ—¶å€™è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰ï¼Œå†™é”æ˜¯ç‹¬å çš„ã€‚ æ‰€æœ‰è¯»å†™é”çš„å®ç°å¿…é¡»ç¡®ä¿å†™æ“ä½œå¯¹è¯»æ“ä½œçš„å†…å­˜å½±å“ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªè·å¾—äº†è¯»é”çš„çº¿ç¨‹å¿…é¡»èƒ½çœ‹åˆ°å‰ä¸€ä¸ªé‡Šæ”¾çš„å†™é”æ‰€æ›´æ–°çš„å†…å®¹ã€‚ è¯»å†™é”æ¯”äº’æ–¥é”å…è®¸å¯¹äºå…±äº«æ•°æ®æ›´å¤§ç¨‹åº¦çš„å¹¶å‘ã€‚æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªå†™çº¿ç¨‹ï¼Œä½†æ˜¯åŒæ—¶å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹å¹¶å‘åœ°è¯»æ•°æ®ã€‚ReadWriteLock é€‚ç”¨äºè¯»å¤šå†™å°‘çš„å¹¶å‘æƒ…å†µã€‚ Java å¹¶å‘åº“ä¸­ ReentrantReadWriteLock å®ç°äº† ReadWriteLock æ¥å£å¹¶æ·»åŠ äº†å¯é‡å…¥çš„ç‰¹æ€§ã€‚


**åˆ†æ®µé”**å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ï¼Œå¯¹äº ConcurrentHashMap è€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®ç°å°±æ˜¯é€šè¿‡åˆ†æ®µé”çš„å½¢å¼æ¥å®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œã€‚

åˆ†æ®µé”çš„å«ä¹‰ä»¥åŠè®¾è®¡æ€æƒ³ï¼ŒConcurrentHashMap ä¸­çš„åˆ†æ®µé”ç§°ä¸º Segmentï¼Œå®ƒç»§æ‰¿è‡ª ReentrantLockã€‚ç±»ä¼¼äº JDK 8 HashMap çš„å®ç°ï¼Œå³å†…éƒ¨æ‹¥æœ‰ä¸€ä¸ª Entry æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ŒåŒæ—¶åˆæ˜¯ä¸€ä¸ª ReentrantLockã€‚

å½“éœ€è¦ put å…ƒç´ çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å¯¹æ•´ä¸ª hashmap è¿›è¡ŒåŠ é”ï¼Œè€Œæ˜¯å…ˆé€šè¿‡ hashcode æ¥çŸ¥é“ä»–è¦æ”¾åœ¨é‚£ä¸€ä¸ªåˆ†æ®µä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªåˆ†æ®µè¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥å½“å¤šçº¿ç¨‹ put çš„æ—¶å€™ï¼Œåªè¦ä¸æ˜¯æ”¾åœ¨ä¸€ä¸ªåˆ†æ®µä¸­ï¼Œå°±å®ç°äº†çœŸæ­£çš„å¹¶è¡Œçš„æ’å…¥ã€‚

ä½†æ˜¯ï¼Œåœ¨ç»Ÿè®¡ size çš„æ—¶å€™ï¼Œå¯å°±æ˜¯è·å– hashmap å…¨å±€ä¿¡æ¯çš„æ—¶å€™ï¼Œå°±éœ€è¦è·å–æ‰€æœ‰çš„åˆ†æ®µé”æ‰èƒ½ç»Ÿè®¡ã€‚

åˆ†æ®µé”çš„è®¾è®¡ç›®çš„æ˜¯ç»†åŒ–é”çš„ç²’åº¦ï¼Œå½“æ“ä½œä¸éœ€è¦æ›´æ–°æ•´ä¸ªæ•°ç»„çš„æ—¶å€™ï¼Œå°±ä»…ä»…é’ˆå¯¹æ•°ç»„ä¸­çš„ä¸€é¡¹è¿›è¡ŒåŠ é”æ“ä½œã€‚

Java å„ç§é”å¯¹è±¡ï¼š

|         ç±»å¯¹è±¡         |            é”ç±»å‹            |      é€‚ç”¨åœºæ™¯      |
|------------------------|------------------------------|--------------------|
| ReentrantLock          | äº’æ–¥é”                       | æ•°æ®ä¸€è‡´æ€§         |
| ReentrantReadWriteLock | å¯é‡å…¥è¯»å†™é”                 |                    |
| ReadWriteLock          | å…±äº«è¯»å–é”ã€ç‹¬äº«å†™å…¥é”       | é«˜æ€§èƒ½è¯»å–         |
| StampedLock            | æˆ³é”ï¼Œæ’å®ƒå†™ï¼Œæ‚²è§‚è¯»ï¼Œä¹è§‚è¯» | éœ€è¦é«˜æ€§èƒ½è¯»å–åœºåˆ |




## âš¡ Semaphores ä¿¡å·é‡ 

ä¿¡å·é‡ Semaphores æœºåˆ¶æ˜¯ä¸€ç§å“æœ‰æˆæ•ˆçš„è¿›ç¨‹åŒæ­¥å·¥å…·ï¼Œç”±è·å…°å­¦è€… Dijkstra æå‡ºã€‚

ä¿¡å·é‡çš„å€¼ä»…èƒ½ç”± PV æ“ä½œæ¥æ”¹å˜ã€‚

- P æ“ä½œï¼ˆwaitï¼‰ç”³è¯·ä¸€ä¸ªå•ä½èµ„æºï¼Œç„¶åè¿›ç¨‹è¿›å…¥ã€‚
- V æ“ä½œï¼ˆsignalï¼‰é‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œç„¶åè¿›ç¨‹å‡ºæ¥ã€‚

Semaphore ä¿¡å·é‡ç»´æŠ¤ä¸€å®šæ•°é‡çš„ç‰¹æƒï¼Œå½“ç‰¹æƒæœ‰ä½™é‡ï¼Œçº¿ç¨‹é€šè¿‡ acquire æ–¹æ³•å¯ä»¥è·å–åˆ°ä»£ç æ‰§è¡Œç‰¹æƒï¼Œç”¨å®Œåä½¿ç”¨ release æ–¹æ³•å½’è¿˜è¿™ã€‚

Semaphore å¯ä»¥ç”¨äºæµé‡æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯å¯¹å¹¶å‘æ•°æœ‰é™åˆ¶çš„åœºæ™¯ã€‚å¦‚æ•°æ®åº“åŒæ—¶åªå…è®¸æœ‰ 20 ä¸ªçº¿ç¨‹è®¿é—®ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥å®ç°ã€‚

å½“ç‰¹æƒä½¿ç”¨å®Œåï¼Œçº¿ç¨‹å†æ‰§è¡Œ acquire å°±ä¼šè¿›å…¥åŒæ­¥é˜»å¡ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹å½’è¿˜ç‰¹æƒåï¼Œå†ç»§ç»­è·å–ç‰¹æƒæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚

    Semaphoreâ€‹(int permits) 
    Semaphoreâ€‹(int permits, boolean fair)

æ„é€ å‡½æ•°å¯ä»¥æŒ‡å®šæ˜¯æ˜¯ä½¿ç”¨å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯ nonfair fairnessã€‚

å¸¸ç”¨æ–¹æ³•ï¼š

- void	acquire()	è·å–ä»£ç æ‰§è¡Œç‰¹æƒ
- void	acquireâ€‹(int permits) è·å–æŒ‡å®šæ•°é‡ä»£ç æ‰§è¡Œç‰¹æƒ
- int	drainPermits()		å°†ç°æœ‰çš„ç‰¹æƒæ¸…ç©º
- boolean	tryAcquire()	å°è¯•è·å–ä¸€ä¸ªä»£ç æ‰§è¡Œç‰¹æƒï¼Œå¦‚æœåœ¨è°ƒç”¨æœŸæ— ç»“æœå°±é€€å‡º
- boolean	tryAcquireâ€‹(int permits)	åŒä¸Šï¼Œä½†æŒ‡å®šäº†éœ€è¦çš„ç‰¹æƒæ•°é‡
- void	release()	é‡Šæ”¾ç‰¹æƒï¼Œè£…é¥°ç‰¹æƒå½’è¿˜ Semaphore å¯¹è±¡ç®¡ç†
- void	releaseâ€‹(int permits) åŒä¸Šï¼ŒæŒ‡å®šäº†ç‰¹æƒæ•°é‡


## âš¡ Synchronized é‡é‡çº§åŒæ­¥é”

åœ¨ JDK1.5 ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨ synchronized å…³é”®å­—ä¿è¯åŒæ­¥çš„ï¼Œå®ƒå¯ä»¥æŠŠä»»æ„ä¸€ä¸ªé NULL å¯¹è±¡å½“ä½œé”å®šå¯¹è±¡ã€‚

ä½œç”¨äºæ–¹æ³•æ—¶ï¼Œé”ä½çš„æ˜¯å¯¹è±¡çš„å®ä¾‹(this)ï¼› å½“ä½œç”¨äºé™æ€æ–¹æ³•æ—¶ï¼Œé”ä½çš„æ˜¯ Class å®ä¾‹ï¼Œåˆå› ä¸º Class çš„ç›¸å…³æ•°æ®å­˜å‚¨åœ¨æ°¸ä¹…å¸¦ PermGenï¼ˆJDK 1.8 åˆ™æ˜¯ metaspaceï¼‰ã€‚æ°¸ä¹…å¸¦æ˜¯å…¨å±€å…±äº«çš„ï¼Œå› æ­¤é™æ€æ–¹æ³•é”ç›¸å½“äºç±»çš„ä¸€ä¸ªå…¨å±€é”ï¼Œä¼šé”æ‰€æœ‰è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ï¼›

synchronized ä½œç”¨äºä¸€ä¸ªå¯¹è±¡å®ä¾‹æ—¶ï¼Œé”ä½çš„æ˜¯æ‰€æœ‰ä»¥è¯¥å¯¹è±¡ä¸ºé”çš„ä»£ç å—ã€‚

Synchronized é€šè¿‡ç›‘è§†é˜Ÿåˆ—å®ç°ç›®æ ‡é”å®šï¼Œæœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œå½“å¤šä¸ªçº¿ç¨‹ä¸€èµ·è®¿é—®æŸä¸ªå¯¹è±¡ç›‘è§†å™¨çš„æ—¶å€™ï¼Œå¯¹è±¡ç›‘è§†å™¨ä¼šå°†è¿™äº›çº¿ç¨‹å­˜å‚¨åœ¨ä¸åŒçš„å®¹å™¨ä¸­ã€‚

- **Contention List**ï¼šç«äº‰é˜Ÿåˆ—ï¼Œæ‰€æœ‰è¯·æ±‚é”çš„çº¿ç¨‹é¦–å…ˆè¢«æ”¾åœ¨è¿™ä¸ªç«äº‰é˜Ÿåˆ—ä¸­ï¼›
- **Entry List**ï¼šContention Listä¸­é‚£äº›æœ‰èµ„æ ¼æˆä¸ºå€™é€‰èµ„æºçš„çº¿ç¨‹è¢«ç§»åŠ¨åˆ°Entry Listä¸­ï¼›
- **Wait Set**ï¼šå“ªäº›è°ƒç”¨waitæ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹è¢«æ”¾ç½®åœ¨è¿™é‡Œï¼›
- **OnDeck**ï¼šä»»æ„æ—¶åˆ»ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç«äº‰é”èµ„æºï¼Œè¯¥çº¿ç¨‹è¢«æˆä¸ºOnDeckï¼›
- **Owner**ï¼šå½“å‰å·²ç»è·å–åˆ°æ‰€èµ„æºçš„çº¿ç¨‹è¢«ç§°ä¸ºOwnerï¼›
- **!Owner**ï¼šå½“å‰é‡Šæ”¾é”çš„çº¿ç¨‹ã€‚

JVM æ¯æ¬¡ä»é˜Ÿåˆ—çš„å°¾éƒ¨å–å‡ºä¸€ä¸ªæ•°æ®ç”¨äºé”ç«äº‰å€™é€‰è€…ï¼ˆOnDeckï¼‰ï¼Œä½†æ˜¯å¹¶å‘æƒ…å†µä¸‹ï¼ŒContentionList ä¼šè¢«å¤§é‡çš„å¹¶å‘çº¿ç¨‹è¿›è¡Œ CAS - Compare and Swap è®¿é—®ï¼Œä¸ºäº†é™ä½å¯¹å°¾éƒ¨å…ƒç´ çš„ç«äº‰ï¼ŒJVM ä¼šå°†ä¸€éƒ¨åˆ†çº¿ç¨‹ç§»åŠ¨åˆ° EntryList ä¸­ä½œä¸ºå€™é€‰ç«äº‰çº¿ç¨‹ã€‚Owner çº¿ç¨‹ä¼šåœ¨ unlock æ—¶å°† ContentionList ä¸­çš„éƒ¨åˆ†çº¿ç¨‹è¿ç§»åˆ° EntryList ä¸­ï¼Œå¹¶æŒ‡å®š EntryList ä¸­çš„æŸä¸ªçº¿ç¨‹ä¸º OnDeck çº¿ç¨‹ï¼ˆä¸€èˆ¬æ˜¯æœ€å…ˆè¿›å»çš„é‚£ä¸ªçº¿ç¨‹ï¼‰ã€‚Owner çº¿ç¨‹å¹¶ä¸ç›´æ¥æŠŠé”ä¼ é€’ç»™ OnDeck çº¿ç¨‹ï¼Œè€Œæ˜¯æŠŠé”ç«äº‰çš„æƒåˆ©äº¤ç»™ OnDeckï¼ŒOnDeck éœ€è¦é‡æ–°ç«äº‰é”ã€‚è¿™æ ·è™½ç„¶ç‰ºç‰²äº†ä¸€äº›å…¬å¹³æ€§ï¼Œä½†æ˜¯èƒ½æå¤§çš„æå‡ç³»ç»Ÿçš„ååé‡ï¼Œåœ¨ JVM ä¸­ï¼Œä¹ŸæŠŠè¿™ç§é€‰æ‹©è¡Œä¸ºç§°ä¹‹ä¸ºç«äº‰åˆ‡æ¢ã€‚

OnDeck çº¿ç¨‹è·å–åˆ°é”èµ„æºåä¼šå˜ä¸º Owner çº¿ç¨‹ï¼Œè€Œæ²¡æœ‰å¾—åˆ°é”èµ„æºçš„ä»ç„¶åœç•™åœ¨ EntryListã€‚å¦‚æœ Owner çº¿ç¨‹é˜»å¡åœ¨ wait æ–¹æ³•ï¼Œåˆ™è½¬ç§»åˆ° WaitSet é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°æŸä¸ªæ—¶åˆ»é€šè¿‡ notify æˆ–è€… notifyAll å”¤é†’ï¼Œä¼šé‡æ–°è¿›å» EntryList ä¸­ã€‚

å¤„äº ContentionListã€EntryListã€WaitSet ä¸­çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¯¥é˜»å¡æ˜¯ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„ï¼ŒLinux å†…æ ¸ä¸‹é‡‡ç”¨ pthread_mutex_lock å†…æ ¸å‡½æ•°å®ç°ã€‚

å¯¹æ¯” synchronizedã€ReentrantLock ä¸¤è€…çš„åŒºåˆ«ï¼š

|          |            synchronized            |          ReentrantLock          |
|----------|------------------------------------|---------------------------------|
| è°ƒåº¦æœºåˆ¶ | ä½¿ç”¨å¯¹è±¡çš„ waitã€notifyã€notifyAll | ä¸ Condition ç»“åˆè¿›è¡Œçº¿ç¨‹çš„è°ƒåº¦ |
| è®¾ç½®æ–¹å¼ | æ˜¾å¼çš„ä½¿ç”¨åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥ä»£ç å— | æ˜¾å¼çš„å£°æ˜æŒ‡å®šèµ·å§‹å’Œç»“æŸä½ç½®    |
| é‡Šæ”¾æ–¹å¼ | æ‰˜ç®¡ç»™ JVM è‡ªåŠ¨æ‰§è¡Œ                | æ‰‹åŠ¨é‡Šæ”¾é”                      |

JDK 1.6 ä¹‹å‰ ReentrantLock æ€§èƒ½ä¼˜äº synchronizedï¼Œä¸è¿‡ä¹‹åçš„ synchronized åšäº†å¤§é‡çš„æ€§èƒ½è°ƒä¼˜ï¼Œè€Œä¸” synchronized ç›¸å¯¹ç¨‹åºå‘˜æ¥è¯´ï¼Œç®€æ´ç†Ÿæ‚‰ï¼Œå¦‚æœä¸æ˜¯ synchronized æ— æ³•å®ç°çš„åŠŸèƒ½ï¼Œå¦‚è½®è¯¢é”ã€è¶…æ—¶é”å’Œä¸­æ–­é”ç­‰ï¼Œæ¨èé¦–å…ˆä½¿ç”¨ synchronizedï¼Œè€Œé’ˆå¯¹é”çš„é«˜çº§åŠŸèƒ½ï¼Œå†ä½¿ç”¨ ReentrantLockã€‚
 

Synchronized åŒæ­¥é”ç”¨æ³•ï¼š

1. ä¿®é¥°ä¸€ä¸ªä»£ç å—ï¼Œè¢«ä¿®é¥°çš„ä»£ç å—ç§°ä¸ºåŒæ­¥è¯­å¥å—ï¼ŒåŒæ­¥ä½œç”¨äºè¿™ä¸ªä»£ç å—çš„å¯¹è±¡ï¼›
2. ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œç§°ä¸ºåŒæ­¥æ–¹æ³•ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªæ–¹æ³•ï¼ŒåŒæ­¥ä½œç”¨äºè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼›
3. ä¿®æ”¹ä¸€ä¸ªé™æ€çš„æ–¹æ³•ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªé™æ€æ–¹æ³•ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹ï¼›
4. ä¿®æ”¹ä¸€ä¸ªç±»ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯ synchronized åé¢æ‹¬å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†ï¼Œä½œç”¨äºè¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹ã€‚

ä½¿ç”¨ç¤ºèŒƒï¼›

    public void method()
    {
       synchronized(this) {
          // todo
       }
    }

    public synchronized void method()
    {
       // todo
    }

    public synchronized static void method() {
       // todo
    }

    class ClassName {
       public void method() {
          synchronized(ClassName.class) {
             // todo
          }
       }
    }

synchronized ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä½†ä¸èƒ½åœ¨æ„é€ å™¨ä¸Šä½¿ç”¨ã€‚åŒæ­¥åŠ é”çš„æ˜¯å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä»£ç ã€‚

- ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œç›¸å½“äº synchronized(this);
- ä¿®é¥°é™æ€æ–¹æ³•ï¼Œç›¸å½“äº synchronized(this.class);
- ä¿®é¥°ä»£ç å—çš„å½¢å¼æ˜¯ synchronized(Object)ã€‚

å¦‚æœé”çš„æ˜¯ç±»å¯¹è±¡ classï¼Œå°½ç®¡ new å¤šä¸ªå®ä¾‹å¯¹è±¡ï¼Œä½†ä»–ä»¬ä»ç„¶æ˜¯å±äºåŒä¸€ä¸ªç±»ä¾ç„¶ä¼šè¢«é”ä½ï¼Œçº¿ç¨‹ä¹‹é—´ä¿è¯åŒæ­¥å…³ç³»ï¼Œç»™ class åŠ åŒæ­¥é”å’Œç»™é™æ€æ–¹æ³•åŠ é”ä¸€æ ·ã€‚


Java Virtual Machine Specification æ–‡æ¡£ä¸­æåˆ° monitorenter å’Œ monitorexit ç”¨äºé”å®šçŠ¶æ€çš„åˆ‡æ¢ã€‚æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªç›‘è§†å™¨ monitorï¼Œå®ƒè¢«å ç”¨æ—¶å¯¹è±¡å°±å¤„äºé”å®šçŠ¶æ€ã€‚çº¿ç¨‹æ‰§è¡Œ monitorenter æŒ‡ä»¤å°è¯•è·å– monitor çš„æ‰€æœ‰æƒï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

- å¦‚æœ monitor çš„è¿›å…¥æ•°ä¸º 0ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥ monitorï¼Œç„¶åå°†è¿›å…¥æ•°è®¾ç½®ä¸º 1ï¼Œè¯¥çº¿ç¨‹æ‹¥æœ‰é”å®šå¯¹è±¡çš„ä½¿ç”¨æƒã€‚
- å¦‚æœçº¿ç¨‹å·²ç»å æœ‰è¯¥ monitorï¼Œåªæ˜¯é‡æ–°è¿›å…¥ï¼Œåˆ™è¿›å…¥ monitor çš„è¿›å…¥æ•°åŠ  1ã€‚
- å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»å ç”¨ monitorï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ° monitor çš„è¿›å…¥æ•°ä¸º 0ï¼Œå†é‡æ–°å°è¯•è·å– monitor çš„æ‰€æœ‰æƒã€‚

ä»£ç å—åŒæ­¥åœ¨ç¼–è¯‘åï¼Œé€šè¿‡å°† monitorenter æŒ‡ä»¤æ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„å¼€å§‹å¤„ï¼Œå°† monitorexit æŒ‡ä»¤æ’å…¥åˆ°æ–¹æ³•ç»“æŸå¤„å’Œå¼‚å¸¸å¤„ï¼Œé€šè¿‡åç¼–è¯‘å­—èŠ‚ç å¯ä»¥è§‚å¯Ÿåˆ°ã€‚ä»»ä½•ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª monitor ä¸ä¹‹å…³è”ï¼Œçº¿ç¨‹æ‰§è¡Œ monitorenter æŒ‡ä»¤æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡å¯¹åº”çš„ monitor çš„æ‰€æœ‰æƒï¼Œå³å°è¯•è·å¾—å¯¹è±¡çš„é”ã€‚

æ–¹æ³•åŒæ­¥æ–¹å¼ï¼Œsynchronized æ–¹æ³•åœ¨ method_info ç»“æ„æœ‰ ACC_synchronized æ ‡è®°ï¼Œçº¿ç¨‹æ‰§è¡Œæ—¶ä¼šè¯†åˆ«è¯¥æ ‡è®°ï¼Œè·å–å¯¹åº”çš„é”ï¼Œå®ç°æ–¹æ³•åŒæ­¥ã€‚

ä¸¤è€…è™½ç„¶å®ç°ç»†èŠ‚ä¸åŒï¼Œä½†æœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ monitor çš„è·å–ã€‚


Synchronized ä¸ºéå…¬å¹³é”ï¼Œåœ¨çº¿ç¨‹è¿›å…¥ ContentionList æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šå…ˆå°è¯•è‡ªæ—‹è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°å°±è¿›å…¥ ContentionListï¼Œè¿™æ˜æ˜¾å¯¹äºå·²ç»è¿›å…¥é˜Ÿåˆ—çš„çº¿ç¨‹æ˜¯ä¸å…¬å¹³çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å…¬å¹³çš„äº‹æƒ…å°±æ˜¯ï¼Œè‡ªæ—‹è·å–é”çš„çº¿ç¨‹è¿˜å¯èƒ½ç›´æ¥æŠ¢å  OnDeck çº¿ç¨‹çš„é”èµ„æºã€‚

synchronized å®ƒæ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹è·å–é”çš„é¡ºåºï¼Œè€Œ Lock å®ç°æä¾›äº†æ¯”ä½¿ç”¨ synchronized æ–¹æ³•å’Œè¯­å¥å¯è·å¾—çš„æ›´å¹¿æ³›çš„é”å®šæ“ä½œï¼Œå®ƒèƒ½ä»¥æ›´ä¼˜é›…çš„æ–¹å¼å¤„ç†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚è¿™æ ·å°±å®ç°äº†å’Œ sychronized ä¸€æ ·çš„åŒæ­¥æ•ˆæœï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨ sychronized ä¿®é¥°çš„æ–¹æ³•æˆ–è€…è¯­å¥å—åœ¨ä»£ç æ‰§è¡Œå®Œä¹‹åé”è‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œç”¨ Lock éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯é”æœ€ç»ˆè¢«é‡Šæ”¾(å‘ç”Ÿå¼‚å¸¸æƒ…å†µ)ï¼Œè¦æŠŠäº’æ–¥åŒºæ”¾åœ¨ try å†…ï¼Œåœ¨ finally å†…é‡Šæ”¾é”ã€‚

	import java.util.concurrent.locks.Lock;
	import java.util.concurrent.locks.ReentrantLock;

	public class coding {

		private static Lock lock = new ReentrantLock();
		//private static Lock lock = new ReentrantLock(true);
		
		public static void main(String[] args) {
			new Thread() {
				public void run() {
					log("T0 "+Thread.currentThread().getName());
				};
			}.start();
			new Thread() {
				public void run() {
					log("T1 "+Thread.currentThread().getName());
				};
			}.start();
		}

		static public void log(String t) {
			for ( int i=0; i<5; i++) {
				lock.lock();
				try {
					System.out.println(t);
					Thread.sleep(600);
				}catch(Exception e){
					e.printStackTrace();
				} finally {
					lock.unlock();
				}
			}
		}

	}

å¯ä»¥å°†ä¸Šé¢ä»£ç ä¸­ log æ”¹é€ ä¸º synchronized åŒæ­¥é”ï¼Œåªéœ€è¦åœ¨æ–¹æ³•æˆå‘˜å£°æ˜ä¸­æ·»åŠ è¿™ä¸ªå…³é”®å­—ï¼Œå¹¶å»æ‰Lockç›¸å…³çš„ä¸¤è¡Œä»£ç å³å¯ï¼Œè¿™æ ·è¿™ä¸ªæ–¹æ³•å°±ä¼šå…·æœ‰éå…¬å¹³çš„åŒæ­¥é”åŠŸèƒ½ï¼Œä»£ç æ‰§è¡Œå®Œä¹‹åé”è‡ªåŠ¨é‡Šæ”¾ã€‚

	static synchronized public void log(String t) {
		for ( int i=0; i<10; i++) {
			// lock.lock();
			try {
				System.out.println(t);
				Thread.sleep(800);
			}catch(Exception e){
				e.printStackTrace();
			} finally {
				// lock.unlock();
			}

		}
	}

synchronized ç­‰å¾…å”¤é†’æœºåˆ¶æä¾›äº† wait å’Œ notify ç­‰æ–¹æ³•ç”¨äºå¤šçº¿ç¨‹åè°ƒè¿è¡Œï¼š

- this.wait() ä½¿çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¿…é¡»åœ¨å·²è·å¾—çš„é”å¯¹è±¡ä¸Šè°ƒç”¨ wait() æ–¹æ³•ï¼›
- this.notify() æˆ– this.notifyAll() å”¤é†’å…¶ä»–ç­‰å¾…çº¿ç¨‹ï¼›

å·²å”¤é†’çš„çº¿ç¨‹è¿˜éœ€è¦é‡æ–°è·å¾—é”åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚

ä½¿ç”¨ sleep() å’Œ wait() æ–¹æ³•ä½¿ç”¨çº¿ç¨‹è¿›å…¥ç¡çœ çš„åŒºåˆ«ï¼š

- sleep() ç¡çœ æ—¶ï¼Œä¿æŒå¯¹è±¡é”ï¼Œä»ç„¶å æœ‰è¯¥é”ï¼› 
- wait() ç¡çœ æ—¶ï¼Œé‡Šæ”¾å¯¹è±¡é”ã€‚ 


Lock æ¥å£çš„å‡ºç°æ›¿ä»£äº†åŒæ­¥ä»£ç å—æˆ–è€…åŒæ­¥å‡½æ•°ï¼Œå°†å…¶éšå¼é”æ“ä½œå˜æˆæ˜¾å¼é”æ“ä½œï¼ŒåŒæ—¶æ›´ä¸ºçµæ´»ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªé”ä¸ŠåŠ ä¸Šå¤šä¸ªç›‘è§†å™¨ã€‚

Lock æ¥å£ä¸­çš„æ–¹æ³•:

- lock(): è·å–é”
- unlock(): é‡Šæ”¾é”, è¿™ä¸ªåŠ¨ä½œæ˜¯å¿…é¡»è¦å®Œæˆçš„, æ‰€ä»¥é€šå¸¸éœ€è¦å®šä¹‰åœ¨ finally ä»£ç å—ä¸­
- tryLockâ€‹(long time, TimeUnit unit) å°è¯•ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œè¶…æ—¶å°±è¿›å…¥ä¸­æ–­é€€å‡º
- lockInterruptibly() å°è¯•è·å–é”å¹¶åœ¨çº¿ç¨‹ä¸­æ–­åé€€å‡º
- newCondition() è¿”å›æ¡ä»¶ç›‘è§†å™¨

Condition æ¥å£çš„å‡ºç°æ›¿ä»£äº† synchronized ä¸­çš„ wait()ã€notify()ã€notifyAll() ç­‰æ–¹æ³•ï¼Œå°†è¿™äº›
ç›‘è§†å™¨æ–¹æ³•å•ç‹¬è¿›è¡Œäº†å°è£…ï¼Œå˜æˆ Condition ç›‘è§†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¸ä»»æ„é”è¿›è¡Œç»„åˆã€‚

Condition å¯¹è±¡å¸¸ç”¨æ–¹æ³•ï¼š

- await(): è®©çº¿ç¨‹å¤„äºå†»ç»“çŠ¶æ€
- signal(): å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹
- signalAll(): å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹

çº¿ç¨‹çš„ interrupt() æ–¹æ³•å¯ä»¥ç»ˆæ­¢çº¿ç¨‹çš„æ‰§è¡Œã€‚

å‚è€ƒ Java Concurrent Animated é¡¹ç›®ï¼Œç”¨ä¸€ç³»åˆ—çš„åŠ¨ç”»æ¥æ¼”ç¤º Java å¹¶å‘åº“ç»„ä»¶å’Œä»£ç ï¼Œæ•ˆæœæ›´å¥½ã€‚


## âš¡ volatile æ•æ„ŸåŒæ­¥
- Java å¹¶å‘ç¼–ç¨‹ volatile https://www.cnblogs.com/iou123lg/p/9280639.html
- Managing volatility https://www.ibm.com/developerworks/java/library/j-jtp06197/
- Chapter 17. Threads and Locks https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html
- https://manybutfinite.com/post/what-does-an-idle-cpu-do/
- https://www.cnblogs.com/zhangj95/p/5647051.html#what-does-an-idle-cpu-do
- https://javatutorial.net/java-volatile-example

volatile æ˜¯ Java æä¾›çš„ä¸€ä¸ªæ¯” synchronized æ›´è½»é‡çº§çš„å®ç°ï¼Œsynchronized å®ç°äº†æ•°æ®åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®è®¿é—®ï¼Œè€Œ volatile å®ç°çš„å°±æ˜¯åŒæ—¶å¯ä»¥å¤šä¸ªçº¿ç¨‹åœ¨è®¿é—®æ•°æ®ï¼Œä½†æ˜¯åªè¦æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œä¾¿ç¡®ä¿å…¶ä»–çº¿ç¨‹åŠæ—¶æ„ŸçŸ¥è¿™ç§å˜åŒ–ã€‚

è®¡ç®—æœºçš„ç¡¬ä»¶ç»„æˆå¯ä»¥æŠ½è±¡ä¸ºç”±æ€»çº¿ã€IO è®¾å¤‡ã€ä¸»å­˜ã€CPU ç­‰ç»„æˆã€‚å…¶ä¸­æ•°æ®å­˜æ”¾åœ¨ä¸»å­˜ä¸­ï¼ŒCPU è´Ÿè´£æŒ‡ä»¤çš„æ‰§è¡Œï¼ŒCPUçš„æŒ‡ä»¤æ‰§è¡Œéå¸¸å¿«ï¼Œå¤§éƒ¨åˆ†ç®€å•æŒ‡ä»¤çš„æ‰§è¡Œåªéœ€è¦ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œè€Œä¸€æ¬¡ä¸»å†…å­˜æ•°æ®çš„è¯»å–åˆ™éœ€è¦å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œé‚£ä¹ˆ CPU ä»ä¸»å­˜ä¸­è¯»å†™æ•°æ®å°±ä¼šæœ‰å¾ˆå¤§çš„å»¶è¿Ÿï¼Œè¿™å°±äº§ç”Ÿäº† L1/L2/L3 çº§é«˜é€Ÿç¼“å­˜çš„æ¦‚å¿µã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå°†è¿ç®—éœ€è¦çš„æ•°æ®ä»ä¸»å­˜å¤åˆ¶ä¸€ä»½åˆ° CPU å†…éƒ¨é«˜é€Ÿç¼“å­˜å½“ä¸­ã€‚é‚£ä¹ˆ CPU è¿›è¡Œè®¡ç®—æ—¶å°±å¯ä»¥ç›´æ¥ä»å®ƒçš„é«˜é€Ÿç¼“å­˜è¯»å†™å…¥æ•°æ®ï¼Œå½“è¿ç®—ç»“æŸä¹‹åï¼Œå†å°†é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å›å†™åˆ°ä¸»å­˜å½“ä¸­ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥é™ä½ CPU ä»ä¸»å­˜ä¸­è·å–æ•°æ®çš„å»¶è¿Ÿã€‚

åœ¨å¤šå†…æ ¸ CPU æ¶æ„ä¸­ï¼Œç¡¬ä»¶å†…å­˜æ¶æ„ä¸­å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜ï¼Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚æ¯”å¦‚è¯´æ ¸ A æ”¹å˜äº†ç¼“å­˜å˜é‡ i çš„å€¼ä¹‹åï¼Œæ ¸ B æ˜¯ä¸çŸ¥é“çš„ï¼Œå­˜æ”¾çš„è¿˜æ˜¯æ—§å€¼ï¼Œæœ€ç»ˆå¯¹è¿™æ ·çš„ä¸€ä¸ªè„æ•°æ®è¿›è¡Œæ“ä½œã€‚

ä¸ºæ­¤ï¼ŒCPU å‚å•†å®šåˆ¶äº†ç›¸å…³çš„è§„åˆ™æ¥è§£å†³è¿™æ ·ä¸€ä¸ªç¡¬ä»¶é—®é¢˜ï¼Œä¸»è¦æœ‰æ€»çº¿åŠ é”å’Œç¼“å­˜åŠ é”æ–¹å¼ã€‚

å˜é‡ä¼šä»ä¸»å†…å­˜å¤åˆ¶åˆ°é«˜é€Ÿç¼“å­˜ï¼Œè®¡ç®—å®Œæˆåï¼Œä¼šå†å›å†™åˆ°ä¸»å†…å­˜ï¼Œè€Œé«˜é€Ÿç¼“å­˜å’Œä¸»å†…å­˜çš„äº¤äº’æ˜¯ä¼šç»è¿‡æ€»çº¿çš„ã€‚æ—¢ç„¶å˜é‡åœ¨åŒä¸€æ—¶åˆ»è¢«å¤šä¸ª CPU åŒæ—¶æ“ä½œï¼Œä¼šå¸¦æ¥è„æ•°æ®ï¼Œé‚£ä¹ˆåªè¦åœ¨æ€»çº¿ä¸Šé˜»å¡å…¶ä»– CPUï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ª CPU å¯¹å˜é‡è¿›è¡Œæ“ä½œï¼Œåç»­çš„ CPU è¯»å†™æ“ä½œå°±ä¸ä¼šæœ‰è„æ•°æ®ã€‚æ€»çº¿é”çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæœ‰ç‚¹ç±»ä¼¼å°†å¤šæ ¸æ“ä½œå˜æˆå•æ ¸æ“ä½œï¼Œæ‰€ä»¥æ•ˆç‡ä½ã€‚

ç¼“å­˜é”ï¼Œå³ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œä¸»è¦æœ‰ MSIã€MESIã€MOSI ç­‰ï¼Œè¿™äº›åè®®çš„ä¸»è¦æ ¸å¿ƒæ€æƒ³ï¼šå½“ CPU å†™æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç°æ“ä½œçš„å˜é‡æ˜¯å…±äº«å˜é‡ï¼Œå³åœ¨å…¶ä»– CPU ä¸­ä¹Ÿå­˜åœ¨è¯¥å˜é‡çš„å‰¯æœ¬ï¼Œä¼šå‘å‡ºä¿¡å·é€šçŸ¥å…¶ä»– CPU å°†è¯¥å˜é‡çš„ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå› æ­¤å½“å…¶ä»– CPU éœ€è¦è¯»å–è¿™ä¸ªå˜é‡æ—¶ï¼Œå‘ç°è‡ªå·±ç¼“å­˜ä¸­ç¼“å­˜è¯¥å˜é‡çš„ç¼“å­˜è¡Œæ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä»å†…å­˜é‡æ–°è¯»å–ã€‚


JVM è§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§ Java å†…å­˜æ¨¡å‹ JMM - Java Memory Model æ¥å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°åœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä¸»æµç¨‹åºè¯­è¨€ C/C++ ç­‰ç›´æ¥ä½¿ç”¨ç‰©ç†ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜æ¨¡å‹ï¼Œå¯ä»¥ç†è§£ä¸ºç±»ä¼¼äºç›´æ¥ä½¿ç”¨äº†ç¡¬ä»¶æ ‡å‡†ï¼Œéƒ½æˆ–å¤šæˆ–å°‘çš„åœ¨ä¸åŒçš„å¹³å°æœ‰ç€ä¸ä¸€æ ·çš„æ‰§è¡Œç»“æœã€‚ã€€

JMM çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³å˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚å…¶è§„å®šäº†æ‰€æœ‰å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹è¯»å†™å˜é‡æ—¶éœ€å…ˆå¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œæ‰§è¡Œå®Œè®¡ç®—æ“ä½œåå†å›å†™åˆ°ä¸»å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜ä¸èƒ½è®¿é—®å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ã€‚

å·¥ä½œå†…å­˜å¯ä»¥çœ‹æˆæ˜¯ CPU é«˜é€Ÿç¼“å­˜ã€å¯„å­˜å™¨çš„æŠ½è±¡ï¼Œä¸»å†…å­˜å¯ä»¥çœ‹æˆå°±æ˜¯ç‰©ç†ç¡¬ä»¶ä¸­ä¸»å†…å­˜çš„æŠ½è±¡ã€‚

ä¸ºäº†è·å¾—è¾ƒå¥½çš„æ‰§è¡Œæ€§èƒ½ï¼ŒJMM å¹¶æ²¡æœ‰é™åˆ¶æ‰§è¡Œå¼•æ“ä½¿ç”¨å¤„ç†å™¨çš„å¯„å­˜å™¨æˆ–è€…é«˜é€Ÿç¼“å­˜æ¥æå‡æŒ‡ä»¤æ‰§è¡Œé€Ÿåº¦ï¼Œä¹Ÿæ²¡æœ‰é™åˆ¶ç¼–è¯‘å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ JMM ä¸­è¿˜ä¼šå­˜åœ¨æŒ‡ä»¤é‡æ’åºçš„é—®é¢˜ã€‚

Java è¯­è¨€åˆæ˜¯æ€ä¹ˆæ¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿå°±æ˜¯é€šè¿‡ volatile è¿™ä¸ªå…³é”®å­—æ¥è§£å†³ç¼“å­˜ä¸€è‡´æ€§å’ŒæŒ‡ä»¤é‡æ’é—®é¢˜ï¼Œvolatile ä½œç”¨å°±æ˜¯ç¡®ä¿å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚


## âš¡ Starvation and Fairness é¥¥é¥¿ä¸å…¬å¹³
- [Java å¹¶å‘ä¹‹é¥¥é¥¿å’Œå…¬å¹³é” Starvation and Fairness](https://cloud.tencent.com/developer/article/1193092)

å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„cpuæ‰§è¡Œæ—¶é—´éƒ½è¢«å…¶ä»–çº¿ç¨‹æŠ¢å äº†ï¼Œå¯¼è‡´å¾—ä¸åˆ° CPU æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µå°±å«åšé¥¥é¥¿ï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šå‡ºç°é¥¥é¥¿è‡´æ­»çš„ç°è±¡ï¼Œå› ä¸ºæ°¸è¿œæ— æ³•å¾—åˆ° CPU çš„æ‰§è¡Œã€‚è§£å†³é¥¥é¥¿ç°è±¡çš„æ–¹æ³•å°±æ˜¯å®ç°å…¬å¹³ï¼Œä¿è¯æ‰€æœ‰çº¿ç¨‹éƒ½å…¬å¹³çš„è·å¾—æ‰§è¡Œçš„æœºä¼šã€‚

é¥¥é¥¿å‘ç”Ÿçš„åŸå› ï¼š
 
- é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹å ç”¨äº†å¤§éƒ¨åˆ†çš„ CPU æ—¶é—´ï¼Œä½ä¼˜å…ˆçº§çº¿ç¨‹å‘ç”Ÿé¥¥é¥¿ï¼›
- çº¿ç¨‹è¢«æ°¸ä¹…å µå¡åœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€ï¼›
- çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªå¤„äºæ°¸ä¹…ç­‰å¾…å®Œæˆçš„å¯¹è±¡ï¼›

è™½ç„¶æ— æ³•å®ç°å®Œå…¨ 100% å…¬å¹³ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥å°½å¯èƒ½çš„æé«˜çº¿ç¨‹çš„å…¬å¹³æ€§ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ç ”ç©¶ä¸€ä¸ªç®€å•çš„ synchronize åŒæ­¥å—ï¼š

	public class Synchronizer{

	  public synchronized void doSynchronized(){
	    //do a lot of work which takes a long time
	  }

	}

å¦‚æœè¶…è¿‡ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿›å…¥è¿™ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°è¯¥çº¿ç¨‹é€€å‡ºã€‚è€Œä¸”æˆ‘ä»¬æ— æ³•çŸ¥é“ä¸‹ä¸€ä¸ªè¿›å…¥ synchronize çš„è¯­å¥å—çš„çº¿ç¨‹ä¼šæ˜¯é‚£ä¸€ä¸ª

ä½¿ç”¨ lock è€Œä¸æ˜¯ synchronize å¢åŠ ç­‰å¾…çº¿ç¨‹çš„å…¬å¹³æ€§ï¼š

	public class Synchronizer
	{
	  Lock lock = new Lock();

	  public void doSynchronized() throws InterruptedException{
	    this.lock.lock();
	      //critical section, do a lot of work which takes a long time
	    this.lock.unlock();
	  }

	}

Lock ç®€å•çš„å®ç°ï¼š

	public class Lock {
	  private boolean isLocked      = false;
	  private Thread  lockingThread = null;

	  public synchronized void lock() throws InterruptedException{
	    while(isLocked){
	      wait();
	    }
	    isLocked      = true;
	    lockingThread = Thread.currentThread();
	  }

	  public synchronized void unlock(){
	    if(this.lockingThread != Thread.currentThread()){
	      throw new IllegalMonitorStateException(
	        "Calling thread has not locked this lock");
	    }
	    isLocked      = false;
	    lockingThread = null;
	    notify();
	  }
	}


10 Fork/Join æ¡†æ¶
public class TestForkJoinPool{
    public static void main(String[] args){
        ForkJoinPool pool = new ForkJoinPool();

        ForkJoinTask<Long> task = new ForkJoinSumCalculate(0L, 100000000L);

        Long sum = pool.invoke(task);

        System.out.println(sum);
    }

}

class ForkJoinSumCalculate extends RecursiveTask<Long>{

    private static final long serialVersionUID = 24340990L;

    private long start;
    private long end;

    private static final long THURSHOLD = 10000L;  // æ‹†åˆ†ä¸´ç•Œå€¼

    // æœ‰å‚æ„é€ å™¨
    public ForkJoinSumCalculate(long start, long end){
        this.start = start;
        this.end = end;
    }

    public Long compute(){
        long length = end - start;

        if(length <= THURSHOLD){
            long  sum = 0L;

            for(long i = start; i<=end; i++){
                sum += i;
            }
            return sum;
        }else{
            long middle = (start + end ) / 2;
            ForkJoinSumCalculate left = new ForkJoinSumCalculate(start, middle);
            left.fork(); // è¿›è¡Œæ‹†åˆ†,åŒæ—¶å‹å…¥çº¿ç¨‹é˜Ÿåˆ—

            ForkJoinSumCalculate right = new ForkJoinSumCalculate(middle + 1, end);
            right.fork(); // è¿›è¡Œæ‹†åˆ†,åŒæ—¶å‹å…¥çº¿ç¨‹é˜Ÿåˆ—

            return left.join() + right.join();
        }
    }
}


## âš¡ Atomic åŸå­åŒ…

java.util.concurrent.atomic æ˜¯ä¸€ä¸ªå°å‹å·¥å…·åŒ…ï¼Œæ”¯æŒå¯¹å•ä¸ªå˜é‡è¿›è¡Œæ— é”çº¿ç¨‹å®‰å…¨ç¼–ç¨‹ã€‚

ç±»çš„å®ä¾‹ AtomicBooleanï¼ŒAtomicIntegerï¼ŒAtomicLongï¼ŒAtomicReference å„è‡ªæä¾›è®¿é—®å’Œæ›´æ–°ç›¸åº”çš„ç±»å‹çš„å•ä¸ªå˜é‡ã€‚ æ¯ä¸ªç±»è¿˜ä¸ºè¯¥ç±»å‹æä¾›é€‚å½“çš„å®ç”¨æ–¹æ³•ã€‚

ä¾‹å¦‚ï¼ŒAtomicLong å’Œ AtomicInteger æä¾›åŸå­å¢é‡æ–¹æ³•ï¼Œå¦‚ä¸€ä¸ªç”Ÿæˆåºåˆ—å·çš„ç¨‹åºï¼š

	class Sequencer { 
	private final AtomicLong sequenceNumber = new AtomicLong(0); 
		public long next() { 
		    return sequenceNumber.getAndIncrement();
		}
	} 

|                ç±»                 |                                     æè¿°                                     |
|-----------------------------------|------------------------------------------------------------------------------|
| AtomicBoolean                     | å¯ä»¥åŸå­æ–¹å¼æ›´æ–°çš„å€¼ boolean ã€‚                                              |
| AtomicInteger                     | å¯ä»¥åŸå­æ–¹å¼æ›´æ–°çš„ intå€¼ã€‚                                                   |
| AtomicIntegerArray                | ä¸€ä¸ª intæ•°ç»„ï¼Œå…¶ä¸­å…ƒç´ å¯ä»¥åŸå­æ–¹å¼æ›´æ–°ã€‚                                     |
| AtomicIntegerFieldUpdater<T>      | åŸºäºåå°„çš„å®ç”¨ç¨‹åºï¼Œå¯å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile intå­—æ®µè¿›è¡ŒåŸå­æ›´æ–°ã€‚          |
| AtomicLong                        | å¯ä»¥åŸå­æ–¹å¼æ›´æ–°çš„ longå€¼ã€‚                                                  |
| AtomicLongArray                   | ä¸€ä¸ª longæ•°ç»„ï¼Œå…¶ä¸­å…ƒç´ å¯ä»¥åŸå­æ–¹å¼æ›´æ–°ã€‚                                    |
| AtomicLongFieldUpdater<T>         | åŸºäºåå°„çš„å®ç”¨ç¨‹åºï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile longå­—æ®µè¿›è¡ŒåŸå­æ›´æ–°ã€‚       |
| AtomicMarkableReference<V>        | AtomicMarkableReferenceç»´æŠ¤ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä»¥åŠä¸€ä¸ªæ ‡è®°ä½ï¼Œå¯ä»¥åŸå­æ–¹å¼æ›´æ–°ã€‚    |
| AtomicReference<V>                | å¯ä»¥åŸå­æ–¹å¼æ›´æ–°çš„å¯¹è±¡å¼•ç”¨ã€‚                                                 |
| AtomicReferenceArray<E>           | ä¸€ç»„å¯¹è±¡å¼•ç”¨ï¼Œå…¶ä¸­å…ƒç´ å¯ä»¥åŸå­æ–¹å¼æ›´æ–°ã€‚                                     |
| AtomicReferenceFieldUpdater<T,â€‹V> | åŸºäºåå°„çš„å®ç”¨ç¨‹åºï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatileå¼•ç”¨å­—æ®µè¿›è¡ŒåŸå­æ›´æ–°ã€‚        |
| AtomicStampedReference<V>         | AtomicStampedReferenceç»´æŠ¤ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä»¥åŠä¸€ä¸ªæ•´æ•°â€œæ ‡è®°â€ï¼Œå¯ä»¥åŸå­æ–¹å¼æ›´æ–°ã€‚ |
| DoubleAccumulator                 | ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡å…±åŒç»´æŠ¤ä½¿ç”¨æä¾›çš„å‡½æ•°æ›´æ–°çš„è¿è¡Œ doubleå€¼ã€‚                    |
| DoubleAdder                       | ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡å…±åŒç»´æŒæœ€åˆçš„é›¶å’Œ doubleæ€»å’Œã€‚                                |
| LongAccumulator                   | ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡å…±åŒç»´æŠ¤ä½¿ç”¨æä¾›çš„å‡½æ•°æ›´æ–°çš„è¿è¡Œ longå€¼ã€‚                      |
| LongAdder                         | ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡å…±åŒç»´æŒæœ€åˆä¸ºé›¶çš„æ€»å’Œä¸º long ã€‚                               |

å†…éƒ¨ compareAndSet æ–¹æ³•ä½¿ç”¨ Unsafe è°ƒç”¨ native åŸç”Ÿæ–¹æ³• CASï¼ˆCompareAndSetï¼‰é€’å¢æ•°å€¼ã€‚

    public final boolean compareAndSet(int expect, int update) {
        return unsafe.compareAndSwapInt(this, valueOffset, expect, update);
    }

CAS åˆ©ç”¨ CPU è°ƒç”¨åº•å±‚æŒ‡ä»¤å®ç°ï¼Œå•ä¸€å¤„ç†å™¨ï¼Œè¿›è¡Œç®€å•çš„è¯»å†™æ“ä½œæ—¶ï¼Œèƒ½ä¿è¯è‡ªèº«è¯»å–çš„åŸå­æ€§ï¼Œå¤šå¤„ç†å™¨æˆ–å¤æ‚çš„å†…å­˜æ“ä½œæ—¶ï¼ŒCAS é‡‡ç”¨æ€»çº¿åŠ é”æˆ–ç¼“å­˜åŠ é”æ–¹å¼ä¿è¯åŸå­æ€§ã€‚

åœ¨å¤šæ ¸å¿ƒ CPU ä¸­ä½¿ç”¨æ€»çº¿åŠ é”ï¼Œå¦‚ i=0 åˆå§‹åŒ–ï¼Œå¤šå¤„ç†å™¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡Œ i++ æ“ä½œä¸‹ï¼Œå¤„ç†å™¨æ ¸å¿ƒ A å’Œ B åŒæ—¶è¯»å– i å€¼åˆ°å„è‡ªç¼“å­˜ï¼Œåˆ†åˆ«è¿›è¡Œé€’å¢ï¼Œå›å†™å€¼ i=1 ç›¸åŒã€‚å¤„ç†å™¨æä¾› LOCK# ä¿¡å·ï¼Œè¿›è¡Œæ€»çº¿åŠ é”åï¼Œå¤„ç†å™¨ A è¯»å– i å€¼å¹¶é€’å¢ï¼Œå¤„ç†å™¨ B è¢«é˜»å¡ä¸èƒ½è¯»å– i å€¼ã€‚

æ€»çº¿åŠ é”ï¼Œåœ¨ LOCK# ä¿¡å·ä¸‹ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•æ“ä½œå†…å­˜ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œç¼“å­˜åŠ é”èƒ½è¾ƒå¥½å¤„ç†è¯¥é—®é¢˜ã€‚

ç¼“å­˜åŠ é”ï¼Œå¤„ç†å™¨æ ¸å¿ƒ A å’Œ B åŒæ—¶è¯»å– i å€¼åˆ°ç¼“å­˜ï¼Œå¤„ç†å™¨ A æå‰å®Œæˆé€’å¢ï¼Œæ•°æ®ç«‹å³å›å†™åˆ°ä¸»å†…å­˜ï¼Œå¹¶è®©å¤„ç†å™¨ B ç¼“å­˜è¯¥æ•°æ®å¤±æ•ˆï¼Œå¤„ç†å™¨ B éœ€é‡æ–°è¯»å– i å€¼ã€‚


	import java.util.concurrent.atomic.*;

	public class AtomicDemo extends Thread 
	{
	    private static final AtomicInteger TEST_INT = new AtomicInteger();

	    @Override
	    public void run() {
	        if (TEST_INT.intValue()<100) TEST_INT.incrementAndGet();
	    }

	    public static void main(String[] args) {
	        for (int i = 0; i < 1000; i++) {
	            AtomicDemo demo = new AtomicDemo();
	            demo.start();
	            // demo.join();
	        }
	     
	        System.out.println("æœ€ç»ˆç»“æœï¼š"+TEST_INT);
	    }
	}

